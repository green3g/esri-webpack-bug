(function(){(this||window).webpackJsonp.registerAbsMids({"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/tasks/operations/urlUtils":405,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/graphics/OptimizedFeatureSet":427,"esri/core/pbf":594,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/pbf":594,"esri/layers/graphics/OptimizedGeometry":597,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/graphics/OptimizedGeometry":597,"esri/layers/graphics/OptimizedFeature":607,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/graphics/OptimizedFeature":607,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/tasks/operations/query":626,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/tasks/operations/pbfQueryUtils":627,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/tasks/operations/pbfFeatureServiceParser":628,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/tasks/operations/queryAttachments":639,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/tasks/QueryTask":649,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/tasks/operations/queryRelatedRecords":650,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/graphics/sources/FeatureLayerSource":816})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[86],{405:function(e,t,r){var n,s;n=[r.dj.c(e.i),t],void 0===(s=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.mapParameters=function e(t){var r={};for(var n in t)if("declaredClass"!==n){var s=t[n];if(null!=s&&"function"!=typeof s)if(Array.isArray(s)){r[n]=[];for(var a=0;a<s.length;a++)r[n][a]=e(s[a])}else"object"==typeof s?s.toJSON&&(r[n]=JSON.stringify(s)):r[n]=s}return r}}.apply(null,n))||(e.exports=s)},427:function(e,t,r){var n,s;n=[r.dj.c(e.i),t],void 0===(s=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1}}();t.default=r}.apply(null,n))||(e.exports=s)},594:function(e,t,r){var n,s;n=[r.dj.c(e.i),t],void 0===(s=function(e,t){return function(){function e(e,t,r,n){this._tag=0,this._dataType=99,this._data=e,this._dataView=t,this._pos=r||0,this._end=n||e.byteLength}return e.prototype.clone=function(){return new e(this._data,this._dataView,this._pos,this._end)},e.prototype.pos=function(){return this._pos},e.prototype.next=function(e){for(;;){if(this._pos===this._end)return!1;var t=this._decodeVarint();if(this._tag=t>>3,this._dataType=7&t,!e||e===this._tag)break;this.skip()}return!0},e.prototype.empty=function(){return this._pos>=this._end},e.prototype.tag=function(){return this._tag},e.prototype.getInt32=function(){return this._decodeVarint()},e.prototype.getInt64=function(){return this._decodeVarint()},e.prototype.getUInt32=function(){var e=4294967295;return e=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128?e:(e=(e|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128?e:void 0))))},e.prototype.getUInt64=function(){return this._decodeVarint()},e.prototype.getSInt32=function(){var e=this.getUInt32();return e>>>1^-(1&e)|0},e.prototype.getSInt64=function(){return this._decodeSVarint()},e.prototype.getBool=function(){var e=0!==this._data[this._pos];return this._skip(1),e},e.prototype.getEnum=function(){return this._decodeVarint()},e.prototype.getFixed64=function(){var e=this._dataView,t=this._pos,r=e.getUint32(t,!0)+4294967296*e.getUint32(t+4,!0);return this._skip(8),r},e.prototype.getSFixed64=function(){var e=this._dataView,t=this._pos,r=e.getUint32(t,!0)+4294967296*e.getInt32(t+4,!0);return this._skip(8),r},e.prototype.getDouble=function(){var e=this._dataView.getFloat64(this._pos,!0);return this._skip(8),e},e.prototype.getFixed32=function(){var e=this._dataView.getUint32(this._pos,!0);return this._skip(4),e},e.prototype.getSFixed32=function(){var e=this._dataView.getInt32(this._pos,!0);return this._skip(4),e},e.prototype.getFloat=function(){var e=this._dataView.getFloat32(this._pos,!0);return this._skip(4),e},e.prototype.getString=function(){var e=this._getLength(),t=this._pos,r=this._toString(this._data,t,t+e);return this._skip(e),r},e.prototype.getBytes=function(){var e=this._getLength(),t=this._pos,r=this._toBytes(this._data,t,t+e);return this._skip(e),r},e.prototype.getMessage=function(){var t=this._getLength(),r=this._pos,n=new e(this._data,this._dataView,r,r+t);return this._skip(t),n},e.prototype.skip=function(){switch(this._dataType){case 0:this._decodeVarint();break;case 1:this._skip(8);break;case 2:this._skip(this._getLength());break;case 5:this._skip(4);break;default:throw new Error("Invalid data type!")}},e.prototype._skip=function(e){if(this._pos+e>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=e},e.prototype._decodeVarint=function(){var e,t=this._data,r=this._pos,n=0;if(this._end-r>=10)do{if(n|=127&(e=t[r++]),0==(128&e))break;if(n|=(127&(e=t[r++]))<<7,0==(128&e))break;if(n|=(127&(e=t[r++]))<<14,0==(128&e))break;if(n|=(127&(e=t[r++]))<<21,0==(128&e))break;if(n+=268435456*(127&(e=t[r++])),0==(128&e))break;if(n+=34359738368*(127&(e=t[r++])),0==(128&e))break;if(n+=4398046511104*(127&(e=t[r++])),0==(128&e))break;if(n+=562949953421312*(127&(e=t[r++])),0==(128&e))break;if(n+=72057594037927940*(127&(e=t[r++])),0==(128&e))break;if(n+=0x8000000000000000*(127&(e=t[r++])),0==(128&e))break;throw new Error("Varint too long!")}while(0);else{for(var s=1;r!==this._end&&0!=(128&(e=t[r]));)++r,n+=(127&e)*s,s*=128;if(r===this._end)throw new Error("Varint overrun!");++r,n+=e*s}return this._pos=r,n},e.prototype._decodeSVarint=function(){var e=this._decodeVarint();return e%2?-(e+1)/2:e/2},e.prototype._getLength=function(){if(2!==this._dataType)throw new Error("Not a delimited data type!");return this._decodeVarint()},e.prototype._toString=function(e,t,r){var n="",s="";r=Math.min(this._end,r);for(var a=t;a<r;++a){var o=e[a];128&o?s+="%"+o.toString(16):(n+=decodeURIComponent(s)+String.fromCharCode(o),s="")}return s.length&&(n+=decodeURIComponent(s)),n},e.prototype._toBytes=function(e,t,r){return r=Math.min(this._end,r),new Uint8Array(e.buffer,t,r-t)},e}()}.apply(null,n))||(e.exports=s)},597:function(e,t,r){var n,s;n=[r.dj.c(e.i),t],void 0===(s=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(e,t){void 0===e&&(e=[]),void 0===t&&(t=[]),this.lengths=e,this.coords=t}}();t.default=r}.apply(null,n))||(e.exports=s)},607:function(e,t,r){var n,s;n=[r.dj.c(e.i),t],void 0===(s=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(e,t,r,n){void 0===e&&(e=null),void 0===t&&(t={}),this.geometry=e,this.attributes=t,r&&(this.centroid=r),null!=n&&(this.objectId=n)}}();t.default=r}.apply(null,n))||(e.exports=s)},626:function(e,t,r){var n,s;n=[r.dj.c(e.i),t,r(345),r(351),r(350),r(420),r(625),r(627),r(405)],void 0===(s=function(e,t,r,n,s,a,o,i,u){function c(e,t){var r=e.geometry,n=e.toJSON(),s=n;if(r&&(s.geometry=JSON.stringify(r),s.geometryType=a.getJsonType(r),s.inSR=r.spatialReference.wkid||JSON.stringify(r.spatialReference)),n.groupByFieldsForStatistics&&(s.groupByFieldsForStatistics=n.groupByFieldsForStatistics.join(",")),n.objectIds&&(s.objectIds=n.objectIds.join(",")),n.orderByFields&&(s.orderByFields=n.orderByFields.join(",")),!n.outFields||t&&(t.returnCountOnly||t.returnExtentOnly||t.returnIdsOnly)?delete s.outFields:-1!==n.outFields.indexOf("*")?s.outFields="*":s.outFields=n.outFields.join(","),n.outSR?s.outSR=n.outSR.wkid||JSON.stringify(n.outSR):r&&(n.returnGeometry||n.returnCentroid)&&(s.outSR=s.inSR),n.returnGeometry&&delete n.returnGeometry,n.outStatistics&&(s.outStatistics=JSON.stringify(n.outStatistics)),n.pixelSize&&(s.pixelSize=JSON.stringify(n.pixelSize)),n.quantizationParameters&&(s.quantizationParameters=JSON.stringify(n.quantizationParameters)),n.source&&(s.layer=JSON.stringify({source:n.source}),delete n.source),n.timeExtent){var o=n.timeExtent;s.time=[null!=o.startTime?o.startTime:"null",null!=o.endTime?o.endTime:"null"],delete n.timeExtent}return s}function l(e,t,a,i,l){void 0===i&&(i={});var p="string"==typeof e?s.urlToObject(e):e,d=t.geometry?[t.geometry]:[];return i.responseType="pbf"===a?"array-buffer":"json",o.normalizeCentralMeridian(d,null,i).then(function(e){var s=e&&e[0];s&&((t=t.clone()).geometry=s);var o=u.mapParameters(r({},p.query,{f:a},l,c(t,l)));return n(p.path+"/query",r({},i,{query:o}))})}Object.defineProperty(t,"__esModule",{value:!0});var p="Layer does not support extent calculation.";t.queryToQueryStringParameters=c,t.executeQuery=function(e,t,r){return l(e,t,"json",r)},t.executeQueryPBF=function(e,t,r){return l(e,t,"pbf",r).then(function(e){var t=i.parsePBFFeatureQuery(e.data),r=e;return r.data=t,r})},t.executeQueryForIds=function(e,t,r){return l(e,t,"json",r,{returnIdsOnly:!0})},t.executeQueryForCount=function(e,t,r){return l(e,t,"json",r,{returnIdsOnly:!0,returnCountOnly:!0})},t.executeQueryForExtent=function(e,t,r){return l(e,t,"json",r,{returnExtentOnly:!0,returnCountOnly:!0}).then(function(e){var t=e.data;if(t.hasOwnProperty("extent"))return e;if(t.features)throw new Error(p);if(t.hasOwnProperty("count"))throw new Error(p);return e})}}.apply(null,n))||(e.exports=s)},627:function(e,t,r){var n,s;n=[r.dj.c(e.i),t,r(342),r(343),r(427),r(628)],void 0===(s=function(e,t,r,n,s,a){Object.defineProperty(t,"__esModule",{value:!0});var o=n.getLogger("esri.tasks.operations.pbfQueryUtils");t.parsePBFFeatureQuery=function(e){try{var t=a.parseFeatureQuery(e).queryResult.featureResult;if(t&&t.features&&t.features.length&&t.objectIdFieldName)for(var n=t.objectIdFieldName,i=0,u=t.features;i<u.length;i++){var c=u[i];c.attributes&&(c.objectId=c.attributes[n])}return t}catch(e){var l=new r("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:e});return o.error(l),new s.default}}}.apply(null,n))||(e.exports=s)},628:function(e,t,r){var n,s;n=[r.dj.c(e.i),t,r(594),r(607),r(427),r(597)],void 0===(s=function(e,t,r,n,s,a){function o(e){return e>=F.length?null:F[e]}function i(e){return e>=j.length?null:j[e]}function u(e){return e>=x.length?null:x[e]}function c(e){return e>=I.length?null:I[e]}function l(e){for(var t=new a.default,r=t.coords;e.next();)switch(e.tag()){case 3:for(var n=e.getUInt32(),s=e.pos()+n,o=0;e.pos()<s;)r[o++]=e.getSInt64();break;case 1:case 2:default:e.skip()}return t}function p(e){for(var t=new a.default,r=t.coords,n=t.lengths;e.next();)switch(e.tag()){case 2:for(var s=e.getUInt32(),o=e.pos()+s;e.pos()<o;)n.push(e.getUInt32());break;case 3:for(var i=e.getUInt32(),u=(o=e.pos()+i,0);e.pos()<o;)r[u++]=e.getSInt64();break;case 1:default:e.skip()}return t}function d(e){for(;e.next();)switch(e.tag()){case 1:return e.getString();case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getSInt32();case 5:return e.getUInt32();case 6:return e.getInt64();case 7:return e.getUInt64();case 8:return e.getSInt64();case 9:return e.getBool();default:return e.skip(),null}return null}function h(e){for(var t={type:o(0)};e.next();)switch(e.tag()){case 1:t.name=e.getString();break;case 2:t.type=o(e.getEnum());break;case 3:t.alias=e.getString();break;case 4:t.sqlType=i(e.getEnum());break;case 5:case 6:default:e.skip()}return t}function y(e,t){for(var r=new n.default,s=0;e.next();)switch(e.tag()){case 1:var a=e.getMessage(),o=t[s++].name;r.attributes[o]=d(a);break;case 2:r.geometry=p(e.getMessage());break;case 4:r.centroid=l(e.getMessage());break;default:e.skip()}return r}function f(e){for(var t=[0,0];e.next();)switch(e.tag()){case 1:t[0]=e.getDouble();break;case 2:t[1]=e.getDouble();break;case 3:case 4:t.push(e.getDouble());break;default:e.skip()}return t}function g(e){for(var t=[0,0];e.next();)switch(e.tag()){case 1:t[0]=e.getDouble();break;case 2:t[1]=e.getDouble();break;case 3:case 4:t.push(e.getDouble());break;default:e.skip()}return t}function m(e){for(var t={originPosition:u(0)};e.next();)switch(e.tag()){case 1:t.originPosition=u(e.getEnum());break;case 2:t.scale=f(e.getMessage());break;case 3:t.translate=g(e.getMessage());break;default:e.skip()}return t}function b(e){for(var t={};e.next();)switch(e.tag()){case 1:t.shapeAreaFieldName=e.getString();break;case 2:t.shapeLengthFieldName=e.getString();break;case 3:t.units=e.getString();break;default:e.skip()}return t}function _(e){for(var t={};e.next();)switch(e.tag()){case 1:t.wkid=e.getUInt32();break;case 5:t.wkt=e.getString();break;case 2:case 3:case 4:default:e.skip()}return t}function v(e){var t=new s.default;for(t.geometryType=c(0);e.next();)switch(e.tag()){case 1:t.objectIdFieldName=e.getString();break;case 3:t.globalIdFieldName=e.getString();break;case 4:t.geohashFieldName=e.getString();break;case 5:t.geometryProperties=b(e.getMessage());break;case 7:t.geometryType=c(e.getEnum());break;case 8:t.spatialReference=_(e.getMessage());break;case 10:t.hasZ=e.getBool();break;case 11:t.hasM=e.getBool();break;case 12:var r=e.getMessage();t.transform=m(r);break;case 9:var n=e.getBool();t.exceededTransferLimit=n;break;case 13:var a=e.getMessage();t.fields.push(h(a));break;case 15:var o=e.getMessage();t.features.push(y(o,t.fields));break;case 2:case 6:default:e.skip()}return t}function k(e){for(var t={};e.next();)switch(e.tag()){case 1:t.featureResult=v(e.getMessage());break;default:e.skip()}return t}Object.defineProperty(t,"__esModule",{value:!0});var F=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML"],j=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],I=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"],x=["upperLeft","lowerLeft"];t.parseFeatureQuery=function(e){for(var t=new r(new Uint8Array(e),new DataView(e)),n={};t.next();)switch(t.tag()){case 2:n.queryResult=k(t.getMessage());break;default:t.skip()}return n}}.apply(null,n))||(e.exports=s)},639:function(e,t,r){var n,s;n=[r.dj.c(e.i),t,r(345),r(351),r(350),r(405)],void 0===(s=function(e,t,r,n,s,a){Object.defineProperty(t,"__esModule",{value:!0}),t.processAttachmentQueryResult=function(e,t,n){for(var a={},o=0,i=e;o<i.length;o++)for(var u=i[o],c=u.parentObjectId,l=0,p=u.attachmentInfos;l<p.length;l++){var d=p[l],h=d.id,y=s.addProxy(t+"/"+c+"/attachments/"+h+(n?"?token="+n:"")),f=r({},d,{parentObjectId:c,url:y});a[c]?a[c].push(f):a[c]=[f]}return a},t.executeAttachmentQuery=function(e,t,s){var o={query:a.mapParameters(r({},e.query,{f:"json"},function(e){var t=e.toJSON();return t.attachmentTypes&&(t.attachmentTypes=t.attachmentTypes.join(",")),t.globalIds&&(t.globalIds=t.globalIds.join(",")),t.objectIds&&(t.objectIds=t.objectIds.join(",")),t.size&&(t.size=t.size.join(",")),t}(t)))};return s&&(o=r({},s,o)),n(e.path+"/queryAttachments",o)}}.apply(null,n))||(e.exports=s)},649:function(e,t,r){var n,s;n=[r.dj.c(e.i),t,r(338),r(336),r(387),r(345),r(365),r(337),r(743),r(626),r(639),r(650),r(444),r(394),r(418),r(447)],void 0===(s=function(e,t,r,n,s,a,o,i,u,c,l,p,d,h,y,f){return function(e){function t(t){var r=e.call(this,t)||this;return r.gdbVersion=null,r.source=null,r}return r(t,e),t.prototype.execute=function(e,t){return this.executeJSON(e,t).then(function(e){return h.fromJSON(e)})},t.prototype.executeJSON=function(e,t){return c.executeQuery(this.parsedUrl,this._normalizeQuery(e),a({},this.requestOptions,t)).then(function(e){return e.data})},t.prototype.executeForCount=function(e,t){return c.executeQueryForCount(this.parsedUrl,this._normalizeQuery(e),a({},this.requestOptions,t)).then(function(e){return e.data.count})},t.prototype.executeForExtent=function(e,t){return c.executeQueryForExtent(this.parsedUrl,this._normalizeQuery(e),a({},this.requestOptions,t)).then(function(e){return{count:e.data.count,extent:o.Extent.fromJSON(e.data.extent)}})},t.prototype.executeForIds=function(e,t){return c.executeQueryForIds(this.parsedUrl,this._normalizeQuery(e),a({},this.requestOptions,t)).then(function(e){return e.data.objectIds})},t.prototype.executeRelationshipQuery=function(e,t){return(this.gdbVersion||this.source)&&(e=e.clone().set({gdbVersion:this.gdbVersion||e.gdbVersion,source:this.source||e.source})),p.executeRelationshipQuery(this.parsedUrl,e,a({},this.requestOptions,t)).then(function(e){var t=e.data,r={};return Object.keys(t).forEach(function(e){return r[e]=h.fromJSON(t[e])}),r})},t.prototype.executeAttachmentQuery=function(e,t){var r=this,n=t&&t.query&&t.query.token;return l.executeAttachmentQuery(this.parsedUrl,e,a({},this.requestOptions,t)).then(function(e){return l.processAttachmentQueryResult(e.data.attachmentGroups,r.parsedUrl.path,n)})},t.prototype._normalizeQuery=function(e){return this.gdbVersion||this.source?e.clone().set({gdbVersion:this.gdbVersion||e.gdbVersion,source:this.source||e.source}):e},n([i.property()],t.prototype,"gdbVersion",void 0),n([i.property()],t.prototype,"source",void 0),n([s(0,i.cast(y))],t.prototype,"execute",null),n([s(0,i.cast(y))],t.prototype,"executeJSON",null),n([s(0,i.cast(y))],t.prototype,"executeForCount",null),n([s(0,i.cast(y))],t.prototype,"executeForExtent",null),n([s(0,i.cast(y))],t.prototype,"executeForIds",null),n([s(0,i.cast(f))],t.prototype,"executeRelationshipQuery",null),n([s(0,i.cast(d))],t.prototype,"executeAttachmentQuery",null),n([i.subclass("esri.tasks.QueryTask")],t)}(i.declared(u))}.apply(null,n))||(e.exports=s)},650:function(e,t,r){var n,s;n=[r.dj.c(e.i),t,r(345),r(351),r(405)],void 0===(s=function(e,t,r,n,s){function a(e){var t=e.toJSON();return t.objectIds&&(t.objectIds=t.objectIds.join(",")),t.outFields&&(t.outFields=t.outFields.join(",")),t.outSpatialReference&&(t.outSR=t.outSR.wkid||JSON.stringify(t.outSR.toJSON()),delete t.outSpatialReference),t.source&&(t.layer=JSON.stringify({source:t.source}),delete t.source),t}Object.defineProperty(t,"__esModule",{value:!0}),t.toQueryStringParameters=a,t.executeRelationshipQuery=function(e,t,o){var i={query:s.mapParameters(r({},e.query,{f:"json"},a(t)))};return o&&(i=r({},o,i)),n(e.path+"/queryRelatedRecords",i).then(function(e){for(var t=e.data,r=t.geometryType,n=t.spatialReference,s={},a=0,o=t.relatedRecordGroups;a<o.length;a++){var i=o[a],u={fields:void 0,objectIdFieldName:void 0,geometryType:r,spatialReference:n,features:i.relatedRecords};if(null!=i.objectId)s[i.objectId]=u;else for(var c in i)i.hasOwnProperty(c)&&"relatedRecords"!==c&&(s[i[c]]=u)}return e.data=s,e})}}.apply(null,n))||(e.exports=s)},816:function(e,t,r){var n,s;n=[r.dj.c(e.i),t,r(338),r(336),r(345),r(423),r(351),r(346),r(342),r(467),r(340),r(337),r(649),r(639)],void 0===(s=function(e,t,r,n,s,a,o,i,u,c,l,p,d,h){Object.defineProperty(t,"__esModule",{value:!0});var y=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.load=function(){return this.addResolvingPromise(this._fetchService()),this.when()},Object.defineProperty(t.prototype,"queryTask",{get:function(){var e=this.layer,t=e.parsedUrl,r=e.dynamicDataSource,n=e.gdbVersion;return new d({url:null!=r?t.path+"?"+a.objectToQuery(t.query):t.path,gdbVersion:n})},enumerable:!0,configurable:!0}),t.prototype.addAttachment=function(e,t){var r=this;return this.load().then(function(){var n=e.attributes[r.layer.objectIdField],a=r.layer.parsedUrl.path+"/"+n+"/addAttachment";return o(a,{body:t,query:s({f:"json"},r.layer.parsedUrl.query,{token:r.layer.token}),responseType:"json"}).then(function(e){return r._createFeatureEditResult(e.data.addAttachmentResult)}).catch(function(e){return l.reject(r._createAttachmentErrorResult(n,e))})})},t.prototype.updateAttachment=function(e,t,r){var n=this;return this.load().then(function(){var a=e.attributes[n.layer.objectIdField],i=n.layer.parsedUrl.path+"/"+a+"/updateAttachment";return o(i,{body:r,query:s({f:"json"},n.layer.parsedUrl.query,{attachmentId:t,token:n.layer.token}),responseType:"json"}).then(function(e){return n._createFeatureEditResult(e.data.updateAttachmentResult)}).catch(function(e){return l.reject(n._createAttachmentErrorResult(a,e))})})},t.prototype.applyEdits=function(e){var t=this;return this.load().then(function(){var r=e.addFeatures.map(t._serializeFeature,t),n=e.updateFeatures.map(t._serializeFeature,t),s=t._getFeatureIds(e.deleteFeatures),a={f:"json",adds:r.length?JSON.stringify(r):null,updates:n.length?JSON.stringify(n):null,deletes:s.length?s.join(","):null};return o(t.layer.parsedUrl.path+"/applyEdits",{query:a,method:"post",responseType:"json"})}).then(function(e){return t._createEditsResult(e)})},t.prototype.deleteAttachments=function(e,t){var r=this;return this.load().then(function(){var n=e.attributes[r.layer.objectIdField],a=r.layer.parsedUrl.path+"/"+n+"/deleteAttachments";return o(a,{query:s({f:"json"},r.layer.parsedUrl.query,{token:r.layer.token,attachmentIds:t.join(",")}),method:"post",responseType:"json"}).then(function(e){return e.data.deleteAttachmentResults.map(r._createFeatureEditResult)}).catch(function(e){return l.reject(r._createAttachmentErrorResult(n,e))})})},t.prototype.queryAttachments=function(e){var t=this,r=this.layer,n=r.token,a=r.parsedUrl,i=a.path;return this.load().then(function(){var r={query:s({},a.query,{f:"json",token:n}),responseType:"json"};if(!t.layer.get("capabilities.query.supportsAttachments")){for(var u=e.objectIds,c=[],p=0,d=u;p<d.length;p++){var y=d[p],f=i+"/"+y+"/attachments";c.push(o(f,r))}return l.all(c).then(function(e){return u.map(function(t,r){return{parentObjectId:t,attachmentInfos:e[r].data.attachmentInfos}})}).then(function(e){return h.processAttachmentQueryResult(e,i,n)})}return t.queryTask.executeAttachmentQuery(e,r)})},t.prototype.queryFeatures=function(e,t){var r=this;return this.load().then(function(){return r.queryTask.execute(e,t)})},t.prototype.queryFeaturesJSON=function(e,t){var r=this;return this.load().then(function(){return r.queryTask.executeJSON(e,t)})},t.prototype.queryObjectIds=function(e,t){var r=this;return this.load().then(function(){return r.queryTask.executeForIds(e,t)})},t.prototype.queryFeatureCount=function(e,t){var r=this;return this.load().then(function(){return r.queryTask.executeForCount(e,t)})},t.prototype.queryExtent=function(e,t){var r=this;return this.load().then(function(){return r.queryTask.executeForExtent(e,t)})},t.prototype.queryRelatedFeatures=function(e){var t=this;return this.load().then(function(){return t.queryTask.executeRelationshipQuery(e)})},t.prototype._fetchService=function(){var e=this;return o(this.layer.parsedUrl.path,{query:s({f:"json"},this.layer.parsedUrl.query),responseType:"json"}).then(function(t){var r=t.data;e.layerDefinition=r})},t.prototype._serializeFeature=function(e){var t=e.geometry,r=e.attributes;return{geometry:t&&t.toJSON(),attributes:r}},t.prototype._getFeatureIds=function(e){var t=e[0];return t?"objectId"in t?this._getIdsFromFeatureIdentifier(e):this._getIdsFromFeatures(e):[]},t.prototype._getIdsFromFeatures=function(e){var t=this.layer.objectIdField;return e.map(function(e){return e.attributes&&e.attributes[t]})},t.prototype._getIdsFromFeatureIdentifier=function(e){return e.map(function(e){return e.objectId})},t.prototype._createEditsResult=function(e){var t=e.data;return{addFeatureResults:t.addResults?t.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:t.updateResults?t.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:t.deleteResults?t.deleteResults.map(this._createFeatureEditResult,this):[]}},t.prototype._createFeatureEditResult=function(e){var t=!0===e.success?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:t?new u("feature-layer-source:edit-failure",t.description,{code:t.code}):null}},t.prototype._createAttachmentErrorResult=function(e,t){var r=t.details.messages&&t.details.messages[0]||t.message,n=t.details.httpStatus||t.details.messageCode;return{objectId:e,globalId:null,error:new u("feature-layer-source:attachment-failure",r,{code:n})}},n([p.property({constructOnly:!0})],t.prototype,"layer",void 0),n([p.property({readOnly:!0,dependsOn:["layer.parsedUrl","layer.gdbVersion","layer.dynamicDataSource"]})],t.prototype,"queryTask",null),n([p.subclass("esri.layers.graphics.sources.FeatureLayerSource")],t)}(p.declared(i,c));t.default=y}.apply(null,n))||(e.exports=s)}}]);