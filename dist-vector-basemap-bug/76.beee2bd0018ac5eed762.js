(function(){(this||window).webpackJsonp.registerAbsMids({"esri/core/screenUtils":354,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/screenUtils":354,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/symbols/Symbol":371,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/workers/utils":378,"esri/core/workers/RemoteClient":389,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/workers/RemoteClient":389,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/tasks/support/FeatureSet":392,"esri/symbols/SimpleLineSymbol":402,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/symbols/SimpleLineSymbol":402,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/tasks/operations/urlUtils":403,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/graphics/OptimizedFeatureSet":425,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/workers":437,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/tasks/support/AttachmentQuery":440,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/tasks/support/RelationshipQuery":444,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/requireUtils":446,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/symbols/FillSymbol":457,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/symbols/MarkerSymbol":458,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/symbols/support/urlUtils":586,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/symbols/LineSymbol":592,"esri/core/pbf":593,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/pbf":593,"esri/layers/graphics/OptimizedGeometry":595,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/graphics/OptimizedGeometry":595,"esri/layers/graphics/OptimizedFeature":603,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/graphics/OptimizedFeature":603,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/workers/workers":607,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/workers/Connection":608,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/workers/WorkerOwner":609,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/workers/workerFactory":610,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/workers/loaderConfig":611,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/workers/WorkerFallback":612,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/geometry/support/graphicsUtils":613,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/tasks/operations/query":627,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/tasks/operations/pbfQueryUtils":628,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/tasks/operations/pbfFeatureServiceParser":629,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/tasks/operations/queryAttachments":639,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/tasks/QueryTask":647,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/tasks/operations/queryRelatedRecords":648,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/symbols/PictureMarkerSymbol":701,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/symbols/SimpleFillSymbol":702,"esri/views/3d/layers/PointCloudWorker":735,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/PointCloudWorker":735,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/support/orientedBoundingBox":762,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/support/layerViewUpdatingProperties":764,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/i3s/I3SUtil":765,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/i3s/I3SBinaryReader":771,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/i3s/LEPCC":975,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/support/dito":1023,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/i3s/IdleQueue":1106,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/i3s/PointCloudRendererUtil":1423,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/PointCloudLayerView3D":2402,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/i3s/LoDUtil":2403,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/i3s/PagedNodeIndex":2404,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/i3s/PointRenderer":2405,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/shaders/PointRendererPrograms":2406})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[76],{1023:function(e,t,r){var n,o;n=[r.dj.c(e.i),t,r(342)],void 0===(o=function(e,t,r){function n(e,t,n,o,i,a,u,l,d,c,p){return function(e,t,n){for(var o=r.vec3d.dist2(e.maxVert[0],e.minVert[0]),i=0,s=1;s<7;++s){var a=r.vec3d.dist2(e.maxVert[s],e.minVert[s]);a>o&&(o=a,i=s)}r.vec3d.set(e.minVert[i],t),r.vec3d.set(e.maxVert[i],n)}(e,o,i),r.vec3d.dist2(o,i)<f?1:(r.vec3d.subtract(o,i,u),r.vec3d.normalize(u),function(e,t,n,o){for(var i=e.data,s=e.offsetIdx,a=e.strideIdx,u=Number.NEGATIVE_INFINITY,l=0,d=s;d<i.length;d+=a){r.vec3d.set3(i[d]-t[0],i[d+1]-t[1],i[d+2]-t[2],P);var c=n[0]*P[0]+n[1]*P[1]+n[2]*P[2],p=r.vec3d.length2(n),f=r.vec3d.length2(P)-c*c/p;f>u&&(u=f,l=d)}return r.vec3d.set3(i[l],i[l+1],i[l+2],o),u}(t,o,u,a)<f?2:(r.vec3d.subtract(i,a,l),r.vec3d.normalize(l),r.vec3d.subtract(a,o,d),r.vec3d.normalize(d),r.vec3d.cross(l,u,n),r.vec3d.normalize(n),s(t,n,u,l,d,c),0))}function o(e,t,n,o,a,u,l,d,c,p){i(e,t,n,o,a,y,v),void 0!==y[0]&&(r.vec3d.subtract(y,n,m),r.vec3d.normalize(m),r.vec3d.subtract(y,o,b),r.vec3d.normalize(b),r.vec3d.subtract(y,a,_),r.vec3d.normalize(_),r.vec3d.cross(b,u,w),r.vec3d.normalize(w),r.vec3d.cross(_,l,S),r.vec3d.normalize(S),r.vec3d.cross(m,d,x),r.vec3d.normalize(x),s(e,w,u,b,m,c),s(e,S,l,_,b,c),s(e,x,d,m,_,c)),void 0!==v[0]&&(r.vec3d.subtract(v,n,m),r.vec3d.normalize(m),r.vec3d.subtract(v,o,b),r.vec3d.normalize(b),r.vec3d.subtract(v,a,_),r.vec3d.normalize(_),r.vec3d.cross(b,u,w),r.vec3d.normalize(w),r.vec3d.cross(_,l,S),r.vec3d.normalize(S),r.vec3d.cross(m,d,x),r.vec3d.normalize(x),s(e,w,u,b,m,c),s(e,S,l,_,b,c),s(e,x,d,m,_,c))}function i(e,t,n,o,i,s,a){!function(e,t,n,o,i){var s=e.data,a=e.offsetIdx,u=e.strideIdx;r.vec3d.set3(s[a],s[a+1],s[a+2],o),r.vec3d.set(o,i),n[0]=r.vec3d.dot(N,t),n[1]=n[0];for(var l=a+u;l<s.length;l+=u){r.vec3d.set3(s[l],s[l+1],s[l+2],N);var d=r.vec3d.dot(N,t);d<n[0]&&(n[0]=d,r.vec3d.set(N,o)),d>n[1]&&(n[1]=d,r.vec3d.set(N,i))}}(e,t,I,a,s);var u=r.vec3d.dot(n,t);I[1]-f<=u&&(s[0]=void 0),I[0]+f>=u&&(a[0]=void 0)}function s(e,t,n,o,i,s){if(!(r.vec3d.length2(t)<f)){r.vec3d.cross(n,t,j),r.vec3d.cross(o,t,k),r.vec3d.cross(i,t,O),a(e,t,I),M[1]=I[0],C[1]=I[1],T[1]=C[1]-M[1];for(var u=[n,o,i],l=[j,k,O],d=0;d<3;++d){a(e,u[d],I),M[0]=I[0],C[0]=I[1],a(e,l[d],I),M[2]=I[0],C[2]=I[1],T[0]=C[0]-M[0],T[2]=C[2]-M[2];var c=p(T);c<s.quality&&(r.vec3d.set(u[d],s.b0),r.vec3d.set(t,s.b1),r.vec3d.set(l[d],s.b2),s.quality=c)}}}function a(e,t,r){var n=e.data,o=e.offsetIdx,i=e.strideIdx;r[0]=Number.POSITIVE_INFINITY,r[1]=Number.NEGATIVE_INFINITY;for(var s=o;s<n.length;s+=i){var a=n[s]*t[0]+n[s+1]*t[1]+n[s+2]*t[2];r[0]=Math.min(r[0],a),r[1]=Math.max(r[1],a)}}function u(e,t,n){r.vec3d.set(e,n.center),r.vec3d.scale(t,.5,n.halfSize),r.quat4.identity(n.quaternion)}function l(e,t,n){r.vec3d.set(t,R),Math.abs(t[0])>Math.abs(t[1])&&Math.abs(t[0])>Math.abs(t[2])?R[0]=0:Math.abs(t[1])>Math.abs(t[2])?R[1]=0:R[2]=0,r.vec3d.length2(R)<f&&(R[0]=R[1]=R[2]=1),r.vec3d.cross(t,R,E),r.vec3d.normalize(E),r.vec3d.cross(t,E,U),r.vec3d.normalize(U),d(e,t,E,U,F,L),r.vec3d.subtract(L,F,z),c(t,E,U,F,L,z,n)}function d(e,t,r,n,o,i){a(e,t,I),o[0]=I[0],i[0]=I[1],a(e,r,I),o[1]=I[0],i[1]=I[1],a(e,n,I),o[2]=I[0],i[2]=I[1]}function c(e,t,n,o,i,s,a){D[0]=e[0],D[3]=e[1],D[6]=e[2],D[1]=t[0],D[4]=t[1],D[7]=t[2],D[2]=n[0],D[5]=n[1],D[8]=n[2],r.quat4.fromRotationMatrix(D,a.quaternion),r.vec3d.add(o,i,V),r.vec3d.scale(V,.5),r.vec3d.scale(e,V[0],a.center),r.vec3d.scale(t,V[1],A),r.vec3d.add(a.center,A),r.vec3d.scale(n,V[2],A),r.vec3d.add(a.center,A),r.vec3d.scale(s,.5,a.halfSize)}function p(e){return e[0]*e[1]+e[0]*e[2]+e[1]*e[2]}Object.defineProperty(t,"__esModule",{value:!0});var f=1e-6,h=r.vec3d.create(),g=r.vec3d.create();t.computeOBB=function(e,t){var i=e.data,s=e.strideIdx,a=i.length/s;if(!(a<=0)){var f=new q(e);r.vec3d.add(f.minProj,f.maxProj,h),r.vec3d.scale(h,.5),r.vec3d.subtract(f.maxProj,f.minProj,g);var y=p(g),v=new B;v.quality=y,a<14&&(e={data:new Float64Array(f.buffer,112,42),size:3,offsetIdx:0,strideIdx:3});var m=r.vec3d.create(),b=r.vec3d.create(),_=r.vec3d.create(),w=r.vec3d.create(),S=r.vec3d.create(),x=r.vec3d.create(),P=r.vec3d.create();switch(n(f,e,P,m,b,_,w,S,x,v)){case 1:return void u(h,g,t);case 2:return void l(e,w,t)}o(e,P,m,b,_,w,S,x,v),d(e,v.b0,v.b1,v.b2,F,L);var I=r.vec3d.create();r.vec3d.subtract(L,F,I),v.quality=p(I),v.quality<y?c(v.b0,v.b1,v.b2,F,L,I,t):u(h,g,t)}};var y=r.vec3d.create(),v=r.vec3d.create(),m=r.vec3d.create(),b=r.vec3d.create(),_=r.vec3d.create(),w=r.vec3d.create(),S=r.vec3d.create(),x=r.vec3d.create(),P=r.vec3d.create(),I=r.vec2d.create(),j=r.vec3d.create(),k=r.vec3d.create(),O=r.vec3d.create(),C=r.vec3d.create(),M=r.vec3d.create(),T=r.vec3d.create(),N=r.vec3d.create(),R=r.vec3d.create(),E=r.vec3d.create(),U=r.vec3d.create(),F=r.vec3d.create(),L=r.vec3d.create(),z=r.vec3d.create(),A=r.vec3d.create(),D=r.mat3.create(),V=r.vec3d.create(),q=function(){return function(e){this.minVert=[],this.maxVert=[],this.buffer=new ArrayBuffer(448);var t=0;for(this.minProj=new Float64Array(this.buffer,t,7),t+=56,this.maxProj=new Float64Array(this.buffer,t,7),t+=56;this.minVert.length<7;)this.minVert.push(new Float64Array(this.buffer,t,3)),t+=24;for(;this.maxVert.length<7;)this.maxVert.push(new Float64Array(this.buffer,t,3)),t+=24;for(var n=0;n<7;++n)this.minProj[n]=Number.POSITIVE_INFINITY,this.maxProj[n]=Number.NEGATIVE_INFINITY;var o=[],i=[],s=e.data,a=e.offsetIdx,u=e.strideIdx;for(n=a;n<s.length;n+=u){var l=s[n];l<this.minProj[0]&&(this.minProj[0]=l,o[0]=n),l>this.maxProj[0]&&(this.maxProj[0]=l,i[0]=n),(l=s[n+1])<this.minProj[1]&&(this.minProj[1]=l,o[1]=n),l>this.maxProj[1]&&(this.maxProj[1]=l,i[1]=n),(l=s[n+2])<this.minProj[2]&&(this.minProj[2]=l,o[2]=n),l>this.maxProj[2]&&(this.maxProj[2]=l,i[2]=n),(l=s[n]+s[n+1]+s[n+2])<this.minProj[3]&&(this.minProj[3]=l,o[3]=n),l>this.maxProj[3]&&(this.maxProj[3]=l,i[3]=n),(l=s[n]+s[n+1]-s[n+2])<this.minProj[4]&&(this.minProj[4]=l,o[4]=n),l>this.maxProj[4]&&(this.maxProj[4]=l,i[4]=n),(l=s[n]-s[n+1]+s[n+2])<this.minProj[5]&&(this.minProj[5]=l,o[5]=n),l>this.maxProj[5]&&(this.maxProj[5]=l,i[5]=n),(l=s[n]-s[n+1]-s[n+2])<this.minProj[6]&&(this.minProj[6]=l,o[6]=n),l>this.maxProj[6]&&(this.maxProj[6]=l,i[6]=n)}for(n=0;n<7;++n){var d=o[n];r.vec3d.set3(s[d],s[d+1],s[d+2],this.minVert[n]),d=i[n],r.vec3d.set3(s[d],s[d+1],s[d+2],this.maxVert[n])}}}(),B=function(){return function(){this.b0=r.vec3d.createFrom(1,0,0),this.b1=r.vec3d.createFrom(0,1,0),this.b2=r.vec3d.createFrom(0,0,1),this.quality=0}}()}.apply(null,n))||(e.exports=o)},1106:function(e,t,r){var n,o;n=[r.dj.c(e.i),t,r(380),r(456)],void 0===(o=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){this._deferreds=[],this._values=[]}return e.prototype.push=function(e){var t=new r;return this._deferreds.push(t),this._values.push(e),t.promise},e.prototype.unshift=function(e){var t=new r;return this._deferreds.unshift(t),this._values.unshift(e),t.promise},e.prototype.length=function(){return this._deferreds.length},e.prototype.process=function(){this._deferreds.shift().resolve(this._values.shift())},e.prototype.cancelAll=function(){for(var e=new n,t=0,r=this._deferreds;t<r.length;t++)r[t].cancel(e);this._deferreds.length=0,this._values.length=0},e}();t.IdleQueue=o}.apply(null,n))||(e.exports=o)},1423:function(e,t,r){var n,o;n=[r.dj.c(e.i),t,r(1371),r(1374),r(1375),r(771)],void 0===(o=function(e,t,r,n,o,i){function s(e,t){for(var r=0,n=e;r<n.length;r++){var o=n[r];if(o.name===t&&null!=o.attributeValues&&"UInt8"===o.attributeValues.valueType&&3===o.attributeValues.valuesPerElement)return{storageInfo:o,useElevation:!1}}return null}function a(e,t){for(var r=0,n=e;r<n.length;r++){var o=n[r];if(o.name===t){var i="embedded-elevation"===o.encoding;return{storageInfo:i?null:o,useElevation:i}}}return"elevation"===t.toLowerCase()?{storageInfo:null,useElevation:!0}:null}function u(e,t,r,n){if(e&&e.useElevation){for(var o=new Float64Array(n),s=0;s<n;s++)o[s]=r[3*s+2];return o}return e&&t?i.readBinaryAttribute(e.storageInfo,t,n):null}function l(e){return null==e||"none"===e?null:"low-four-bit"===e?function(e){return 15&e}:"high-four-bit"===e?function(e){return(240&e)>>4}:"absolute-value"===e?function(e){return Math.abs(e)}:"modulo-ten"===e?function(e){return e%10}:null}Object.defineProperty(t,"__esModule",{value:!0}),t.getRendererInfo=function(e){var t=e.renderer,r=t&&t.type,n=t&&e.renderer.toJSON()||null,o=null,i=!1;"point-cloud-unique-value"===r?o=a(e.attributeStorageInfo,t.field):"point-cloud-stretch"===r?o=a(e.attributeStorageInfo,t.field):"point-cloud-class-breaks"===r?o=a(e.attributeStorageInfo,t.field):i="point-cloud-rgb"===r?null!=(o=s(e.attributeStorageInfo,t.field)):null!=(o=s(e.attributeStorageInfo,"RGB"));var u=null;return t&&t.colorModulation&&(u=a(e.attributeStorageInfo,t.colorModulation.field)),{rendererJSON:n,isRGBRenderer:i,primaryAttribute:o,modulationAttribute:u}},t.evaluateRenderer=function(e,t,i,s,a){var d=e.rendererJSON,c=e.isRGBRenderer,p=e.primaryAttribute,f=e.modulationAttribute,h=u(p,t,s,a),g=u(f,i,s,a),y=null,v=null;if(h&&c)y=h;else if(h&&"pointCloudUniqueValueRenderer"===d.type){var m=(v=o.fromJSON(d)).colorUniqueValueInfos;y=new Uint8Array(3*a);for(var b=l(v.fieldTransformType),_=0;_<a;_++)for(var w=(P=b?b(h[_]):h[_])+"",S=0;S<m.length;S++)if(m[S].values.indexOf(w)>=0){y[3*_]=m[S].color.r,y[3*_+1]=m[S].color.g,y[3*_+2]=m[S].color.b;break}}else if(h&&"pointCloudStretchRenderer"===d.type){var x=(v=n.fromJSON(d)).stops;for(y=new Uint8Array(3*a),b=l(v.fieldTransformType),_=0;_<a;_++){var P=b?b(h[_]):h[_],I=x.length-1;if(P<x[0].value)y[3*_]=x[0].color.r,y[3*_+1]=x[0].color.g,y[3*_+2]=x[0].color.b;else if(P>=x[I].value)y[3*_]=x[I].color.r,y[3*_+1]=x[I].color.g,y[3*_+2]=x[I].color.b;else for(S=1;S<x.length;S++)if(P<x[S].value){var j=(P-x[S-1].value)/(x[S].value-x[S-1].value);y[3*_]=x[S].color.r*j+x[S-1].color.r*(1-j),y[3*_+1]=x[S].color.g*j+x[S-1].color.g*(1-j),y[3*_+2]=x[S].color.b*j+x[S-1].color.b*(1-j);break}}}else if(h&&"pointCloudClassBreaksRenderer"===d.type){var k=(v=r.fromJSON(d)).colorClassBreakInfos;for(y=new Uint8Array(3*a),b=l(v.fieldTransformType),_=0;_<a;_++)for(P=b?b(h[_]):h[_],S=0;S<k.length;S++)if(P>=k[S].minValue&&P<=k[S].maxValue){y[3*_]=k[S].color.r,y[3*_+1]=k[S].color.g,y[3*_+2]=k[S].color.b;break}}else for(y=new Uint8Array(3*a),_=0;_<y.length;_++)y[_]=255;if(g&&v&&v.colorModulation){var O=v.colorModulation.minValue,C=v.colorModulation.maxValue;for(_=0;_<a;_++){var M=(P=g[_])>=C?1:P<=O?.3:.3+.7*(P-O)/(C-O);y[3*_]=M*y[3*_],y[3*_+1]=M*y[3*_+1],y[3*_+2]=M*y[3*_+2]}}return y},t.getSplatSizeAlgorithm=function(e){var t=e&&e.pointSizeAlgorithm;return t&&"splat"===t.type?t:null},t.getFixedSizeAlgorithm=function(e){var t=e&&e.pointSizeAlgorithm;return t&&"fixed-size"===t.type?t:null},t.rendererUsesFixedSizes=function(e){var t=e&&e.pointSizeAlgorithm;return!(!t||!t.type)&&"fixed-size"===t.type}}.apply(null,n))||(e.exports=o)},2402:function(e,t,r){var n,o;n=[r.dj.c(e.i),t,r(345),r(335),r(456),r(435),r(350),r(379),r(379),r(365),r(343),r(339),r(446),r(354),r(377),r(437),r(336),r(384),r(443),r(1006),r(734),r(735),r(765),r(1106),r(2403),r(2404),r(1423),r(2405),r(764),r(342),r(604),r(762),r(387),r(410),r.dj.m(e)],void 0===(o=function(e,t,r,n,o,i,s,a,u,l,d,c,p,f,h,g,y,v,m,b,_,w,S,x,P,I,j,k,O,C,M,T,N,R,E){var U=d.getLogger("esri.views.3d.layers.PointCloudLayerView3D"),F=M.plane.create();return function(t){function d(){var e=null!==t&&t.apply(this,arguments)||this;return e.maximumPointCount=4e6,e.slicePlaneEnabled=!1,e._renderer=null,e._rendererAdded=!1,e._renderedNodes=new Set,e._updateViewNeeded=!0,e._lodFactor=1,e._worker=new w,e._workerThread=null,e._maxLoggedBoxWarnings=5,e._pageMultiplier=1,e._handles=new l,e._indexQueue=[],e._workQueue=[],e._idleQueue=new x.IdleQueue,e._indexPagesLoading=new Map,e._loadingNodes=new Map,e._layerIsVisible=!1,e._totalWork=0,e._index=null,e._loadingInitNodePage=!1,e._nodeIdArray=[],e}return r(d,t),Object.defineProperty(d.prototype,"pointScale",{get:function(){var e=j.getSplatSizeAlgorithm(this.layer.renderer);return e&&null!=e.scaleFactor?e.scaleFactor:1},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"useRealWorldSymbolSizes",{get:function(){var e=j.getFixedSizeAlgorithm(this.layer.renderer);return!(!e||null==e.useRealWorldSymbolSizes)&&e.useRealWorldSymbolSizes},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"pointSize",{get:function(){var e=j.getFixedSizeAlgorithm(this.layer.renderer);return e&&null!=e.size?e.size:0},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"inverseDensity",{get:function(){return this.layer.renderer?96/this.layer.renderer.pointsPerInch:5},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"_clippingBox",{get:function(){var e=v.create(),t=this.view.renderSpatialReference;return N.extentToBoundingBox(this.view.clippingArea,e,t)?e:null},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"_elevationOffset",{get:function(){var e=this.layer.elevationInfo;if(e&&"absolute-height"===e.mode){var t=m.getMetersPerVerticalUnitForSR(this.layer.spatialReference),r=b.getMetersPerUnit(e.unit);return(e.offset||0)*r/t}return 0},enumerable:!0,configurable:!0}),d.prototype.initialize=function(){var t=this;S.checkPointCloudLayerValid(this.layer),S.checkPointCloudLayerCompatibleWithView(this.layer,this.view),this._initRenderer();var r=this._initNodePages(),n={idleBegin:function(){return t._idleBegin()},idleEnd:function(){return t._idleEnd()}};g.open(p.getAbsMid("./PointCloudWorker",e,E),{client:this}).then(function(e){t.destroyed?e.close():t._workerThread=e}),this._memCache=this.view.resourceController.getMemCache(this.layer.uid),this._handles.add(h.init(this,"_clippingBox",function(){return t._setUpdateViewNeeded()})),this._handles.add(h.init(this,"_elevationOffset",function(){return t._elevationOffsetChanged()})),this._handles.add(h.init(this.layer,"renderer",function(){return t._rendererChanged()})),this._handles.add(h.init(this,"clippingArea",function(){t._setUpdateViewNeeded()})),this._handles.add(this.view.state.watch("camera",function(){t._setUpdateViewNeeded()})),this.view.resourceController.memoryEvents.on("quality-changed",function(){return t._setUpdateViewNeeded()}),this.addResolvingPromise(r),this.when(function(){t._handles.add(t.view.resourceController.registerFrameWorker(function(e){return t._process(e)})),t._handles.add(t.view.resourceController.registerIdleFrameWorker(n)),t._handles.add(h.init(t,"suspended",function(e){e?t._clearNodeState():t._setUpdateViewNeeded()}))})},d.prototype._setUpdateViewNeeded=function(){this._updateViewNeeded=!0,this._updateLoading()},d.prototype.destroy=function(){this._cancelNodeLoading(),this._workerThread&&(this._workerThread.close(),this._workerThread=null),this._handles.destroy(),this._destroyRenderer(),this._memCache.destroy(),this._memCache=null},d.prototype._initRenderer=function(){var e=this;this._renderer=new k,this._renderer.layerUid=this.layer.uid,this._handles.add(h.init(this,"_clippingBox",function(t){e._renderer.clippingBox=t})),this._handles.add(h.init(this,"_clippingBox",function(t){e._renderer.clippingBox=t})),this._handles.add(h.init(this,"suspended",function(t){return e._setPointsVisible(!t)})),this._handles.add(h.init(this,"pointScale",function(t){e._renderer.scaleFactor=t})),this._renderer.minSizePx=Math.sqrt(2),this._handles.add(h.init(this,"useRealWorldSymbolSizes",function(t){e._renderer.useRealWorldSymbolSizes=t})),this._handles.add(h.init(this,"pointSize",function(t){var r=f.pt2px(t);e._renderer.size=t,e._renderer.sizePx=r})),this._handles.add(h.init(this,"slicePlaneEnabled",function(t){e._renderer.slicePlaneEnabled=t})),this._handles.add(h.init(this,["inverseDensity","maximumPointCount"],function(){e._setUpdateViewNeeded()})),this._handles.add(h.init(this.view,"qualitySettings.sceneService.pointCloud.lodFactor",function(t){e._lodFactor=t,e._setUpdateViewNeeded()}))},d.prototype._destroyRenderer=function(){this._setPointsVisible(!1)},d.prototype._setPointsVisible=function(e){e&&!this._rendererAdded?(this.view._stage.addRenderPlugin([R.OPAQUE_EXTERNAL],this._renderer),this._rendererAdded=!0):!e&&this._rendererAdded&&(this.view._stage.removeRenderPlugin(this._renderer),this._rendererAdded=!1)},d.prototype._rendererChanged=function(){this._clearNodeState(),this._memCache.clear(),this._renderer.useFixedSizes=j.rendererUsesFixedSizes(this.layer.renderer),this._setUpdateViewNeeded()},d.prototype._elevationOffsetChanged=function(){this._clearNodeState(),this._memCache.clear(),this._initNodePages()},d.prototype.displayNodes=function(e){this._workQueue=P.nodeDiff(u.keysOfSet(this._renderedNodes),e,this._index),P.sortFrontToBack(this._workQueue,this.view.state.camera.viewForward,this._index),P.splitWorkEntries(this._workQueue,8,this._index),this._updateQueues(),this._totalWork=this._computeWork(),this._updateLoading(),this._layerIsVisible=e.length>0||this._loadingInitNodePage,this.notifyChange("suspended")},d.prototype.cancelLoading=function(){this._cancelNodeLoading(),this._cancelIndexLoading()},d.prototype._cancelNodeLoading=function(){var e=[];this._loadingNodes.forEach(function(t){return e.push(t)}),this._loadingNodes.clear();for(var t=0,r=e;t<r.length;t++)r[t].cancel();this._workQueue=[],this._idleQueue.cancelAll(),this._totalWork=this._computeWork(),this._updateLoading()},d.prototype._updateQueues=function(){var e=this,t=new Set;this._workQueue.forEach(function(e){e.load.forEach(function(e){t.add(e)})});var r=[],n=new Map;this._loadingNodes.forEach(function(e,o){t.has(o)?n.set(o,e):r.push(e)}),this._loadingNodes=n;for(var o=0,i=r;o<i.length;o++)i[o].cancel();this._workQueue=this._workQueue.filter(function(t){for(var r=0,n=t.load;r<n.length;r++){var o=n[r];if(e._loadingNodes.has(o))return!1}return!0}),this._totalWork=this._computeWork(),this._updateLoading()},d.prototype._cancelIndexLoading=function(){this._indexQueue=[],this._indexPagesLoading.forEach(function(e){return e.cancel()}),this._indexPagesLoading.clear(),this._totalWork=this._computeWork(),this._updateLoading()},d.prototype._clearNodeState=function(){var e=this;this._renderedNodes.forEach(function(t){return e._removeFromRenderer(t)}),this._cancelNodeLoading()},d.prototype._idleBegin=function(){this._setUpdateViewNeeded()},d.prototype._idleEnd=function(){this._setUpdateViewNeeded()},d.prototype._process=function(e){if(this.suspended){if(this._updateViewNeeded){this._updateViewNeeded=!1;var t=this._isRootNodeVisible();t!==this._layerIsVisible&&(this._layerIsVisible=t,this.notifyChange("suspended"))}}else{for(this._updateViewNeeded&&!e.done()&&this._updateWorkQueues();this._indexQueue.length>0&&!e.done();)this._processIndexQueue();for(this._processWorkQueue(e);this._idleQueue.length()>0&&!e.done();)this._idleQueue.process()}},d.prototype._processIndexQueue=function(){var e=this,t=this._indexQueue.shift();this._indexPagesLoading.set(t,this._loadNodePage(t)),this._indexPagesLoading.get(t).then(function(r){e._index.addPage(t,r,e._elevationOffset),e._setUpdateViewNeeded()}).always(function(){e._indexPagesLoading.delete(t)})},d.prototype._processWorkQueue=function(e){for(;!e.done();){var t=this._scheduleWorkEntry();if(!t)return;this._processWorkEntry(t)}},d.prototype._scheduleWorkEntry=function(){var e=this;if(this._loadingNodes.size>=8)return null;for(var t=0;t<this._workQueue.length;++t){var r=this._workQueue[t];if(!a.find(r.remove,function(t){return!e._renderedNodes.has(t)})){for(var n=t;n>0;--n)this._workQueue[n]=this._workQueue[n-1];return this._workQueue.shift(),r}}return null},d.prototype._processWorkEntry=function(e){var t=this;if(0!==e.load.length)i(e.load.map(function(e){var r=t._memCache.pop(e.toString());return r?t._loadingNodes.set(e,c.resolve(r)):t._loadingNodes.has(e)||t._loadingNodes.set(e,t.loadNode(e)),t._loadingNodes.get(e)})).then(function(r){for(var n=0;n<e.load.length;n++)if(r[n]){var o=t._setupRendererData(e.load[n],r[n]);t._addToRenderer(o)}for(n=0;n<e.remove.length;n++)t._removeFromRenderer(e.remove[n])}).always(function(){for(var r=0;r<e.load.length;r++)t._loadingNodes.delete(e.load[r]);t._updateLoading()}),this._updateLoading();else for(var r=0;r<e.remove.length;r++)this._removeFromRenderer(e.remove[r])},d.prototype._computeWork=function(){for(var e=0,t=0;t<this._workQueue.length;t++)e+=this._workQueue[t].load.length;return e+=this._loadingNodes.size,e+=(this._indexQueue.length+this._indexPagesLoading.size)*this._index.pageSize,(e+=this._loadingInitNodePage?100:0)+(this._updateViewNeeded?100:0)},Object.defineProperty(d.prototype,"updatingPercentageValue",{get:function(){var e=this._computeWork();return 100*Math.min(this._totalWork,e)/this._totalWork},enumerable:!0,configurable:!0}),d.prototype._updateLoading=function(){this.notifyChange("updating"),this.notifyChange("updatingPercentageValue")},d.prototype.canResume=function(){return this.inherited(arguments)&&this._layerIsVisible},d.prototype.isUpdating=function(){return this._computeWork()>0},d.prototype._initNodePages=function(){var e=this,t=this.layer.store.index,r=t.nodesPerPage||t.nodePerIndexBlock;return this._index=new I(this.layer.spatialReference,this.view.renderCoordsHelper.spatialReference,r),this._cancelIndexLoading(),this._traverseVisible=this._index.createVisibilityTraverse(),this._loadingInitNodePage=!0,this._layerIsVisible=!0,this.notifyChange("suspended"),this._updateLoading(),this._pageMultiplier=null!=t.nodesPerPage?1:t.nodePerIndexBlock,this._loadNodePage(0).then(function(t){e._index.addPage(0,t,e._elevationOffset),e._loadingInitNodePage=!1,e._setUpdateViewNeeded()})},d.prototype._loadNodePage=function(e){var t=this,r=this.baseUrl+"/nodepages/"+e*this._pageMultiplier;return this._requestJSON(r).then(function(r){return r.data.nodes.map(function(r,n){return{resourceId:null!=r.resourceId?r.resourceId:e*t._index.pageSize+n,obb:r.obb,firstChild:r.firstChild,childCount:r.childCount,vertexCount:null!=r.vertexCount?r.vertexCount:r.pointCount,lodThreshold:null!=r.lodThreshold?r.lodThreshold:r.effectiveArea}})})},d.prototype._updateWorkQueues=function(){for(var e=this.inverseDensity/this._lodFactor*this._getLodMemoryFactor(),t=this.maximumPointCount*this._lodFactor*this._getLodMemoryFactor(),r=this._computeNodesForMinimumDensity(e),n=this._computePointCount(r),o=Math.sqrt(n/(.75*t));n>t;)e*=o,r=this._computeNodesForMinimumDensity(e),n=this._computePointCount(r),o=Math.sqrt(2);this.displayNodes(r),this._updateViewNeeded=!1,this._updateLoading()},d.prototype._computePointCount=function(e){for(var t=0,r=0;r<e.length;r++){var n=this._index.getNode(e[r]);n&&(t+=n.vertexCount)}return t},d.prototype._getLodMemoryFactor=function(){return this.view.resourceController.memoryFactor},d.prototype._isRootNodeVisible=function(){var e=!1;return this._traverseVisible({frustumPlanes:this.view.state.camera.frustumPlanes,clippingBox:this._clippingBox},{predicate:function(t,r,n){return e=n,!1},pageMiss:function(e,t){}}),e},d.prototype._computeNodesForMinimumDensity=function(e){var t=this,r=this.view.state.camera,n=r.frustumPlanes,o=this._clippingBox,i=r.viewForward,s=C.vec3d.dot(i,r.eye),a=M.plane.fromNormalAndOffset(i,-s,F),u=r.perPixelRatio,l=e*e,d=this._nodeIdArray;return d.length=0,this._traverseVisible({frustumPlanes:n,clippingBox:o},{predicate:function(e,r,n){if(!n)return!1;if(0===r.childCount)return d.push(e),!1;var o=t._index.getRenderObb(e);return!(t._computeAveragePixelArea(o,r.lodThreshold,r.vertexCount,a,u)<=l&&(d.push(e),1))},pageMiss:function(e,r){d.push(e),t._indexQueue.indexOf(r)<0&&t._indexQueue.push(r)}}),d},d.prototype._computeAveragePixelArea=function(e,t,r,n,o){var i=Math.max(1e-7,T.minimumDistancePlane(e,n));return t/(i*i)/(4*o*o)/r},d.prototype.loadNode=function(e){var t=this,r=this._index.getNode(e),n=j.getRendererInfo(this.layer),s=[];return this._idleQueue.push().then(function(){var e=r.resourceId,o=t.loadGeometry(e),a=t.loadAttribute(e,n.primaryAttribute),u=t.loadAttribute(e,n.modulationAttribute);return i(s=[o,a,u])}).then(function(r){var o=r[0],i=r[1],s=r[2],a=[o];i&&a.push(i),s&&a.push(s);var u={geometryBuffer:o,primaryAttribute:i,modulationAttribute:s,schema:t.layer.store.defaultGeometrySchema,rendererInfo:n,obb:t._index.getRenderObb(e),elevationOffset:t._elevationOffset,inSR:t.layer.spatialReference.toJSON(),outSR:t.view.renderCoordsHelper.spatialReference.toJSON()};return t._workerThread?t._workerThread.invoke("process",u,a):c.resolve(t._worker.transform(u))}).catch(function(e){if(e instanceof o)for(var t=0,r=s;t<r.length;t++){r[t].cancel()}else console.error(e);return c.reject(e)})},d.prototype.loadGeometry=function(e){var t=this.baseUrl+"/nodes/"+e+"/geometries/0";return this._requestBinary(t).then(function(e){return e.data})},d.prototype.loadAttribute=function(e,t){if(!t||!t.storageInfo)return c.resolve(null);var r=t.storageInfo.key,n=this.baseUrl+"/nodes/"+e+"/attributes/"+r;return this._requestBinary(n).then(function(e){return e.data})},d.prototype._requestJSON=function(e){return s(e,{query:{f:"json"},responseType:"json"})},d.prototype._requestBinary=function(e){return s(e,{responseType:"array-buffer"})},d.prototype._removeFromRenderer=function(e){if(this._renderedNodes.has(e)){var t=this._renderer.removeNode(e);this._renderedNodes.delete(e),this._memCache.put(t.id.toString(),t,function(e){return 5*e.coordinates.length+128}(t))}},d.prototype._addToRenderer=function(e){this._renderedNodes.has(e.id)||(this._renderedNodes.add(e.id),this._renderer.addNode(e))},d.prototype._setupRendererData=function(e,t){var r=this._index.getNode(e),n=Math.sqrt(r.lodThreshold/r.vertexCount),o=this._index.getRenderObb(e);return k.isInstanceOfNode(t)?(t.splatSize=n,t.obb=o,t.origin=C.vec3.create(t.obb.center),t):((t.obb.halfSize[0]>o.halfSize[0]||t.obb.halfSize[1]>o.halfSize[1]||t.obb.halfSize[2]>o.halfSize[2])&&(this._maxLoggedBoxWarnings>0&&(U.warn("Node",e,"reported bounding box too small, got",o,"but points cover",t.obb),0==--this._maxLoggedBoxWarnings&&U.warn("  Too many bounding box errors, stopping reporting for this layer.")),this._index.setRenderObb(e,t.obb)),{id:e,coordinates:t.points,origin:C.vec3.create(o.center),rgb:new Uint8Array(t.rgb),splatSize:n,obb:o,isLeaf:0===r.childCount})},d.prototype.getUsedMemory=function(){var e=this;return u.keysOfSet(this._renderedNodes).reduce(function(t,r){return t+15*e._index.getNode(r).vertexCount+128},0)},d.prototype.getUnloadedMemory=function(){var e=this,t=this._renderedNodes.size;if(t<4)return 0;for(var r=u.keysOfSet(this._renderedNodes).reduce(function(t,r){return t+e._index.getNode(r).vertexCount}),n=this._loadingNodes.size,o=0;o<this._workQueue.length;o++)n+=this._workQueue[o].load.length,n-=this._workQueue[o].remove.length;return n<0?0:n*r/t*15+128*n},d.prototype.getStats=function(){var e=this;return{"Rendered Nodes":this._renderedNodes.size,"Rendered Points":u.keysOfSet(this._renderedNodes).reduce(function(t,r){return t+e._index.getNode(r).vertexCount},0),"Loading Nodes":this._loadingNodes.size,"Index Queue":this._indexQueue.length,"Work Queue":this._workQueue.length,"Idle Queue":this._idleQueue.length()}},n([y.property()],d.prototype,"layer",void 0),n([y.property({readOnly:!0,aliasOf:"layer.parsedUrl.path"})],d.prototype,"baseUrl",void 0),n([y.property({readOnly:!0,dependsOn:["layer.renderer"]})],d.prototype,"pointScale",null),n([y.property({readOnly:!0,dependsOn:["layer.renderer"]})],d.prototype,"useRealWorldSymbolSizes",null),n([y.property({readOnly:!0,dependsOn:["layer.renderer"]})],d.prototype,"pointSize",null),n([y.property({readOnly:!0,dependsOn:["layer.renderer"]})],d.prototype,"inverseDensity",null),n([y.property()],d.prototype,"maximumPointCount",void 0),n([y.property({readOnly:!0,dependsOn:["view.clippingArea"]})],d.prototype,"_clippingBox",null),n([y.property({readOnly:!0,dependsOn:["layer.elevationInfo"]})],d.prototype,"_elevationOffset",null),n([y.property({type:Boolean})],d.prototype,"slicePlaneEnabled",void 0),n([y.property(O.updatingPercentage)],d.prototype,"updatingPercentage",void 0),n([y.property({readOnly:!0})],d.prototype,"updatingPercentageValue",null),n([y.subclass("esri.views.3d.layers.PointCloudLayerView3D")],d)}(y.declared(_))}.apply(null,n))||(e.exports=o)},2403:function(e,t,r){var n,o;n=[r.dj.c(e.i),t,r(342)],void 0===(o=function(e,t,r){function n(e,t,r){for(var n=e;n>0;){var o=t.indexOf(n);if(o>=0)return o;n=r.getParentId(n)}return t.indexOf(n)}function o(e,t){for(var r=[e.remove[0]],n=[];1===r.length;){var o=r.pop();n.length=0;for(var i=0;i<e.load.length;i++){for(var s=e.load[i],a=t.getParentId(s);a!==o;)s=a,a=t.getParentId(s);var u=r.indexOf(s);u<0&&(u=r.length,r.push(s),n.push([])),n[u].push(e.load[i])}}var l=[];l.push({remove:e.remove,load:r});for(i=0;i<r.length;i++)n[i].length>1?l.push({remove:[r[i]],load:n[i]}):r[i]=n[i][0];return l}Object.defineProperty(t,"__esModule",{value:!0}),t.nodeDiff=function(e,t,r){for(var o=0;o<t.length;o++)a[o]=!1,u[o]=null;for(o=0;o<e.length;o++)i[o]=!1,s[o]=null;for(o=0;o<t.length;o++)(l=n(t[o],e,r))>=0&&(a[o]=!0,null!=s[l]?s[l].push(t[o]):s[l]=[t[o]]);for(o=0;o<e.length;o++){var l;(l=n(e[o],t,r))>=0&&(i[o]=!0,null!=u[l]?u[l].push(e[o]):u[l]=[e[o]])}var d=[];for(o=0;o<e.length;o++)null!=s[o]||i[o]||d.push({load:[],remove:[e[o]]});for(o=0;o<t.length;o++)null!=u[o]||a[o]||d.push({load:[t[o]],remove:[]});for(o=0;o<t.length;o++)null!=u[o]&&(u[o].length>1||u[o][0]!==t[o])&&d.push({load:[t[o]],remove:u[o]});for(o=0;o<e.length;o++)null!=s[o]&&(s[o].length>1||s[o][0]!==e[o])&&d.push({load:s[o],remove:[e[o]]});return d};var i=[!1],s=[null],a=[!1],u=[null];t.sortFrontToBack=function(e,t,n){return e.sort(function(e,o){if(0===e.load.length&&0===o.load.length)return 0;if(0===e.load.length)return-1;if(0===o.load.length)return 1;if(0===e.remove.length&&0===o.remove.length){var i=n.getRenderCenter(e.load[0]),s=n.getRenderCenter(o.load[0]);return r.vec3d.dot(i,t)-r.vec3d.dot(s,t)}return 0===e.remove.length?-1:0===o.remove.length?1:1===e.load.length&&1===o.load.length?(i=n.getRenderCenter(e.load[0]),s=n.getRenderCenter(o.load[0]),r.vec3d.dot(i,t)-r.vec3d.dot(s,t)):1===e.load.length?-1:1===o.load.length?1:(i=n.getRenderCenter(e.remove[0]),s=n.getRenderCenter(o.remove[0]),r.vec3d.dot(i,t)-r.vec3d.dot(s,t))})},t.splitWorkEntries=function(e,t,r){for(var n=0;n<e.length;++n){var i=e[n];if(i.load.length>t&&1===i.remove.length){var s=o(i,r);e[n]=s[0];for(var a=1;a<s.length;a++)e.push(s[a])}}},t.splitWorkEntry=o}.apply(null,n))||(e.exports=o)},2404:function(e,t,r){var n,o;n=[r.dj.c(e.i),t,r(384),r(342),r(762),r(387)],void 0===(o=function(e,t,r,n,o,i){function s(e,t,n){var i=e.index;if(i.hasNodes(0,1)){var s=e.queue;s.length=0,s.push(0);var a=e.masks;for(a.length=0,a.push(0);s.length>0;){var l=s.pop(),d=a.pop(),c=i.getNode(l),p=i.getRenderObb(l),f=!0;if(null!=t.clippingBox)if(0==(d&(y=1<<t.frustumPlanes.length))){var h=o.toAaBoundingBox(p,e.tempAabb);r.contains(t.clippingBox,h)?d|=y:r.intersects(t.clippingBox,h)||(f=!1)}for(var g=0;g<t.frustumPlanes.length&&f;g++){var y;if(0==(d&(y=1<<g))){var v=o.intersectPlane(p,t.frustumPlanes[g]);v>0?f=!1:v<0&&(d|=y)}}if(n.predicate(l,c,f)){for(var m=c.firstChild,b=c.childCount,_=!1,w=u(m,i.pageSize),S=u(m+b-1,i.pageSize),x=w;x<=S;x++)if(!i.hasPage(x)){n.pageMiss(l,x),_=!0;break}if(!_)for(g=0;g<b;g++)s.push(m+g),a.push(d)}}}}function a(e,t,r,s){for(var a=new o.ObbArray(e.length),u=0;u<e.length;u++){var l=e[u].obb,c=a.obbs[u];if(o.set(l,c),n.vec3d.set3(l.center[0],l.center[1],l.center[2]+s,d),!t.isGeographic&&r===i.SphericalECEFSpatialReference){i.computeLinearTransformation(t,d,p,r);var h=2*Math.sqrt(1+p[0]+p[5]+p[10]);f[0]=(p[9]-p[6])/h,f[1]=(p[2]-p[8])/h,f[2]=(p[4]-p[1])/h,f[3]=.25*h,n.quat4.conjugate(f),n.quat4.multiply(f,c.quaternion,c.quaternion)}i.bufferToBuffer(d,t,0,c.center,r,0,1)}return a.obbs}function u(e,t){return e/t|0}function l(e,t){return e%t}var d=n.vec3d.create(),c=function(){function e(e,t,r){this._pages=[],this.pageSize=0,this._nodeSR=null,this._renderSR=null,this._nodeSR=e,this._renderSR=t,this.pageSize=r}return e.prototype.addPage=function(e,t,r){for(void 0===r&&(r=0);this._pages.length<e;)this._pages.push(null);var n=a(t,this._nodeSR,this._renderSR,r);this._pages[e]={nodes:t,renderObbs:n,parents:new Uint32Array(this.pageSize)},function(e,t){for(var r=[0];r.length;)for(var n=r.pop(),o=e[u(n,t)].nodes[l(n,t)],i=0;i<o.childCount;i++){var s=o.firstChild+i;null!=e[u(s,t)]&&(e[u(s,t)].parents[l(s,t)]=n,r.push(s))}}(this._pages,this.pageSize)},e.prototype.hasPage=function(e){return!!this._pages[e]},e.prototype.getNode=function(e){var t=this.pageSize;return this._pages[u(e,t)].nodes[l(e,t)]},e.prototype.getRenderObb=function(e){var t=this.pageSize;return this._pages[u(e,t)].renderObbs[l(e,t)]},e.prototype.getRenderCenter=function(e){return this.getRenderObb(e).center},e.prototype.setRenderObb=function(e,t){var r=this.pageSize;o.set(t,this._pages[u(e,r)].renderObbs[l(e,r)])},e.prototype.getParentId=function(e){var t=this.pageSize;return this._pages[u(e,t)].parents[l(e,t)]},e.prototype.hasNodes=function(e,t){for(var r=u(e,this.pageSize),n=u(e+t-1,this.pageSize),o=r;o<=n;o++)if(null==this._pages[o])return!1;return!0},e.prototype.createVisibilityTraverse=function(){var e={index:this,queue:[],masks:[],tempAabb:r.create()};return function(t,r){return s(e,t,r)}},e}(),p=n.mat4d.create(),f=n.quat4.create();return c}.apply(null,n))||(e.exports=o)},2405:function(e,t,r){var n,o;n=[r.dj.c(e.i),t,r(384),r(342),r(604),r(762),r(995),r(460),r(420),r(2406),r(382),r(376)],void 0===(o=function(e,t,r,n,o,i,s,a,u,l,d,c){function p(e){return e?256:64}function f(e,t,r,n,o){if(r.drawScreenSpace)return r.fixedSize*t*n;var i=p(o)*t*n;return r.drawFixedSize?Math.min(r.fixedSize/2,i):r.screenMinSize>0?Math.min(Math.max(r.screenMinSize*t*n,e/2),i):Math.min(e/2,i)}function h(e,t,r,n,o){return r.drawScreenSpace?0:f(e,t,r,n,o)}function g(e,t,r){return null==r&&(r=n.vec3d.create()),r[0]=e.origin[0]+e.coordinates[3*t],r[1]=e.origin[1]+e.coordinates[3*t+1],r[2]=e.origin[2]+e.coordinates[3*t+2],r}var y={positions:[{name:"aPosition",count:3,type:5126,offset:0,stride:12,normalized:!1}],colors:[{name:"aColor",count:3,type:5121,offset:0,stride:3,normalized:!0}]},v=function(){function e(){this.didRender=!1,this.needsRender=!0,this.layerUid="",this._useFixedSizes=!1,this._scaleFactor=1,this._minSizePx=0,this._useRealWorldSymbolSizes=!1,this._size=0,this._sizePx=0,this._slicePlaneEnabled=!1,this._clipBox=r.create(r.POSITIVE_INFINITY),this._programRep=null,this._needsPrograms=!0,this._programWorld=null,this._programScreen=null,this._programWorldDepth=null,this._programScreenDepth=null,this.tempMatrix4=n.mat4.create(),this.tempVec3=n.vec3.create(),this.nodes=[]}return e.prototype.initializeRenderContext=function(e){var t=e.rctx;this._programRep=new s(t),this.needsRender=!0,this._needsPrograms=!0},e.prototype.uninitializeRenderContext=function(e){this._programRep.dispose(),this._programRep=null,this._programWorld=null,this._programScreen=null,this._programWorldDepth=null,this._programScreenDepth=null},e.prototype.intersect=function(e,t,s,a){var u=n.vec3d.create(),l=n.vec3d.create(),d=n.vec3d.create(),c=n.vec3d.create(),p=o.plane.create(),y=e.camera.perPixelRatio,v=e.camera.near,m=this._getSizeParams();n.vec3d.subtract(s,t,l);var b=1/n.vec3d.length(l);n.vec3d.scale(l,b,l),n.vec3d.negate(l,d),n.vec4d.set4(l[0],l[1],l[2],-n.vec3d.dot(l,t),p);var _={},w={},S=r.create(),x=r.create(this._clipBox);r.offset(x,-t[0],-t[1],-t[2],x);for(var P=0,I=this.nodes;P<I.length;P++){var j=I[P],k=j.splatSize*this._scaleFactor,O=i.minimumDistancePlane(j.obb,p),C=i.maximumDistancePlane(j.obb,p);O-=h(k,O+v,m,y,j.isLeaf);var M=(C-=h(k,C+v,m,y,j.isLeaf))<0,T=null!=_.dist&&null!=w.dist&&_.dist<O*b&&w.dist>C*b;if(!M&&!T){var N=f(k,C+v,m,y,j.isLeaf);if(i.intersectLine(j.obb,t,l,N)){var R=N*N;i.toAaBoundingBox(j.obb,S),r.offset(S,-t[0],-t[1],-t[2],S);var E=!r.contains(x,S);n.vec3d.subtract(j.origin,t,c);for(var U=j.coordinates.length/3,F=0;F<U;F++)if(u[0]=c[0]+j.coordinates[3*F],u[1]=c[1]+j.coordinates[3*F+1],u[2]=c[2]+j.coordinates[3*F+2],!E||r.containsPoint(x,u)){var L=n.vec3d.dot(u,l),z=L+v,A=h(k,z,m,y,j.isLeaf);if(!(L-A<0)){var D=n.vec3d.length2(u)-L*L;if(!(D>R)){var V=f(k,z-=A,m,y,j.isLeaf);if(!(D>V*V)){var q=this.layerUid+"/"+j.id+"/"+F,B=(L-A)*b;(null==_.dist||B<_.dist)&&(_.point=g(j,F,_.point),_.dist=B,_.normal=d,_.pointId=q,_.layerUid=this.layerUid),(null==w.dist||B>w.dist)&&(w.point=g(j,F,w.point),w.dist=B,w.normal=d,w.pointId=q,w.layerUid=this.layerUid)}}}}}}}if(null!=_.dist){var J=e.minResult;if(null==J.dist||_.dist<J.dist){var Q={type:"external",point:_.point,metadata:{pointId:_.pointId,layerUid:_.layerUid}};J.set(Q,_.pointId,_.dist,_.normal,void 0),J.setIntersector("PointRenderer")}}if(null!=w.dist){var G=e.maxResult;if(null==G.dist||w.dist>G.dist){Q={type:"external",point:w.point,metadata:{pointId:w.pointId,layerUid:w.layerUid}};G.set(Q,w.pointId,w.dist,w.normal,void 0),G.setIntersector("PointRenderer")}}},e.prototype.render=function(e){if(e.pass!==a.MATERIAL&&e.pass!==a.MATERIAL_DEPTH)return!1;for(var t=e.pass===a.MATERIAL_DEPTH,o=e.rctx,i=0,s=this.nodes;i<s.length;i++){null==(m=s[i]).vao&&this._initNode(e,m)}this._selectPrograms();var l=this._getSizeParams(),d=t?l.drawScreenSpace?this._programScreenDepth:this._programWorldDepth:l.drawScreenSpace?this._programScreen:this._programWorld;if(null==d||0===this.nodes.length)return!0;var c=this._clipBox,f=!r.equals(c,r.POSITIVE_INFINITY,function(e,t){return e===t});f||(n.vec3.set3(-1/0,-1/0,-1/0,this.tempVec3),d.setUniform3fv("uClipMin",this.tempVec3),n.vec3.set3(1/0,1/0,1/0,this.tempVec3),d.setUniform3fv("uClipMax",this.tempVec3)),o.setDepthTestEnabled(!0),o.bindProgram(d);var h=e.camera.projectionMatrix;d.setUniformMatrix4fv("uProjectionMatrix",h),t&&d.setUniform2f("nearFar",e.camera.near,e.camera.far),l.drawFixedSize&&d.setUniform2f("uPointScale",l.fixedSize,e.camera.fullHeight);for(var g=this._slicePlaneEnabled?e.sliceHelper&&e.sliceHelper.plane:null,y=0,v=this.nodes;y<v.length;y++){var m=v[y];if(d.setUniform2f("uScreenMinMaxSize",l.screenMinSize,p(m.isLeaf)),!l.drawFixedSize){var b=m.splatSize*this._scaleFactor;d.setUniform2f("uPointScale",b,e.camera.fullHeight)}var _=m.origin;f&&(n.vec3.set3(c[0]-_[0],c[1]-_[1],c[2]-_[2],this.tempVec3),d.setUniform3fv("uClipMin",this.tempVec3),n.vec3.set3(c[3]-_[0],c[4]-_[1],c[5]-_[2],this.tempVec3),d.setUniform3fv("uClipMax",this.tempVec3)),n.mat4.identity(this.tempMatrix4),n.mat4.translate(this.tempMatrix4,_,this.tempMatrix4),n.mat4.multiply(e.camera.viewMatrix,this.tempMatrix4,this.tempMatrix4),d.setUniformMatrix4fv("uModelViewMatrix",this.tempMatrix4),g&&u.bindSlicePlane(_,g,d),o.bindVAO(m.vao),o.drawArrays(0,0,m.coordinates.length/3)}return!0},Object.defineProperty(e.prototype,"useFixedSizes",{get:function(){return this._useFixedSizes},set:function(e){this._useFixedSizes!==e&&(this._useFixedSizes=e,this._requestRender())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleFactor",{get:function(){return this._scaleFactor},set:function(e){this._scaleFactor!==e&&(this._scaleFactor=e,this._requestRender())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minSizePx",{get:function(){return this._minSizePx},set:function(e){this._minSizePx!==e&&(this._minSizePx=e,this._requestRender())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useRealWorldSymbolSizes",{get:function(){return this._useRealWorldSymbolSizes},set:function(e){this._useRealWorldSymbolSizes!==e&&(this._useRealWorldSymbolSizes=e,this._requestRender())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},set:function(e){this._size!==e&&(this._size=e,this._requestRender())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sizePx",{get:function(){return this._sizePx},set:function(e){this._sizePx!==e&&(this._sizePx=e,this._requestRender())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"clippingBox",{set:function(e){r.set(this._clipBox,e||r.POSITIVE_INFINITY)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"slicePlaneEnabled",{set:function(e){this._slicePlaneEnabled!==e&&(this._slicePlaneEnabled=e,this._requestRender(),this._needsPrograms=!0)},enumerable:!0,configurable:!0}),e.prototype.addNode=function(e){this.nodes.push(e),this._requestRender()},e.prototype.removeNode=function(e){var t=null;return this.nodes=this.nodes.filter(function(r){return r.id!==e||(t=r,r.vao&&(r.vao.dispose(!0),r.vao=null),!1)}),this._requestRender(),t},e.prototype.removeAll=function(){this.nodes.forEach(function(e){e.vao&&(e.vao.dispose(!0),e.vao=null)}),this.nodes=[],this._requestRender()},e.prototype._initNode=function(e,t){var r=e.rctx;t.vao=new c(r,l.program.attributes,y,{positions:d.createVertex(r,35044,t.coordinates),colors:d.createVertex(r,35044,t.rgb)})},e.prototype._requestRender=function(){this.didRender=!1,this.needsRender=!0},e.prototype._getSizeParams=function(){var e=this._useFixedSizes,t=e&&!this._useRealWorldSymbolSizes,r=t?this._sizePx:this._size,n=this._minSizePx;return e&&(n=0),{drawScreenSpace:t,drawFixedSize:e,fixedSize:r,screenMinSize:n}},e.prototype._selectPrograms=function(){this._needsPrograms&&(this._needsPrograms=!1,this._programWorld=this._programRep.getProgram(l.program,{slicePlaneEnabled:this._slicePlaneEnabled}),this._programScreen=this._programRep.getProgram(l.program,{drawScreenSize:!0,slicePlaneEnabled:this._slicePlaneEnabled}),this._programWorldDepth=this._programRep.getProgram(l.program,{depthPass:!0,slicePlaneEnabled:this._slicePlaneEnabled}),this._programScreenDepth=this._programRep.getProgram(l.program,{drawScreenSize:!0,depthPass:!0,slicePlaneEnabled:this._slicePlaneEnabled}))},e}();return function(e){(v||(v={})).isInstanceOfNode=function(e){return e.hasOwnProperty("splatSize")}}(),v}.apply(null,n))||(e.exports=o)},2406:function(e,t,r){var n,o;n=[r.dj.c(e.i),t,r(393),r(408)],void 0===(o=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){return n.glslifyDefineMap({DEPTH_PASS:e.depthPass,DRAW_SCREEN_SIZE:e.drawScreenSize,SLICE:e.slicePlaneEnabled})};t.program={name:"point-renderer",shaders:function(e){return{vertexShader:o(e)+r.resolveIncludes("pointRenderer/pointRenderer.vert"),fragmentShader:o(e)+r.resolveIncludes("pointRenderer/pointRenderer.frag")}},attributes:{aPosition:0,aColor:1}}}.apply(null,n))||(e.exports=o)},354:function(e,t,r){var n,o;n=[r.dj.c(e.i),t],void 0===(o=function(e,t){function r(e){return e?72*e/t.DPI:0}Object.defineProperty(t,"__esModule",{value:!0});var n=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i,o="screenUtils.toPt: input not recognized!";t.DPI=96,t.pt2px=function(e){return e?e/72*t.DPI:0},t.px2pt=r,t.toPt=function(e){if("string"==typeof e){if(n.test(e)){var t=e.match(n),i=Number(t[1]),s=t[3]&&t[3].toLowerCase(),a="-"===e.charAt(0),u="px"===s?r(i):i;return a?-u:u}return console.warn(o),null}return e}}.apply(null,n))||(e.exports=o)},371:function(e,t,r){var n,o;n=[r(347),r(340),r(358)],void 0===(o=function(e,t,r){var n=e({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d"}),o=0;return t.createSubclass({declaredClass:"esri.symbols.Symbol",constructor:function(){this.id="sym"+o++},properties:{type:{type:String,value:null,json:{read:n.read,write:{ignoreOrigin:!0,writer:n.write}}},color:{type:r,value:new r([0,0,0,1]),json:{read:function(e){return e&&null!=e[0]?[e[0],e[1],e[2],e[3]/255]:e},write:{allowNull:!0}}}}})}.apply(null,n))||(e.exports=o)},378:function(e,t,r){var n,o;n=[r.dj.c(e.i),t,r(355)],void 0===(o=function(e,t,r){function n(e){return e&&"object"==typeof e&&("result"in e||"transferList"in e)}function o(e){return e instanceof ArrayBuffer||e&&e.constructor&&"ArrayBuffer"===e.constructor.name}Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.HANDSHAKE=0]="HANDSHAKE",e[e.CONFIGURE=1]="CONFIGURE",e[e.CONFIGURED=2]="CONFIGURED",e[e.OPEN=3]="OPEN",e[e.OPENED=4]="OPENED",e[e.RESPONSE=5]="RESPONSE",e[e.INVOKE=6]="INVOKE",e[e.CANCEL=7]="CANCEL",e[e.CLOSE=8]="CLOSE",e[e.OPEN_PORT=9]="OPEN_PORT"}(t.MessageType||(t.MessageType={}));var i=0;t.newJobId=function(){return i++},t.isTranferableResult=n,t.toInvokeError=function(e){return e?e.toJSON?JSON.stringify(e):JSON.stringify({name:e.name,message:e.message,details:e.details,stack:e.stack}):null},t.postMessage=function(e,t,i,s){2===arguments.length||void 0===i&&void 0===s?e.postMessage(t):(r("esri-workers-arraybuffer-transfer")||(s?(s=s.filter(function(e){return!o(e)})).length||(s=null):n(i)&&i.transferList&&(i.transferList=i.transferList.filter(function(e){return!o(e)}),i.transferList.length||(i.transferList=null))),s?(t.data=i,e.postMessage(t,s)):n(i)?(t.data=i.result,i.transferList?e.postMessage(t,i.transferList):e.postMessage(t)):(t.data=i,e.postMessage(t)))},t.receiveMessage=function(e){if(!e)return null;var t=e.data;return t?"string"==typeof t?JSON.parse(t):t:null}}.apply(null,n))||(e.exports=o)},389:function(e,t,r){var n,o;n=[r.dj.c(e.i),t,r(341),r(339),r(378)],void 0===(o=function(e,t,r,n,o){function i(e,t){e.delete(t)}var s=o.MessageType.CLOSE,a=o.MessageType.CANCEL,u=o.MessageType.INVOKE,l=o.MessageType.RESPONSE,d=o.MessageType.OPEN_PORT,c=function(){function e(e){this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._invoke=e,this._timer=null,this._process=this._process.bind(this)}return e.prototype.push=function(e){e.type===o.MessageType.CANCEL?this._cancelledJobIds.add(e.jobId):(this._invokeMessages.push(e),null===this._timer&&(this._timer=setTimeout(this._process,0)))},e.prototype.clear=function(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null},e.prototype._process=function(){this._timer=null;for(var e=0,t=this._invokeMessages;e<t.length;e++){var r=t[e];this._cancelledJobIds.has(r.jobId)||this._invoke(r)}this._cancelledJobIds.clear(),this._invokeMessages.length=0},e}();return function(){function e(e,t,r){this._outJobs=new Map,this._inJobs=new Map,this._queue=new c(this._onInvoke.bind(this)),this._onMessage=this._onMessage.bind(this),this._client=t,this._port=e,this._port.addEventListener("message",this._onMessage),this._port.start(),this._channel=r}return e.connect=function(t){var r,n=new MessageChannel;return(r="function"==typeof t?new t:"default"in t&&"function"==typeof t.default?new t.default:t).remoteClient=new e(n.port1,r,n),n.port2},e.prototype.close=function(){this._post({type:s}),this._close()},e.prototype.isBusy=function(){return this._outJobs.size>0},e.prototype.invoke=function(e,t,s){var l=this;if(!this._port)return n.reject(new r("remote-client:port-closed","Can't invoke(), port is closed"));var d=o.newJobId(),c=function(){i(l._outJobs,d),l._post({type:a,jobId:d})};return n.create(function(r,n){var o={resolve:r,reject:n,cancel:c};l._outJobs.set(d,o),l._post({type:u,jobId:d,methodName:e},t,s)},c)},e.prototype.openPort=function(){var e=this,t=o.newJobId(),r=function(){i(e._outJobs,t),e._post({type:a,jobId:t})};return n.create(function(n,o){var i={resolve:n,reject:o,cancel:r};e._outJobs.set(t,i),e._post({type:d,jobId:t})},r)},e.prototype._close=function(){this._channel&&(this._channel=null),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach(function(e){e.cancel()}),this._inJobs.clear(),this._outJobs.clear(),this._queue.clear(),this._port=this._client=null},e.prototype._onMessage=function(e){var t=o.receiveMessage(e);if(t)switch(t.type){case l:this._onResponse(t);break;case u:this._queue.push(t);break;case a:this._onCancel(t);break;case s:this._close();break;case d:this._onOpenPort(t)}},e.prototype._onCancel=function(e){var t=this._inJobs,r=e.jobId,n=t.get(r);this._queue.push(e),n&&(i(t,r),n.cancel())},e.prototype._onInvoke=function(e){var t,r=this,s=e.methodName,a=e.jobId,u=e.data,d=this._inJobs,c=this._client,p=c[s];try{if(!p&&s&&-1!==s.indexOf("."))for(var f=s.split("."),h=0;h<f.length-1;h++)p=(c=c[f[h]])[f[h+1]];if("function"!=typeof p)throw new TypeError(s+" is not a function");t=p.call(c,u,this)}catch(e){return void this._post({type:l,jobId:a,error:o.toInvokeError(e)})}n.isThenable(t)?(d.set(a,t),t.then(function(e){d.has(a)&&(i(d,a),r._post({type:l,jobId:a},e))}).catch(function(e){d.has(a)&&(i(d,a),e&&"cancel"===e.dojoType||r._post({type:l,jobId:a,error:o.toInvokeError(e||{message:"Error encountered at method "+s})}))})):this._post({type:l,jobId:a},t)},e.prototype._onOpenPort=function(t){var r=new MessageChannel;new e(r.port1,this._client),this._post({type:l,jobId:t.jobId},r.port2,[r.port2])},e.prototype._onResponse=function(e){var t=e.jobId,n=e.error,o=e.data,s=this._outJobs;if(s.has(t)){var a=s.get(t);i(s,t),n?a.reject(r.fromJSON(JSON.parse(n))):a.resolve(o)}},e.prototype._post=function(e,t,r){return o.postMessage(this._port,e,t,r)},e}()}.apply(null,n))||(e.exports=o)},392:function(e,t,r){var n,o;n=[r(347),r(340),r(338),r(383),r(395),r(362),r(613),r(422)],void 0===(o=function(e,t,r,n,o,i,s,a){var u=e({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent"});return t.createSubclass({declaredClass:"esri.tasks.support.FeatureSet",getDefaults:function(){return r.mixin(this.inherited(arguments),{features:[]})},properties:{displayFieldName:null,exceededTransferLimit:null,features:{value:null,json:{read:function(e,t){for(var r=i.fromJSON(t.spatialReference),o=[],s=0;s<e.length;s++){var a=e[s],u=n.fromJSON(a),l=a.geometry&&a.geometry.spatialReference;u.geometry&&!l&&(u.geometry.spatialReference=r),o.push(u)}return t.transform&&this._hydrate(t.transform,t.geometryType,o),o}}},fields:{value:null,type:[o]},geometryType:{value:null,json:{read:u.read}},spatialReference:{type:i}},toJSON:function(e){var t={hasZ:this.hasZ,hasM:this.hasM};return this.displayFieldName&&(t.displayFieldName=this.displayFieldName),this.fields&&(t.fields=this.fields.map(function(e){return e.toJSON()})),this.spatialReference?t.spatialReference=this.spatialReference.toJSON():this.features[0]&&this.features[0].geometry&&(t.spatialReference=this.features[0].geometry.spatialReference.toJSON()),this.features[0]&&(this.features[0].geometry&&(t.geometryType=a.getJsonType(this.features[0].geometry)),t.features=s._encodeGraphics(this.features,e)),t.exceededTransferLimit=this.exceededTransferLimit,t.transform=this.transform,r.fixJson(t)},quantize:function(e){var t,r,n=e.translate[0],o=e.translate[1],i=e.scale[0],s=e.scale[1],a=this.features,u=function(e,t,r){var n,o,i,s,a,u,l,d=[];for(n=0,o=e.length;n<o;n++)i=e[n],n>0?(u=t(i[0]),l=r(i[1]),u===s&&l===a||(d.push([u-s,l-a]),s=u,a=l)):(s=t(i[0]),a=r(i[1]),d.push([s,a]));return d.length>0?d:null},l=function(e,t,r){return"point"===e?function(e){return e.x=t(e.x),e.y=r(e.y),e}:"polyline"===e||"polygon"===e?function(e){var n,o,i,s,a,l;for(l=[],n=0,o=(i=e.rings||e.paths).length;n<o;n++)s=i[n],(a=u(s,t,r))&&l.push(a);return l.length>0?(e.rings?e.rings=l:e.paths=l,e):null}:"multipoint"===e?function(e){var n;return(n=u(e.points,t,r)).length>0?(e.points=n,e):null}:"extent"===e?function(e){return e}:void 0}(this.geometryType,function(e){return Math.round((e-n)/i)},function(e){return Math.round((o-e)/s)});for(t=0,r=a.length;t<r;t++)l(a[t].geometry)||(a.splice(t,1),t--,r--);return this.transform=e,this},_hydrate:function(e,t,r){if(e){var n,o,i=e.translate[0],s=e.translate[1],a=e.scale[0],u=e.scale[1],l=function(e,t,r){return"esriGeometryPoint"===e?function(e){e.x=t(e.x),e.y=r(e.y)}:"esriGeometryPolyline"===e||"esriGeometryPolygon"===e?function(e){var n,o,i,s,a,u,l,d,c=e.rings||e.paths;for(n=0,o=c.length;n<o;n++)for(i=0,s=(a=c[n]).length;i<s;i++)u=a[i],i>0?(l+=u[0],d+=u[1]):(l=u[0],d=u[1]),u[0]=t(l),u[1]=r(d)}:"esriGeometryEnvelope"===e?function(e){e.xmin=t(e.xmin),e.ymin=r(e.ymin),e.xmax=t(e.xmax),e.ymax=r(e.ymax)}:"esriGeometryMultipoint"===e?function(e){var n,o,i,s,a,u=e.points;for(n=0,o=u.length;n<o;n++)i=u[n],n>0?(s+=i[0],a+=i[1]):(s=i[0],a=i[1]),i[0]=t(s),i[1]=r(a)}:void 0}(t,function(e){return e*a+i},function(e){return s-e*u});for(n=0,o=r.length;n<o;n++)r[n].geometry&&l(r[n].geometry)}}})}.apply(null,n))||(e.exports=o)},402:function(e,t,r){var n,o;n=[r(351),r(338),r(354),r(592)],void 0===(o=function(e,t,r,n){var o={STYLE_SOLID:"solid",STYLE_DASH:"dash",STYLE_DOT:"dot",STYLE_DASHDOT:"dash-dot",STYLE_DASHDOTDOT:"long-dash-dot-dot",STYLE_NULL:"none",STYLE_SHORTDASH:"short-dash",STYLE_SHORTDOT:"short-dot",STYLE_SHORTDASHDOT:"short-dash-dot",STYLE_SHORTDASHDOTDOT:"short-dash-dot-dot",STYLE_LONGDASH:"long-dash",STYLE_LONGDASHDOT:"long-dash-dot",CAP_BUTT:"butt",CAP_ROUND:"round",CAP_SQUARE:"square",JOIN_MITER:"miter",JOIN_ROUND:"round",JOIN_BEVEL:"bevel"},i={color:[0,0,0,1],style:o.STYLE_SOLID,width:.75,cap:o.CAP_ROUND,join:o.JOIN_ROUND,miterLimit:7.5},s=e(n,{declaredClass:"esri.symbols.SimpleLineSymbol",properties:{type:"simple-line",style:{value:o.STYLE_SOLID,json:{read:function(e,r){return t.valueOf(this._jsonStyles,e)||void 0},write:function(e,t){t.style=this._jsonStyles[e]}}},cap:{value:o.CAP_ROUND,json:{write:{overridePolicy:function(e,t,r){return{enabled:"round"!==e&&(null==r||null==r.origin)}}}}},join:{value:o.JOIN_ROUND,json:{write:{overridePolicy:function(e,t,r){return{enabled:"round"!==e&&(null==r||null==r.origin)}}}}},miterLimit:{value:7.5,cast:r.toPt,json:{read:!1,write:!1}}},_jsonStyles:{solid:"esriSLSSolid",dash:"esriSLSDash",dot:"esriSLSDot","dash-dot":"esriSLSDashDot","long-dash-dot-dot":"esriSLSDashDotDot",none:"esriSLSNull","inside-frame":"esriSLSInsideFrame","short-dash":"esriSLSShortDash","short-dot":"esriSLSShortDot","short-dash-dot":"esriSLSShortDashDot","short-dash-dot-dot":"esriSLSShortDashDotDot","long-dash":"esriSLSLongDash","long-dash-dot":"esriSLSLongDashDot"},getDefaults:function(){return t.mixin(this.inherited(arguments),i)},normalizeCtorArgs:function(e,t,n,o,i,s){if(e&&"string"!=typeof e)return e;var a={};return null!=e&&(a.style=e),null!=t&&(a.color=t),null!=n&&(a.width=r.toPt(n)),null!=o&&(a.cap=o),null!=i&&(a.join=i),null!=s&&(a.miterLimit=r.toPt(s)),a},clone:function(){return new s({color:t.clone(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit})}});return t.mixin(s,o),s.defaultProps=i,s}.apply(null,n))||(e.exports=o)},403:function(e,t,r){var n,o;n=[r.dj.c(e.i),t],void 0===(o=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.mapParameters=function e(t){var r={};for(var n in t)if("declaredClass"!==n){var o=t[n];if(null!=o&&"function"!=typeof o)if(Array.isArray(o)){r[n]=[];for(var i=0;i<o.length;i++)r[n][i]=e(o[i])}else"object"==typeof o?o.toJSON&&(r[n]=JSON.stringify(o)):r[n]=o}return r}}.apply(null,n))||(e.exports=o)},425:function(e,t,r){var n,o;n=[r.dj.c(e.i),t],void 0===(o=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1}}();t.default=r}.apply(null,n))||(e.exports=o)},437:function(e,t,r){var n,o;n=[r.dj.c(e.i),t,r(607)],void 0===(o=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}(r)}.apply(null,n))||(e.exports=o)},440:function(e,t,r){var n,o;n=[r.dj.c(e.i),t,r(337),r(335),r(340),r(338),r(336)],void 0===(o=function(e,t,r,n,o,i,s){return function(e){function t(t){var r=e.call(this,t)||this;return r.attachmentTypes=null,r.definitionExpression=null,r.globalIds=null,r.num=null,r.objectIds=null,r.size=null,r.start=null,r}var o;return r(t,e),o=t,t.prototype.writeStart=function(e,t,r){t.resultOffset=this.start,t.resultRecordCount=this.num||10},t.prototype.clone=function(){return new o(i.clone({attachmentTypes:this.attachmentTypes,definitionExpression:this.definitionExpression,globalIds:this.globalIds,num:this.num,objectIds:this.objectIds,size:this.size,start:this.start}))},n([s.property({type:[String],json:{write:!0}})],t.prototype,"attachmentTypes",void 0),n([s.property({type:String,json:{write:!0}})],t.prototype,"definitionExpression",void 0),n([s.property({type:[Number],json:{write:!0}})],t.prototype,"globalIds",void 0),n([s.property({type:Number,json:{read:{source:"resultRecordCount"}}})],t.prototype,"num",void 0),n([s.property({type:[Number],json:{write:!0}})],t.prototype,"objectIds",void 0),n([s.property({type:[Number],json:{write:!0}})],t.prototype,"size",void 0),n([s.property({type:Number,json:{read:{source:"resultOffset"}}})],t.prototype,"start",void 0),n([s.writer("start"),s.writer("num")],t.prototype,"writeStart",null),o=n([s.subclass("esri.tasks.support.AttachmentQuery")],t)}(s.declared(o))}.apply(null,n))||(e.exports=o)},444:function(e,t,r){var n,o;n=[r.dj.c(e.i),t,r(337),r(335),r(364),r(340),r(338),r(336)],void 0===(o=function(e,t,r,n,o,i,s,a){return function(e){function t(t){var r=e.call(this,t)||this;return r.definitionExpression=null,r.gdbVersion=null,r.geometryPrecision=void 0,r.historicMoment=null,r.maxAllowableOffset=void 0,r.objectIds=null,r.outFields=null,r.outSpatialReference=null,r.relationshipId=void 0,r.returnGeometry=!1,r.source=null,r}var i;return r(t,e),i=t,t.prototype._writeHistoricMoment=function(e,t){t.historicMoment=e&&e.getTime()},t.prototype.clone=function(){return new i(s.clone({definitionExpression:this.definitionExpression,gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&this.historicMoment.getTime(),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,returnGeometry:this.returnGeometry,source:this.source}))},n([a.property({type:String,json:{write:!0}})],t.prototype,"definitionExpression",void 0),n([a.property({type:String,json:{write:!0}})],t.prototype,"gdbVersion",void 0),n([a.property({type:Number,json:{write:!0}})],t.prototype,"geometryPrecision",void 0),n([a.property({type:Date})],t.prototype,"historicMoment",void 0),n([a.writer("historicMoment")],t.prototype,"_writeHistoricMoment",null),n([a.property({type:Number,json:{write:!0}})],t.prototype,"maxAllowableOffset",void 0),n([a.property({type:[Number],json:{write:!0}})],t.prototype,"objectIds",void 0),n([a.property({type:[String],json:{write:!0}})],t.prototype,"outFields",void 0),n([a.property({type:o.SpatialReference,json:{read:{source:"outSR"},write:{target:"outSR"}}})],t.prototype,"outSpatialReference",void 0),n([a.property({json:{write:!0}})],t.prototype,"relationshipId",void 0),n([a.property({json:{write:!0}})],t.prototype,"returnGeometry",void 0),n([a.property({json:{write:!0}})],t.prototype,"source",void 0),i=n([a.subclass("esri.tasks.support.RelationshipQuery")],t)}(a.declared(i))}.apply(null,n))||(e.exports=o)},446:function(e,t,r){var n,o;n=[r.dj.c(e.i),t,r(339)],void 0===(o=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.when=function e(t,n){return Array.isArray(n)?r.create(function(e){t(n,function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];e(t)})}):e(t,[n]).then(function(e){return e[0]})},t.getAbsMid=function(e,t,r){return t.toAbsMid?t.toAbsMid(e):r.id.replace(/\/[^\/]*$/gi,"/")+e}}.apply(null,n))||(e.exports=o)},457:function(e,t,r){var n,o;n=[r(371),r(402)],void 0===(o=function(e,t){return e.createSubclass({declaredClass:"esri.symbols.FillSymbol",properties:{outline:{type:t,json:{read:{default:null},write:!0}},type:null}})}.apply(null,n))||(e.exports=o)},458:function(e,t,r){var n,o;n=[r(351),r(354),r(371)],void 0===(o=function(e,t,r){return e(r,{declaredClass:"esri.symbols.MarkerSymbol",properties:{angle:{value:0,json:{read:function(e){return e&&-1*e},write:function(e,t){t.angle=e&&-1*e}}},type:{},xoffset:{value:0,cast:t.toPt,json:{write:!0}},yoffset:{value:0,cast:t.toPt,json:{write:!0}},size:{value:9,cast:function(e){return"auto"===e?e:t.toPt(e)},json:{write:!0}}}})}.apply(null,n))||(e.exports=o)},586:function(e,t,r){var n,o;n=[r.dj.c(e.i),t,r(349)],void 0===(o=function(e,t,r){function n(e,t,n){return t.imageData?r.makeData({mediaType:t.contentType||"image/png",isBase64:!0,data:t.imageData}):o(t.url,n)}function o(e,t){return function(e){return e&&("service"===e.origin||"portal-item"===e.origin)&&e.layer&&("feature"===e.layer.type||"stream"===e.layer.type)}(t)&&!r.isAbsolute(e)&&t.layer.parsedUrl?r.join(t.layer.parsedUrl.path,"images",e):r.read(e,t)}function i(e,t,n,o){if(r.isDataProtocol(e)){var i=r.dataComponents(e);t.contentType=i.mediaType,t.imageData=i.data,n&&n.imageData===t.imageData&&n.url&&(t.url=s(n.url,o))}else t.url=s(e,o)}function s(e,t){return r.write(e,t)}Object.defineProperty(t,"__esModule",{value:!0}),t.readImageDataOrUrl=n,t.read=o,t.writeImageDataAndUrl=i,t.write=s,t.urlPropertyDefinition={json:{read:{source:["imageData","url"],reader:n},write:{writer:function(e,t,r,n){i(e,t,this.source,n)}}}},t.sourcePropertyDefinition={readOnly:!0,json:{read:{source:["imageData","url"],reader:function(e,t,r){var n={};return t.imageData&&(n.imageData=t.imageData),t.contentType&&(n.contentType=t.contentType),t.url&&(n.url=o(t.url,r)),n}}}}}.apply(null,n))||(e.exports=o)},592:function(e,t,r){var n,o;n=[r(351),r(354),r(371)],void 0===(o=function(e,t,r){return e(r,{declaredClass:"esri.symbols.LineSymbol",properties:{color:{},type:"simple-line",width:{value:.75,cast:t.toPt,json:{write:!0}}}})}.apply(null,n))||(e.exports=o)},593:function(e,t,r){var n,o;n=[r.dj.c(e.i),t],void 0===(o=function(e,t){return function(){function e(e,t,r,n){this._tag=0,this._dataType=99,this._data=e,this._dataView=t,this._pos=r||0,this._end=n||e.byteLength}return e.prototype.clone=function(){return new e(this._data,this._dataView,this._pos,this._end)},e.prototype.pos=function(){return this._pos},e.prototype.next=function(e){for(;;){if(this._pos===this._end)return!1;var t=this._decodeVarint();if(this._tag=t>>3,this._dataType=7&t,!e||e===this._tag)break;this.skip()}return!0},e.prototype.empty=function(){return this._pos>=this._end},e.prototype.tag=function(){return this._tag},e.prototype.getInt32=function(){return this._decodeVarint()},e.prototype.getInt64=function(){return this._decodeVarint()},e.prototype.getUInt32=function(){var e=4294967295;return e=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128?e:(e=(e|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128?e:void 0))))},e.prototype.getUInt64=function(){return this._decodeVarint()},e.prototype.getSInt32=function(){var e=this.getUInt32();return e>>>1^-(1&e)|0},e.prototype.getSInt64=function(){return this._decodeSVarint()},e.prototype.getBool=function(){var e=0!==this._data[this._pos];return this._skip(1),e},e.prototype.getEnum=function(){return this._decodeVarint()},e.prototype.getFixed64=function(){var e=this._dataView,t=this._pos,r=e.getUint32(t,!0)+4294967296*e.getUint32(t+4,!0);return this._skip(8),r},e.prototype.getSFixed64=function(){var e=this._dataView,t=this._pos,r=e.getUint32(t,!0)+4294967296*e.getInt32(t+4,!0);return this._skip(8),r},e.prototype.getDouble=function(){var e=this._dataView.getFloat64(this._pos,!0);return this._skip(8),e},e.prototype.getFixed32=function(){var e=this._dataView.getUint32(this._pos,!0);return this._skip(4),e},e.prototype.getSFixed32=function(){var e=this._dataView.getInt32(this._pos,!0);return this._skip(4),e},e.prototype.getFloat=function(){var e=this._dataView.getFloat32(this._pos,!0);return this._skip(4),e},e.prototype.getString=function(){var e=this._getLength(),t=this._pos,r=this._toString(this._data,t,t+e);return this._skip(e),r},e.prototype.getBytes=function(){var e=this._getLength(),t=this._pos,r=this._toBytes(this._data,t,t+e);return this._skip(e),r},e.prototype.getMessage=function(){var t=this._getLength(),r=this._pos,n=new e(this._data,this._dataView,r,r+t);return this._skip(t),n},e.prototype.skip=function(){switch(this._dataType){case 0:this._decodeVarint();break;case 1:this._skip(8);break;case 2:this._skip(this._getLength());break;case 5:this._skip(4);break;default:throw new Error("Invalid data type!")}},e.prototype._skip=function(e){if(this._pos+e>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=e},e.prototype._decodeVarint=function(){var e,t=this._data,r=this._pos,n=0;if(this._end-r>=10)do{if(n|=127&(e=t[r++]),0==(128&e))break;if(n|=(127&(e=t[r++]))<<7,0==(128&e))break;if(n|=(127&(e=t[r++]))<<14,0==(128&e))break;if(n|=(127&(e=t[r++]))<<21,0==(128&e))break;if(n+=268435456*(127&(e=t[r++])),0==(128&e))break;if(n+=34359738368*(127&(e=t[r++])),0==(128&e))break;if(n+=4398046511104*(127&(e=t[r++])),0==(128&e))break;if(n+=562949953421312*(127&(e=t[r++])),0==(128&e))break;if(n+=72057594037927940*(127&(e=t[r++])),0==(128&e))break;if(n+=0x8000000000000000*(127&(e=t[r++])),0==(128&e))break;throw new Error("Varint too long!")}while(0);else{for(var o=1;r!==this._end&&0!=(128&(e=t[r]));)++r,n+=(127&e)*o,o*=128;if(r===this._end)throw new Error("Varint overrun!");++r,n+=e*o}return this._pos=r,n},e.prototype._decodeSVarint=function(){var e=this._decodeVarint();return e%2?-(e+1)/2:e/2},e.prototype._getLength=function(){if(2!==this._dataType)throw new Error("Not a delimited data type!");return this._decodeVarint()},e.prototype._toString=function(e,t,r){var n="",o="";r=Math.min(this._end,r);for(var i=t;i<r;++i){var s=e[i];128&s?o+="%"+s.toString(16):(n+=decodeURIComponent(o)+String.fromCharCode(s),o="")}return o.length&&(n+=decodeURIComponent(o)),n},e.prototype._toBytes=function(e,t,r){return r=Math.min(this._end,r),new Uint8Array(e.buffer,t,r-t)},e}()}.apply(null,n))||(e.exports=o)},595:function(e,t,r){var n,o;n=[r.dj.c(e.i),t],void 0===(o=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(e,t){void 0===e&&(e=[]),void 0===t&&(t=[]),this.lengths=e,this.coords=t}}();t.default=r}.apply(null,n))||(e.exports=o)},603:function(e,t,r){var n,o;n=[r.dj.c(e.i),t],void 0===(o=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(e,t,r,n){void 0===e&&(e=null),void 0===t&&(t={}),this.geometry=e,this.attributes=t,r&&(this.centroid=r),null!=n&&(this.objectId=n)}}();t.default=r}.apply(null,n))||(e.exports=o)},607:function(e,t,r){var n,o;n=[r.dj.c(e.i),t,r(381),r(435),r(343),r(339),r(608),r(389),r(609)],void 0===(o=function(e,t,n,o,i,s,a,u,l){function d(){if(v)return v;for(var e=p+f,t=[],r=0;r<e;r++)!function(e){var r=l.create(e).then(function(t){return y[e]=t,t});t.push(r)}(r);return v=o(t).then(function(){})}Object.defineProperty(t,"__esModule",{value:!0}),t.Connection=a,t.RemoteClient=u;var c=n("host-browser")?navigator.hardwareConcurrency:0;c||(c=n("safari")&&n("mac")||n("trident")?8:2);var p=n("esri-workers-debug")?1:Math.max(1,Math.ceil(c/2)),f=n("esri-workers-debug")?1:Math.max(1,Math.floor(c/2)),h=i.getLogger("esri.core.workers"),g=0,y=[];t.initialize=function(){d()},t.open=function(n,o,i){if(void 0===o&&(o={}),Array.isArray(n))return new t.Connection(n.map(function(e){return new t.RemoteClient(e,o.client)}));if("string"!=typeof n){h.warn("workers-open:signature-deprecated","DEPRECATED: workers.open() changed signature.");var a=n;n=o,o={client:a,strategy:i?"dedicated":"distributed"}}var u=o.strategy||"distributed";return"local"===u?s.create(function(o){Promise.resolve().then(function(){var r=[e(n,null,!1)];(function(e){o(t.RemoteClient.connect(e))}).apply(null,r)}).catch(r.oe)}).then(function(e){return new t.Connection([new t.RemoteClient(e,o.client)])}):d().then(function(){if("dedicated"===u){var e=p+g++;return g%=f,y[e].open(n).then(function(e){return new t.Connection([new t.RemoteClient(e,o.client)])})}return s.all(y.map(function(e){return e.open(n)})).then(function(e){return new t.Connection(e.map(function(e){return new t.RemoteClient(e,o.client)}))})})},t.terminate=function(){v&&(v.cancel(),v=null);for(var e=0;e<y.length;e++)y[e]&&y[e].terminate();y.length=0};var v=null}.apply(null,n))||(e.exports=o)},608:function(e,t,r){var n,o;n=[r.dj.c(e.i),t,r(339)],void 0===(o=function(e,t,r){return function(){function e(e){this._clientIdx=0,this._clients=e}return e.prototype.broadcast=function(e,t){for(var r=[],n=0,o=this._clients;n<o.length;n++){var i=o[n];r.push(i.invoke(e,t))}return r},e.prototype.close=function(){for(var e=0,t=this._clients;e<t.length;e++)t[e].close();this._clients=[]},e.prototype.invoke=function(e,t,n,o){var i=o&&o.client;if(!this._clients||!this._clients.length)return r.reject(new Error("Connection closed"));null!=i&&-1!==this._clients.indexOf(i)||this._clients.some(function(e){return!e.isBusy()&&(i=e,!0)})||(this._clientIdx=(this._clientIdx+1)%this._clients.length,i=this._clients[this._clientIdx]);var s=i.invoke(e,t,n);return o&&(o.client=i),s},e.prototype.openPorts=function(){return r.all(this._clients.map(function(e){return e.openPort()}))},e}()}.apply(null,n))||(e.exports=o)},609:function(e,t,r){var n,o;n=[r.dj.c(e.i),t,r(620),r(341),r(343),r(339),r(378),r(610)],void 0===(o=function(e,t,r,n,o,i,s,a){function u(e,t){e.delete(t)}var l=o.getLogger("esri.core.workers"),d=s.MessageType.CANCEL,c=s.MessageType.INVOKE,p=s.MessageType.OPEN,f=s.MessageType.OPENED,h=s.MessageType.RESPONSE;return function(){function e(e,t){this._outJobs=new Map,this._inJobs=new Map,this.worker=e,this.id=t,e.addEventListener("message",this._onMessage.bind(this)),e.addEventListener("error",function(e){e.preventDefault(),l.error(e)})}return e.create=function(t){return a.createWorker().then(function(r){return new e(r,t)})},e.prototype.terminate=function(){this.worker.terminate()},e.prototype.open=function(e){var t=this,r=s.newJobId(),n=function(){u(t._outJobs,r),t._post({type:d,jobId:r})};return i.create(function(o,i){var s={resolve:o,reject:i,cancel:n};t._outJobs.set(r,s),t._post({type:p,jobId:r,modulePath:e})},n)},e.prototype._onMessage=function(e){var t=s.receiveMessage(e);if(t)switch(t.type){case f:case h:this._onResponse(t);break;case d:this._onCancel(t);break;case c:this._onInvoke(t)}},e.prototype._onCancel=function(e){var t=this._inJobs.get(e.jobId);t&&t.cancel()},e.prototype._onInvoke=function(e){var t,n=this,o=e.methodName,a=e.jobId,l=e.data,d=this._inJobs,c=r.workerMessages[o];try{if("function"!=typeof c)throw new TypeError(o+" is not a function");t=c.call(null,l)}catch(e){return void this._post({type:h,jobId:a,error:s.toInvokeError(e)})}i.isThenable(t)?(d.set(a,t),t.then(function(e){u(d,a),n._post({type:h,jobId:a},e)}).catch(function(e){u(d,a),e||(e={message:"Error encountered at method"+o}),e.dojoType&&"cancel"===e.dojoType||n._post({type:h,jobId:a,error:s.toInvokeError(e)})})):this._post({type:h,jobId:a},t)},e.prototype._onResponse=function(e){var t=e.jobId,r=e.error,o=e.data,i=this._outJobs.get(t);i&&(u(this._outJobs,t),r?i.reject(n.fromJSON(JSON.parse(r))):i.resolve(o))},e.prototype._post=function(e,t,r){return s.postMessage(this.worker,e,t,r)},e}()}.apply(null,n))||(e.exports=o)},610:function(e,t,r){var n,o;n=[r.dj.c(e.i),t,r(344),r(356),r(124),r(350),r(353),r(343),r(339),r(349),r(611),r(378),r(612)],void 0===(o=function(e,t,r,n,o,i,s,a,u,l,d,c,p){function f(e){return u.create(function(t){function r(o){var i=c.receiveMessage(o);if(i)switch(i.type){case w:h(e);break;case b:e.removeEventListener("message",r),e.removeEventListener("error",n),t(e)}}function n(t){t.preventDefault(),e.removeEventListener("message",r),e.removeEventListener("error",n),v.warn("Failed to create Worker. Fallback to execute module in main thread",t),(e=new p).addEventListener("message",r),e.addEventListener("error",n)}e.addEventListener("message",r),e.addEventListener("error",n)})}function h(e){var t,i=o.workers.loaderUrl||d.DEFAULT_LOADER_URL;if(null!=o.default){var a=r({},o);delete a.default,t=JSON.parse(JSON.stringify(a))}else t=JSON.parse(JSON.stringify(o));var u=o.workers.loaderConfig,l=d.default({baseUrl:u.baseUrl,locale:n.locale,has:r({"config-deferredInstrumentation":0,"dojo-test-sniff":0,"esri-secure-context":s("esri-secure-context"),"esri-workers-arraybuffer-transfer":s("esri-workers-arraybuffer-transfer"),"events-keypress-typed":0,"host-webworker":1},u.has),map:r({},u.map),paths:r({},u.paths),packages:u.packages||[]});e.postMessage({type:_,configure:{esriConfig:t,loaderUrl:i,loaderConfig:l}})}Object.defineProperty(t,"__esModule",{value:!0});var g=l.normalize(e.toUrl("./worker.js")),y=!l.hasSameOrigin(g,location.href),v=a.getLogger("esri.core.workers"),m=null;s.add("esri-workers-arraybuffer-transfer",!s("safari")||s("safari")>=12);var b=c.MessageType.CONFIGURED,_=c.MessageType.CONFIGURE,w=c.MessageType.HANDSHAKE;t.createWorker=function(){if(!s("esri-workers"))return f(new p);if(!y){var e=void 0;try{e=new Worker(g)}catch(t){v.warn("Failed to create Worker. Fallback to execute module in main thread",event),e=new p}return f(e)}return m||(m=i(g,{responseType:"text"})),m.then(function(e){return new Worker(URL.createObjectURL(new Blob([e.data],{type:"text/javascript"})))}).catch(function(e){return v.warn("Failed to create Worker. Fallback to execute module in main thread",e),new p}).then(function(e){return f(e)})}}.apply(null,n))||(e.exports=o)},611:function(e,t,r){var n,o;n=[r.dj.c(e.i),t,r(344),r(355),r(349)],void 0===(o=function(e,t,r,n,o){function i(t){return o.removeQueryParameters(e.toUrl(t))}function s(e,t){for(var n=0,s=e;n<s.length;n++)if(s[n].name===t.name)return;var a=r({},t),u=i(a.name+"/x.js"),l=u.slice(0,u.length-5);a.location=o.makeAbsolute(l),e.push(a)}Object.defineProperty(t,"__esModule",{value:!0});var a=n("esri-built")?"dojo/dojo-lite.js":"dojo/dojo.js";t.DEFAULT_LOADER_URL=o.makeAbsolute(i(a)),t.DEFAULT_CONFIG={baseUrl:function(){var e=i("dojo/x.js");return o.makeAbsolute(e.slice(0,e.length-5))}(),packages:[{name:"esri"},{name:"dojo"},{name:"dojox"},{name:"dstore"},{name:"moment",main:"moment"},{name:"@dojo"},{name:"cldrjs",main:"dist/cldr"},{name:"globalize",main:"dist/globalize"},{name:"maquette",main:"dist/maquette.umd"},{name:"maquette-css-transitions",main:"dist/maquette-css-transitions.umd"},{name:"maquette-jsx",main:"dist/maquette-jsx.umd"},{name:"tslib",main:"tslib"}],map:{globalize:{cldr:"cldrjs/dist/cldr","cldr/event":"cldrjs/dist/cldr/event","cldr/supplemental":"cldrjs/dist/cldr/supplemental","cldr/unresolved":"cldrjs/dist/cldr/unresolved"}}},t.default=function(e){var n={async:e.async,isDebug:e.isDebug,locale:e.locale,baseUrl:e.baseUrl,has:r({},e.has),map:r({},e.map),packages:e.packages&&e.packages.concat()||[],paths:r({},e.paths)};e.hasOwnProperty("async")||(n.async=!0),e.hasOwnProperty("isDebug")||(n.isDebug=!1),e.baseUrl||(n.baseUrl=t.DEFAULT_CONFIG.baseUrl),t.DEFAULT_CONFIG.packages.forEach(function(e){s(n.packages,e)});for(var o=n.map=n.map||{},i=0,a=Object.keys(t.DEFAULT_CONFIG.map);i<a.length;i++){var u=a[i];o[u]||(o[u]=t.DEFAULT_CONFIG.map[u])}return n}}.apply(null,n))||(e.exports=o)},612:function(e,t,r){var n,o;n=[r.dj.c(e.i),t,r(355),r(453),r(378)],void 0===(o=function(e,t,n,o,i){var s=function(){return function(){var e=this,t=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(function(r){e[r]=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t[r].apply(t,e)}})}}(),a=o.MutationObserver||o.WebKitMutationObserver,u=function(){var e;if(o.process&&o.process.nextTick)e=function(e){o.process.nextTick(e)};else if(o.Promise)e=function(e){o.Promise.resolve().then(e)};else if(a){var t=[],r=document.createElement("div");new a(function(){for(;t.length>0;)t.shift()()}).observe(r,{attributes:!0}),e=function(e){t.push(e),r.setAttribute("queueStatus","1")}}return e}();return function(){function t(){this._dispatcher=new s,this._isInitialized=!1,this._workerPostMessage({type:i.MessageType.HANDSHAKE})}return t.prototype.terminate=function(){},Object.defineProperty(t.prototype,"onmessage",{get:function(){return this._onmessageHandler},set:function(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onerror",{get:function(){return this._onerrorHandler},set:function(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)},enumerable:!0,configurable:!0}),t.prototype.postMessage=function(e,t){var r=this;u(function(){r._workerMessageHandler(new MessageEvent("message",{data:e}))})},t.prototype.dispatchEvent=function(e){return this._dispatcher.dispatchEvent(e)},t.prototype.addEventListener=function(e,t,r){this._dispatcher.addEventListener(e,t,r)},t.prototype.removeEventListener=function(e,t,r){this._dispatcher.removeEventListener(e,t,r)},t.prototype._workerPostMessage=function(e,t){var r=this;u(function(){r.dispatchEvent(new MessageEvent("message",{data:e}))})},t.prototype._workerMessageHandler=function(t){var o=this,s=i.receiveMessage(t);if(s){var a=s.jobId;switch(s.type){case i.MessageType.CONFIGURE:this._isInitialized||this._workerPostMessage({type:i.MessageType.CONFIGURED});break;case i.MessageType.OPEN:var u=s.modulePath;n("esri-webpack")?Promise.all([r.e(3),r.e(2),r.e(5),r.e(7),r.e(67)]).then(function(){var t=[r(389),r(752),r(753),r(735),r(716),r(754),r(682),e(u,null,!1)];(function(e,t,r,n,s,u,l,d){var c;switch(d){case"esri/views/vectorTiles/WorkerTileHandler":c=t;break;case"esri/views/2d/layers/features/Pipeline":c=r;break;case"esri/views/3d/layers/PointCloudWorker":c=n;break;case"esri/views/3d/layers/SceneLayerWorker":c=s;break;case"esri/layers/graphics/sources/support/CSVSourceWorker":c=u;break;case"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeProcessingWorker":c=l;break;default:c=d}var p=e.connect(c);o._workerPostMessage({type:i.MessageType.OPENED,jobId:a,data:p})}).apply(null,t)}).catch(r.oe):Promise.resolve().then(function(){var t=[r(389),e(u,null,!1)];(function(e,t){var r=e.connect(t);o._workerPostMessage({type:i.MessageType.OPENED,jobId:a,data:r})}).apply(null,t)}).catch(r.oe)}}},t}()}.apply(null,n))||(e.exports=o)},613:function(e,t,r){var n,o;n=[r.dj.c(e.i),t,r(357),r(363)],void 0===(o=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0}),t.graphicsExtent=function(e){if(!e||!e.length)return null;var t=r.isCollection(e)?e.getItemAt(0).geometry:e[0].geometry,o=t.extent,i=t;null===o&&(o=new n(i.x,i.y,i.x,i.y,t.spatialReference));for(var s=1;s<e.length;s++){i=t=r.isCollection(e)?e.getItemAt(s).geometry:e[s].geometry;var a=t.extent;null===a&&(a=new n(i.x,i.y,i.x,i.y,t.spatialReference)),o=o.clone().union(a)}return o.width<0&&o.height<0?null:o},t.getGeometries=function(e){return e.map(function(e){return e.geometry})},t._encodeGraphics=function(e,t){var r=[];return e.forEach(function(e,n){var o=e.toJSON(),i={};if(o.geometry){var s=t&&t[n];i.geometry=s&&s.toJSON()||o.geometry}o.attributes&&(i.attributes=o.attributes),r[n]=i}),r}}.apply(null,n))||(e.exports=o)},627:function(e,t,r){var n,o;n=[r.dj.c(e.i),t,r(344),r(350),r(349),r(422),r(626),r(628),r(403)],void 0===(o=function(e,t,r,n,o,i,s,a,u){function l(e,t){var r=e.geometry,n=e.toJSON(),o=n;if(r&&(o.geometry=JSON.stringify(r),o.geometryType=i.getJsonType(r),o.inSR=r.spatialReference.wkid||JSON.stringify(r.spatialReference)),n.groupByFieldsForStatistics&&(o.groupByFieldsForStatistics=n.groupByFieldsForStatistics.join(",")),n.objectIds&&(o.objectIds=n.objectIds.join(",")),n.orderByFields&&(o.orderByFields=n.orderByFields.join(",")),!n.outFields||t&&(t.returnCountOnly||t.returnExtentOnly||t.returnIdsOnly)?delete o.outFields:-1!==n.outFields.indexOf("*")?o.outFields="*":o.outFields=n.outFields.join(","),n.outSR?o.outSR=n.outSR.wkid||JSON.stringify(n.outSR):r&&(n.returnGeometry||n.returnCentroid)&&(o.outSR=o.inSR),n.returnGeometry&&delete n.returnGeometry,n.outStatistics&&(o.outStatistics=JSON.stringify(n.outStatistics)),n.pixelSize&&(o.pixelSize=JSON.stringify(n.pixelSize)),n.quantizationParameters&&(o.quantizationParameters=JSON.stringify(n.quantizationParameters)),n.source&&(o.layer=JSON.stringify({source:n.source}),delete n.source),n.timeExtent){var s=n.timeExtent;o.time=[null!=s.startTime?s.startTime:"null",null!=s.endTime?s.endTime:"null"],delete n.timeExtent}return o}function d(e,t,i,a,d){void 0===a&&(a={});var c="string"==typeof e?o.urlToObject(e):e,p=t.geometry?[t.geometry]:[];return a.responseType="pbf"===i?"array-buffer":"json",s.normalizeCentralMeridian(p,null,a).then(function(e){var o=e&&e[0];o&&((t=t.clone()).geometry=o);var s=u.mapParameters(r({},c.query,{f:i},d,l(t,d)));return n(c.path+"/query",r({},a,{query:s}))})}Object.defineProperty(t,"__esModule",{value:!0});var c="Layer does not support extent calculation.";t.queryToQueryStringParameters=l,t.executeQuery=function(e,t,r){return d(e,t,"json",r)},t.executeQueryPBF=function(e,t,r){return d(e,t,"pbf",r).then(function(e){var t=a.parsePBFFeatureQuery(e.data),r=e;return r.data=t,r})},t.executeQueryForIds=function(e,t,r){return d(e,t,"json",r,{returnIdsOnly:!0})},t.executeQueryForCount=function(e,t,r){return d(e,t,"json",r,{returnIdsOnly:!0,returnCountOnly:!0})},t.executeQueryForExtent=function(e,t,r){return d(e,t,"json",r,{returnExtentOnly:!0,returnCountOnly:!0}).then(function(e){var t=e.data;if(t.hasOwnProperty("extent"))return e;if(t.features)throw new Error(c);if(t.hasOwnProperty("count"))throw new Error(c);return e})}}.apply(null,n))||(e.exports=o)},628:function(e,t,r){var n,o;n=[r.dj.c(e.i),t,r(341),r(343),r(425),r(629)],void 0===(o=function(e,t,r,n,o,i){Object.defineProperty(t,"__esModule",{value:!0});var s=n.getLogger("esri.tasks.operations.pbfQueryUtils");t.parsePBFFeatureQuery=function(e){try{var t=i.parseFeatureQuery(e).queryResult.featureResult;if(t&&t.features&&t.features.length&&t.objectIdFieldName)for(var n=t.objectIdFieldName,a=0,u=t.features;a<u.length;a++){var l=u[a];l.attributes&&(l.objectId=l.attributes[n])}return t}catch(e){var d=new r("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:e});return s.error(d),new o.default}}}.apply(null,n))||(e.exports=o)},629:function(e,t,r){var n,o;n=[r.dj.c(e.i),t,r(593),r(603),r(425),r(595)],void 0===(o=function(e,t,r,n,o,i){function s(e){return e>=S.length?null:S[e]}function a(e){return e>=x.length?null:x[e]}function u(e){return e>=I.length?null:I[e]}function l(e){return e>=P.length?null:P[e]}function d(e){for(var t=new i.default,r=t.coords;e.next();)switch(e.tag()){case 3:for(var n=e.getUInt32(),o=e.pos()+n,s=0;e.pos()<o;)r[s++]=e.getSInt64();break;case 1:case 2:default:e.skip()}return t}function c(e){for(var t=new i.default,r=t.coords,n=t.lengths;e.next();)switch(e.tag()){case 2:for(var o=e.getUInt32(),s=e.pos()+o;e.pos()<s;)n.push(e.getUInt32());break;case 3:for(var a=e.getUInt32(),u=(s=e.pos()+a,0);e.pos()<s;)r[u++]=e.getSInt64();break;case 1:default:e.skip()}return t}function p(e){for(;e.next();)switch(e.tag()){case 1:return e.getString();case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getSInt32();case 5:return e.getUInt32();case 6:return e.getInt64();case 7:return e.getUInt64();case 8:return e.getSInt64();case 9:return e.getBool();default:return e.skip(),null}return null}function f(e){for(var t={type:s(0)};e.next();)switch(e.tag()){case 1:t.name=e.getString();break;case 2:t.type=s(e.getEnum());break;case 3:t.alias=e.getString();break;case 4:t.sqlType=a(e.getEnum());break;case 5:case 6:default:e.skip()}return t}function h(e,t){for(var r=new n.default,o=0;e.next();)switch(e.tag()){case 1:var i=e.getMessage(),s=t[o++].name;r.attributes[s]=p(i);break;case 2:r.geometry=c(e.getMessage());break;case 4:r.centroid=d(e.getMessage());break;default:e.skip()}return r}function g(e){for(var t=[0,0];e.next();)switch(e.tag()){case 1:t[0]=e.getDouble();break;case 2:t[1]=e.getDouble();break;case 3:case 4:t.push(e.getDouble());break;default:e.skip()}return t}function y(e){for(var t=[0,0];e.next();)switch(e.tag()){case 1:t[0]=e.getDouble();break;case 2:t[1]=e.getDouble();break;case 3:case 4:t.push(e.getDouble());break;default:e.skip()}return t}function v(e){for(var t={originPosition:u(0)};e.next();)switch(e.tag()){case 1:t.originPosition=u(e.getEnum());break;case 2:t.scale=g(e.getMessage());break;case 3:t.translate=y(e.getMessage());break;default:e.skip()}return t}function m(e){for(var t={};e.next();)switch(e.tag()){case 1:t.shapeAreaFieldName=e.getString();break;case 2:t.shapeLengthFieldName=e.getString();break;case 3:t.units=e.getString();break;default:e.skip()}return t}function b(e){for(var t={};e.next();)switch(e.tag()){case 1:t.wkid=e.getUInt32();break;case 5:t.wkt=e.getString();break;case 2:case 3:case 4:default:e.skip()}return t}function _(e){var t=new o.default;for(t.geometryType=l(0);e.next();)switch(e.tag()){case 1:t.objectIdFieldName=e.getString();break;case 3:t.globalIdFieldName=e.getString();break;case 4:t.geohashFieldName=e.getString();break;case 5:t.geometryProperties=m(e.getMessage());break;case 7:t.geometryType=l(e.getEnum());break;case 8:t.spatialReference=b(e.getMessage());break;case 10:t.hasZ=e.getBool();break;case 11:t.hasM=e.getBool();break;case 12:var r=e.getMessage();t.transform=v(r);break;case 9:var n=e.getBool();t.exceededTransferLimit=n;break;case 13:var i=e.getMessage();t.fields.push(f(i));break;case 15:var s=e.getMessage();t.features.push(h(s,t.fields));break;case 2:case 6:default:e.skip()}return t}function w(e){for(var t={};e.next();)switch(e.tag()){case 1:t.featureResult=_(e.getMessage());break;default:e.skip()}return t}Object.defineProperty(t,"__esModule",{value:!0});var S=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML"],x=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],P=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"],I=["upperLeft","lowerLeft"];t.parseFeatureQuery=function(e){for(var t=new r(new Uint8Array(e),new DataView(e)),n={};t.next();)switch(t.tag()){case 2:n.queryResult=w(t.getMessage());break;default:t.skip()}return n}}.apply(null,n))||(e.exports=o)},639:function(e,t,r){var n,o;n=[r.dj.c(e.i),t,r(344),r(350),r(349),r(403)],void 0===(o=function(e,t,r,n,o,i){Object.defineProperty(t,"__esModule",{value:!0}),t.processAttachmentQueryResult=function(e,t,n){for(var i={},s=0,a=e;s<a.length;s++)for(var u=a[s],l=u.parentObjectId,d=0,c=u.attachmentInfos;d<c.length;d++){var p=c[d],f=p.id,h=o.addProxy(t+"/"+l+"/attachments/"+f+(n?"?token="+n:"")),g=r({},p,{parentObjectId:l,url:h});i[l]?i[l].push(g):i[l]=[g]}return i},t.executeAttachmentQuery=function(e,t,o){var s={query:i.mapParameters(r({},e.query,{f:"json"},function(e){var t=e.toJSON();return t.attachmentTypes&&(t.attachmentTypes=t.attachmentTypes.join(",")),t.globalIds&&(t.globalIds=t.globalIds.join(",")),t.objectIds&&(t.objectIds=t.objectIds.join(",")),t.size&&(t.size=t.size.join(",")),t}(t)))};return o&&(s=r({},o,s)),n(e.path+"/queryAttachments",s)}}.apply(null,n))||(e.exports=o)},647:function(e,t,r){var n,o;n=[r.dj.c(e.i),t,r(337),r(335),r(388),r(344),r(364),r(336),r(740),r(627),r(639),r(648),r(440),r(392),r(419),r(444)],void 0===(o=function(e,t,r,n,o,i,s,a,u,l,d,c,p,f,h,g){return function(e){function t(t){var r=e.call(this,t)||this;return r.gdbVersion=null,r.source=null,r}return r(t,e),t.prototype.execute=function(e,t){return this.executeJSON(e,t).then(function(e){return f.fromJSON(e)})},t.prototype.executeJSON=function(e,t){return l.executeQuery(this.parsedUrl,this._normalizeQuery(e),i({},this.requestOptions,t)).then(function(e){return e.data})},t.prototype.executeForCount=function(e,t){return l.executeQueryForCount(this.parsedUrl,this._normalizeQuery(e),i({},this.requestOptions,t)).then(function(e){return e.data.count})},t.prototype.executeForExtent=function(e,t){return l.executeQueryForExtent(this.parsedUrl,this._normalizeQuery(e),i({},this.requestOptions,t)).then(function(e){return{count:e.data.count,extent:s.Extent.fromJSON(e.data.extent)}})},t.prototype.executeForIds=function(e,t){return l.executeQueryForIds(this.parsedUrl,this._normalizeQuery(e),i({},this.requestOptions,t)).then(function(e){return e.data.objectIds})},t.prototype.executeRelationshipQuery=function(e,t){return(this.gdbVersion||this.source)&&(e=e.clone().set({gdbVersion:this.gdbVersion||e.gdbVersion,source:this.source||e.source})),c.executeRelationshipQuery(this.parsedUrl,e,i({},this.requestOptions,t)).then(function(e){var t=e.data,r={};return Object.keys(t).forEach(function(e){return r[e]=f.fromJSON(t[e])}),r})},t.prototype.executeAttachmentQuery=function(e,t){var r=this,n=t&&t.query&&t.query.token;return d.executeAttachmentQuery(this.parsedUrl,e,i({},this.requestOptions,t)).then(function(e){return d.processAttachmentQueryResult(e.data.attachmentGroups,r.parsedUrl.path,n)})},t.prototype._normalizeQuery=function(e){return this.gdbVersion||this.source?e.clone().set({gdbVersion:this.gdbVersion||e.gdbVersion,source:this.source||e.source}):e},n([a.property()],t.prototype,"gdbVersion",void 0),n([a.property()],t.prototype,"source",void 0),n([o(0,a.cast(h))],t.prototype,"execute",null),n([o(0,a.cast(h))],t.prototype,"executeJSON",null),n([o(0,a.cast(h))],t.prototype,"executeForCount",null),n([o(0,a.cast(h))],t.prototype,"executeForExtent",null),n([o(0,a.cast(h))],t.prototype,"executeForIds",null),n([o(0,a.cast(g))],t.prototype,"executeRelationshipQuery",null),n([o(0,a.cast(p))],t.prototype,"executeAttachmentQuery",null),n([a.subclass("esri.tasks.QueryTask")],t)}(a.declared(u))}.apply(null,n))||(e.exports=o)},648:function(e,t,r){var n,o;n=[r.dj.c(e.i),t,r(344),r(350),r(403)],void 0===(o=function(e,t,r,n,o){function i(e){var t=e.toJSON();return t.objectIds&&(t.objectIds=t.objectIds.join(",")),t.outFields&&(t.outFields=t.outFields.join(",")),t.outSpatialReference&&(t.outSR=t.outSR.wkid||JSON.stringify(t.outSR.toJSON()),delete t.outSpatialReference),t.source&&(t.layer=JSON.stringify({source:t.source}),delete t.source),t}Object.defineProperty(t,"__esModule",{value:!0}),t.toQueryStringParameters=i,t.executeRelationshipQuery=function(e,t,s){var a={query:o.mapParameters(r({},e.query,{f:"json"},i(t)))};return s&&(a=r({},s,a)),n(e.path+"/queryRelatedRecords",a).then(function(e){for(var t=e.data,r=t.geometryType,n=t.spatialReference,o={},i=0,s=t.relatedRecordGroups;i<s.length;i++){var a=s[i],u={fields:void 0,objectIdFieldName:void 0,geometryType:r,spatialReference:n,features:a.relatedRecords};if(null!=a.objectId)o[a.objectId]=u;else for(var l in a)a.hasOwnProperty(l)&&"relatedRecords"!==l&&(o[a[l]]=u)}return e.data=o,e})}}.apply(null,n))||(e.exports=o)},701:function(e,t,r){var n,o;n=[r(351),r(338),r(354),r(458),r(586)],void 0===(o=function(e,t,r,n,o){var i={width:12,height:12,angle:0,xoffset:0,yoffset:0},s=e(n,{declaredClass:"esri.symbols.PictureMarkerSymbol",properties:{color:{json:{write:!1}},type:"picture-marker",url:o.urlPropertyDefinition,source:o.sourcePropertyDefinition,height:{json:{read:{source:["height","size"],reader:function(e,t){return t.size||e}},write:!0},cast:r.toPt},width:{json:{read:{source:["width","size"],reader:function(e,t){return t.size||e}},write:!0},cast:r.toPt},size:{json:{write:!1}}},getDefaults:function(){return t.mixin(this.inherited(arguments),i)},normalizeCtorArgs:function(e,t,n){if(e&&"string"!=typeof e&&null==e.imageData)return e;var o={};return e&&(o.url=e),null!=t&&(o.width=r.toPt(t)),null!=n&&(o.height=r.toPt(n)),o},clone:function(){var e=new s({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return e._set("source",t.clone(this.source)),e}});return s.defaultProps=i,s}.apply(null,n))||(e.exports=o)},702:function(e,t,r){var n,o;n=[r(351),r(338),r(457),r(402)],void 0===(o=function(e,t,r,n){var o={style:"solid",outline:new n,color:[0,0,0,.25]},i=e(r,{declaredClass:"esri.symbols.SimpleFillSymbol",properties:{color:{},type:"simple-fill",style:{value:"solid",type:String,json:{read:function(e){return t.valueOf(this._styles,e)||void 0},write:function(e,t){t.style=this._styles[e]}}}},_styles:{solid:"esriSFSSolid",none:"esriSFSNull",horizontal:"esriSFSHorizontal",vertical:"esriSFSVertical","forward-diagonal":"esriSFSForwardDiagonal","backward-diagonal":"esriSFSBackwardDiagonal",cross:"esriSFSCross","diagonal-cross":"esriSFSDiagonalCross"},getDefaults:function(){return t.mixin(this.inherited(arguments),o)},normalizeCtorArgs:function(e,t,r){if(e&&"string"!=typeof e)return e;var n={};return e&&(n.style=e),t&&(n.outline=t),r&&(n.color=r),n},clone:function(){return new i({color:t.clone(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}});return t.mixin(i,{STYLE_SOLID:"solid",STYLE_NULL:"none",STYLE_HORIZONTAL:"horizontal",STYLE_VERTICAL:"vertical",STYLE_FORWARD_DIAGONAL:"forward-diagonal",STYLE_BACKWARD_DIAGONAL:"backward-diagonal",STYLE_CROSS:"cross",STYLE_DIAGONAL_CROSS:"diagonal-cross"}),i.defaultProps=o,i}.apply(null,n))||(e.exports=o)},735:function(e,t,r){var n,o;n=[r.dj.c(e.i),t,r(339),r(362),r(771),r(975),r(1423),r(342),r(387)],void 0===(o=function(e,t,r,n,o,i,s,a,u){var l=function(){function e(){}return e.prototype.process=function(e){var t=this.transform(e);return r.resolve({result:t,transferList:[t.rgb]})},e.prototype.transform=function(e){var t=this.readGeometry(e.schema,e.geometryBuffer),r=s.evaluateRenderer(e.rendererInfo,e.primaryAttribute,e.modulationAttribute,t,t.length/3);this._applyElevationOffsetInPlace(t,e.elevationOffset);var o=this._transformCoordinates(t,e.obb,n.fromJSON(e.inSR),n.fromJSON(e.outSR));return{obb:e.obb,points:o,rgb:r.buffer}},e.prototype.readGeometry=function(e,t){if(null==e.encoding||""===e.encoding){for(var r=o.createGeometryDataIndex(t,e,!1),n=o.createTypedView(t,r.vertexAttributes.position),s=r.header.fields,a=[s.offsetX,s.offsetY,s.offsetZ],u=[s.scaleX,s.scaleY,s.scaleZ],l=n.length/3,d=new Float64Array(3*l),c=0;c<l;c++)d[3*c]=n[3*c]*u[0]+a[0],d[3*c+1]=n[3*c+1]*u[1]+a[1],d[3*c+2]=n[3*c+2]*u[2]+a[2];return d}if("lepcc-xyz"===e.encoding)return i.decodeXYZ(t).result},e.prototype._transformCoordinates=function(e,t,r,n){var o=e.length/3;if(!u.bufferToBuffer(e,r,0,e,n,0,o))throw Error("Can't reproject");var i=a.vec3.createFrom(t.center[0],t.center[1],t.center[2]),s=a.vec3.create(),l=a.vec3.create();a.quat4.conjugate(t.quaternion,d);for(var c=new Float32Array(3*o),p=0;p<o;p++)s[0]=e[3*p]-i[0],s[1]=e[3*p+1]-i[1],s[2]=e[3*p+2]-i[2],a.quat4.multiplyVec3(d,s,l),t.halfSize[0]=Math.max(t.halfSize[0],Math.abs(l[0])),t.halfSize[1]=Math.max(t.halfSize[1],Math.abs(l[1])),t.halfSize[2]=Math.max(t.halfSize[2],Math.abs(l[2])),c[3*p]=s[0],c[3*p+1]=s[1],c[3*p+2]=s[2];return c},e.prototype._applyElevationOffsetInPlace=function(e,t){var r=e.length/3;if(0!==t)for(var n=0;n<r;n++)e[3*n+2]+=t},e}(),d=a.quat4.create();return l}.apply(null,n))||(e.exports=o)},762:function(e,t,r){var n,o;n=[r.dj.c(e.i),t,r(384),r(342),r(1023),r(604)],void 0===(o=function(e,t,r,n,o,i){function s(e,t,r){return{center:n.vec3d.createFrom(e[0],e[1],e[2]),halfSize:n.vec3.createFrom(t[0],t[1],t[2]),quaternion:n.quat4.createFrom(r[0],r[1],r[2],r[3])}}function a(e,t){var r=i.plane.distance(t,e.center),n=u(e,t);return r>n?1:r<-n?-1:0}function u(e,t){n.quat4.conjugate(e.quaternion,l),n.quat4d.multiplyVec3(l,t,d);var r=e.halfSize;return Math.abs(d[0]*r[0])+Math.abs(d[1]*r[1])+Math.abs(d[2]*r[2])}Object.defineProperty(t,"__esModule",{value:!0});var l=n.quat4.create(),d=n.vec3.create(),c=n.vec3.create(),p=n.mat3.create(),f=function(){return function(e){var t=56*e;this.buffer=new ArrayBuffer(t),this.obbs=new Array(e);for(var r=0;r<e;r++)this.obbs[r]={center:new Float64Array(this.buffer,56*r+0,3),halfSize:new Float32Array(this.buffer,56*r+24,3),quaternion:new Float32Array(this.buffer,56*r+36,4)}}}();t.ObbArray=f,t.create=s,t.clone=function(e){return s(e.center,e.halfSize,e.quaternion)},t.set=function(e,t){n.vec3d.set(e.center,t.center),n.vec3.set(e.halfSize,t.halfSize),n.quat4.set(e.quaternion,t.quaternion)},t.compute=function(e,t){return t||(t=s([0,0,0],[-1,-1,-1],[0,0,0,1])),o.computeOBB(e,t),t},t.intersectPlane=a,t.toAaBoundingBox=function(e,t){t||(t=r.create());var o=n.quat4.toMat3(e.quaternion,p),i=e.halfSize[0]*Math.abs(o[0])+e.halfSize[1]*Math.abs(o[3])+e.halfSize[2]*Math.abs(o[6]),s=e.halfSize[0]*Math.abs(o[1])+e.halfSize[1]*Math.abs(o[4])+e.halfSize[2]*Math.abs(o[7]),a=e.halfSize[0]*Math.abs(o[2])+e.halfSize[1]*Math.abs(o[5])+e.halfSize[2]*Math.abs(o[8]);return t[0]=e.center[0]-i,t[1]=e.center[1]-s,t[2]=e.center[2]-a,t[3]=e.center[0]+i,t[4]=e.center[1]+s,t[5]=e.center[2]+a,t},t.minimumDistancePlane=function(e,t){return i.plane.distance(t,e.center)-u(e,t)},t.maximumDistancePlane=function(e,t){return i.plane.distance(t,e.center)+u(e,t)},t.isVisible=function(e,t){return a(e,t[0])<=0&&a(e,t[1])<=0&&a(e,t[2])<=0&&a(e,t[3])<=0&&a(e,t[4])<=0&&a(e,t[5])<=0},t.intersectLine=function(e,t,r,o){void 0===o&&(o=0),n.quat4.conjugate(e.quaternion,l),n.vec3d.subtract(t,e.center,d);for(var i=n.quat4d.multiplyVec3(l,d,d),s=n.quat4d.multiplyVec3(l,r,c),a=-1/0,u=1/0,p=0;p<3;p++)if(Math.abs(s[p])>1e-6){var f=(o+e.halfSize[p]-i[p])/s[p],h=(-o-e.halfSize[p]-i[p])/s[p];a=Math.max(a,Math.min(f,h)),u=Math.min(u,Math.max(f,h))}else if(i[p]>e.halfSize[p]+o||i[p]<-e.halfSize[p]-o)return!1;return a<=u}}.apply(null,n))||(e.exports=o)},764:function(e,t,r){var n,o;n=[r.dj.c(e.i),t],void 0===(o=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.updatingPercentageValue={value:100,readOnly:!0},t.updatingPercentage={dependsOn:["updating","updatingPercentageValue"],readOnly:!0,value:0,get:function(){return this.updating?this.updatingPercentageValue:0}}}.apply(null,n))||(e.exports=o)},765:function(e,t,r){var n,o;n=[r.dj.c(e.i),t,r(350),r(341),r(339),r(349),r(362),r(386),r(647),r(419),r(771),r(387),r(622)],void 0===(o=function(e,t,r,n,o,i,s,a,u,l,d,c,p){function f(e){return e&&parseInt(e.substring(e.lastIndexOf("/")+1,e.length),10)}function h(e,t){var r,n=t[0],o=t[1],i=t[2],s=t[3],a=0;n<e[0]&&(a+=(r=e[0]-n)*r);o<e[1]&&(a+=(r=e[1]-o)*r);i<e[2]&&(a+=(r=e[2]-i)*r);n>e[3]&&(a+=(r=n-e[3])*r);o>e[4]&&(a+=(r=o-e[4])*r);i>e[5]&&(a+=(r=i-e[5])*r);if(a>s*s)return 0;if(a>0)return 1;var u=1/0;return n-e[0]<u&&(u=n-e[0]),o-e[1]<u&&(u=o-e[1]),i-e[2]<u&&(u=i-e[2]),e[3]-n<u&&(u=e[3]-n),e[4]-o<u&&(u=e[4]-o),e[5]-i<u&&(u=e[5]-i),u>s?2:1}function g(e,t,r){for(var n=[],o=r&&r.missingFields,i=r&&r.originalFields,s=0,a=e;s<a.length;s++){for(var u=a[s],l=u.toLowerCase(),d=!1,c=0,p=t;c<p.length;c++){var f=p[c];if(l===f.name.toLowerCase()){n.push(f.name),d=!0,i&&i.push(u);break}}!d&&o&&o.push(u)}return n}function y(e,t,r){if(null!=e.maxRecordCount&&t.length>e.maxRecordCount){var i=function(e,t){for(var r=e.length,n=Math.ceil(r/t),o=[],i=0;i<n;i++){var s=Math.floor(r*i/n),a=Math.floor(r*(i+1)/n);o.push(e.slice(s,a))}return o}(t,e.maxRecordCount);return o.all(i.map(function(t){return y(e,t,r)})).then(b)}var s=new l({objectIds:t,outFields:r,orderByFields:[e.objectIdField]});return new u(e.parsedUrl.path).execute(s).then(function(e){return e&&e.features&&e.features.length===t.length?e.features.map(function(e){return e.attributes}):o.reject(new n("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer"))})}function v(e,t,s,a,u){for(var l=[],c=0;c<t.attributeData.length;c++){var p=t.attributeData[c],f=e[c];if(f&&-1!==a.indexOf(f.name)){var h=i.makeAbsolute(p.href,t.baseUrl);l.push({url:h,storageInfo:f})}}return o.eachAlways(l.map(function(e){return r(e.url,{responseType:"array-buffer"}).then(function(t){return d.readBinaryAttribute(e.storageInfo,t.data)})})).then(function(e){var t=[];if(!u.ignoreUnavailableFields&&e.some(function(e){return null==e.value})){for(var r=[],i=0;i<e.length;i++)null==e[i].value&&r.push({name:l[i].storageInfo.name,error:e[i].error});return o.reject(new n("scenelayer:attribute-request-failed","Request for scene layer attributes failed",{failedAttributes:r}))}for(var a=0,d=s;a<d.length;a++){var c=d[a],p={};for(i=0;i<e.length;i++)null!=e[i].value&&(p[l[i].storageInfo.name]=m(e[i].value,c));t.push(p)}return t})}function m(e,t){var r=e[t];return p.isInt16Array(e)?r===j?null:r:p.isInt32Array(e)?r===k?null:r:r!=r?null:r}function b(e){for(var t=[],r=0,n=e;r<n.length;r++){var o=n[r];t=t.concat(o)}return t}function _(e){var t=new s(f(e.store.indexCRS||e.store.geographicCRS));return t.equals(e.spatialReference)?e.spatialReference:t}function w(e){var t=new s(f(e.store.vertexCRS||e.store.projectedCRS));return t.equals(e.spatialReference)?e.spatialReference:t}function S(e,t,r){if(!a.canProject(e,t))throw new n("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if("local"===r&&e.isGeographic)throw new n("layerview:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes",{})}function x(e,t,r){var n=_(e),o=w(e);S(n,t,r),S(o,t,r)}function P(e){return"mesh-3d"===e.type}Object.defineProperty(t,"__esModule",{value:!0}),t.DDS_ENCODING_STRING="image/vnd-ms.dds",t.BROWSER_SUPPORTED_IMAGE_ENCODING_STRINGS=["image/jpeg","image/png"],t.extractWkid=f,t.getAppropriateTextureEncoding=function(e,r){if(Array.isArray(e)){if(r){var n=e.indexOf(t.DDS_ENCODING_STRING);if(n>-1)return n}for(var o=0;o<e.length;o++)if(t.BROWSER_SUPPORTED_IMAGE_ENCODING_STRINGS.indexOf(e[o])>-1)return o;throw new Error("Could not find appropriate texture encoding (among "+e.toString()+")")}return-1},t.findIntersectingNodes=function e(t,r,n,o,i,s){if(null!=n){var a=n.mbs;if(r!==o&&(a=I,c.mbsToMbs(n.mbs,o,a,r)),0!==h(t,a)&&(s(n),n.children))for(var u=0;u<n.children.length;++u)e(t,r,i[n.children[u].id],o,i,s)}},t.buildTopNodeMap=function(e,t,r,n){if(void 0===n&&(n=Number.POSITIVE_INFINITY),t<=0)e.clear();else{var o=new Map,i=Number.POSITIVE_INFINITY;e.forEach(function(s,a){var u=r(s);if(a<t)return i=Math.min(i,u),void o.set(s.id,u);if(!(u<=i||u>=n)){o.set(s.id,u);for(var l=i=o.get(e.front().id),d=0,c=1;c<t;++c){var p=e.data[c],f=o.get(p.id);f<i&&(d=c,l=i,i=f)}e.data[d]=s,i=l}}),e.length=Math.min(e.length,t),e.sort(function(e,t){return o.get(t.id)-o.get(e.id)})}};var I=[0,0,0,0];t.intersectBoundingBoxWithMbs=h,t.findFieldsCaseInsensitive=g,t.whenGraphicAttributes=function(e,t,r,i,s,a){var u=!0===(a&&a.populateObjectId),l=a.ignoreUnavailableFields?void 0:[],d=1===i.length&&"*"===i[0];!d&&u&&(i=function(e,t){return e.filter(function(e){return e.toLowerCase()!==t.toLowerCase()}).concat([t])}(i,r));var c=d?i:g(i,e.fields,{missingFields:l});if(l&&0!==l.length)return o.reject(new n("scenelayer:unknown-fields","This scene layer does not have the requested fields",{unknownFields:l}));if(0===t.length)return o.resolve(t);var p=e.associatedLayer,f=e.attributeStorageInfo,h=d?e.fields.map(function(e){return e.name}):c;if(p)return function(e,t,r,n){t.sort(function(e,t){return e.attributes[r]-t.attributes[r]});var o=t.map(function(e){return e.attributes[r]}),i=[],s=g(n,e.fields,{originalFields:i});return y(e,o,s).then(function(e){for(var r=0;r<t.length;r++){var n=t[r],o=e[r];n.attributes={};for(var a=0;a<i.length;a++)n.attributes[i[a]]=o[s[a]]}return t})}(p,t,r,h);var m=function(e,t){for(var r=[],n=0,o=e;n<o.length;n++){var i=o[n];i in t.attributes||r.push(i)}return r}(h,t[0]);if(0===m.length)return o.resolve(t);if(f){var b=s();return null==b?o.reject(new n("scenelayer:feature-not-loaded","Tried to query attributes for unloaded features")):v(f,b.node,b.indices,m,a).then(function(e){for(var r=0;r<t.length;r++){for(var n=0,o=h;n<o.length;n++){var i=o[n];i in e[r]||(e[r][i]=t[r].attributes[i])}t[r].attributes=e[r]}return t})}return o.reject(new n("scenelayer:no-attribute-source","This scene layer does not have a source for attributes available"))};var j=-Math.pow(2,15),k=-Math.pow(2,31);t.getCachedAttributeValue=m,t.convertFlatRangesToOffsets=function(e,t,r){void 0===r&&(r=2);for(var o=null!=t?t:e.length/r,i=new Uint32Array(o+1),s=0;s<o;s++){var a=e[s*r],u=3*a;i[s]=u;var l=(s-1)*r+1;if(l>=0&&a-1!==e[l])throw new n("Face ranges are not continuous")}var d=3*(e[(o-1)*r+1]+1);return i[i.length-1]=d,i},t.getIndexCrs=_,t.getVertexCrs=w,t.getCacheKeySuffix=function(e,t){return t===c.SphericalECEFSpatialReference?"@ECEF":e.equals(t)?"":null!=t.wkid?"@"+t.wkid:null},t.checkSpatialReference=S,t.checkSpatialReferences=x,t.checkSceneLayerValid=function(e){if(null==e.store||null==e.store.defaultGeometrySchema||!function(e){return!(null!=e.geometryType&&"triangles"!==e.geometryType||null!=e.topology&&"PerAttributeArray"!==e.topology||null==e.vertexAttributes||null==e.vertexAttributes.position)}(e.store.defaultGeometrySchema))throw new n("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{})},t.checkSceneLayerCompatibleWithView=function(e,t){x(e,t.spatialReference,t.viewingMode)},t.checkPointCloudLayerValid=function(e){if(null==e.store||null==e.store.defaultGeometrySchema||!function(e){return!(null==e.geometryType||"points"!==e.geometryType||null!=e.topology&&"PerAttributeArray"!==e.topology||null!=e.encoding&&""!==e.encoding&&"lepcc-xyz"!==e.encoding||null==e.vertexAttributes||null==e.vertexAttributes.position)}(e.store.defaultGeometrySchema))throw new n("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{})},t.checkPointCloudLayerCompatibleWithView=function(e,t){S(e.spatialReference,t.spatialReference,t.viewingMode)},t.rendererNeedsTextures=function(e){if(null==e||!function(e){return"simple"===e.type||"class-breaks"===e.type||"unique-value"===e.type}(e))return!0;if(("unique-value"===e.type||"class-breaks"===e.type)&&null==e.defaultSymbol)return!0;var t=e.getSymbols();if(0===t.length)return!0;for(var r=0,n=t;r<n.length;r++){var o=n[r];if(!P(o)||0===o.symbolLayers.length)return!0;for(var i=0,s=o.symbolLayers.items;i<s.length;i++){var a=s[i];if("fill"!==a.type||null==a.material||"replace"!==a.material.colorMixMode)return!0}}return!1};var O=function(){return function(){this.edges=null,this.material=null}}();t.SymbolInfo=O,t.getSymbolInfo=function(e){for(var t=new O,r=!1,n=!1,o=0,i=e.symbolLayers.items;o<i.length;o++){var s=i[o];if("fill"===s.type&&s.enabled){var a=s.material,u=s.edges;if(a&&!r){var l=a.color;t.material={color:l?[l.r/255,l.g/255,l.b/255]:null,alpha:l?l.a:null,colorMixMode:a.colorMixMode},r=!0}u&&!n&&(t.edges=s.edges,n=!0)}}return t}}.apply(null,n))||(e.exports=o)},771:function(e,t,r){var n,o;n=[r.dj.c(e.i),t,r(341),r(338),r(343),r(975)],void 0===(o=function(e,t,r,n,o,i){function s(e,t,n){for(var o="",i=0;i<n;){var s=e[t+i];if(s<128)o+=String.fromCharCode(s),i++;else if(s>=192&&s<224){if(i+1>=n)throw new r("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");var a=(31&s)<<6|63&e[t+i+1];o+=String.fromCharCode(a),i+=2}else if(s>=224&&s<240){if(i+2>=n)throw new r("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");a=(15&s)<<12|(63&e[t+i+1])<<6|63&e[t+i+2];o+=String.fromCharCode(a),i+=3}else{if(!(s>=240&&s<248))throw new r("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");if(i+3>=n)throw new r("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");if((a=(7&s)<<18|(63&e[t+i+1])<<12|(63&e[t+i+2])<<6|63&e[t+i+3])>=65536){var u=55296+(a-65536>>10),l=56320+(1023&a);o+=String.fromCharCode(u,l)}else o+=String.fromCharCode(a);i+=4}}return o}function a(e,r){for(var n={byteOffset:0,byteCount:0,fields:Object.create(null)},o=0,i=0;i<r.length;i++){var s=r[i],a=s.valueType||s.type,u=t.valueType2ArrayBufferReader[a];n.fields[s.property]=u(e,o),o+=t.valueType2TypedArrayClassMap[a].BYTES_PER_ELEMENT}return n.byteCount=o,n}function u(e,t,n){var o,i,a=[],u=0;for(i=0;i<e;i+=1){if((o=t[i])>0){if(a.push(s(n,u,o-1)),0!==n[u+o-1])throw new r("string-array-error","Invalid string array: missing null termination.")}else a.push(null);u+=o}return a}function l(e,r){return new(0,t.valueType2TypedArrayClassMap[r.valueType])(e,r.byteOffset,r.count*r.valuesPerElement)}function d(e,t){return new Uint8Array(e,t.byteOffset,t.byteCount)}function c(e,t,o){for(var i=null!=t.header?a(e,t.header):{byteOffset:0,byteCount:0,fields:{count:o}},s={header:i,byteOffset:i.byteCount,byteCount:0,entries:Object.create(null)},u=i.byteCount,l=0;l<t.ordering.length;l++){var d=t.ordering[l],c=n.clone(t[d]);if(c.count=i.fields.count,"String"===c.valueType){if(c.byteOffset=u,c.byteCount=i.fields[d+"ByteCount"],"UTF-8"!==c.encoding)throw new r("unsupported-encoding","Unsupported String encoding.",{encoding:c.encoding})}else{if(!f(c.valueType))throw new r("unsupported-value-type","Unsupported binary valueType",{valueType:c.valueType});var p=h(c.valueType);u+=u%p!=0?p-u%p:0,c.byteOffset=u,c.byteCount=p*c.valuesPerElement*c.count}u+=c.byteCount,s.entries[d]=c}return s.byteCount=u-s.byteOffset,s}function p(e,t,n){if(t!==e&&g.error("Invalid "+n+" buffer size\n expected: "+e+", actual: "+t+")"),t<e)throw new r("buffer-too-small","Binary buffer is too small",{expectedSize:e,actualSize:t})}function f(e){return t.valueType2TypedArrayClassMap.hasOwnProperty(e)}function h(e){return f(e)&&t.valueType2TypedArrayClassMap[e].BYTES_PER_ELEMENT}Object.defineProperty(t,"__esModule",{value:!0});var g=o.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader");t.readHeader=a,t.readStringArray=u,t.createTypedView=l,t.createRawView=d,t.createAttributeDataIndex=c,t.createGeometryDataIndex=function(e,t,r){var o=a(e,t&&t.header),i=o.byteCount,s={header:o,byteOffset:o.byteCount,byteCount:0,vertexAttributes:n.clone(t.vertexAttributes)},u=s.vertexAttributes;r||null==u.region||delete u.region;for(var l=o.fields,d=null!=l.vertexCount?l.vertexCount:l.count,c=0;c<t.ordering.length;c++){var f=t.ordering[c];null!=u[f]&&(u[f].byteOffset=i,u[f].count=d,i+=h(u[f].valueType)*u[f].valuesPerElement*d)}var g=l.faceCount;if(t.faces&&g){s.faces=n.clone(t.faces);var y=s.faces;for(c=0;c<t.ordering.length;c++){var v=t.ordering[c];null!=y[v]&&(y[v].byteOffset=i,y[v].count=g,i+=h(y[v].valueType)*y[v].valuesPerElement*g)}}var m=l.featureCount;if(t.featureAttributes&&t.featureAttributeOrder&&m){s.featureAttributes=n.clone(t.featureAttributes);var b=s.featureAttributes;for(c=0;c<t.featureAttributeOrder.length;c++){var _=t.featureAttributeOrder[c];b[_].byteOffset=i,b[_].count=m;var w=h(b[_].valueType);"UInt64"===b[_].valueType&&(w=8),i+=w*b[_].valuesPerElement*m}}return p(i,e.byteLength,"geometry"),s.byteCount=i-s.byteOffset,s},t.readBinaryAttribute=function(e,t,n){if("lepcc-rgb"===e.encoding)return i.decodeRGB(t);if("lepcc-intensity"===e.encoding)return i.decodeIntensity(t);if(null!=e.encoding&&""!==e.encoding)throw new r("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");e["attributeByteCounts "]&&!e.attributeByteCounts&&(g.warn("Warning: Trailing space in 'attributeByteCounts '."),e.attributeByteCounts=e["attributeByteCounts "]),"ObjectIds"===e.ordering[0]&&e.hasOwnProperty("objectIds")&&(g.warn("Warning: Case error in objectIds"),e.ordering[0]="objectIds");var o=c(t,e,n);p(o.byteOffset+o.byteCount,t.byteLength,"attribute");var s=o.entries.attributeValues||o.entries.objectIds;if(s){if("String"===s.valueType){var a=o.entries.attributeByteCounts,f=l(t,a),h=d(t,s);return u(a.count,f,h)}return l(t,s)}throw new r("bad-attribute-storage-info","Bad attributeStorageInfo specification.")},t.valueType2TypedArrayClassMap={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array},t.valueType2ArrayBufferReader={Float32:function(e,t){return new DataView(e,0).getFloat32(t,!0)},Float64:function(e,t){return new DataView(e,0).getFloat64(t,!0)},UInt8:function(e,t){return new DataView(e,0).getUint8(t)},Int8:function(e,t){return new DataView(e,0).getInt8(t)},UInt16:function(e,t){return new DataView(e,0).getUint16(t,!0)},Int16:function(e,t){return new DataView(e,0).getInt16(t,!0)},UInt32:function(e,t){return new DataView(e,0).getUint32(t,!0)},Int32:function(e,t){return new DataView(e,0).getInt32(t,!0)}},t.isValueType=f,t.getBytesPerValue=h}.apply(null,n))||(e.exports=o)},975:function(e,t,r){var n,o;n=[r.dj.c(e.i),t,r(341)],void 0===(o=function(e,t,r){function n(e,t,r){return{identifier:String.fromCharCode.apply(null,new Uint8Array(e,r+d.identifierOffset,d.identifierLength)),version:t.getUint16(r+d.versionOffset,l),checksum:t.getUint32(r+d.checksumOffset,l)}}function o(e,t){return{sizeLo:e.getUint32(t+c.sizeLo,l),sizeHi:e.getUint32(t+c.sizeHi,l),minX:e.getFloat64(t+c.minX,l),minY:e.getFloat64(t+c.minY,l),minZ:e.getFloat64(t+c.minZ,l),maxX:e.getFloat64(t+c.maxX,l),maxY:e.getFloat64(t+c.maxY,l),maxZ:e.getFloat64(t+c.maxZ,l),errorX:e.getFloat64(t+c.errorX,l),errorY:e.getFloat64(t+c.errorY,l),errorZ:e.getFloat64(t+c.errorZ,l),count:e.getUint32(t+c.count,l),reserved:e.getUint32(t+c.reserved,l)}}function i(e,t,r){var n=[];t=s(e,t,n);for(var o=[],i=0;i<n.length;i++){o.length=0,t=s(e,t,o);for(var a=0;a<o.length;a++)r.push(o[a]+n[i])}return t}function s(e,t,n){var o=new DataView(e,t),i=o.getUint8(0),s=31&i,a=!!(32&i),u=(192&i)>>6,d=0;if(0===u)d=o.getUint32(1,l),t+=5;else if(1===u)d=o.getUint16(1,l),t+=3;else{if(2!==u)throw new r("lepcc-decode-error","Bad count type");d=o.getUint8(1),t+=2}if(a)throw new r("lepcc-decode-error","LUT not implemented");for(var c=Math.ceil(d*s/8),p=new Uint8Array(e,t,c),f=0,h=0,g=0,y=-1>>>32-s,v=0;v<d;v++){for(;h<s;)f|=p[g]<<h,h+=8,g+=1;n[v]=f&y,f>>>=s,(h-=s)+s>32&&(f|=p[g-1]>>8-h)}return t+g}function a(e,t){return{sizeLo:e.getUint32(t+p.sizeLo,l),sizeHi:e.getUint32(t+p.sizeHi,l),count:e.getUint32(t+p.count,l),colorMapCount:e.getUint16(t+p.colorMapCount,l),lookupMethod:e.getUint8(t+p.lookupMethod),compressionMethod:e.getUint8(t+p.compressionMethod)}}function u(e,t){return{sizeLo:e.getUint32(t+f.sizeLo,l),sizeHi:e.getUint32(t+f.sizeHi,l),count:e.getUint32(t+f.count,l),scaleFactor:e.getUint16(t+f.scaleFactor,l),bitsPerPoint:e.getUint8(t+f.bitsPerPoint),reserved:e.getUint8(t+f.reserved)}}Object.defineProperty(t,"__esModule",{value:!0});var l=!0,d={identifierOffset:0,identifierLength:10,versionOffset:10,checksumOffset:12,byteCount:16},c={sizeLo:0,sizeHi:4,minX:8,minY:16,minZ:24,maxX:32,maxY:40,maxZ:48,errorX:56,errorY:64,errorZ:72,count:80,reserved:84,byteCount:88};t.decodeXYZ=function(e){var t=new DataView(e,0),s=0,a=n(e,t,s),u=a.identifier,l=a.version;if(s+=d.byteCount,"LEPCC     "!==u)throw new r("lepcc-decode-error","Bad identifier");if(l>1)throw new r("lepcc-decode-error","Unknown version");var p=o(t,s);if(s+=c.byteCount,p.sizeHi*Math.pow(2,32)+p.sizeLo!==e.byteLength)throw new r("lepcc-decode-error","Bad size");var f=new Float64Array(3*p.count),h=[],g=[],y=[],v=[];if(s=i(e,s,h),s=i(e,s,g),s=i(e,s,y),(s=i(e,s,v))!==e.byteLength)throw new r("lepcc-decode-error","Bad length");for(var m=0,b=0,_=0;_<h.length;_++){b+=h[_];for(var w=0,S=0;S<g[_];S++){w+=y[m];var x=v[m];f[3*m]=Math.min(p.maxX,p.minX+2*p.errorX*w),f[3*m+1]=Math.min(p.maxY,p.minY+2*p.errorY*b),f[3*m+2]=Math.min(p.maxZ,p.minZ+2*p.errorZ*x),m++}}return{errorX:p.errorX,errorY:p.errorY,errorZ:p.errorZ,result:f}};var p={sizeLo:0,sizeHi:4,count:8,colorMapCount:12,lookupMethod:14,compressionMethod:15,byteCount:16};t.decodeRGB=function(e){var t=new DataView(e,0),o=0,i=n(e,t,o),s=i.identifier,u=i.version;if(o+=d.byteCount,"ClusterRGB"!==s)throw new r("lepcc-decode-error","Bad identifier");if(u>1)throw new r("lepcc-decode-error","Unknown version");var l=a(t,o);if(o+=p.byteCount,l.sizeHi*Math.pow(2,32)+l.sizeLo!==e.byteLength)throw new r("lepcc-decode-error","Bad size");if(2!==l.lookupMethod&&1!==l.lookupMethod||0!==l.compressionMethod){if(0===l.lookupMethod&&0===l.compressionMethod){if(3*l.count+o!==e.byteLength||0!==l.colorMapCount)throw new r("lepcc-decode-error","Bad count");return new Uint8Array(e,o).slice()}if(l.lookupMethod<=2&&1===l.compressionMethod){if(o+3!==e.byteLength||1!==l.colorMapCount)throw new r("lepcc-decode-error","Bad count");for(var c=t.getUint8(o),f=t.getUint8(o+1),h=t.getUint8(o+2),g=new Uint8Array(3*l.count),y=0;y<l.count;y++)g[3*y]=c,g[3*y+1]=f,g[3*y+2]=h;return g}throw new r("lepcc-decode-error","Bad method "+l.lookupMethod+","+l.compressionMethod)}if(3*l.colorMapCount+l.count+o!==e.byteLength||l.colorMapCount>256)throw new r("lepcc-decode-error","Bad count");var v=new Uint8Array(e,o,3*l.colorMapCount),m=new Uint8Array(e,o+3*l.colorMapCount,l.count);for(g=new Uint8Array(3*l.count),y=0;y<l.count;y++){var b=m[y];g[3*y]=v[3*b],g[3*y+1]=v[3*b+1],g[3*y+2]=v[3*b+2]}return g};var f={sizeLo:0,sizeHi:4,count:8,scaleFactor:12,bitsPerPoint:14,reserved:15,byteCount:16};t.decodeIntensity=function(e){var t=new DataView(e,0),o=0,i=n(e,t,o),a=i.identifier,l=i.version;if(o+=d.byteCount,"Intensity "!==a)throw new r("lepcc-decode-error","Bad identifier");if(l>1)throw new r("lepcc-decode-error","Unknown version");var c=u(t,o);if(o+=f.byteCount,c.sizeHi*Math.pow(2,32)+c.sizeLo!==e.byteLength)throw new r("lepcc-decode-error","Bad size");var p=new Uint16Array(c.count);if(8===c.bitsPerPoint){if(c.count+o!==e.byteLength)throw new r("lepcc-decode-error","Bad size");for(var h=new Uint8Array(e,o,c.count),g=0;g<c.count;g++)p[g]=h[g]*c.scaleFactor}else if(16===c.bitsPerPoint){if(2*c.count+o!==e.byteLength)throw new r("lepcc-decode-error","Bad size");for(h=new Uint16Array(e,o,c.count),g=0;g<c.count;g++)p[g]=h[g]*c.scaleFactor}else{if(s(e,o,h=[])!==e.byteLength)throw new r("lepcc-decode-error","Bad size");for(g=0;g<c.count;g++)p[g]=h[g]*c.scaleFactor}return p}}.apply(null,n))||(e.exports=o)}}]);