(function(){(this||window).webpackJsonp.registerAbsMids({"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/DefaultVertexAttributeLocations":369,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/graphics/graphicUtils":397,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/tasks/operations/urlUtils":403,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/PooledArray":407,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/glUtil3D":417,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/graphics/OptimizedFeatureSet":425,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/DefaultVertexBufferLayouts":430,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/IdGen":439,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/ModelContentType":445,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/Stage":448,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/graphics/dehydratedFeatures":589,"esri/core/pbf":593,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/pbf":593,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/graphics/Graphics3DSymbolCommonCode":594,"esri/layers/graphics/OptimizedGeometry":595,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/graphics/OptimizedGeometry":595,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/Geometry":596,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/support/debugFlags":601,"esri/layers/graphics/OptimizedFeature":603,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/graphics/OptimizedFeature":603,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lighting/Lightsources":617,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/shaders/MiscPrograms":618,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/tasks/operations/query":627,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/tasks/operations/pbfQueryUtils":628,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/tasks/operations/pbfFeatureServiceParser":629,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/Camera":630,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/support/imageUtils":632,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/materials/DefaultMaterial":633,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/Material":636,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/tasks/operations/queryAttachments":639,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/tasks/QueryTask":647,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/tasks/operations/queryRelatedRecords":648,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/materials/internal/bufferWriters":656,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/HeapSort":666,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/depthRange":668,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/iteratorUtils":680,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/Object3D":684,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/graphics/featureExpressionInfoUtils":687,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/RenderGeometry":688,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/GLMaterial":689,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/Texture":690,"@dojo/framework/shim/Map":705,"esri/views/3d/layers/SceneLayerWorker":716,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/SceneLayerWorker":716,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/HighlightUtils":723,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/parts/Model":724,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/Renderer":725,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/localOriginHelper":726,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/GLMaterialTexture":727,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/SliceHelper":728,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/graphics/dehydratedFeatureComparison":741,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/support/buffer/bufferViewUtil":743,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/materials/HUDMaterial":744,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/support/orientedBoundingBox":762,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/IntegratedMeshLayer":763,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/support/layerViewUpdatingProperties":764,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/i3s/I3SUtil":765,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/Performance":769,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/support/intersectionUtils":770,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/i3s/I3SBinaryReader":771,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/TextureBackedBuffer/BufferManager":780,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/PerformanceTimer":781,"@dojo/framework/shim/array":788,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/support/PromiseLightweight":792,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/ModelDirtySet":813,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/parts/View":814,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/DrapedRenderer":815,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/Float32ArrayList":816,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/FxaaRenderPass":817,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/HighlightTextureHelper":818,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/InstanceBufferData":819,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/IntervalUtilities":820,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/LinearDepthTextureHelper":821,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/NormalTextureHelper":822,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/RenderContext":823,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/RenderPluginManager":824,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/SmaaRenderPass":825,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/StencilRenderingHelper":826,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/edgeRendering/EdgeView":827,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/LocalOriginManager":828,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/RegularGridLocalOriginFactory":829,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/TextureBackedBuffer/ManagedTextureBackedBuffer":830,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/TextureBackedBuffer/SimpleIndexManager":831,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/TextureBackedBuffer/TextureBackedBuffer":832,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/edgeRendering/EdgeRenderer":833,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/shaders/EdgeRendererPrograms":834,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/edgeRendering/strokes":835,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/edgeRendering/util":836,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lighting/SceneLighting":837,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lighting/SphericalHarmonics":838,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/LongVectorMath":839,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/shaders/HUDPrograms":840,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/webgl/Profiling":841,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/materials/internal/TexOnlyGLMaterial":842,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/GLMaterialRep":843,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/GLTextureRep":844,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/tracer":845,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/webgl-debug":846,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/parts/Viewport":847,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/parts/Visualizer":848,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/TimeProfiler":849,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/depthRangeUtils":850,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/HighlightHelper":851,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/shaders/HighlightPrograms":852,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/OffscreenRenderingHelper":853,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/RenderTargetHelper":854,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/shaders/OffscreenPrograms":855,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/RenderOccludedHelper":856,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/shaders/OccludedPrograms":857,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/ShadowMap":858,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/SSAOHelper":859,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/shaders/SSAOPrograms":860,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/shaders/DefaultPrograms":861,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/DDSUtil":862,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/graphics/ElevationContext":890,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/support/Evented":894,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/support/edgeUtils":906,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/Octree":907,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/i3s/LEPCC":975,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/GeometryRecord":1011,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/BoundingInfo":1013,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/support/symbolColorUtils":1014,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/Layer":1015,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/HighlightSet":1016,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/support/attributeUtils":1018,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/support/dito":1023,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/sql/WhereClause":1025,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/sql/AggregateFunctions":1026,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/sql/StandardizedFunctions":1027,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/sql/WhereGrammar":1028,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/sql/sql92grammar":1029,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/i3s/I3SProjectionUtil":1098,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/i3s/IdleQueue":1106,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/SceneLayerView3D":1120,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/i3s/I3SGeometryUtil":1376,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/graphics/controllers/I3SOnDemandController":1393,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/i3s/I3SIndex":1394,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/i3s/I3SLodHandling":1395,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/i3s/I3SNodeLoader":1396,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/i3s/I3SViewportQueries":1397,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/support/ResourceController":1398,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/support/MemoryController":1399,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/support/MemoryManagedLayerView":1400,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/support/MemCache":1401,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/support/StreamDataLoader":1402,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/support/AsyncQuotaRoundRobinQueue":1403,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/support/StreamDataSupplier":1404,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/i3s/I3SQueryEngine":1405,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/i3s/Highlights":1552,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/i3s/I3SElevationProvider":1553,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/Selector":1554,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/i3s/IDBCache":1555})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[66],{1011:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(439)],void 0===(n=function(e,t,r){return function(){function e(t,r,i,n,a,o){this.id=e._idGen.gen(t.id),this.geometry=t,this.materials=r,this.transformation=i,this.instanceParameters=n,this.origin=a,this.customTransformation=o}return e.prototype.getStaticTransformation=function(){return this.transformation},e.prototype.getShaderTransformation=function(){return this.customTransformation?this.customTransformation(this.transformation):this.transformation},e._idGen=new r,e}()}.apply(null,i))||(e.exports=n)},1013:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(407),r(342),r(348)],void 0===(n=function(e,t,r,i,n){var a=function(){function e(e,t,r,a){n.assert(e.length>=1),n.assert(r.length%t==0),n.assert(r.length>=e.length*t),n.assert(3===a.size||4===a.size),this.primitiveIndices=e,this.indices=r,this._position=a,this._numIndexPerPrimitive=t;var s=a.data,u=a.offsetIdx,l=a.strideIdx,d=0,c=e.length,h=u+l*r[t*e[d]];for(o.clear(),o.push(h),this.bbMin=i.vec3d.createFrom(s[h],s[h+1],s[h+2]),this.bbMax=i.vec3d.create(this.bbMin);d<c;++d)for(var p=t*e[d],f=0;f<t;++f){h=u+l*r[p+f],o.push(h);var g=s[h];this.bbMin[0]=Math.min(g,this.bbMin[0]),this.bbMax[0]=Math.max(g,this.bbMax[0]),g=s[h+1],this.bbMin[1]=Math.min(g,this.bbMin[1]),this.bbMax[1]=Math.max(g,this.bbMax[1]),g=s[h+2],this.bbMin[2]=Math.min(g,this.bbMin[2]),this.bbMax[2]=Math.max(g,this.bbMax[2])}this.center=i.vec3d.create(),i.vec3d.lerp(this.bbMin,this.bbMax,.5,this.center),this.bsRadius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);var m=this.bsRadius*this.bsRadius;for(d=0;d<o.length;++d){var v=s[h=o.data[d]]-this.center[0],y=s[h+1]-this.center[1],_=s[h+2]-this.center[2],b=v*v+y*y+_*_;if(!(b<=m)){var x=Math.sqrt(b),w=.5*(x-this.bsRadius);this.bsRadius=this.bsRadius+w,m=this.bsRadius*this.bsRadius;var S=w/x;this.center[0]+=v*S,this.center[1]+=y*S,this.center[2]+=_*S}}o.clear()}return e.prototype.getCenter=function(){return this.center},e.prototype.getBSRadius=function(){return this.bsRadius},e.prototype.getBBMin=function(){return this.bbMin},e.prototype.getBBMax=function(){return this.bbMax},e.prototype.getPrimitiveIndices=function(){return this.primitiveIndices},e.prototype.getIndices=function(){return this.indices},e.prototype.getPosition=function(){return this._position},e.prototype.getChildren=function(){if(this.children)return this.children;if(i.vec3d.dist2(this.bbMin,this.bbMax)>1){for(var t=i.vec3d.lerp(this.bbMin,this.bbMax,.5,i.vec3d.create()),r=this.primitiveIndices.length,n=new Uint8Array(r),a=new Array(8),o=0;o<8;++o)a[o]=0;var s=this._position,u=s.data,l=s.offsetIdx,d=s.strideIdx;for(o=0;o<r;++o){for(var c=0,h=this._numIndexPerPrimitive*this.primitiveIndices[o],p=l+d*this.indices[h],f=u[p],g=u[p+1],m=u[p+2],v=1;v<this._numIndexPerPrimitive;++v){var y=u[p=l+d*this.indices[h+v]],_=u[p+1],b=u[p+2];y<f&&(f=y),_<g&&(g=_),b<m&&(m=b)}f<t[0]&&(c|=1),g<t[1]&&(c|=2),m<t[2]&&(c|=4),n[o]=c,++a[c]}var x=0;for(o=0;o<8;++o)a[o]>0&&++x;if(x<2)return;var w=new Array(8);for(o=0;o<8;++o)w[o]=a[o]>0?new Uint32Array(a[o]):void 0;for(o=0;o<8;++o)a[o]=0;for(o=0;o<r;++o){w[c=n[o]][a[c]++]=this.primitiveIndices[o]}this.children=new Array(8);for(o=0;o<8;++o)void 0!==w[o]&&(this.children[o]=new e(w[o],this._numIndexPerPrimitive,this.indices,this._position))}return this.children},e}(),o=new r;return a}.apply(null,i))||(e.exports=n)},1014:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.encodeSymbolColor=function(e,t,a,o){if(void 0===o&&(o=0),null==e||"ignore"===t)return a[o+0]=255,a[o+1]=255,a[o+2]=255,void(a[o+3]=255);a[o+0]=Math.floor(255*e[0]),a[o+1]=Math.floor(255*e[1]),a[o+2]=Math.floor(255*e[2]);var s=Math.floor(e[3]*r);a[o+3]=0===s?0:"tint"===t?s:"replace"===t?s+i:s+n},t.isOpaqueSymbolColor=function(e,t){void 0===t&&(t=0);var r=e[t+3];return r===i||r===n||r===a};var r=85,i=r,n=2*r,a=3*r}.apply(null,i))||(e.exports=n)},1015:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(379),r(342),r(439),r(445),r(907)],void 0===(n=function(e,t,r,i,n,a,o){return function(){function e(t,r,n){this._parentStages=[],this._children=new Set,this.id=e._idGen.gen(n),this.name=t,r=r||{},this.group=r.group||"",this.isPickable=null==r.isPickable||r.isPickable,this.translation=i.vec3d.create(r.translation),this._extent=[i.vec3d.createFrom(0,0,0),i.vec3d.createFrom(1e3,1e3,1e3)],this._extentDirty=!0}return e.prototype.getParentStages=function(){return this._parentStages},e.prototype.addParentStage=function(e){-1===this._parentStages.indexOf(e)&&this._parentStages.push(e)},e.prototype.removeParentStage=function(e){var t=this._parentStages.indexOf(e);t>-1&&this._parentStages.splice(t,1)},e.prototype.getName=function(){return this.name},e.prototype.getGroup=function(){return this.group},e.prototype.getTranslation=function(){return this.translation},e.prototype.getObjectIds=function(){return r.keysOfSet(this._children,function(e){return e.id})},e.prototype.getObjects=function(){return r.keysOfSet(this._children)},e.prototype.getExtent=function(){return this._updateExtent(),this._extent},e.prototype.addObject=function(e){this._children.add(e),e.addParentLayer(this),this.notifyDirty("layObjectAdded",e),this._invalidateExtent(),this._octree&&this._octree.add(e)},e.prototype.hasObject=function(e){return this._children.has(e)},e.prototype.removeObject=function(e){return!!this._children.delete(e)&&(e.removeParentLayer(this),this.notifyDirty("layObjectRemoved",e),this._invalidateExtent(),this._octree&&this._octree.remove(e),!0)},e.prototype.notifyObjectBBChanged=function(e,t){this._octree&&this._octree.update(e,t)},e.prototype.getCenter=function(){this._updateExtent();var e=i.vec3d.create();return i.vec3d.lerp(this._extent[0],this._extent[1],.5,e)},e.prototype.getBSRadius=function(){return this._updateExtent(),.5*i.vec3d.dist(this._extent[0],this._extent[1])},e.prototype.getSpatialQueryAccelerator=function(){return!this._octree&&this._children.size>50&&this._createOctree(),this._octree},e.prototype.shaderTransformationChanged=function(){this.notifyDirty("shaderTransformationChanged",null)},e.prototype.invalidateSpatialQueryAccelerator=function(){this._octree=null},e.prototype.notifyDirty=function(e,t,r,i){r=r||a.LAYER;for(var n=i||this,o=0;o<this._parentStages.length;o++)this._parentStages[o].notifyDirty(r,n,e,t)},e.prototype._createOctree=function(){for(var e=this.getExtent(),t=0,n=0;n<3;n++)t=Math.max(t,e[1][n]-e[0][n]);var a=i.vec3d.create();i.vec3d.lerp(e[0],e[1],.5,a),this._octree=new o(a,1.2*t,{getRadius:function(e){return e.getBSRadius()},getCenter:function(e){return e.getCenter()}}),this._octree.add(r.keysOfSet(this._children))},e.prototype._invalidateExtent=function(){this._extentDirty=!0},e.prototype._updateExtent=function(){var e=this;if(this._extentDirty){if(this._extentDirty=!1,0===this._children.size)return void(this._extent=[[0,0,0],[0,0,0]]);var t=null;this._children.forEach(function(r){var n=r.getBBMin(),a=r.getBBMax();if(t)for(var o=0;o<3;++o)e._extent[0][o]=Math.min(e._extent[0][o],n[o]),e._extent[1][o]=Math.max(e._extent[1][o],a[o]);else t=[i.vec3d.create(n),i.vec3d.create(a)]}),this._extent=t}},e._idGen=new n,e}()}.apply(null,i))||(e.exports=n)},1016:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){return function(){function e(){this.items=[]}return e.prototype.addObject=function(e,t){this.items.push({type:"object",highlightId:t,object:e})},e.prototype.addRenderGeometry=function(e,t,r){this.items.push({type:"renderGeometry",highlightId:r,renderGeometry:e,renderer:t})},e.prototype.addExternal=function(e,t){this.items.push({type:"external",highlightId:t,remove:e})},e.prototype.remove=function(e){for(var t=this.items.length-1;t>=0;--t){var r=this.items[t];r.highlightId===e&&(this.removeHighlight(r),this.items.splice(t,1))}},e.prototype.removeObject=function(e){for(var t=this.items.length-1;t>=0;--t){var r=this.items[t];"object"===r.type&&r.object===e&&(this.removeHighlight(r),this.items.splice(t,1))}},e.prototype.removeRenderGeometry=function(e){for(var t=this.items.length-1;t>=0;--t){var r=this.items[t];"renderGeometry"===r.type&&r.renderGeometry===e&&(this.removeHighlight(r),this.items.splice(t,1))}},e.prototype.removeAll=function(){var e=this;this.items.forEach(function(t){e.removeHighlight(t)}),this.items=[]},e.prototype.removeHighlight=function(e){switch(e.type){case"object":e.object.removeHighlights(e.highlightId);break;case"renderGeometry":e.renderer.removeRenderGeometryHighlight(e.renderGeometry,e.highlightId);break;case"external":e.remove(e.highlightId)}},e}()}.apply(null,i))||(e.exports=n)},1018:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.attributeLookup=function(e,t){for(var r=t.toLowerCase(),i=0,n=Object.keys(e);i<n.length;i++){var a=n[i];if(a.toLowerCase()===r)return e[a]}return null}}.apply(null,i))||(e.exports=n)},1023:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(342)],void 0===(n=function(e,t,r){function i(e,t,i,n,a,s,u,l,d,c,h){return function(e,t,i){for(var n=r.vec3d.dist2(e.maxVert[0],e.minVert[0]),a=0,o=1;o<7;++o){var s=r.vec3d.dist2(e.maxVert[o],e.minVert[o]);s>n&&(n=s,a=o)}r.vec3d.set(e.minVert[a],t),r.vec3d.set(e.maxVert[a],i)}(e,n,a),r.vec3d.dist2(n,a)<p?1:(r.vec3d.subtract(n,a,u),r.vec3d.normalize(u),function(e,t,i,n){for(var a=e.data,o=e.offsetIdx,s=e.strideIdx,u=Number.NEGATIVE_INFINITY,l=0,d=o;d<a.length;d+=s){r.vec3d.set3(a[d]-t[0],a[d+1]-t[1],a[d+2]-t[2],T);var c=i[0]*T[0]+i[1]*T[1]+i[2]*T[2],h=r.vec3d.length2(i),p=r.vec3d.length2(T)-c*c/h;p>u&&(u=p,l=d)}return r.vec3d.set3(a[l],a[l+1],a[l+2],n),u}(t,n,u,s)<p?2:(r.vec3d.subtract(a,s,l),r.vec3d.normalize(l),r.vec3d.subtract(s,n,d),r.vec3d.normalize(d),r.vec3d.cross(l,u,i),r.vec3d.normalize(i),o(t,i,u,l,d,c),0))}function n(e,t,i,n,s,u,l,d,c,h){a(e,t,i,n,s,m,v),void 0!==m[0]&&(r.vec3d.subtract(m,i,y),r.vec3d.normalize(y),r.vec3d.subtract(m,n,_),r.vec3d.normalize(_),r.vec3d.subtract(m,s,b),r.vec3d.normalize(b),r.vec3d.cross(_,u,x),r.vec3d.normalize(x),r.vec3d.cross(b,l,w),r.vec3d.normalize(w),r.vec3d.cross(y,d,S),r.vec3d.normalize(S),o(e,x,u,_,y,c),o(e,w,l,b,_,c),o(e,S,d,y,b,c)),void 0!==v[0]&&(r.vec3d.subtract(v,i,y),r.vec3d.normalize(y),r.vec3d.subtract(v,n,_),r.vec3d.normalize(_),r.vec3d.subtract(v,s,b),r.vec3d.normalize(b),r.vec3d.cross(_,u,x),r.vec3d.normalize(x),r.vec3d.cross(b,l,w),r.vec3d.normalize(w),r.vec3d.cross(y,d,S),r.vec3d.normalize(S),o(e,x,u,_,y,c),o(e,w,l,b,_,c),o(e,S,d,y,b,c))}function a(e,t,i,n,a,o,s){!function(e,t,i,n,a){var o=e.data,s=e.offsetIdx,u=e.strideIdx;r.vec3d.set3(o[s],o[s+1],o[s+2],n),r.vec3d.set(n,a),i[0]=r.vec3d.dot(A,t),i[1]=i[0];for(var l=s+u;l<o.length;l+=u){r.vec3d.set3(o[l],o[l+1],o[l+2],A);var d=r.vec3d.dot(A,t);d<i[0]&&(i[0]=d,r.vec3d.set(A,n)),d>i[1]&&(i[1]=d,r.vec3d.set(A,a))}}(e,t,O,s,o);var u=r.vec3d.dot(i,t);O[1]-p<=u&&(o[0]=void 0),O[0]+p>=u&&(s[0]=void 0)}function o(e,t,i,n,a,o){if(!(r.vec3d.length2(t)<p)){r.vec3d.cross(i,t,C),r.vec3d.cross(n,t,M),r.vec3d.cross(a,t,R),s(e,t,O),E[1]=O[0],P[1]=O[1],I[1]=P[1]-E[1];for(var u=[i,n,a],l=[C,M,R],d=0;d<3;++d){s(e,u[d],O),E[0]=O[0],P[0]=O[1],s(e,l[d],O),E[2]=O[0],P[2]=O[1],I[0]=P[0]-E[0],I[2]=P[2]-E[2];var c=h(I);c<o.quality&&(r.vec3d.set(u[d],o.b0),r.vec3d.set(t,o.b1),r.vec3d.set(l[d],o.b2),o.quality=c)}}}function s(e,t,r){var i=e.data,n=e.offsetIdx,a=e.strideIdx;r[0]=Number.POSITIVE_INFINITY,r[1]=Number.NEGATIVE_INFINITY;for(var o=n;o<i.length;o+=a){var s=i[o]*t[0]+i[o+1]*t[1]+i[o+2]*t[2];r[0]=Math.min(r[0],s),r[1]=Math.max(r[1],s)}}function u(e,t,i){r.vec3d.set(e,i.center),r.vec3d.scale(t,.5,i.halfSize),r.quat4.identity(i.quaternion)}function l(e,t,i){r.vec3d.set(t,D),Math.abs(t[0])>Math.abs(t[1])&&Math.abs(t[0])>Math.abs(t[2])?D[0]=0:Math.abs(t[1])>Math.abs(t[2])?D[1]=0:D[2]=0,r.vec3d.length2(D)<p&&(D[0]=D[1]=D[2]=1),r.vec3d.cross(t,D,F),r.vec3d.normalize(F),r.vec3d.cross(t,F,L),r.vec3d.normalize(L),d(e,t,F,L,N,j),r.vec3d.subtract(j,N,U),c(t,F,L,N,j,U,i)}function d(e,t,r,i,n,a){s(e,t,O),n[0]=O[0],a[0]=O[1],s(e,r,O),n[1]=O[0],a[1]=O[1],s(e,i,O),n[2]=O[0],a[2]=O[1]}function c(e,t,i,n,a,o,s){V[0]=e[0],V[3]=e[1],V[6]=e[2],V[1]=t[0],V[4]=t[1],V[7]=t[2],V[2]=i[0],V[5]=i[1],V[8]=i[2],r.quat4.fromRotationMatrix(V,s.quaternion),r.vec3d.add(n,a,k),r.vec3d.scale(k,.5),r.vec3d.scale(e,k[0],s.center),r.vec3d.scale(t,k[1],B),r.vec3d.add(s.center,B),r.vec3d.scale(i,k[2],B),r.vec3d.add(s.center,B),r.vec3d.scale(o,.5,s.halfSize)}function h(e){return e[0]*e[1]+e[0]*e[2]+e[1]*e[2]}Object.defineProperty(t,"__esModule",{value:!0});var p=1e-6,f=r.vec3d.create(),g=r.vec3d.create();t.computeOBB=function(e,t){var a=e.data,o=e.strideIdx,s=a.length/o;if(!(s<=0)){var p=new z(e);r.vec3d.add(p.minProj,p.maxProj,f),r.vec3d.scale(f,.5),r.vec3d.subtract(p.maxProj,p.minProj,g);var m=h(g),v=new G;v.quality=m,s<14&&(e={data:new Float64Array(p.buffer,112,42),size:3,offsetIdx:0,strideIdx:3});var y=r.vec3d.create(),_=r.vec3d.create(),b=r.vec3d.create(),x=r.vec3d.create(),w=r.vec3d.create(),S=r.vec3d.create(),T=r.vec3d.create();switch(i(p,e,T,y,_,b,x,w,S,v)){case 1:return void u(f,g,t);case 2:return void l(e,x,t)}n(e,T,y,_,b,x,w,S,v),d(e,v.b0,v.b1,v.b2,N,j);var O=r.vec3d.create();r.vec3d.subtract(j,N,O),v.quality=h(O),v.quality<m?c(v.b0,v.b1,v.b2,N,j,O,t):u(f,g,t)}};var m=r.vec3d.create(),v=r.vec3d.create(),y=r.vec3d.create(),_=r.vec3d.create(),b=r.vec3d.create(),x=r.vec3d.create(),w=r.vec3d.create(),S=r.vec3d.create(),T=r.vec3d.create(),O=r.vec2d.create(),C=r.vec3d.create(),M=r.vec3d.create(),R=r.vec3d.create(),P=r.vec3d.create(),E=r.vec3d.create(),I=r.vec3d.create(),A=r.vec3d.create(),D=r.vec3d.create(),F=r.vec3d.create(),L=r.vec3d.create(),N=r.vec3d.create(),j=r.vec3d.create(),U=r.vec3d.create(),B=r.vec3d.create(),V=r.mat3.create(),k=r.vec3d.create(),z=function(){return function(e){this.minVert=[],this.maxVert=[],this.buffer=new ArrayBuffer(448);var t=0;for(this.minProj=new Float64Array(this.buffer,t,7),t+=56,this.maxProj=new Float64Array(this.buffer,t,7),t+=56;this.minVert.length<7;)this.minVert.push(new Float64Array(this.buffer,t,3)),t+=24;for(;this.maxVert.length<7;)this.maxVert.push(new Float64Array(this.buffer,t,3)),t+=24;for(var i=0;i<7;++i)this.minProj[i]=Number.POSITIVE_INFINITY,this.maxProj[i]=Number.NEGATIVE_INFINITY;var n=[],a=[],o=e.data,s=e.offsetIdx,u=e.strideIdx;for(i=s;i<o.length;i+=u){var l=o[i];l<this.minProj[0]&&(this.minProj[0]=l,n[0]=i),l>this.maxProj[0]&&(this.maxProj[0]=l,a[0]=i),(l=o[i+1])<this.minProj[1]&&(this.minProj[1]=l,n[1]=i),l>this.maxProj[1]&&(this.maxProj[1]=l,a[1]=i),(l=o[i+2])<this.minProj[2]&&(this.minProj[2]=l,n[2]=i),l>this.maxProj[2]&&(this.maxProj[2]=l,a[2]=i),(l=o[i]+o[i+1]+o[i+2])<this.minProj[3]&&(this.minProj[3]=l,n[3]=i),l>this.maxProj[3]&&(this.maxProj[3]=l,a[3]=i),(l=o[i]+o[i+1]-o[i+2])<this.minProj[4]&&(this.minProj[4]=l,n[4]=i),l>this.maxProj[4]&&(this.maxProj[4]=l,a[4]=i),(l=o[i]-o[i+1]+o[i+2])<this.minProj[5]&&(this.minProj[5]=l,n[5]=i),l>this.maxProj[5]&&(this.maxProj[5]=l,a[5]=i),(l=o[i]-o[i+1]-o[i+2])<this.minProj[6]&&(this.minProj[6]=l,n[6]=i),l>this.maxProj[6]&&(this.maxProj[6]=l,a[6]=i)}for(i=0;i<7;++i){var d=n[i];r.vec3d.set3(o[d],o[d+1],o[d+2],this.minVert[i]),d=a[i],r.vec3d.set3(o[d],o[d+1],o[d+2],this.maxVert[i])}}}(),G=function(){return function(){this.b0=r.vec3d.createFrom(1,0,0),this.b1=r.vec3d.createFrom(0,1,0),this.b2=r.vec3d.createFrom(0,0,1),this.quality=0}}()}.apply(null,i))||(e.exports=n)},1025:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(788),r(705),r(1081),r(1026),r(1027),r(1028)],void 0===(n=function(e,t,r,i,n,a,o,s){function u(e){return n(e,["YYYY-M-D H:m:s","YYYY-M-D H:mZ","YYYY-M-D H:m:sZ","YYYY-M-D H:m","YYYY-m-d"]).toDate()}function l(e){return n(e,["YYYY-M-D"]).toDate()}function d(e){return!0===e}function c(e){return Array.isArray(e)?e:[e]}function h(e){return null!==e?!0!==e:null}function p(e,t){if(null==e)return null;for(var r=!1,i=0,n=t;i<n.length;i++){var a=n[i];if(null==a)r=null;else if(e===a){r=!0;break}}return r}function f(e,t,r){if(null==e)return null;for(var i=t,n=r,a="",o="-[]/{}()*+?.\\^$|",s=0,u=0;u<i.length;u++){var l=i.charAt(u);switch(s){case 0:l===n?s=1:o.indexOf(l)>=0?a+="\\"+l:a+="%"===l?".*":"_"===l?".":l;break;case 1:o.indexOf(l)>=0?a+="\\"+l:a+=l,s=0}}return new RegExp("^"+a+"$").test(e)}function g(e){return e instanceof Date?e.valueOf():e}function m(e){for(var t=[],r={},i=0,n=e;i<n.length;i++){var a=n[i],o=a.toLowerCase();void 0===r[o]&&(t.push(a),r[o]=1)}return t}return function(){function e(){this.parseTree=null,this.parameters=null,this._hasStandardizedFunctions=null,this._hasAggregateFunctions=null}return e.create=function(t){var r=new e;r.parseTree=s.WhereGrammar.parse(t);var i=!0,n=!0;return r.visitAll(r.parseTree,function(e){if("function"===e.type){var t=e.name,r=e.args.value.length;i&&(i=o.isStandardized(t,r)),n&&(n=a.isAggregate(t,r))}}),r._hasStandardizedFunctions=i,r._hasAggregateFunctions=n,r},e.prototype.isStandardized=function(){return this._hasStandardizedFunctions},e.prototype.isAggregate=function(){return this._hasAggregateFunctions},e.prototype.setVariablesDictionary=function(e){this.parameters=e},e.prototype.testFeature=function(e){return!!this.evaluateNode(this.parseTree,e)},e.prototype.testSet=function(e){var t=this,r=new i.default;this.visitAll(this.parseTree,function(e){"column_ref"!==e.type||r.has(e.column)||r.set(e.column,e)});for(var n={},a=0,o=e;a<o.length;a++){!function(e){r.forEach(function(r,i){var a=t.featureValue(e,i,r);n[i]?n[i].push(a):n[i]=[a]})}(o[a])}return!!this.evaluateNode(this.parseTree,{attributes:n})},e.prototype.calculateValue=function(e){return this.evaluateNode(this.parseTree,e)},e.prototype.getFunctions=function(){var e=[];return this.visitAll(this.parseTree,function(t){"function"===t.type&&e.push(t.name.toLowerCase())}),m(e)},e.prototype.getExpressions=function(){var e=new i.default;return this.visitAll(this.parseTree,function(t){if("function"===t.type){var r=t.name.toLowerCase(),i=t.args.value[0];if("column_ref"===i.type){var n=i.column,a=r+"-"+n;e.has(a)||e.set(a,{aggregateType:r,field:n})}}}),r.from(e.values())},e.prototype.getFields=function(){var e=[];return this.visitAll(this.parseTree,function(t){"column_ref"===t.type&&e.push(t.column)}),m(e)},e.prototype.getVariables=function(){var e=[];return this.visitAll(this.parseTree,function(t){"param"===t.type&&e.push(t.value.toLowerCase())}),m(e)},e.prototype.featureValue=function(e,t,r){var i=function(e){return e&&"object"==typeof e.attributes}(e)?e.attributes:e,n=i[t];if(void 0!==n)return n;for(var a in i)if(t.toLowerCase()===a.toLowerCase())return r.column=a,i[a];return null},e.prototype.visitAll=function(e,t){if(null!=e)switch(t(e),e.type){case"when_clause":this.visitAll(e.operand,t),this.visitAll(e.value,t);break;case"case_expression":for(var r=0,i=e.clauses;r<i.length;r++){var n=i[r];this.visitAll(n,t)}"simple"===e.format&&this.visitAll(e.operand,t),null!==e.else&&this.visitAll(e.else,t);break;case"expr_list":for(var a=0,o=e.value;a<o.length;a++){n=o[a];this.visitAll(n,t)}break;case"unary_expr":this.visitAll(e.expr,t);break;case"binary_expr":this.visitAll(e.left,t),this.visitAll(e.right,t);break;case"function":this.visitAll(e.args,t)}},e.prototype.evaluateNode=function(e,t){switch(e.type){case"case_expression":if("simple"===e.format){for(var r=g(this.evaluateNode(e.operand,t)),i=0;i<e.clauses.length;i++)if(r===g(this.evaluateNode(e.clauses[i].operand,t)))return this.evaluateNode(e.clauses[i].value,t);if(null!==e.else)return this.evaluateNode(e.else,t)}else{for(i=0;i<e.clauses.length;i++)if(d(this.evaluateNode(e.clauses[i].operand,t)))return this.evaluateNode(e.clauses[i].value,t);if(null!==e.else)return this.evaluateNode(e.else,t)}return null;case"param":return this.parameters[e.value.toLowerCase()];case"expr_list":for(var n=[],s=0,m=e.value;s<m.length;s++){var v=m[s];n.push(this.evaluateNode(v,t))}return n;case"unary_expr":return h(this.evaluateNode(e.expr,t));case"binary_expr":switch(e.operator){case"AND":return function(e,t){return null!=e&&null!=t?!0===e&&!0===t:!1!==e&&!1!==t&&null}(this.evaluateNode(e.left,t),this.evaluateNode(e.right,t));case"OR":return function(e,t){return null!=e&&null!=t?!0===e||!0===t:!0===e||!0===t||null}(this.evaluateNode(e.left,t),this.evaluateNode(e.right,t));case"IS":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return null===this.evaluateNode(e.left,t);case"ISNOT":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return null!==this.evaluateNode(e.left,t);case"IN":var y=c(this.evaluateNode(e.right,t));return p(this.evaluateNode(e.left,t),y);case"NOT IN":y=c(this.evaluateNode(e.right,t));return h(p(this.evaluateNode(e.left,t),y));case"BETWEEN":var _=this.evaluateNode(e.left,t),b=this.evaluateNode(e.right,t);return null==_||null==b[0]||null==b[1]?null:_>=b[0]&&_<=b[1];case"NOTBETWEEN":_=this.evaluateNode(e.left,t),b=this.evaluateNode(e.right,t);return null==_||null==b[0]||null==b[1]?null:_<b[0]||_>b[1];case"LIKE":return f(this.evaluateNode(e.left,t),this.evaluateNode(e.right,t),e.escape);case"NOT LIKE":return h(f(this.evaluateNode(e.left,t),this.evaluateNode(e.right,t),e.escape));case"<>":case"<":case">":case">=":case"<=":case"=":return function(e,t,r){if(null==t||null==r)return null;var i=g(t),n=g(r);switch(e){case"<>":return i!==n;case"=":return i===n;case">":return i>n;case"<":return i<n;case">=":return i>=n;case"<=":return i<=n}}(e.operator,this.evaluateNode(e.left,t),this.evaluateNode(e.right,t));case"*":return this.evaluateNode(e.left,t)*this.evaluateNode(e.right,t);case"-":return this.evaluateNode(e.left,t)-this.evaluateNode(e.right,t);case"+":return this.evaluateNode(e.left,t)+this.evaluateNode(e.right,t);case"/":return this.evaluateNode(e.left,t)/this.evaluateNode(e.right,t)}throw new Error("Not Supported Operator "+e.operator);case"null":case"bool":case"string":case"number":return e.value;case"date":return l(e.value);case"timestamp":return u(e.value);case"column_ref":return"CURRENT_DATE"===e.column.toUpperCase()?((v=new Date).setHours(0,0,0,0),v):"CURRENT_TIMESTAMP"===e.column.toUpperCase()?new Date:this.featureValue(t,e.column,e);case"function":var x=this.evaluateNode(e.args,t);return this.isAggregate()?a.aggregateFunction(e.name,x):o.evaluateFunction(e.name,x)}throw new Error("Unsupported sql syntax "+e.type)},e}()}.apply(null,i))||(e.exports=n)},1026:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){function r(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t/e.length}function i(e){for(var t=r(e),i=e.length,n=0,a=0,o=e;a<o.length;a++){var s=o[a];n+=Math.pow(s-t,2)}return i>1?n/(i-1):0}Object.defineProperty(t,"__esModule",{value:!0}),t.aggregateFunction=function(e,t){var r=n[e.toLowerCase()];if(null==r)throw new Error("Function Not Recognised");if(t.length<r.minParams||t.length>r.maxParams)throw new Error("Invalid Parameter count for call to "+e.toUpperCase());return r.evaluate(t)},t.isAggregate=function(e,t){var r=n[e.toLowerCase()];return null!=r&&t>=r.minParams&&t<=r.maxParams};var n={min:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.min.apply(Math,e[0])}},max:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.max.apply(Math,e[0])}},avg:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:r(e[0])}},sum:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:function(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t}(e[0])}},stddev:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.sqrt(i(e[0]))}},count:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:e[0].length}},var:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:i(e[0])}}}}.apply(null,i))||(e.exports=n)},1027:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(799)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.evaluateFunction=function(e,t){var r=i[e.toLowerCase()];if(null==r)throw new Error("Function Not Recognised");if(t.length<r.minParams||t.length>r.maxParams)throw new Error("Invalid Parameter count for call to "+e.toUpperCase());return r.evaluate(t)},t.isStandardized=function(e,t){var r=i[e.toLowerCase()];return null!=r&&t>=r.minParams&&t<=r.maxParams};var i={extract:{minParams:2,maxParams:2,evaluate:function(e){var t=e[0],r=e[1];if(null==r)return null;if(r instanceof Date)switch(t.toUpperCase()){case"SECOND":return r.getSeconds();case"MINUTE":return r.getMinutes();case"HOUR":return r.getHours();case"DAY":return r.getDate();case"MONTH":return r.getMonth()+1;case"YEAR":return r.getFullYear()}throw new Error("Invalid Parameter for call to EXTRACT")}},substring:{minParams:2,maxParams:3,evaluate:function(e){if(2===e.length){var t=e[0],r=e[1];return null==t||null==r?null:t.toString().substring(r-1)}if(3===e.length){t=e[0],r=e[1];var i=e[2];return null==t||null==r||null==i?null:i<=0?"":t.toString().substring(r-1,r+i-1)}}},position:{minParams:2,maxParams:2,evaluate:function(e){var t=e[0],r=e[1];return null==t||null==r?null:r.indexOf(t)+1}},trim:{minParams:2,maxParams:3,evaluate:function(e){var t=3===e.length,i=t?e[1]:" ",n=t?e[2]:e[1];if(null==i||null==n)return null;var a="("+r.escapeString(i)+")";switch(e[0]){case"BOTH":return n.replace(new RegExp("^"+a+"*|"+a+"*$","g"),"");case"LEADING":return n.replace(new RegExp("^"+a+"*","g"),"");case"TRAILING":return n.replace(new RegExp(a+"*$","g"),"")}throw new Error("Invalid Parameter for call to TRIM")}},abs:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.abs(e[0])}},ceiling:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.ceil(e[0])}},floor:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.floor(e[0])}},log:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.log(e[0])}},log10:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.log(e[0])*Math.LOG10E}},sin:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.sin(e[0])}},cos:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.cos(e[0])}},tan:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.tan(e[0])}},asin:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.asin(e[0])}},acos:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.acos(e[0])}},atan:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.atan(e[0])}},sign:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:e[0]>0?1:e[1]<0?-1:0}},power:{minParams:2,maxParams:2,evaluate:function(e){return null==e[0]||null==e[1]?null:Math.pow(e[0],e[1])}},mod:{minParams:2,maxParams:2,evaluate:function(e){return null==e[0]||null==e[1]?null:e[0]%e[1]}},round:{minParams:1,maxParams:2,evaluate:function(e){var t=e[0],r=2===e.length?Math.pow(10,e[1]):1;return null==t?null:Math.round(t*r)/r}},truncate:{minParams:1,maxParams:2,evaluate:function(e){return null==e[0]?null:1===e.length?parseInt(e[0].toFixed(0),10):parseFloat(e[0].toFixed(e[1]))}},char_length:{minParams:1,maxParams:1,evaluate:function(e){return"string"==typeof e[0]||e[0]instanceof String?e[0].length:0}},concat:{minParams:1,maxParams:1/0,evaluate:function(e){for(var t="",r=0;r<e.length;r++){if(null==e[r])return null;t+=e[r].toString()}return t}},lower:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:e[0].toString().toLowerCase()}},upper:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:e[0].toString().toUpperCase()}}}}.apply(null,i))||(e.exports=n)},1028:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1029)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.parse=function(e){return r.parse(e)},e}();t.WhereGrammar=i}.apply(null,i))||(e.exports=n)},1029:function(e,t,r){var i;void 0===(i=function(){"use strict";function e(t,r,i,n){this.message=t,this.expected=r,this.found=i,this.location=n,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,e)}return function(e,t){function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r}(e,Error),e.buildMessage=function(e,t){function r(e){return e.charCodeAt(0).toString(16).toUpperCase()}function i(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(e){return"\\x0"+r(e)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(e){return"\\x"+r(e)})}function n(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(e){return"\\x0"+r(e)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(e){return"\\x"+r(e)})}function a(e){return o[e.type](e)}var o={literal:function(e){return'"'+i(e.text)+'"'},class:function(e){var t,r="";for(t=0;t<e.parts.length;t++)r+=e.parts[t]instanceof Array?n(e.parts[t][0])+"-"+n(e.parts[t][1]):n(e.parts[t]);return"["+(e.inverted?"^":"")+r+"]"},any:function(e){return"any character"},end:function(e){return"end of input"},other:function(e){return e.description}};return"Expected "+function(e){var t,r,i=new Array(e.length);for(t=0;t<e.length;t++)i[t]=a(e[t]);if(i.sort(),i.length>0){for(t=1,r=1;t<i.length;t++)i[t-1]!==i[t]&&(i[r]=i[t],r++);i.length=r}switch(i.length){case 1:return i[0];case 2:return i[0]+" or "+i[1];default:return i.slice(0,-1).join(", ")+", or "+i[i.length-1]}}(e)+" but "+(t?'"'+i(t)+'"':"end of input")+" found."},{SyntaxError:e,parse:function(t,r){function i(e,t){return{type:"literal",text:e,ignoreCase:t}}function n(e,t,r){return{type:"class",parts:e,inverted:t,ignoreCase:r}}function a(e){var r,i=fn[e];if(i)return i;for(r=e-1;!fn[r];)r--;for(i={line:(i=fn[r]).line,column:i.column};r<e;)10===t.charCodeAt(r)?(i.line++,i.column=1):i.column++,r++;return fn[e]=i,i}function o(e,t){var r=a(e),i=a(t);return{start:{offset:e,line:r.line,column:r.column},end:{offset:t,line:i.line,column:i.column}}}function s(e){pn<gn||(pn>gn&&(gn=pn,mn=[]),mn.push(e))}function u(){var e,t;return e=pn,ce()!==ve&&(t=d())!==ve&&ce()!==ve?e=be(t):(pn=e,e=ve),e}function l(){var e,t,r,i,n,a,o,s;if(e=pn,(t=d())!==ve){for(r=[],i=pn,(n=ce())!==ve&&(a=ue())!==ve&&(o=ce())!==ve&&(s=d())!==ve?i=n=[n,a,o,s]:(pn=i,i=ve);i!==ve;)r.push(i),i=pn,(n=ce())!==ve&&(a=ue())!==ve&&(o=ce())!==ve&&(s=d())!==ve?i=n=[n,a,o,s]:(pn=i,i=ve);r!==ve?e=t=xe(t,r):(pn=e,e=ve)}else pn=e,e=ve;return e}function d(){var e,t,r,i,n,a,o,s;if(e=pn,(t=c())!==ve){for(r=[],i=pn,(n=ce())!==ve&&(a=Q())!==ve&&(o=ce())!==ve&&(s=c())!==ve?i=n=[n,a,o,s]:(pn=i,i=ve);i!==ve;)r.push(i),i=pn,(n=ce())!==ve&&(a=Q())!==ve&&(o=ce())!==ve&&(s=c())!==ve?i=n=[n,a,o,s]:(pn=i,i=ve);r!==ve?e=t=we(t,r):(pn=e,e=ve)}else pn=e,e=ve;return e}function c(){var e,t,r,i,n,a,o,s;if(e=pn,(t=h())!==ve){for(r=[],i=pn,(n=ce())!==ve&&(a=W())!==ve&&(o=ce())!==ve&&(s=h())!==ve?i=n=[n,a,o,s]:(pn=i,i=ve);i!==ve;)r.push(i),i=pn,(n=ce())!==ve&&(a=W())!==ve&&(o=ce())!==ve&&(s=h())!==ve?i=n=[n,a,o,s]:(pn=i,i=ve);r!==ve?e=t=we(t,r):(pn=e,e=ve)}else pn=e,e=ve;return e}function h(){var e,r,i,n,a;return e=pn,(r=q())===ve&&(r=pn,33===t.charCodeAt(pn)?(i=Se,pn++):(i=ve,0===vn&&s(Te)),i!==ve?(n=pn,vn++,61===t.charCodeAt(pn)?(a=Oe,pn++):(a=ve,0===vn&&s(Ce)),vn--,a===ve?n=void 0:(pn=n,n=ve),n!==ve?r=i=[i,n]:(pn=r,r=ve)):(pn=r,r=ve)),r!==ve&&(i=ce())!==ve&&(n=h())!==ve?e=r=Me(n):(pn=e,e=ve),e===ve&&(e=function(){var e,t,r;return e=pn,(t=m())!==ve&&ce()!==ve?((r=function(){var e;return(e=function(){var e,t,r,i,n,a;if(pn,e=[],t=pn,(r=ce())!==ve&&(i=p())!==ve&&(n=ce())!==ve&&(a=m())!==ve?t=r=[r,i,n,a]:(pn=t,t=ve),t!==ve)for(;t!==ve;)e.push(t),t=pn,(r=ce())!==ve&&(i=p())!==ve&&(n=ce())!==ve&&(a=m())!==ve?t=r=[r,i,n,a]:(pn=t,t=ve);else e=ve;return e!==ve&&(e=Pe(e)),e}())===ve&&(e=function(){var e,t,r,i;return e=pn,(t=g())!==ve&&ce()!==ve&&(r=le())!==ve&&ce()!==ve&&(i=l())!==ve&&ce()!==ve&&de()!==ve?(t=Ye(t,i),e=t):(pn=e,e=ve),e===ve&&(e=pn,(t=g())!==ve&&ce()!==ve&&(r=le())!==ve&&ce()!==ve&&(i=de())!==ve?(t=Ze(t),e=t):(pn=e,e=ve),e===ve&&(e=pn,(t=g())!==ve&&ce()!==ve&&(r=O())!==ve?(t=Ke(t,r),e=t):(pn=e,e=ve))),e}())===ve&&(e=function(){var e,t,r,i,n,a;return e=pn,(t=q())!==ve&&ce()!==ve&&(r=X())!==ve&&ce()!==ve&&(i=m())!==ve&&ce()!==ve&&(n=W())!==ve&&ce()!==ve&&(a=m())!==ve?(t=He(r,i,a),e=t):(pn=e,e=ve),e===ve&&(e=pn,(t=X())!==ve&&ce()!==ve&&(r=m())!==ve&&ce()!==ve&&(i=W())!==ve&&ce()!==ve&&(n=m())!==ve?(t=qe(t,r,n),e=t):(pn=e,e=ve)),e}())===ve&&(e=function(){var e,t,r,i;return e=pn,(t=z())!==ve&&ce()!==ve&&(r=q())!==ve&&ce()!==ve&&(i=m())!==ve?(t=ze(t,i),e=t):(pn=e,e=ve),e===ve&&(e=pn,(t=z())!==ve&&ce()!==ve&&(r=m())!==ve?(t=Ge(t,r),e=t):(pn=e,e=ve)),e}())===ve&&(e=function(){var e,t,r,i;return e=pn,(t=f())!==ve&&ce()!==ve&&(r=M())!==ve&&ce()!==ve&&H()!==ve&&ce()!==ve&&(i=R())!==ve?(t=Qe(t,r,i),e=t):(pn=e,e=ve),e===ve&&(e=pn,(t=f())!==ve&&ce()!==ve&&(r=M())!==ve?(t=Xe(t,r),e=t):(pn=e,e=ve)),e}()),e}())===ve&&(r=null),r!==ve?(t=Re(t,r),e=t):(pn=e,e=ve)):(pn=e,e=ve),e}()),e}function p(){var e;return t.substr(pn,2)===Ee?(e=Ee,pn+=2):(e=ve,0===vn&&s(Ie)),e===ve&&(62===t.charCodeAt(pn)?(e=Ae,pn++):(e=ve,0===vn&&s(De)),e===ve&&(t.substr(pn,2)===Fe?(e=Fe,pn+=2):(e=ve,0===vn&&s(Le)),e===ve&&(t.substr(pn,2)===Ne?(e=Ne,pn+=2):(e=ve,0===vn&&s(je)),e===ve&&(60===t.charCodeAt(pn)?(e=Ue,pn++):(e=ve,0===vn&&s(Be)),e===ve&&(61===t.charCodeAt(pn)?(e=Oe,pn++):(e=ve,0===vn&&s(Ce)),e===ve&&(t.substr(pn,2)===Ve?(e=Ve,pn+=2):(e=ve,0===vn&&s(ke)))))))),e}function f(){var e,t,r,i,n;return e=pn,t=pn,(r=q())!==ve&&(i=ce())!==ve&&(n=G())!==ve?t=r=[r,i,n]:(pn=t,t=ve),t!==ve&&(t=We(t)),(e=t)===ve&&(e=G()),e}function g(){var e,t,r,i,n;return e=pn,t=pn,(r=q())!==ve&&(i=ce())!==ve&&(n=k())!==ve?t=r=[r,i,n]:(pn=t,t=ve),t!==ve&&(t=We(t)),(e=t)===ve&&(e=k()),e}function m(){var e,t,r,i,n,a,o,s;if(e=pn,(t=y())!==ve){for(r=[],i=pn,(n=ce())!==ve&&(a=v())!==ve&&(o=ce())!==ve&&(s=y())!==ve?i=n=[n,a,o,s]:(pn=i,i=ve);i!==ve;)r.push(i),i=pn,(n=ce())!==ve&&(a=v())!==ve&&(o=ce())!==ve&&(s=y())!==ve?i=n=[n,a,o,s]:(pn=i,i=ve);r!==ve?e=t=we(t,r):(pn=e,e=ve)}else pn=e,e=ve;return e}function v(){var e;return 43===t.charCodeAt(pn)?(e=Je,pn++):(e=ve,0===vn&&s($e)),e===ve&&(45===t.charCodeAt(pn)?(e=et,pn++):(e=ve,0===vn&&s(tt))),e}function y(){var e,t,r,i,n,a,o,s;if(e=pn,(t=b())!==ve){for(r=[],i=pn,(n=ce())!==ve&&(a=_())!==ve&&(o=ce())!==ve&&(s=b())!==ve?i=n=[n,a,o,s]:(pn=i,i=ve);i!==ve;)r.push(i),i=pn,(n=ce())!==ve&&(a=_())!==ve&&(o=ce())!==ve&&(s=b())!==ve?i=n=[n,a,o,s]:(pn=i,i=ve);r!==ve?e=t=rt(t,r):(pn=e,e=ve)}else pn=e,e=ve;return e}function _(){var e;return 42===t.charCodeAt(pn)?(e=it,pn++):(e=ve,0===vn&&s(nt)),e===ve&&(47===t.charCodeAt(pn)?(e=at,pn++):(e=ve,0===vn&&s(ot))),e}function b(){var e,t;return(e=function(){var e,t;return(e=R())===ve&&(e=function(){var e,t,r,i;return e=pn,(t=function(){var e,t,r,i;return e=pn,(t=A())!==ve&&(r=D())!==ve&&(i=F())!==ve?(t=Xt(t,r,i),e=t):(pn=e,e=ve),e===ve&&(e=pn,(t=A())!==ve&&(r=D())!==ve?(t=Yt(t,r),e=t):(pn=e,e=ve),e===ve&&(e=pn,(t=A())!==ve&&(r=F())!==ve?(t=Zt(t,r),e=t):(pn=e,e=ve),e===ve&&(e=pn,(t=A())!==ve&&(t=Kt(t)),e=t))),e}())!==ve?(r=pn,vn++,i=w(),vn--,i===ve?r=void 0:(pn=r,r=ve),r!==ve?(t=Qt(t),e=t):(pn=e,e=ve)):(pn=e,e=ve),e}())===ve&&(e=function(){var e,t;return e=pn,(t=B())!==ve&&(t=Pt()),(e=t)===ve&&(e=pn,(t=V())!==ve&&(t=Et()),e=t),e}())===ve&&((t=U())!==ve&&(t=Rt()),(e=t)===ve)&&(e=function(){var e,t,r;return e=pn,(t=re())!==ve&&ce()!==ve&&(r=M())!==ve?(t=Mt(r),e=t):(pn=e,e=ve),e}())===ve&&(e=function(){var e,t,r;return e=pn,(t=te())!==ve&&ce()!==ve&&(r=M())!==ve?(t=Ct(r),e=t):(pn=e,e=ve),e}()),e}())===ve&&(e=function(){var e,t,r,i;return e=pn,(t=J())!==ve&&ce()!==ve&&le()!==ve&&ce()!==ve&&(r=function(){var e;return(e=function(){var e,r,i,n;return e=pn,t.substr(pn,4).toLowerCase()===bi?(r=t.substr(pn,4),pn+=4):(r=ve,0===vn&&s(xi)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?(r=wi(),e=r):(pn=e,e=ve)):(pn=e,e=ve),e}())===ve&&(e=function(){var e,r,i,n;return e=pn,t.substr(pn,5).toLowerCase()===Si?(r=t.substr(pn,5),pn+=5):(r=ve,0===vn&&s(Ti)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?(r=Oi(),e=r):(pn=e,e=ve)):(pn=e,e=ve),e}())===ve&&(e=function(){var e,r,i,n;return e=pn,t.substr(pn,3).toLowerCase()===Ci?(r=t.substr(pn,3),pn+=3):(r=ve,0===vn&&s(Mi)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?(r=Ri(),e=r):(pn=e,e=ve)):(pn=e,e=ve),e}())===ve&&(e=function(){var e,r,i,n;return e=pn,t.substr(pn,4).toLowerCase()===Pi?(r=t.substr(pn,4),pn+=4):(r=ve,0===vn&&s(Ei)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?(r=Ii(),e=r):(pn=e,e=ve)):(pn=e,e=ve),e}())===ve&&(e=function(){var e,r,i,n;return e=pn,t.substr(pn,6).toLowerCase()===Ai?(r=t.substr(pn,6),pn+=6):(r=ve,0===vn&&s(Di)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?(r=Fi(),e=r):(pn=e,e=ve)):(pn=e,e=ve),e}())===ve&&(e=function(){var e,r,i,n;return e=pn,t.substr(pn,6).toLowerCase()===Li?(r=t.substr(pn,6),pn+=6):(r=ve,0===vn&&s(Ni)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?(r=ji(),e=r):(pn=e,e=ve)):(pn=e,e=ve),e}()),e}())!==ve&&ce()!==ve&&Y()!==ve&&ce()!==ve&&(i=d())!==ve&&ce()!==ve&&de()!==ve?(t=bt(r,i),e=t):(pn=e,e=ve),e}())===ve&&(e=function(){var e,t,r,i,n,a,o,s,u;return e=pn,(t=K())!==ve&&ce()!==ve&&le()!==ve&&ce()!==ve&&(r=d())!==ve&&ce()!==ve&&Y()!==ve&&ce()!==ve&&(i=d())!==ve&&ce()!==ve?(n=pn,(a=Z())!==ve&&(o=ce())!==ve&&(s=d())!==ve&&(u=ce())!==ve?n=a=[a,o,s,u]:(pn=n,n=ve),n===ve&&(n=null),n!==ve&&(a=de())!==ve?(t=xt(r,i,n),e=t):(pn=e,e=ve)):(pn=e,e=ve),e}())===ve&&(e=function(){var e,t,r,i,n;return e=pn,(t=$())!==ve&&ce()!==ve&&le()!==ve&&ce()!==ve?((r=C())===ve&&(r=null),r!==ve&&ce()!==ve&&(i=d())!==ve&&ce()!==ve&&Y()!==ve&&ce()!==ve&&(n=d())!==ve&&ce()!==ve&&de()!==ve?(t=wt(r,i,n),e=t):(pn=e,e=ve)):(pn=e,e=ve),e===ve&&(e=pn,(t=$())!==ve&&ce()!==ve&&le()!==ve&&ce()!==ve?((r=C())===ve&&(r=null),r!==ve&&ce()!==ve&&(i=d())!==ve&&ce()!==ve&&de()!==ve?(t=St(r,i),e=t):(pn=e,e=ve)):(pn=e,e=ve)),e}())===ve&&(e=function(){var e,t,r,i;return e=pn,(t=ee())!==ve&&ce()!==ve&&le()!==ve&&ce()!==ve&&(r=d())!==ve&&ce()!==ve&&k()!==ve&&ce()!==ve&&(i=d())!==ve&&ce()!==ve&&de()!==ve?(t=Tt(r,i),e=t):(pn=e,e=ve),e}())===ve&&(e=function(){var e,t,r;return e=pn,(t=pe())!==ve&&ce()!==ve&&le()!==ve&&ce()!==ve?((r=l())===ve&&(r=null),r!==ve&&ce()!==ve&&de()!==ve?(t=Ot(t,r),e=t):(pn=e,e=ve)):(pn=e,e=ve),e}())===ve&&(e=function(){var e;return(e=function(){var e,t,r,i,n,a;if(e=pn,(t=ie())!==ve)if(ce()!==ve)if((r=d())!==ve)if(ce()!==ve){for(i=[],n=E();n!==ve;)i.push(n),n=E();i!==ve&&(n=ce())!==ve&&(a=ne())!==ve?(t=kt(r,i),e=t):(pn=e,e=ve)}else pn=e,e=ve;else pn=e,e=ve;else pn=e,e=ve;else pn=e,e=ve;if(e===ve)if(e=pn,(t=ie())!==ve)if(ce()!==ve)if((r=d())!==ve)if(ce()!==ve){for(i=[],n=E();n!==ve;)i.push(n),n=E();i!==ve&&(n=ce())!==ve&&(a=I())!==ve&&ce()!==ve&&ne()!==ve?(t=zt(r,i,a),e=t):(pn=e,e=ve)}else pn=e,e=ve;else pn=e,e=ve;else pn=e,e=ve;else pn=e,e=ve;return e}())===ve&&(e=function(){var e,t,r,i,n;if(e=pn,(t=ie())!==ve)if(ce()!==ve){for(r=[],i=P();i!==ve;)r.push(i),i=P();r!==ve&&(i=ce())!==ve&&(n=ne())!==ve?(t=Gt(r),e=t):(pn=e,e=ve)}else pn=e,e=ve;else pn=e,e=ve;if(e===ve)if(e=pn,(t=ie())!==ve)if(ce()!==ve){for(r=[],i=P();i!==ve;)r.push(i),i=P();r!==ve&&(i=ce())!==ve&&(n=I())!==ve&&ce()!==ve&&ne()!==ve?(t=Ht(r,n),e=t):(pn=e,e=ve)}else pn=e,e=ve;else pn=e,e=ve;return e}()),e}())===ve&&(e=function(){var e;return pn,(e=function(){var e;return pn,(e=function(){var e,t,r,i;if(e=pn,(t=w())!==ve){for(r=[],i=T();i!==ve;)r.push(i),i=T();r!==ve?(t=dt(t,r),e=t):(pn=e,e=ve)}else pn=e,e=ve;return e}())!==ve&&(e=lt(e)),e}())!==ve&&(e=ut(e)),e}())===ve&&(e=O())===ve&&(e=pn,le()!==ve&&ce()!==ve&&(t=d())!==ve&&ce()!==ve&&de()!==ve?e=st(t):(pn=e,e=ve)),e}function x(){var e,t,r,i;if(e=pn,(t=w())!==ve){for(r=[],i=S();i!==ve;)r.push(i),i=S();r!==ve?e=t=dt(t,r):(pn=e,e=ve)}else pn=e,e=ve;return e}function w(){var e;return ct.test(t.charAt(pn))?(e=t.charAt(pn),pn++):(e=ve,0===vn&&s(ht)),e}function S(){var e;return pt.test(t.charAt(pn))?(e=t.charAt(pn),pn++):(e=ve,0===vn&&s(ft)),e}function T(){var e;return gt.test(t.charAt(pn))?(e=t.charAt(pn),pn++):(e=ve,0===vn&&s(mt)),e}function O(){var e,r,i;return pn,e=pn,64===t.charCodeAt(pn)?(r=vt,pn++):(r=ve,0===vn&&s(yt)),r!==ve&&(i=x())!==ve?e=r=[r,i]:(pn=e,e=ve),e!==ve&&(e=_t(e)),e}function C(){var e;return(e=function(){var e,r,i,n;return e=pn,t.substr(pn,7).toLowerCase()===ci?(r=t.substr(pn,7),pn+=7):(r=ve,0===vn&&s(hi)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?(r=pi(),e=r):(pn=e,e=ve)):(pn=e,e=ve),e}())===ve&&(e=function(){var e,r,i,n;return e=pn,t.substr(pn,8).toLowerCase()===fi?(r=t.substr(pn,8),pn+=8):(r=ve,0===vn&&s(gi)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?(r=mi(),e=r):(pn=e,e=ve)):(pn=e,e=ve),e}())===ve&&(e=function(){var e,r,i,n;return e=pn,t.substr(pn,4).toLowerCase()===vi?(r=t.substr(pn,4),pn+=4):(r=ve,0===vn&&s(yi)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?(r=_i(),e=r):(pn=e,e=ve)):(pn=e,e=ve),e}()),e}function M(){var e;return(e=R())===ve&&(e=O()),e}function R(){var e,r,i,n,a;if(e=pn,39===t.charCodeAt(pn)?(r=It,pn++):(r=ve,0===vn&&s(At)),r===ve&&(t.substr(pn,2)===Dt?(r=Dt,pn+=2):(r=ve,0===vn&&s(Ft))),r!==ve){for(i=[],n=pn,t.substr(pn,2)===Lt?(a=Lt,pn+=2):(a=ve,0===vn&&s(Nt)),a!==ve&&(a=jt()),(n=a)===ve&&(Ut.test(t.charAt(pn))?(n=t.charAt(pn),pn++):(n=ve,0===vn&&s(Bt)));n!==ve;)i.push(n),n=pn,t.substr(pn,2)===Lt?(a=Lt,pn+=2):(a=ve,0===vn&&s(Nt)),a!==ve&&(a=jt()),(n=a)===ve&&(Ut.test(t.charAt(pn))?(n=t.charAt(pn),pn++):(n=ve,0===vn&&s(Bt)));i!==ve?(39===t.charCodeAt(pn)?(n=It,pn++):(n=ve,0===vn&&s(At)),n!==ve?e=r=Vt(i):(pn=e,e=ve)):(pn=e,e=ve)}else pn=e,e=ve;return e}function P(){var e,t,r;return e=pn,ae()!==ve&&ce()!==ve&&(t=d())!==ve&&ce()!==ve&&oe()!==ve&&ce()!==ve&&(r=d())!==ve?e=qt(t,r):(pn=e,e=ve),e}function E(){var e,t,r;return e=pn,ae()!==ve&&ce()!==ve&&(t=d())!==ve&&ce()!==ve&&oe()!==ve&&ce()!==ve&&(r=d())!==ve?e=qt(t,r):(pn=e,e=ve),e}function I(){var e,t;return e=pn,se()!==ve&&ce()!==ve&&(t=d())!==ve?e=Wt(t):(pn=e,e=ve),e}function A(){var e,r,i;return(e=L())===ve&&(e=pn,45===t.charCodeAt(pn)?(r=et,pn++):(r=ve,0===vn&&s(tt)),r===ve&&(43===t.charCodeAt(pn)?(r=Je,pn++):(r=ve,0===vn&&s($e))),r!==ve&&(i=L())!==ve?e=r=Jt(r,i):(pn=e,e=ve)),e}function D(){var e,r,i;return e=pn,46===t.charCodeAt(pn)?(r=$t,pn++):(r=ve,0===vn&&s(er)),r!==ve?((i=L())===ve&&(i=null),i!==ve?e=r=tr(i):(pn=e,e=ve)):(pn=e,e=ve),e}function F(){var e,t,r;return e=pn,(t=j())!==ve&&(r=L())!==ve?e=t=rr(t,r):(pn=e,e=ve),e}function L(){var e,t;if(pn,e=[],(t=N())!==ve)for(;t!==ve;)e.push(t),t=N();else e=ve;return e!==ve&&(e=ir(e)),e}function N(){var e;return nr.test(t.charAt(pn))?(e=t.charAt(pn),pn++):(e=ve,0===vn&&s(ar)),e}function j(){var e,r,i;return e=pn,or.test(t.charAt(pn))?(r=t.charAt(pn),pn++):(r=ve,0===vn&&s(sr)),r!==ve?(ur.test(t.charAt(pn))?(i=t.charAt(pn),pn++):(i=ve,0===vn&&s(lr)),i===ve&&(i=null),i!==ve?e=r=dr(r,i):(pn=e,e=ve)):(pn=e,e=ve),e}function U(){var e,r,i,n;return e=pn,t.substr(pn,4).toLowerCase()===cr?(r=t.substr(pn,4),pn+=4):(r=ve,0===vn&&s(hr)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?e=r=[r,i]:(pn=e,e=ve)):(pn=e,e=ve),e}function B(){var e,r,i,n;return e=pn,t.substr(pn,4).toLowerCase()===pr?(r=t.substr(pn,4),pn+=4):(r=ve,0===vn&&s(fr)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?e=r=[r,i]:(pn=e,e=ve)):(pn=e,e=ve),e}function V(){var e,r,i,n;return e=pn,t.substr(pn,5).toLowerCase()===gr?(r=t.substr(pn,5),pn+=5):(r=ve,0===vn&&s(mr)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?e=r=[r,i]:(pn=e,e=ve)):(pn=e,e=ve),e}function k(){var e,r,i,n;return e=pn,t.substr(pn,2).toLowerCase()===vr?(r=t.substr(pn,2),pn+=2):(r=ve,0===vn&&s(yr)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?e=r=_r():(pn=e,e=ve)):(pn=e,e=ve),e}function z(){var e,r,i,n;return e=pn,t.substr(pn,2).toLowerCase()===br?(r=t.substr(pn,2),pn+=2):(r=ve,0===vn&&s(xr)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?e=r=wr():(pn=e,e=ve)):(pn=e,e=ve),e}function G(){var e,r,i,n;return e=pn,t.substr(pn,4).toLowerCase()===Sr?(r=t.substr(pn,4),pn+=4):(r=ve,0===vn&&s(Tr)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?e=r=Or():(pn=e,e=ve)):(pn=e,e=ve),e}function H(){var e,r,i,n;return e=pn,t.substr(pn,6).toLowerCase()===Cr?(r=t.substr(pn,6),pn+=6):(r=ve,0===vn&&s(Mr)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?e=r=Rr():(pn=e,e=ve)):(pn=e,e=ve),e}function q(){var e,r,i,n;return e=pn,t.substr(pn,3).toLowerCase()===Pr?(r=t.substr(pn,3),pn+=3):(r=ve,0===vn&&s(Er)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?e=r=Ir():(pn=e,e=ve)):(pn=e,e=ve),e}function W(){var e,r,i,n;return e=pn,t.substr(pn,3).toLowerCase()===Ar?(r=t.substr(pn,3),pn+=3):(r=ve,0===vn&&s(Dr)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?e=r=Fr():(pn=e,e=ve)):(pn=e,e=ve),e}function Q(){var e,r,i,n;return e=pn,t.substr(pn,2).toLowerCase()===Lr?(r=t.substr(pn,2),pn+=2):(r=ve,0===vn&&s(Nr)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?e=r=jr():(pn=e,e=ve)):(pn=e,e=ve),e}function X(){var e,r,i,n;return e=pn,t.substr(pn,7).toLowerCase()===Ur?(r=t.substr(pn,7),pn+=7):(r=ve,0===vn&&s(Br)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?e=r=Vr():(pn=e,e=ve)):(pn=e,e=ve),e}function Y(){var e,r,i,n;return e=pn,t.substr(pn,4).toLowerCase()===kr?(r=t.substr(pn,4),pn+=4):(r=ve,0===vn&&s(zr)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?e=r=Gr():(pn=e,e=ve)):(pn=e,e=ve),e}function Z(){var e,r,i,n;return e=pn,t.substr(pn,3).toLowerCase()===Hr?(r=t.substr(pn,3),pn+=3):(r=ve,0===vn&&s(qr)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?e=r=Wr():(pn=e,e=ve)):(pn=e,e=ve),e}function K(){var e,r,i,n;return e=pn,t.substr(pn,9).toLowerCase()===Qr?(r=t.substr(pn,9),pn+=9):(r=ve,0===vn&&s(Xr)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?e=r=Yr():(pn=e,e=ve)):(pn=e,e=ve),e}function J(){var e,r,i,n;return e=pn,t.substr(pn,7).toLowerCase()===Zr?(r=t.substr(pn,7),pn+=7):(r=ve,0===vn&&s(Kr)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?e=r=Jr():(pn=e,e=ve)):(pn=e,e=ve),e}function $(){var e,r,i,n;return e=pn,t.substr(pn,4).toLowerCase()===$r?(r=t.substr(pn,4),pn+=4):(r=ve,0===vn&&s(ei)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?e=r=ti():(pn=e,e=ve)):(pn=e,e=ve),e}function ee(){var e,r,i,n;return e=pn,t.substr(pn,8).toLowerCase()===ri?(r=t.substr(pn,8),pn+=8):(r=ve,0===vn&&s(ii)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?e=r=ni():(pn=e,e=ve)):(pn=e,e=ve),e}function te(){var e,r,i,n;return e=pn,t.substr(pn,9).toLowerCase()===ai?(r=t.substr(pn,9),pn+=9):(r=ve,0===vn&&s(oi)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?e=r=si():(pn=e,e=ve)):(pn=e,e=ve),e}function re(){var e,r,i,n;return e=pn,t.substr(pn,4).toLowerCase()===ui?(r=t.substr(pn,4),pn+=4):(r=ve,0===vn&&s(li)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?e=r=di():(pn=e,e=ve)):(pn=e,e=ve),e}function ie(){var e,r,i,n;return e=pn,t.substr(pn,4).toLowerCase()===Ui?(r=t.substr(pn,4),pn+=4):(r=ve,0===vn&&s(Bi)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?e=r=Vi():(pn=e,e=ve)):(pn=e,e=ve),e}function ne(){var e,r,i,n;return e=pn,t.substr(pn,3).toLowerCase()===ki?(r=t.substr(pn,3),pn+=3):(r=ve,0===vn&&s(zi)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?e=r=Gi():(pn=e,e=ve)):(pn=e,e=ve),e}function ae(){var e,r,i,n;return e=pn,t.substr(pn,4).toLowerCase()===Hi?(r=t.substr(pn,4),pn+=4):(r=ve,0===vn&&s(qi)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?e=r=Wi():(pn=e,e=ve)):(pn=e,e=ve),e}function oe(){var e,r,i,n;return e=pn,t.substr(pn,4).toLowerCase()===Qi?(r=t.substr(pn,4),pn+=4):(r=ve,0===vn&&s(Xi)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?e=r=Yi():(pn=e,e=ve)):(pn=e,e=ve),e}function se(){var e,r,i,n;return e=pn,t.substr(pn,4).toLowerCase()===Zi?(r=t.substr(pn,4),pn+=4):(r=ve,0===vn&&s(Ki)),r!==ve?(i=pn,vn++,n=S(),vn--,n===ve?i=void 0:(pn=i,i=ve),i!==ve?e=r=Ji():(pn=e,e=ve)):(pn=e,e=ve),e}function ue(){var e;return 44===t.charCodeAt(pn)?(e=$i,pn++):(e=ve,0===vn&&s(en)),e}function le(){var e;return 40===t.charCodeAt(pn)?(e=tn,pn++):(e=ve,0===vn&&s(rn)),e}function de(){var e;return 41===t.charCodeAt(pn)?(e=nn,pn++):(e=ve,0===vn&&s(an)),e}function ce(){var e,t;for(e=[],t=he();t!==ve;)e.push(t),t=he();return e}function he(){var e;return on.test(t.charAt(pn))?(e=t.charAt(pn),pn++):(e=ve,0===vn&&s(sn)),e}function pe(){var e,r,i,n;if(e=pn,(r=x())!==ve&&(r=lt(r)),(e=r)===ve)if(e=pn,96===t.charCodeAt(pn)?(r=un,pn++):(r=ve,0===vn&&s(ln)),r!==ve){if(i=[],dn.test(t.charAt(pn))?(n=t.charAt(pn),pn++):(n=ve,0===vn&&s(cn)),n!==ve)for(;n!==ve;)i.push(n),dn.test(t.charAt(pn))?(n=t.charAt(pn),pn++):(n=ve,0===vn&&s(cn));else i=ve;i!==ve?(96===t.charCodeAt(pn)?(n=un,pn++):(n=ve,0===vn&&s(ln)),n!==ve?e=r=hn(i):(pn=e,e=ve)):(pn=e,e=ve)}else pn=e,e=ve;return e}function fe(e,t,r,i){var n={type:"binary_expr",operator:e,left:t,right:r};return void 0!==i&&(n.escape=i),n}function ge(e,t){for(var r=e,i=0;i<t.length;i++)r=fe(t[i][1],r,t[i][3]);return r}r=void 0!==r?r:{};var me,ve={},ye={start:u},_e=u,be=function(e){return e},xe=function(e,t){var r={type:"expr_list"},i=function(e,t,r){return function(e,t){for(var r=[e],i=0;i<t.length;i++)r.push(t[i][3]);return r}(e,t)}(e,t);return r.value=i,r},we=function(e,t){return ge(e,t)},Se="!",Te=i("!",!1),Oe="=",Ce=i("=",!1),Me=function(e){return function(e,t){return{type:"unary_expr",operator:e,expr:t}}("NOT",e)},Re=function(e,t){return""==t||null==t||null==t?e:"arithmetic"==t.type?ge(e,t.tail):fe(t.op,e,t.right,t.escape)},Pe=function(e){return{type:"arithmetic",tail:e}},Ee=">=",Ie=i(">=",!1),Ae=">",De=i(">",!1),Fe="<=",Le=i("<=",!1),Ne="<>",je=i("<>",!1),Ue="<",Be=i("<",!1),Ve="!=",ke=i("!=",!1),ze=function(e,t){return{op:e+"NOT",right:t}},Ge=function(e,t){return{op:e,right:t}},He=function(e,t,r){return{op:"NOT"+e,right:{type:"expr_list",value:[t,r]}}},qe=function(e,t,r){return{op:e,right:{type:"expr_list",value:[t,r]}}},We=function(e){return e[0]+" "+e[2]},Qe=function(e,t,r){return{op:e,right:t,escape:r.value}},Xe=function(e,t){return{op:e,right:t,escape:""}},Ye=function(e,t){return{op:e,right:t}},Ze=function(e){return{op:e,right:{type:"expr_list",value:[]}}},Ke=function(e,t){return{op:e,right:t}},Je="+",$e=i("+",!1),et="-",tt=i("-",!1),rt=function(e,t){return ge(e,t)},it="*",nt=i("*",!1),at="/",ot=i("/",!1),st=function(e){return e.paren=!0,e},ut=function(e){return{type:"column_ref",table:"",column:e}},lt=function(e){return e},dt=function(e,t){return e+t.join("")},ct=/^[A-Za-z_\x80-\uFFFF]/,ht=n([["A","Z"],["a","z"],"_",["",""]],!1,!1),pt=/^[A-Za-z0-9_]/,ft=n([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),gt=/^[A-Za-z0-9_.\x80-\uFFFF]/,mt=n([["A","Z"],["a","z"],["0","9"],"_",".",["",""]],!1,!1),vt="@",yt=i("@",!1),_t=function(e){return{type:"param",value:e[1]}},bt=function(e,t){return{type:"function",name:"extract",args:{type:"expr_list",value:[{type:"string",value:e},t]}}},xt=function(e,t,r){return{type:"function",name:"substring",args:{type:"expr_list",value:r?[e,t,r[2]]:[e,t]}}},wt=function(e,t,r){return{type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==e?"BOTH":e},t,r]}}},St=function(e,t){return{type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==e?"BOTH":e},t]}}},Tt=function(e,t){return{type:"function",name:"position",args:{type:"expr_list",value:[e,t]}}},Ot=function(e,t){return{type:"function",name:e,args:t||{type:"expr_list",value:[]}}},Ct=function(e){return{type:"timestamp",value:e.value}},Mt=function(e){return{type:"date",value:e.value}},Rt=function(){return{type:"null",value:null}},Pt=function(){return{type:"bool",value:!0}},Et=function(){return{type:"bool",value:!1}},It="'",At=i("'",!1),Dt="N'",Ft=i("N'",!1),Lt="''",Nt=i("''",!1),jt=function(){return"'"},Ut=/^[^']/,Bt=n(["'"],!0,!1),Vt=function(e){return{type:"string",value:e.join("")}},kt=function(e,t){return{type:"case_expression",format:"simple",operand:e,clauses:t,else:null}},zt=function(e,t,r){return{type:"case_expression",format:"simple",operand:e,clauses:t,else:r.value}},Gt=function(e){return{type:"case_expression",format:"searched",clauses:e,else:null}},Ht=function(e,t){return{type:"case_expression",format:"searched",clauses:e,else:t.value}},qt=function(e,t){return{type:"when_clause",operand:e,value:t}},Wt=function(e){return{type:"else_clause",value:e}},Qt=function(e){return{type:"number",value:e}},Xt=function(e,t,r){return parseFloat(e+t+r)},Yt=function(e,t){return parseFloat(e+t)},Zt=function(e,t){return parseFloat(e+t)},Kt=function(e){return parseFloat(e)},Jt=function(e,t){return e[0]+t},$t=".",er=i(".",!1),tr=function(e){return"."+(null!=e?e:"")},rr=function(e,t){return e+t},ir=function(e){return e.join("")},nr=/^[0-9]/,ar=n([["0","9"]],!1,!1),or=/^[eE]/,sr=n(["e","E"],!1,!1),ur=/^[+\-]/,lr=n(["+","-"],!1,!1),dr=function(e,t){return"e"+(null===t?"":t)},cr="null",hr=i("NULL",!0),pr="true",fr=i("TRUE",!0),gr="false",mr=i("FALSE",!0),vr="in",yr=i("IN",!0),_r=function(){return"IN"},br="is",xr=i("IS",!0),wr=function(){return"IS"},Sr="like",Tr=i("LIKE",!0),Or=function(){return"LIKE"},Cr="escape",Mr=i("ESCAPE",!0),Rr=function(){return"ESCAPE"},Pr="not",Er=i("NOT",!0),Ir=function(){return"NOT"},Ar="and",Dr=i("AND",!0),Fr=function(){return"AND"},Lr="or",Nr=i("OR",!0),jr=function(){return"OR"},Ur="between",Br=i("BETWEEN",!0),Vr=function(){return"BETWEEN"},kr="from",zr=i("FROM",!0),Gr=function(){return"FROM"},Hr="for",qr=i("FOR",!0),Wr=function(){return"FOR"},Qr="substring",Xr=i("SUBSTRING",!0),Yr=function(){return"SUBSTRING"},Zr="extract",Kr=i("EXTRACT",!0),Jr=function(){return"EXTRACT"},$r="trim",ei=i("TRIM",!0),ti=function(){return"TRIM"},ri="position",ii=i("POSITION",!0),ni=function(){return"POSITION"},ai="timestamp",oi=i("TIMESTAMP",!0),si=function(){return"TIMESTAMP"},ui="date",li=i("DATE",!0),di=function(){return"DATE"},ci="leading",hi=i("LEADING",!0),pi=function(){return"LEADING"},fi="trailing",gi=i("TRAILING",!0),mi=function(){return"TRAILING"},vi="both",yi=i("BOTH",!0),_i=function(){return"BOTH"},bi="year",xi=i("YEAR",!0),wi=function(){return"YEAR"},Si="month",Ti=i("MONTH",!0),Oi=function(){return"MONTH"},Ci="day",Mi=i("DAY",!0),Ri=function(){return"DAY"},Pi="hour",Ei=i("HOUR",!0),Ii=function(){return"HOUR"},Ai="minute",Di=i("MINUTE",!0),Fi=function(){return"MINUTE"},Li="second",Ni=i("SECOND",!0),ji=function(){return"SECOND"},Ui="case",Bi=i("CASE",!0),Vi=function(){return"CASE"},ki="end",zi=i("END",!0),Gi=function(){return"END"},Hi="when",qi=i("WHEN",!0),Wi=function(){return"WHEN"},Qi="then",Xi=i("THEN",!0),Yi=function(){return"THEN"},Zi="else",Ki=i("ELSE",!0),Ji=function(){return"ELSE"},$i=",",en=i(",",!1),tn="(",rn=i("(",!1),nn=")",an=i(")",!1),on=/^[ \t\n\r]/,sn=n([" ","\t","\n","\r"],!1,!1),un="`",ln=i("`",!1),dn=/^[^`]/,cn=n(["`"],!0,!1),hn=function(e){return e.join("")},pn=0,fn=[{line:1,column:1}],gn=0,mn=[],vn=0;if("startRule"in r){if(!(r.startRule in ye))throw new Error("Can't start parsing from rule \""+r.startRule+'".');_e=ye[r.startRule]}if((me=_e())!==ve&&pn===t.length)return me;throw me!==ve&&pn<t.length&&s({type:"end"}),function(t,r,i){return new e(e.buildMessage(t,r),t,r,i)}(mn,gn<t.length?t.charAt(gn):null,gn<t.length?o(gn,gn+1):o(gn,gn))}}}.apply(null,[]))||(e.exports=i)},1098:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(342),r(785),r(387)],void 0===(n=function(e,t,r,i,n){function a(e,t,n){var a,o,s,u=r.vec3d.create(),l=e[3],h=Math.ceil(Math.log(l)*Math.LOG2E/c),p=Math.pow(2,h*c+d);if(n.isGeographic){var f=p/i.earthRadius*180/Math.PI;o=Math.round(e[1]/f);var g=Math.max(-90,Math.min(90,o*f)),m=f/Math.cos((Math.abs(g)-f/2)/180*Math.PI),v=(a=Math.round(e[0]/m))*m;u[0]=v,u[1]=g}else a=Math.round(e[0]/p),o=Math.round(e[1]/p),u[0]=a*p,u[1]=o*p;var y=e[2]+t;return s=Math.round(y/p),u[2]=s*p,{center:u,id:h+"_"+a+"_"+o+"_"+s}}Object.defineProperty(t,"__esModule",{value:!0});var o=1e3,s=new Float64Array(3*o),u=r.vec3d.create(),l=r.mat4d.create();t.computeGlobalTransformation=function(e,t,i,o){var s=a(e,t,i).center,u=r.mat4d.create();return n.computeLinearTransformation(i,s,u,o),u},t.reprojectPoints=function(e,t,i,a,d,c,h){var p=e.data,f=e.offsetIdx,g=e.strideIdx;r.mat4d.inverse(i,l),r.vec3d.set(t,u),u[2]+=a;var m=[0,0,0],v=p.length/g;n.vectorToVector(u,d,m,c);for(var y=0;y<v;y+=o){for(var _=Math.min(o,v-y),b=0;b<_;b++){var x=f+g*(y+b);s[3*b]=p[x]+m[0],s[3*b+1]=p[x+1]+m[1],s[3*b+2]=p[x+2]+m[2]}for(n.bufferToBuffer(s,c,0,s,h,0,_),b=0;b<_;b++){var w=s[3*b],S=s[3*b+1],T=s[3*b+2],O=f+g*(y+b);p[O]=l[0]*w+l[4]*S+l[8]*T+l[12],p[O+1]=l[1]*w+l[5]*S+l[9]*T+l[13],p[O+2]=l[2]*w+l[6]*S+l[10]*T+l[14]}}},t.createOrigin=function(e,t,r,i){var o=a(e,t,r),s=o.center,u=o.id;return n.vectorToVector(s,r,s,i),{vec3:s,id:u}};var d=1,c=5-d}.apply(null,i))||(e.exports=n)},1106:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(380),r(456)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this._deferreds=[],this._values=[]}return e.prototype.push=function(e){var t=new r;return this._deferreds.push(t),this._values.push(e),t.promise},e.prototype.unshift=function(e){var t=new r;return this._deferreds.unshift(t),this._values.unshift(e),t.promise},e.prototype.length=function(){return this._deferreds.length},e.prototype.process=function(){this._deferreds.shift().resolve(this._values.shift())},e.prototype.cancelAll=function(){for(var e=new i,t=0,r=this._deferreds;t<r.length;t++)r[t].cancel(e);this._deferreds.length=0,this._values.length=0},e}();t.IdleQueue=n}.apply(null,i))||(e.exports=n)},1120:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(337),r(335),r(400),r(396),r(456),r(358),r(383),r(379),r(357),r(353),r(680),r(338),r(343),r(339),r(446),r(462),r(377),r(437),r(336),r(384),r(443),r(763),r(1393),r(756),r(1006),r(419),r(734),r(716),r(397),r(1552),r(1553),r(1098),r(1405),r(765),r(1555),r(1018),r(906),r(764),r(1014),r(342),r(359),r(762),r(387),r(742),r(622),r(448),r(596),r(1015),r(684),r(779),r(690),r(348),r(780),r(633),r.dj.m(e)],void 0===(n=function(e,t,r,i,n,a,o,s,u,l,d,c,h,p,f,g,m,v,y,_,b,x,w,S,T,O,C,M,R,P,E,I,A,D,F,L,N,j,U,B,V,k,z,G,H,q,W,Q,X,Y,Z,K,J,$,ee,te,re){function ie(e){return W.isArrayBuffer(e.data)}function ne(e,t){return(0|e)+(0|t)|0}var ae=Q.ModelContentType,oe=f.getLogger("esri.views.3d.layers.SceneLayerView3D"),se=[1,1,1,1],ue=[.8,.8,.8],le=[.5,.5,.5],de=function(){return function(){}}(),ce=10,he=function(t){function s(){var e=null!==t&&t.apply(this,arguments)||this;return e._queryEngine=null,e._highlights=new I(e),e._elevationProvider=null,e._worker=new P,e._workerThread=null,e._texId2Meta=new Map,e._nodeId2Meta=new Map,e._rendererVersion=0,e._rendererFields=null,e._colorVariable=null,e._opacityVariable=null,e._symbolInfos=new Map,e._idbCache=new N.IDBCache("esri-scenelayer-cache","geometries",ce),e._cancelCount=0,e._hasColors=!1,e._hasTextures=!1,e._hasData=!1,e.slicePlaneEnabled=!1,e.alwaysLoadEverythingModeEnabled=!1,e._cacheKeySuffix=null,e._definitionExpressionErrors=0,e._maxDefinitionExpressionErrors=20,e._tmpAttributeOnlyGraphic=new u(null,null,{}),e}return r(s,t),Object.defineProperty(s.prototype,"hasTexturesOrVertexColors",{get:function(){return this._hasData?this._hasTextures||this._hasColors?"yes":"probably-not":"unknown"},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"rendererNeedsTextures",{get:function(){return L.rendererNeedsTextures(this.layer.renderer)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"elevationOffset",{get:function(){var e=null!=this.layer?this.layer.elevationInfo:null;if(null!=e&&"absolute-height"===e.mode){var t=w.getMetersPerVerticalUnitForSR(this.layer.spatialReference),r=C.getMetersPerUnit(e.unit);return(e.offset||0)*r/t}return 0},enumerable:!0,configurable:!0}),s.prototype._enableSecretAlwayLoadMode=function(){this.layer.store.lodModel&&"always-load"===this.layer.store.lodModel&&(this.alwaysLoadEverythingModeEnabled=!0)},Object.defineProperty(s.prototype,"uncompressedTextureDownsamplingEnabled",{get:function(){return this.view.qualitySettings.sceneService.uncompressedTextureDownsamplingEnabled&&!this.useCompressedTextures},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"useCompressedTextures",{get:function(){var e=this.layer.version,t=!c("trident")||e.major>1||1===e.major&&e.minor>3;return this.view._stage.has("s3tc")&&t},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"_enableMipMaps",{get:function(){return!this.uncompressedTextureDownsamplingEnabled},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"_enableAtlasMipMaps",{get:function(){return this._enableMipMaps},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"_atlasBiasCompensationEnabled",{get:function(){return!this.view._stage.has("shaderTextureLOD")&&this._enableAtlasMipMaps},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"_disableAtlasAnisotropy",{get:function(){return this._atlasBiasCompensationEnabled},enumerable:!0,configurable:!0}),s.prototype.initialize=function(){var t=this;if(_.open(m.getAbsMid("./SceneLayerWorker",e,re),{client:this}).then(function(e){t.destroyed?e.close():t._workerThread=e}),L.checkSceneLayerValid(this.layer),L.checkSceneLayerCompatibleWithView(this.layer,this.view),this._controller=new T({layerView:this}),this.gpuMemoryEstimate=0,this.texMemoryEstimate=0,this.geoMemoryEstimate=0,this._stage=this.view._stage,this._isIntegratedMesh=this.layer instanceof S,this._isIntegratedMesh||!this.layer.store.defaultGeometrySchema)this._hasSymbolColors=!1;else{var r=this.layer.store.defaultGeometrySchema.featureAttributes;this._hasSymbolColors=!!(r&&r.faceRange&&r.id)}this._hasVertexColors=null!=this.layer.store.defaultGeometrySchema.vertexAttributes.color&&(null==this.layer.cachedDrawingInfo||!this.layer.cachedDrawingInfo.color),this._isIntegratedMesh||(this._edgeView=this._stage.view.getEdgeView()),this._memCache=this.view.resourceController.getMemCache(this.layer.uid,function(e){return t._deleteNodeStageData(e)}),this._addThisLayerToStage(),this._elevationProvider=new A({layerView:this,stageLayer:this._stageLayer}),this.handles.add([y.init(this.view,"clippingArea",function(){return t._clippingAreaChanged()}),y.init(this.layer,"renderer",function(e){return t._rendererChange(e)}),y.init(this.layer,"objectIdFilter",function(){return t._filterChange()}),y.init(this.layer,"rangeInfos",function(e){return t._rangeInfosChanged(e)}),y.init(this,"_controller.parsedDefinitionExpression",function(){return t._filterChange()}),y.watch(this,"fullOpacity",function(e){return t._opacityChange(e)}),y.watch(this,"slicePlaneEnabled",function(e){return t._slicePlaneEnabledChange(e)}),y.watch(this,"elevationOffset",function(e,r){return t._reloadAll(r)}),y.watch(this,["rendererNeedsTextures","uncompressedTextureDownsamplingEnabled"],function(){t._reloadAll(),t._memCache.clear()}),y.init(this,"suspended",function(e){return t._suspendedChange(e)})],"sceneLayerHandles"),this._idbCache.init().catch(function(e){oe.warn("Failed to initialize IndexedDB cache: "+e)}),this._cacheKeySuffix=L.getCacheKeySuffix(this.layer.spatialReference,this.view.renderSpatialReference),this._componentColorManager=this._hasSymbolColors?new ee.BufferManager(this._stage.view.renderingContext):null,this._enableSecretAlwayLoadMode()},s.prototype.destroy=function(){this.handles.remove("sceneLayerHandles"),this._workerThread&&(this._workerThread.close(),this._workerThread=null),this._removeAllNodeDataFromStage(),this._memCache.destroy(),this._memCache=null,this._removeThisLayerFromStage(),this._stage=null,this._idbCache&&(this._idbCache.destroy(),this._idbCache=null),null!=this._controller&&(this._controller.destroy(),this._controller=null),this._highlights.destroy(),this._texId2Meta=null,this._nodeId2Meta=null,this.emit("visible-geometry-changed"),this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle.remove(),this._visibleGeometryChangedSchedulerHandle=null)},s.prototype.canResume=function(){return this.inherited(arguments)&&(!this._controller||this._controller.rootNodeVisible)},s.prototype.isUpdating=function(){return!(!this._controller||!this._controller.updating)},s.prototype.memEstimateTextureAdded=function(e){var t=e.getEstimatedTexMemRequired();return this.gpuMemoryEstimate+=t,this.texMemoryEstimate+=t,t},s.prototype.memEstimateTextureRemoved=function(e){var t=e.getEstimatedTexMemRequired();this.gpuMemoryEstimate-=t,this.texMemoryEstimate-=t},s.prototype.memEstimateGeometryAdded=function(e){var t=e.estimateGpuMemoryUsage();return this.gpuMemoryEstimate+=t,this.geoMemoryEstimate+=t,t},s.prototype.memEstimateGeometryRemoved=function(e){var t=e.estimateGpuMemoryUsage();this.gpuMemoryEstimate-=t,this.geoMemoryEstimate-=t},s.prototype.isNodeLoaded=function(e){return this._nodeId2Meta.has(e.id)},s.prototype.getUsedMemory=function(){var e=0;return this._nodeId2Meta.forEach(function(t){return e+=t.node.memory}),e},s.prototype.getUnloadedMemory=function(){return this._controller?this._controller.getUnloadedMemoryEstimate():0},s.prototype._suspendedChange=function(e){if(e)this._removeAllNodeDataFromStage(),this.view.elevationProvider.unregister(this._elevationProvider);else{var t=this._isIntegratedMesh?"im":"scene";this.view.elevationProvider.register(t,this._elevationProvider)}},s.prototype.getStats=function(){var e={index:0,nodes:this._nodeId2Meta.size.toString(),textures:this._texId2Meta.size,"Total GPU Memory Estimate":(this.gpuMemoryEstimate/1048576).toFixed(1)+"MB","Geometry Memory Estimate":(this.geoMemoryEstimate/1048576).toFixed(1)+"MB","Texture Memory Estimate":(this.texMemoryEstimate/1048576).toFixed(1)+"MB"};return this._controller&&(this._cachingEnabled()&&(e.IDBCache=Math.round(100*this._idbCache.getHitRate())+"% hit"),this._controller.updateStats(e)),e},s.prototype._addThisLayerToStage=function(){for(var e=this._stage,t=new Uint8Array(256),r=0;r<t.length;r++)t[r]=255;this._whiteTexture=new J(t,"white",{width:8,height:8}),e.add(ae.TEXTURE,this._whiteTexture);var i=this.layer.id,n=new Y(i,{},i);this._stageLayer=n,e.add(ae.LAYER,n),this._stage.addToViewContent([n.id])},s.prototype._removeThisLayerFromStage=function(){if(null!=this._stageLayer){var e=this._stage;e.remove(ae.TEXTURE,this._whiteTexture.id),this._removeAllNodeDataFromStage(),$.assert(0===this._nodeId2Meta.size),$.assert(0===this._texId2Meta.size),e.remove(ae.LAYER,this._stageLayer.id),this._stageLayer=void 0,this.gpuMemoryEstimate=0}},s.prototype.getLoadedAttributes=function(e){var t=this._nodeId2Meta.get(e.id);if(t)return t.loadedAttributes},s.prototype.getAttributeData=function(e){var t=this._nodeId2Meta.get(e.id);if(t)return t.attributeData},s.prototype.setAttributeData=function(e,t,r){var i=this._nodeId2Meta.get(e.id);i&&(i.loadedAttributes=t,i.attributeData=r,i.cachedRendererVersion=this._getInvalidRendererVersion(),this._updateEngineObject(e,i))},s.prototype.getLoadedNodeIDs=function(){return l.keysOfMap(this._nodeId2Meta)},s.prototype._calcEngineMaterialTransparencyParams=function(e,t,r){var i=this.fullOpacity,n=1-z.clamp($.fallbackIfUndefined(t.transparency,0),0,1);return{opacity:n,layerOpacity:i,transparent:n<1||i<1||e&&p.endsWith(e.channels,"a")||!0===t.useVertexColorAlpha||r}},s.prototype._calcEngineMaterialDoubleSidedParams=function(e){return null==e.doubleSided||e.doubleSided},s.prototype._calcEngineMaterialCullFaceParams=function(e){return e.cullFace?e.cullFace:null!=e.doubleSided?e.doubleSided?"none":"back":"none"},s.prototype._getMaterialParameters=function(e,t,r,i){var n;if(null!=e){var a=this._texId2Meta.get(t);n=a&&a.engineTex?a.engineTex.id:this._whiteTexture.id}var o=r.params,s=$.fallbackIfUndefined(o.diffuse,ue);"standard"!==r.type&&oe.warn("Unknown material type '"+r.type+"', must be 'standard'");var u=this._isIntegratedMesh,l={ambient:s,diffuse:s,specular:$.fallbackIfUndefined(o.specular,le),atlasRegions:o.vertexRegions,textureId:n,vertexColors:this._hasVertexColors,componentIndices:this._hasSymbolColors,componentColorBuffer:this._hasSymbolColors&&i?i.textureBuffer:null,flipV:!1,doubleSided:this._calcEngineMaterialDoubleSidedParams(o),cullFace:this._calcEngineMaterialCullFaceParams(o),writeStencil:u,receiveSSAO:!u,groundNormalShading:u,compressedNormals:!u,slicePlaneEnabled:this.slicePlaneEnabled};if(!u){var d=this._calcEngineMaterialTransparencyParams(e,o);p.mixin(l,d)}return l},s.prototype._createEngineMaterial=function(e,t,r,i,n,a,o){var s=null==t?null:this._getI3STexEncoding(t),u=this._getMaterialParameters(t,r,i,o),l=new te(u,n);if(l.metadata={i3sMatId:n,i3sTexId:r,i3sTex:t,i3sMatParams:i.params},null!=t){var d=this._texId2Meta.get(r);d?d.usedByEngineMats.push(l):(d={id:r,usedByEngineMats:[l],images:t.images,encoding:s,atlas:!0===t.atlas,wrap:"none"!==t.wrap[0]||"none"!==t.wrap[1]},this._texId2Meta.set(r,d));var c=function(e,t){for(var r=0,i=e;r<i.length;r++){var n=i[r];if(n.i3sTexId===t)return n.data}return null}(a,r);if(null!=c&&null==d.engineTex){var h=function(e,t,r,i,n){var a,o=!1;t.encoding===L.DDS_ENCODING_STRING?a=J.DDS_ENCODING:o=!(z.isPowerOfTwo(e.width)&&z.isPowerOfTwo(e.height));var s=t.usedByEngineMats.some(function(e){return e.getParams().atlasRegions})||t.atlas,u=(s?i:r)&&!o;return{mipmap:u,wrapClamp:s||!t.wrap,disableAnisotropy:s&&u&&n,encoding:a,noUnpackFlip:!0}}(c,d,this._enableMipMaps,this._enableAtlasMipMaps,this._disableAtlasAnisotropy);d.engineTex=new J(c,d.id,h),this._stage.add(ae.TEXTURE,d.engineTex),e.memory+=this.memEstimateTextureAdded(d.engineTex)}if(null!=d.engineTex)for(var p=d.engineTex.id,f=0,g=d.usedByEngineMats;f<g.length;f++){g[f].setParameterValues({textureId:p})}}return l},s.prototype._getI3STexEncoding=function(e){var t=L.getAppropriateTextureEncoding(e.encoding,this.useCompressedTextures);return t>-1?e.encoding[t]:e.encoding},s.prototype._getVertexBufferLayout=function(e,t){var r=e.params.materialID,i=t.materialDefinitions[r];$.assert(void 0!==i,"geometry wants unknown material "+r);var n,a=e.params.textureID||"none";"none"!==a&&(null!=t.textureDefinitions&&null!=t.textureDefinitions[a]||oe.warn("textureDefinitions missing in shared resource"),n=t.textureDefinitions[a]);var o=this._getMaterialParameters(n,a,i);return q.glLayout(te.getVertexBufferLayout(o))},s.prototype._createEngineMat=function(e,t,r,i,n){var a=t.params.materialID,o=r.materialDefinitions[a];$.assert(void 0!==o,"geometry wants unknown material "+a);var s,u=t.params.textureID||"none";return"none"!==u&&(null!=r.textureDefinitions&&null!=r.textureDefinitions[u]||oe.warn("textureDefinitions missing in shared resource"),s=r.textureDefinitions[u]),this._createEngineMaterial(e,s,u,o,a,i,n)},s.prototype._getObjectIdField=function(){return this.layer.objectIdField||"OBJECTID"},s.prototype._findGraphicNodeAndIndex=function(e){var t=j.attributeLookup(e.attributes,this._getObjectIdField()),r=null;return h.everyMap(this._nodeId2Meta,function(e,i){var n=e.featureIds.indexOf(t);return-1===n||(r={node:e.node,index:n},!1)}),r},s.prototype._getGraphicIndices=function(e,t){var r=this._nodeId2Meta.get(e.id);if(!r)return[];for(var i=[],n=this._getObjectIdField(),a=0,o=t;a<o.length;a++){var s=o[a],u=j.attributeLookup(s.attributes,n),l=r.featureIds.indexOf(u);-1!==l&&i.push(l)}return i},s.prototype.whenGraphicBounds=function(e){var t=this._findGraphicNodeAndIndex(e);if(!t)return g.reject();var r=this._nodeId2Meta.get(t.node.id).engineObject,i=this._boundingBoxCornerPoints(t.index,r,new Float64Array(24));if(H.bufferToBuffer(i,this.view.renderSpatialReference,0,i,this.view.spatialReference,0,8)){var n=x.empty();return x.expandWithBuffer(n,i,0,8),g.resolve({boundingBox:n,screenSpaceObjects:[]})}},s.prototype.whenGraphicAttributes=function(e,t){var r=this;return L.whenGraphicAttributes(this.layer,[e],this._getObjectIdField(),t,function(){var t=r._findGraphicNodeAndIndex(e);return{node:t.node,indices:[t.index]}},{ignoreUnavailableFields:!0,populateObjectId:!0}).then(function(e){return e[0]})},s.prototype.getGraphicFromStageObject=function(e,t){if(this.layer instanceof S)return g.reject();var r=this._getMetadata(e),i=e.getComponentFromTriangleNr(0,t);if(null!=i&&null!=r.featureIds&&i<r.featureIds.length){var n=this._createGraphic(i,r);return g.resolve(n)}return g.reject()},s.prototype._getMetadata=function(e){var t=e.getMetadata();return this._nodeId2Meta.get(t.i3sNode)},s.prototype._getCacheKey=function(e){return e.baseUrl+this._cacheKeySuffix},s.prototype._getMemCacheKey=function(e,t){return void 0===t&&(t=this.elevationOffset),e+"#"+t},s.prototype._cachingEnabled=function(){return!this._controller.disableCache&&0===this.elevationOffset&&null!=this._cacheKeySuffix},s.prototype.additionalCancelNodeLoadingHandler=function(){this._cancelCount=ne(this._cancelCount,1)},s.prototype._handleCancelled=function(e){if(ne(this._cancelCount,-e)>0)throw new o},s.prototype.loadCachedGPUData=function(e){return this._memCache.pop(this._getMemCacheKey(e.id))},s.prototype.loadCachedNodeData=function(e,t){var r=this,i=this._cancelCount;return this._cachingEnabled()?this._idbCache.get(this._getCacheKey(e)).then(function(n){if(null==n)return null;if(r._handleCancelled(i),n.nodeVersion!==e.version)return r._idbCache.remove(r._getCacheKey(e)),null;e.obb||(e.obb=G.clone(n.nodeObb),r._controller.updateVisibility(e.id));return r.rendererNeedsTextures&&n.textureData.some(function(e){if(null==e.data)return!0;var t=n.sharedResource.textureDefinitions[e.i3sTexId],i=r._getI3STexEncoding(t);return e.encoding!==i})?t(n.allGeometryData,n.sharedResource).then(function(t){return n.textureData=t,t.every(ie)&&r._idbCache.put(r._getCacheKey(e),n).catch(function(t){t&&"indexedb:not-initialized"===t.name||oe.warn("Failed to update node with textures in IndexedDB cache: "+e.id+": "+t)}),r._handleCancelled(i),n}):n}):g.resolve(null)},s.prototype.addNodeData=function(e,t){var r=this;return this._transformBundle(e,t).then(function(t){return r._controller.reschedule(e.id,t)}).then(function(i){e.obb||(e.obb=i.obb,r._controller.updateVisibility(e.id));var n={allGeometryData:t.allGeometryData,transformedGeometries:i.transformedGeometries,textureData:t.textureData,sharedResource:t.sharedResource,nodeVersion:e.version,nodeObb:e.obb,byteSize:function(e,t){for(var r=1024,i=0,n=e;i<n.length;i++){var a=n[i];r+=a.interleavedVertexData.byteLength+(a.indices?a.indices.byteLength:0),r+=a.positionData.data.byteLength+a.positionData.indices.byteLength}for(var o=0,s=t;o<s.length;o++){var u=s[o];W.isArrayBuffer(u.data)&&(r+=u.data.byteLength)}return r}(i.transformedGeometries,t.textureData)};if(r._cachingEnabled()){var a=n.textureData.map(function(e){return ie(e)?e:{i3sTexId:e.i3sTexId,encoding:e.encoding,data:null}});r._idbCache.put(r._getCacheKey(e),{allGeometryData:n.allGeometryData,transformedGeometries:n.transformedGeometries,textureData:a,sharedResource:n.sharedResource,nodeVersion:n.nodeVersion,nodeObb:n.nodeObb,byteSize:n.byteSize}).catch(function(t){return oe.warn("Failed to store node in IndexedDB cache: "+e.id+": "+t)})}return r.addCachedNodeData(e,n,t.attributeDataInfo)})},s.prototype._transformBundle=function(e,t){for(var r=this,i=[],n=[t.geometryBuffer],a=0,o=t.allGeometryData;a<o.length;a++)for(var s=0,u=o[a].geometries;s<u.length;s++){var l=u[s];i.push(this._getVertexBufferLayout(l,t.sharedResource))}var d={geometryBuffer:t.geometryBuffer,geometryData:t.allGeometryData,layouts:i,mbs:e.mbs,obb:e.obb,elevationOffset:this.elevationOffset,needNormals:!this._isIntegratedMesh&&this._controller.isMeshPyramid,normalReferenceFrame:this.layer.normalReferenceFrame||"none",indexSR:this._controller.crsIndex.toJSON(),vertexSR:this._controller.crsVertex.toJSON(),renderSR:this.view.renderSpatialReference.toJSON()};return this._workerThread?this._workerThread.invoke("process",d,n):this._controller.reschedule(e.id,d).then(function(e){return r._worker.transform(e)})},s.prototype.addCachedGPUData=function(e,t,r){return this.alwaysLoadEverythingModeEnabled||this._controller.isGeometryVisible(e)?(t.attributeData=r?r.attributeData:null,t.loadedAttributes=r?r.loadedAttributes:null,this._nodeId2Meta.set(e.id,t),t.engineObject.setHidden(t.engineObject.geometryRecords[0],!1),this._updateEngineObject(e,t),this._highlights.objectCreated(t.engineObject),g.resolve()):(this._memCache.put(this._getMemCacheKey(e.id),t,e.memory),g.resolve())},s.prototype.addCachedNodeData=function(e,t,r){var i=this;if(this._nodeId2Meta.has(e.id))return this._addOrUpdateEdgeRendering(this._nodeId2Meta.get(e.id)),this._applyFilters(e),g.resolve();if(this.suspended||!this.alwaysLoadEverythingModeEnabled&&!this._controller.isGeometryVisible(e))return g.resolve();var n=t.allGeometryData,a=t.transformedGeometries,o=t.textureData,s=t.sharedResource;if(0===n.length)return g.resolve();if(1!==n.length&&console.warn("Node with",n.length,"geometries is unsupported"),!this.rendererNeedsTextures)for(var u=0,l=o;u<l.length;u++){l[u].data=null}var d={};d[ae.OBJECT]={},d[ae.GEOMETRY]={},d[ae.MATERIAL]={};var c=0,h=!1;e.memory=0;var p=n[0],f=p.componentOffsets,m=p.geometries,v=p.featureIds,y=null,_=null;if(this._hasSymbolColors){y=this._componentColorManager.getBuffer(v.length),_=new Uint16Array(v.length);for(var b=0;b<v.length;b++)_[b]=y.aquireIndex()}for(var x,w=e.id+"|"+v[0],S=[],T=[],O=[],C=[],M=0,R=m;M<R.length;M++){var P=R[M],E=this._createEngineMat(e,P,s,o,y),I=a[c++];x=I.corMatrices.globalTrafo,h=h||I.hasColors;var A=new K(new Float32Array(I.interleavedVertexData),I.layout,I.positionData,f||K.DefaultOffsets,I.indices||K.DefaultIndices,!0);this._hasSymbolColors&&this._setComponentIndices(A,_);var F=null!=P.transformation?k.mat4d.create(P.transformation):k.mat4d.identity(),L=S.length,N=new X(A,w+(L>0?"_"+L:""));S.push(N),O.push(F),C.push([E]),T.push(D.createOrigin(e.mbs,this.elevationOffset,this._controller.crsIndex,this.view.renderSpatialReference)),e.memory+=this.memEstimateGeometryAdded(N.data),d[ae.MATERIAL][E.id]=E,d[ae.GEOMETRY][N.id]=N}var j={i3sNode:e.id,layerUid:this.layer.uid},U=new Z({idHint:e.id,name:w,geometries:S,materials:C,transformations:O,origins:T,castShadow:!0,metadata:j});U.setObjectTransformation(x),d[ae.OBJECT][U.id]=U;var B=new de;return B.node=e,B.engineObject=U,B.featureIds=v,B.attributeData=r?r.attributeData:null,B.loadedAttributes=r?r.loadedAttributes:null,B.componentColorBuffer=y,B.componentIndices=_,B.cachedRendererVersion=this._getInvalidRendererVersion(),B.cachedSymbolInfos=[],!this._hasTextures&&null!=e.textureData&&e.textureData.length>0&&(this._hasTextures=!0),this._hasColors||(this._hasColors=h),this._hasData=!0,this.notifyChange("hasTexturesOrVertexColors"),g.create(function(t){i._addOrUpdateEdgeRendering(B).then(function(){if(i._nodeId2Meta.has(e.id))return i._edgeView&&i._edgeView.removeObject(B.engineObject),t();var r=i._stageLayer,n=i._stage,a=d[ae.OBJECT];for(var o in a)a.hasOwnProperty(o)&&r.addObject(a[o]);for(var s in d)if(d.hasOwnProperty(s)){var u=d[s];for(var l in u)u.hasOwnProperty(l)&&null==n.get(s,l)&&n.add(s,u[l])}if(i._nodeId2Meta.set(e.id,B),i.suspended)return i._removeNodeStageData(e.id),t();i._setObjectSymbology(B),i._applyFilters(e),i._highlights.objectCreated(U),i.visibleGeometryChanged(U),t()})})},s.prototype._clippingAreaChanged=function(){var e=this,t=x.create();H.extentToBoundingBox(this.view.clippingArea,t,this.view.renderSpatialReference)?this._clippingArea=t:this._clippingArea=null,this._updateFilters(),this._nodeId2Meta.forEach(function(t){return e._applyFilters(t.node)}),this._controller&&this._controller.updateClippingArea(this.view.clippingArea)},s.prototype._filterChange=function(){var e=this;this._updateFilters(),this._nodeId2Meta.forEach(function(t){return e._applyFilters(t.node)})},s.prototype._updateFilters=function(){var e=this,t=[];if(this.layer.objectIdFilter){var r=new Float64Array(this.layer.objectIdFilter.ids),i="include"===this.layer.objectIdFilter.method;r.sort(),t.push(function(t,n){return e._objectIdFilter(r,i,n)})}if(this._controller&&this._controller.parsedDefinitionExpression&&this._controller.definitionExpressionFields){this._definitionExpressionErrors=0;var n=this._controller.parsedDefinitionExpression,a=this._controller.definitionExpressionFields;t.push(function(t,r){return e._sqlFilter(t,n,a,r)})}this._clippingArea&&t.push(function(t,r){return e._boundingboxFilter(t,e._clippingArea,r)}),this._filters=t},s.prototype._sqlFilter=function(e,t,r,i){var n={},a=new u(null,null,n);a.layer=this.layer,a.sourceLayer=this.layer;for(var o=this.layer.objectIdField,s=0,l=0,d=this._nodeId2Meta.get(e.id),c=d.featureIds,h=d.attributeData,p=r.every(function(e){return null!=h[e]||e===o}),f=0;f<c.length&&s<i.length;f++)if(i[s]===c[f]){var g=!0;if(p){n[o]=c[f];for(var m=0,v=r;m<v.length;m++){var y=v[m];y!==o&&(n[y]=L.getCachedAttributeValue(h[y],f))}g=this._evaluateClause(t,a)}g&&(i[l]=i[s],l++),s++}i.length=l},s.prototype._evaluateClause=function(e,t){try{return e.testFeature(t)}catch(e){return this._definitionExpressionErrors<this._maxDefinitionExpressionErrors&&oe.error("Error while evaluating definitionExpression: "+e),this._definitionExpressionErrors++,this._definitionExpressionErrors===this._maxDefinitionExpressionErrors&&oe.error("Further errors are ignored"),!1}},s.prototype._objectIdFilter=function(e,t,r){for(var i=0,n=0;i<r.length;)l.binaryIndexOf(e,r[i])>=0===t&&(r[n]=r[i],n++),i++;r.length=n},s.prototype._boundingboxFilter=function(e,t,r){var i=[0,0,0,0];H.mbsToMbs(e.mbs,this._controller.crsIndex,i,this.view.renderSpatialReference);var n=null!=t?L.intersectBoundingBoxWithMbs(t,i):2;if(2!==n){if(0===n)return void(r.length=0);var a=0,o=0,s=this._nodeId2Meta.get(e.id),u=s.featureIds,l=s.engineObject.getObjectTransformation(),d=s.engineObject.getGeometryRecords()[0].getShaderTransformation();if(k.mat4d.multiply(l,d),0===l[1]&&0===l[2]&&0===l[3]&&0===l[4]&&0===l[6]&&0===l[7]&&0===l[8]&&0===l[9]&&0===l[11]&&1===l[15]){var c=fe;c[0]=(t[0]-l[12])/l[0],c[1]=(t[1]-l[13])/l[5],c[2]=(t[2]-l[14])/l[10],c[3]=(t[3]-l[12])/l[0],c[4]=(t[4]-l[13])/l[5],c[5]=(t[5]-l[14])/l[10];for(var h=s.engineObject.getGeometryRecords()[0].geometry,p=h.componentCount,f=0;f<p&&a<r.length;f++)if(r[a]===u[f]){var g=h.getComponentAABB(f,ge);x.intersects(c,g)&&(r[o]=r[a],o++),a++}r.length=o}}},s.prototype._addOrUpdateEdgeRendering=function(e){return n(this,void 0,void 0,function(){var t,r,i,n,o,s;return a(this,function(a){switch(a.label){case 0:return this._edgeView?(t=e.engineObject,r=this._edgeView.hasObject(t),i=this._extractObjectEdgeMaterials(e),n=i.hasEdges,o=i.perFeatureEdgeMaterials,n?(s=!t.isHidden(t.geometryRecords[0]),r?(this._edgeView.updateAllComponentMaterials(t,o),this._edgeView.updateObjectVisibility(t,s),[3,3]):[3,1]):[3,4]):[2];case 1:return s?[4,this._edgeView.addObject(t,o)]:[3,3];case 2:a.sent(),a.label=3;case 3:return[3,5];case 4:r&&this._edgeView.removeObject(t),a.label=5;case 5:return[2]}})})},s.prototype._applyFilters=function(e){var t=this._nodeId2Meta.get(e.id);t&&(this._applyFiltersToObjects(e,t),this._updateEdgeRendering(t))},s.prototype._applyFiltersToObjects=function(e,t){var r=t.engineObject;if(r.unhideAllComponents(),0!==this._filters.length){for(var i=t.featureIds,n=i.slice(),a=0,o=this._filters;a<o.length;a++)(0,o[a])(e,n);if(n.length!==i.length)for(var s=0,u=r.getGeometryRecords()[0],l=0;l<i.length;l++){var d=i[l];s>=n.length||n[s]!==d?r.setComponentVisibility(u,l,!1):s++}}},s.prototype._removeAllNodeDataFromStage=function(e){var t=this;void 0===e&&(e=this.elevationOffset),this._nodeId2Meta.forEach(function(r,i){return t._removeNodeStageData(i,e)})},s.prototype.removeNodeData=function(e){var t=this;e.forEach(function(e){return t._removeNodeStageData(e.id)})},s.prototype._removeNodeStageData=function(e,t){void 0===t&&(t=this.elevationOffset);var r=this._nodeId2Meta.get(e);if(r){var i=r.engineObject;i.setHidden(i.geometryRecords[0],!0),this.visibleGeometryChanged(i),this._addOrUpdateEdgeRendering(r),this._nodeId2Meta.delete(e),this._highlights.objectDeleted(i),this._memCache.put(this._getMemCacheKey(e,t),r,r.node.memory)}},s.prototype._deleteNodeStageData=function(e){var t=this._stage,r=this._stageLayer,i=e.engineObject;this._edgeView&&this._edgeView.removeObject(i),r.removeObject(i);for(var n=0,a=i.getGeometryRecords();n<a.length;n++){var o=a[n];this.memEstimateGeometryRemoved(o.geometry.data),t.remove(ae.GEOMETRY,o.geometry.id);for(var s=0,u=o.materials;s<u.length;s++){var l=u[s];this._removeMaterial(l,t)}}if(e.componentIndices){for(var d=0;d<e.componentIndices.length;d++)e.componentColorBuffer.releaseIndex(e.componentIndices[d]);this._componentColorManager.garbageCollect()}t.remove(ae.OBJECT,i.id)},s.prototype._removeMaterial=function(e,t){t.remove(ae.MATERIAL,e.id);var r=e.metadata.i3sTexId;if(r){var i=this._texId2Meta.get(r);if(i){var n=i.usedByEngineMats;if(l.removeUnordered(n,e)||oe.error("Missing reference from material to texture"),0===n.length){var a=i.engineTex;a&&a!==this._whiteTexture&&(this.memEstimateTextureRemoved(a),t.remove(ae.TEXTURE,i.engineTex.id)),this._texId2Meta.delete(r)}}}},s.prototype.setPolygonOffset=function(e,t){var r=this._nodeId2Meta.get(e.id);if(r)for(var i=0,n=r.engineObject.getGeometryRecords();i<n.length;i++)for(var a=0,o=n[i].materials;a<o.length;a++){o[a].setParameterValues({polygonOffset:t})}},s.prototype._getInvalidRendererVersion=function(){return ne(this._rendererVersion,-1)},s.prototype._rendererChange=function(e){if(this._currentRenderer=e,this._rendererVersion=ne(this._rendererVersion,1),this._rendererFields=null,this._colorVariable=null,this._opacityVariable=null,e&&e.requiredFields&&(this._rendererFields=L.findFieldsCaseInsensitive(e.requiredFields,this.layer.fields)),e&&e.visualVariables)for(var t=0,r=e.visualVariables;t<r.length;t++){var i=r[t];"color"===i.type?this._colorVariable=i:"opacity"===i.type?this._opacityVariable=i:oe.warn("Unsupported visual variable type for 3D Object Scene Services: "+i.type)}if(e&&(e.colorInfo||e.sizeInfo)&&oe.warn("renderer.colorInfo and renderer.sizeInfo are not supported for 3D Object Scene Services. Use visualVariables instead."),e)for(var n=0,a=e.getSymbols();n<a.length;n++){var o=a[n];"mesh-3d"!==o.type&&oe.error("Symbols of type '"+o.type+"' are not supported for 3D Object Scene Services.")}this.view.resourceController.setMemoryDirty()},s.prototype._getSymbolInfos=function(e){return this._hasSymbolColors&&e.cachedRendererVersion!==this._rendererVersion&&this._updateCachedRendererData(e),e.cachedSymbolInfos},s.prototype._getSymbolColors=function(e){return this._hasSymbolColors&&e.cachedRendererVersion!==this._rendererVersion&&this._updateCachedRendererData(e),e.cachedSymbolColors},s.prototype._updateCachedRendererData=function(e){if(e.cachedRendererVersion=this._rendererVersion,this._hasSymbolColors){var t=e.featureIds?e.featureIds.length:1,r={},i=this._tmpAttributeOnlyGraphic;i.attributes=r;for(var n=this._currentRenderer,a=null!=e.featureIds?this.layer.objectIdField:null,o=null!=e.attributeData?this._rendererFields:null,s=0;s<t;s++){if(null!=a&&(r[a]=e.featureIds[s]),null!=o)for(var u=0,l=o;u<l.length;u++){var d=l[u];e.attributeData[d]&&(r[d]=L.getCachedAttributeValue(e.attributeData[d],s))}var c=n&&n.getSymbol(i),h=null;c instanceof O&&(this._symbolInfos.has(c.id)||this._symbolInfos.set(c.id,L.getSymbolInfo(c)),h=this._symbolInfos.get(c.id)),e.cachedSymbolInfos[s]=h,null==e.cachedSymbolColors&&(e.cachedSymbolColors=new Uint8Array(4*e.featureIds.length));var p=null,f=null;if(this._colorVariable){var g=n.getColor(i,{colorInfo:this._colorVariable,color:ve});g&&((p=me)[0]=g.r/255,p[1]=g.g/255,p[2]=g.b/255,this._opacityVariable||null===g.a||(f=g.a))}if(this._opacityVariable&&(f=n.getOpacity(i,{opacityInfo:this._opacityVariable})),h&&h.material){var m=h.material;p=null==p||null==f?E.overrideColor(p,f,m.color,m.alpha,se,me):E.overrideColor(p,f,null,null,se,me),V.encodeSymbolColor(p,m.colorMixMode,e.cachedSymbolColors,4*s)}else V.encodeSymbolColor(null,null,e.cachedSymbolColors,4*s)}}},s.prototype._extractObjectEdgeMaterials=function(e){for(var t=[],r=e.engineObject,i=e.featureIds?e.featureIds.length:1,n=this._edgeView.createSolidEdgeMaterial({color:[0,0,0,0],opacity:0}),a={opacity:this.fullOpacity,slicePlaneEnabled:this.slicePlaneEnabled},o=!1,s=null,u=null,l=this._getSymbolInfos(e),d=0;d<i;d++){var c=l[d];r.getComponentVisibility(r.getGeometryRecords()[0],d)&&c?(u!==c&&(u=c,(s=U.createMaterialFromEdges(this._edgeView,c.edges,a))&&(o=!0)),t.push(null!=s?s:n)):t.push(n)}return{hasEdges:o,perFeatureEdgeMaterials:t}},s.prototype._setObjectSymbology=function(e){if(this._hasSymbolColors){for(var t=e.featureIds?e.featureIds.length:1,r=!1,i=this._getSymbolColors(e),n=e.componentColorBuffer.textureBuffer,a=0;a<t;a++){var o=4*a,s=e.componentIndices[a];n.setData(s,0,i[o],i[o+1],i[o+2],i[o+3]),V.isOpaqueSymbolColor(i,o)||(r=!0)}this._updateObjectOpacity(e.engineObject,r)}},s.prototype._setComponentIndices=function(e,t){for(var r=e.getAttribute($.VertexAttrConstants.COMPONENTINDEX),i=r.data,n=r.offsetIdx,a=r.strideIdx,o=e.getIndices($.VertexAttrConstants.COMPONENTINDEX),s=0;s<t.length;s++)for(var u=e.componentOffsets[s],l=e.componentOffsets[s+1],d=u;d<l;d++){i[n+o[d]*a]=t[s]}},s.prototype._rangeInfosChanged=function(e){null!=e&&e.length>0&&oe.warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")},s.prototype._reloadAll=function(e){void 0===e&&(e=this.elevationOffset),this._removeAllNodeDataFromStage(e),null!=this._controller&&this._controller.restartNodeLoading()},s.prototype._opacityChange=function(e){var t=this;this._nodeId2Meta.forEach(function(e){t._updateObjectOpacity(e.engineObject),t._updateEdgeRendering(e)})},s.prototype._updateObjectOpacity=function(e,t){for(var r=0,i=e.getGeometryRecords();r<i.length;r++)for(var n=0,a=i[r].materials;n<a.length;n++){var o=a[n],s=o.metadata;void 0!==t&&(s.symbolIsTransparent=t);var u=o.getParams(),l=this._calcEngineMaterialTransparencyParams(s.i3sTex,s.i3sMatParams,s.symbolIsTransparent);u.transparent===l.transparent&&u.layerOpacity===l.layerOpacity||o.setParameterValues(l)}},s.prototype._updateEngineObject=function(e,t){this._setObjectSymbology(t),this._addOrUpdateEdgeRendering(t),this._applyFilters(e),this.visibleGeometryChanged(t.engineObject)},s.prototype._slicePlaneEnabledChange=function(e){var t=this,r={slicePlaneEnabled:e};this._nodeId2Meta.forEach(function(e){for(var i=0,n=e.engineObject.getGeometryRecords();i<n.length;i++)for(var a=0,o=n[i].materials;a<o.length;a++){o[a].setParameterValues(r)}t._updateEdgeRendering(e)})},s.prototype._updateEdgeRendering=function(e){this._edgeView&&this._edgeView.hasObject(e.engineObject)&&this._addOrUpdateEdgeRendering(e)},s.prototype.queryExtent=function(e){return this._ensureQueryEngine().queryExtent(e)},s.prototype.queryFeatureCount=function(e){return this._ensureQueryEngine().queryFeatureCount(e)},s.prototype.queryFeatures=function(e){return this._ensureQueryEngine().queryFeatures(e)},s.prototype.queryObjectIds=function(e){return this._ensureQueryEngine().queryObjectIds(e)},s.prototype._ensureQueryEngine=function(){return this._queryEngine||(this._queryEngine=this._createQueryEngine()),this._queryEngine},s.prototype._createQueryEngine=function(){var e=this,t={id:0,index:0,meta:null,bbCorners:new Float64Array(24)};return new F(this.layer,{forAll:function(r,i){e._forAllFeatures(function(i,n,a){t.id=i,t.index=n,t.meta=a,e._boundingBoxCornerPoints(n,a.engineObject,t.bbCorners),r(t)},i)},createGraphic:function(t){return e._createGraphic(t.index,t.meta)},requestFields:function(t,r,i){return L.whenGraphicAttributes(e.layer,r,e._getObjectIdField(),i,function(){var i=e._getGraphicIndices(t,r);return{node:t,indices:i}},{ignoreUnavailableFields:!1})},createExtentBuilder:function(){return e._createExtentBuilder()}},{enableObjectId:!0,enableOutFields:!!this.layer.objectIdField})},s.prototype._createExtentBuilder=function(){var e=this.view.renderSpatialReference,t=this.view.spatialReference,r=x.empty(),i=new Float64Array(24);return{add:function(n){H.bufferToBuffer(n.bbCorners,e,0,i,t,0,8)&&x.expandWithBuffer(r,i,0,8)},getExtent:function(){return x.toExtent(r,t)}}},s.prototype._forAllFeatures=function(e,t,r){var i=this;this._nodeId2Meta.forEach(function(n,a){i._forAllFeaturesOfNode(n,e,r),t&&t(n.node)})},s.prototype._forAllFeaturesOfNode=function(e,t,r){for(var i=e.featureIds,n=e.engineObject.getGeometryRecords()[0],a=0;a<i.length;a++)if(r||e.engineObject.getComponentVisibility(n,a)){t(i[a],a,e,n)}},s.prototype._createGraphic=function(e,t){var r={};if(null!=t.featureIds&&(r[this._getObjectIdField()]=t.featureIds[e]),null!=t.attributeData)for(var i=0,n=Object.keys(t.attributeData);i<n.length;i++){var a=n[i];r[a]=L.getCachedAttributeValue(t.attributeData[a],e)}var o=new u(null,null,r);return o.layer=this.layer,o.sourceLayer=this.layer,o},s.prototype._boundingBoxCornerPoints=function(e,t,r){for(var i=t.geometries[0].getComponentAABB(e,fe),n=0;n<8;++n)pe[0]=1&n?i[0]:i[3],pe[1]=2&n?i[1]:i[4],pe[2]=4&n?i[2]:i[5],k.mat4d.multiplyVec3(t.objectTransformation,pe),r[3*n]=pe[0],r[3*n+1]=pe[1],r[3*n+2]=pe[2];return r},s.prototype.highlight=function(e,t){var r=this,i=this._highlights;if(e instanceof M){var n=i.acquireSet(t),a=n.set,o=n.handle;return this.queryObjectIds(e).then(function(e){return i.setFeatureIds(a,e)}),o}if("number"==typeof e?e=[e]:e instanceof u?e=[e]:e instanceof d&&(e=e.toArray()),Array.isArray(e)&&e.length>0){if(e[0]instanceof u){var s=e.map(function(e){return j.attributeLookup(e.attributes,r._getObjectIdField())}),l=i.acquireSet(t),c=l.set;o=l.handle;return i.setFeatureIds(c,s),o}if("number"==typeof e[0]){s=e;var h=i.acquireSet(t);c=h.set,o=h.handle;return i.setFeatureIds(c,s),o}}return{remove:function(){}}},s.prototype.visibleGeometryChanged=function(e){var t=this;e?this._elevationProvider.objectChanged(e):this._elevationProvider.layerChanged(),null==this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle=v.schedule(function(){t.emit("visible-geometry-changed"),t._visibleGeometryChangedSchedulerHandle=null}))},i([b.property()],s.prototype,"layer",void 0),i([b.property()],s.prototype,"_controller",void 0),i([b.property({dependsOn:["_controller.updating"]})],s.prototype,"updating",void 0),i([b.property({dependsOn:["_controller.rootNodeVisible"]})],s.prototype,"suspended",void 0),i([b.property(B.updatingPercentage)],s.prototype,"updatingPercentage",void 0),i([b.property({readOnly:!0,aliasOf:"_controller.updatingPercentage"})],s.prototype,"updatingPercentageValue",void 0),i([b.property({readOnly:!0})],s.prototype,"hasTexturesOrVertexColors",null),i([b.property({readOnly:!0,dependsOn:["layer.renderer"]})],s.prototype,"rendererNeedsTextures",null),i([b.property({readOnly:!0,dependsOn:["layer.elevationInfo"]})],s.prototype,"elevationOffset",null),i([b.property({type:Boolean})],s.prototype,"slicePlaneEnabled",void 0),i([b.property()],s.prototype,"alwaysLoadEverythingModeEnabled",void 0),i([b.property({dependsOn:["view.qualitySettings.sceneService.uncompressedTextureDownsamplingEnabled","useCompressedTextures"]})],s.prototype,"uncompressedTextureDownsamplingEnabled",null),i([b.property({dependsOn:["layer.version"]})],s.prototype,"useCompressedTextures",null),i([b.subclass("esri.views.3d.layers.SceneLayerView3D")],s)}(b.declared(R)),pe=k.vec3d.create(),fe=x.create(),ge=x.create(),me=[0,0,0,0],ve=new s([0,0,0,0]);return he}.apply(null,i))||(e.exports=n)},1376:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(771),r(342),r(1012),r(348)],void 0===(n=function(e,t,r,i,n,a){function o(e,t,r,i,n,a,o){switch(r){case 1:for(var s=0;s<o;s++)i[n]=e[t],t+=1,n+=a;break;case 2:for(s=0;s<o;s++)i[n]=e[t],i[n+1]=e[t+1],t+=2,n+=a;break;case 3:for(s=0;s<o;s++)i[n]=e[t],i[n+1]=e[t+1],i[n+2]=e[t+2],t+=3,n+=a;break;case 4:for(s=0;s<o;s++)i[n]=e[t],i[n+1]=e[t+1],i[n+2]=e[t+2],i[n+3]=e[t+3],t+=4,n+=a;break;default:throw h("Unhandled stride size "+r)}}function s(e,t,r,i,n,a){switch(t){case 1:for(var o=0;o<a;o++)r[i]=e,i+=n;break;case 2:for(o=0;o<a;o++)r[i]=e,r[i+1]=e,i+=n;break;case 3:for(o=0;o<a;o++)r[i]=e,r[i+1]=e,r[i+2]=e,i+=n;break;case 4:for(o=0;o<a;o++)r[i]=e,r[i+1]=e,r[i+2]=e,r[i+3]=e,i+=n;break;default:throw h("Unhandled stride size "+t)}}function u(e){switch(e){case 5120:return Int8Array;case 5126:return Float32Array;case 5124:return Int32Array;case 5122:return Int16Array;case 5121:return Uint8Array;case 5125:return Uint32Array;case 5123:return Uint16Array}throw new Error("Unhandled data type: "+e)}function l(e){switch(e){case 5120:return"Int8";case 5126:return"Float32";case 5124:return"Int32";case 5122:return"Int16";case 5121:return"UInt8";case 5125:return"UInt32";case 5123:return"UInt16"}throw new Error("Unhandled data type: "+e)}function d(e){return e%Uint32Array.BYTES_PER_ELEMENT==0}function c(e){return e>0&&e%Uint32Array.BYTES_PER_ELEMENT==0}function h(e){return new Error("I3SGeometryUtil processing failed: "+e)}function p(e){var t=e.normals,r=e.positions,n=e.normalInd,o=e.positionInd;a.assert(e.normalInd.length===e.positionInd.length);for(var s=i.vec3.create(),u=i.vec3.create(),l=i.vec2.create(),d=r.data,c=r.offsetIdx,h=r.strideIdx,p=t.data,f=t.offsetIdx,g=t.strideIdx,m=0;m<o.length;m+=3){var v=o[m],y=c+h*v,_=d[y],b=d[y+1],x=d[y+2];y=c+h*(v=o[m+1]),s[0]=d[y]-_,s[1]=d[y+1]-b,s[2]=d[y+2]-x,y=c+h*(v=o[m+2]),u[0]=d[y]-_,u[1]=d[y+1]-b,u[2]=d[y+2]-x,i.vec3.cross(s,u,s),a.encodeNormal(s,l);for(var w=0;w<3;w++){var S=f+g*n[m+w];p[S]=a.encodeInt16(l[0]),p[S+1]=a.encodeInt16(l[1])}}}function f(e,t,r){var i=e.length/3,n=t.data,o=t.offsetIdx,s=t.strideIdx;if(null!=r)for(var u=r,l=u[0],d=u[1],c=u[2],h=u[4],p=u[5],f=u[6],g=u[8],m=u[9],_=u[10],b=0;b<i;b++){var x=e[3*b],w=e[3*b+1],S=e[3*b+2];v[0]=l*x+d*w+c*S,v[1]=h*x+p*w+f*S,v[2]=g*x+m*w+_*S,a.encodeNormal(v,y),n[o+b*s]=a.encodeInt16(y[0]),n[o+b*s+1]=a.encodeInt16(y[1])}else for(b=0;b<i;b++)v[0]=e[3*b],v[1]=e[3*b+1],v[2]=e[3*b+2],a.encodeNormal(v,y),n[o+b*s]=a.encodeInt16(y[0]),n[o+b*s+1]=a.encodeInt16(y[1])}Object.defineProperty(t,"__esModule",{value:!0});var g=new Uint8Array(64);t.interleaveGeometryBuffer=function(e,t,r,i,n){void 0===i&&(i=[]),void 0===n&&(n=[]);var a=e.params.vertexAttributes,p=a.position.count;if(!c(r[0].stride))throw h("Layout stride must use "+Uint32Array.BYTES_PER_ELEMENT+"-byte words");for(var f=r[0].stride/Uint32Array.BYTES_PER_ELEMENT,m=new Uint32Array(f*p),v=0,y=r=r.slice(0).sort(function(e,t){return e.offset-t.offset});v<y.length;v++)!function(e){if(-1!==n.indexOf(e.name))return"continue";var r=a[e.name],f=u(e.type),v=void 0,y=!1;if(null==r){var _=i.filter(function(t){return t.name===e.name})[0];if(!_)throw h("Geometry definition is missing attribute");r={valueType:l(e.type),byteOffset:0,count:p,valuesPerElement:e.count};for(var b=0;b<g.length;b++)g[b]=_.byteValue;v=g.buffer,y=!0}else v=t;if(l(e.type)!==r.valueType)throw h("Geometry definition type must match attribute type");if(!d(r.byteOffset)||!d(e.offset))throw h(e.name+" offset must use "+Uint32Array.BYTES_PER_ELEMENT+"-byte words");if(!c(r.valuesPerElement*f.BYTES_PER_ELEMENT)||!c(e.count*f.BYTES_PER_ELEMENT))throw h(e.name+" data must use "+Uint32Array.BYTES_PER_ELEMENT+"-byte words");var x=new Uint32Array(v),w=r.byteOffset/Uint32Array.BYTES_PER_ELEMENT,S=r.valuesPerElement*f.BYTES_PER_ELEMENT/Uint32Array.BYTES_PER_ELEMENT,T=e.offset/Uint32Array.BYTES_PER_ELEMENT,O=e.stride/Uint32Array.BYTES_PER_ELEMENT;y?s(x[0],S,m,T,O,p):o(x,w,S,m,T,O,p)}(y[v]);return m.buffer},t.processAndInterleaveNormals=function(e,t,i,n,a){if("none"===e)p(a);else{var o="earth-centered"===e?n:null;f(r.createTypedView(i,t.params.vertexAttributes.normal),a.normals,o)}};var m=65536;t.extractPositionData=function(e,t,r){var i=t[0];if(null==i||"position"!==i.name||5126!==i.type)return null;for(var a=new Float32Array(e),o=i.stride/4,s=3*a.length/o,u=new Float32Array(s),l=0;l<s/3;l++)u[3*l]=a[l*o+i.offset],u[3*l+1]=a[l*o+i.offset+1],u[3*l+2]=a[l*o+i.offset+2];var d,c=n.deduplicate(u.buffer,3),h=c.uniqueCount<m;if(r)for(d=new(h?Uint16Array:Uint32Array)(r.length),l=0;l<r.length;l++)d[l]=c.indices[r[l]];else d=h?new Uint16Array(c.indices):c.indices;return{data:new Float32Array(c.buffer),indices:d}};var v=i.vec3.create(),y=i.vec2.create()}.apply(null,i))||(e.exports=n)},1393:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(337),r(335),r(456),r(435),r(346),r(379),r(449),r(365),r(353),r(343),r(407),r(624),r(339),r(377),r(336),r(1025),r(384),r(763),r(795),r(1394),r(1395),r(1396),r(765),r(1397),r(1106),r(342),r(387),r(1398)],void 0===(n=function(e,t,r,i,n,a,o,s,u,l,d,c,h,p,f,g,m,v,y,_,b,x,w,S,T,O,C,M,R,P){function E(e,t){return e.length===t.length&&e.every(function(e){return I(t,e.name)>=0})}function I(e,t){for(var r=t.toLowerCase(),i=0;i<e.length;i++)if(e[i].name.toLowerCase()===r)return i;return-1}function A(e){return null!=e.loadedAttributes&&null!=e.attributeData}var D=c.getLogger("esri.layers.graphics.controllers.I3SOnDemandController"),F=function(e){function t(t){var r=e.call(this)||this;return r.nodeIndex={},r.screenSizeFactor=0,r.featureTarget=5e4,r.updating=!0,r.updatingPercentage=0,r.leafsReached=!1,r.uncompressedTextureDownsamplingEnabled=!1,r.alwaysLoadEverythingModeEnabled=!1,r._lodFactorProperty=null,r._featureLOD=1,r._stableFeatureLOD=!1,r._isIdle=!1,r._cameraDirty=!0,r._hasFeatures=!1,r._downloadingNodes=new Set,r._loadingNodes=new Set,r._updatingNodes=new Map,r._progressMaxNumNodes=1,r._poi=null,r._requiredAttributesDirty=!0,r._updatesDisabled=!1,r.disableCache=!1,r._restartNodeLoading=!1,r._fields=null,r._attributeStorageInfo=null,r._handles=new l,r._idleQueue=new C.IdleQueue,r._errorCount=0,r}return r(t,e),Object.defineProperty(t.prototype,"isMeshPyramid",{get:function(){return"mesh-pyramids"===this.layer.profile||"MeshPyramid"===this.layer.store.lodType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"streamDataSupplier",{get:function(){return this.layerView.view.resourceController.getStreamDataSupplier(P.ClientType.SCENE,{trackRequests:!0})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parsedDefinitionExpression",{get:function(){if(!(this.layer instanceof b&&this.layer.definitionExpression))return null;try{var e=v.create(this.layer.definitionExpression);if(!e.isStandardized())return D.error("definitionExpression is using non standard function"),null;var t=[],r=e.getFields();return T.findFieldsCaseInsensitive(r,this.layer.fields,{missingFields:t}),t.length>0?(D.error("definitionExpression references unknown fields: "+t.join(", ")),null):e}catch(e){return D.error("Failed to parse definitionExpression: "+e),null}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"definitionExpressionFields",{get:function(){if(this.parsedDefinitionExpression){var e=this.parsedDefinitionExpression.getFields();return T.findFieldsCaseInsensitive(e,this._fields)}return null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"crsVertex",{get:function(){return T.getVertexCrs(this.layer)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"crsIndex",{get:function(){return T.getIndexCrs(this.layer)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rootNodeVisible",{get:function(){var e=this._rootNodeId&&this.nodeIndex[this._rootNodeId];return!e||!this._viewportQueries||this._viewportQueries.isNodeVisible(e)},enumerable:!0,configurable:!0}),t.prototype.initialize=function(){var e=this;this.updateEventListener={needsUpdate:function(){return!1},idleBegin:function(){e._updateIdleState(!0)},idleEnd:function(){e._updateIdleState(!1)}},this.updateEventListenerWhileSuspended={idleBegin:function(){return e._startNodeLoadingWhileSuspended()}},this._lodHandling=new w(this.layerView,function(){return e.updatingChanged()});var t=this.layerView.layer;this.layer=t,this._defaultGeometrySchema=t.store.defaultGeometrySchema,this._rootNodeUrl=t.store.rootNode;var r=this._rootNodeUrl.split("/");this._rootNodeId=r[r.length-1],this.disableCache=d("disable-feature:idb-cache"),t instanceof b?("mesh"===t.geometryType?this._lodFactorProperty="qualitySettings.sceneService.3dObject.lodFactor":"point"===t.geometryType&&(this._lodFactorProperty="qualitySettings.sceneService.point.lodFactor"),this._fields=t.fields,this._attributeStorageInfo=t.attributeStorageInfo):t instanceof _&&(this._lodFactorProperty="qualitySettings.sceneService.integratedMesh.lodFactor");var i=a([this.layer.when(),this.layerView.when()]).then(function(){if(!e.destroyed&&e.layerView&&!e.layerView.destroyed){var t=e.layerView.view;e.setClippingArea(t.clippingArea);var r=t.pointsOfInterest;e._centerOnSurface=r.centerOnSurfaceFrequent,e._handles.add(e._centerOnSurface.watch("renderLocation",function(){return e._pointOfInterestChanged()}));var i=e.layerView.view.resourceController;i.memoryEvents.on("quality-changed",function(){return e._setCameraDirty()}),e._handles.add(g.init(e.layerView,"suspended",function(t){e._idleFrameWorker&&(e._idleFrameWorker.remove(),e._idleFrameWorker=null,e.restartNodeLoading()),e._frameWorker&&(e._frameWorker.remove(),e._frameWorker=null),t?e._idleFrameWorker=i.registerIdleFrameWorker(e.updateEventListenerWhileSuspended):(e._idleFrameWorker=i.registerIdleFrameWorker(e.updateEventListener),e._frameWorker=i.registerFrameWorker(function(t){return e._frame(t)}))}),"layerview"),e._handles.add(e.layer.watch("elevationInfo",function(t){return e._elevationInfoChanged(t)}),"layer"),e.watch("uncompressedTextureDownsamplingEnabled",function(){return e.restartNodeLoading()}),e.watch("alwaysLoadEverythingModeEnabled",function(){return e.restartNodeLoading()}),e._handles.add(t.state.watch("camera",function(){return e._setCameraDirty()})),e._handles.add(e.watch("featureTarget",function(){e._stableFeatureLOD=!1})),e._lodFactorProperty&&e._handles.add(e.layerView.view.watch(e._lodFactorProperty,function(){return e._setCameraDirty()}),"quality")}});this.addResolvingPromise(i),this.when(function(){return e._startNodeLoading()})},t.prototype.destroy=function(){this._idleFrameWorker&&(this._idleFrameWorker.remove(),this._idleFrameWorker=null),this._frameWorker&&(this._frameWorker.remove(),this._frameWorker=null),this._handles.destroy(),this._nodeLoader=null},t.prototype._getRequiredAttributes=function(){if(!(null!=this._attributeStorageInfo&&this.layer instanceof b&&this._fields))return[];var e=Object.create(null);if(this.layer.renderer&&this.layer.renderer.collectRequiredFields(e),this.layer.labelsVisible&&this.layer.labelingInfo&&this.layer.labelingInfo.forEach(function(t){t._collectRequiredFields(e)}),null!=this.definitionExpressionFields)for(var t=0,r=this.definitionExpressionFields;t<r.length;t++){var i=r[t];e[i]=!0}var n=this._attributeStorageInfo,a=this._fields,o=this.layer.objectIdField;return Object.keys(e).map(function(e){var t=I(n,e),r=I(a,e);return t>=0&&r>=0?{index:t,name:a[r].name,field:a[r],attributeStorageInfo:n[t]}:null}).filter(function(e){return null!=e&&e.name!==o}).sort(function(e,t){return t.index-e.index}).filter(function(e,t,r){return 0===t||r[t-1].index!==e.index})},t.prototype._requiredFieldsChange=function(){this._requiredAttributesDirty=!0,this.restartNodeLoading()},t.prototype._labelingChanged=function(){E(this._requiredAttributes,this._getRequiredAttributes())||this._requiredFieldsChange()},t.prototype.setClippingArea=function(e){var t=y.create();R.extentToBoundingBox(e,t,this.layerView.view.renderSpatialReference)?this._clippingArea=t:this._clippingArea=null},t.prototype._pointOfInterestChanged=function(){this._poi&&(this._calculatePointOfInterest(this._poi),this._viewportQueries&&(this._viewportQueries.updatePointOfInterest(this._poi),this._index&&(this._index.progressiveLoadPenalty=N.distancePenalty*this._viewportQueries.distCameraToPOI(),this._index.requestReload())))},t.prototype._calculatePointOfInterest=function(e){void 0===e&&(e=M.vec3d.create());var t=this._centerOnSurface.renderLocation,r=M.vec3d.create();M.vec3d.subtract(t,this.camPos,r),M.vec3d.normalize(r);var i=this.layerView.view.renderCoordsHelper,n=M.vec3d.create();i.worldUpAtPosition(t,n);var a=Math.acos(M.vec3d.dot(n,r))-.5*Math.PI;return M.vec3d.lerp(this.camPos,t,Math.max(0,Math.min(1,a/(.5*Math.PI))),e),e},t.prototype.updateClippingArea=function(e){this.setClippingArea(e),this._cameraDirty=!0,this._viewportQueries&&this._viewportQueries.updateExtent(this._clippingArea)},t.prototype._setCameraDirty=function(){this._cameraDirty=!0,this.updatingChanged()},t.prototype.getBaseUrl=function(){return this.layer.parsedUrl.path},t.prototype.updateElevationChanged=function(e,t,r){T.findIntersectingNodes(e,t,this.nodeIndex.root,this.crsIndex,this.nodeIndex,function(e){r.push(e)});for(var i=0;i<r.length;i++){var n=r.data[i];this._viewportQueries.invalidateCache(n.id),n.id===this._rootNodeId&&this.notifyChange("rootNodeVisible")}r.length&&this.restartNodeLoading()},t.prototype._elevationInfoChanged=function(e){this._viewportQueries.invalidateCache(),this._initViewData()},t.prototype.restartNodeLoading=function(){this._restartNodeLoading=!0,this.updatingChanged()},t.prototype.schedule=function(e,t){var r=this;return this._idleQueue.push(t).then(function(t){if(!r._loadingNodes.has(e)&&!r._updatingNodes.has(e))throw new n;return t})},t.prototype.reschedule=function(e,t){var r=this;return this._idleQueue.unshift(t).then(function(t){if(!r._loadingNodes.has(e)&&!r._updatingNodes.has(e))throw new n;return t})},t.prototype.getUnloadedMemoryEstimate=function(){return this._index?this._index.getUnloadedMemoryEstimate()*this._getLodDropFactor():0},t.prototype._frame=function(e){null!==this._viewportQueries&&this._viewportQueries.setCameraIdle(!this._cameraDirty),this.layerView.visible&&this._processLogError(e,!1)},t.prototype._processLogError=function(e,t){void 0===t&&(t=!0);try{this._process(e,t)}catch(e){this._errorCount<50?D.error("Error during processing: "+e):50===this._errorCount&&D.error("Too many errors for this layer. Further errors will not be displayed."),this._errorCount++}},t.prototype._process=function(e,t){var r=this;if(this._restartNodeLoading&&(this.cancelNodeLoading(),this._startNodeLoading()),null!=this._nodeLoader&&null!=this._index){this._updateViewData()&&(t=!1);var i=function(r){!t&&e.done()||r()&&(t=!1)};for(i(function(){return r._processIndex()}),i(function(){return r._processNodes(e,t)});this._idleQueue.length()>0&&(t||!e.done());)t=!1,this._idleQueue.process();this._updateFeatureLOD(),i(function(){return r._prefetchIndex()}),this.updatingChanged(),this._lodHandling.lodGlobalHandling()}},t.prototype._processIndex=function(){var e=Math.min(10-this._index.getIndexLoading(),this._getAvailableLoadTokens(1));this._index.update(s.keysOfSet(this._loadingNodes));var t=this._index.getFeatureEstimate().leafsReached;return this._index.isLoading()||t===this._get("leafsReached")||this._set("leafsReached",t),this._index.load(e)},t.prototype._prefetchIndex=function(){if(this._loadingNodes.size>0)return!1;var e=Math.min(10-this._index.getIndexLoading(),this._getAvailableLoadTokens(1));return this._index.prefetch(e)},t.prototype._updateFeatureLOD=function(){var e=this._index.getFeatureEstimate(),t=this.featureTarget*this._getLOD()/this._featureLOD;if(e.estimate){var r=!this._index.isLoading();if(!r&&!this._index.isPrefetching()&&this._index.getIndexMissing()>500){if(this._featureLOD<=1e-4)return;this._featureLOD/=1.5,this._stableFeatureLOD=!1}else if(r&&e.estimate<t){if(this._featureLOD>=1e4||e.leafsReached||this._stableFeatureLOD)return;var i=this._featureLOD,n=Math.min(.1*(t/e.estimate-1),.1);if(this._featureLOD*=1+n,!this._index.checkFeatureTarget(t,this._getLOD()))return this._featureLOD=i,void(this._stableFeatureLOD=!0)}else{if(!(e.estimate>1.2*t||r&&e.estimate>t))return;if(this._featureLOD<=1e-4)return;this._featureLOD/=1+.25*(e.estimate/t-1),this._stableFeatureLOD=!1}this._featureLOD=Math.min(1e4,Math.max(1e-4,this._featureLOD)),this._viewportQueries.updateScreenSpaceErrorBias(this._getLOD()),this._index.requestReload()}},t.prototype._processNodes=function(e,t){var r=this,i=(this._isIdle?100:2)-this._loadingNodes.size,n=this._index.getUpdates(i);return n.cancel.forEach(this._cancelNodeIdLoading,this),n.update.forEach(function(i){!t&&e.done()||(t=!1,r._updateLoadedNode(i))}),n.add.forEach(function(i){!t&&e.done()||(t=!1,r._loadNode(i))}),!t},t.prototype._cancelNodeLoading=function(){var e=this;this._loadingNodes.clear(),this._downloadingNodes.clear(),this._updatingNodes.forEach(function(t,r){return e._updatingNodes.get(r).cancel()}),this._updatingNodes.clear()},t.prototype._cancelNodeIdLoading=function(e){this._loadingNodes.delete(e),this._downloadingNodes.delete(e)},t.prototype._getAvailableLoadTokens=function(e){return Math.floor((12-1*this._index.getIndexLoading()-2*this._downloadingNodes.size)/e)},t.prototype._hasNodeLoadToken=function(){var e=this._isIdle?5:2;return!(this._downloadingNodes.size>=e)&&this._getAvailableLoadTokens(2)>0},t.prototype.updatingChanged=function(){var e=(this._index?this._index.getIndexMissing():0)+3*(this._index?this._index.getNodesMissing():0)+2*this._loadingNodes.size,t=!(!(e>0||this._updatingNodes.size>0||this._index&&this._index.isPrefetching()||this._restartNodeLoading||this._cameraDirty||this._idleQueue.length()>0||this._lodHandling&&this._lodHandling.requiresLODGlobalHandling)&&this._isIdle);0===e&&(this._progressMaxNumNodes=1),this._progressMaxNumNodes=Math.max(e,this._progressMaxNumNodes),t!==this._get("updating")&&this._set("updating",t);var r=100*e/this._progressMaxNumNodes;r!==this._get("updatingPercentage")&&this._set("updatingPercentage",r)},t.prototype._initViewData=function(){var e=this.layerView.view,t=e.state.camera,r=e.renderCoordsHelper;this.camPos=M.vec3d.create(e.pointsOfInterest.renderPointOfView),this.screenSizeFactor=1/t.perPixelRatio,this._poi=this._calculatePointOfInterest();var i=this._getLOD();this._viewportQueries=new O(this.crsIndex,r,t,this._poi,this._clippingArea,e.elevationProvider,this.layer.elevationInfo,{progressiveLoadFactor:this._getProgressiveLoadFactor(this.layer,i),screenspaceErrorBias:i,angleDependentLoD:i<.5,disableLod:this.alwaysLoadEverythingModeEnabled}),this._cameraDirty=!1,this.notifyChange("rootNodeVisible")},t.prototype._updateViewData=function(){if(!this._cameraDirty||!this._index)return!1;var e=this.layerView.view,t=e.state.camera;this.camPos=M.vec3d.create(e.pointsOfInterest.renderPointOfView),this.screenSizeFactor=1/t.perPixelRatio,this._poi=this._calculatePointOfInterest(this._poi),this._viewportQueries.updateCamera(t),this._viewportQueries.updatePointOfInterest(this._poi);var r=this._getLOD();this._viewportQueries.updateScreenSpaceErrorBias(r),this._index.progressiveLoadPenalty=N.distancePenalty*this._viewportQueries.distCameraToPOI(),this._index.requestReload(),this._stableFeatureLOD=!1;var i=!this.alwaysLoadEverythingModeEnabled&&this._removeInvisibleNodes();return this._cameraDirty=!1,this.notifyChange("rootNodeVisible"),i},t.prototype._getProgressiveLoadFactor=function(e,t){return e instanceof b&&"mesh"===e.geometryType?t>=1&&d("enable-feature:progressive-3dobject")?N.factor3dObject:1:e instanceof _&&(t>=1&&!d("disable-feature:progressive-im"))?N.factorIM:1},t.prototype._getLOD=function(){return(this._lodFactorProperty&&this.layerView.view.get(this._lodFactorProperty)||1)*this.layerView.view.resourceController.memoryFactor*this._featureLOD},t.prototype._getLodDropFactor=function(){return Math.min(this.layerView.view.resourceController.memoryFactor,.5)/.5},t.prototype._startNodeLoadingWhileSuspended=function(){this._initViewData(),this.alwaysLoadEverythingModeEnabled&&this.layerView.visible&&!this.layerView.get("parent.suspended")||this._removeInvisibleNodes()},t.prototype.isGeometryVisible=function(e){return this._viewportQueries.isGeometryVisible(e)},t.prototype.updateVisibility=function(e){return this._viewportQueries.updateNode(e)},t.prototype._shouldLoadNode=function(e){if(!this._lodHandling.shouldLoadNode(e))return!1;var t=this._getLodDropFactor();return!(t>0&&this._viewportQueries.maxDistance>0&&this._lodHandling.childrenEmpty(e)&&this._viewportQueries.distToPOI(e)>this._viewportQueries.maxDistance*t)&&(!e.obb||this._viewportQueries.isGeometryVisible(e))},t.prototype._startNodeLoading=function(){var e=this;if(this._restartNodeLoading=!1,!this._updatesDisabled&&null!=this.streamDataSupplier){this._initViewData(),this._requiredAttributesDirty&&(this._requiredAttributes=this._getRequiredAttributes(),this._requiredAttributesDirty=!1,this._handles.add([this.layer.watch("renderer",function(){return e._requiredFieldsChange()}),this.layer.watch("definitionExpression",function(){return e._requiredFieldsChange()}),this.layer.watch("labelsVisible",function(){return e._labelingChanged()}),this.layer.watch("labelingInfo",function(){return e._labelingChanged()})],"requiredAttributes"));var t=S.TextureFormat.Normal;this.layerView.useCompressedTextures?t=S.TextureFormat.Compressed:this.uncompressedTextureDownsamplingEnabled&&(t=S.TextureFormat.Downsampled);var r=this._defaultGeometrySchema,i={textureFormat:t,loadTextureData:this.layerView.rendererNeedsTextures,loadFeatureData:!this.isMeshPyramid||null==r||null==r.ordering};this._nodeLoader=new S(this.streamDataSupplier,D,r,this._requiredAttributes,i);var n=N.distancePenalty*this._viewportQueries.distCameraToPOI();this._index=new x(this.getBaseUrl(),this._rootNodeUrl,this._rootNodeId,n,this.nodeIndex,this.streamDataSupplier,this._viewportQueries,D,function(t){return e.layerView.isNodeLoaded(t)},function(t){return e._shouldLoadNode(t)},function(t){return e._enableFromGPUCache(t)},function(t){return e._needsUpdate(t)});var a=this.layerView.view.renderSpatialReference,o=this.crsIndex.equals(a)||this.crsIndex.isWGS84&&a.equals(R.SphericalECEFSpatialReference);this._index.ignoreServiceOBB=!o,this.alwaysLoadEverythingModeEnabled||this._removeInvisibleNodes(),this._lodHandling.startNodeLoading(function(t){return e._viewportQueries.isNodeVisible(t)},function(t){return e._viewportQueries.isGeometryVisible(t)},function(t){return e._index.nodeTraversalState(t)},this.nodeIndex,this._rootNodeId,{maxLodLevel:this._viewportQueries.maxLodLevel}),this.updatingChanged()}},t.prototype.isNodeLoading=function(){return null!=this._nodeLoader&&null!=this._index},t.prototype.cancelNodeLoading=function(){this.isNodeLoading()&&(this._nodeLoader.cancelAll(),this.streamDataSupplier.cancelAll(),this._idleQueue.cancelAll(),this._cancelNodeLoading(),this._nodeLoader=null,this._index=null,this._poi=null,this.layerView.additionalCancelNodeLoadingHandler&&this.layerView.additionalCancelNodeLoadingHandler(),this.updatingChanged())},t.prototype._removeInvisibleNodes=function(){var e=this.layerView.getLoadedNodeIDs(),t=this._getLodDropFactor(),r=this._viewportQueries.maxDistance*t,i=t>0&&r>0;L.clear();for(var n=0;n<e.length;n++){var a=this.nodeIndex[e[n]];(!this._viewportQueries.isGeometryVisible(a)||i&&this._lodHandling.childrenEmpty(a)&&this._viewportQueries.distToPOI(a)>r)&&(this._lodHandling.setLodGlobalDirty(),L.push(a))}return L.length>0&&(this.layerView.removeNodeData(L),L.clear(),!0)},t.prototype._needsUpdate=function(e){if(null==e.featureData||0===e.featureData.length||this._updatingNodes.has(e.id))return!1;var t=this.layerView.getLoadedAttributes(e);return null!=t&&t!==this._requiredAttributes},t.prototype._updateLoadedNode=function(e){var t=this,r=e.baseUrl,i=E(this.layerView.getLoadedAttributes(e),this._requiredAttributes)?f.resolve(this.layerView.getAttributeData(e)):this._nodeLoader.loadAttributes(e,r,this._requiredAttributes);this._updatingNodes.set(e.id,i),i.then(function(r){return t.schedule(e.id).then(function(){return t.layerView.setAttributeData(e,t._requiredAttributes,r)})}).catch(function(r){r instanceof n||t.layerView.setAttributeData(e,t._requiredAttributes,{})}).always(function(){t._updatingNodes.delete(e.id),t.updatingChanged()}),this.updatingChanged()},t.prototype._loadNode=function(e){var t=this;e.notInCache&&!this._hasNodeLoadToken()||(this._loadingNodes.add(e.id),this.updatingChanged(),this._loadAndAddBundle(e).always(function(){t._loadingNodes.delete(e.id),t._hasFeatures=t._hasFeatures||!!e.numFeatures,t.updatingChanged()}))},t.prototype._loadAndAddBundle=function(e){return 1!==e.featureData.length&&D.warn("Node ${node.id} has ${node.featureData.length} bundles. Only the first bundle will be loaded."),e.notInCache?this._loadUncached(e):this._loadCached(e).then(function(t){t||(e.notInCache=!0)}).catch(function(t){t instanceof n||(e.notInCache=!0)})},t.prototype._enableFromGPUCache=function(e){if(this.disableCache||!this.layerView.loadCachedGPUData||!this.layerView.addCachedGPUData)return!1;var t=this.layerView.loadCachedGPUData(e);return!!(t&&A(t)&&E(t.loadedAttributes,this._requiredAttributes))&&(this.layerView.addCachedGPUData(e,t,t),this._lodHandling.lodSwapBundleLoaded(e),!0)},t.prototype._loadCached=function(e){var t=this,r=this.layerView;return!this.disableCache&&r.loadCachedNodeData&&r.addCachedNodeData?this.schedule(e.id).then(function(){return r.loadCachedNodeData(e,function(e,r){return t._nodeLoader.loadTextures(e,r)})}).then(function(i){if(null==i)return!1;var n=t._requiredAttributes;return A(i)&&E(i.loadedAttributes,n)?t.reschedule(e.id).then(function(){return r.addCachedNodeData(e,i,i)}).then(function(){return t._lodHandling.lodSwapBundleLoaded(e),!0}):t.reschedule(e.id).then(function(){return t._nodeLoader.loadAttributes(e,e.baseUrl,n)}).then(function(r){return t.reschedule(e.id,{loadedAttributes:n,attributeData:r})}).then(function(t){return r.addCachedNodeData(e,i,t)}).then(function(){return t._lodHandling.lodSwapBundleLoaded(e),!0})}):f.resolve(!1)},t.prototype._loadUncached=function(e){var t=this;return this._downloadingNodes.add(e.id),this._nodeLoader.loadBundleData(e,0).then(function(r){return t._downloadingNodes.delete(e.id),t.schedule(e.id,r)}).then(function(r){return t.layerView.addNodeData(e,r)}).then(function(){t._lodHandling.lodSwapBundleLoaded(e),e.notInCache=!1}).catch(function(t){t instanceof n||(D.error("Failed to load node '"+e.id+"' bundle 0: "+t),e.failed=!0)})},t.prototype._updateIdleState=function(e){e!==this._isIdle&&(this._isIdle=e,this._viewportQueries&&this._viewportQueries.setCameraIdle(!0),this.updatingChanged())},t.prototype.updateStats=function(e){e.index=Object.keys(this.nodeIndex).length,this._hasFeatures&&(e.detail=this._featureLOD,e.target=Math.round(this.featureTarget*this._getLOD()/this._featureLOD)),this._index&&this._index.updateStats(e)},i([m.property({readOnly:!0})],t.prototype,"isMeshPyramid",null),i([m.property({readOnly:!0})],t.prototype,"streamDataSupplier",null),i([m.property({readOnly:!0,dependsOn:["layer.definitionExpression"]})],t.prototype,"parsedDefinitionExpression",null),i([m.property({readOnly:!0,dependsOn:["parsedDefinitionExpression"]})],t.prototype,"definitionExpressionFields",null),i([m.property({readOnly:!0})],t.prototype,"crsVertex",null),i([m.property({readOnly:!0})],t.prototype,"crsIndex",null),i([m.property({readOnly:!0})],t.prototype,"nodeIndex",void 0),i([m.property()],t.prototype,"camPos",void 0),i([m.property()],t.prototype,"screenSizeFactor",void 0),i([m.property()],t.prototype,"featureTarget",void 0),i([m.property()],t.prototype,"layerView",void 0),i([m.property()],t.prototype,"layer",void 0),i([m.property({readOnly:!0})],t.prototype,"updating",void 0),i([m.property({readOnly:!0})],t.prototype,"updatingPercentage",void 0),i([m.property({readOnly:!0})],t.prototype,"leafsReached",void 0),i([m.property({readOnly:!0})],t.prototype,"rootNodeVisible",null),i([m.property({aliasOf:"layerView.uncompressedTextureDownsamplingEnabled"})],t.prototype,"uncompressedTextureDownsamplingEnabled",void 0),i([m.property({aliasOf:"layerView.alwaysLoadEverythingModeEnabled"})],t.prototype,"alwaysLoadEverythingModeEnabled",void 0),i([m.subclass("esri.layers.graphics.controllers.I3SOnDemandController")],t)}(m.declared(o,p,u)),L=new h,N={factorIM:.2,factor3dObject:.05,distancePenalty:10};return F}.apply(null,i))||(e.exports=n)},1394:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(344),r(407),r(349),r(765),r(762)],void 0===(n=function(e,t,r,i,n,a,o){var s=["version","level","sharedResource","attributeData","geometryData","textureData","lodSelection"],u=function(){function e(e,t,r,a,o,s,u,d,c,h,p,f){var g=this;this.rootId=r,this.progressiveLoadPenalty=a,this.nodeIndex=o,this.streamDataSupplier=s,this.viewportQueries=u,this.logger=d,this._isLoaded=c,this._isSelected=h,this._enable=p,this._needsUpdate=f,this._dirty=!0,this._loading=!0,this._prefetching=!0,this._loadingNodes=new Set,this._indexMissing=1,this._nodesMissing=0,this._maxUnloadedPrio=Number.NEGATIVE_INFINITY,this._nodeTraversalState={},this._version=0,this._featureEstimate={estimate:0,leafsReached:!1},this._unloadedMemoryEstimate=0,this._missing=new i,this._prefetch=new i,this._updates=new l,this.ignoreServiceOBB=!1,this._maxLodLevel=this.viewportQueries.maxLodLevel,this.rootUrl=n.makeAbsolute(t,e),this.traverseVisible(function(e,t){return g.nodeTraversalState(t)})}return e.prototype.requestReload=function(){this._dirty=!0,this._loading=!0,this._prefetching=!0,++this._version},e.prototype.update=function(e){var t=this;if(this._dirty){this._indexMissing=0,this._nodesMissing=0,this._maxUnloadedPrio=Number.NEGATIVE_INFINITY,this._missing.clear(),this._prefetch.clear(),this._updates.reset(e),this._loading=!1,this._prefetching=!1;var i=!0,n=new d,a=new d;if(this.traverseVisible(function(o,s,u){if(t._updateFeatureEstimate(s,a),!s)return++t._indexMissing,t._loading=!0,t._prefetching=!1,void(t._loadingNodes.has(o.id)||t._missing.push(r({},o,{baseUrl:u})));if(0===t._missing.length&&s.children)for(var l=0,d=s.children;l<d.length;l++){var c=d[l];t.nodeIndex[c.id]||(t._prefetching=!0,t._loadingNodes.has(c.id)||t._prefetch.push(r({},c,{baseUrl:s.baseUrl})))}if(!s.failed&&s.featureData&&0!==s.featureData.length){if(t._isLoaded(s))return n.known+=s.memory,++n.knownNodes,t._isSelected(s)?s.children&&(i=!1):(n.unremoved+=s.memory,i=!1),void(t._needsUpdate(s)&&t._updates.update.push(s));if(s.memory&&(n.known+=s.memory,++n.knownNodes),t._isSelected(s)){if(++t._nodesMissing,s.children&&(i=!1),s.memory?(n.missing+=s.memory,n.known+=s.memory,++n.knownNodes):++n.missingNodes,e.indexOf(s.id)>=0)return void(t._updates.cancel=t._updates.cancel.filter(function(e){return e!==s.id}));t._enable(s)||t._updates.add.push(s)}}}),this._unloadedMemoryEstimate=n.missing-n.unremoved,n.knownNodes>3&&(this._unloadedMemoryEstimate+=n.missingNodes*n.known/n.knownNodes),this._unloadedMemoryEstimate=.8*Math.max(0,this._unloadedMemoryEstimate),this._featureEstimate.estimate=a.known-a.missing,this._featureEstimate.leafsReached=i,a.knownNodes>0){var o=a.known/a.knownNodes,s=a.missing-a.unremoved+a.missingNodes*o;this._featureEstimate.estimate+s>0&&(this._featureEstimate.estimate+=s)}this._dirty=this._indexMissing>0||this._nodesMissing>0||this._updates.add.length>0||this._updates.update.length>0||this._updates.cancel.length>0}},e.prototype.checkFeatureTarget=function(e,t){var r=this,i=this.viewportQueries.updateScreenSpaceErrorBias(t);++this._version;var n=new d;this.traverseVisible(function(e,t){return r._updateFeatureEstimate(t,n)});var a=n.known-n.missing;if(n.knownNodes>0){var o=n.known/n.knownNodes,s=n.missing-n.unremoved+n.missingNodes*o;a+s>0&&(a+=s)}return this.viewportQueries.updateScreenSpaceErrorBias(i),++this._version,a<=e},e.prototype._updateFeatureEstimate=function(e,t){if(e&&!e.failed&&e.featureData&&0!==e.featureData.length)return this._isLoaded(e)?(t.known+=e.numFeatures,++t.knownNodes,void(this._isSelected(e)||(t.unremoved+=e.numFeatures))):void(this._isSelected(e)&&(e.numFeatures?(t.missing+=e.numFeatures,t.known+=e.numFeatures,++t.knownNodes):++t.missingNodes))},e.prototype.load=function(e){var t=this;return a.buildTopNodeMap(this._missing,e,function(e){return t.entryPriority(e)}),this._missing.length<=0?this._loading:(this._maxUnloadedPrio=this.entryPriority(this._missing.front()),this._missing.forEach(function(e){return t._loadNode(e)}),this._missing.clear(),this._loading)},e.prototype.prefetch=function(e){var t=this;return a.buildTopNodeMap(this._prefetch,e,function(e){return t.entryPriority(e)}),this._prefetch.forEach(function(e){return t._loadNode(e)}),this._prefetch.clear(),this._prefetching},e.prototype.isLoading=function(){return this._loading},e.prototype.isPrefetching=function(){return this._prefetching},e.prototype.getIndexLoading=function(){return this._loadingNodes.size},e.prototype.getIndexMissing=function(){return this._indexMissing},e.prototype.getUnloadedMemoryEstimate=function(){return this._unloadedMemoryEstimate},e.prototype.getNodesMissing=function(){return this._nodesMissing},e.prototype.getUpdates=function(e){var t=this;return a.buildTopNodeMap(this._updates.add,e,function(e){return t.entryPriority(e)},this._maxUnloadedPrio),a.buildTopNodeMap(this._updates.update,Number.POSITIVE_INFINITY,function(e){return t.entryPriority(e)}),this._updates},e.prototype.getFeatureEstimate=function(){return this._featureEstimate},e.prototype.nodeTraversalState=function(e){if(!e)return null;var t=this._nodeTraversalState[e.id];if(t&&t.version===this._version)return t;var r=this.viewportQueries.getLodLevel(e),i=this.viewportQueries.hasLOD(e),n=!0;if(i)if(e.parentNode){var a=this.nodeIndex[e.parentNode.id];if(null==a)return null;var o=this._nodeTraversalState[a.id];n=o&&r>o.lodLevel}else n=r>0;return t?(t.lodLevel=r,t.isChosen=n,t.version=this._version,t):(this._nodeTraversalState[e.id]={nodeHasLOD:i,lodLevel:r,isChosen:n,version:this._version},this._nodeTraversalState[e.id])},e.prototype._loadNode=function(e){var t=this;this._loadingNodes.add(e.id);var r=n.makeAbsolute(e.href,e.baseUrl);this.streamDataSupplier.request(r,"json").then(function(e,r){var i=r,n={id:i.id,mbs:i.mbs,parentNode:i.parentNode,children:i.children,featureData:i.featureData};s.forEach(function(e){n[e]=i.hasOwnProperty(e)?i[e]:null}),i.hasOwnProperty("obb")&&!t.ignoreServiceOBB&&(n.obb=o.clone(i.obb),n.hasServiceOBB=!0,t.viewportQueries.updateNode(n.id)),t.nodeIndex[n.id]=n,n.baseUrl=e,n.featureData&&1===n.featureData.length&&n.featureData[0].featureRange&&(n.numFeatures=n.featureData[0].featureRange[1]-n.featureData[0].featureRange[0]+1),t.nodeTraversalState(n),t._loadingNodes.delete(n.id),t._dirty=!0},function(i){t.loadErrorCallback(r),t._loadingNodes.delete(e.id),t._dirty=!0})},e.prototype.entryPriority=function(e){if(e.id===this.rootId)return 0;var t=0,r=this.nodeIndex[e.id];if(null!=r&&null!=r.parentNode){var i=this._nodeTraversalState[r.parentNode.id];null!=i&&(t=i.lodLevel)}for(var n=this.progressiveLoadPenalty,a=r;a;a=a.parentNode?this.nodeIndex[a.parentNode.id]:null)if(this._isLoaded(a)){n=0;break}var o=this.viewportQueries.distToPOI(e);return-o-t*(o+this.progressiveLoadPenalty)+n},e.prototype.traverseVisible=function(e){var t=this.nodeIndex[this.rootId];t?this._traverse({id:this.rootId,mbs:t.mbs,href:this.rootUrl},t,e,""):e({id:this.rootId,mbs:null,href:this.rootUrl},null,"")},e.prototype._traverse=function(e,t,r,i){if(t.children&&0!==t.children.length){if(this.viewportQueries.isNodeVisible(t)){r(e,t,i);var n=this.nodeTraversalState(t);if(!n.nodeHasLOD||n.lodLevel!==this._maxLodLevel)for(var a=0,o=t.children;a<o.length;a++){var s=o[a],u=this.nodeIndex[s.id];u?this._traverse(s,u,r,t.baseUrl):this.viewportQueries.isNodeVisible(s)&&r(s,null,t.baseUrl)}}}else this.viewportQueries.isGeometryVisible(t)&&r(e,t,i)},e.prototype.loadErrorCallback=function(e){this.logger.warn("Error loading node: "+e)},e.prototype.updateStats=function(e){if(this._nodesMissing&&(e.nodes+=" + "+Math.round(this._nodesMissing)),this._indexMissing&&(e.index+=" + "+this._indexMissing),this._featureEstimate.estimate){var t=this._featureEstimate.estimate-e.features;t>0?e.features+=" + "+t:t<0&&(e.features+=" - "+-t)}},e}(),l=function(){function e(){this.update=new i,this.add=new i,this.cancel=[]}return e.prototype.reset=function(e){this.add.clear(),this.update.clear(),this.cancel=e},e}(),d=function(){return function(){this.known=0,this.knownNodes=0,this.missing=0,this.missingNodes=0,this.unremoved=0}}();return u}.apply(null,i))||(e.exports=n)},1395:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(407)],void 0===(n=function(e,t,r){var i=function(){function e(e,t){this.layerView=e,this.lodGlobalDirtyChanged=t}return e.prototype.startNodeLoading=function(e,t,r,i,n,a){this._lodGlobalDirty=!1,this._maxLodLevel=a.maxLodLevel,this._nodeIndex=i,this._rootId=n,this._nodeTraversalState=r,this._isNodeVisible=e,this._isGeometryVisible=t,this.lodGlobalDirtyChanged(this._lodGlobalDirty)},e.prototype.shouldLoadNode=function(e){var t=this._nodeTraversalState(e);return!!t.isChosen&&(t.lodLevel===this._maxLodLevel||this.childrenEmpty(e))},e.prototype.setLodGlobalDirty=function(){this._lodGlobalDirty=!0,this.lodGlobalDirtyChanged(this._lodGlobalDirty)},e.prototype.lodSwapBundleLoaded=function(e){this.setLodGlobalDirty()},Object.defineProperty(e.prototype,"requiresLODGlobalHandling",{get:function(){return null!=this._rootId&&(!0===this._lodGlobalDirty||this.layerView.view.resourceController.usedMemory>1.1)},enumerable:!0,configurable:!0}),e.prototype.lodGlobalHandling=function(){if(this.requiresLODGlobalHandling){var e=this._rootId,t=this.layerView.view.resourceController.usedMemory,r=Math.max(0,Math.floor(10*(t-1)));n.clear(),this._lodGlobalHandlingRecursion(e,r),this.layerView.removeNodeData(n),n.clear(),this._lodGlobalDirty=!1,this.lodGlobalDirtyChanged(this._lodGlobalDirty)}},e.prototype._lodGlobalHandlingRecursion=function(e,t){var r=this._nodeIndex[e];if(null==r)return!1;var i=this._nodeTraversalState(r),a=i.isChosen&&(!i.nodeHasLOD||i.lodLevel===this._maxLodLevel),o=this.layerView.isNodeLoaded(r);if(o&&null!=this.layerView.setPolygonOffset){var s=!a;this.layerView.setPolygonOffset(r,s)}if(a&&o)return this._removeChildrenRecursive(r),!0;var u=!1;if(null!=r.children&&0!==r.children.length){u=!0;for(var l=0,d=r.children;l<d.length;l++){var c=d[l],h=this._nodeIndex[c.id];if(h?this._isGeometryVisible(h):this._isNodeVisible(c)){var p=this._lodGlobalHandlingRecursion(c.id,t);u=u&&p}}}o&&!a&&(u||n.length<t)&&(n.push(r),o=!1);var f=!r.featureData||0===r.featureData.length;return u||o||f},e.prototype._removeChildrenRecursive=function(e){if(null!=e.children)for(var t=0,r=e.children;t<r.length;t++){var i=r[t],a=this._nodeIndex[i.id];null!=a&&(this._removeChildrenRecursive(a),n.push(a))}},e.prototype._subtreeEmpty=function(e){return!this.layerView.isNodeLoaded(e)&&this.childrenEmpty(e)},e.prototype.childrenEmpty=function(e){if(null==e.children)return!0;for(var t=0,r=e.children;t<r.length;t++){var i=r[t];if(this._isNodeVisible(i)){var n=this._nodeIndex[i.id];if(null!=n&&!this._subtreeEmpty(n))return!1}}return!0},e}(),n=new r;return i}.apply(null,i))||(e.exports=n)},1396:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(380),r(456),r(338),r(339),r(349),r(771),r(765),r(348)],void 0===(n=function(e,t,r,i,n,a,o,s,u,l){var d=function(){function e(t,r,i,n,s){this.loader=t,this.logger=r,this.defaultGeometrySchema=i,this.requiredAttributes=n,this.options=s,this.cancelled=!1,this.loadShared=function(t){if(null==t.sharedResource)return a.resolve({});var r=o.makeAbsolute(t.sharedResource.href,t.baseUrl);return this.load(r,"json").then(function(t){return e.fixTextureEncodings(t),e.addAbsoluteHrefTexture(t,r),t})}}return e.prototype.cancelAll=function(){this.cancelled=!0},e.prototype.load=function(e,t){var i=this.loader.request(e,t),n=new r;return i.then(function(e,t){n.resolve(t)},function(t){n.reject(new Error("Failed to load: "+e))}),n.promise},e.prototype.loadAttribute=function(e,t,r){var i=o.makeAbsolute(r,e);return this.load(i,"binary").then(function(e){return s.readBinaryAttribute(t,e)})},e.prototype.loadAttributes=function(e,t,r){var i=this,n=r.map(function(r){return null==e.attributeData||null==e.attributeData[r.index]?(i.logger.error("Missing attributeData for '"+r.name+"' on node '"+e.id+"'"),a.resolve(null)):i.loadAttribute(t,r.attributeStorageInfo,e.attributeData[r.index].href).catch(function(t){return i.logger.error("Failed to load attributeData for '"+r.name+"' on node '"+e.id+"'"),null})});return a.all(n).then(function(e){for(var t={},i=0;i<r.length;++i)e[i]&&(t[r[i].name]=e[i]);return t})},e.prototype.prepareBinaryGeometryData=function(e,t,r,i){var a=e.geometries[0];if(n.mixin(a.params,r),i||null!=r.vertexAttributes.region||delete r.vertexAttributes.region,null!=r.featureAttributes){var o=r.featureAttributes;if(o.faceRange){var l=s.createTypedView(t,o.faceRange),d=o.faceRange.valuesPerElement,c=r.header.fields.featureCount;e.componentOffsets=u.convertFlatRangesToOffsets(l,c,d)}if(o.id){e.featureIds=[];var h=1,p=s.valueType2TypedArrayClassMap[o.id.valueType];"UInt64"===o.id.valueType&&(p=Uint32Array,h=2);for(var f=new p(t,o.id.byteOffset,o.id.count*o.id.valuesPerElement*h),g=0;g<r.header.fields.featureCount;g++)if(e.featureIds[g]=f[g*o.id.valuesPerElement*h],2===h){var m=f[g*o.id.valuesPerElement*h+1];if(m>=2097150)throw new Error("ID exceeded maximum range supported by javascript (max = 53bit-1 = 9007199254740991)");e.featureIds[g]+=4294967296*m}}}},e.prototype.loadBundleData=function(e,t){var r=this,i=e.baseUrl,n=null,u=this.loadShared(e),l=null;null!=this.requiredAttributes&&(l=this.loadAttributes(e,i,this.requiredAttributes));var d=null;if(null!=e.geometryData){var c=e.geometryData[t],h=o.makeAbsolute(c.href,i);d=this.load(h,"binary")}return u.then(function(i){return r.handleCancelled(),(r.options.loadFeatureData?r.loadFeatureData(e,t):a.resolve(null)).then(function(t){r.handleCancelled();var o,u=r.options.loadFeatureData?r.collectGeometries(e,t,i):r.meshPyramidGeometryData(e,i);o=null!=d?d.then(function(e){n=e;var t=Object.keys(i.materialDefinitions)[0],a=i.materialDefinitions[t].params.vertexRegions,o=s.createGeometryDataIndex(e,r.defaultGeometrySchema,a);return r.prepareBinaryGeometryData(u[0],e,o,a),u}):a.resolve(u);var c=r.loadTextures(u,i);return a.all([c,o,l])}).then(function(e){var t=e[0],a=e[1],o=e[2];r.handleCancelled();var s=null;return o&&(s={attributeData:o,loadedAttributes:r.requiredAttributes}),{allGeometryData:a,attributeDataInfo:s,geometryBuffer:n,sharedResource:i,textureData:t}})})},e.addAbsoluteHrefTexture=function(e,t){var r=e.textureDefinitions;if(null!=r)for(var i=0,n=Object.keys(r);i<n.length;i++)for(var a=0,s=r[n[i]].images;a<s.length;a++){var u=s[a];Array.isArray(u.href)?u.hrefConcat=u.href.map(function(e){return o.makeAbsolute(e,t)}):u.hrefConcat=o.makeAbsolute(u.href,t)}},e.fixTextureEncodings=function(e){var t=e.textureDefinitions;if(null!=t)for(var r in t){var i=t[r];if(Array.isArray(i.encoding))for(var n=0;n<i.encoding.length;n++){var a;"data:"===(a=i.encoding[n]).substring(0,5)&&(i.encoding[n]=a.substring(5))}else"data:"===(a=i.encoding).substring(0,5)&&(i.encoding=a.substring(5))}},e.prototype.loadTexture=function(e,t,r,i){var n=this;return i===u.DDS_ENCODING_STRING?this.load(e,"binary").then(function(e){return n.handleCancelled(),{i3sTexId:t,data:e,encoding:i}}):this.load(e,"image").then(function(e){var a=e;if(n.handleCancelled(),r&&e.width*e.height>=4096){var o=Math.ceil(e.width/2),s=Math.ceil(e.height/2),u=document.createElement("canvas");u.width=o,u.height=s,u.getContext("2d").drawImage(e,0,0,o,s),a=u}return{i3sTexId:t,data:a,encoding:i}})},e.prototype.loadTextures=function(t,r){for(var i=[],n=0;n<t.length;n++){var o=t[n].geometries;if(null!=o)for(var s=0,d=o;s<d.length;s++){var c=d[s].params.textureID||"none";if("none"!==c){null!=r.textureDefinitions&&null!=r.textureDefinitions[c]||this.logger.warn("textureDefinitions missing in shared resource. i3sTexId: "+c);var h=r.textureDefinitions[c];if(l.assert(void 0!==h,"geometry wants unknown texture "+c),0===h.images.length)continue;var p=h.images.length-1,f=h.images[p],g=this.options.textureFormat===e.TextureFormat.Compressed,m=this.options.textureFormat===e.TextureFormat.Downsampled,v=u.getAppropriateTextureEncoding(h.encoding,g),y=v>-1?h.encoding[v]:h.encoding,_=v>-1?f.hrefConcat[v]:f.hrefConcat;this.options.loadTextureData?i.push(this.loadTexture(_,c,m,y)):i.push({i3sTexId:c,encoding:y,data:null})}}}return a.all(i)},e.prototype.meshPyramidGeometryData=function(e,t){return[{featureIds:[],geometries:[{type:"ArrayBufferView",params:{materialID:t.materialDefinitions?Object.keys(t.materialDefinitions)[0]:null,textureID:t.textureDefinitions?Object.keys(t.textureDefinitions)[0]:null}}],featureDataPosition:[0,0,0]}]},e.prototype.collectGeometries=function(e,t,r){for(var i=[],n=0,a=t.featureData;n<a.length;n++){var o=a[n],s=o.geometries;if(null!=s)for(var u=0;u<s.length;u++){var l=o.geometries[u];i.push({featureIds:[o.id],featureDataPosition:o.position,geometries:[l]})}else null!=o.position&&i.push({featureIds:[o.id],featureDataPosition:o.position,geometries:null})}return i},e.prototype.loadFeatureData=function(e,t){var r=o.makeAbsolute(e.featureData[t].href,e.baseUrl);return this.load(r,"json")},e.prototype.handleCancelled=function(){if(this.cancelled)throw new i},e}();return function(e){!function(e){e[e.Compressed=0]="Compressed",e[e.Normal=1]="Normal",e[e.Downsampled=2]="Downsampled"}(e.TextureFormat||(e.TextureFormat={}))}(d||(d={})),d}.apply(null,i))||(e.exports=n)},1397:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(404),r(890),r(687),r(594),r(765),r(342),r(604),r(762),r(387),r(348)],void 0===(n=function(e,t,r,i,n,a,o,s,u,l,d,c){return function(){function e(e,t,a,o,l,d,c,h){void 0===h&&(h={}),this.indexSR=e,this._renderCoordsHelper=t,this.extent=l,this.elevationProvider=d,this.options=h,this._computedOBBs={},this._computedMBSs={},this._isNodeVisibleCached={},this.fp=[],this._idleCamera=!0,this.maxDistance=0,this.maxLodLevel=2,this._tmp1=[0,0,0],this._tmp2=[0,0,0],this._tmp3=[0,0,0],this._tmp0=[0,0,0],this.supportedMetrics=["maxScreenThreshold","screenSpaceRelative","removedFeatureDiameter","distanceRangeFromDefaultCamera"],this.screenspaceErrorBias=h.screenspaceErrorBias||1,this.progressiveLoadFactor=h.progressiveLoadFactor||1,this.enableLoD=!h.disableLod;for(var p=0;p<8;++p)this.fp[p]=u.plane.create();this.updateCamera(a),this._poi=s.vec3d.create(o),this.engineSR=this._renderCoordsHelper.spatialReference,c?(this._elevationContext=new i,this._elevationContext.featureExpressionInfoContext=n.createContext(n.extractExpressionInfo(c,!1)),this._elevationContext.mixinApi(c)):this._elevationContext=null,this.tmpPoint=new r({x:0,y:0,z:0,spatialReference:e})}return e.prototype.updateCamera=function(e){c.matrixToFrustumPlanes(e.viewMatrix,e.projectionMatrix,this.fp),this._screenSizeFactor=1/e.perPixelRatio,this._camPos=e.eye,this._isNodeVisibleCached={}},e.prototype.updateNode=function(e){delete this._isNodeVisibleCached[e]},e.prototype.updatePointOfInterest=function(e){s.vec3d.set(e,this._poi),this.maxDistance=0},e.prototype.updateScreenSpaceErrorBias=function(e){var t=this.screenspaceErrorBias;return this.screenspaceErrorBias=e,t},e.prototype.setCameraIdle=function(e){this._idleCamera!==e&&(this._idleCamera=e,this._isNodeVisibleCached={})},e.prototype.updateExtent=function(e){this.extent=e,this._isNodeVisibleCached={}},e.prototype.computeMbs=function(e){var t=this._computedMBSs[e.id];return t||(t=s.vec4d.createFrom(e.mbs[0],e.mbs[1],e.mbs[2],-1),this._computedMBSs[e.id]=t),t[3]<0&&(s.vec4d.set(e.mbs,t),this._elevationContext&&t[3]<1e5&&(this.tmpPoint.x=t[0],this.tmpPoint.y=t[1],this.tmpPoint.z=t[2],t[2]=a.computeElevation(this.elevationProvider,this.tmpPoint,this._elevationContext,this._renderCoordsHelper,null)),d.mbsToMbs(t,this.indexSR,t,this.engineSR)),t},e.prototype.computeObb=function(e){if(e.obb&&!(e.obb.halfSize[0]<0)){var t=this._computedOBBs[e.id];return t||((t=l.clone(e.obb)).halfSize[0]=-1,this._computedOBBs[e.id]=t),t.halfSize[0]<0&&(t.halfSize[0]=e.obb.halfSize[0],s.vec3d.set(e.obb.center,t.center),this._elevationContext&&e.mbs[3]<1e5&&(this.tmpPoint.x=e.obb.center[0],this.tmpPoint.y=e.obb.center[1],this.tmpPoint.z=e.obb.center[2],t.center[2]=a.computeElevation(this.elevationProvider,this.tmpPoint,this._elevationContext,this._renderCoordsHelper,null)),d.bufferToBuffer(t.center,this.indexSR,0,t.center,this.engineSR,0,1)),t}},e.prototype._isNodeVisible=function(e){var t=this.computeMbs(e);if(!this.isMBSinExtent(t))return!1;if(e.hasServiceOBB&&e.obb){var r=this.computeObb(e);return l.isVisible(r,this.fp)}return this.isMBSVisible(t)},e.prototype.isNodeVisible=function(e){return!this.enableLoD||(this._idleCamera?null!=this._isNodeVisibleCached[e.id]?this._isNodeVisibleCached[e.id]:(this._isNodeVisibleCached[e.id]=this._isNodeVisible(e),this._isNodeVisibleCached[e.id]):this._isNodeVisible(e))},e.prototype.isGeometryVisible=function(e){if(!this.isNodeVisible(e))return!1;if(e.hasServiceOBB)return!0;var t=this.computeObb(e);return!t||l.isVisible(t,this.fp)},e.prototype.invalidateCache=function(e){if(null==e){for(var t=0,r=Object.keys(this._computedMBSs);t<r.length;t++){var i=r[t];this._computedMBSs[i][3]=-1}for(var n=0,a=Object.keys(this._computedOBBs);n<a.length;n++){i=a[n];this._computedOBBs[i].halfSize[0]=-1}}else this._computedMBSs[e]&&(this._computedMBSs[e][3]=-1),this._computedOBBs[e]&&(this._computedOBBs[e].halfSize[0]=-1)},e.prototype.isMBSinExtent=function(e){return!this.extent||0!==o.intersectBoundingBoxWithMbs(this.extent,e)},e.prototype.isMBSVisible=function(e){var t=e[0],r=e[1],i=e[2],n=e[3],a=this.fp;return a[0][0]*t+a[0][1]*r+a[0][2]*i+a[0][3]<=n&&a[1][0]*t+a[1][1]*r+a[1][2]*i+a[1][3]<=n&&a[2][0]*t+a[2][1]*r+a[2][2]*i+a[2][3]<=n&&a[3][0]*t+a[3][1]*r+a[3][2]*i+a[3][3]<=n&&a[4][0]*t+a[4][1]*r+a[4][2]*i+a[4][3]<=n&&a[5][0]*t+a[5][1]*r+a[5][2]*i+a[5][3]<=n},e.prototype.calcScreenSpaceSize=function(e,t){var r=this.computeMbs(e),i=r[3],n=s.vec3d.dist2(r,this._camPos)-i*i;return n<0?.5*Number.MAX_VALUE:t/Math.sqrt(n)*this._screenSizeFactor},e.prototype.calcCameraDistance=function(e){var t=this.computeMbs(e);return Math.max(0,s.vec3d.dist(t,this._camPos)-t[3])},e.prototype.calcAngleDependentLoD=function(e){var t=this.computeMbs(e),r=t[3],i=(Math.abs(t[0]*(t[0]-this._camPos[0])+t[1]*(t[1]-this._camPos[1])+t[2]*(t[2]-this._camPos[2]))/s.vec3d.length(t)+r)/s.vec3d.dist(t,this._camPos);return Math.min(1,i)},e.prototype.hasLOD=function(e){return null!=e.lodSelection},e.prototype.hasFeatures=function(e){return null!=e.featureData},e.prototype.getDistancePlanarMode=function(e,t,r){var i=e[0]-t[0],n=e[1]-t[1],a=e[2]-t[2],o=i+i+n*n;if(o<=r*r)return Math.abs(a);var s=Math.sqrt(o)-r;return Math.sqrt(a*a+s*s)},e.prototype.getDistanceGlobeMode=function(e,t,r){var i=s.vec3d.length(t),n=s.vec3d.length(e)-i;if(s.vec3d.scale(e,s.vec3d.dot(e,t)/s.vec3d.length2(e),this._tmp0),s.vec3d.dist2(t,this._tmp0)<=r*r)return Math.abs(n);var a=s.vec3d.scale(t,1/i,this._tmp0),o=r,u=i,l=o*o/2/u,d=s.vec3d.scale(a,u-l,this._tmp1),c=e,h=s.vec3d.subtract(c,d,this._tmp2),p=s.vec3d.subtract(h,s.vec3d.scale(a,s.vec3d.dot(a,h),this._tmp3),this._tmp2),f=s.vec3d.add(d,s.vec3d.scale(p,o/s.vec3d.length(p),this._tmp2),this._tmp2),g=s.vec3d.dist(c,f);if(n>=2e5){var m=s.vec3d.subtract(c,f,this._tmp1),v=s.vec3d.dot(m,a)/s.vec3d.length(m);v<.08&&(v=1e-4),g/=v}return g},e.prototype.getDistance=function(e,t,r){return this.engineSR===d.SphericalECEFSpatialReference?this.getDistanceGlobeMode(e,t,r):this.getDistancePlanarMode(e,t,r)},e.prototype._selectErrorMetric=function(e){for(var t=0;t<e.length;t++)if(this.supportedMetrics.indexOf(e[t].metricType)>=0)return e[t];return null},e.prototype.getLodLevel=function(e){if(!e.lodSelection||e.lodSelection.length<=0||!1===this.hasFeatures(e))return 0;if(null==e.children||0===e.children.length)return this.maxLodLevel;var t=this.enableLoD?this._selectErrorMetric(e.lodSelection):null;if(null==t)return 0;if(this.progressiveLoadFactor<1){var r=this.progressiveLoadFactor*this.screenspaceErrorBias,i=this.screenspaceErrorBias;return this.evaluateLODmetric(e,r,t)?this.evaluateLODmetric(e,i,t)?2:1:0}return this.evaluateLODmetric(e,this.screenspaceErrorBias,t)?this.maxLodLevel:0},e.prototype.evaluateLODmetric=function(e,t,r){switch(r.metricType){case"screenSpaceRelative":var i=this.computeMbs(e),n=2*this.getDistance(this._camPos,i,i[3])/this._screenSizeFactor;return r.maxError*t<=n;case"maxScreenThreshold":var a=this.calcScreenSpaceSize(e,e.mbs[3]*t);return this.options.angleDependentLoD&&(a*=this.calcAngleDependentLoD(e)),a<r.maxError;case"removedFeatureDiameter":return this.calcScreenSpaceSize(e,r.maxError)*t<10;case"distanceRangeFromDefaultCamera":return this.calcCameraDistance(e)>r.maxError*t}return!1},e.prototype.distToPOI=function(e){var t=this.computeMbs(e),r=s.vec3d.dist(t,this._poi)-t[3];return this.maxDistance=Math.max(this.maxDistance,r),r},e.prototype.distCameraToPOI=function(){return s.vec3d.dist(this._camPos,this._poi)},e}()}.apply(null,i))||(e.exports=n)},1398:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(365),r(709),r(462),r(1399),r(1402),r(1404),r(348)],void 0===(n=function(e,t,r,i,n,a,o,s,u){function l(){var e={};for(var t in d.ClientType)e[d.ClientType[t]]=0;return e[d.ClientType.TERRAIN]=15,e[d.ClientType.SCENE]=20,e[d.ClientType.SYMBOLOGY]=5,new o(e)}var d=function(){function e(t,o,s){void 0===o&&(o=n),void 0===s&&(s=i);var u=this;this._view=t,this._budget=null,this._memoryController=null,this._streamDataLoader=l(),this._frameWorkers=[],this._nextFrameWorker=0,this._idleWorkers=[],this._nextIdleWorker=0,this._idleUpdatesStartFired=!1,this._lastTargetChangeTime=0,this._handles=new r,this._frameTask=null,this.idleTimeout=300,this.idleBudget=100,this._budget=new e.Budget(s),this._lastTargetChangeTime=s(),this._memoryController=new a(this._view),this._handles.add(this._view.watch("state.camera",function(){return u.cameraChangedHandler()},!0)),this._frameTask=o.addFrameTask({update:function(e){return u.frameUpdate(e)}})}return e.prototype.destroy=function(){this._frameTask&&(this._frameTask.remove(),this._frameTask=null),this._handles.remove(),this._streamDataLoader&&(this._streamDataLoader.destroy(),this._streamDataLoader=null)},Object.defineProperty(e.prototype,"enableBudget",{set:function(e){this._budget.enabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"updating",{get:function(){return this._memoryController.updating},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxGpuMemory",{set:function(e){this._memoryController.setMaxGpuMemory(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"additionalCacheMemory",{set:function(e){this._memoryController.setAdditionalCacheMemory(e)},enumerable:!0,configurable:!0}),e.prototype.setMemoryDirty=function(){this._memoryController.setDirty()},Object.defineProperty(e.prototype,"memoryFactor",{get:function(){return this._memoryController.getMemoryFactor()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"usedMemory",{get:function(){return this._memoryController.getUsedMemory()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"memoryEvents",{get:function(){return this._memoryController.events},enumerable:!0,configurable:!0}),e.prototype.getMemCache=function(e,t){return this._memoryController.getMemCache(e,t)},e.prototype.getStreamDataSupplier=function(e,t){return new s(e,this._streamDataLoader,t)},e.prototype.registerIdleFrameWorker=function(e){var t=this;u.assert(!e.idleFrame||e.needsUpdate,"needsUpdate has to be specified if idleFrame is specified");var r={callbacks:e};return this.addIdleFrameWorker(r),{remove:function(){t.removeIdleFrameWorker(r)}}},e.prototype.registerFrameWorker=function(e){var t=this,r={callback:e};return this.addFrameWorker(r),{remove:function(){t.removeFrameWorker(r)}}},e.prototype.addIdleFrameWorker=function(e){this._idleWorkers.push(e),this.isIdle()&&this._idleUpdatesStartFired&&e.callbacks.idleBegin&&e.callbacks.idleBegin()},e.prototype.removeIdleFrameWorker=function(e){var t=this._idleWorkers,r=t.indexOf(e);u.assert(r>=0,"worker not registered"),this._idleUpdatesStartFired&&e.callbacks.idleEnd&&e.callbacks.idleEnd(),t.splice(r,1),this._nextIdleWorker>=t.length&&(this._nextIdleWorker=0)},e.prototype.addFrameWorker=function(e){this._frameWorkers.push(e)},e.prototype.removeFrameWorker=function(e){var t=this._frameWorkers,r=t.indexOf(e);u.assert(r>=0,"worker not registerted"),t.splice(r,1),this._nextFrameWorker>=this._frameWorkers.length&&(this._nextFrameWorker=0)},e.prototype.cameraChangedHandler=function(){this._lastTargetChangeTime=this._budget.now(),this.setMemoryDirty(),this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this.callIdleFrameWorkersEnd())},e.prototype.frameUpdate=function(e){var t=this.isIdle()?0:5,r=e.frameDuration-e.elapsedFrameTime-t,i=this.idleBudget-e.elapsedFrameTime;this._view._stage&&!this._view._stage.getIdleSuspend()&&(i=r);var n=Math.max(this.isIdle()?i:r,5);this._budget.reset(n),this._view.stateManager&&this._view.stateManager.step(e.deltaTime/1e3),this._memoryController.update();for(var a=0;a<this._frameWorkers.length;++a){var o=(this._nextFrameWorker+a)%this._frameWorkers.length;if(this._frameWorkers[o].callback(this._budget),this._budget.remaining()<t){this._nextFrameWorker=(o+1)%this._frameWorkers.length;break}}this.isIdle()&&!this._budget.done()&&(this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this.callIdleFrameWorkersBegin()),this.callIdleFrameWorkers())},e.prototype.isIdle=function(){return this._budget.now()-this._lastTargetChangeTime>this.idleTimeout},e.prototype.callIdleFrameWorkersBegin=function(){this._idleWorkers.forEach(function(e){e.callbacks.idleBegin&&e.callbacks.idleBegin()})},e.prototype.callIdleFrameWorkersEnd=function(){this._idleWorkers.forEach(function(e){e.callbacks.idleEnd&&e.callbacks.idleEnd()})},e.prototype.callIdleFrameWorkers=function(){for(var e=0;e<this._idleWorkers.length;++e){var t=(this._nextIdleWorker+e)%this._idleWorkers.length;if(this._budget.done())return void(this._nextIdleWorker=t);var r=this._idleWorkers[t];r.callbacks.needsUpdate&&r.callbacks.needsUpdate()&&r.callbacks.idleFrame(this._budget)}},e}();return function(e){!function(e){e.TERRAIN="terrain",e.SCENE="scene",e.SYMBOLOGY="symbology"}(e.ClientType||(e.ClientType={}));var t=function(){function e(e){this._nowFunc=e,this.enabled=!0,this.begin=0,this.budget=0}return e.prototype.now=function(){return this._nowFunc()},e.prototype.reset=function(e){this.begin=this.now(),this.budget=this.enabled?e:Number.MAX_VALUE},e.prototype.done=function(){return this.enabled&&this.elapsed()>=this.budget},e.prototype.remaining=function(){return this.enabled?Math.max(this.budget-this.elapsed(),0):Number.POSITIVE_INFINITY},e.prototype.elapsed=function(){return this.now()-this.begin},e}();e.Budget=t}(d||(d={})),d}.apply(null,i))||(e.exports=n)},1399:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(343),r(1400),r(894),r(1401)],void 0===(n=function(e,t,r,i,n,a){var o=r.getLogger("esri.views.3d.support.MemoryController");return function(){function e(e){this._view=e,this._minQuality=.1,this._maxQuality=1,this._memoryHWM=1,this._memoryLWM=.75,this._divideRate=1.3,this._throttle=5,this.events=new n.Evented,this._maxMemory=500,this._additionalCacheMemory=100,this._quality=1,this._stableQuality=0,this._throttled=0,this._memoryUsed=0,this._memoryCommitted=0,this._cacheStorage=new a.Storage,this.updating=!1}return e.prototype.getMemCache=function(e,t){return new a(e,this._cacheStorage,t)},e.prototype.setMaxGpuMemory=function(e){null!=e&&e>0&&(this._maxMemory=e,this.setDirty())},e.prototype.setAdditionalCacheMemory=function(e){null!=e&&e>=0&&(this._additionalCacheMemory=e,this.setDirty())},e.prototype.disableMemCache=function(){this._additionalCacheMemory=-4096},e.prototype.getMemoryFactor=function(){return this._quality},e.prototype._updateQuality=function(e){return(e=Math.min(Math.max(e,this._minQuality),this._maxQuality))!==this._quality&&(this._quality=e,this.events.emit("quality-changed",this._quality),!0)},e.prototype.getUsedMemory=function(){return this._memoryUsed},e.prototype.setDirty=function(){this._stableQuality=0},e.prototype.update=function(){if(this._updateMemory(),!(this._memoryCommitted<=0)){this._throttled=Math.max(0,this._throttled-1);var e=this._layersUpdating();if(e){if(this._quality<=this._minQuality)return;(this._memoryCommitted>1.1*this._memoryHWM||this._memoryUsed>this._memoryHWM)&&(this._stableQuality>0?this._updateQuality(this._stableQuality):(0===this._throttled||this._memoryUsed>1.05)&&(this._updateQuality(this._quality/this._divideRate),this._throttled=this._throttle))}else if(this._memoryUsed>this._memoryHWM&&(this._stableQuality=0,e=this._updateQuality(this._quality/this._divideRate)),this._memoryCommitted<this._memoryLWM&&this._quality<this._maxQuality&&this._stableQuality!==this._quality){this._stableQuality=this._quality;var t=.1*(this._memoryLWM-this._memoryCommitted+.1);e=this._updateQuality(this._quality+t)}this.updating!==e&&(this.updating=e,this.events.emit("updating-changed",this.updating))}},e.prototype._layersUpdating=function(){var e=!1;return this._view.allLayerViews.forEach(function(t){e=e||t.updating}),e},e.prototype._updateMemory=function(){var e=0,t=0;this._view.basemapTerrain&&this._view.basemapTerrain.getUsedMemory&&(e+=this._view.basemapTerrain.getUsedMemory());var r=this._view._stage&&this._view._stage.view&&this._view._stage.view.getEdgeView();r&&(e+=r.getGpuMemoryUsage()),this._view.allLayerViews&&this._view.allLayerViews.forEach(function(r){i.isMemoryManagedLayerView(r)&&(e+=r.getUsedMemory(),t+=r.getUnloadedMemory())});var n=null==this._warnMemoryUsage||Math.round(10*e)!==Math.round(10*this._warnMemoryUsage),a=1048576*this._maxMemory;if(e>a&&n){this._warnMemoryUsage=e;var s=function(e){return(e/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB"},u=Math.round(100*this._quality);o.warn("GPU Memory Limit exceeded! Limit: "+s(a)+" Current: "+s(e)+" Projected: "+s(e+t)+" Quality: "+u+"%")}this._memoryUsed=e/a,this._memoryCommitted=(e+t)/a;var l=a-e;this._cacheStorage.maxSize=Math.max(0,l+1048576*this._additionalCacheMemory),this.events.emit("memory-used",this._memoryUsed)},e}()}.apply(null,i))||(e.exports=n)},1400:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.isMemoryManagedLayerView=function(e){return"function"==typeof e.getUsedMemory}}.apply(null,i))||(e.exports=n)},1401:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(338),r(407)],void 0===(n=function(e,t,r,i){var n=new i,a=function(){function e(e,t,r){this._namespace=e,this._storage=t,this._priority=0,this._removeFunc=!1,this._hit=0,this._miss=0,n.push(this),this._namespace+=":",r&&(this._storage.registerRemoveFunc(this._namespace,r),this._removeFunc=!0)}return Object.defineProperty(e.prototype,"priority",{get:function(){return this._priority},set:function(e){isNaN(e)||(this._priority=Math.max(0,e))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"namespace",{get:function(){return this._namespace.slice(0,-1)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hitRate",{get:function(){return this._hit/(this._hit+this._miss)},enumerable:!0,configurable:!0}),e.prototype.resetHitRate=function(){this._hit=this._miss=0},e.prototype.destroy=function(){this._storage.clear(this._namespace),this._removeFunc&&this._storage.deregisterRemoveFunc(this._namespace),n.removeUnordered(this)},e.prototype.put=function(e,t,r){this._storage.put(this._namespace+e,t,r,this._priority)},e.prototype.pop=function(e){var t=this._storage.pop(this._namespace+e);return void 0===t?++this._miss:++this._hit,t},e.prototype.clear=function(){this._storage.clear(this._namespace)},e.prototype.clearAll=function(){this._storage.clearAll()},e.prototype.getSize=function(){return this._storage.getSize()},e.prototype.getMaxSize=function(){return this._storage.maxSize},e.prototype.getStats=function(){return this._storage.getStats()},e.prototype.resetStats=function(){this._storage.resetStats()},e}();return function(e){var t=function(){function e(){this._db=new Map,this._size=0,this._age=0,this._hit=0,this._miss=0,this._maxSize=10485760,this._removeFuncs=[]}return e.prototype.registerRemoveFunc=function(e,t){this._removeFuncs.push([e,t])},e.prototype.deregisterRemoveFunc=function(e){this._removeFuncs=this._removeFuncs.filter(function(t){return t[0]!==e})},Object.defineProperty(e.prototype,"maxSize",{get:function(){return this._maxSize},set:function(e){this._maxSize=Math.max(e,0),this._size>this._maxSize&&this._removeEntries()},enumerable:!0,configurable:!0}),e.prototype.put=function(e,t,r,i){if(r>this._maxSize){if(this._db.has(e)){var n=this._db.get(e);this._size-=n.size,this._db.delete(e)}this._notifyRemoved(e,t)}else if(!r||r<0)console.warn("Refusing to cache entry with invalid size "+r);else{if(this._db.has(e)){n=this._db.get(e);this._notifyRemoved(e,n.entry),this._size+=r-n.size,n.entry=t,n.lastUsed=this._age+i,n.size=r}else this._db.set(e,{entry:t,size:r,lastUsed:this._age+i}),this._size+=r;++this._age,this._size>this._maxSize&&this._removeEntries()}},e.prototype.pop=function(e){if(this._db.has(e)){var t=this._db.get(e);return this._size-=t.size,this._db.delete(e),++this._hit,t.entry}++this._miss},e.prototype.getSize=function(){return this._size},e.prototype.getStats=function(){var e=this,t={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},i={},a=this._age,o=this._age;this._db.forEach(function(e,t){a=Math.min(a,e.lastUsed),o=Math.max(o,e.lastUsed),n.forEach(function(n){var a=n.namespace;if(r.startsWith(t,a)){var o=i[a]||0;return i[a]=o+e.size,!1}})}),t.Entries+=" / "+a+" - "+o;var s={};n.forEach(function(e){var t=e.namespace;if(!isNaN(e.hitRate)&&e.hitRate>0){var r=i[t]||0;i[t]=r,s[t]=Math.round(100*e.hitRate)+"%"}else s[t]="0%"});var u=Object.keys(i);return u.forEach(function(t){return i[t]=i[t]/e._size*100}),u.sort(function(e,t){return i[t]-i[e]}),u.forEach(function(e){return t[e]=Math.round(i[e])+"% / "+s[e]}),t},e.prototype.resetStats=function(){this._hit=this._miss=0,n.forEach(function(e){return e.resetHitRate()})},e.prototype.clear=function(e){var t=this;this._db.forEach(function(i,n){r.startsWith(n,e)&&(t._size-=i.size,t._db.delete(n),t._notifyRemoved(n,i.entry))})},e.prototype.clearAll=function(){var e=this;this._db.forEach(function(t,r){e._notifyRemoved(r,t.entry)}),this._size=0,this._db.clear()},e.prototype._getHitRate=function(){return this._hit/(this._hit+this._miss)},e.prototype._notifyRemoved=function(e,t){this._removeFuncs.forEach(function(i){r.startsWith(e,i[0])&&i[1](t)})},e.prototype._removeEntries=function(){var e=[];this._db.forEach(function(t,r){e.push([t.lastUsed,r])}),e.sort(function(e,t){return e[0]-t[0]});for(var t=0,r=e;t<r.length;t++){var i=r[t][1],n=this._db.get(i);if(this._size-=n.size,this._db.delete(i),this._notifyRemoved(i,n.entry),this._size<=.9*this.maxSize)return}},e}();e.Storage=t}(a||(a={})),a}.apply(null,i))||(e.exports=n)},1402:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(350),r(379),r(338),r(1403),r(792),r(769),r(348)],void 0===(n=function(e,t,r,i,n,a,o,s,u){var l;return function(e){e[e.QUEUED=1]="QUEUED",e[e.DOWNLOADING=2]="DOWNLOADING",e[e.CANCELLED=4]="CANCELLED"}(l||(l={})),function(){function e(e){this.tasks=new Map,this.clientPromiseToTask=new Map,this.loadQueue=new a(this.startLoading.bind(this),this.doneLoadingCallback,this,e)}return e.prototype.destroy=function(){var e=this;this.tasks.forEach(function(t){for(var r=0,i=t.clientPromises;r<i.length;r++){var n=i[r];n.isRejected()||n.reject(t.url,null),e.cancelTask(n)}}),this.loadQueue.clear(),this.loadQueue=null,this.tasks=null,this.clientPromiseToTask=null},e.prototype.request=function(e,t,r){var i=this,n=new o.Promise(function(){i.cancel(n)});return this.createOrUpdateTask(e,t,r,n),n},e.prototype.createTask=function(e,t,r,i,n){var a={url:e,docType:t,clientType:r,key:i,result:null,status:l.QUEUED,clientPromises:[],downloadObj:null,_cancelledInQueue:!1,startTime:0,duration:0,size:0};this.updateTask(a,n),this.tasks.set(i,a),this.loadQueue.push(a)},e.prototype.cancel=function(e){this.cancelTask(e)},e.prototype.hasPendingDownloads=function(){return this.tasks.size>0},Object.defineProperty(e.prototype,"tests",{get:function(){return{loadQueue:this.loadQueue}},enumerable:!0,configurable:!0}),e.prototype.taskKey=function(e,t,r){return e+":"+t+":"+r},e.prototype.updateTask=function(e,t){this.clientPromiseToTask.set(t,e),e.clientPromises.push(t)},e.prototype.createOrUpdateTask=function(e,t,r,i){var n=this.taskKey(e,t,r),a=this.tasks.get(n);a?this.updateTask(a,i):this.createTask(e,t,r,n,i)},e.prototype.cancelTask=function(e){var t=this.clientPromiseToTask.get(e);t&&(i.removeUnordered(t.clientPromises,e),this.clientPromiseToTask.delete(e),0===t.clientPromises.length&&(t.status===l.DOWNLOADING&&(this.loadQueue.workerCancelled(t),t.status=l.CANCELLED,t.downloadObj.cancel(),t.downloadObj=null),t.status=l.CANCELLED,this.tasks.delete(t.key)))},e.prototype.doneLoadingCallback=function(e,t){u.assert(e.status===l.DOWNLOADING);for(var r=e.result,i=0,a=e.clientPromises;i<a.length;i++){var o=a[i];this.clientPromiseToTask.delete(o),t?o.isRejected()||o.reject(e.url,t):(r||(r=n.clone(e.result)),o.done(e.url,r),r instanceof HTMLImageElement||(r=null))}this.tasks.delete(e.key)},e.prototype.startLoading=function(e,t){if(e.status===l.CANCELLED)return!1;var i,n;switch(e.status=l.DOWNLOADING,e.docType){case"binary":n="array-buffer",i=0;break;case"image":n="image";break;default:n="json"}return e.startTime=s.now(),e.downloadObj=r(e.url,{responseType:n,timeout:i}),e.downloadObj.then(function(r){e.duration=s.now()-e.startTime,e.size="binary"===e.docType?r.data.byteLength:0,e.result=r.data,t(e)},function(r){e.downloadObj.isCanceled()||t(e,r)}),!0},e}()}.apply(null,i))||(e.exports=n)},1403:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(379),r(348)],void 0===(n=function(e,t,r,i){return function(){function e(e,t,r,i){for(var n in this.workerFunc=e,this.robin=0,this.type2id={},this.tasks=[],this.typeNumWorkers=[],this.typeWorkerQuota=[],this.typeStatistics=[],this.totalNumWorkers=0,this.maxTotalNumWorkers=0,this.numTypes=0,i)this.tasks[this.robin]=[],this.typeNumWorkers[this.robin]=0,this.typeStatistics[this.robin]={requests:0,size:0,duration:0,speed:0},this.typeWorkerQuota[this.robin]=i[n],this.type2id[n]=this.robin++,this.maxTotalNumWorkers+=i[n];this.numTypes=this.tasks.length,this.robin=0;var a=this;this.taskCallback=function(e){e._cancelledInQueue||(t.apply(r,arguments),a.taskFinished(e))}}return e.prototype.setWorkerQuota=function(e){for(var t in i.assert(r.equals(Object.keys(this.typeWorkerAllication),Object.keys(e))),this.typeWorkerAllication=e,this.maxTotalNumWorkers=0,e){var n=this.type2id[t];this.typeWorkerQuota[n]=e[t],this.maxTotalNumWorkers+=e[t]}},e.prototype.setWorkerFunc=function(e){this.workerFunc=e},e.prototype.push=function(e){var t=this.type2id[e.clientType];this.totalNumWorkers<this.maxTotalNumWorkers?(this.typeNumWorkers[t]++,this.totalNumWorkers++,this.workerFunc(e,this.taskCallback)):this.tasks[t].push(e)},e.prototype._getStatsForType=function(e){var t=this.type2id[e];return{quota:this.typeWorkerQuota[t],workers:this.typeNumWorkers[t],queueSize:this.tasks[t].length,requestStats:this.typeStatistics[t]}},e.prototype.removeTasks=function(e,t){for(var r=[],i=0,n=this.tasks[this.type2id[t]];i<n.length;i++){var a=n[i];-1===e.indexOf(a)&&r.push(a)}this.tasks[this.type2id[t]]=r},e.prototype.workerCancelled=function(e){this.taskFinished(e),e._cancelledInQueue=!0},e.prototype.clear=function(){for(var e=0;e<this.tasks.length;e++)this.tasks[e]=[]},e.prototype.taskFinished=function(e){var t=this.type2id[e.clientType];this.typeNumWorkers[t]--,this.totalNumWorkers--,this.typeStatistics[t].requests++,this.typeStatistics[t].size+=e.size||0,this.typeStatistics[t].duration+=e.duration||0,this.typeStatistics[t].speed=this.typeStatistics[t].duration>0?this.typeStatistics[t].size/this.typeStatistics[t].duration:0,i.assert(this.typeNumWorkers[t]>=0),this.next()},e.prototype.next=function(){var e=this.robin,t=!1;do{this.typeNumWorkers[e]<this.typeWorkerQuota[e]&&this.processQueue(e)&&(t=!0),e=(e+1)%this.numTypes}while(!t&&e!==this.robin);if(!t)do{this.processQueue(e)&&(t=!0),e=(e+1)%this.numTypes}while(!t&&e!==this.robin);this.robin=e},e.prototype.processQueue=function(e){for(;this.tasks[e].length>0;)if(this.workerFunc(this.tasks[e].shift(),this.taskCallback))return this.typeNumWorkers[e]++,this.totalNumWorkers++,!0;return!1},e}()}.apply(null,i))||(e.exports=n)},1404:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){return function(){function e(e,t,r){this._clientType=e,this._loader=t,this._activeRequests=null,r&&r.trackRequests&&(this._activeRequests=new Map)}return e.prototype.request=function(e,t){var r=this,i=this._loader.request(e,t,this._clientType);if(this._activeRequests){this._activeRequests.set(e,i);var n=function(){r._activeRequests.delete(e)};i.then(n,n)}return i},e.prototype.cancelRequest=function(e){this._loader.cancel(e)},e.prototype.cancelAll=function(){var e=this;this._activeRequests&&(this._activeRequests.forEach(function(t){e._loader.cancel(t)}),this._activeRequests.clear())},e.prototype.hasPendingDownloads=function(){return this._loader.hasPendingDownloads()},e}()}.apply(null,i))||(e.exports=n)},1405:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(435),r(341),r(339),r(589),r(392)],void 0===(n=function(e,t,r,i,n,a,o){return function(){function e(e,t,r){this._layer=e,this._support=t,this._options=r}return e.prototype.queryExtent=function(e){var t=this;return this._rejectUnsupported(e).then(function(){var r=0,i=t._support.createExtentBuilder();return t._forAllQueried(e,function(e){r++,i.add(e)}),{count:r,extent:0===r?null:i.getExtent()}})},e.prototype.queryFeatureCount=function(e){var t=this;return this._rejectUnsupported(e).then(function(){var r=0;return t._forAllQueried(e,function(){return r++}),r})},e.prototype.queryFeatures=function(e){var t=this;return this._rejectUnsupported(e).then(function(){var a=[],o=e&&e.outFields,s=[];return t._forAllQueried(e,function(e){return s.push(t._support.createGraphic(e))},function(e){o&&(a.push(t._support.requestFields(e,s,o)),s=[])})>0&&!e.num?n.reject(new i("Unsupported Query","Large feature query, use Query.num and Query.start to batch")):(o||a.push(n.resolve(s)),r(a))}).then(function(e){for(var r=[],i=0;i<e.length;++i)for(var n=e[i],s=0;s<n.length;++s)r.push(a.hydrateGraphic(n[s],t._layer));var u=new o;return u.features=r,u})},e.prototype.queryObjectIds=function(e){var t=this;return this._rejectUnsupported(e).then(function(){var r=[];return t._forAllQueried(e,function(e){return r.push(e.id)}),r})},e.defaultExtentBuilder=function(e){var t=null;return{add:function(r){var i=e(r);i&&(t=null!=t?t.union(i):i.clone())},getExtent:function(){return t}}},e.prototype._forAllQueried=function(e,t,r){var i=[];if(e&&e.objectIds){var n=e.objectIds;i.push(function(e){return n.indexOf(e.id)>=0})}var a=e&&e.start||0,o=e&&e.num||1e4;return i.push(function(){return o<=0?(--o,!1):a>0?(--a,!1):(--o,!0)}),this._support.forAll(function(e){for(var r=0,n=i;r<n.length;r++)if(!(0,n[r])(e))return;t(e)},r),Math.max(0,-o)},e.prototype._rejectUnsupported=function(e){if(null==e)return n.resolve();var t=function(e){return n.reject(new i("Unsupported Query","Unsupported property '"+e+"'"))};return null!=e.distance?t("distance"):null!=e.geometryPrecision?t("geometryPrecision"):e.groupByFieldsForStatistics&&e.groupByFieldsForStatistics.length?t("groupByFieldsForStatistics"):null!=e.maxAllowableOffset?t("maxAllowableOffset"):e.multipatchOption?t("multipatchOption"):e.orderByFields&&e.orderByFields.length?t("orderByFields"):e.outSpatialReference?t("outSpatialReference"):e.outStatistics&&e.outStatistics.length?t("outStatistics"):e.pixelSize?t("pixelSize"):e.quantizationParameters?t("quantizationParameters"):e.relationParameter?t("relationParameter"):e.returnDistinctValues?t("returnDistinctValues"):e.text?t("text"):e.timeExtent?t("timeExtent"):e.where?t("where"):e.geometry?t("geometry"):!this._options.enableOutFields&&e.outFields&&e.outFields.length?t("outFields"):!this._options.enableObjectId&&e.objectIds&&e.objectIds.length?t("objectIds"):n.resolve()},e}()}.apply(null,i))||(e.exports=n)},1552:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1016)],void 0===(n=function(e,t,r){var i=function(){return function(e){this.highlightSet=new r,this.ids=new Set,this.options=e}}();return function(){function e(e){this.highlights=[],this.layerView=e}return e.prototype.destroy=function(){this.highlights.forEach(function(e){return e.highlightSet.removeAll()}),this.highlights=null},e.prototype.acquireSet=function(e){var t=this,r=new i(e);return this.highlights.push(r),{set:r,handle:{remove:function(){return t.releaseSet(r)}}}},e.prototype.releaseSet=function(e){e.highlightSet.removeAll();var t=this.highlights?this.highlights.indexOf(e):-1;-1!==t&&this.highlights.splice(t,1)},e.prototype.setFeatureIds=function(e,t){t.forEach(function(t){return e.ids.add(t)}),this.layerView._forAllFeatures(function(t,r,i,n){if(e.ids.has(t)){var a=i.engineObject.setComponentHighlight(n,r,e.options);e.highlightSet.addObject(i.engineObject,a)}},null,!0)},e.prototype.objectCreated=function(e){var t=this;this.highlights.forEach(function(r){t.layerView._forAllFeaturesOfNode(t.layerView._getMetadata(e),function(t,i,n,a){if(r.ids.has(t)){var o=e.setComponentHighlight(a,i,r.options);r.highlightSet.addObject(e,o)}},!0)})},e.prototype.objectDeleted=function(e){this.highlights.forEach(function(t){t.highlightSet.removeObject(e)})},e.prototype.allObjectsDeleted=function(){this.highlights.forEach(function(e){return e.highlightSet.removeAll()})},e}()}.apply(null,i))||(e.exports=n)},1553:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(337),r(335),r(346),r(343),r(336),r(367),r(589),r(342),r(894),r(1554)],void 0===(n=function(e,t,r,i,n,a,o,s,u,l,d,c){var h=s.empty(),p={spatialReference:null,extent:h},f=l.vec3d.create(),g=l.vec3d.create(),m=l.vec3d.create(),v=a.getLogger("esri.views.3d.layers.i3s.I3SElevationProvider");return function(e){function t(t){return e.call(this)||this}return r(t,e),t.prototype.initialize=function(){this.renderCoordsHelper=this.layerView.view.renderCoordsHelper,this.intersectLayers=[this.stageLayer],this.selector=new c(this.layerView.view.viewingMode);var e=this.layerView.layer.fullExtent;this.zmin=e.zmin,this.zmax=e.zmax},t.prototype.getElevation=function(e){if(u.isPoint(e)){if(!this.renderCoordsHelper.toRenderCoords(e,f))return v.error("could not project point for elevation alignment"),-1/0}else if(!this.renderCoordsHelper.toRenderCoords(e,this.spatialReference,f))return v.error("could not project point for elevation alignment"),-1/0;var t=this.layerView.elevationOffset,r=this.zmin+t,i=this.zmax+t;return l.vec3d.set(f,g),l.vec3d.set(f,m),this.renderCoordsHelper.setAltitude(i,g),this.renderCoordsHelper.setAltitude(r,m),this.selector.init(this.intersectLayers,g,m,null,null,1,!1),this.selector.minResult.getIntersectionPoint(f)?this.renderCoordsHelper.getAltitude(f):-1/0},t.prototype.layerChanged=function(){this.spatialReference&&(p.extent=this.computeLayerExtent(this.intersectLayers[0]),p.spatialReference=this.spatialReference,this.emit("elevation-change",p))},t.prototype.objectChanged=function(e){this.spatialReference&&(p.extent=this.computeObjectExtent(e),p.spatialReference=this.spatialReference,this.emit("elevation-change",p))},t.prototype.computeObjectExtent=function(e){return s.empty(h),this.expandExtent(e,h),h},t.prototype.computeLayerExtent=function(e){s.empty(h);for(var t=0,r=e.getObjects();t<r.length;t++){var i=r[t];this.expandExtent(i,h)}return h},t.prototype.expandExtent=function(e,t){for(var r=e.getBBMin(!0),i=e.getBBMax(!0),n=0;n<8;++n)f[0]=1&n?r[0]:i[0],f[1]=2&n?r[1]:i[1],f[2]=4&n?r[2]:i[2],l.mat4d.multiplyVec3(e.objectTransformation,f),this.renderCoordsHelper.fromRenderCoords(f,f,this.spatialReference),s.expand(t,f);return t},i([o.property({constructOnly:!0})],t.prototype,"layerView",void 0),i([o.property({constructOnly:!0})],t.prototype,"stageLayer",void 0),i([o.property({readOnly:!0,aliasOf:"layerView.view.elevationProvider.spatialReference"})],t.prototype,"spatialReference",void 0),i([o.subclass("esri.views.3d.layers.i3s.I3SElevationProvider")],t)}(o.declared(n,d.Evented))}.apply(null,i))||(e.exports=n)},1554:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(353),r(342),r(684),r(781)],void 0===(n=function(e,t,r,i,n,a){var o=i.vec3d.create(),s=i.vec3d.create(),u=i.vec3d.create(),l=r("dojo-debug-messages"),d=function(){function e(e){this.minResult=new c,this.maxResult=new c,this._normalDir=null,this._transform=i.mat4d.create(),this._transformInverse=new h({value:this._transform},i.mat4d.inverse,i.mat4d.create),this._transformInverseTranspose=new h(this._transformInverse,i.mat4d.transpose,i.mat4d.create),this._transformTranspose=new h({value:this._transform},i.mat4d.transpose,i.mat4d.create),this._transformInverseRotation=new h({value:this._transform},i.mat4d.toInverseMat3,i.mat3d.create),this.enableHUDSelection=!0,this.enableTerrain=!0,this.enableInvisibleTerrain=!1,this.enableBackfacesTerrain=!0,this.performanceInfo={queryDuration:0,numObjectsTested:0},this.viewingMode=e||"global",l&&(this._timer=new a(1))}return e.prototype.init=function(e,t,r,n,a,o,s,d){var c=this;if(t&&r&&i.vec3d.subtract(r,t,u),this.minResult.init(t,r),this.maxResult.init(t,r),this._numObjectsTested=0,this.point=n,this.camera=a,this.isSelection=s,this.p0=t,this.p1=r,this.hudResults=[],null==o&&(o=1e-5),this.tolerance=o,e){var h=function(e){c.intersectObject(e,d)};l&&this._timer.start();for(var p=0,f=e;p<f.length;p++){var g=f[p],m=g.getSpatialQueryAccelerator?g.getSpatialQueryAccelerator():void 0;if(m)m.forEachAlongRay(this.p0,u,h),s&&m.forEachDegenerateObject(h);else for(var v=0,y=g.getObjects();v<y.length;v++){h(y[v])}}l&&(this._timer.stop(),this.performanceInfo.queryDuration=this._timer.getLast(),this.performanceInfo.numObjectsTested=this._numObjectsTested)}},Object.defineProperty(e.prototype,"transformInverse",{get:function(){return this._transformInverse.value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"transformInverseTranspose",{get:function(){return this._transformInverseTranspose.value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"transformInverseRotation",{get:function(){return this._transformInverseRotation.value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"transformTranspose",{get:function(){return this._transformTranspose.value},enumerable:!0,configurable:!0}),e.prototype.getDirection=function(){return this._normalDir||(this._normalDir=i.vec3d.create(),i.vec3d.normalize(u,this._normalDir)),this._normalDir},e.prototype.intersectObject=function(e,t){var r=this;this._numObjectsTested++;for(var n,a=e.id,u=e.getGeometryRecords(),l=e.objectTransformation,d=0;d<u.length;d++){var h=u[d],p=h.geometry,f=h.materials,g=h.instanceParameters;g.hidden||(n=p.id,i.mat4d.set(l,this._transform),i.mat4d.multiply(this._transform,h.getShaderTransformation()),this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate(),i.mat4d.multiplyVec3(this.transformInverse,this.p0,o),i.mat4d.multiplyVec3(this.transformInverse,this.p1,s),f[0].intersect(p,g,this._transform,this,o,s,function(i,o,s,u,l,d){if(i>=0){if(null!=t&&!t(r.p0,r.p1,i))return;if(l){var h=new c;h.init(r.p0,r.p1),h.set(e,a,i,o,u,d,n,s),r.hudResults.push(h)}else(null==r.minResult.priority||u>=r.minResult.priority)&&(null==r.minResult.dist||i<r.minResult.dist)&&r.minResult.set(e,a,i,o,u,null,n,s),(null==r.maxResult.priority||u>=r.maxResult.priority)&&(null==r.maxResult.dist||i>r.maxResult.dist)&&r.maxResult.set(e,a,i,o,u,null,n,s)}},h.customTransformation),this.minResult.geometryId===n&&i.mat4d.set(this._transform,this.minResult.transformation),this.maxResult.geometryId===n&&i.mat4d.set(this._transform,this.maxResult.transformation))}},e.DEFAULT_TOLERANCE=1e-5,e}(),c=function(){function e(e,t){this.transformation=i.mat4d.identity(),this.normal=i.vec3d.create(),this.init(e,t)}return e.prototype.getIntersectionPoint=function(e){return null!=this.dist&&(i.vec3d.lerp(this.p0,this.p1,this.dist,e),!0)},e.prototype.getTransformedNormal=function(e){return i.vec3d.set(this.normal,p),p[3]=0,i.mat4d.multiplyVec4(this.transformation,p),i.vec3d.set(p,e),i.vec3d.normalize(e),e},e.prototype.set=function(e,t,r,a,o,s,u,l){e instanceof n&&(e={type:"stage",obj:e}),this.dist=r,i.vec3d.set(a,this.normal),this.target=e,this.name=t,this.priority=o,this.center=s?i.vec3d.create(s):null,this.geometryId=u,this.triangleNr=l},e.prototype.copyFrom=function(e){this.p0=e.p0,this.p1=e.p1,this.dist=e.dist,this.target=e.target,this.name=e.name,this.priority=e.priority,this.center=e.center?i.vec3d.create(e.center):null,this.geometryId=e.geometryId,this.triangleNr=e.triangleNr,this.intersector=e.intersector,i.vec3d.set(e.normal,this.normal)},e.prototype.setIntersector=function(e){this.intersector=e},e.prototype.init=function(e,t){this.dist=void 0,this.target=void 0,this.name=void 0,this.priority=void 0,this.center=null,this.geometryId=null,this.triangleNr=null,this.intersector="Stage",this.p0=e,this.p1=t},e}(),h=function(){function e(e,t,r){this.original=e,this.update=t,this.dirty=!0,this.transform=r()}return e.prototype.invalidate=function(){this.dirty=!0},Object.defineProperty(e.prototype,"value",{get:function(){return this.dirty&&(this.update(this.original.value,this.transform),this.dirty=!1),this.transform},enumerable:!0,configurable:!0}),e}(),p=i.vec4d.create();return d}.apply(null,i))||(e.exports=n)},1555:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(341),r(339)],void 0===(n=function(e,t,r,i){function n(e){return i.create(function(t,r){e.oncomplete=function(){return t()},e.onerror=function(){return r(e.error)},e.onabort=function(){return r(e.error)}})}function a(e){return i.create(function(t,r){"done"===e.readyState?null!=e.error?r(e.error):t(e.result):(e.onsuccess=function(){return t(e.result)},e.onerror=function(){return r(e.error)})})}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t,r){this._db=null,this._quotaReductionPromise=null,this._gcCounter=0,this._hit=0,this._miss=0,this._destroyed=!1,this.gcFrequency=50,this.maxByteSize=1073741824,this.quotaReductionFactor=.2,this._dbName=e,this._storeName=t,this._version=r}return e.prototype.init=function(){var e=this;return i.resolve().then(function(){var t=indexedDB.open(e._dbName,e._version);return t.onupgradeneeded=function(r){var i=t.result,n=t.transaction,a=i.objectStoreNames.contains(e._storeName)?n.objectStore(e._storeName):i.createObjectStore(e._storeName),o=i.objectStoreNames.contains("last_access")?n.objectStore("last_access"):i.createObjectStore("last_access");o.indexNames.contains("date")||o.createIndex("date","date",{unique:!1}),o.indexNames.contains("byteSize")||o.createIndex("byteSize","byteSize",{unique:!1}),r.oldVersion<e._version&&(a.clear(),o.clear())},a(t)}).then(function(t){e._destroyed?t.close():e._db=t})},e.prototype.destroy=function(){this._db&&(this._db.close(),this._db=null),this._destroyed=!0},e.prototype.getHitRate=function(){return this._hit/(this._hit+this._miss)},e.prototype.put=function(e,t){var n=this;return null==this._db?i.reject(new r("indexedb:not-initialized","IndexedDB Cache is not initialized")):(null!=this._quotaReductionPromise?this._quotaReductionPromise:i.resolve()).then(function(){return n._put(e,t)}).catch(function(r){if("QuotaExceededError"===r.name)return null==n._quotaReductionPromise&&(n._quotaReductionPromise=n._getCacheSize().then(function(e){return n._removeLeastRecentlyAccessed(t.byteSize+Math.ceil(e*n.quotaReductionFactor))}),n._quotaReductionPromise.always(function(){n._quotaReductionPromise=null})),n._quotaReductionPromise.then(function(){return n._put(e,t)});throw r}).then(function(){--n._gcCounter<0&&(n._gcCounter=n.gcFrequency,n._getCacheSize().then(function(e){return n._removeLeastRecentlyAccessed(e-n.maxByteSize)}))})},e.prototype.get=function(e){var t=this;return null==this._db?i.resolve(null):i.resolve().then(function(){return a(t._db.transaction(t._storeName,"readonly").objectStore(t._storeName).get(e))}).then(function(r){return null==r?++t._miss:(++t._hit,t._db.transaction("last_access","readwrite").objectStore("last_access").put({date:(new Date).getTime(),byteSize:r.byteSize},e)),r}).catch(function(e){return++t._miss,null})},e.prototype.remove=function(e){var t=this;return null==this._db?i.resolve():i.resolve().then(function(){var r=t._db.transaction([t._storeName,"last_access"],"readwrite"),i=r.objectStore(t._storeName),a=r.objectStore("last_access");return i.delete(e),a.delete(e),n(r)})},e.prototype._put=function(e,t){var r=this._db.transaction([this._storeName,"last_access"],"readwrite");return r.objectStore(this._storeName).put(t,e),r.objectStore("last_access").put({date:(new Date).getTime(),byteSize:t.byteSize},e),n(r)},e.prototype._removeLeastRecentlyAccessed=function(e){if(!(e<=0)){var t=this._db.transaction([this._storeName,"last_access"],"readwrite"),r=t.objectStore(this._storeName),i=t.objectStore("last_access"),a=0,o=i.index("date").openCursor(null,"next");return o.onsuccess=function(t){var n=o.result;null!=n&&(null!=n.value.byteSize&&(a+=n.value.byteSize),r.delete(n.primaryKey),i.delete(n.primaryKey),a<e&&n.continue())},n(t)}},e.prototype._getCacheSize=function(){var e=this._db.transaction("last_access"),t=e.objectStore("last_access"),r=0,i=t.index("byteSize").openKeyCursor();return i.onsuccess=function(e){var t=i.result;if(t){var n=t.key;null!=n&&(r+=n),t.continue()}},n(e).then(function(){return r})},e}();t.IDBCache=o,t.whenTransaction=n,t.whenRequest=a}.apply(null,i))||(e.exports=n)},369:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Default3D={position:0,normal:1,normalCompressed:1,uv0:2,color:3,instanceColor:3,size:4,auxpos1:5,symbolColor:5,componentIndex:5,auxpos2:6,featureAttribute:6,instanceFeatureAttribute:6,region:7,model:8,modelNormal:12,modelOriginHi:11,modelOriginLo:15}}.apply(null,i))||(e.exports=n)},397:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(364),r(384),r(367),r(801),r(699),r(386),r(589),r(342),r(359)],void 0===(n=function(e,t,r,i,n,a,o,s,u,l,d){function c(e){var t=e.paths[0];if(!t||0===t.length)return null;var r=o.getPointOnPath(t,o.getPathLength(t)/2);return u.makeDehydratedPoint(r[0],r[1],r[2],e.spatialReference)}Object.defineProperty(t,"__esModule",{value:!0});var h=[1,1,1];t.computeCentroid=function(e){if("point"===e.type)return e;if(u.isHydratedGeometry(e))switch(e.type){case"extent":return e.center;case"polygon":return e.centroid;case"polyline":return c(e);case"mesh":return e.extent.center}else switch(e.type){case"extent":return function(e){var t=d.isFinite(e.zmin);return u.makeDehydratedPoint(.5*(e.xmax+e.xmin),.5*(e.ymax+e.ymin),t?.5*(e.zmax+e.zmin):void 0,e.spatialReference)}(e);case"polygon":return function(e){var t=e.rings[0];if(!t||0===t.length)return null;var r=a.ringsCentroid(e.rings,e.hasZ);return u.makeDehydratedPoint(r[0],r[1],r[2],e.spatialReference)}(e);case"polyline":return c(e)}},t.convertPointSR=function(e,t){var i=e.spatialReference;i.isWebMercator&&t.isWGS84?(s.xyToLngLat(e.x,e.y,p),e.x=p[0],e.y=p[1],e.spatialReference=r.SpatialReference.WGS84):t.isWebMercator&&i.isWGS84&&(s.lngLatToXY(e.x,e.y,p),e.x=p[0],e.y=p[1],e.spatialReference=r.SpatialReference.WebMercator)},t.enlargeExtent=function(e,t,r){if(e){t||(t=n.create());var i=e,a=.5*i.width*(r-1),o=.5*i.height*(r-1);return i.width<1e-7*i.height?a+=o/20:i.height<1e-7*i.width&&(o+=a/20),l.vec4d.set4(i.xmin-a,i.ymin-o,i.xmax+a,i.ymax+o,t),t}return null},t.updateVertexAttributeAuxpos1w=function(e,t){for(var r=0;r<e.geometries.length;++r){var i=e.geometries[r].data.vertexAttributes.auxpos1;i&&i.data[3]!==t&&(i.data[3]=t,e.geometryVertexAttrsUpdated(r))}},t.mixinColorAndOpacity=function(e,t){var r=[1,1,1,1];return null!=e&&(r[0]=e[0],r[1]=e[1],r[2]=e[2]),null!=t?r[3]=t:null!=e&&e.length>3&&(r[3]=e[3]),r},t.overrideColor=function(e,t,r,i,n,a){void 0===a&&(a=[0,0,0,0]);for(var o=0;o<3;++o)e&&null!=e[o]?a[o]=e[o]:r&&null!=r[o]?a[o]=r[o]:a[o]=n[o];return a[3]=null!=t?t:null!=i?i:n[3],a},t.computeObjectScale=function(e,t,r,i){void 0===e&&(e=h),void 0===i&&(i=1);var n=new Array(3);if(null==t||null==r)n[0]=1,n[1]=1,n[2]=1;else{for(var a=void 0,o=0,s=2;s>=0;s--){var u=e[s],l=void 0,d=null!=u,c=0===s&&!a&&!d,p=r[s];"symbolValue"===u||c?l=0!==p?t[s]/p:1:d&&"proportional"!==u&&isFinite(u)&&(l=0!==p?u/p:1),null!=l&&(n[s]=l,a=l,o=Math.max(o,Math.abs(l)))}for(s=2;s>=0;s--)null==n[s]?n[s]=a:0===n[s]&&(n[s]=.001*o)}for(s=2;s>=0;s--)n[s]/=i;return n},t.computeSizeWithResourceSize=function(e,t){var r=t.isPrimitive,i=t.width,n=t.depth,a=t.height,o=r?10:1;if(null==i&&null==a&&null==n)return[o*e[0],o*e[1],o*e[2]];for(var s,u=[i,n,a],l=0;l<3;l++){var d=u[l];if(null!=d){s=d/e[l];break}}for(l=0;l<3;l++)null==u[l]&&(u[l]=e[l]*s);return u},t.validateSymbolLayerSize=function(e){return function(e){return null!=e.isPrimitive}(e)&&(e=[e.width,e.depth,e.height]),function e(t){if(Array.isArray(t)){for(var r=0,i=t;r<i.length;r++)if(!e(i[r]))return!1;return!0}return null==t||t>=0}(e)?null:"Symbol sizes may not be negative values"},t.computeObjectRotation=function(e,t,r,i){void 0===i&&(i=l.mat4d.identity());var n=e||0,a=t||0,o=r||0;return 0!==n&&l.mat4d.rotateZ(i,-n/180*Math.PI,i),0!==a&&l.mat4d.rotateX(i,a/180*Math.PI,i),0!==o&&l.mat4d.rotateY(i,o/180*Math.PI,i),i},t.demResolutionForBoundingBox=function(e,t){return null!=t.minDemResolution?t.minDemResolution:i.isPoint(e)?t.minDemResolutionForPoints:.01*i.maximumDimension(e)};var p=[0,0]}.apply(null,i))||(e.exports=n)},403:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.mapParameters=function e(t){var r={};for(var i in t)if("declaredClass"!==i){var n=t[i];if(null!=n&&"function"!=typeof n)if(Array.isArray(n)){r[i]=[];for(var a=0;a<n.length;a++)r[i][a]=e(n[a])}else"object"==typeof n?n.toJSON&&(r[i]=JSON.stringify(n)):r[i]=n}return r}}.apply(null,i))||(e.exports=n)},407:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(379),r(666)],void 0===(n=function(e,t,r,i){var n=2;return function(){function e(e){var t=this;if(this.data=[],this._length=0,this._allocator=null,this._deallocator=function(e,r){return t.data[r]=void 0},this._shrink=function(){},this._hint=new r.RemoveHint,e){if(e.initialSize&&(this.data=new Array(e.initialSize)),e.allocator&&(this._allocator=e.allocator,this._deallocator=e.deallocator,e.initialSize))for(var i=0;i<e.initialSize;++i)this.data[i]=this._allocator(i);e.shrink&&(this._shrink=function(){t.data.length>n*t.length&&(t.data.length=t.length)})}}return e.prototype.toArray=function(){return this.data.slice(0,this.length)},Object.defineProperty(e.prototype,"length",{get:function(){return this._length},set:function(e){if(this._allocator)for(;this.data.length<e;)this.data.push(this._allocator(this.data.length));if(this._deallocator)for(var t=e;t<this._length;++t)this._deallocator(this.data[t],t);this._length=e,this._shrink()},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this.length=0},e.prototype.equal=function(e){return r.equals(this.data,e.data)},e.prototype.push=function(e){return this.data.length===this.length&&this._grow((this.length+1)*n),this.data[this.length++]=e,e},e.prototype.pushArray=function(e){var t=this.length+e.length;t>=this.data.length&&this._grow(Math.max(this.length*n,t));for(var r=0;r<e.length;r++)this.data[this._length++]=e[r];return this.back()},e.prototype.pushNew=function(){return this.data.length===this.length&&this._grow((this.length+1)*n),++this._length,this.back()},e.prototype.pop=function(){if(0!==this.length){var e=this.data[this.length-1];return this.length=this.length-1,this._shrink(),e}},e.prototype.removeMany=function(e){var t=this,r=[];return this.data=this.data.filter(function(i,n){return!(n>=t.length)&&(e.indexOf(i)<0||(r.push(i),!1))}),this._length=this.data.length,r},e.prototype.removeUnordered=function(e){var t=r.removeUnordered(this.data,e,this.length,this._hint);return void 0!==t&&(this.length=this.length-1),t},e.prototype.removeUnorderedMany=function(e){var t=r.removeUnorderedMany(this.data,e,this.length,this._hint);return this.length=this.length-t.length,t},e.prototype.front=function(){if(0!==this.length)return this.data[0]},e.prototype.back=function(){if(0!==this.length)return this.data[this.length-1]},e.prototype.swapElements=function(e,t){var r;e>=this.length||t>=this.length||(r=[this.data[t],this.data[e]],this.data[e]=r[0],this.data[t]=r[1])},e.prototype.sort=function(e){i.sort(this.data,0,this.length,e)},e.prototype.some=function(e,t){for(var r=0;r<this.length;++r)if(e.call(t,this.data[r],r,this.data))return!0;return!1},e.prototype.find=function(e,t){for(var r=0;r<this.length;++r){var i=this.data[r];if(e.call(t,i,r,this.data))return i}},e.prototype.filter=function(t,r,i){i=i||new e;for(var n=0;n<this.length;++n)t.call(r,this.data[n],n,this.data)&&i.push(this.data[n]);return i},e.prototype.forEach=function(e,t){for(var r=0;r<this.length;++r)e.call(t,this.data[r],r,this.data)},e.prototype.map=function(e,t){for(var r=new Array(this.length),i=0;i<this.length;++i)r[i]=e.call(t,this.data[i],i,this.data);return r},e.prototype._grow=function(e){if(this._allocator)for(;this.data.length<e;)this.data.push(this._allocator(this.data.length))},e}()}.apply(null,i))||(e.exports=n)},417:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(369),r(430),r(382),r(368),r(376)],void 0===(n=function(e,t,r,i,n,a,o){Object.defineProperty(t,"__esModule",{value:!0}),t.createQuadVAO=function(e,t){void 0===t&&(t=i.Pos2);var a=null;switch(t){case i.Pos3Tex:a=new Float32Array([-1,-1,0,0,0,1,-1,0,1,0,-1,1,0,0,1,1,1,0,1,1]);break;case i.Pos3:a=new Float32Array([-1,-1,0,1,-1,0,-1,1,0,1,1,0]);break;case i.Pos2Tex:a=new Float32Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]);break;case i.Pos2:default:a=new Float32Array([-1,-1,1,-1,-1,1,1,1])}return new o(e,r.Default3D,{geometry:t},{geometry:n.createVertex(e,35044,a)})};var s=4;t.createEmptyTexture=function(e,t){return void 0===t&&(t=s),new a(e,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:t,height:t})},t.createColorTexture=function(e,t,r){void 0===r&&(r=s);for(var i=new Uint8Array(r*r*4),n=0;n<i.length;n+=4)i[n+0]=255*t[0],i[n+1]=255*t[1],i[n+2]=255*t[2],i[n+3]=255*t[3];return new a(e,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:r,height:r},i)}}.apply(null,i))||(e.exports=n)},425:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1}}();t.default=r}.apply(null,i))||(e.exports=n)},430:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Pos3=[{name:"position",count:3,type:5126,offset:0,stride:12,normalized:!1}],t.Pos3Tex=[{name:"position",count:3,type:5126,offset:0,stride:20,normalized:!1},{name:"uv0",count:2,type:5126,offset:12,stride:20,normalized:!1}],t.Pos3Col=[{name:"position",count:3,type:5126,offset:0,stride:16,normalized:!1},{name:"color",count:4,type:5121,offset:12,stride:16,normalized:!1}],t.Pos2=[{name:"position",count:2,type:5126,offset:0,stride:8,normalized:!1}],t.Pos2Tex=[{name:"position",count:2,type:5126,offset:0,stride:16,normalized:!1},{name:"uv0",count:2,type:5126,offset:8,stride:16,normalized:!1}]}.apply(null,i))||(e.exports=n)},439:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){return function(){function e(){this._count=0}return e.prototype.gen=function(e){return null==e&&(e="a"),e+"_"+this._count++},e}()}.apply(null,i))||(e.exports=n)},445:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){return function(){function e(){}return e.LAYER="layers",e.OBJECT="objects",e.GEOMETRY="geometries",e.MATERIAL="materials",e.TEXTURE="textures",e}()}.apply(null,i))||(e.exports=n)},448:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(342),r(445),r(617),r(724),r(814)],void 0===(n=function(e,t,r,i,n,a,o){return function(){function e(e,t,i,s){this.sceneIntersectionHelper=s,this._viewContent=[],this.container=t,this.viewingMode=e,this.model=new a,this.view=new o(t,this,this.model.getDirtySet(),i),this.view.setLighting({lights:[new n.MainLight(r.vec3d.createFrom(.7,.7,.7)),new n.AmbientLight(r.vec3d.createFrom(.3,.3,.3))],groundLightingFactor:.5,globalFactor:.5})}return e.prototype.setNeedsRender=function(){this.view.setNeedsRender()},e.prototype.dispose=function(){this.view.dispose(),this.view=null,this.model=null},e.prototype.add=function(e,t){this.model.add(e,t),"function"==typeof t.addParentStage&&t.addParentStage(this)},e.prototype.remove=function(e,t){var r=this.model.remove(e,t);return"function"==typeof r.removeParentStage&&r.removeParentStage(this),r},e.prototype.notifyDirty=function(e,t,r,i){this.model.notifyDirty(e,t,r,i)},e.prototype.processDirty=function(){var t=this.model.getDirtySet(),r=t.getDirtyMaterials();if(t.hasDirtyGeometryRecords()||r){e.DebugSettings.endFrameContentValidation&&this.model.validateContent(),e.DebugSettings.logDirtySet&&console.log("Dirty set: "+this.model.getDirtySet().formatDebugInfo(!1));var i=t.commitLayers(this._viewContent);(i[0].length+i[1].length+i[2].length>0||r)&&this.view.modify(i[0],i[1],i[2],r),e.DebugSettings.logDirtySet&&(console.log("RGs add: "+i[0].map(function(e){return e.uniqueName})),console.log("RGs remove: "+i[1].map(function(e){return e.uniqueName}))),t.commit(),t.clearDirtyMaterials(),this.view.setNeedsRender()}},e.prototype.processDirtyLayer=function(e){var t=this.model.getDirtySet(),r=t.getDirtyMaterials(),i=t.commitLayers([e]);(i[0].length+i[1].length+i[2].length>0||r)&&this.view.modify(i[0],i[1],i[2],r),t.clearDirtyMaterials(),this.view.setNeedsRender()},e.prototype.get=function(e,t){return this.model.get(e,t)},e.prototype.getAll=function(e){return this.model.getAll(e)},e.prototype.getCamera=function(){return this.view.getCamera()},e.prototype.setCamera=function(e){this.view.setCamera(e)},e.prototype.getViewParams=function(e){return this.view.getViewParams(e)},e.prototype.setViewParams=function(e){this.view.setViewParams(e)},e.prototype.getLayers=function(){return this.model.getAll(i.LAYER)},e.prototype.setLighting=function(e){this.view.setLighting(e)},e.prototype.getCanvas=function(){return this.view.getCanvas()},e.prototype.setRenderParams=function(e){this.view.setRenderParams(e)},e.prototype.getRenderParams=function(){return this.view.getRenderParams()},e.prototype.getIdleSuspend=function(){return this.view.getIdleSuspend()},e.prototype.has=function(e){return this.view.has(e)},e.prototype.getViewContent=function(){return this._viewContent.slice(0)},e.prototype.addToViewContent=function(e){for(var t=[],r=0;r<e.length;r++)-1===this._viewContent.indexOf(e[r])&&t.push(e[r]);if(e.length>0){this.processDirty();var i=this.model.getDirtySet().getResidentRenderGeometriesFilteredByLayers(t);this.view.modify(i,[],[]),this._viewContent.push.apply(this._viewContent,t)}},e.prototype.removeFromViewContent=function(e){this.processDirty();for(var t=this.model.getDirtySet(),r=this._viewContent,i=[],n=0;n<e.length;n++){var a=r.indexOf(e[n]);a>-1&&(r[a]=r[r.length-1],r.pop(),i.push(e[n]))}var o=t.getResidentRenderGeometriesFilteredByLayers(i);this.view.modify([],o,[])},e.prototype.getFrameTask=function(){return this.view.getFrameTask()},e.prototype.takeScreenshot=function(e){return this.view.takeScreenshot(e)},e.prototype.addRenderPlugin=function(e,t){return"function"==typeof t.intersect&&this.sceneIntersectionHelper.addIntersectionHandler(t),this.view.renderPlugins.add(e,t)},e.prototype.removeRenderPlugin=function(e){return this.sceneIntersectionHelper.removeIntersectionHandler(e),this.view.renderPlugins.remove(e)},e.prototype.getContentDebugStrings=function(e){return this.model.formatDebugInfo(e)},e.prototype.getRenderStats=function(){return this.view.getCombinedStats()},e.prototype.getRenderStatString=function(e){var t=this.getRenderStats(),r="";if(e){for(var i in r+="<table>",t)r+="<tr><td>"+i+'</td><td style="text-align: right">'+Math.round(t[i])+"</td></tr>";r+="</table>"}else for(var i in t)r+=i+": "+t[i]+"\n";return r},e.prototype.getFramebufferTexture=function(e){return void 0===e&&(e="color"),this.view.getFramebufferTexture(e)},e.prototype.getDrapedTextureRenderer=function(){return this.view.getDrapedTextureRenderer()},e.DebugSettings={endFrameContentValidation:!1,logDirtySet:!1},e.ModelContentType=i,e}()}.apply(null,i))||(e.exports=n)},589:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(383),r(338),r(362),r(384),r(367),r(758),r(741)],void 0===(n=function(e,t,r,i,n,a,o,s,u){function l(e){switch(e){case"esriGeometryPoint":return"point";case"esriGeometryMultipoint":return"multipoint";case"esriGeometryPolyline":return"polyline";case"esriGeometryPolygon":return"polygon";case"esriGeometryEnvelope":return"extent"}}function d(e,t,i,n){return{uid:r.generateUID(),objectId:n&&e.attributes?e.attributes[n]:null,attributes:e.attributes,geometry:c(e.geometry,t,i),visible:!0}}function c(e,t,r){if(!e)return null;switch(t){case"point":var i=e;return{x:i.x,y:i.y,z:i.z,m:i.m,hasZ:null!=i.z,hasM:null!=i.m,type:t,spatialReference:r};case"polyline":var n=e;return{paths:n.paths,hasZ:!!n.hasZ,hasM:!!n.hasM,type:t,spatialReference:r};case"polygon":var a=e;return{rings:a.rings,hasZ:!!a.hasZ,hasM:!!a.hasM,type:t,spatialReference:r};case"multipoint":var o=e;return{points:o.points,hasZ:!!o.hasZ,hasM:!!o.hasM,type:t,spatialReference:r};case"extent":var s=e;return{xmin:s.xmin,ymin:s.ymin,zmin:s.zmin,mmin:s.mmin,xmax:s.xmax,ymax:s.ymax,zmax:s.zmax,mmax:s.mmax,hasZ:!!s.hasZ,hasM:!!s.hasM,type:t,spatialReference:r}}}function h(e){return"declaredClass"in e}function p(e,t){switch(a.empty(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[3]=e.x,t[1]=t[4]=e.y,e.hasZ&&(t[2]=t[5]=e.z);break;case"polyline":for(var r=0;r<e.paths.length;r++)a.expandWithNestedArray(t,e.paths[r],e.hasZ);break;case"polygon":for(r=0;r<e.rings.length;r++)a.expandWithNestedArray(t,e.rings[r],e.hasZ);break;case"multipoint":a.expandWithNestedArray(t,e.points,e.hasZ);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[3]=e.xmax,t[4]=e.ymax,null!=e.zmin&&(t[2]=e.zmin),null!=e.zmax&&(t[5]=e.zmax)}}function f(e,t){switch(o.empty(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[2]=e.x,t[1]=t[3]=e.y;break;case"polyline":for(var r=0;r<e.paths.length;r++)o.expandWithNestedArray(t,e.paths[r]);break;case"polygon":for(r=0;r<e.rings.length;r++)o.expandWithNestedArray(t,e.rings[r]);break;case"multipoint":o.expandWithNestedArray(t,e.points);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax}}Object.defineProperty(t,"__esModule",{value:!0}),t.equals=u.equals,t.isPoint=function(e){return"point"===e.type},t.mapJSONGeometryType=l,t.fromFeatureSetJSON=function(e){var t=l(e.geometryType),r=n.fromJSON(e.spatialReference),i=e.transform;return e.features.map(function(n){var a=d(n,t,r,e.objectIdFieldName),o=a.geometry;if(o&&i)switch(o.type){case"point":a.geometry=s.hydratePoint(i,o,o,o.hasZ,o.hasM);break;case"multipoint":a.geometry=s.hydrateMultipoint(i,o,o,o.hasZ,o.hasM);break;case"polygon":a.geometry=s.hydratePolygon(i,o,o,o.hasZ,o.hasM);break;case"polyline":a.geometry=s.hydratePolyline(i,o,o,o.hasZ,o.hasM)}return a})},t.fromJSON=d,t.fromJSONGeometry=c,t.makeDehydratedPoint=function(e,t,r,i){return{x:e,y:t,z:r,hasZ:null!=r,hasM:!1,spatialReference:i,type:"point"}},t.isHydratedGeometry=function(e){return"declaredClass"in e},t.isHydratedGraphic=h,t.hydrateGraphic=function(e,t){if(!e||h(e))return e;var n=new r({layer:t,sourceLayer:t});return n.visible=e.visible,n.symbol=i.clone(e.symbol),n.attributes=i.clone(e.attributes),e.geometry&&("mesh"===e.geometry.type?n.geometry=e.geometry:n.read({geometry:function(e){var t=e.spatialReference.toJSON();switch(e.type){case"point":return{x:e.x,y:e.y,z:e.z,m:e.m,spatialReference:t};case"polygon":var r=e.rings,i=e.hasZ,n=e.hasM;return{rings:r,hasZ:i,hasM:n,spatialReference:t};case"polyline":var a=e.paths,i=e.hasZ,n=e.hasM;return{paths:a,hasZ:i,hasM:n,spatialReference:t};case"extent":var o=e.xmin,s=e.xmax,u=e.ymin,l=e.ymax,d=e.zmin,c=e.zmax,h=e.mmin,p=e.mmax,i=e.hasZ,n=e.hasM;return{xmin:o,xmax:s,ymin:u,ymax:l,zmin:d,zmax:c,mmin:h,mmax:p,hasZ:i,hasM:n,spatialReference:t};case"multipoint":var f=e.points,i=e.hasZ,n=e.hasM;return{points:f,hasZ:i,hasM:n,spatialReference:t}}}(e.geometry)})),n},t.computeAABB=p,t.expandAABB=function(e,t){p(e,g),a.expand(t,g)},t.computeAABR=f,t.expandAABR=function(e,t){f(e,m),o.expand(t,m)};var g=a.create(),m=o.create()}.apply(null,i))||(e.exports=n)},593:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){return function(){function e(e,t,r,i){this._tag=0,this._dataType=99,this._data=e,this._dataView=t,this._pos=r||0,this._end=i||e.byteLength}return e.prototype.clone=function(){return new e(this._data,this._dataView,this._pos,this._end)},e.prototype.pos=function(){return this._pos},e.prototype.next=function(e){for(;;){if(this._pos===this._end)return!1;var t=this._decodeVarint();if(this._tag=t>>3,this._dataType=7&t,!e||e===this._tag)break;this.skip()}return!0},e.prototype.empty=function(){return this._pos>=this._end},e.prototype.tag=function(){return this._tag},e.prototype.getInt32=function(){return this._decodeVarint()},e.prototype.getInt64=function(){return this._decodeVarint()},e.prototype.getUInt32=function(){var e=4294967295;return e=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128?e:(e=(e|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128?e:void 0))))},e.prototype.getUInt64=function(){return this._decodeVarint()},e.prototype.getSInt32=function(){var e=this.getUInt32();return e>>>1^-(1&e)|0},e.prototype.getSInt64=function(){return this._decodeSVarint()},e.prototype.getBool=function(){var e=0!==this._data[this._pos];return this._skip(1),e},e.prototype.getEnum=function(){return this._decodeVarint()},e.prototype.getFixed64=function(){var e=this._dataView,t=this._pos,r=e.getUint32(t,!0)+4294967296*e.getUint32(t+4,!0);return this._skip(8),r},e.prototype.getSFixed64=function(){var e=this._dataView,t=this._pos,r=e.getUint32(t,!0)+4294967296*e.getInt32(t+4,!0);return this._skip(8),r},e.prototype.getDouble=function(){var e=this._dataView.getFloat64(this._pos,!0);return this._skip(8),e},e.prototype.getFixed32=function(){var e=this._dataView.getUint32(this._pos,!0);return this._skip(4),e},e.prototype.getSFixed32=function(){var e=this._dataView.getInt32(this._pos,!0);return this._skip(4),e},e.prototype.getFloat=function(){var e=this._dataView.getFloat32(this._pos,!0);return this._skip(4),e},e.prototype.getString=function(){var e=this._getLength(),t=this._pos,r=this._toString(this._data,t,t+e);return this._skip(e),r},e.prototype.getBytes=function(){var e=this._getLength(),t=this._pos,r=this._toBytes(this._data,t,t+e);return this._skip(e),r},e.prototype.getMessage=function(){var t=this._getLength(),r=this._pos,i=new e(this._data,this._dataView,r,r+t);return this._skip(t),i},e.prototype.skip=function(){switch(this._dataType){case 0:this._decodeVarint();break;case 1:this._skip(8);break;case 2:this._skip(this._getLength());break;case 5:this._skip(4);break;default:throw new Error("Invalid data type!")}},e.prototype._skip=function(e){if(this._pos+e>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=e},e.prototype._decodeVarint=function(){var e,t=this._data,r=this._pos,i=0;if(this._end-r>=10)do{if(i|=127&(e=t[r++]),0==(128&e))break;if(i|=(127&(e=t[r++]))<<7,0==(128&e))break;if(i|=(127&(e=t[r++]))<<14,0==(128&e))break;if(i|=(127&(e=t[r++]))<<21,0==(128&e))break;if(i+=268435456*(127&(e=t[r++])),0==(128&e))break;if(i+=34359738368*(127&(e=t[r++])),0==(128&e))break;if(i+=4398046511104*(127&(e=t[r++])),0==(128&e))break;if(i+=562949953421312*(127&(e=t[r++])),0==(128&e))break;if(i+=72057594037927940*(127&(e=t[r++])),0==(128&e))break;if(i+=0x8000000000000000*(127&(e=t[r++])),0==(128&e))break;throw new Error("Varint too long!")}while(0);else{for(var n=1;r!==this._end&&0!=(128&(e=t[r]));)++r,i+=(127&e)*n,n*=128;if(r===this._end)throw new Error("Varint overrun!");++r,i+=e*n}return this._pos=r,i},e.prototype._decodeSVarint=function(){var e=this._decodeVarint();return e%2?-(e+1)/2:e/2},e.prototype._getLength=function(){if(2!==this._dataType)throw new Error("Not a delimited data type!");return this._decodeVarint()},e.prototype._toString=function(e,t,r){var i="",n="";r=Math.min(this._end,r);for(var a=t;a<r;++a){var o=e[a];128&o?n+="%"+o.toString(16):(i+=decodeURIComponent(n)+String.fromCharCode(o),n="")}return n.length&&(i+=decodeURIComponent(n)),i},e.prototype._toBytes=function(e,t,r){return r=Math.min(this._end,r),new Uint8Array(e.buffer,t,r-t)},e}()}.apply(null,i))||(e.exports=n)},594:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(699),r(986),r(589),r(884),r(397),r(342),r(387),r(684)],void 0===(n=function(e,t,r,i,n,a,o,s,u,l){function d(e,t,r,i,n){var a=t.z||0,o=r.featureExpressionInfoContext;switch(r.mode){case"on-the-ground":var s=e.getElevation(t,"ground")||0;return n&&(n.verticalDistanceToGround=0,n.terrainElevation=s),s;case"relative-to-ground":var u=e.getElevation(t,"ground")||0;s=r.calculateOffsetRenderUnits(i);return null==o&&(s+=a),n&&(n.verticalDistanceToGround=s,n.terrainElevation=u),s+u;case"relative-to-scene":u=e.getElevation(t,"scene")||0,s=r.calculateOffsetRenderUnits(i);return n&&(n.verticalDistanceToGround=s,n.terrainElevation=u),s+u;case"absolute-height":s=r.calculateOffsetRenderUnits(i);if(null==o&&(s+=a),n){u=e.getElevation(t,"ground")||0;n.verticalDistanceToGround=s-u,n.terrainElevation=u}return s;default:r.mode}return 0}function c(e,t,r,i,n,a){var s,l=0;if(e.metadata.usesVerticalDistanceToGround)l=d(n,t,r,a,x),o.updateVertexAttributeAuxpos1w(e,x.verticalDistanceToGround),s=x.terrainElevation;else{var c="absolute-height"!==r.mode;l=d(n,t,r,a,c?x:null),c&&(s=x.terrainElevation)}var h=e.getObjectTransformation();return y[0]=t.x,y[1]=t.y,y[2]=l,u.computeLinearTransformation(t.spatialReference,y,h,i)?e.setObjectTransformation(h):console.warn("Could not locate symbol object properly, it might be misplaced"),{terrainElevation:s}}function h(e,t){var r=i.pathsToTriangulationInfo(e,t);return{vertexData:r.position,polygons:r.polygons,outlines:r.outlines}}function p(e,t,r,i,n){t*=3,i*=3;for(var a=0;a<n;++a)r[i++]=e[t++],r[i++]=e[t++],r[i++]=e[t++]}function f(e,t,r,i,n,a,o){return u.bufferToBuffer(e,r,t,i,a,n,o)}function g(e,t,r){u.pointToVector(e,t,r)}function m(e,t){return!(e[0]>t[3]||e[0]<t[0]||e[1]>t[4]||e[1]<t[1])}function v(e,t){return!(t[0]>e[3]||t[3]<e[0]||t[1]>e[4]||t[4]<e[1])}Object.defineProperty(t,"__esModule",{value:!0});var y=s.vec3d.create(),_=s.mat4d.identity(),b=n.makeDehydratedPoint(0,0,0,null);t.createStageObjectForPoint=function(e,t,r,i,n,a,o,s,u,d,h){var p=t?t.length:0,f=this._context.clippingExtent;if(g(e,y,this._context.elevationProvider.spatialReference),f&&!m(y,f))return null;g(e,y,this._context.renderSpatialReference);for(var v=this._context.localOriginFactory.getOrigin(y),b=new l({castShadow:!1,metadata:{layerUid:s,graphicUid:u,usesVerticalDistanceToGround:!!d},idHint:o}),x=0;x<p;x++){var w=i?i[x]:_;b.addGeometry(t[x],r[x],w,n,v,h)}return{object:b,terrainElevation:c(b,e,a,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper).terrainElevation}},t.extendPointGraphicElevationContext=function(e,t,r){var i=e.elevationContext,a=r.spatialReference;g(t,y,a),i.centerPointInElevationSR=n.makeDehydratedPoint(y[0],y[1],t.hasZ?y[2]:0,a)},t.placePointOnGeometry=function(e){switch(e.type){case"point":return e;case"polygon":case"extent":return o.computeCentroid(e);case"polyline":var t=e.paths[0];if(!t||0===t.length)return null;var i=r.getPointOnPath(t,r.getPathLength(t)/2);return n.makeDehydratedPoint(i[0],i[1],i[2],e.spatialReference);case"mesh":return e.extent.center}return null},t.computeElevation=d,t.getSingleSizeDriver=function(e,t){return void 0===t&&(t=0),isFinite(e[t])?e[t]:null},t.copyPathData=h,t.copyVertices=p,t.chooseOrigin=function(e,t,r,i){var n=Math.floor(t+(r-1)/2);i[0]=e[3*n+0],i[1]=e[3*n+1],i[2]=e[3*n+2]},t.subtractCoordinates=function(e,t,r,i){t*=3;for(var n=0;n<r;++n)e[t++]-=i[0],e[t++]-=i[1],e[t++]-=i[2]},t.setZ=function(e,t,r,i){t*=3;for(var n=0;n<r;++n)e[t+2]=i,t+=3},t.offsetZ=function(e,t,r,i){t*=3;for(var n=0;n<r;++n)e[t+2]+=i,t+=3},t.scaleZ=function(e,t,r,i){t*=3;for(var n=0;n<r;++n)e[t+2]*=i,t+=3},t.flatArrayToArrayOfArrays=function(e,t,r){var i=[];t*=3;for(var n=0;n<r;++n)i.push([e[t++],e[t++],e[t++]]);return i},t.reproject=f,t.reprojectPoint=g,t.getGeometryVertexData3D=function(e,t,r,i,n,a,o){var s=n.spatialReference,u=h(e,t),l=u.vertexData,d=l.length/3,c=new Float64Array(l.length),g=!0;r.equals(s)?p(l,0,c,0,l.length):g=f(l,0,r,c,0,s,d);var m=function(e,t,r,i,n,a,o,s){var u=s.mode,l=0,d=0,c=0,h=s.calculateOffsetRenderUnits(o),p=s.featureExpressionInfoContext;b.spatialReference=e.spatialReference,r*=3,n*=3;for(var f=0;f<a;++f){switch(b.x=t[r+0],b.y=t[r+1],b.z=t[r+2],u){case"on-the-ground":d=l=e.getElevation(b)||0,c+=l;break;case"relative-to-ground":d=(l=e.getElevation(b)||0)+h,null==p&&(d+=b.z),c+=l;break;case"relative-to-scene":d=(l=e.getElevation(b,"scene")||0)+h,c+=l;break;case"absolute-height":d=h,null==p&&(d+=b.z)}i[n+0]=t[r+0],i[n+1]=t[r+1],i[n+2]=d,r+=3,n+=3}return{terrainElevation:c/=a}}(n,c,0,l,0,d,a,o);return s.equals(i)||f(l,0,s,l,0,i,d),{geometryData:u,vertexData:l,eleVertexData:c,terrainElevation:m.terrainElevation,projectionSuccess:g}},t.getGeometryVertexDataDraped=function(e,t,r){var i=h(e,!1),n=i.vertexData,a=n.length/3,o=!0;return t.equals(r)||(o=u.bufferToBuffer(n,t,0,n,r,0,a)),{geometryData:i,vertexData:n,projectionSuccess:o}},t.computeBoundingBox=function(e,t,r,i){i[0]=Number.MAX_VALUE,i[1]=Number.MAX_VALUE,i[2]=Number.MAX_VALUE,i[3]=-Number.MAX_VALUE,i[4]=-Number.MAX_VALUE,i[5]=-Number.MAX_VALUE,t*=3;for(var n=0;n<r;++n){var a=e[t++],o=e[t++],s=e[t++];a<i[0]&&(i[0]=a),o<i[1]&&(i[1]=o),s<i[2]&&(i[2]=s),a>i[3]&&(i[3]=a),o>i[4]&&(i[4]=o),s>i[5]&&(i[5]=s)}return i},t.pointInBox2D=m,t.boxesIntersect2D=v,t.boundingBoxClipped=function(e,t){return!!t&&!v(e,t)},t.needsElevationUpdates2D=function(e){return"relative-to-ground"===e||"relative-to-scene"===e},t.needsElevationUpdates3D=function(e){return"absolute-height"!==e},t.needsOffsetAdjustment=function(e,t,r,i){if(!1===t.needsOffsetAdjustment||!1===t.supportsOffsetAdjustment)return!1;if("on-the-ground"===e.mode)return!1;if(0===e.meterUnitOffset){if(!0===t.needsOffsetAdjustment)return!0;if(a.isCalloutSupport(i)&&i.hasVisibleVerticalOffset())return!1;if("relative-to-ground"===e.mode&&(!r.hasZ||e.featureExpressionInfoContext))return!0;if("relative-to-scene"===e.mode)return!0}return!1};var x={verticalDistanceToGround:0,terrainElevation:0}}.apply(null,i))||(e.exports=n)},595:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(e,t){void 0===e&&(e=[]),void 0===t&&(t=[]),this.lengths=e,this.coords=t}}();t.default=r}.apply(null,i))||(e.exports=n)},596:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1013),r(421),r(877),r(439),r(348),r(348)],void 0===(n=function(e,t,r,i,n,a,o,s){return function(){function e(t,r,i){this.singleUse=!1,this._boundingInfo=null,this._componentAABB=null,this.id=e.__idGen.gen(r),this._data=t,this._boundingInfo=i}return Object.defineProperty(e.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"componentCount",{get:function(){return i.componentCount(this.data.componentOffsets)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boundingInfo",{get:function(){return null==this._boundingInfo&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo},enumerable:!0,configurable:!0}),e.prototype.invalidateBoundingInfo=function(){this._boundingInfo=null},e.prototype.getComponentAABB=function(e,t){null==this._componentAABB&&(this._componentAABB=this._computeComponentAABB());for(var r=0;r<6;r++)t[r]=this._componentAABB[6*e+r];return t},e.prototype._computeComponentAABB=function(){for(var e=this.componentCount,t=new Float32Array(6*e),r=0;r<e;r++)this._calculateAABB(r,t,6*r);return t},e.prototype._calculateAABB=function(e,t,r){void 0===r&&(r=0);for(var i=this.data.getIndices(s.VertexAttrConstants.POSITION),n=this.data.getAttribute(s.VertexAttrConstants.POSITION),a=this.data.componentOffsets,o=a.length?a[e]:0,u=a.length?a[e+1]:i.length,l=1/0,d=1/0,c=1/0,h=-1/0,p=-1/0,f=-1/0,g=n.offsetIdx,m=n.strideIdx,v=o;v<u;v++){var y=g+m*i[v],_=n.data[y],b=n.data[y+1],x=n.data[y+2];l=Math.min(l,_),d=Math.min(d,b),c=Math.min(c,x),h=Math.max(h,_),p=Math.max(p,b),f=Math.max(f,x)}return t?(t[r]=l,t[r+1]=d,t[r+2]=c,t[r+3]=h,t[r+4]=p,t[r+5]=f):t=[l,d,c,h,p,f],t},e.prototype._calculateBoundingInfo=function(){var e=this.data.getIndices(s.VertexAttrConstants.POSITION),t=this.data.getAttribute(s.VertexAttrConstants.POSITION),i="triangle"===this.data.primitiveType?3:1;if(0===e.length){e=new Uint32Array(i);for(var a=0;a<i;++a)e[a]=a}var u=e.length;o.assert(u%i==0);var l=n.generateDefaultIndexArray(u/i);return new r(l,i,e,t)},e.__idGen=new a,e}()}.apply(null,i))||(e.exports=n)},601:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(345),r(335),r(346),r(336)],void 0===(n=function(e,t,r,i,n,a){return new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.SCENEVIEW_HITTEST_RETURN_SELECTOR=!1,t.SCENEVIEW_LOCKING_LOG=!1,t.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED=!1,t.HIGHLIGHTS_VISUALIZE_BLOCKS=!1,t.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1,t.DECONFLICTOR_SHOW_OUTLINES=!1,t.DECONFLICTOR_SHOW_GRID=!1,t.LABELS_SHOW_BORDER=!1,t.OVERLAY_DRAW_TEST_TEXTURE=!1,t.OVERLAY_SHOW_CENTER=!1,t.TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS=!1,t.DISABLE_POI_UPDATE_ON_SURFACE_GEOMETRY_CHANGES=!1,t.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES=!1,t.DRAW_MESH_GEOMETRY_NORMALS=!1,t.FEATURE_TILE_FETCH_SHOW_TILES=!1,t.FEATURE_TILE_TREE_SHOW_TILES=!1,t.ENABLE_PROFILE_DEPTH_RANGE=!1,t}return r(t,e),i([a.property()],t.prototype,"SCENEVIEW_HITTEST_RETURN_SELECTOR",void 0),i([a.property()],t.prototype,"SCENEVIEW_LOCKING_LOG",void 0),i([a.property()],t.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED",void 0),i([a.property()],t.prototype,"HIGHLIGHTS_VISUALIZE_BLOCKS",void 0),i([a.property()],t.prototype,"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0),i([a.property()],t.prototype,"DECONFLICTOR_SHOW_OUTLINES",void 0),i([a.property()],t.prototype,"DECONFLICTOR_SHOW_GRID",void 0),i([a.property()],t.prototype,"LABELS_SHOW_BORDER",void 0),i([a.property()],t.prototype,"OVERLAY_DRAW_TEST_TEXTURE",void 0),i([a.property()],t.prototype,"OVERLAY_SHOW_CENTER",void 0),i([a.property()],t.prototype,"TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS",void 0),i([a.property()],t.prototype,"DISABLE_POI_UPDATE_ON_SURFACE_GEOMETRY_CHANGES",void 0),i([a.property()],t.prototype,"DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES",void 0),i([a.property()],t.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),i([a.property()],t.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),i([a.property()],t.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),i([a.property()],t.prototype,"ENABLE_PROFILE_DEPTH_RANGE",void 0),i([a.subclass()],t)}(a.declared(n)))}.apply(null,i))||(e.exports=n)},603:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(e,t,r,i){void 0===e&&(e=null),void 0===t&&(t={}),this.geometry=e,this.attributes=t,r&&(this.centroid=r),null!=i&&(this.objectId=i)}}();t.default=r}.apply(null,i))||(e.exports=n)},617:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(342)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){return function(e,t,i){void 0===e&&(e=r.vec3d.create()),void 0===t&&(t=r.vec3d.createFrom(.57735,.57735,.57735)),void 0===i&&(i=!0),this.intensity=e,this.direction=t,this.castShadows=i}}();t.MainLight=i;var n=function(){return function(e,t){void 0===e&&(e=r.vec3d.create()),void 0===t&&(t=r.vec3d.createFrom(.57735,.57735,.57735)),this.intensity=r.vec3d.create(),this.direction=r.vec3d.create(),this.intensity=e,this.direction=t}}();t.FillLight=n;var a=function(){return function(e){void 0===e&&(e=r.vec3d.create()),this.intensity=e}}();t.AmbientLight=a;var o=function(){return function(){this.sh={r:[0],g:[0],b:[0]}}}();t.SphericalHarmonicsLight=o}.apply(null,i))||(e.exports=n)},618:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(369),r(393)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0}),t.blendLayers={name:"blend-layers",shaders:{vertexShader:i.resolveIncludes("misc/blendLayers.vert"),fragmentShader:i.resolveIncludes("misc/blendLayers.frag")},attributes:r.Default3D},t.simple={name:"simple",shaders:{vertexShader:i.resolveIncludes("misc/simple.vert"),fragmentShader:i.resolveIncludes("misc/simple.frag")},attributes:r.Default3D},t.texOnly={name:"tex-only",shaders:{vertexShader:i.resolveIncludes("misc/texOnly.vert"),fragmentShader:i.resolveIncludes("misc/texOnly.frag")},attributes:r.Default3D},t.showDepth={name:"show-depth",shaders:{vertexShader:i.resolveIncludes("misc/showDepth.vert"),fragmentShader:i.resolveIncludes("misc/showDepth.frag")},attributes:r.Default3D}}.apply(null,i))||(e.exports=n)},627:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(344),r(350),r(349),r(422),r(626),r(628),r(403)],void 0===(n=function(e,t,r,i,n,a,o,s,u){function l(e,t){var r=e.geometry,i=e.toJSON(),n=i;if(r&&(n.geometry=JSON.stringify(r),n.geometryType=a.getJsonType(r),n.inSR=r.spatialReference.wkid||JSON.stringify(r.spatialReference)),i.groupByFieldsForStatistics&&(n.groupByFieldsForStatistics=i.groupByFieldsForStatistics.join(",")),i.objectIds&&(n.objectIds=i.objectIds.join(",")),i.orderByFields&&(n.orderByFields=i.orderByFields.join(",")),!i.outFields||t&&(t.returnCountOnly||t.returnExtentOnly||t.returnIdsOnly)?delete n.outFields:-1!==i.outFields.indexOf("*")?n.outFields="*":n.outFields=i.outFields.join(","),i.outSR?n.outSR=i.outSR.wkid||JSON.stringify(i.outSR):r&&(i.returnGeometry||i.returnCentroid)&&(n.outSR=n.inSR),i.returnGeometry&&delete i.returnGeometry,i.outStatistics&&(n.outStatistics=JSON.stringify(i.outStatistics)),i.pixelSize&&(n.pixelSize=JSON.stringify(i.pixelSize)),i.quantizationParameters&&(n.quantizationParameters=JSON.stringify(i.quantizationParameters)),i.source&&(n.layer=JSON.stringify({source:i.source}),delete i.source),i.timeExtent){var o=i.timeExtent;n.time=[null!=o.startTime?o.startTime:"null",null!=o.endTime?o.endTime:"null"],delete i.timeExtent}return n}function d(e,t,a,s,d){void 0===s&&(s={});var c="string"==typeof e?n.urlToObject(e):e,h=t.geometry?[t.geometry]:[];return s.responseType="pbf"===a?"array-buffer":"json",o.normalizeCentralMeridian(h,null,s).then(function(e){var n=e&&e[0];n&&((t=t.clone()).geometry=n);var o=u.mapParameters(r({},c.query,{f:a},d,l(t,d)));return i(c.path+"/query",r({},s,{query:o}))})}Object.defineProperty(t,"__esModule",{value:!0});var c="Layer does not support extent calculation.";t.queryToQueryStringParameters=l,t.executeQuery=function(e,t,r){return d(e,t,"json",r)},t.executeQueryPBF=function(e,t,r){return d(e,t,"pbf",r).then(function(e){var t=s.parsePBFFeatureQuery(e.data),r=e;return r.data=t,r})},t.executeQueryForIds=function(e,t,r){return d(e,t,"json",r,{returnIdsOnly:!0})},t.executeQueryForCount=function(e,t,r){return d(e,t,"json",r,{returnIdsOnly:!0,returnCountOnly:!0})},t.executeQueryForExtent=function(e,t,r){return d(e,t,"json",r,{returnExtentOnly:!0,returnCountOnly:!0}).then(function(e){var t=e.data;if(t.hasOwnProperty("extent"))return e;if(t.features)throw new Error(c);if(t.hasOwnProperty("count"))throw new Error(c);return e})}}.apply(null,i))||(e.exports=n)},628:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(341),r(343),r(425),r(629)],void 0===(n=function(e,t,r,i,n,a){Object.defineProperty(t,"__esModule",{value:!0});var o=i.getLogger("esri.tasks.operations.pbfQueryUtils");t.parsePBFFeatureQuery=function(e){try{var t=a.parseFeatureQuery(e).queryResult.featureResult;if(t&&t.features&&t.features.length&&t.objectIdFieldName)for(var i=t.objectIdFieldName,s=0,u=t.features;s<u.length;s++){var l=u[s];l.attributes&&(l.objectId=l.attributes[i])}return t}catch(e){var d=new r("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:e});return o.error(d),new n.default}}}.apply(null,i))||(e.exports=n)},629:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(593),r(603),r(425),r(595)],void 0===(n=function(e,t,r,i,n,a){function o(e){return e>=w.length?null:w[e]}function s(e){return e>=S.length?null:S[e]}function u(e){return e>=O.length?null:O[e]}function l(e){return e>=T.length?null:T[e]}function d(e){for(var t=new a.default,r=t.coords;e.next();)switch(e.tag()){case 3:for(var i=e.getUInt32(),n=e.pos()+i,o=0;e.pos()<n;)r[o++]=e.getSInt64();break;case 1:case 2:default:e.skip()}return t}function c(e){for(var t=new a.default,r=t.coords,i=t.lengths;e.next();)switch(e.tag()){case 2:for(var n=e.getUInt32(),o=e.pos()+n;e.pos()<o;)i.push(e.getUInt32());break;case 3:for(var s=e.getUInt32(),u=(o=e.pos()+s,0);e.pos()<o;)r[u++]=e.getSInt64();break;case 1:default:e.skip()}return t}function h(e){for(;e.next();)switch(e.tag()){case 1:return e.getString();case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getSInt32();case 5:return e.getUInt32();case 6:return e.getInt64();case 7:return e.getUInt64();case 8:return e.getSInt64();case 9:return e.getBool();default:return e.skip(),null}return null}function p(e){for(var t={type:o(0)};e.next();)switch(e.tag()){case 1:t.name=e.getString();break;case 2:t.type=o(e.getEnum());break;case 3:t.alias=e.getString();break;case 4:t.sqlType=s(e.getEnum());break;case 5:case 6:default:e.skip()}return t}function f(e,t){for(var r=new i.default,n=0;e.next();)switch(e.tag()){case 1:var a=e.getMessage(),o=t[n++].name;r.attributes[o]=h(a);break;case 2:r.geometry=c(e.getMessage());break;case 4:r.centroid=d(e.getMessage());break;default:e.skip()}return r}function g(e){for(var t=[0,0];e.next();)switch(e.tag()){case 1:t[0]=e.getDouble();break;case 2:t[1]=e.getDouble();break;case 3:case 4:t.push(e.getDouble());break;default:e.skip()}return t}function m(e){for(var t=[0,0];e.next();)switch(e.tag()){case 1:t[0]=e.getDouble();break;case 2:t[1]=e.getDouble();break;case 3:case 4:t.push(e.getDouble());break;default:e.skip()}return t}function v(e){for(var t={originPosition:u(0)};e.next();)switch(e.tag()){case 1:t.originPosition=u(e.getEnum());break;case 2:t.scale=g(e.getMessage());break;case 3:t.translate=m(e.getMessage());break;default:e.skip()}return t}function y(e){for(var t={};e.next();)switch(e.tag()){case 1:t.shapeAreaFieldName=e.getString();break;case 2:t.shapeLengthFieldName=e.getString();break;case 3:t.units=e.getString();break;default:e.skip()}return t}function _(e){for(var t={};e.next();)switch(e.tag()){case 1:t.wkid=e.getUInt32();break;case 5:t.wkt=e.getString();break;case 2:case 3:case 4:default:e.skip()}return t}function b(e){var t=new n.default;for(t.geometryType=l(0);e.next();)switch(e.tag()){case 1:t.objectIdFieldName=e.getString();break;case 3:t.globalIdFieldName=e.getString();break;case 4:t.geohashFieldName=e.getString();break;case 5:t.geometryProperties=y(e.getMessage());break;case 7:t.geometryType=l(e.getEnum());break;case 8:t.spatialReference=_(e.getMessage());break;case 10:t.hasZ=e.getBool();break;case 11:t.hasM=e.getBool();break;case 12:var r=e.getMessage();t.transform=v(r);break;case 9:var i=e.getBool();t.exceededTransferLimit=i;break;case 13:var a=e.getMessage();t.fields.push(p(a));break;case 15:var o=e.getMessage();t.features.push(f(o,t.fields));break;case 2:case 6:default:e.skip()}return t}function x(e){for(var t={};e.next();)switch(e.tag()){case 1:t.featureResult=b(e.getMessage());break;default:e.skip()}return t}Object.defineProperty(t,"__esModule",{value:!0});var w=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML"],S=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],T=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"],O=["upperLeft","lowerLeft"];t.parseFeatureQuery=function(e){for(var t=new r(new Uint8Array(e),new DataView(e)),i={};t.next();)switch(t.tag()){case 2:i.queryResult=x(t.getMessage());break;default:t.skip()}return i}}.apply(null,i))||(e.exports=n)},630:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(342),r(604),r(359),r(348)],void 0===(n=function(e,t,r,i,n,a){function o(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2],a=t[3]-e[3];return r*r+i*i+n*n+a*a}function s(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function u(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}var l=function(){function e(e,t,n){this._viewUp=r.vec3d.create(),this._viewForward=r.vec3d.create(),this._viewRight=r.vec3d.create(),this._viewport=r.vec4d.create(),this._padding=r.vec4d.create(),this._fov=55/180*Math.PI,this._near=0,this._far=1e3,this._viewDirty=!0,this._viewMatrix=r.mat4d.create(),this._projectionDirty=!0,this._projectionMatrix=r.mat4d.create(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=r.mat4d.create(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=r.mat4d.create(),this._frustumPlanesDirty=!0,this._frustumPlanes=[i.plane.create(),i.plane.create(),i.plane.create(),i.plane.create(),i.plane.create(),i.plane.create()],this._fullViewport=null,this.relativeElevation=0,this._eye=r.vec3d.create(e),this._center=r.vec3d.create(t),this._up=void 0!==n?r.vec3d.create(n):r.vec3d.create([0,0,1]),this._padding=r.vec4d.create()}return Object.defineProperty(e.prototype,"eye",{get:function(){return this._eye},set:function(e){this._compareAndSetView(e,this._eye)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"center",{get:function(){return this._center},set:function(e){this._compareAndSetView(e,this._center)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"up",{get:function(){return this._up},set:function(e){this._compareAndSetView(e,this._up)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewMatrix",{get:function(){return this._ensureViewClean(),this._viewMatrix},set:function(e){r.mat4d.set(e,this._viewMatrix),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumPlanesDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewForward",{get:function(){return this._ensureViewClean(),this._viewForward},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewUp",{get:function(){return this._ensureViewClean(),this._viewUp},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewRight",{get:function(){return this._ensureViewClean(),this._viewRight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"near",{get:function(){return this._near},set:function(e){this._near!==e&&(this._near=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumPlanesDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"far",{get:function(){return this._far},set:function(e){this._far!==e&&(this._far=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumPlanesDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewport",{get:function(){return this._viewport},set:function(e){this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this._viewport[0]},set:function(e){e+=this._padding[3],this._viewport[0]!==e&&(this._viewport[0]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumPlanesDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._viewport[1]},set:function(e){e+=this._padding[2],this._viewport[1]!==e&&(this._viewport[1]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumPlanesDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._viewport[2]},set:function(e){this._viewport[2]!==e&&(this._viewport[2]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumPlanesDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._viewport[3]},set:function(e){this._viewport[3]!==e&&(this._viewport[3]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumPlanesDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullWidth",{get:function(){return this._viewport[2]+this._padding[1]+this._padding[3]},set:function(e){this.width=e-(this._padding[1]+this._padding[3])},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullHeight",{get:function(){return this._viewport[3]+this._padding[0]+this._padding[2]},set:function(e){this.height=e-(this._padding[0]+this._padding[2])},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullViewport",{get:function(){return this._fullViewport||(this._fullViewport=r.vec4d.create()),this._fullViewport[0]=this._viewport[0]-this._padding[3],this._fullViewport[1]=this._viewport[1]-this._padding[2],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"aspect",{get:function(){return this.width/this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"padding",{get:function(){return this._padding},set:function(e){this._padding[0]===e[0]&&this._padding[1]===e[1]&&this._padding[2]===e[2]&&this._padding[3]===e[3]||(this._viewport[0]+=e[3]-this._padding[3],this._viewport[1]+=e[2]-this._padding[2],this._viewport[2]-=e[1]+e[3]-(this._padding[1]+this._padding[3]),this._viewport[3]-=e[0]+e[2]-(this._padding[0]+this._padding[2]),r.vec4d.set(e,this._padding),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumPlanesDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewProjectionMatrix",{get:function(){return this._viewProjectionDirty&&(r.mat4d.multiply(this.projectionMatrix,this.viewMatrix,this._viewProjectionMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"projectionMatrix",{get:function(){if(this._projectionDirty){var e=this.width,t=this.height,i=this.near*Math.tan(this.fovY/2),n=i*this.aspect;r.mat4d.frustum(-n*(1+2*this._padding[3]/e),n*(1+2*this._padding[1]/e),-i*(1+2*this._padding[2]/t),i*(1+2*this._padding[0]/t),this.near,this.far,this._projectionMatrix),this._projectionDirty=!1}return this._projectionMatrix},set:function(e){r.mat4d.set(e,this._projectionMatrix),this._projectionDirty=!1,this._viewProjectionDirty=!0,this._frustumPlanesDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fov",{get:function(){return this._fov},set:function(e){this._fov=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumPlanesDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fovX",{get:function(){return a.fovd2fovx(this._fov,this.width,this.height)},set:function(e){this._fov=a.fovx2fovd(e,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumPlanesDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fovY",{get:function(){return a.fovd2fovy(this._fov,this.width,this.height)},set:function(e){this._fov=a.fovy2fovd(e,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumPlanesDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distance",{get:function(){return r.vec3d.dist(this._center,this._eye)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frustumPoints",{get:function(){return this.computeFrustumPoints()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frustumPlanes",{get:function(){return this._frustumPlanesDirty&&(this._frustumPlanes=this._computeFrustumPlanes(this._frustumPlanes),this._frustumPlanesDirty=!1),this._frustumPlanes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewInverseTransposeMatrix",{get:function(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(this._viewInverseTransposeMatrix||(this._viewInverseTransposeMatrix=r.mat4d.create()),r.mat4d.inverse(this.viewMatrix,this._viewInverseTransposeMatrix),r.mat4d.transpose(this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"perPixelRatio",{get:function(){return Math.tan(this.fovX/2)/this.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"aboveGround",{get:function(){return this.relativeElevation>=0},enumerable:!0,configurable:!0}),e.prototype.copyFrom=function(e){return r.vec3d.set(e._eye,this._eye),r.vec3d.set(e._center,this._center),r.vec3d.set(e._up,this._up),r.vec4d.set(e._viewport,this._viewport),r.vec4d.set(e._padding,this._padding),this._near=e._near,this._far=e._far,this._fov=e._fov,this.relativeElevation=e.relativeElevation,e._viewDirty?this._viewDirty=!0:(r.mat4d.set(e._viewMatrix,this._viewMatrix),r.vec3d.set(e._viewRight,this._viewRight),r.vec3d.set(e._viewUp,this._viewUp),r.vec3d.set(e._viewForward,this._viewForward),this._viewDirty=!1),e._projectionDirty?this._projectionDirty=!0:(r.mat4d.set(e._projectionMatrix,this._projectionMatrix),this._projectionDirty=!1),this._viewProjectionDirty=!0,e._frustumPlanesDirty?this._frustumPlanesDirty=!0:(e.copyFrustumPlanes(this._frustumPlanes),this._frustumPlanesDirty=!1),e._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(this._viewInverseTransposeMatrix?r.mat4d.set(e._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix):this._viewInverseTransposeMatrix=r.mat4d.create(e._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),e._fullViewport?this._fullViewport?r.vec4d.set(e._fullViewport,this._fullViewport):this._fullViewport=r.vec4d.create(e._fullViewport):this._fullViewport=null,this},e.prototype.copyViewFrom=function(e){this.eye=e.eye,this.center=e.center,this.up=e.up},e.prototype.copy=function(){var t=new e;return t.copyFrom(this),t},e.prototype.equivalent=function(e){return s(this._eye,e._eye)&&s(this._center,e._center)&&s(this._up,e._up)&&u(this._viewport,e._viewport)&&u(this._padding,e._padding)&&this._near===e._near&&this._far===e._far&&this._fov===e._fov},e.prototype.almostEquals=function(e,t,i){void 0===i&&(i=!1);var n,a=r.vec3d.dist(this._eye,this._center)*(t||5e-4),s=a*a;return i?(r.vec3d.direction(e._center,e._eye,h),r.vec3d.direction(this._center,this._eye,p),n=1e-10):(r.vec3d.set(e._center,h),r.vec3d.set(this._center,p),n=s),r.vec3d.dist2(e._eye,this._eye)<s&&r.vec3d.dist2(h,p)<n&&Math.abs(e._fov-this._fov)<.001&&o(e._padding,this._padding)<.5&&o(e._viewport,this._viewport)<.5},e.prototype.markViewDirty=function(){this._viewDirty=!0,this._frustumPlanesDirty=!0,this._viewProjectionDirty=!0},e.prototype.computePixelSizeAt=function(e){return this.computePixelSizeAtDist(r.vec3d.dist(e,this._eye))},e.prototype.computePixelSizeAtDist=function(e){return 2*e*Math.tan(this.fovX/2)/this.width},e.prototype.computeDistanceFromRadius=function(e,t){return e/Math.tan(Math.min(this.fovX,this.fovY)/(2*(t||1)))},e.prototype.copyFrustumPlanes=function(e){if(!e){e=new Array(6);for(var t=0;t<6;++t)e[t]=r.vec4d.create()}var i=this.frustumPlanes;for(t=0;t<6;t++)r.vec4d.set(i[t],e[t]);return e},e.prototype.computeFrustumPoints=function(e){if(!e){e=new Array(8);for(var t=0;t<8;++t)e[t]=r.vec3d.create()}return a.matrixToFrustumPoints(this.viewMatrix,this.projectionMatrix,e),e},e.prototype.setGLViewport=function(e){var t=this.viewport,r=this.padding;e.setViewport(t[0]-r[3],t[1]-r[2],t[2]+r[1]+r[3],t[3]+r[0]+r[2])},e.prototype.applyProjection=function(e,t,i){void 0===i&&(i=!1),e!==d&&r.vec3d.set(e,d),d[3]=1,i&&(t[2]=-d[2]),r.mat4d.multiplyVec4(this.projectionMatrix,d),r.vec3d.scale(d,1/Math.abs(d[3]));var a=this.fullViewport;return t[0]=n.lerp(0,a[0]+a[2],.5+.5*d[0]),t[1]=n.lerp(0,a[1]+a[3],.5+.5*d[1]),i||(t[2]=.5*(d[2]+1)),t},e.prototype.projectPoint=function(e,t){d[0]=e[0],d[1]=e[1],d[2]=e[2],d[3]=1,r.mat4d.multiplyVec4(this.viewProjectionMatrix,d),r.vec3d.scale(d,1/Math.abs(d[3]));var i=this.fullViewport;return t[0]=n.lerp(0,i[0]+i[2],.5+.5*d[0]),t[1]=n.lerp(0,i[1]+i[3],.5+.5*d[1]),t[2]=.5*(d[2]+1),t},e.prototype.unprojectPoint=function(e,t,i){if(void 0===i&&(i=!1),i)return console.error("Camera.unprojectPoint() not yet implemented for linear Z"),null;if(r.mat4d.multiply(this.projectionMatrix,this.viewMatrix,c),!r.mat4d.inverse(c))return null;var n=this.fullViewport;return d[0]=2*(e[0]-n[0])/n[2]-1,d[1]=2*(e[1]-n[1])/n[3]-1,d[2]=2*e[2]-1,d[3]=1,r.mat4d.multiplyVec4(c,d),0===d[3]?null:(t[0]=d[0]/d[3],t[1]=d[1]/d[3],t[2]=d[2]/d[3],t)},e.prototype.computeUp=function(e){"global"===e?this.computeUpGlobal():this.computeUpLocal()},e.prototype.computeUpGlobal=function(){r.vec3d.subtract(this.center,this.eye,h);var e=r.vec3d.length(this.center);e<1?(r.vec3d.set3(0,0,1,this.up),this.markViewDirty()):Math.abs(r.vec3d.dot(h,this.center))>.9999*r.vec3d.length(h)*e||(r.vec3d.cross(h,this.center,this.up),r.vec3d.cross(this.up,h,this.up),r.vec3d.normalize(this.up),this.markViewDirty())},e.prototype.computeUpLocal=function(){r.vec3d.direction(this.center,this.eye,h),Math.abs(h[2])<=.9999&&(r.vec3d.scale(h,h[2]),r.vec3d.set3(-h[0],-h[1],1-h[2],this.up),r.vec3d.normalize(this.up),this.markViewDirty())},e.prototype._compareAndSetView=function(e,t){s(e,t)||(r.vec3d.set(e,t),this._viewDirty=!0,this._frustumPlanesDirty=!0,this._viewProjectionDirty=!0)},e.prototype._computeFrustumPlanes=function(e){if(!e){e=new Array(6);for(var t=0;t<6;++t)e[t]=i.plane.create()}return a.matrixToFrustumPlanes(this.viewMatrix,this.projectionMatrix,e),e},e.prototype._ensureViewClean=function(){this._viewDirty&&(r.mat4d.lookAt(this._eye,this._center,this._up,this._viewMatrix),r.vec3d.set3(-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10],this._viewForward),r.vec3d.set3(this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9],this._viewUp),r.vec3d.set3(this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8],this._viewRight),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)},e}(),d=r.vec4d.create(),c=r.mat4d.create(),h=r.vec3d.create(),p=r.vec3d.create();return l}.apply(null,i))||(e.exports=n)},632:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(350)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.dataURItoBlob=function(e){for(var t=atob(e.split(",")[1]),r=e.split(",")[0].split(":")[1].split(";")[0],i=new ArrayBuffer(t.length),n=new Uint8Array(i),a=0;a<t.length;a++)n[a]=t.charCodeAt(a);return new Blob([i],{type:r})},t.requestImage=function(e){return r(e,{responseType:"image"}).then(function(e){return e.data})}}.apply(null,i))||(e.exports=n)},633:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(345),r(353),r(397),r(342),r(650),r(727),r(636),r(410),r(348),r(656),r(420),r(420),r(861)],void 0===(n=function(e,t,r,i,n,a,o,s,u,l,d,c,h,p,f){function g(e,t,r){!function(e,t){return!e.slicePlaneEnabled&&(e.cullFace?"none"!==e.cullFace:!e.transparent&&!e.doubleSided)}(t)?e.setFaceCullingEnabled(!1):(e.setFaceCullingEnabled(!0),"front"===t.cullFace?e.setCullFace(1028):e.setCullFace(1029))}function m(e){e.setFaceCullingEnabled(!1)}function v(e,t){return e?l.TRANSPARENT_MATERIAL:t?l.STENCIL_MATERIAL:l.OPAQUE_MATERIAL}function y(e,t){var r=t.vvSizeEnabled;t.vvSizeEnabled?(e.setUniform3fv("vvSizeMinSize",t.vvSizeMinSize),e.setUniform3fv("vvSizeMaxSize",t.vvSizeMaxSize),e.setUniform3fv("vvSizeOffset",t.vvSizeOffset),e.setUniform3fv("vvSizeFactor",t.vvSizeFactor)):r&&e.setUniform3fv("vvSizeValue",t.vvSizeValue),r&&(e.setUniform3fv("vvSymbolAnchor",t.vvSymbolAnchor),n.computeObjectRotation(t.vvSymbolRotation[2],t.vvSymbolRotation[0],t.vvSymbolRotation[1],a.mat4d.identity(I)),e.setUniformMatrix3fv("vvSymbolRotation",a.mat4d.toMat3(I,E))),t.vvColorEnabled&&(e.setUniform1fv("vvColorValues",t.vvColorValues),e.setUniform4fv("vvColorColors",t.vvColorColors))}var _=d.assert,b=1,x=function(e){function t(r,i){var n=e.call(this,i)||this;return n.supportsEdges=!0,n.params=p.copyParameters(r,M),n.instanced=!!r.instanced,n.vertexBufferLayout=t.getVertexBufferLayout(n.params),n.instanceBufferLayout=n.instanced?t.getInstanceBufferLayout(n.params):null,n.bufferWriter=new R(n.vertexBufferLayout,n.instanceBufferLayout),n}return r(t,e),t.prototype.isVisible=function(){var t=this.params;if(!e.prototype.isVisible.call(this)||0===t.layerOpacity)return!1;var r=t.instanced,i=t.vertexColors,n=t.symbolColors,a=!!r&&r.indexOf("color")>-1,o=t.vvColorEnabled,s="replace"===t.colorMixMode,u=t.opacity>0,l=t.externalColor&&t.externalColor[3]>0;return i&&(a||o||n)?!!s||u:i?s?l:u:a||o||n?!!s||u:s?l:u},t.prototype.getParams=function(){return this.params},t.prototype.getParameterValues=function(){return p.copyParameters(this.params)},t.prototype.setParameterValues=function(e){var t=this.params;for(var r in e)"textureId"===r&&_(t.textureId,"Can only change texture of material that already has a texture"),"castShadows"===r&&_(e.castShadows===t.castShadows,"Can not change shadow casting behavior."),t[r]=e[r];this.notifyDirty("matChanged")},t.prototype.intersect=function(e,t,r,i,n,o,s,u){if(null!==this.params.verticalOffset){var l=i.camera;a.vec3d.set3(r[12],r[13],r[14],j);var d=a.vec3d.subtract(j,l.eye,U),c=a.vec3d.length(d),h=a.vec3d.scale(d,1/c),f=null,g=null;switch(i.viewingMode){case"global":g=a.vec3d.normalize(j,L);break;case"local":g=a.vec3d.set(F,L)}this.params.screenSizePerspective&&(f=a.vec3d.dot(g,h));var m=p.verticalOffsetAtDistance(l,c,this.params.verticalOffset,f,this.params.screenSizePerspective);a.vec3d.scale(g,m),a.mat3d.multiplyVec3(i.transformInverseRotation,g,N),n=a.vec3d.subtract(n,N,A),o=a.vec3d.subtract(o,N,D)}p.intersectTriangleGeometry(e,t,r,i,n,o,s)},t.prototype.getGLMaterials=function(){return{color:w,depthShadowMap:this.params.castShadows?T:null,normal:O,depth:S,highlight:C}},t.prototype.getAllTextureIds=function(){return this.params.textureId?[this.params.textureId]:[]},t.getVertexBufferLayout=function(e){var t=o.newLayout().vec3f("position");return e.groundNormalShading||(t=e.compressedNormals?t.vec2i16("normalCompressed",{glNormalized:!0}):t.vec3f("normal")),e.textureId&&(t=t.vec2f("uv0"),e.atlasRegions&&(t=t.vec4u16("region",{glNormalized:!0}))),e.vertexColors&&(t=t.vec4u8("color")),e.symbolColors&&(t=t.vec4u8("symbolColor")),e.componentIndices&&(t=t.u16("componentIndex").u16("_padding",{glPadding:!0})),t},t.getInstanceBufferLayout=function(e){var t=o.newLayout();return t=e.instancedDoublePrecision?t.vec3f("modelOriginHi").vec3f("modelOriginLo").mat3f("model").mat3f("modelNormal"):t.mat4f("model").mat4f("modelNormal"),e.instanced&&e.instanced.indexOf("color")>-1&&(t=t.vec4f("instanceColor")),e.instanced&&e.instanced.indexOf("featureAttribute")>-1&&(t=t.vec4f("instanceFeatureAttribute")),t},t}(u),w=function(e){function t(t,r,i){var n=this,a=t.getParams();(n=e.call(this,t,r,i,a.textureId,a.textureInitTransparent)||this).params=p.copyParameters(a);var o=n.params;n.slot=v(o.transparent,o.writeStencil),n.texturing=o.textureId?o.atlasRegions?"AtlasTextured":"Textured":"none";var s=o.instanced;return n.instanced=!!s,n.instancedColor=!!s&&s.indexOf("color")>-1,n._createPrograms(),n}return r(t,e),t.prototype._createPrograms=function(){var e=this;this.programs=h.BindParametersMap.create(this.params,function(t){return e._createProgram(t)})},t.prototype._createProgram=function(e){var t=this.params;return this.programRep.getProgram(f.colorPass,{viewingMode:this.programRep.globalOptions.viewingMode,textureMode:this.texturing,vertexColors:t.vertexColors,symbolColors:t.symbolColors,flipV:t.flipV,doubleSided:t.doubleSided&&"normal"===t.doubleSidedType,windowOrderDoubleSided:t.doubleSided&&"winding-order"===t.doubleSidedType,instanced:!!this.instanced,instancedDoublePrecision:t.instancedDoublePrecision,instancedColor:this.instancedColor,receiveShadows:e.receiveShadows,receiveSSAO:e.receiveSSAO,vvSize:t.vvSizeEnabled,vvColor:t.vvColorEnabled,verticalOffset:null!==t.verticalOffset,screenSizePerspective:null!==t.screenSizePerspective,slice:t.slicePlaneEnabled,groundNormalShading:t.groundNormalShading,compressedNormals:t.compressedNormals,componentColor:null!=t.componentColorBuffer,transparencyDiscard:t.transparent,alphaCoverageCorrection:P})},t.prototype.beginSlot=function(e){return e===this.slot},t.prototype.getProgram=function(){return this.program||this.getPrograms()[0]},t.prototype.getPrograms=function(){return h.BindParametersMap.programs(this.programs)},t.prototype.updateParameters=function(){this.params=this.material.getParameterValues(),this.slot=v(this.params.transparent,this.params.writeStencil),this.updateTexture(this.params.textureId),this._createPrograms()},t.prototype.bind=function(e,t){var r=this.params,i=this.program=h.BindParametersMap.lookup(this.programs,t);e.bindProgram(i),i.setUniform3fv("ambient",r.ambient),i.setUniform3fv("diffuse",r.diffuse),i.setUniform3fv("specular",r.specular),i.setUniform4fv("externalColor",r.externalColor),i.setUniform1i("colorMixMode",p.colorMixModes[r.colorMixMode]),i.setUniform1f("opacity",r.opacity),i.setUniform1f("layerOpacity",r.layerOpacity),p.bindVerticalOffset(r.verticalOffset,t,i),p.bindScreenSizePerspective(r.screenSizePerspective,t,i),y(i,r),this.bindTexture(e,i),"none"!==this.texturing&&this.bindTextureSize(e,i),e.setBlendFunctionSeparate(770,771,1,771),r.inverseWindingOrder&&e.setFrontFace(2304),r.transparent?(e.setBlendingEnabled(!0),r.blendModeOneOne?(e.setBlendFunction(1,1),e.setDepthWriteEnabled(!1)):e.setBlendFunctionSeparate(770,771,1,771)):e.setBlendingEnabled(!1),r.polygonOffset&&(e.setPolygonOffsetFillEnabled(!0),e.setPolygonOffset(2,2)),g(e,r),e.setDepthTestEnabled(!0),r.componentIndices&&r.componentColorBuffer&&(r.componentColorBuffer.updateTexture(),r.componentColorBuffer.bind(i,{texName:"uComponentColorTex",invDimName:"uComponentColorTexInvDim",unit:b}))},t.prototype.release=function(e,t){e.setPolygonOffsetFillEnabled(!1),m(e),e.setBlendingEnabled(!1),e.setBlendFunctionSeparate(770,771,1,771),e.setDepthWriteEnabled(!0),e.setFrontFace(2305)},t.prototype.bindView=function(e,t){var r=this.program=h.BindParametersMap.lookup(this.programs,t),i=this.params,n=i.instancedDoublePrecision?[t.viewInvTransp[3],t.viewInvTransp[7],t.viewInvTransp[11]]:t.origin;p.bindView(n,t.view,r),p.bindCamPos(n,t.viewInvTransp,r),i.instancedDoublePrecision&&p.bindViewOriginDouble(n,r),i.slicePlaneEnabled&&p.bindSlicePlane(n,t.slicePlane,r),t.shadowMappingEnabled&&t.shadowMap.bindView(r,n)},t.prototype.bindInstance=function(e,t){var r=this.program;r.setUniformMatrix4fv("model",t.transformation),r.setUniformMatrix4fv("modelNormal",t.transformationNormal)},t.prototype.getDrawMode=function(e){return 4},t}(s),S=function(e){function t(t,r,i,n){void 0===n&&(n=!1);var a=e.call(this,t,r,i,t.getParams().textureId)||this;return a.params=p.copyParameters(t.getParams()),a.instanced=!!a.params.instanced,a.texturing=t.bufferWriter.vertexBufferLayout.hasField("uv0")?a.params.atlasRegions?"AtlasTextured":"Textured":"none",a.biased=n,a.selectProgram(),a.selectSlot(),a}return r(t,e),t.prototype.beginSlot=function(e){return e===this.slot},t.prototype.getProgram=function(){return this.program},t.prototype.selectProgram=function(){this.program=this.programRep.getProgram(f.depthPass,{viewingMode:this.programRep.globalOptions.viewingMode,textureMode:this.texturing,flipV:this.params.flipV,instanced:this.instanced,instancedDoublePrecision:this.params.instancedDoublePrecision,shadowMap:this.biased,vvSize:this.params.vvSizeEnabled,verticalOffset:null!==this.params.verticalOffset,screenSizePerspective:null!==this.params.screenSizePerspective,slice:this.params.slicePlaneEnabled,transparencyDiscard:this.params.transparent,alphaCoverageCorrection:P})},t.prototype.selectSlot=function(){this.slot=v(this.params.transparent,this.params.writeStencil)},t.prototype.updateParameters=function(){this.params=this.material.getParameterValues(),this.selectProgram(),this.selectSlot(),this.updateTexture(this.params.textureId)},t.prototype.bind=function(e,t){var r=this.program,i=this.params;e.bindProgram(r),r.setUniform2fv("nearFar",t.nearFar),i.inverseWindingOrder&&e.setFrontFace(2304),p.bindVerticalOffset(i.verticalOffset,t,r),p.bindScreenSizePerspective(i.screenSizePerspective,t,r),y(r,i),this.bindTexture(e,r),g(e,i),e.setDepthTestEnabled(!0)},t.prototype.release=function(e){var t=this.params;m(e),t.inverseWindingOrder&&e.setFrontFace(2305)},t.prototype.bindView=function(e,t){var r=this.program,i=this.params,n=i.instancedDoublePrecision?[t.viewInvTransp[3],t.viewInvTransp[7],t.viewInvTransp[11]]:t.origin;p.bindView(n,t.view,r),i.slicePlaneEnabled&&p.bindSlicePlane(t.origin,t.slicePlane,r),i.screenSizePerspective&&p.bindCamPos(n,t.viewInvTransp,r),i.instancedDoublePrecision&&p.bindViewOriginDouble(n,r)},t.prototype.bindInstance=function(e,t){this.program.setUniformMatrix4fv("model",t.transformation)},t.prototype.getDrawMode=function(e){return 4},t}(s),T=function(e){function t(t,r,i){return e.call(this,t,r,i,!0)||this}return r(t,e),t}(S),O=function(e){function t(t,r,i,n){void 0===n&&(n=!1);var a=e.call(this,t,r,i,t.getParams().textureId)||this;return a.params=p.copyParameters(t.getParams()),a.instanced=!!a.params.instanced,a.texturing=t.bufferWriter.vertexBufferLayout.hasField("uv0")?a.params.atlasRegions?"AtlasTextured":"Textured":"none",a.selectProgram(),a.selectSlot(),a}return r(t,e),t.prototype.beginSlot=function(e){return e===this.slot},t.prototype.getProgram=function(){return this.program},t.prototype.selectProgram=function(){this.program=this.programRep.getProgram(f.normalPass,{viewingMode:this.programRep.globalOptions.viewingMode,textureMode:this.texturing,flipV:this.params.flipV,instanced:this.instanced,instancedDoublePrecision:this.params.instancedDoublePrecision,vvSize:this.params.vvSizeEnabled,verticalOffset:null!==this.params.verticalOffset,screenSizePerspective:null!==this.params.screenSizePerspective,slice:this.params.slicePlaneEnabled,compressedNormals:this.params.compressedNormals,transparencyDiscard:this.params.transparent,alphaCoverageCorrection:P})},t.prototype.selectSlot=function(){this.slot=v(this.params.transparent,this.params.writeStencil)},t.prototype.updateParameters=function(){this.params=this.material.getParameterValues(),this.selectProgram(),this.selectSlot(),this.updateTexture(this.params.textureId)},t.prototype.bind=function(e,t){var r=this.program,i=this.params;e.bindProgram(r),this.bindTexture(e,r),p.bindVerticalOffset(i.verticalOffset,t,r),p.bindScreenSizePerspective(i.screenSizePerspective,t,r),y(r,i),g(e,i),i.inverseWindingOrder&&e.setFrontFace(2304),e.setDepthTestEnabled(!0)},t.prototype.release=function(e){var t=this.params;m(e),t.inverseWindingOrder&&e.setFrontFace(2305)},t.prototype.bindView=function(e,t){var r=this.program,i=this.params,n=i.instancedDoublePrecision?[t.viewInvTransp[3],t.viewInvTransp[7],t.viewInvTransp[11]]:t.origin;p.bindView(n,t.view,r),r.setUniformMatrix4fv("viewNormal",t.viewInvTransp),i.slicePlaneEnabled&&p.bindSlicePlane(t.origin,t.slicePlane,r),i.screenSizePerspective&&p.bindCamPos(n,t.viewInvTransp,r),i.instancedDoublePrecision&&p.bindViewOriginDouble(n,r)},t.prototype.bindInstance=function(e,t){var r=this.program;r.setUniformMatrix4fv("model",t.transformation),r.setUniformMatrix4fv("modelNormal",t.transformationNormal)},t.prototype.getDrawMode=function(e){return 4},t}(s),C=function(e){function t(t,r,i,n){void 0===n&&(n=!1);var a=e.call(this,t,r,i,t.getParams().textureId)||this;return a.params=p.copyParameters(t.getParams()),a.instanced=!!a.params.instanced,a.texturing=t.bufferWriter.vertexBufferLayout.hasField("uv0")?a.params.atlasRegions?"AtlasTextured":"Textured":"none",a.selectProgram(),a.selectSlot(),a}return r(t,e),t.prototype.beginSlot=function(e){return e===this.slot},t.prototype.getProgram=function(){return this.program},t.prototype.selectProgram=function(){this.program=this.programRep.getProgram(f.highlightPass,{viewingMode:this.programRep.globalOptions.viewingMode,textureMode:this.texturing,flipV:this.params.flipV,instanced:this.instanced,instancedDoublePrecision:this.params.instancedDoublePrecision,vvSize:this.params.vvSizeEnabled,verticalOffset:null!==this.params.verticalOffset,screenSizePerspective:null!==this.params.screenSizePerspective,slice:this.params.slicePlaneEnabled,transparencyDiscard:this.params.transparent,alphaCoverageCorrection:P})},t.prototype.selectSlot=function(){this.slot=v(this.params.transparent,this.params.writeStencil)},t.prototype.updateParameters=function(){this.params=this.material.getParameterValues(),this.selectProgram(),this.selectSlot(),this.updateTexture(this.params.textureId)},t.prototype.bind=function(e,t){var r=this.program,i=this.params;e.bindProgram(r),this.bindTexture(e,r),p.bindVerticalOffset(i.verticalOffset,t,r),p.bindScreenSizePerspective(i.screenSizePerspective,t,r),y(r,i),g(e,i),i.inverseWindingOrder&&e.setFrontFace(2304),e.setDepthTestEnabled(!0)},t.prototype.release=function(e){var t=this.params;m(e),t.inverseWindingOrder&&e.setFrontFace(2304)},t.prototype.bindView=function(e,t){var r=this.program,i=this.params,n=i.instancedDoublePrecision?[t.viewInvTransp[3],t.viewInvTransp[7],t.viewInvTransp[11]]:t.origin;p.bindView(n,t.view,r),i.slicePlaneEnabled&&p.bindSlicePlane(t.origin,t.slicePlane,r),i.screenSizePerspective&&p.bindCamPos(n,t.viewInvTransp,r),i.instancedDoublePrecision&&p.bindViewOriginDouble(n,r)},t.prototype.bindInstance=function(e,t){var r=this.program;r.setUniformMatrix4fv("model",t.transformation),r.setUniformMatrix4fv("modelNormal",t.transformationNormal)},t.prototype.getDrawMode=function(e){return 4},t}(s),M={textureId:void 0,textureInitTransparent:!1,ambient:[.2,.2,.2],diffuse:[.8,.8,.8],specular:[0,0,0],externalColor:[1,1,1,1],colorMixMode:"multiply",opacity:1,layerOpacity:1,blendModeOneOne:!1,inverseWindingOrder:!1,vertexColors:!1,symbolColors:!1,componentIndices:!1,componentColorBuffer:null,flipV:!1,doubleSided:!1,doubleSidedType:"normal",cullFace:void 0,instanced:void 0,instancedDoublePrecision:!1,compressedNormals:!1,groundNormalShading:!1,writeStencil:!1,receiveSSAO:!0,castShadows:!0,verticalOffset:null,screenSizePerspective:null,slicePlaneEnabled:!1,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvSizeValue:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvSymbolAnchor:[0,0,0],vvSymbolRotation:[0,0,0],transparent:!1,polygonOffset:!1,atlasRegions:!1},R=function(){function e(e,t){this.vertexBufferLayout=e,this.instanceBufferLayout=t}return e.prototype.allocate=function(e){return this.vertexBufferLayout.createBuffer(e)},e.prototype.elementCount=function(e){return e.indices.position.length},e.prototype.write=function(e,t,r,i,n){c.writeDefaultAttributes(t,r,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,i,n)},e}(),P=!!i("enable-feature:skallweit/lod-rendering"),E=a.mat3d.create(),I=a.mat4d.create(),A=a.vec3d.create(),D=a.vec3d.create(),F=a.vec3d.createFrom(0,0,1),L=a.vec3d.create(),N=a.vec3d.create(),j=a.vec3d.create(),U=a.vec3d.create();return x}.apply(null,i))||(e.exports=n)},636:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(439),r(445)],void 0===(n=function(e,t,r,i){return function(){function e(t){this.supportsEdges=!1,this._parentStage=null,this._visible=!0,this._renderOccluded=!1,this._renderPriority=0,this.id=e._idGen.gen(t)}return Object.defineProperty(e.prototype,"parentStage",{get:function(){return this._parentStage},enumerable:!0,configurable:!0}),e.prototype.addParentStage=function(e){this._parentStage=e},e.prototype.removeParentStage=function(e){this._parentStage=null},Object.defineProperty(e.prototype,"visible",{get:function(){return this._visible},set:function(e){e!==this._visible&&(this._visible=e,this.notifyDirty("matChanged"))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderOccluded",{get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.notifyDirty("matChanged"))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderPriority",{get:function(){return this._renderPriority},set:function(e){e!==this._renderPriority&&(this._renderPriority=e,this.notifyDirty("matChanged"))},enumerable:!0,configurable:!0}),e.prototype.isVisible=function(){return this._visible},e.prototype.notifyDirty=function(e){this.parentStage&&this.parentStage.notifyDirty(i.MATERIAL,this,e)},e._idGen=new r,e}()}.apply(null,i))||(e.exports=n)},639:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(344),r(350),r(349),r(403)],void 0===(n=function(e,t,r,i,n,a){Object.defineProperty(t,"__esModule",{value:!0}),t.processAttachmentQueryResult=function(e,t,i){for(var a={},o=0,s=e;o<s.length;o++)for(var u=s[o],l=u.parentObjectId,d=0,c=u.attachmentInfos;d<c.length;d++){var h=c[d],p=h.id,f=n.addProxy(t+"/"+l+"/attachments/"+p+(i?"?token="+i:"")),g=r({},h,{parentObjectId:l,url:f});a[l]?a[l].push(g):a[l]=[g]}return a},t.executeAttachmentQuery=function(e,t,n){var o={query:a.mapParameters(r({},e.query,{f:"json"},function(e){var t=e.toJSON();return t.attachmentTypes&&(t.attachmentTypes=t.attachmentTypes.join(",")),t.globalIds&&(t.globalIds=t.globalIds.join(",")),t.objectIds&&(t.objectIds=t.objectIds.join(",")),t.size&&(t.size=t.size.join(",")),t}(t)))};return n&&(o=r({},n,o)),i(e.path+"/queryAttachments",o)}}.apply(null,i))||(e.exports=n)},647:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(337),r(335),r(388),r(344),r(364),r(336),r(740),r(627),r(639),r(648),r(440),r(392),r(419),r(444)],void 0===(n=function(e,t,r,i,n,a,o,s,u,l,d,c,h,p,f,g){return function(e){function t(t){var r=e.call(this,t)||this;return r.gdbVersion=null,r.source=null,r}return r(t,e),t.prototype.execute=function(e,t){return this.executeJSON(e,t).then(function(e){return p.fromJSON(e)})},t.prototype.executeJSON=function(e,t){return l.executeQuery(this.parsedUrl,this._normalizeQuery(e),a({},this.requestOptions,t)).then(function(e){return e.data})},t.prototype.executeForCount=function(e,t){return l.executeQueryForCount(this.parsedUrl,this._normalizeQuery(e),a({},this.requestOptions,t)).then(function(e){return e.data.count})},t.prototype.executeForExtent=function(e,t){return l.executeQueryForExtent(this.parsedUrl,this._normalizeQuery(e),a({},this.requestOptions,t)).then(function(e){return{count:e.data.count,extent:o.Extent.fromJSON(e.data.extent)}})},t.prototype.executeForIds=function(e,t){return l.executeQueryForIds(this.parsedUrl,this._normalizeQuery(e),a({},this.requestOptions,t)).then(function(e){return e.data.objectIds})},t.prototype.executeRelationshipQuery=function(e,t){return(this.gdbVersion||this.source)&&(e=e.clone().set({gdbVersion:this.gdbVersion||e.gdbVersion,source:this.source||e.source})),c.executeRelationshipQuery(this.parsedUrl,e,a({},this.requestOptions,t)).then(function(e){var t=e.data,r={};return Object.keys(t).forEach(function(e){return r[e]=p.fromJSON(t[e])}),r})},t.prototype.executeAttachmentQuery=function(e,t){var r=this,i=t&&t.query&&t.query.token;return d.executeAttachmentQuery(this.parsedUrl,e,a({},this.requestOptions,t)).then(function(e){return d.processAttachmentQueryResult(e.data.attachmentGroups,r.parsedUrl.path,i)})},t.prototype._normalizeQuery=function(e){return this.gdbVersion||this.source?e.clone().set({gdbVersion:this.gdbVersion||e.gdbVersion,source:this.source||e.source}):e},i([s.property()],t.prototype,"gdbVersion",void 0),i([s.property()],t.prototype,"source",void 0),i([n(0,s.cast(f))],t.prototype,"execute",null),i([n(0,s.cast(f))],t.prototype,"executeJSON",null),i([n(0,s.cast(f))],t.prototype,"executeForCount",null),i([n(0,s.cast(f))],t.prototype,"executeForExtent",null),i([n(0,s.cast(f))],t.prototype,"executeForIds",null),i([n(0,s.cast(g))],t.prototype,"executeRelationshipQuery",null),i([n(0,s.cast(h))],t.prototype,"executeAttachmentQuery",null),i([s.subclass("esri.tasks.QueryTask")],t)}(s.declared(u))}.apply(null,i))||(e.exports=n)},648:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(344),r(350),r(403)],void 0===(n=function(e,t,r,i,n){function a(e){var t=e.toJSON();return t.objectIds&&(t.objectIds=t.objectIds.join(",")),t.outFields&&(t.outFields=t.outFields.join(",")),t.outSpatialReference&&(t.outSR=t.outSR.wkid||JSON.stringify(t.outSR.toJSON()),delete t.outSpatialReference),t.source&&(t.layer=JSON.stringify({source:t.source}),delete t.source),t}Object.defineProperty(t,"__esModule",{value:!0}),t.toQueryStringParameters=a,t.executeRelationshipQuery=function(e,t,o){var s={query:n.mapParameters(r({},e.query,{f:"json"},a(t)))};return o&&(s=r({},o,s)),i(e.path+"/queryRelatedRecords",s).then(function(e){for(var t=e.data,r=t.geometryType,i=t.spatialReference,n={},a=0,o=t.relatedRecordGroups;a<o.length;a++){var s=o[a],u={fields:void 0,objectIdFieldName:void 0,geometryType:r,spatialReference:i,features:s.relatedRecords};if(null!=s.objectId)n[s.objectId]=u;else for(var l in s)s.hasOwnProperty(l)&&"relatedRecords"!==l&&(n[s[l]]=u)}return e.data=n,e})}}.apply(null,i))||(e.exports=n)},656:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(602),r(348)],void 0===(n=function(e,t,r,i){function n(e,t,r,i,n){var a=r.typedBuffer,o=r.typedBufferStride,s=e.length;if(i*=o,null==n||1===n)for(var u=0;u<s;++u){var l=2*e[u];a[i]=t[l],a[i+1]=t[l+1],i+=o}else for(u=0;u<s;++u){l=2*e[u];for(var d=0;d<n;++d)a[i]=t[l],a[i+1]=t[l+1],i+=o}}function a(e,t,r,i,n){var a=r.typedBuffer,o=r.typedBufferStride,s=e.length;if(i*=o,null==n||1===n)for(var u=0;u<s;++u){var l=3*e[u];a[i]=t[l],a[i+1]=t[l+1],a[i+2]=t[l+2],i+=o}else for(u=0;u<s;++u){l=3*e[u];for(var d=0;d<n;++d)a[i]=t[l],a[i+1]=t[l+1],a[i+2]=t[l+2],i+=o}}function o(e,t,r,i,n){var a=r.typedBuffer,o=r.typedBufferStride,s=e.length;if(i*=o,null==n||1===n)for(var u=0;u<s;++u){var l=4*e[u];a[i]=t[l],a[i+1]=t[l+1],a[i+2]=t[l+2],a[i+3]=t[l+3],i+=o}else for(u=0;u<s;++u){l=4*e[u];for(var d=0;d<n;++d)a[i]=t[l],a[i+1]=t[l+1],a[i+2]=t[l+2],a[i+3]=t[l+3],i+=o}}function s(e,t,r,i,n,o){if(r){var s=r,u=i.typedBuffer,l=i.typedBufferStride,d=e.length;if(n*=l,null==o||1===o)for(var c=0;c<d;++c){var h=t[g=3*e[c]],p=t[g+1],f=t[g+2];u[n]=s[0]*h+s[4]*p+s[8]*f+s[12],u[n+1]=s[1]*h+s[5]*p+s[9]*f+s[13],u[n+2]=s[2]*h+s[6]*p+s[10]*f+s[14],n+=l}else for(c=0;c<d;++c){h=t[g=3*e[c]],p=t[g+1],f=t[g+2];for(var g,m=s[0]*h+s[4]*p+s[8]*f+s[12],v=s[1]*h+s[5]*p+s[9]*f+s[13],y=s[2]*h+s[6]*p+s[10]*f+s[14],_=0;_<o;++_)u[n]=m,u[n+1]=v,u[n+2]=y,n+=l}}else a(e,t,i,n,o)}function u(e,t,r,i,n,o){if(r){var s=r,u=i.typedBuffer,l=i.typedBufferStride,d=e.length;if(n*=l,null==o||1===o)for(var c=0;c<d;++c){var h=t[g=3*e[c]],p=t[g+1],f=t[g+2];u[n]=s[0]*h+s[4]*p+s[8]*f,u[n+1]=s[1]*h+s[5]*p+s[9]*f,u[n+2]=s[2]*h+s[6]*p+s[10]*f,n+=l}else for(c=0;c<d;++c){h=t[g=3*e[c]],p=t[g+1],f=t[g+2];for(var g,m=s[0]*h+s[4]*p+s[8]*f,v=s[1]*h+s[5]*p+s[9]*f,y=s[2]*h+s[6]*p+s[10]*f,_=0;_<o;++_)u[n]=m,u[n+1]=v,u[n+2]=y,n+=l}}else a(e,t,i,n,o)}function l(e,t,r,i,n,a){var o=i.typedBuffer,s=i.typedBufferStride,u=e.length;if(n*=s,null==a||1===a){if(4===r)for(var l=0;l<u;++l){var d=4*e[l];o[n]=t[d],o[n+1]=t[d+1],o[n+2]=t[d+2],o[n+3]=t[d+3],n+=s}else if(3===r)for(l=0;l<u;++l){d=3*e[l];o[n]=t[d],o[n+1]=t[d+1],o[n+2]=t[d+2],o[n+3]=255,n+=s}}else if(4===r)for(l=0;l<u;++l){d=4*e[l];for(var c=0;c<a;++c)o[n]=t[d],o[n+1]=t[d+1],o[n+2]=t[d+2],o[n+3]=t[d+3],n+=s}else if(3===r)for(l=0;l<u;++l)for(d=3*e[l],c=0;c<a;++c)o[n]=t[d],o[n+1]=t[d+1],o[n+2]=t[d+2],o[n+3]=255,n+=s}function d(e,t,r,i,n,a,o){var s=n.typedBuffer,u=n.typedBufferStride,l=e.length;if(a*=u,null==o||1===o){if(4===r)for(var d=0;d<l;++d){var c=4*e[d];s[a]=t[c]*i[0],s[a+1]=t[c+1]*i[1],s[a+2]=t[c+2]*i[2],s[a+3]=t[c+3]*i[3],a+=u}else if(3===r){var h=255*i[3];for(d=0;d<l;++d){c=3*e[d];s[a]=t[c]*i[0],s[a+1]=t[c+1]*i[1],s[a+2]=t[c+2]*i[2],s[a+3]=h,a+=u}}}else if(4===r)for(d=0;d<l;++d){c=4*e[d];for(var p=0;p<o;++p)s[a]=t[c]*i[0],s[a+1]=t[c+1]*i[1],s[a+2]=t[c+2]*i[2],s[a+3]=t[c+3]*i[3],a+=u}else if(3===r)for(h=255*i[3],d=0;d<l;++d)for(c=3*e[d],p=0;p<o;++p)s[a]=t[c]*i[0],s[a+1]=t[c+1]*i[1],s[a+2]=t[c+2]*i[2],s[a+3]=h,a+=u}Object.defineProperty(t,"__esModule",{value:!0}),t.writeBufferVec2=n,t.writeBufferVec3=a,t.writeBufferVec4=o,t.writePosition=s,t.writeNormal=u,t.writeColor=l,t.writeMultipliedColor=d,t.writeDefaultAttributes=function(e,t,a,c,h,p,f){for(var g=0,m=a.fieldNames;g<m.length;g++){var v=m[g],y=e.vertexAttr[v],_=e.indices[v];if(y&&_)switch(v){case i.VertexAttrConstants.POSITION:i.assert(3===y.size);var b=p.getField(v,r.BufferViewVec3f);b&&s(_,y.data,c,b,f);break;case i.VertexAttrConstants.NORMAL:i.assert(3===y.size);var x=p.getField(v,r.BufferViewVec3f);x&&u(_,y.data,h,x,f);break;case i.VertexAttrConstants.UV0:i.assert(2===y.size);var w=p.getField(v,r.BufferViewVec2f);w&&n(_,y.data,w,f);break;case i.VertexAttrConstants.REGION:i.assert(4===y.size);var S=p.getField(v,r.BufferViewVec4u16);S&&o(_,y.data,S,f);break;case i.VertexAttrConstants.COLOR:i.assert(3===y.size||4===y.size);var T=p.getField(v,r.BufferViewVec4u8);T&&(t&&t.color?d(_,y.data,y.size,t.color,T,f):l(_,y.data,y.size,T,f));break;case i.VertexAttrConstants.SYMBOLCOLOR:i.assert(3===y.size||4===y.size);var O=p.getField(v,r.BufferViewVec4u8);O&&l(_,y.data,y.size,O,f)}}}}.apply(null,i))||(e.exports=n)},666:function(e,t,r){var i;void 0===(i=function(){function e(e,t,r,i){for(var n=t,a=t,o=r>>>1,s=e[n-1];a<=o;){(a=n<<1)<r&&i(e[a-1],e[a])<0&&++a;var u=e[a-1];if(i(u,s)<=0)break;e[n-1]=u,n=a}e[n-1]=s}function t(e,t){return e<t?-1:e>t?1:0}return{sort:function(r,i,n,a){void 0===i&&(i=0),void 0===n&&(n=r.length),void 0===a&&(a=t);for(var o=n>>>1;o>i;o--)e(r,o,n,a);var s=i+1;for(o=n-1;o>i;o--){var u=r[i];r[i]=r[o],r[o]=u,e(r,s,o,a)}return r}}}.apply(null,[]))||(e.exports=i)},668:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){function r(e,t){return{near:e,far:t}}function i(e,t,r){return e.near=t,e.far=r,e}Object.defineProperty(t,"__esModule",{value:!0}),t.create=r,t.empty=function(e){return e?i(e,1/0,-1/0):r(1/0,-1/0)},t.set=i,t.union=function(e,t,r){return void 0===r&&(r=e),r.near=Math.min(e.near,t.near),r.far=Math.max(e.far,t.far),r}}.apply(null,i))||(e.exports=n)},680:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=!!Map.prototype.entries;t.everyMap=r?function(e,t){for(var r=e.entries();;){var i=r.next();if(i.done)break;if(!1===t(i.value[1],i.value[0]))return!1}return!0}:function(e,t){var r=!0;return e.forEach(function(e,i){r&&(r=!1!==t(e,i))}),r}}.apply(null,i))||(e.exports=n)},684:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(342),r(421),r(1011),r(723),r(439),r(445),r(348)],void 0===(n=function(e,t,r,i,n,a,o,s,u){var l=u.assert,d=r.mat4d.identity(),c=function(){function e(t){void 0===t&&(t={}),this._bvObjectSpace=new h,this._bvWorldSpace=new h,this._bvDirty=!0,this._hasVolatileTransformation=!1,this._allComponentsHiddenDirty=!0,this.id=e._idGen.gen(t.idHint),this.name=t.name,this.castShadow=null==t.castShadow||t.castShadow,this.metadata=t.metadata,this.objectTransformation=r.mat4d.identity(),this._initializeGeometryRecords(t.geometries,t.materials,t.transformations,t.origins)}return e.prototype._initializeGeometryRecords=function(e,t,i,a){if(!Array.isArray(e))return this.geometryRecords=[],void(this.geometries=[]);l(t.length===e.length,"Object3D: materials don't match geometries"),l(i.length===e.length,"Object3D: transformations don't match geometries"),this.geometryRecords=new Array(e.length),this.geometries=e.slice();for(var o=0;o<e.length;o++){l(Array.isArray(t[o]),"Object3D: materials parameter must be array of array");this.geometryRecords[o]=new n(e[o],t[o].slice(),r.mat4d.create(i[o]),{},a&&a[o])}this._hasVolatileTransformation=!1},Object.defineProperty(e.prototype,"parentLayer",{get:function(){return this._parentLayer},set:function(e){l(null==this._parentLayer||null==e,"Object3D can only be added to a single Layer"),this._parentLayer=e},enumerable:!0,configurable:!0}),e.prototype.getParentLayer=function(){return this.parentLayer},e.prototype.addParentLayer=function(e){this.parentLayer=e},e.prototype.removeParentLayer=function(e){this.parentLayer=null},e.prototype.getNumGeometryRecords=function(){return this.geometryRecords.length},e.prototype.getFirstGeometryIndex=function(e){var t=this.geometries.indexOf(e);return l(t>-1,"Object3D.getFirstGeometryIndex: geometry not found"),t},e.prototype.findGeometryRecords=function(e){for(var t=[],r=0;r<this.geometries.length;r++)this.geometries[r]===e&&t.push(this.geometryRecords[r]);return t},e.prototype.getGeometryRecord=function(e){return l(e>=0&&e<this.geometryRecords.length,"Object3d.getGeometryDataByIndex: index out of range"),this.geometryRecords[e]},e.prototype.getGeometryRecords=function(){return this.geometryRecords},e.prototype.addGeometry=function(e,t,i,a,o,s){void 0===i&&(i=d),l(Array.isArray(t),"Object3D.addGeometry: materials must be array"),this.geometries.push(e);var u=new n(e,t.slice(),r.mat4d.create(i),a||{},o,s);return this.geometryRecords.push(u),this._hasVolatileTransformation=this.geometryRecords.some(function(e){return!!e.customTransformation}),this._notifyDirty("objGeometryAdded",u),this._invalidateBoundingVolume(),this._allComponentsHiddenDirty=!0,u},e.prototype.hasGeometry=function(e){return this.geometries.indexOf(e)>-1},e.prototype.removeGeometry=function(e){var t=this.geometryRecords.splice(e,1)[0];return this._hasVolatileTransformation=this.geometryRecords.some(function(e){return!!e.customTransformation}),this.geometries.splice(e,1),this._notifyDirty("objGeometryRemoved",t),this._invalidateBoundingVolume(),this._allComponentsHiddenDirty=!0,t},e.prototype.removeAllGeometries=function(){for(;this.getNumGeometryRecords()>0;)this.removeGeometry(0)},e.prototype.geometryVertexAttrsUpdated=function(e){this._notifyDirty("vertexAttrsUpdated",this.geometryRecords[e]),this._invalidateBoundingVolume()},e.prototype.areAllComponentsHidden=function(){if(this._allComponentsHiddenDirty){this._allComponentsHiddenDirty=!1,this._allComponentsHidden=!0;for(var e=0,t=this.geometryRecords;e<t.length;e++){var r=t[e],n=r.instanceParameters.componentVisibilities,a=r.geometry.data.componentOffsets;if(!i.isAllHidden(n,a)){this._allComponentsHidden=!1;break}}}return this._allComponentsHidden},e.prototype.areAllComponentsVisible=function(){for(var e=0,t=this.geometryRecords;e<t.length;e++){var r=t[e],n=r.instanceParameters.componentVisibilities,a=r.geometry.data.componentOffsets;if(!i.isAllVisible(n,a))return!1}return!0},e.prototype.hasComponents=function(){for(var e=!1,t=0;t<this.geometries.length;t++){var r=this.geometries[t];if(e=i.hasComponents(r.data.componentOffsets))break}return e},e.prototype.setComponentVisibility=function(e,t,r){var n=e.geometry,a=e.instanceParameters.componentVisibilities,o=n.data.componentOffsets,s=i.updateVisibility(a,o,t,r);e.instanceParameters.componentVisibilities=s,this._notifyDirty("visibilityChanged",e),this._allComponentsHiddenDirty=!0},e.prototype.setHidden=function(e,t){e.instanceParameters.hidden=!!t,this._notifyDirty("visibilityChanged",e)},e.prototype.isHidden=function(e){return!!e.instanceParameters.hidden},e.prototype.getComponentVisibility=function(e,t){var r=e.instanceParameters.componentVisibilities;return i.getVisibility(r,t)},e.prototype.hideAllComponents=function(){for(var e=0,t=this.geometryRecords;e<t.length;e++){var r=t[e],n=r.instanceParameters.componentVisibilities,a=i.hideAllComponents(n);r.instanceParameters.componentVisibilities=a}this._notifyDirty("visibilityChanged"),this._allComponentsHiddenDirty=!0},e.prototype.unhideAllComponents=function(){for(var e=0,t=this.geometryRecords;e<t.length;e++){var r=t[e],n=r.instanceParameters.componentVisibilities,a=i.unhideAllComponents(n);r.instanceParameters.componentVisibilities=a}this._notifyDirty("visibilityChanged"),this._allComponentsHiddenDirty=!0},e.prototype._setComponentHighlight=function(e,t,r,n){var a=e.instanceParameters.componentHighlights,o=i.addHighlight(a,t,r,n);e.instanceParameters.componentHighlights=o},e.prototype.setComponentHighlight=function(e,t,r){var i=a.generateHighlightId();return this._setComponentHighlight(e,t,r,i),this._notifyDirty("componentHighlightChanged"),i},e.prototype.highlightAllComponents=function(e){for(var t=a.generateHighlightId(),r=0,i=this.geometryRecords;r<i.length;r++){var n=i[r];this._setComponentHighlight(n,null,e,t)}return this._notifyDirty("componentHighlightChanged"),t},e.prototype.removeHighlights=function(e){for(var t=0,r=this.geometryRecords;t<r.length;t++){var n=r[t].instanceParameters,a=n.componentHighlights,o=i.removeHighlight(a,e);n.componentHighlights=o}this._notifyDirty("componentHighlightChanged")},e.prototype.getComponentFromTriangleNr=function(e,t){l(e>=0&&e<this.geometryRecords.length,"Object3d.getComponentFromTriangleNr: index out of range");var r=this.geometryRecords[e].geometry.data.componentOffsets;return i.componentFind(r,3*t)},e.prototype.setGeometryTransformation=function(e,t){l(e>=0&&e<this.geometryRecords.length,"Object3d.setGeometryTransformation: index out of range");var i=this.geometryRecords[e],a=new n(i.geometry,i.materials,r.mat4d.create(t),i.instanceParameters);this.geometryRecords[e]=a,this._notifyDirty("objGeometryReplaced",[i,a]),this._invalidateBoundingVolume()},e.prototype.getObjectTransformation=function(){return r.mat4d.create(this.objectTransformation)},e.prototype.setObjectTransformation=function(e){r.mat4d.set(e,this.objectTransformation),this._invalidateBoundingVolume(),this._notifyDirty("objTransformation")},e.prototype.getCombinedStaticTransformation=function(e,t){return t=t||r.mat4d.create(),r.mat4d.multiply(this.objectTransformation,e.getStaticTransformation(),t),t},e.prototype.getCombinedShaderTransformation=function(e,t){return t=t||r.mat4d.create(),r.mat4d.multiply(this.objectTransformation,e.getShaderTransformation(),t),t},e.prototype.hasVolativeTransformation=function(){return this._hasVolatileTransformation},e.prototype.getCastShadow=function(){return this.castShadow},e.prototype.setCastShadow=function(e){this.castShadow=e},e.prototype.getMetadata=function(){return this.metadata},e.prototype.getName=function(){return this.name},e.prototype.getBBMin=function(e){return this._validateBoundingVolume(),e?this._bvObjectSpace.bbMin:this._bvWorldSpace.bbMin},e.prototype.getBBMax=function(e){return this._validateBoundingVolume(),e?this._bvObjectSpace.bbMax:this._bvWorldSpace.bbMax},e.prototype.getCenter=function(e){return this._validateBoundingVolume(),e?this._bvObjectSpace.center:this._bvWorldSpace.center},e.prototype.getBSRadius=function(e){return this._validateBoundingVolume(),e?this._bvObjectSpace.bsRadius:this._bvWorldSpace.bsRadius},e.prototype._validateBoundingVolume=function(){if(this._bvDirty||this._hasVolatileTransformation){this._bvObjectSpace.init(),this._bvWorldSpace.init();for(var e=0;e<this.geometryRecords.length;++e){var t=this.geometries[e],i=this.geometryRecords[e],n=t.boundingInfo;this._calculateTransformedBoundingVolume(n,this._bvObjectSpace,i.getShaderTransformation()),this._calculateTransformedBoundingVolume(n,this._bvWorldSpace,this.getCombinedShaderTransformation(i))}r.vec3d.lerp(this._bvObjectSpace.bbMin,this._bvObjectSpace.bbMax,.5,this._bvObjectSpace.center),r.vec3d.lerp(this._bvWorldSpace.bbMin,this._bvWorldSpace.bbMax,.5,this._bvWorldSpace.center);var a=r.vec3d.create(),o=r.vec3d.create(),s=r.mat4d.maxScale(this.objectTransformation);for(e=0;e<this.geometryRecords.length;++e){t=this.geometries[e];var u=this.geometryRecords[e].getShaderTransformation(),l=r.mat4d.maxScale(u);n=t.boundingInfo;r.mat4d.multiplyVec3(u,n.getCenter(),a);var d=r.vec3d.dist(a,this._bvObjectSpace.center),c=n.getBSRadius()*l;this._bvObjectSpace.bsRadius=Math.max(this._bvObjectSpace.bsRadius,d+c),r.mat4d.multiplyVec3(this.objectTransformation,a,o);var h=r.vec3d.dist(o,this._bvWorldSpace.center),p=c*s;this._bvWorldSpace.bsRadius=Math.max(this._bvWorldSpace.bsRadius,h+p)}this._bvDirty=!1}},e.prototype._calculateTransformedBoundingVolume=function(e,t,i){var n=e.getBBMin(),a=e.getBBMax(),o=r.vec3d.create(n),s=r.vec3d.create(a);r.mat4d.multiplyVec3(i,o),r.mat4d.multiplyVec3(i,s);for(var u=0;u<3;++u)t.bbMin[u]=Math.min(t.bbMin[u],o[u],s[u]),t.bbMax[u]=Math.max(t.bbMax[u],o[u],s[u]);for(u=0;u<3;++u){r.vec3d.set(n,o),r.vec3d.set(a,s),o[u]=a[u],s[u]=n[u],r.mat4d.multiplyVec3(i,o),r.mat4d.multiplyVec3(i,s);for(var l=0;l<3;++l)t.bbMin[l]=Math.min(t.bbMin[l],o[l],s[l]),t.bbMax[l]=Math.max(t.bbMax[l],o[l],s[l])}},e.prototype._invalidateBoundingVolume=function(){this._bvDirty=!0,this._parentLayer&&this._parentLayer.notifyObjectBBChanged(this,{center:this._bvWorldSpace.center,radius:this._bvWorldSpace.bsRadius})},e.prototype._notifyDirty=function(e,t,r,i){if(this._parentLayer){r=r||s.OBJECT;var n=i||this;this._parentLayer.notifyDirty(e,t,r,n)}},e._idGen=new o,e}(),h=function(){function e(){this.bbMin=r.vec3d.create(),this.bbMax=r.vec3d.create(),this.center=r.vec3d.create(),this.bsRadius=0}return e.prototype.init=function(){r.vec3d.set3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,this.bbMin),r.vec3d.set3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,this.bbMax),r.vec3d.set3(0,0,0,this.center),this.bsRadius=0},e.prototype.getCenter=function(){return this.center},e.prototype.getBSRadius=function(){return this.bsRadius},e}();return c}.apply(null,i))||(e.exports=n)},687:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(391)],void 0===(n=function(e,t,r){function i(e){return null!=e.cachedResult}Object.defineProperty(t,"__esModule",{value:!0}),t.createContext=function(e,t,i){var n=null,a=e&&e.expression;if("string"==typeof a){var o=function(e){return"0"===e?0:null}(a);if(null!=o)n={cachedResult:o};else{var s=r.createSyntaxTree(a);r.dependsOnView(s)?(null!=i&&i.error("Expressions containing '$view' are not supported on ElevationInfo"),n={cachedResult:0}):n={arcade:{func:r.createFunction(s),context:r.createExecContext(null,{sr:t})}}}}return n},t.createFeature=function(e,t){return r.createFeature(e.attributes,e.geometry,t)},t.setContextFeature=function(e,t){null==e||i(e)||r.updateExecContext(e.arcade.context,t)},t.execute=function(e){if(null!=e){if(i(e))return e.cachedResult;var t=e.arcade,n=r.executeFunction(t.func,t.context);return"number"!=typeof n&&(e.cachedResult=0,n=0),n}return 0},t.extractExpressionInfo=function(e,t){void 0===t&&(t=!1);var r=e&&e.featureExpressionInfo,i=r&&r.expression;return t||"0"===i||(r=null),r},t.zeroContext={cachedResult:0}}.apply(null,i))||(e.exports=n)},688:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(342)],void 0===(n=function(e,t,r){return function(){function e(e,t,i,n,a,o,s,u,l,d,c){this.shaderTransformationDirty=!0,this.data=e.toRenderData(),this.componentOffsets=e.componentOffsets,this.boundingInfo=t,this.material=i,this.origin=null,this.center=r.vec3d.create(),this.bsRadius=0,this.transformation=null,this.calculateShaderTransformation=a,n&&this.updateTransformation(n,o),this.castShadow=s,this.singleUse=u,this.name=l,this.uniqueName=d,this.idx=c,this.canBeMerged=!0,this.instanceParameters={}}return e.prototype.updateTransformation=function(e,t){this.transformation=e,this.shaderTransformationDirty=!0,this.bsRadius=this.getBoundingSphere(e,t,this.center)},e.prototype.shaderTransformationChanged=function(){this.shaderTransformationDirty=!0},e.prototype.getBoundingSphere=function(e,t,i){return t=t||r.mat4d.maxScale(e),r.mat4d.multiplyVec3(e,this.boundingInfo.getCenter(),i),this.boundingInfo.getBSRadius()*t},Object.defineProperty(e.prototype,"hasShaderTransformation",{get:function(){return!!this.calculateShaderTransformation},enumerable:!0,configurable:!0}),e.prototype.getShaderTransformation=function(){return this.calculateShaderTransformation?(this.shaderTransformationDirty&&(this.shaderTransformation||(this.shaderTransformation=r.mat4d.create()),r.mat4d.set(this.calculateShaderTransformation(this.transformation),this.shaderTransformation),this.shaderTransformationDirty=!1),this.shaderTransformation):this.transformation},e}()}.apply(null,i))||(e.exports=n)},689:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){return function(){function e(e,t){this.material=e,this.programRep=t}return e.prototype.dispose=function(){},Object.defineProperty(e.prototype,"materialId",{get:function(){return this.material.id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderOccluded",{get:function(){return this.material.renderOccluded},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderPriority",{get:function(){return this.material.renderPriority},enumerable:!0,configurable:!0}),e.prototype.isVisible=function(){return this.material.isVisible()},e.prototype.getPrograms=function(){return[this.getProgram()]},e}()}.apply(null,i))||(e.exports=n)},690:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(343),r(342),r(632),r(359),r(622),r(862),r(430),r(417),r(439),r(348),r(618),r(372),r(368),r(390)],void 0===(n=function(e,t,r,i,n,a,o,s,u,l,d,c,h,p,f,g){function m(e,t,r,i,o,s,u){u=!1!==u,n.requestImage(t).then(function(t){if(c.assert(t.width>=1&&t.height>=1),r.samplingMode=u?9987:9729,r.hasMipmap=u,!u&&33071===r.wrapMode||a.isPowerOfTwo(t.width)&&a.isPowerOfTwo(t.height)){r.width=t.width,r.height=t.height;var n=new f(e,r,t);e.bindTexture(n),s(n)}else{n=v(e,t,r,i,o);e.bindTexture(n),s(n)}}).catch(function(e){var r=t.length>200?t.slice(0,100)+"..."+t.slice(t.length-100):t;y.error("Failed to load image from uri",r,e),s(null)})}function v(e,t,r,n,o){var s=a.nextHighestPowerOfTwo(t.width),d=a.nextHighestPowerOfTwo(t.height);c.assert(s!==t.width||d!==t.height),r.width=s,r.height=d;var m=new f(e,r),v=p.createWithAttachments(e,m,{colorTarget:0,depthStencilTarget:0}),y=new f(e,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!!r.flipped,maxAnisotropy:8,preMultiplyAlpha:r.preMultiplyAlpha},t);if(e.bindFramebuffer(v),void 0===o){var _=e.getViewport();o=[_.x,_.y,_.width,_.height]}e.setViewport(0,0,s,d);var b=n.getProgram(h.texOnly),x=i.mat4d.identity();e.bindProgram(b),b.setUniformMatrix4fv("model",x),b.setUniformMatrix4fv("view",x),b.setUniformMatrix4fv("proj",x),b.setUniform4f("color",1,1,1,1),b.setUniform1i("tex",0);var w=l.createQuadVAO(e,u.Pos3Tex);return e.bindTexture(y,0),e.bindVAO(w),e.setDepthTestEnabled(!1),e.setBlendingEnabled(!1),e.drawArrays(5,0,g.vertexCount(w,"geometry")),e.setDepthTestEnabled(!0),e.bindFramebuffer(null),e.setViewport(o[0],o[1],o[2],o[3]),w.dispose(!0),y.dispose(),e.bindFramebuffer(null),v.detachColorTexture(),v.dispose(),r.hasMipmap&&m.generateMipmap(),m}var y=r.getLogger("esri.views.3d.webgl-engine.lib.Texture");return function(){function e(t,r,i){this.data=t,this.id=e.idGen.gen(r),this.unloadFunc=void 0,this.params=i||{},this.params.wrapClamp=this.params.wrapClamp||!1,this.params.mipmap=!1!==this.params.mipmap,this.params.noUnpackFlip=this.params.noUnpackFlip||!1,this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1,this.estimatedTexMemRequired=e.estimateTexMemRequired(this.data,this.params)}return e.estimateTexMemRequired=function(e,t){return null==e?0:o.isArrayBuffer(e)||o.isUint8Array(e)?e.byteLength:e instanceof Image||e instanceof ImageData||e instanceof HTMLCanvasElement?(t.mipmap?4/3:1)*e.width*e.height*4:(t.mipmap?4/3:1)*t.width*t.height*4||0},e.prototype.getEstimatedTexMemRequired=function(){return this.estimatedTexMemRequired},e.prototype.dispose=function(){this.data=void 0},e.prototype.deferredLoading=function(){return"string"==typeof this.data},e.prototype.getWidth=function(){return this.params.width},e.prototype.getHeight=function(){return this.params.height},e.prototype.initializeThroughUpload=function(t,r,i,n,u){var l=this.data;if(r.flipped=!this.params.noUnpackFlip,r.samplingMode=this.params.mipmap?9987:9729,r.hasMipmap=this.params.mipmap,r.wrapMode=this.params.wrapClamp?33071:10497,r.preMultiplyAlpha=this.params.preMultiplyAlpha,"string"==typeof l)m(t,l,r,i,n,u,this.params.mipmap);else if(l instanceof Image||l instanceof ImageData||l instanceof HTMLCanvasElement){if(this.params.width=l.width,this.params.height=l.height,!(this.params.mipmap||!this.params.wrapClamp)||a.isPowerOfTwo(l.width)&&a.isPowerOfTwo(l.height)){r.width=l.width,r.height=l.height;var d=new f(t,r,l);t.bindTexture(d),u(d)}else{d=v(t,l,r,i,n);t.bindTexture(d),u(d)}}else if(o.isArrayBuffer(l)&&this.params.encoding===e.DDS_ENCODING){d=s.createDDSTexture(t,r,l,this.params.mipmap);t.bindTexture(d),u(d)}else if(o.isUint8Array(l)&&this.params.encoding===e.DDS_ENCODING){d=s.createDDSTexture(t,r,l.buffer,this.params.mipmap);t.bindTexture(d),u(d)}else if(o.isUint8Array(l)){c.assert(this.params.width>0&&this.params.height>0),r.pixelFormat=1===this.params.components?6409:6408,r.width=this.params.width,r.height=this.params.height;d=new f(t,r,l);t.bindTexture(d),u(d)}else{if(null!==l)throw console.warn("Unsupported image data"),new Error("Unsupported image data");d=new f(t,r,null);t.bindTexture(d),u(d)}this.data=void 0},e.prototype.setUnloadFunc=function(e){this.unloadFunc=e},e.prototype.unload=function(){void 0!==this.unloadFunc&&(this.unloadFunc(this.id),this.unloadFunc=void 0)},e.createEmpty=function(t){return void 0===t&&(t="emptyTexture"),new e(new Uint8Array([0,0,0,0]),t,{width:1,height:1,wrapClamp:!0})},e.idGen=new d,e.DDS_ENCODING="image/vnd-ms.dds",e}()}.apply(null,i))||(e.exports=n)},705:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=r(653),a=r(654),o=r(450),s=r(887),u=r(614);r(660),t.Map=o.default.Map,u.default("es6-map")||(t.Map=((i=function(){function e(e){if(this._keys=[],this._values=[],this[Symbol.toStringTag]="Map",e)if(a.isArrayLike(e))for(var t=0;t<e.length;t++){var r=e[t];this.set(r[0],r[1])}else try{for(var i=n.__values(e),o=i.next();!o.done;o=i.next()){r=o.value;this.set(r[0],r[1])}}catch(e){s={error:e}}finally{try{o&&!o.done&&(u=i.return)&&u.call(i)}finally{if(s)throw s.error}}var s,u}return e.prototype._indexOfKey=function(e,t){for(var r=0,i=e.length;r<i;r++)if(s.is(e[r],t))return r;return-1},Object.defineProperty(e.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this._keys.length=this._values.length=0},e.prototype.delete=function(e){var t=this._indexOfKey(this._keys,e);return!(t<0)&&(this._keys.splice(t,1),this._values.splice(t,1),!0)},e.prototype.entries=function(){var e=this,t=this._keys.map(function(t,r){return[t,e._values[r]]});return new a.ShimIterator(t)},e.prototype.forEach=function(e,t){for(var r=this._keys,i=this._values,n=0,a=r.length;n<a;n++)e.call(t,i[n],r[n],this)},e.prototype.get=function(e){var t=this._indexOfKey(this._keys,e);return t<0?void 0:this._values[t]},e.prototype.has=function(e){return this._indexOfKey(this._keys,e)>-1},e.prototype.keys=function(){return new a.ShimIterator(this._keys)},e.prototype.set=function(e,t){var r=this._indexOfKey(this._keys,e);return r=r<0?this._keys.length:r,this._keys[r]=e,this._values[r]=t,this},e.prototype.values=function(){return new a.ShimIterator(this._values)},e.prototype[Symbol.iterator]=function(){return this.entries()},e}())[Symbol.species]=i,i)),t.default=t.Map},716:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(339),r(362),r(1376),r(1098),r(342),r(1012),r(762),r(387),r(779),r(348)],void 0===(n=function(e,t,r,i,n,a,o,s,u,l,d,c){var h=function(){function e(){}return e.prototype.process=function(e){var t=[e.geometryBuffer];return r.resolve({result:this.transform(e,t),transferList:t})},e.prototype.transform=function(e,t){var r=i.fromJSON(e.indexSR),h=i.fromJSON(e.vertexSR),g=i.fromJSON(e.renderSR),m=!1,v=0,y=[],_=a.computeGlobalTransformation(e.mbs,e.elevationOffset,r,g),b=e.obb?null:u.create([0,0,0],[-1,-1,-1],[0,0,0,1]);o.vec3d.set(e.mbs,p),p[2]+=e.elevationOffset,o.vec3d.set(p,f);for(var x=0,w=e.geometryData;x<w.length;x++)for(var S=w[x],T=S.geometries,O=S.componentOffsets,C=0,M=T;C<M.length;C++){var R=M[C],P=e.layouts[v];++v;var E=[{name:c.VertexAttrConstants.COLOR,byteValue:255}],I=[c.VertexAttrConstants.NORMAL,c.VertexAttrConstants.NORMALCOMPRESSED,c.VertexAttrConstants.SYMBOLCOLOR,c.VertexAttrConstants.COMPONENTINDEX],A=n.interleaveGeometryBuffer(R,e.geometryBuffer,P,E,I),D=new d(new Float32Array(A),P,void 0,void 0,void 0,!0),F=D.getAttribute(c.VertexAttrConstants.POSITION);if(a.reprojectPoints(F,e.mbs,_,e.elevationOffset,r,h,g),b&&this._updateObb(b,F,_),e.needNormals){var L={normals:D.getAttribute(c.VertexAttrConstants.NORMALCOMPRESSED),positions:F,normalInd:D.getIndices(c.VertexAttrConstants.NORMALCOMPRESSED),positionInd:D.getIndices(c.VertexAttrConstants.POSITION)};n.processAndInterleaveNormals(e.normalReferenceFrame,R,e.geometryBuffer,_,L)}var N=D.getAttribute(c.VertexAttrConstants.COMPONENTINDEX);N&&this._createComponentNumbers(N,O);var j=D.getAttribute(c.VertexAttrConstants.COLOR);j&&!m&&(m=this._hasColors(j));var U={globalTrafo:_},B=P[0].stride,V=1-.8*B/(B+4),k=s.deduplicate(A,B/4,V);if(null!=k){var z=k.uniqueCount<65536?new Uint16Array(k.indices):k.indices,G=n.extractPositionData(k.buffer,P,z);y.push({layout:P,interleavedVertexData:k.buffer,indices:z,corMatrices:U,hasColors:m,positionData:G}),t&&(t.push(k.buffer),t.push(z.buffer),t.push(G.data.buffer),t.push(G.indices.buffer))}else{G=n.extractPositionData(A,P);y.push({layout:P,interleavedVertexData:A,corMatrices:U,hasColors:m,positionData:G}),t&&(t.push(A),t.push(G.data.buffer),t.push(G.indices.buffer))}}return b&&(o.mat4d.multiplyVec3(_,b.center,b.center),l.vectorToVector(b.center,g,b.center,r),b.center[2]-=e.elevationOffset),{geometryBuffer:e.geometryBuffer,transformedGeometries:y,obb:b}},e.prototype._hasColors=function(e){for(var t=e.data,r=e.size,i=e.offsetIdx,n=e.strideIdx,a=i;a<t.length;a+=n)for(var o=0;o<r;o++)if(255!==t[a+o])return!0;return!1},e.prototype._createComponentNumbers=function(e,t){for(var r=e.data,i=e.offsetIdx,n=e.strideIdx,a=r.length/n,o=0,s=i,u=0;u<a;u++)u>=t[o+1]&&o++,r[s]=o,s+=n},e.prototype._updateObb=function(e,t,r){if(e.halfSize[0]>0){o.vec3d.subtract(e.center,e.halfSize,p),o.vec3d.add(e.center,e.halfSize,f);for(var i=t.offsetIdx;i<t.data.length;i+=t.strideIdx)p[0]=Math.min(p[0],t.data[i]),p[1]=Math.min(p[1],t.data[i+1]),p[2]=Math.min(p[2],t.data[i+2]),f[0]=Math.max(f[0],t.data[i]),f[1]=Math.max(f[1],t.data[i+1]),f[2]=Math.max(f[2],t.data[i+2]);o.vec3d.subtract(f,p,e.halfSize),o.vec3d.scale(e.halfSize,.5),o.vec3d.add(p,f,e.center),o.vec3d.scale(e.center,.5)}else{u.compute(t,e);var n=2*Math.sqrt(1+r[0]+r[5]+r[10]);g[0]=(r[9]-r[6])/n,g[1]=(r[2]-r[8])/n,g[2]=(r[4]-r[1])/n,g[3]=.25*n,o.quat4.conjugate(g),o.quat4.multiply(g,e.quaternion,e.quaternion)}},e}(),p=o.vec3d.create(),f=o.vec3d.create(),g=o.quat4.create();return h}.apply(null,i))||(e.exports=n)},723:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(439)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=new r;t.generateHighlightId=function(){return i.gen("highlight")}}.apply(null,i))||(e.exports=n)},724:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(708),r(342),r(445),r(813),r(688),r(348)],void 0===(n=function(e,t,r,i,n,a,o,s){var u=s.assert,l=s.logWithBase;return function(){function e(){for(var e in this.dirtySet=new a(this),this._uniqueIdx=0,this._id2origin={},this.content={},n)this.content[n[e]]={}}return e.prototype.getAll=function(e){var t=this.content[e];return u(void 0!==t),t},e.prototype.get=function(e,t){return this.getAll(e)[t]},e.prototype.add=function(e,t){var r=this.content[e];u(void 0!==r);var i=t.id;u(null==r[i],"Model/Stage already contains object to be added"),r[i]=t,e===n.LAYER&&this.notifyDirty(e,t,"layerAdded")},e.prototype.remove=function(e,t){var r=this.content[e];u(void 0!==r);var i=r[t];return u(void 0!==i,"Model/Stage doesn't contain object to be removed"),delete r[t],e===n.TEXTURE&&i.unload(),e===n.LAYER&&this.notifyDirty(e,i,"layerRemoved"),i},e.prototype.getDirtySet=function(){return this.dirtySet},e.prototype.notifyDirty=function(e,t,r,i){this.dirtySet.handleUpdate(t,r,i)},e.prototype.getOrigin=function(e,t,r){void 0===r&&(r=10);var n=0,a=t*r/1e4;a>1&&(n=Math.ceil(l(a,2)));var o=1e4*Math.pow(2,n),s=Math.round(e[0]/o),u=Math.round(e[1]/o),d=Math.round(e[2]/o),c=n+"_"+s+"_"+u+"_"+d,h=this._id2origin[c];return null==h&&(h={vec3:i.vec3d.createFrom(s*o,u*o,d*o),id:c},this._id2origin[c]=h),h},e.prototype.getGeometryRenderGeometries=function(e,t,r){var n=e.id,a=t.geometry,s=e.getCombinedStaticTransformation(t),u=i.mat4d.maxScale(s),l=t.origin,d=t.id,c=this._uniqueIdx++,h=new o(a.data,a.boundingInfo,t.materials[0],s,t.customTransformation,u,e.getCastShadow(),!!a.singleUse,n,d,c);h.origin=l||this.getOrigin(h.center,h.bsRadius),h.instanceParameters=t.instanceParameters,r.push(h)},e.prototype.updateRenderGeometryTransformation=function(e,t,r){e.getCombinedStaticTransformation(t,r.transformation),r.updateTransformation(r.transformation)},e.prototype.formatDebugInfo=function(e){var t=[];if(e){for(var i in t[0]="<table>",n){var a=n[i];t[0]+="<tr><td>"+a+'</td><td style="text-align: right">'+Object.keys(this.getAll(a)).length+"</td></tr>"}t[0]+="</table>",t[1]=this.dirtySet.formatDebugInfo(!0)}else{for(var i in t[0]="",n){a=n[i];t[0]+=r.pad(String(Object.keys(this.getAll(a)).length),6," ")+" "+a+", "}t[1]=this.dirtySet.formatDebugInfo(!1)}return t},e.prototype.validateContent=function(){var e=this.getAll(n.OBJECT);for(var t in e)this.validateObject(e[t]);var r=this.getAll(n.LAYER);for(var i in r)this.validateLayer(r[i]);var a=this.getAll(n.MATERIAL);for(var o in a)this.validateMaterial(a[o])},e.prototype.validateObject=function(e){for(var t=e.geometryRecords,r=0;r<t.length;++r){var i=t[r];u(null!=this.get(n.GEOMETRY,i.geometry.id)),u(1===i.materials.length,"object materials do not match geometry groups"),u(null!=this.get(n.MATERIAL,i.materials[0].id))}},e.prototype.validateLayer=function(e){for(var t=e.getObjects(),r=0;r<t.length;++r){var i=this.get(n.OBJECT,t[r].id);u(null!=i)}},e.prototype.validateMaterial=function(e){for(var t=e.getAllTextureIds(),r=0;r<t.length;++r){var i=this.get(n.TEXTURE,t[r]);u(null!=i)}},e.ContentType=n,e}()}.apply(null,i))||(e.exports=n)},725:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(680),r(342),r(742),r(421),r(369),r(816),r(817),r(818),r(819),r(820),r(821),r(822),r(823),r(460),r(824),r(410),r(825),r(826),r(348),r(827),r(837),r(744),r(382),r(841),r(368),r(390),r(376)],void 0===(n=function(e,t,r,i,n,a,o,s,u,l,d,c,h,p,f,g,m,v,y,_,b,x,w,S,T,O,C,M,R){function P(e){if(e.instanceParameters.hidden)return[];var t=e.instanceParameters.componentVisibilities,r=e.componentOffsets;return a.generateVisibleIndexRanges(t,r)}function E(e,t,r){var n=e.origin.vec3;b.setMatrixTranslation3(z,-n[0],-n[1],-n[2]),i.mat4d.multiply(z,e.transformation,t),i.mat4d.inverse(t,r),i.mat4d.transpose(r)}function I(e,t,r){for(var i in e){var n=e[i];t(i,n),n.origin2data.forEach(function(e,t){r(t,e)})}}function A(e){return D(e.data)>=1}function D(e){return!1===e.preinterleaved?b.getFirstObjectValue(e.indices).length:e.indexCount}var F,L=i.mat4d.identity(),N=1535,j=function(){function e(e,t,r,i,n){this._lighting=new w.SceneLighting,this._mat2DataMerged={},this._mat2DataInstanced={},this._mat2DataPreinterleaved={},this._renderOrder=[],this._renderContext=new f,this._isRendering=!1,this._highlights=[],this._threshold=N,this._needsRender=!0,this._fallbackDepthStencilTexture=null,this._stats=new U,this._edgeView=null,this._edgeViewLoaded=!1,this.ssaoEnabled=!1,this.renderOptions={antialiasing:"smaa",earlyOcclusionPixelDraw:!1},this._programRep=e,this._materialRep=t,this._orderedRendering=n,this._rctx=i,this._fxaaPass=new u(i),this._smaaPass=new y(i),this._renderContext.rctx=i,this._renderContext.lightingData=this._lighting.getOld(),i.setDepthTestEnabled(!0),i.setFaceCullingEnabled(!0),i.setBlendingEnabled(!1),i.setBlendFunctionSeparate(770,771,1,771),this._bindParameters={view:null,proj:null,viewInvTransp:null,fovY:0,nearFar:null,lightingData:null,viewport:null,framebufferTex:null,shadowMappingEnabled:!1,ssaoEnabled:!1,origin:null,pixelRatio:null,slicePlane:null},this._linearDepthTextureHelper=new h(i),this._normalTextureHelper=new p(i),this._highlightTextureHelper=new l(i),this._stencilRenderingHelper=new _(i),this._renderPlugins=new m.RenderPluginManager({rctx:i,gl:i.gl,programRep:e,textureRep:r,materialRep:t}),this._initializeFramebufferTexture()}return e.prototype._initializeFramebufferTexture=function(){var e=this._rctx.gl,t=this._rctx.contextAttributes.alpha?e.RGBA:e.RGB,r=new C(this._rctx,{target:3553,pixelFormat:t,dataType:5121,samplingMode:9728,wrapMode:33071,width:4,height:4});this._framebuffer={format:t,texture:r}},e.prototype.dispose=function(){var e=this,t=function(t){e._releaseMaterials(t)},r=function(e,t){if(t.type===F.Preinterleaved)for(var r in t.instances)t.instances[r].vao.dispose(!0);else t.vao.dispose(!0)};I(this._mat2DataMerged,t,r),I(this._mat2DataInstanced,t,r),I(this._mat2DataPreinterleaved,t,r),this._mat2DataMerged=null,this._mat2DataInstanced=null,this._mat2DataPreinterleaved=null,this._framebuffer.texture.dispose(),this._framebuffer.texture=null,this._linearDepthTextureHelper.enabled=!1,this._normalTextureHelper.enabled=!1,this._stencilRenderingHelper.enabled=!1,this._fallbackDepthStencilTexture&&(this._fallbackDepthStencilTexture.dispose(),this._fallbackDepthStencilTexture=null),this._highlightTextureHelper&&(this._highlightTextureHelper.dispose(),this._highlightTextureHelper=null)},Object.defineProperty(e.prototype,"isLoadingResources",{get:function(){return"smaa"===this.renderOptions.antialiasing&&this._smaaPass.isLoadingResources},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"edgeView",{get:function(){var e=this;return this._edgeViewLoaded||(this._edgeViewLoaded=!0,this._edgeView=new x.EdgeView(this._rctx,this._programRep,{setNeedsRender:function(){e._needsRender=!0}}),this._edgeView.initialize()),this._edgeView},enumerable:!0,configurable:!0}),e.prototype.setLighting=function(e){this._lighting.set(e)},Object.defineProperty(e.prototype,"renderPlugins",{get:function(){return this._renderPlugins},enumerable:!0,configurable:!0}),e.prototype.resetNeedsRender=function(){this._needsRender=!1,this._renderPlugins.resetNeedsRender()},e.prototype.needsRender=function(){return this._needsRender||this._renderPlugins.needsRender()},e.prototype.getCombinedStats=function(){var e=this;this._stats.VBOallocatedSize=0,this._stats.VBOoptimalSize=0,this._stats.VBOusedSize=0;var t=function(){},r=function(t,r){if(r.type===F.Preinterleaved)for(var i in r.instances){var n=r.instances[i].vao.size;e._stats.VBOallocatedSize+=n/4,e._stats.VBOusedSize+=n/4,e._stats.VBOoptimalSize+=n/4}else e._stats.VBOallocatedSize+=r.buffer.getArray().length,e._stats.VBOusedSize+=r.buffer.getSize(),e._stats.VBOoptimalSize+=r.optimalCount};return I(this._mat2DataMerged,t,r),I(this._mat2DataInstanced,t,r),I(this._mat2DataPreinterleaved,t,r),this._stats.VBOallocatedSize*=4/1024,this._stats.VBOusedSize*=4/1024,this._stats.VBOoptimalSize*=4/1024,this._stats},e.prototype.getFramebufferTexture=function(e){switch(e){case"linearDepth":return this._linearDepthTextureHelper.framebuffer.colorTexture;case"normals":return this._normalTextureHelper.framebuffer.colorTexture}return null},e.prototype._addHighlight=function(e){var t=this._getInstance(e);null!==t?(this._highlights.push(t),this._orderedRendering&&this._sortHighlightsByRenderOrder(),this._needsRender=!0,this.onHasHighlightsChanged&&this.onHasHighlightsChanged(this.hasHighlights)):console.error("No instance found for RenderGeometry {name: '"+e.name+"', uniqueName: '"+e.uniqueName+"'}")},e.prototype._removeHighlight=function(e){var t=this._highlights.length;this._highlights=this._highlights.filter(function(t){return t.uniqueName!==e.uniqueName}),t!==this._highlights.length&&(this.onHasHighlightsChanged&&this.onHasHighlightsChanged(this.hasHighlights),this._needsRender=!0)},Object.defineProperty(e.prototype,"hasHighlights",{get:function(){return this._highlights.length>0},enumerable:!0,configurable:!0}),e.prototype._renderHUDVisibility=function(e){var t=this,r=S.shouldRenderVisibilityDuringRenderPass(e.pass),i=e.offscreenRenderingHelper&&e.offscreenRenderingHelper.enabled,n=!1;return r&&i&&e.offscreenRenderingHelper.renderHUDVisibility(function(){n=t._renderInternalSlot(v.OCCLUSION_PIXELS,e)}),n},e.prototype.renderGeometrySlotsPt1=function(e){this._renderPlugins.render(v.INTERNAL_MATERIAL,e),this._renderInternalSlot(v.STENCIL_MATERIAL,e),this._renderPlugins.render(v.OPAQUE_TERRAIN,e),this._renderInternalSlot(v.OPAQUE_MATERIAL,e),this._renderPlugins.render(v.OPAQUE_EXTERNAL,e),e.ssaoHelper&&e.ssaoHelper.bindAll(this._programRep),this._renderPlugins.render(v.POSTPROCESSING_ATMOSPHERE_OPAQUE,this._renderContext),this._renderInternalSlot(v.TRANSPARENT_MATERIAL,e),this.renderOptions.earlyOcclusionPixelDraw&&(this._renderHUDVisibility(e),this._renderInternalSlot(v.LINE_CALLOUTS,this._renderContext)),this._renderPlugins.render(v.TRANSPARENT_EXTERNAL,e),e.ssaoHelper&&e.ssaoHelper.bindAll(this._programRep)},e.prototype.renderTransparentTerrain=function(e){return this._renderPlugins.render(v.TRANSPARENT_TERRAIN,e)},e.prototype.renderGeometrySlots=function(e){this.renderGeometrySlotsPt1(e),this.renderTransparentTerrain(e)},e.prototype.renderHUD=function(e){this._bindParameters.renderTransparentlyOccludedHUD=e,this._renderInternalSlot(v.LINE_CALLOUTS_HUD_DEPTH,this._renderContext),this._renderInternalSlot(v.HUDMATERIAL1,this._renderContext),this._renderInternalSlot(v.HUDMATERIAL2,this._renderContext)},e.prototype._renderHighlights=function(e,t){if(t&&t.enabled&&(this.hasHighlights||this._renderPlugins.needsHighlight())){var r=null;t.profilingCallback&&(r=O.startMeasurement(this._renderContext.rctx));var i=e.camera,n=e.fbo;this._highlightTextureHelper.prepareHighlightPass(i),this.renderGeometryPass(g.MATERIAL_HIGHLIGHT,e,null,null,this._renderContext.sliceHelper);var a=this._rctx.gl;this._rctx.clear(a.DEPTH_BUFFER_BIT),this.renderHUD("both"),this._highlightTextureHelper.finish(n);var o=this._highlightTextureHelper.framebuffer;t.render(e,o),null!==r&&t.profilingCallback&&r.stop(function(e){t.profilingCallback&&t.profilingCallback(e)})}},e.prototype._needsRenderOccluded=function(e){for(var t in this._mat2DataInstanced){var r=this._mat2DataInstanced[t][0];if(r&&r.renderOccluded&&r.beginSlot(e)&&r.isVisible())return!0}return!1},e.prototype._renderOccluded=function(e,t,r){if(t&&r&&r.enabled){var i=this._needsRenderOccluded(v.OPAQUE_MATERIAL)||this._needsRenderOccluded(v.TRANSPARENT_MATERIAL);if(t.enabled=i,i){var n=this._renderContext;t.setupFBOs(e),t.prepareColorPass(),n.pass=g.MATERIAL,n.renderOccludedOnly=!0,this._renderInternalSlot(v.OPAQUE_MATERIAL,n),this._renderInternalSlot(v.TRANSPARENT_MATERIAL,n),n.renderOccludedOnly=!1,t.finish(r.framebuffer),t.apply()}}},e.prototype._renderUnordered=function(e,t,r){var i=this,n=this._rctx;this._isRendering=!0,this._stats.reset();var a=e.camera,o=e.fbo,s=e.pixelRatio;this._updateGlobalUniforms(a.projectionMatrix),this._renderContext.pass=g.MATERIAL,this._renderContext.camera=a,this._renderContext.pixelRatio=s,this._renderContext.shadowMap=t,this._renderContext.sliceHelper=r.slice,this._renderContext.ssaoHelper=r.ssao,this._renderContext.offscreenRenderingHelper=r.offscreenRendering,this._renderContext.stencilRenderingHelper=this._stencilRenderingHelper,this._renderContext.depth=this._linearDepthTextureHelper.framebuffer,this._renderContext.normals=this._normalTextureHelper.framebuffer,this._renderContext.highlight=this._highlightTextureHelper.framebuffer,this._renderContext.options=this.renderOptions,r.offscreenRendering.enabled=!0,r.offscreenRendering.initializeFrame(a,o),this._renderPlugins.render(v.BACKGROUND,this._renderContext),this.renderGeometrySlotsPt1(this._renderContext),this._edgeView&&this.edgeView.shouldRender()&&r.offscreenRendering.renderSeparateAndComposite(function(){i._edgeView.render(i._bindParameters)},void 0,"alpha");var u={hudVisibility:!1,transparentTerrain:!1};this.renderOptions.earlyOcclusionPixelDraw||(u.hudVisibility=this._renderHUDVisibility(this._renderContext),this._renderInternalSlot(v.LINE_CALLOUTS,this._renderContext)),u.transparentTerrain=this.renderTransparentTerrain(this._renderContext),u.transparentTerrain&&u.hudVisibility&&(r.offscreenRendering.compositeTransparentTerrainOntoHUDVisibility(),r.offscreenRendering.renderToTargets(function(){return i.renderHUD("occluded")},r.offscreenRendering.mainColor,r.offscreenRendering.tmpDepth,void 0,!0)),u.transparentTerrain&&r.offscreenRendering.compositeTransparentTerrainOntoMain(),r.offscreenRendering.renderToTargets(function(){i._renderPlugins.render(v.POSTPROCESSING_ATMOSPHERE_TRANSPARENT,i._renderContext),i._renderPlugins.render(v.POSTPROCESSING_EXTERNAL,i._renderContext),i._renderOccluded(a,r.renderOccluded,r.offscreenRendering)},r.offscreenRendering.mainColor,r.offscreenRendering.mainDepth);var l=this.renderOptions.antialiasing;"smaa"===l&&this._smaaPass.loadResources(function(){i._needsRender=!0}),"smaa"===l&&this._smaaPass.enable()?(this._fxaaPass.disable(),this._smaaPass.render({colorTexture:r.offscreenRendering.colorTexture},o)):"fxaa"===l&&this._fxaaPass.enable()?(this._smaaPass.disable(),this._fxaaPass.render({colorTexture:r.offscreenRendering.colorTexture},o)):(r.offscreenRendering.composite(),this._fxaaPass.disable(),this._smaaPass.disable()),n.bindFramebuffer(o),this._renderContext.framebufferTex=r.offscreenRendering.colorTexture,this.renderHUD("notOccluded"),this._renderHighlights(e,r.highlight),this._isRendering=!1},e.prototype._renderGeometryPassOrderedHighlight=function(e){this._renderInternalHighlights()},e.prototype._renderGeometryPassOrderedMaterial=function(e){for(var t=null,r=0;r<this._renderOrder.length;r++){var i,n,a=this._renderOrder[r][1];if(a.instanced)(n=(i=a.instanced||a.merged)[e.pass])&&n.isVisible()&&(this._renderInternalInstanced(i,n,this._bindParameters,1/0),t=null);if(a.merged)if((n=(i=a.merged)[e.pass])&&n.isVisible()){var o=n.getProgram();o!==t&&(o.setUniformMatrix4fv("model",L),o.hasUniform("modelNormal")&&o.setUniformMatrix4fv("modelNormal",L)),t=o,this._renderInternalMerged(i,n,this._bindParameters,1/0)}}},e.prototype._renderGeometryPassOrdered=function(e){var t=e.camera;this._bindParameters.view=t.viewMatrix,this._bindParameters.proj=t.projectionMatrix,this._bindParameters.viewInvTransp=t.viewInverseTransposeMatrix,k[0]=t.near,k[1]=t.far,this._bindParameters.nearFar=k,this._bindParameters.lightingData=e.lightingData,this._bindParameters.viewport=t.fullViewport,this._bindParameters.framebufferTex=this._framebuffer.texture,this._bindParameters.pixelRatio=e.pixelRatio,this._bindParameters.slicePlane=e.sliceHelper&&e.sliceHelper.plane,e.isHighlightPass?this._renderGeometryPassOrderedHighlight(e):this._renderGeometryPassOrderedMaterial(e)},e.prototype._renderOrdered=function(e,t){this._stats.reset(),this.renderGeometryPass(e,t)},e.prototype.prepareRender=function(e){this._renderPlugins.prepareRender(e),this._renderContext.rctx.setDepthFunction(513)},e.prototype.render=function(e,t){this._orderedRendering?this._renderOrdered(g.MATERIAL,e):this._renderUnordered(e,t.shadowMap,t)},e.prototype.renderAuxiliaryBuffers=function(e,t){var r=t.ssao,i=t.slice,n=t.shadowMap,a=this.ssaoEnabled||this._renderPlugins.needsLinearDepth(),o=e.camera,s=e.fbo;this._linearDepthTextureHelper.enabled=a,a&&(this._linearDepthTextureHelper.setupFBOs(o),this._linearDepthTextureHelper.prepareDepthPass(),this.renderGeometryPass(g.MATERIAL_DEPTH,e,n,r,i),this._linearDepthTextureHelper.finish(s)),this._normalTextureHelper.enabled=this.ssaoEnabled,this.ssaoEnabled&&(this._normalTextureHelper.setupFBOs(o),this._normalTextureHelper.prepareNormalPass(),this.renderGeometryPass(g.MATERIAL_NORMAL,e,n,r,i),this._normalTextureHelper.finish(s),r.computeSSAO(o,s,this._linearDepthTextureHelper.framebuffer,this._normalTextureHelper.framebuffer)),r.bindAll(this._programRep)},e.prototype.renderGeometryPass=function(e,t,r,i,n){this._isRendering=!0;var a=t.camera,o=t.pixelRatio;this._updateGlobalUniforms(a.projectionMatrix),this._renderContext.pass=e,this._renderContext.camera=a,this._renderContext.pixelRatio=o,this._renderContext.shadowMap=r,this._renderContext.ssaoHelper=i,this._renderContext.depth=this._linearDepthTextureHelper.framebuffer,this._renderContext.normals=this._normalTextureHelper.framebuffer,this._renderContext.sliceHelper=n,this._orderedRendering?this._renderGeometryPassOrdered(this._renderContext):this._renderGeometryPassUnordered(this._renderContext),this._isRendering=!1},e.prototype._renderGeometryPassUnordered=function(e){this.renderGeometrySlots(e)},e.prototype._renderInternalHighlights=function(e){void 0===e&&(e=null);for(var t=!1,r=0;r<this._highlights.length;++r){var i=this._highlights[r],n=i.matData[g.MATERIAL_HIGHLIGHT];n&&(null===e||n.beginSlot(e))&&n.isVisible()&&(t=this._renderInternalHighlight(i,this._bindParameters,g.MATERIAL_HIGHLIGHT)||t)}return t},e.prototype._renderInternalSlotOccluded=function(e,t){var r=!1;for(var i in this._mat2DataInstanced){var n=this._mat2DataInstanced[i],a=n[t.pass];a&&a.renderOccluded&&a.beginSlot(e)&&a.isVisible()&&(r=this._renderInternalInstanced(n,a,this._bindParameters,e)||r)}return r},e.prototype._renderInternalSlotMaterial=function(e,t){var r=!1;for(var i in this._mat2DataInstanced){(l=(u=this._mat2DataInstanced[i])[t.pass])&&l.beginSlot(e)&&l.isVisible()&&(r=this._renderInternalInstanced(u,l,this._bindParameters,e)||r)}for(var n=this._programRep.getProgramsUsingUniform("model"),a=this._programRep.getProgramsUsingUniform("modelNormal"),o=0;o<n.length;o++){var s=n[o];s.setUniformMatrix4fv("model",L),a.indexOf(s)>-1&&s.setUniformMatrix4fv("modelNormal",L)}for(var i in this._mat2DataMerged){(l=(u=this._mat2DataMerged[i])[t.pass])&&l.beginSlot(e)&&l.isVisible()&&(r=this._renderInternalMerged(u,l,this._bindParameters,e)||r)}for(var i in this._mat2DataPreinterleaved){var u,l;(l=(u=this._mat2DataPreinterleaved[i])[t.pass])&&l.beginSlot(e)&&l.isVisible()&&(r=this._renderInternalPreinterleaved(u,l,this._bindParameters,e)||r)}return e===v.STENCIL_MATERIAL&&this._stencilRenderingHelper.finish(),r},e.prototype._renderInternalSlotHighlights=function(e,t){return this._renderInternalHighlights(e)},e.prototype._renderInternalSlot=function(e,t){this._bindParameters.view=t.camera.viewMatrix,this._bindParameters.proj=t.camera.projectionMatrix,this._bindParameters.viewInvTransp=t.camera.viewInverseTransposeMatrix,this._bindParameters.cameraAboveGround=t.camera.aboveGround,this._bindParameters.fovY=t.camera.fovY,k[0]=t.camera.near,k[1]=t.camera.far;var r=this._renderContext.offscreenRenderingHelper;return this._bindParameters.nearFar=k,this._bindParameters.lightingData=t.lightingData,this._bindParameters.viewport=t.camera.fullViewport,this._bindParameters.framebufferTex=r?r.colorTexture:null,this._bindParameters.shadowMap=t.shadowMap,this._bindParameters.shadowMappingEnabled=!!t.shadowMap&&t.shadowMap.enabled,this._bindParameters.ssaoEnabled=!!t.ssaoHelper&&t.ssaoHelper.enabled,this._bindParameters.pixelRatio=t.pixelRatio,this._bindParameters.slicePlane=t.sliceHelper&&t.sliceHelper.plane,this._bindParameters.hudVisibilityTexture=r?r.hudVisibilityTexture:null,t.isHighlightPass?this._renderInternalSlotHighlights(e,t):t.renderOccludedOnly?this._renderInternalSlotOccluded(e,t):this._renderInternalSlotMaterial(e,t)},e.prototype._renderInternalInstanced=function(e,t,r,i){var n=this,a=this._rctx,o=a.gl,s=!1,u=t.getDrawMode(a),l=a.capabilities.instancing,d=!1;return e.origin2data.forEach(function(e){r.origin=e.origin,i===v.STENCIL_MATERIAL&&(n._stencilRenderingHelper.enabled=!0,n._stencilRenderingHelper.prepareStencilWritePass());var c=!1;if(t.instanced)for(var h in e.perGeometryDataInfo){var p=e.perGeometryDataInfo[h];s||(t.bind(a,r),s=!0),a.bindVAO(p.vao);var f=t.getProgram();M.assertCompatibleVertexAttributeLocations(p.vao,f),c||(t.bindView(a,r),c=!0);var g=p.to-p.from,m=p.refCount;u===o.TRIANGLES&&(n._stats.trianglesRendered+=m*g/3),l.drawArraysInstanced(u,p.from,g,m),d=!0,n._stats.drawCallsAngleInstanced++,n._stats.instancesDrawnAngle+=m}else{var y=e.instances;for(var _ in y){var b=y[_],x=b.displayedIndexRange;x&&0===x.length||(s||(t.bind(a,r),s=!0),c||(a.bindVAO(e.vao),t.bindView(a,r),c=!0),t.bindInstance(a,b),n._stats.drawCallsInstanced++,u===o.TRIANGLES&&(n._stats.trianglesRendered+=(b.to-b.from)/3),x?n._drawArraysFaceRange(x,b.from,u):a.drawArrays(u,b.from,b.to-b.from),d=!0)}}}),a.bindVAO(null),s&&t.release(a,r),d},e.prototype._renderInternalHighlight=function(e,t,r){var i=this._rctx,n=i.gl,a=e.matData[r],o=a.getDrawMode(i),s=e.instance,u=s.highlightedIndexRange,l=this._renderContext.offscreenRenderingHelper,d=(l?l.depthTexture:null)||this._getFallbackDepthTexture(),c=a.getProgram(),h=i.capabilities.instancing;t.origin=e.originData.origin;var p=!1;if(a.instanced&&e.type===F.Instanced){var f=e.instancedVAO;a.bind(i,t),i.bindVAO(f),M.assertCompatibleVertexAttributeLocations(f,c),a.bindView(i,t);for(var g=0;g<u.length;g++){var m=(b=u[g]).range?b.range[0]+s.from:s.from,v=b.range?b.range[1]-b.range[0]+1:s.to-s.from;i.bindTexture(d,5),c.setUniform1i("depthTex",5),c.setUniform4f("highlightViewportPixelSz",0,0,1/this._bindParameters.viewport[2],1/this._bindParameters.viewport[3]),h.drawArraysInstanced(o,m,v,1),o===n.TRIANGLES&&(this._stats.trianglesRendered+=1*v/3),this._stats.drawCallsHighlight++,p=!0}}else if(e.type===F.Instanced&&a.instanced)console.error("_renderInternalHighlight: incompatible instance type");else{a.bind(i,t),a.bindView(i,t);var y=null;switch(e.type){case F.Merged:var _=e.originData;i.bindVAO(_.vao),c.setUniformMatrix4fv("model",L);break;case F.Instanced:_=e.originData;i.bindVAO(_.vao),a.bindInstance(i,s);break;case F.Preinterleaved:f=(_=e.originData).instances[e.uniqueName].vao;i.bindVAO(f),a.bindInstance(i,s),y=f.indexBuffer&&f.indexBuffer.indexType}for(g=0;g<u.length;g++){var b;m=(b=u[g]).range?b.range[0]+s.from:s.from,v=b.range?b.range[1]-b.range[0]+1:s.to-s.from;if(i.bindTexture(d,5),a.getProgram().setUniform1i("depthTex",5),c.setUniform4f("highlightViewportPixelSz",0,0,1/this._bindParameters.viewport[2],1/this._bindParameters.viewport[3]),y){var x=M.getBytesPerElement(y);i.drawElements(o,v,y,m*x)}else i.drawArrays(o,m,v);o===n.TRIANGLES&&(this._stats.trianglesRendered+=v/3),this._stats.drawCallsHighlight++,p=!0}}return i.bindVAO(null),a.release(i,t),p},e.prototype._drawArraysFaceRange=function(e,t,r){for(var i=this._rctx,n=0,a=e;n<a.length;n++){var o=a[n];i.drawArrays(r,o[0]+t,o[1]-o[0]+1)}this._stats.drawCallsFragmented+=e.length-1},e.prototype._drawElementsFaceRange=function(e,t,r,i){for(var n=this._rctx,a=M.getBytesPerElement(i),o=0,s=e;o<s.length;o++){var u=s[o],l=u[1]-u[0]+1,d=u[0]+t;n.drawElements(r,l,i,d*a)}this._stats.drawCallsFragmented+=e.length-1},e.prototype._renderInternalMerged=function(e,t,r,i){var n=this,a=this._rctx,o=a.gl,s=!1,u=!1;return e.origin2data.forEach(function(e){if(r.origin=e.origin,i===v.STENCIL_MATERIAL&&(n._stencilRenderingHelper.enabled=!0,n._stencilRenderingHelper.prepareStencilWritePass()),!e.displayedIndexRange||0!==e.displayedIndexRange.length){u||(t.bind(a,r),u=!0);var l=t.getProgram();a.bindVAO(e.vao),M.assertCompatibleVertexAttributeLocations(e.vao,l),t.bindView(a,r),n._stats.drawCallsMerged++;var d=t.getDrawMode(a);d===o.TRIANGLES&&(n._stats.trianglesRendered+=e.vao.vertexBuffers.geometry.size/3),e.displayedIndexRange?n._drawArraysFaceRange(e.displayedIndexRange,0,d):a.drawArrays(d,0,M.vertexCount(e.vao,"geometry")),s=!0}}),u&&t.release(a,r),s},e.prototype._renderInternalPreinterleaved=function(e,t,r,i){var n=this,a=this._rctx,o=a.gl,s=!1,u=!1,l=t.getDrawMode(a);return e.origin2data.forEach(function(e){r.origin=e.origin;var d=!1;for(var c in i===v.STENCIL_MATERIAL&&(n._stencilRenderingHelper.enabled=!0,n._stencilRenderingHelper.prepareStencilWritePass()),e.instances){var h=e.instances[c],p=h.instance,f=h.vao,g=p.displayedIndexRange;if(!g||0!==g.length){u||(t.bind(a,r),u=!0);var m=t.getProgram();M.assertCompatibleVertexAttributeLocations(f,m),a.bindVAO(f),d||(t.bindView(a,r),d=!0),t.bindInstance(a,p),n._stats.drawCallsPreinterleaved++,l===o.TRIANGLES&&(n._stats.trianglesRendered+=(p.to-p.from)/3);var y=f.indexBuffer&&f.indexBuffer.indexType;if(g)y?n._drawElementsFaceRange(g,p.from,l,y):n._drawArraysFaceRange(g,p.from,l);else if(y){var _=M.getBytesPerElement(y);a.drawElements(l,p.to-p.from,y,p.from*_)}else a.drawArrays(l,p.from,p.to-p.from);s=!0}}}),a.bindVAO(null),u&&t.release(a,r),s},e.prototype._updateGlobalUniforms=function(e){for(var t=this._programRep.getProgramsUsingUniform("proj"),r=0;r<t.length;r++)t[r].setUniformMatrix4fv("proj",e);if(this._lighting){t=this._programRep.getProgramsUsingUniform("lightingMainDirection");for(r=0;r<t.length;r++)this._lighting.setUniforms(t[r]);t=this._programRep.getProgramsUsingUniform("lightDirection");for(r=0;r<t.length;r++)this._lighting.setUniforms(t[r])}},e.prototype.print=function(){var e=Object.keys(this._mat2DataMerged).length,t=Object.keys(this._mat2DataInstanced).length,r=Object.keys(this._mat2DataPreinterleaved).length;console.log("number of materials (merged/instanced/preinterleaved): "+e+"/"+t+"/"+r);var i=0;I(this._mat2DataMerged,function(){},function(e,t){i+=Object.keys(t.instances).length});var n=0;I(this._mat2DataInstanced,function(){},function(e,t){n+=Object.keys(t.instances).length});var a=0;I(this._mat2DataPreinterleaved,function(){},function(e,t){a+=Object.keys(t.instances).length}),console.log("number of instances (merged/instanced/preinterleaved): "+i+"/"+n+"/"+a)},e.prototype.isEmpty=function(){for(var e in this._mat2DataInstanced){var t=this._mat2DataInstanced[e];if(!r.everyMap(t.origin2data,function(e){return b.objectEmpty(e.instances)}))return!1}for(var e in this._mat2DataMerged){t=this._mat2DataMerged[e];if(!r.everyMap(t.origin2data,function(e){return b.objectEmpty(e.instances)}))return!1}for(var e in this._mat2DataPreinterleaved){t=this._mat2DataPreinterleaved[e];if(!r.everyMap(t.origin2data,function(e){return b.objectEmpty(e.instances)}))return!1}return!0},e.prototype.modify=function(e,t,r,i){this._isRendering&&console.warn("Renderer.modify called while rendering");var n=[],a=[],o=[];this._classifyRenderGeometry(e,n,a,o);var s=[],u=[],l=[];this._classifyRenderGeometry(t,s,u,l);var d={};r&&this._performUpdates(r,d);var c=[];this._modifyMerged(n,s,c,d),this._modifyInstanced(a,u,c),this._modifyPreinterleaved(o,l,c),this._updateMergedFaceranges(d),this._releaseMaterials(c);var h=this._highlights.length;t&&t.length>0&&h>0&&(this._highlights=this._highlights.filter(function(e){return!t.some(function(t){return t.uniqueName===e.uniqueName})}),h!==this._highlights.length&&this.onHasHighlightsChanged&&this.onHasHighlightsChanged(this.hasHighlights)),this._updateHighlightVAOs(),i&&this._modifyMaterials(i),this._needsRender=!0},e.prototype._classifyRenderGeometry=function(e,t,r,i){for(var n=0,a=e;n<a.length;n++){var o=a[n];if(A(o))switch(this._getType(o)){case F.Merged:t.push(o);break;case F.Instanced:r.push(o);break;case F.Preinterleaved:i.push(o)}}},e.prototype._performUpdates=function(e,t){for(var r=0,i=e;r<i.length;r++){var n=i[r],a=n.updateType,o=n.renderGeometry,s=this._getType(o)===F.Merged;if(A(o)){if(2&a&&this._updateFaceranges(o,t),32&a){var u=this._getInstance(o);u&&this._updateHighlightFaceranges(o,u.instance)}4&a||s&&16&a?this._updateVertexAttributes(o,!s):!s&&16&a&&this._updateInstanceTransformation(o)}}},e.prototype._updateFaceranges=function(e,t){var r,i,n=e.material.id,a=e.origin.id,o=this._getType(e);o===F.Preinterleaved?r=(i=this._getOriginData(o,n,a)).instances[e.uniqueName].instance:(r=(i=this._getOriginData(o,n,a)).instances[e.uniqueName])&&o===F.Merged&&(t[this._modifiedMergedFacerangesKey(n,a)]=i);r&&(r.displayedIndexRange=P(e),this._updateHighlightFaceranges(e,r))},e.prototype._updateHighlightFaceranges=function(e,t){if(t){var r=t.highlightedIndexRange,i=function(e){if(e.instanceParameters.hidden)return null;var t=e.instanceParameters.componentVisibilities,r=e.instanceParameters.componentHighlights,i=e.componentOffsets;return a.generateHighlightedIndexRanges(t,r,i)}(e);t.highlightedIndexRange=i,i&&!r?this._addHighlight(e):!i&&r&&this._removeHighlight(e)}},e.prototype._updateMergedFaceranges=function(e){for(var t in e){var r=e[t];r.displayedIndexRange=[];var i=r.instances,n=!0;for(var a in i){var o=i[a];o.displayedIndexRange?(r.displayedIndexRange.push.apply(r.displayedIndexRange,c.offsetIntervals(o.displayedIndexRange,o.from)),n=!1):r.displayedIndexRange.push([o.from,o.to-1])}r.displayedIndexRange=n?null:c.mergeIntervals(r.displayedIndexRange)}},e.prototype._updateVertexAttributes=function(e,t){var r=e.material,i=r.bufferWriter,n=r.id,a=e.origin.id,o=i.vertexBufferLayout.stride/4,s=this._getType(e);if(s!==F.Preinterleaved){var u,l,d=this._getOriginData(s,n,a),c=d.instances[e.uniqueName],h=d.buffer.getArray(),p=d.vao;t||(E(e,G,H),u=G,l=H),i.write({transformation:u,invTranspTransformation:l},e.data,e.instanceParameters,i.vertexBufferLayout.createView(h.buffer),c.from),b.assert(c.from+i.elementCount(e.data)===c.to,"material VBO layout has changed"),p.vertexBuffers.geometry.setSubData(h,c.from*o*4,c.from*o*4,c.to*o*4)}else console.error("Updating Preinterleaved geometry not supported")},e.prototype._updateInstanceTransformation=function(e){var t=this._getType(e),r=e.material.id,i=e.origin.id;if(t===F.Preinterleaved){E(e,(a=(n=this._getOriginData(t,r,i)).instances[e.uniqueName].instance).transformation,a.transformationNormal)}else{var n,a=(n=this._getOriginData(t,r,i)).instances[e.uniqueName],o=n.perGeometryDataInfo[e.data.id],s=o.instanceBufferData;if(E(e,a.transformation,a.transformationNormal),s){var u=s.getSlot(e.idx);s.fill(u,0,a.transformation),s.fill(u,16,a.transformationNormal);var l=4*s.getOffset(u),d=M.getStride(o.vao.layout.instance);o.vao.vertexBuffers.instance.setSubData(s.getArray(),l,l,l+d)}}},e.prototype._modifyMerged=function(e,t,r,i){var n=this._compMatToDelta(e,t,F.Merged),a=this._mat2DataMerged;for(var o in n){var s=n[o];for(var u in s){var l=s[u],d=l.optimalCount,c=l.sparseCount,h=l.material,p=h.bufferWriter.vertexBufferLayout,f=p.stride/4,g=a[o];null==g&&(b.assert(d>0),g=this._initializeMatData(h),a[o]=g,this._orderedRendering&&this._insertIntoRenderOrder(g,h.renderPriority,"merged"));var m=g.origin2data.get(u);if(null==m&&(b.assert(d>0),m=this._createMergedData(p,d,l.origin),g.origin2data.set(u,m)),0===d)m.vao.dispose(!0),m.vao=null,g.origin2data.delete(u),0===g.origin2data.size&&(r.push(o),delete a[o],this._orderedRendering&&this._removeFromRenderOrder(g,"merged"));else{var v=d<l.sparseCount/2,y=v?d:c,_=V,x=m.buffer.getSize(),w=m.buffer.getArray(),S=m.buffer.resize(y);v||S?this._rebuildMerged(m,l.toRemove,f,w,_):l.toRemove.length>0?(this._removeMergedByErasing(m,l.toRemove,f,_),l.toAdd.length>0&&(_.end=x)):(_.begin=x,_.end=x);var T=z;b.setMatrixTranslation3(T,-l.origin[0],-l.origin[1],-l.origin[2]),this._appendMerged(m,h,l.toAdd,f,T,_);var O=m.vao.vertexBuffers.geometry;if(O.byteSize!==m.buffer.getArray().buffer.byteLength)O.setData(m.buffer.getArray());else{var C=_.begin,M=_.end;if(C<M){var R=m.buffer.getArray(),P=4*C,E=4*M;O.setSubData(R,P,P,E)}}(_.updatedDisplayedIndexRange||m.displayedIndexRange)&&(i[this._modifiedMergedFacerangesKey(o,u)]=m)}}}},e.prototype._createMergedData=function(e,t,r){return{type:F.Merged,instances:{},vao:new R(this._rctx,o.Default3D,{geometry:n.glLayout(e)},{geometry:T.createVertex(this._rctx,35044)}),buffer:new s(t),optimalCount:0,origin:r}},e.prototype._rebuildMerged=function(e,t,r,i,n){for(var a=0;a<t.length;++a){var o=e.instances[t[a].uniqueName];e.optimalCount-=(o.to-o.from)*r,delete e.instances[t[a].uniqueName]}var s=0,u=e.buffer.getArray();n.begin=0,n.end=0;var l=-1,d=-1,c=0;for(var h in e.instances){var p=(o=e.instances[h]).from*r,f=o.to*r,g=f-p;l!==d&&d!==p?(u.set(i.subarray(l,d),c),c+=d-l,l=p):-1===l&&(l=p),d=f,o.from=s/r,s+=g,o.to=s/r}l!==d&&u.set(i.subarray(l,d),c),n.end=s},e.prototype._removeMergedByErasing=function(e,t,r,i){if(0!==t.length){i.begin=1/0,i.end=-1/0;for(var n=-1,a=-1,o=0,s=t;o<s.length;o++){var u=s[o].uniqueName,l=e.instances[u].from*r,d=e.instances[u].to*r;n!==a&&a!==l?(e.buffer.erase(n,a),n=l):-1===n&&(n=l),a=d,delete e.instances[u],e.optimalCount-=d-l,l<i.begin&&(i.begin=l),d>i.end&&(i.end=d)}n!==a&&e.buffer.erase(n,a)}},e.prototype._appendMerged=function(e,t,r,n,a,o){o.updatedDisplayedIndexRange=!1;for(var s=t.bufferWriter,u=0,l=r;u<l.length;u++){var d=l[u],c=d.data;i.mat4d.multiply(a,d.transformation,G),i.mat4d.inverse(G,H),i.mat4d.transpose(H);var h=o.end;s.write({transformation:G,invTranspTransformation:H},c,d.instanceParameters,s.vertexBufferLayout.createView(e.buffer.getArray().buffer),o.end/n);var p=s.elementCount(c)*n,f=h+p;b.assert(null==e.instances[d.uniqueName]);var g=P(d),m=new B(d.name,h/n,f/n,g,void 0,void 0,d.idx);e.instances[d.uniqueName]=m,this._updateHighlightFaceranges(d,m),g&&(o.updatedDisplayedIndexRange=!0),e.optimalCount+=p,o.end+=p}},e.prototype._modifyInstanced=function(e,t,r){var a=this._rctx,u=F.Instanced,l=this._compMatToDelta(e,t,u),c=this._mat2DataInstanced;for(var h in l){var p=l[h];for(var f in p){var m=p[f];if(0!==m.optimalCount){var v=m.material,y=v.bufferWriter,_=c[h];if(null==_){var x=v.renderPriority;_=this._initializeMatData(v),c[h]=_,this._orderedRendering&&this._insertIntoRenderOrder(_,x,"instanced")}var w=y.vertexBufferLayout,S=_[g.MATERIAL].instanced?y.instanceBufferLayout:void 0,O=S&&S.fields.get("instanceColor"),C=S&&S.fields.get("instanceFeatureAttribute"),M=w.stride/4,E=_.origin2data.get(f);null==E&&(E={type:u,instances:{},vao:new R(a,o.Default3D,{geometry:n.glLayout(w)},{geometry:T.createVertex(a,35044)}),buffer:new s(m.optimalCount),optimalCount:0,perGeometryDataInfo:{},origin:m.origin},_.origin2data.set(f,E));var I=E.buffer.getSize(),A=E.buffer.getArray(),D=m.optimalCount<m.sparseCount/2,L=E.buffer.resize(D?m.optimalCount:m.sparseCount);for(var N in m.perGeometryDelta){if(($=E.perGeometryDataInfo[N])&&$.instanceBufferData){var j=m.perGeometryDelta[N].removeCount;j>0&&$.instanceBufferData.prepareFree(j)}}var U=m.toRemove;if(D||L){for(var V=0;V<U.length;++V){var k=U[V];delete E.instances[k.uniqueName];N=k.data.id;0==--(W=$=E.perGeometryDataInfo[N]).refCount&&null==m.dataId2refCount[N]?(E.optimalCount-=(W.to-W.from)*M,delete E.perGeometryDataInfo[N]):$.instanceBufferData&&$.instanceBufferData.free(k.idx)}I=0;var G=E.buffer.getArray(),H={};for(var q in E.perGeometryDataInfo){var W=E.perGeometryDataInfo[q];b.assert(null==H[W.from]),H[W.from]=W}for(var Q in H){var X=(W=H[Q]).from*M,Y=W.to*M;G.set(A.subarray(X,Y),I),W.from=I/M,I+=Y-X,W.to=I/M}for(var Z in E.instances){(ae=E.instances[Z]).from=E.perGeometryDataInfo[ae.dataId].from,ae.to=E.perGeometryDataInfo[ae.dataId].to}}else for(V=0;V<U.length;++V){k=U[V];delete E.instances[k.uniqueName];N=k.data.id;if(0==--($=E.perGeometryDataInfo[N]).refCount&&null==m.dataId2refCount[N]){X=$.from*M,Y=$.to*M;E.buffer.erase(X,Y),E.optimalCount-=Y-X,delete E.perGeometryDataInfo[N]}else $.instanceBufferData&&$.instanceBufferData.free(k.idx)}for(var N in b.setMatrixTranslation3(z,-m.origin[0],-m.origin[1],-m.origin[2]),m.perGeometryDelta){if(($=E.perGeometryDataInfo[N])&&$.instanceBufferData){var K=m.perGeometryDelta[N].addCount;K>0&&$.instanceBufferData.prepareAllocate(K)}}var J=m.toAdd;for(V=0;V<J.length;++V){var $,ee=(k=J[V]).data;N=ee.id;if(null==($=E.perGeometryDataInfo[N])){y.write({},ee,void 0,y.vertexBufferLayout.createView(E.buffer.getArray().buffer),I/M);var te=y.elementCount(ee)*M;X=I/M,Y=(I+=te)/M;if(E.optimalCount+=te,$={refCount:1,from:X,to:Y,vao:null,instanceBufferData:null},S){var re=S.stride/4;$.vao=new R(a,o.Default3D,{geometry:n.glLayout(w),instance:n.glLayout(S,{divisor:1})},{geometry:E.vao.vertexBuffers.geometry,instance:T.createVertex(a,35044)}),$.instanceBufferData=new d(re,m.perGeometryDelta[N].addCount)}E.perGeometryDataInfo[N]=$}else++$.refCount;b.assert($.from*M<=E.buffer.getSize()&&$.to*M<=E.buffer.getSize());var ie=i.mat4d.create();i.mat4d.multiply(z,k.transformation,ie);var ne=P(k),ae=new B(k.name,$.from,$.to,ne,ie,k.instanceParameters,k.idx,N);E.instances[k.uniqueName]=ae,this._updateHighlightFaceranges(k,ae);var oe=$.instanceBufferData;if(oe){var se=oe.allocate(k.idx);oe.fill(se,0,ae.transformation),oe.fill(se,16,ae.transformationNormal),O&&oe.fill(se,O.offset/4,k.instanceParameters.color),C&&oe.fill(se,C.offset/4,k.instanceParameters.featureAttribute)}}b.assert(E.optimalCount===m.optimalCount);var ue=new Float32Array(E.buffer.getArray().buffer,0,E.buffer.getSize());for(var N in E.vao.vertexBuffers.geometry.setData(ue),E.perGeometryDataInfo){var le=E.perGeometryDataInfo[N];if(le.vao){var de=le.vao.vertexBuffers.instance;if(de){var ce=m.perGeometryDelta[N];if(ce.addCount+ce.removeCount>0){var he=le.instanceBufferData.compact();de.setData(he)}}}}}else{var pe=c[h];pe.origin2data.get(f).vao.dispose(!0),pe.origin2data.delete(f),0===pe.origin2data.size&&(r.push(h),delete c[h],this._orderedRendering&&this._removeFromRenderOrder(pe,"instanced"))}}}},e.prototype._modifyPreinterleaved=function(e,t,r){for(var a=this._rctx,s=F.Preinterleaved,u=this._mat2DataPreinterleaved,l=0,d=e;l<d.length;l++){var c=(A=(I=d[l]).material).bufferWriter,h=A.id,p=I.origin.id,f=I.origin.vec3;null==(D=u[h])&&(D=this._initializeMatData(A),u[h]=D);var g=D.origin2data.get(p);null==g&&(g={type:s,origin:f,count:0,instances:{}},D.origin2data.set(p,g)),b.setMatrixTranslation3(z,-f[0],-f[1],-f[2]);var m=i.mat4d.create();i.mat4d.multiply(z,I.transformation,m);var v=P(I),y=I.data;if(y.preinterleaved)if(null!=y.vertexData){var _=y.indexCount,x=y.id,w=new B(I.name,0,_,v,m,I.instanceParameters,I.idx,x),S=y.indexData?T.createIndex(a,35044,y.indexData):null,O=c.vertexBufferLayout,C=new R(a,o.Default3D,{geometry:n.glLayout(O)},{geometry:T.createVertex(a,35044)},S);C.vertexBuffers.geometry.setData(y.vertexData),y.indexData=null,y.vertexData=null,g.count+=1,g.instances[I.uniqueName]={instance:w,vao:C},this._updateHighlightFaceranges(I,w)}else b.assert(!1,"Trying to re-add preinterleaved geometry data which is no longer available.");else b.assert(!1,"Non-interleaved render geometry processed as pre-interleaved")}for(var M=0,E=t;M<E.length;M++){f=(I=E[M]).origin,h=(A=I.material).id,p=f.id;var I,A,D,L=I.uniqueName,N=(D=u[h]).origin2data.get(p);N.instances[L].vao.dispose(),delete N.instances[L],N.count-=1,0===N.count&&D.origin2data.delete(p),0===D.origin2data.size&&(r.push(h),delete u[h])}},e.prototype._compMatToDelta=function(e,t,r){var i={};return this._updateMatToDelta(e,!0,r,i),this._updateMatToDelta(t,!1,r,i),i},e.prototype._updateMatToDelta=function(e,t,r,i){for(var n=r===F.Instanced,a=0,o=e;a<o.length;a++){var s=o[a],u=s.origin,l=s.material,d=l.bufferWriter,c=l.id,h=n?this._mat2DataInstanced[c]:this._mat2DataMerged[c],p=h&&h.origin2data.get(u.id),f=i[c];null==f&&(f={},i[c]=f);var g=f[u.id];if(null==g){if(g={optimalCount:null==p?0:p.optimalCount,sparseCount:null==p?0:p.buffer.getSize(),material:l,toAdd:[],toRemove:[],perGeometryDelta:null,origin:u.vec3},n){var m={};if(void 0!==p)for(var v in p.perGeometryDataInfo)m[v]=p.perGeometryDataInfo[v].refCount;g.dataId2refCount=m,g.perGeometryDelta={}}f[u.id]=g}var y=d.vertexBufferLayout.stride/4,_=d.elementCount(s.data)*y;if(n){var b=s.data.id,x=g.perGeometryDelta[b];x||(x={addCount:0,removeCount:0},g.perGeometryDelta[b]=x),t?(x.addCount++,null==g.dataId2refCount[b]&&(g.dataId2refCount[b]=0),1==++g.dataId2refCount[b]&&(g.optimalCount+=_,g.sparseCount+=_),g.toAdd.push(s)):(x.removeCount++,0==--g.dataId2refCount[b]&&(delete g.dataId2refCount[b],g.optimalCount-=_),g.toRemove.push(s))}else t?(g.optimalCount+=_,g.sparseCount+=_,g.toAdd.push(s)):(g.optimalCount-=_,g.toRemove.push(s))}},e.prototype._getType=function(e){if(e.data.preinterleaved)return F.Preinterleaved;var t=!1,r=D(e.data);return t=(t=(t=t||!1===e.material.canBeMerged)||e.material.instanced)||!0===e.material.renderOccluded,e.singleUse||(t=t||r>this._threshold),t?F.Instanced:F.Merged},e.prototype._getTargetMat2Data=function(e){switch(e){case F.Merged:return this._mat2DataMerged;case F.Instanced:return this._mat2DataInstanced;case F.Preinterleaved:return this._mat2DataPreinterleaved}},e.prototype._getOriginData=function(e,t,r){return this._getTargetMat2Data(e)[t].origin2data.get(r)},e.prototype._modifiedMergedFacerangesKey=function(e,t){return e+"_"+t},e.prototype._insertIntoRenderOrder=function(e,t,r){for(var i=e[g.MATERIAL].materialId,n=this._renderOrder.length,a=0;a<n&&this._renderOrder[a][0]>=t;){var o=this._renderOrder[a][1];if(o.id===i)return b.assert(!o[r],"matData for type already exists"),void(o[r]=e);a++}var s={id:i,instanced:null,merged:null};s[r]=e,this._renderOrder.splice(a,0,[t,s])},e.prototype._removeFromRenderOrder=function(e,t){for(var r=e[g.MATERIAL].materialId,i=0;this._renderOrder[i][1].id!==r;)i++;var n=this._renderOrder[i][1];n[t]=null,n.instanced||n.merged||this._renderOrder.splice(i,1)},e.prototype._sortHighlightsByRenderOrder=function(){this._highlights.sort(function(e,t){var r=e.matData[g.MATERIAL].renderPriority,i=t.matData[g.MATERIAL].renderPriority;return r>i?-1:i>r?1:0})},e.prototype._updateRenderOrder=function(e,t){for(var r=t.length,i=0;i<r&&t[i][1].id!==e;)i++;if(i<r){var n=t[i][1],a=(n.merged||n.instanced)[g.MATERIAL].renderPriority,o=t[i][0];if(a!==t[i][0]){t[i][0]=a;var s=a>o?-1:1;for(i+=s;i>-1&&i<r&&s*t[i][0]>s*a;){var u=t[i];t[i]=t[i-s],t[i-s]=u,i+=s}}}},e.prototype._modifyMaterials=function(e){var t=this;e.forEach(function(e){t._materialRep.updateMaterialParameters(e)})},e.prototype.modifyRenderOrder=function(e){var t=this;this._orderedRendering&&(e.forEach(function(e){t._updateRenderOrder(e,t._renderOrder)}),this._sortHighlightsByRenderOrder(),this._needsRender=!0)},e.prototype._initializeMatData=function(e){var t={origin2data:new Map};return t[g.MATERIAL]=this._materialRep.aquire(e),t[g.MATERIAL_DEPTH_SHADOWMAP]=this._materialRep.aquireDepthShadowMap(e),t[g.MATERIAL_NORMAL]=this._materialRep.aquireNormal(e),t[g.MATERIAL_DEPTH]=this._materialRep.aquireDepth(e),t[g.MATERIAL_HIGHLIGHT]=this._materialRep.aquireHighlight(e),t},e.prototype._releaseMaterials=function(e){if(Array.isArray(e))for(var t=e,r=0;r<t.length;r++)this._materialRep.release(t[r]),this._materialRep.releaseDepthShadowMap(t[r]),this._materialRep.releaseNormal(t[r]),this._materialRep.releaseDepth(t[r]),this._materialRep.releaseHighlight(t[r]);else this._materialRep.release(e),this._materialRep.releaseDepthShadowMap(e),this._materialRep.releaseNormal(e),this._materialRep.releaseDepth(e),this._materialRep.releaseHighlight(e)},e.prototype._getInstance=function(e){var t=e.material,r=e.uniqueName,i=t.id,n=this._getType(e),a=this._getTargetMat2Data(n),o=e.origin.id,s=a[i];if(!s)return null;var u,l=s.origin2data.get(o);return l?(u=l.type===F.Preinterleaved?l.instances[r].instance:l.instances[r])?{type:n,uniqueName:r,instance:u,matData:s,originData:l,instancedVAO:null,instancedVAOBaseInstance:null}:null:null},e.prototype._createBaseInstanceVAO=function(e){var t=this._rctx,r=e.instance,i=e.originData;if(e.type===F.Instanced&&i.perGeometryDataInfo){var n=i.perGeometryDataInfo[r.dataId],a=n.instanceBufferData;if(a){var o=n.vao,s=a.getSlot(r.idx);if(e.instancedVAOBaseInstance!==s){var u=M.setBaseInstanceOffset(o.layout,s);e.instancedVAO=new R(t,o.locations,u,o.vertexBuffers,o.indexBuffer),e.instancedVAOBaseInstance=s}}}},e.prototype._updateHighlightVAOs=function(){for(var e=0;e<this._highlights.length;++e){var t=this._highlights[e];this._createBaseInstanceVAO(t)}},e.prototype._getFallbackDepthTexture=function(){return this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=new C(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array([255,255,255,255]))),this._fallbackDepthStencilTexture},e}(),U=function(){function e(){this.reset()}return e.prototype.reset=function(){this.trianglesRendered=0,this.drawCallsInstanced=0,this.drawCallsAngleInstanced=0,this.drawCallsMerged=0,this.drawCallsPreinterleaved=0,this.drawCallsFragmented=0,this.drawCallsHighlight=0,this.instancesDrawnAngle=0,this.VBOallocatedSize=0,this.VBOoptimalSize=0,this.VBOusedSize=0},e}(),B=function(){return function(e,t,r,n,a,o,s,u){this.name=e,this.from=t,this.to=r,this.displayedIndexRange=n,this.transformation=a,this.instanceParameters=o,this.idx=s,this.dataId=u,null!=a&&(this.transformationNormal=i.mat4d.create(),i.mat4d.set(a,this.transformationNormal),i.mat4d.inverse(this.transformationNormal,this.transformationNormal),i.mat4d.transpose(this.transformationNormal,this.transformationNormal))}}();!function(e){e[e.Merged=0]="Merged",e[e.Instanced=1]="Instanced",e[e.Preinterleaved=2]="Preinterleaved"}(F||(F={}));var V={updatedDisplayedIndexRange:!1,begin:0,end:0},k=i.vec2d.create(),z=i.mat4d.identity(),G=i.mat4d.create(),H=i.mat4d.create();return j}.apply(null,i))||(e.exports=n)},726:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.applyToModelMatrix=function(e,t){var r=t,i=-e[0],n=-e[1],a=-e[2],o=r[3],s=r[7],u=r[11],l=r[15];r[0]+=o*i,r[1]+=o*n,r[2]+=o*a,r[4]+=s*i,r[5]+=s*n,r[6]+=s*a,r[8]+=u*i,r[9]+=u*n,r[10]+=u*a,r[12]+=l*i,r[13]+=l*n,r[14]+=l*a},t.applyToViewMatrix=function(e,t){var r=t,i=e[0],n=e[1],a=e[2];r[12]+=i*r[0]+n*r[4]+a*r[8],r[13]+=i*r[1]+n*r[5]+a*r[9],r[14]+=i*r[2]+n*r[6]+a*r[10],r[14]+=i*r[3]+n*r[7]+a*r[11]}}.apply(null,i))||(e.exports=n)},727:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(345),r(689),r(420)],void 0===(n=function(e,t,r,i,n){return function(e){function t(t,r,i,a,o){void 0===o&&(o=!1);var s=e.call(this,t,r)||this;return s.textureRep=i,s.textureId=a,s.initTransparent=o,s.glTextureRef=n.aquireIfNotUndefined(s.textureId,i,s.initTransparent),s}return r(t,e),t.prototype.dispose=function(){n.releaseIfNotUndefined(this.textureId,this.textureRep)},t.prototype.updateTexture=function(e){e!==this.textureId&&(n.releaseIfNotUndefined(this.textureId,this.textureRep),this.textureId=e,this.glTextureRef=n.aquireIfNotUndefined(this.textureId,this.textureRep,this.initTransparent))},t.prototype.renderTexture=function(e){var t=this.textureRep.getTexture(this.textureId);t&&t.dirty&&t.redraw&&t.redraw()},t.prototype.bindTexture=function(e,t){null!=this.glTextureRef&&(t.setUniform1i("tex",0),e.bindTexture(this.glTextureRef.getGLTexture()))},t.prototype.bindTextureSize=function(e,t){if(null!=this.glTextureRef){var r=this.glTextureRef.getGLTexture();t.setUniform2f("texSize",r.descriptor.width,r.descriptor.height)}},t}(i)}.apply(null,i))||(e.exports=n)},728:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){var r={origin:[0,0,0],basis1:[0,0,0],basis2:[0,0,0]};return function(){function e(){this._worldPlane=r}return Object.defineProperty(e.prototype,"plane",{get:function(){return this._worldPlane},set:function(e){this._worldPlane=e||r},enumerable:!0,configurable:!0}),e}()}.apply(null,i))||(e.exports=n)},741:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){function r(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++){var i=e[r],n=t[r];if(i.length!==n.length)return!1;for(var a=0;a<i.length;a++)if(i[a]!==n[a])return!1}return!0}function i(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var i=0;i<e.length;i++)if(!r(e[i],t[i]))return!1;return!0}function n(e,t){return e===t||e&&t&&e.equals(t)}function a(e,t){if(e===t)return!0;if(!e||!t)return!1;if(e.type!==t.type)return!1;switch(e.type){case"point":return function(e,t){return!!n(e.spatialReference,t.spatialReference)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.m===t.m}(e,t);case"extent":return function(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!n(e.spatialReference,t.spatialReference)&&e.xmin===t.xmin&&e.ymin===t.ymin&&e.zmin===t.zmin&&e.xmax===t.xmax&&e.ymax===t.ymax&&e.zmax===t.zmax}(e,t);case"polyline":return function(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!n(e.spatialReference,t.spatialReference)&&i(e.paths,t.paths)}(e,t);case"polygon":return function(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!n(e.spatialReference,t.spatialReference)&&i(e.rings,t.rings)}(e,t);case"multipoint":return function(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!n(e.spatialReference,t.spatialReference)&&r(e.points,t.points)}(e,t);case"mesh":return!1}}Object.defineProperty(t,"__esModule",{value:!0}),t.equals=function(e,t){return e===t||null!=e&&null!=t&&e.objectId===t.objectId&&!!a(e.geometry,t.geometry)&&!!function(e,t){if(e===t)return!0;if(!e||!t)return!1;for(var r in e)if(!(r in t)||e[r]!==t[r])return!1;for(var r in t)if(!(r in e))return!1;return!0}(e.attributes,t.attributes)}}.apply(null,i))||(e.exports=n)},743:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.unrolledCopyVec4=function(e,t){for(var r=e.typedBuffer,i=e.typedBufferStride,n=t.typedBuffer,a=t.typedBufferStride,o=t.count,s=0;s<o;s++){var u=s*i,l=s*a;r[u]=n[l],r[u+1]=n[l+1],r[u+2]=n[l+2],r[u+3]=n[l+3]}},t.unrolledCopyVec3=function(e,t){for(var r=e.typedBuffer,i=e.typedBufferStride,n=t.typedBuffer,a=t.typedBufferStride,o=t.count,s=0;s<o;s++){var u=s*i,l=s*a;r[u]=n[l],r[u+1]=n[l+1],r[u+2]=n[l+2]}},t.unrolledCopyVec2=function(e,t){for(var r=e.typedBuffer,i=e.typedBufferStride,n=t.typedBuffer,a=t.typedBufferStride,o=t.count,s=0;s<o;s++){var u=s*i,l=s*a;r[u]=n[l],r[u+1]=n[l+1]}},t.makeDenseSingle=function(e,t){var r=e.count;t||(t=new e.TypedArrayConstructor(r));for(var i=0;i<r;i++)t[i]=e.get(i);return t}}.apply(null,i))||(e.exports=n)},744:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(345),r(367),r(342),r(650),r(421),r(727),r(636),r(460),r(410),r(968),r(348),r(656),r(420),r(840)],void 0===(n=function(e,t,r,i,n,a,o,s,u,l,d,c,h,p,f,g){function m(e,t){return void 0===t&&(t=S),e.textureIsSignedDistanceField?function(e,t,r){r[0]=e[0]*(t[2]-t[0])+t[0],r[1]=e[1]*(t[3]-t[1])+t[1]}(e.anchorPos,e.distanceFieldBoundingBox,t):n.vec2d.set(e.anchorPos,t),t}var v={"bottom-left":[0,0],bottom:[.5,0],"bottom-right":[1,0],left:[0,.5],center:[.5,.5],right:[1,.5],"top-left":[0,1],top:[.5,1],"top-right":[1,1]},y=function(e){function t(t,r){var i=e.call(this,r)||this;return i._textureDirty=!1,i.params=f.copyParameters(t,N),"string"==typeof i.params.anchorPos&&(i.params.anchorPos=v[i.params.anchorPos]),i.bufferWriter=new U(i),i}return r(t,e),t.prototype.dispose=function(){},t.prototype.getParameterValues=function(){return f.copyParameters(this.params)},t.prototype.setParameterValues=function(e){for(var t in e)"textureId"===t&&h.assert(!!this.params.textureId,"Can only change texture of material that already has a texture"),this.params[t]=e[t];this.notifyDirty("matChanged")},t.prototype.getParams=function(){return this.params},t.prototype.intersect=function(e,t,r,i,a,s,u,l){if(i.isSelection&&i.enableHUDSelection&&!o.isAllHidden(t.componentVisibilities,e.data.componentOffsets)){var d=e.data,p=this.params,f=1,g=1;if(n.mat4d.toMat3(r,P),l){var v=l(A);f=v[0],g=v[5],function(e){var t=e[0],r=e[1],i=e[2],n=e[3],a=e[4],o=e[5],s=e[6],u=e[7],l=e[8],d=1/Math.sqrt(t*t+r*r+i*i),c=1/Math.sqrt(n*n+a*a+o*o),h=1/Math.sqrt(s*s+u*u+l*l);e[0]=t*d,e[1]=r*d,e[2]=i*d,e[3]=n*c,e[4]=a*c,e[5]=o*c,e[6]=s*h,e[7]=u*h,e[8]=l*h}(P)}var y=d.getVertexAttr()[h.VertexAttrConstants.POSITION],_=d.getVertexAttr()[h.VertexAttrConstants.SIZE],b=d.getVertexAttr()[h.VertexAttrConstants.NORMAL];h.assert(y.size>=3);for(var x=i.point,S=i.camera,M=m(p),I=0;I<y.data.length/y.size;I++){var L=I*y.size;n.vec3d.set3(y.data[L],y.data[L+1],y.data[L+2],T),n.mat4d.multiplyVec3(r,T,T);var N=I*_.size;F[0]=_.data[N]*f,F[1]=_.data[N+1]*g,n.mat4d.multiplyVec3(S.viewMatrix,T);var j=I*b.size;if(n.vec3d.set3(b.data[j],b.data[j+1],b.data[j+2],O),this.applyVerticalOffsetTransformation(T,O,P,S,w),S.applyProjection(T,C),C[0]>-1){var U=Math.floor(C[0]),B=Math.floor(C[1]);c.applyPrecomputedScaleFactorVec2(F,w.factor,F);var V=U-D-(M[0]>0?F[0]*M[0]:0),k=V+F[0]+2*D,z=B-D-(M[1]>0?F[1]*M[1]:0),G=z+F[1]+2*D;if(p.textureIsSignedDistanceField){var H=p.outlineSize/2,q=p.distanceFieldBoundingBox;V+=F[0]*q[0],z+=F[1]*q[1],k-=F[0]*(1-q[2]),G-=F[1]*(1-q[3]),V-=H,k+=H,z-=H,G+=H}if(x[0]>V&&x[0]<k&&x[1]>z&&x[1]<G){var W=i.p0,Q=i.p1;n.mat4d.multiplyVec3(n.mat4d.inverse(S.viewMatrix,E),T,R),C[0]=x[0],C[1]=x[1],S.unprojectPoint(C,T);var X=n.vec3d.negate(i.getDirection(),n.vec3d.create());u(n.vec3d.dist(W,T)/n.vec3d.dist(W,Q),X,-1,1,!0,R)}}}}},t.prototype.normalAndViewAngle=function(e,t,r,i){return void 0===i&&(i=I),n.mat3d.multiplyVec3(t,e,i.normal),n.mat4d.multiplyVec3(r.viewInverseTransposeMatrix,i.normal),i.cosAngle=n.vec3d.dot(M,L),i},t.prototype.updateScaleInfo=function(e,t,r){var i=this.params;i.screenSizePerspective?e.factor=c.precomputeScaleFactor(I.cosAngle,r,i.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minPixelSize=0,e.factor.paddingPixels=0),i.screenSizePerspectiveAlignment?(e.scaleAlignment=c.precomputeScale(I.cosAngle,r,i.screenSizePerspectiveAlignment),e.minPixelSizeAlignment=i.screenSizePerspectiveAlignment.parameters.minPixelSize):(e.scaleAlignment=e.factor.scale,e.minPixelSizeAlignment=e.factor.minPixelSize)},t.prototype.applyVerticalOffsetTransformation=function(e,t,r,i,a,o){var s=this.params;if(16===r.length&&(r=n.mat4d.toMat3(r,P)),!s.verticalOffset||!s.verticalOffset.screenLength){if(a&&(s.screenSizePerspective||s.screenSizePerspectiveAlignment)){var u=this.normalAndViewAngle(t,r,i),l=n.vec3d.length(e);this.updateScaleInfo(a,u.cosAngle,l)}else a&&(a.factor.scale=1,a.scaleAlignment=1);return o?n.vec3d.set(e,o):e}var d=this.normalAndViewAngle(t,r,i),c=n.vec3d.length(e),h=s.screenSizePerspectiveAlignment||s.screenSizePerspective,p=f.verticalOffsetAtDistance(i,c,s.verticalOffset,d.cosAngle,h);return a&&this.updateScaleInfo(a,d.cosAngle,c),n.vec3d.add(e,n.vec3d.scale(d.normal,p),o)},t.prototype.getGLMaterials=function(){return{color:b,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:x}},t.prototype.getAllTextureIds=function(){return[this.params.textureId]},t.prototype.setTextureDirty=function(){this._textureDirty=!0},t.prototype.calculateRelativeScreenBounds=function(e,t,r){return void 0===r&&(r=i.create()),function(e,t,r,i){void 0===i&&(i=S),n.vec2d.set(e.anchorPos,i),i[0]*=-t[0],i[1]*=-t[1],i[0]+=e.screenOffset[0]*r,i[1]+=e.screenOffset[1]*r}(this.params,e,t,r),r[2]=r[0]+e[0],r[3]=r[1]+e[1],r},t.prototype.calculateAnchorPosForRendering=function(e){return m(this.params,e)},t.shouldRenderVisibilityDuringRenderPass=function(e){return e===l.MATERIAL||l.MATERIAL_HIGHLIGHT},t}(u),_=function(e){function t(t,r,i){var n=e.call(this,t,r,i,t.getParams().textureId)||this;return n.params=f.copyParameters(t.getParams()),n.selectProgram(),n.selectSlot(),n}return r(t,e),t.prototype.selectSlot=function(){this.mainSlot=this.params.drawInSecondSlot?d.HUDMATERIAL2:d.HUDMATERIAL1},t.prototype.beginSlot=function(e){return e===this.mainSlot},t.prototype.getProgram=function(){return this.program},t.prototype.updateParameters=function(){this.params=this.material.getParameterValues(),this.updateTexture(this.params.textureId),this.selectProgram(),this.selectSlot()},t.prototype.bindRender=function(e,t){var r=this.params,i=this.getProgram();this.bindTexture(e,i),i.setUniform1i("hudVisibilityTexture",1),e.bindTexture(t.hudVisibilityTexture,1),e.setActiveTexture(0),i.setUniform1f("uRenderTransparentlyOccludedHUD","occluded"===t.renderTransparentlyOccludedHUD?1:"notOccluded"===t.renderTransparentlyOccludedHUD?0:.75);var n=t.pixelRatio||1;i.setUniform4fv("overrideColor",r.color),i.setUniform1f("pixelRatio",n),r.textureIsSignedDistanceField&&(i.setUniform4fv("outlineColor",r.outlineColor),i.setUniform1f("outlineSize",r.outlineSize*n)),r.vvSizeEnabled&&(i.setUniform3fv("vvSizeMinSize",r.vvSizeMinSize),i.setUniform3fv("vvSizeMaxSize",r.vvSizeMaxSize),i.setUniform3fv("vvSizeOffset",r.vvSizeOffset),i.setUniform3fv("vvSizeFactor",r.vvSizeFactor)),r.vvColorEnabled&&(i.setUniform1fv("vvColorValues",r.vvColorValues),i.setUniform4fv("vvColorColors",r.vvColorColors)),i.setUniform2fv("texScale",r.texCoordScale),i.setUniform2f("screenOffset",2*r.screenOffset[0]*n,2*r.screenOffset[1]*n),i.setUniform2fv("anchorPos",m(r)),r.polygonOffset&&(e.setPolygonOffsetFillEnabled(!0),e.setPolygonOffset(0,-4)),e.setBlendingEnabled(!0),e.setBlendFunction(1,771)},t.prototype.bindProjection=function(e,t){this.material._textureDirty&&(this.renderTexture(e),this.material._textureDirty=!1);var r=t.cameraAboveGround?1:-1,i=this.getProgram(),n=this.params;e.bindProgram(i),i.setUniform1f("cameraGroundRelative",r),i.setUniform1f("polygonOffset",n.shaderPolygonOffset),i.setUniform4fv("viewport",t.viewport),f.bindVerticalOffset(n.verticalOffset,t,i),i.setUniformMatrix4fv("viewNormal",t.viewInvTransp),n.screenSizePerspective&&(f.bindScreenSizePerspective(n.screenSizePerspective,t,i,"screenSizePerspective"),f.bindScreenSizePerspective(n.screenSizePerspectiveAlignment||n.screenSizePerspective,t,i,"screenSizePerspectiveAlignment"))},t.prototype.releaseRender=function(e){e.setPolygonOffsetFillEnabled(!1),e.setBlendFunction(770,771),e.setBlendingEnabled(!1)},t.prototype.bindView=function(e,t){var r=t.origin,i=this.getProgram();f.bindView(r,t.view,i),f.bindCamPos(r,t.viewInvTransp,i)},t.prototype.bindInstance=function(e,t){var r=this.getProgram();r.setUniformMatrix4fv("model",t.transformation),r.setUniformMatrix4fv("modelNormal",t.transformationNormal)},t.prototype.getDrawMode=function(e){return 4},t}(s),b=function(e){function t(t,r,i){var n=e.call(this,t,r,i)||this;return n.isOcclusionSlot=!1,n}return r(t,e),t.prototype.selectProgram=function(){var e=this.params;this.programOcclusionTestPixel=this.programRep.getProgram(g.occlusionPass,{verticalOffset:!!e.verticalOffset,screenSizePerspective:!!e.screenSizePerspective,centerOffsetUnitsScreen:"screen"===e.centerOffsetUnits,slice:e.slicePlaneEnabled}),this.program=this.programRep.getProgram(g.colorPass,{occlTest:e.occlusionTest,sdf:e.textureIsSignedDistanceField,vvSize:!!e.vvSizeEnabled,vvColor:!!e.vvColorEnabled,verticalOffset:!!e.verticalOffset,screenSizePerspective:!!e.screenSizePerspective,centerOffsetUnitsScreen:"screen"===e.centerOffsetUnits,debugDrawBorder:!!e.debugDrawBorder})},t.prototype.getDrawMode=function(e){return this.isOcclusionSlot?0:4},t.prototype.release=function(e){e.setDepthFunction(513),this.isOcclusionSlot||this.releaseRender(e)},t.prototype.bind=function(e,t){this.bindProjection(e,t);var r=this.getProgram();if(e.setDepthTestEnabled(!0),e.setDepthFunction(515),this.isOcclusionSlot){r.setUniform4f("color",1,1,1,1);var i=t.pixelRatio||1;r.setUniform1f("pixelRatio",i)}else this.bindRender(e,t),this.bindTexture(e,r)},t.prototype.bindView=function(t,r){e.prototype.bindView.call(this,t,r);var i=this.getProgram(),n=this.params;this.isOcclusionSlot&&n.slicePlaneEnabled&&f.bindSlicePlane(r.origin,r.slicePlane,i)},t.prototype.getProgram=function(){return this.isOcclusionSlot?this.programOcclusionTestPixel:this.program},t.prototype.getPrograms=function(){return[this.programOcclusionTestPixel,this.program]},t.prototype.beginSlot=function(e){return this.params.occlusionTest?(this.isOcclusionSlot=e===d.OCCLUSION_PIXELS,e===d.OCCLUSION_PIXELS||e===this.mainSlot):(this.isOcclusionSlot=!1,e===this.mainSlot)},t}(_),x=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.selectProgram=function(){var e=this.params;this.program=this.programRep.getProgram(g.highlightPass,{occlTest:e.occlusionTest,sdf:e.textureIsSignedDistanceField,vvSize:!!e.vvSizeEnabled,vvColor:!!e.vvColorEnabled,verticalOffset:!!e.verticalOffset,screenSizePerspective:!!e.screenSizePerspective,centerOffsetUnitsScreen:"screen"===e.centerOffsetUnits,binaryHighlightOcclusion:e.binaryHighlightOcclusion})},t.prototype.bind=function(e,t){this.bindProjection(e,t),this.bindRender(e,t)},t.prototype.release=function(e){this.releaseRender(e)},t}(_),w={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},scaleAlignment:0,minPixelSizeAlignment:0},S=[0,0],T=n.vec3d.create(),O=n.vec3d.create(),C=n.vec3d.create(),M=n.vec3d.create(),R=n.vec3d.create(),P=n.mat3d.create(),E=n.mat4d.create(),I={normal:M,cosAngle:0},A=n.mat4d.create();n.mat4d.identity(A);var D=1,F=[0,0],L=[0,0,1],N={texCoordScale:[1,1],occlusionTest:!0,binaryHighlightOcclusion:!0,drawInSecondSlot:!1,color:[1,1,1,1],outlineColor:[1,1,1,1],outlineSize:0,textureIsSignedDistanceField:!1,distanceFieldBoundingBox:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],screenOffset:[0,0],verticalOffset:null,screenSizePerspective:null,screenSizePerspectiveAlignment:null,slicePlaneEnabled:!1,anchorPos:v.center,shaderPolygonOffset:1e-5,polygonOffset:!1,textureId:null,centerOffsetUnits:"world",debugDrawBorder:!1},j=a.newLayout().vec3f(h.VertexAttrConstants.POSITION).vec3f(h.VertexAttrConstants.NORMAL).vec2f(h.VertexAttrConstants.UV0).vec4u8(h.VertexAttrConstants.COLOR).vec2f(h.VertexAttrConstants.SIZE).vec4f(h.VertexAttrConstants.AUXPOS1).vec4f(h.VertexAttrConstants.AUXPOS2),U=function(){function e(e){this.material=e,this.vertexBufferLayout=j}return e.prototype.allocate=function(e){return this.vertexBufferLayout.createBuffer(e)},e.prototype.elementCount=function(e){return 6*e.indices[h.VertexAttrConstants.POSITION].length},e.prototype.write=function(e,t,r,i,n){var a=this.material.getParameterValues();p.writePosition(t.indices[h.VertexAttrConstants.POSITION],t.vertexAttr[h.VertexAttrConstants.POSITION].data,e.transformation,i.position,n,6),p.writeNormal(t.indices[h.VertexAttrConstants.NORMAL],t.vertexAttr[h.VertexAttrConstants.NORMAL].data,e.invTranspTransformation,i.normal,n,6);var o=t.vertexAttr[h.VertexAttrConstants.UV0].data,s=void 0,u=void 0,l=void 0,d=void 0;null==o||o.length<4?(s=0,u=0,l=a.texCoordScale[0],d=a.texCoordScale[1]):(s=o[0],u=o[1],l=o[2],d=o[3]),l=Math.min(1.99999,l+1),d=Math.min(1.99999,d+1);for(var c=t.indices[h.VertexAttrConstants.POSITION].length,f=i.uv0,g=n,m=0;m<c;++m)f.set(g,0,s),f.set(g,1,u),g+=1,f.set(g,0,l),f.set(g,1,u),g+=1,f.set(g,0,l),f.set(g,1,d),g+=1,f.set(g,0,l),f.set(g,1,d),g+=1,f.set(g,0,s),f.set(g,1,d),g+=1,f.set(g,0,s),f.set(g,1,u),g+=1;p.writeColor(t.indices[h.VertexAttrConstants.COLOR],t.vertexAttr[h.VertexAttrConstants.COLOR].data,4,i.color,n,6);var v=t.indices[h.VertexAttrConstants.SIZE],y=t.vertexAttr[h.VertexAttrConstants.SIZE].data,_=v.length,b=i.size;for(g=n,m=0;m<_;++m)for(var x=y[2*v[m]],w=y[2*v[m]+1],S=0;S<6;++S)b.set(g,0,x),b.set(g,1,w),g+=1;t.indices[h.VertexAttrConstants.AUXPOS1]&&t.vertexAttr[h.VertexAttrConstants.AUXPOS1]&&p.writeBufferVec4(t.indices[h.VertexAttrConstants.AUXPOS1],t.vertexAttr[h.VertexAttrConstants.AUXPOS1].data,i.auxpos1,n,6),t.indices[h.VertexAttrConstants.AUXPOS2]&&t.vertexAttr[h.VertexAttrConstants.AUXPOS2]&&p.writeBufferVec4(t.indices[h.VertexAttrConstants.AUXPOS2],t.vertexAttr[h.VertexAttrConstants.AUXPOS2].data,i.auxpos2,n,6)},e}();return y}.apply(null,i))||(e.exports=n)},762:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(384),r(342),r(1023),r(604)],void 0===(n=function(e,t,r,i,n,a){function o(e,t,r){return{center:i.vec3d.createFrom(e[0],e[1],e[2]),halfSize:i.vec3.createFrom(t[0],t[1],t[2]),quaternion:i.quat4.createFrom(r[0],r[1],r[2],r[3])}}function s(e,t){var r=a.plane.distance(t,e.center),i=u(e,t);return r>i?1:r<-i?-1:0}function u(e,t){i.quat4.conjugate(e.quaternion,l),i.quat4d.multiplyVec3(l,t,d);var r=e.halfSize;return Math.abs(d[0]*r[0])+Math.abs(d[1]*r[1])+Math.abs(d[2]*r[2])}Object.defineProperty(t,"__esModule",{value:!0});var l=i.quat4.create(),d=i.vec3.create(),c=i.vec3.create(),h=i.mat3.create(),p=function(){return function(e){var t=56*e;this.buffer=new ArrayBuffer(t),this.obbs=new Array(e);for(var r=0;r<e;r++)this.obbs[r]={center:new Float64Array(this.buffer,56*r+0,3),halfSize:new Float32Array(this.buffer,56*r+24,3),quaternion:new Float32Array(this.buffer,56*r+36,4)}}}();t.ObbArray=p,t.create=o,t.clone=function(e){return o(e.center,e.halfSize,e.quaternion)},t.set=function(e,t){i.vec3d.set(e.center,t.center),i.vec3.set(e.halfSize,t.halfSize),i.quat4.set(e.quaternion,t.quaternion)},t.compute=function(e,t){return t||(t=o([0,0,0],[-1,-1,-1],[0,0,0,1])),n.computeOBB(e,t),t},t.intersectPlane=s,t.toAaBoundingBox=function(e,t){t||(t=r.create());var n=i.quat4.toMat3(e.quaternion,h),a=e.halfSize[0]*Math.abs(n[0])+e.halfSize[1]*Math.abs(n[3])+e.halfSize[2]*Math.abs(n[6]),o=e.halfSize[0]*Math.abs(n[1])+e.halfSize[1]*Math.abs(n[4])+e.halfSize[2]*Math.abs(n[7]),s=e.halfSize[0]*Math.abs(n[2])+e.halfSize[1]*Math.abs(n[5])+e.halfSize[2]*Math.abs(n[8]);return t[0]=e.center[0]-a,t[1]=e.center[1]-o,t[2]=e.center[2]-s,t[3]=e.center[0]+a,t[4]=e.center[1]+o,t[5]=e.center[2]+s,t},t.minimumDistancePlane=function(e,t){return a.plane.distance(t,e.center)-u(e,t)},t.maximumDistancePlane=function(e,t){return a.plane.distance(t,e.center)+u(e,t)},t.isVisible=function(e,t){return s(e,t[0])<=0&&s(e,t[1])<=0&&s(e,t[2])<=0&&s(e,t[3])<=0&&s(e,t[4])<=0&&s(e,t[5])<=0},t.intersectLine=function(e,t,r,n){void 0===n&&(n=0),i.quat4.conjugate(e.quaternion,l),i.vec3d.subtract(t,e.center,d);for(var a=i.quat4d.multiplyVec3(l,d,d),o=i.quat4d.multiplyVec3(l,r,c),s=-1/0,u=1/0,h=0;h<3;h++)if(Math.abs(o[h])>1e-6){var p=(n+e.halfSize[h]-a[h])/o[h],f=(-n-e.halfSize[h]-a[h])/o[h];s=Math.max(s,Math.min(p,f)),u=Math.min(u,Math.max(p,f))}else if(a[h]>e.halfSize[h]+n||a[h]<-e.halfSize[h]-n)return!1;return s<=u}}.apply(null,i))||(e.exports=n)},763:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(344),r(337),r(335),r(341),r(339),r(336),r(398),r(1070),r(731)],void 0===(n=function(e,t,i,n,a,o,s,u,l,d,c){return function(e){function t(t,r){var i=e.call(this)||this;return i.geometryType="mesh",i.operationalLayerType="IntegratedMeshLayer",i.type="integrated-mesh",i.profile="mesh-pyramids",i.elevationInfo=null,i}return n(t,e),t.prototype.normalizeCtorArgs=function(e,t){return"string"==typeof e?i({url:e},t):e},t.prototype.load=function(){var e=this,t=this.loadFromPortal({supportedTypes:["Scene Service"]}).always(function(){return e._fetchService()}).then(function(){return e._verifyRootNodeAndUpdateExtent()});return this.addResolvingPromise(t),this.when()},t.prototype.importLayerViewModule=function(e){switch(e.type){case"2d":return s.reject(new o("integrated-mesh-layer:view-not-supported","IntegratedMeshLayer is only supported in 3D"));case"3d":return s.create(function(e){return Promise.all([r.e(1),r.e(3),r.e(2),r.e(4),r.e(56)]).then(function(){var t=[r(1120)];e.apply(null,t)}.bind(this)).catch(r.oe)})}},t.prototype._validateLayer=function(e){if(e.layerType&&"IntegratedMesh"!==e.layerType)throw new o("integrated-mesh-layer:layer-type-not-supported","IntegratedMeshLayer does not support this layer type",{layerType:e.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new o("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"});if(this.version.major>1)throw new o("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"})},a([u.shared("esri.layers.IntegratedMeshLayer")],t.prototype,"declaredClass",void 0),a([u.property({type:String,readOnly:!0})],t.prototype,"geometryType",void 0),a([u.property()],t.prototype,"operationalLayerType",void 0),a([u.property({json:{read:!1},readOnly:!0})],t.prototype,"type",void 0),a([u.property({type:c,json:{origins:{service:{read:{source:"elevationInfo"}}},read:{source:"layerDefinition.elevationInfo"},write:{target:"layerDefinition.elevationInfo"}}})],t.prototype,"elevationInfo",void 0),a([u.subclass()],t)}(u.declared(l,d))}.apply(null,i))||(e.exports=n)},764:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.updatingPercentageValue={value:100,readOnly:!0},t.updatingPercentage={dependsOn:["updating","updatingPercentageValue"],readOnly:!0,value:0,get:function(){return this.updating?this.updatingPercentageValue:0}}}.apply(null,i))||(e.exports=n)},765:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(350),r(341),r(339),r(349),r(362),r(386),r(647),r(419),r(771),r(387),r(622)],void 0===(n=function(e,t,r,i,n,a,o,s,u,l,d,c,h){function p(e){return e&&parseInt(e.substring(e.lastIndexOf("/")+1,e.length),10)}function f(e,t){var r,i=t[0],n=t[1],a=t[2],o=t[3],s=0;i<e[0]&&(s+=(r=e[0]-i)*r);n<e[1]&&(s+=(r=e[1]-n)*r);a<e[2]&&(s+=(r=e[2]-a)*r);i>e[3]&&(s+=(r=i-e[3])*r);n>e[4]&&(s+=(r=n-e[4])*r);a>e[5]&&(s+=(r=a-e[5])*r);if(s>o*o)return 0;if(s>0)return 1;var u=1/0;return i-e[0]<u&&(u=i-e[0]),n-e[1]<u&&(u=n-e[1]),a-e[2]<u&&(u=a-e[2]),e[3]-i<u&&(u=e[3]-i),e[4]-n<u&&(u=e[4]-n),e[5]-a<u&&(u=e[5]-a),u>o?2:1}function g(e,t,r){for(var i=[],n=r&&r.missingFields,a=r&&r.originalFields,o=0,s=e;o<s.length;o++){for(var u=s[o],l=u.toLowerCase(),d=!1,c=0,h=t;c<h.length;c++){var p=h[c];if(l===p.name.toLowerCase()){i.push(p.name),d=!0,a&&a.push(u);break}}!d&&n&&n.push(u)}return i}function m(e,t,r){if(null!=e.maxRecordCount&&t.length>e.maxRecordCount){var a=function(e,t){for(var r=e.length,i=Math.ceil(r/t),n=[],a=0;a<i;a++){var o=Math.floor(r*a/i),s=Math.floor(r*(a+1)/i);n.push(e.slice(o,s))}return n}(t,e.maxRecordCount);return n.all(a.map(function(t){return m(e,t,r)})).then(_)}var o=new l({objectIds:t,outFields:r,orderByFields:[e.objectIdField]});return new u(e.parsedUrl.path).execute(o).then(function(e){return e&&e.features&&e.features.length===t.length?e.features.map(function(e){return e.attributes}):n.reject(new i("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer"))})}function v(e,t,o,s,u){for(var l=[],c=0;c<t.attributeData.length;c++){var h=t.attributeData[c],p=e[c];if(p&&-1!==s.indexOf(p.name)){var f=a.makeAbsolute(h.href,t.baseUrl);l.push({url:f,storageInfo:p})}}return n.eachAlways(l.map(function(e){return r(e.url,{responseType:"array-buffer"}).then(function(t){return d.readBinaryAttribute(e.storageInfo,t.data)})})).then(function(e){var t=[];if(!u.ignoreUnavailableFields&&e.some(function(e){return null==e.value})){for(var r=[],a=0;a<e.length;a++)null==e[a].value&&r.push({name:l[a].storageInfo.name,error:e[a].error});return n.reject(new i("scenelayer:attribute-request-failed","Request for scene layer attributes failed",{failedAttributes:r}))}for(var s=0,d=o;s<d.length;s++){var c=d[s],h={};for(a=0;a<e.length;a++)null!=e[a].value&&(h[l[a].storageInfo.name]=y(e[a].value,c));t.push(h)}return t})}function y(e,t){var r=e[t];return h.isInt16Array(e)?r===C?null:r:h.isInt32Array(e)?r===M?null:r:r!=r?null:r}function _(e){for(var t=[],r=0,i=e;r<i.length;r++){var n=i[r];t=t.concat(n)}return t}function b(e){var t=new o(p(e.store.indexCRS||e.store.geographicCRS));return t.equals(e.spatialReference)?e.spatialReference:t}function x(e){var t=new o(p(e.store.vertexCRS||e.store.projectedCRS));return t.equals(e.spatialReference)?e.spatialReference:t}function w(e,t,r){if(!s.canProject(e,t))throw new i("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if("local"===r&&e.isGeographic)throw new i("layerview:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes",{})}function S(e,t,r){var i=b(e),n=x(e);w(i,t,r),w(n,t,r)}function T(e){return"mesh-3d"===e.type}Object.defineProperty(t,"__esModule",{value:!0}),t.DDS_ENCODING_STRING="image/vnd-ms.dds",t.BROWSER_SUPPORTED_IMAGE_ENCODING_STRINGS=["image/jpeg","image/png"],t.extractWkid=p,t.getAppropriateTextureEncoding=function(e,r){if(Array.isArray(e)){if(r){var i=e.indexOf(t.DDS_ENCODING_STRING);if(i>-1)return i}for(var n=0;n<e.length;n++)if(t.BROWSER_SUPPORTED_IMAGE_ENCODING_STRINGS.indexOf(e[n])>-1)return n;throw new Error("Could not find appropriate texture encoding (among "+e.toString()+")")}return-1},t.findIntersectingNodes=function e(t,r,i,n,a,o){if(null!=i){var s=i.mbs;if(r!==n&&(s=O,c.mbsToMbs(i.mbs,n,s,r)),0!==f(t,s)&&(o(i),i.children))for(var u=0;u<i.children.length;++u)e(t,r,a[i.children[u].id],n,a,o)}},t.buildTopNodeMap=function(e,t,r,i){if(void 0===i&&(i=Number.POSITIVE_INFINITY),t<=0)e.clear();else{var n=new Map,a=Number.POSITIVE_INFINITY;e.forEach(function(o,s){var u=r(o);if(s<t)return a=Math.min(a,u),void n.set(o.id,u);if(!(u<=a||u>=i)){n.set(o.id,u);for(var l=a=n.get(e.front().id),d=0,c=1;c<t;++c){var h=e.data[c],p=n.get(h.id);p<a&&(d=c,l=a,a=p)}e.data[d]=o,a=l}}),e.length=Math.min(e.length,t),e.sort(function(e,t){return n.get(t.id)-n.get(e.id)})}};var O=[0,0,0,0];t.intersectBoundingBoxWithMbs=f,t.findFieldsCaseInsensitive=g,t.whenGraphicAttributes=function(e,t,r,a,o,s){var u=!0===(s&&s.populateObjectId),l=s.ignoreUnavailableFields?void 0:[],d=1===a.length&&"*"===a[0];!d&&u&&(a=function(e,t){return e.filter(function(e){return e.toLowerCase()!==t.toLowerCase()}).concat([t])}(a,r));var c=d?a:g(a,e.fields,{missingFields:l});if(l&&0!==l.length)return n.reject(new i("scenelayer:unknown-fields","This scene layer does not have the requested fields",{unknownFields:l}));if(0===t.length)return n.resolve(t);var h=e.associatedLayer,p=e.attributeStorageInfo,f=d?e.fields.map(function(e){return e.name}):c;if(h)return function(e,t,r,i){t.sort(function(e,t){return e.attributes[r]-t.attributes[r]});var n=t.map(function(e){return e.attributes[r]}),a=[],o=g(i,e.fields,{originalFields:a});return m(e,n,o).then(function(e){for(var r=0;r<t.length;r++){var i=t[r],n=e[r];i.attributes={};for(var s=0;s<a.length;s++)i.attributes[a[s]]=n[o[s]]}return t})}(h,t,r,f);var y=function(e,t){for(var r=[],i=0,n=e;i<n.length;i++){var a=n[i];a in t.attributes||r.push(a)}return r}(f,t[0]);if(0===y.length)return n.resolve(t);if(p){var _=o();return null==_?n.reject(new i("scenelayer:feature-not-loaded","Tried to query attributes for unloaded features")):v(p,_.node,_.indices,y,s).then(function(e){for(var r=0;r<t.length;r++){for(var i=0,n=f;i<n.length;i++){var a=n[i];a in e[r]||(e[r][a]=t[r].attributes[a])}t[r].attributes=e[r]}return t})}return n.reject(new i("scenelayer:no-attribute-source","This scene layer does not have a source for attributes available"))};var C=-Math.pow(2,15),M=-Math.pow(2,31);t.getCachedAttributeValue=y,t.convertFlatRangesToOffsets=function(e,t,r){void 0===r&&(r=2);for(var n=null!=t?t:e.length/r,a=new Uint32Array(n+1),o=0;o<n;o++){var s=e[o*r],u=3*s;a[o]=u;var l=(o-1)*r+1;if(l>=0&&s-1!==e[l])throw new i("Face ranges are not continuous")}var d=3*(e[(n-1)*r+1]+1);return a[a.length-1]=d,a},t.getIndexCrs=b,t.getVertexCrs=x,t.getCacheKeySuffix=function(e,t){return t===c.SphericalECEFSpatialReference?"@ECEF":e.equals(t)?"":null!=t.wkid?"@"+t.wkid:null},t.checkSpatialReference=w,t.checkSpatialReferences=S,t.checkSceneLayerValid=function(e){if(null==e.store||null==e.store.defaultGeometrySchema||!function(e){return!(null!=e.geometryType&&"triangles"!==e.geometryType||null!=e.topology&&"PerAttributeArray"!==e.topology||null==e.vertexAttributes||null==e.vertexAttributes.position)}(e.store.defaultGeometrySchema))throw new i("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{})},t.checkSceneLayerCompatibleWithView=function(e,t){S(e,t.spatialReference,t.viewingMode)},t.checkPointCloudLayerValid=function(e){if(null==e.store||null==e.store.defaultGeometrySchema||!function(e){return!(null==e.geometryType||"points"!==e.geometryType||null!=e.topology&&"PerAttributeArray"!==e.topology||null!=e.encoding&&""!==e.encoding&&"lepcc-xyz"!==e.encoding||null==e.vertexAttributes||null==e.vertexAttributes.position)}(e.store.defaultGeometrySchema))throw new i("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{})},t.checkPointCloudLayerCompatibleWithView=function(e,t){w(e.spatialReference,t.spatialReference,t.viewingMode)},t.rendererNeedsTextures=function(e){if(null==e||!function(e){return"simple"===e.type||"class-breaks"===e.type||"unique-value"===e.type}(e))return!0;if(("unique-value"===e.type||"class-breaks"===e.type)&&null==e.defaultSymbol)return!0;var t=e.getSymbols();if(0===t.length)return!0;for(var r=0,i=t;r<i.length;r++){var n=i[r];if(!T(n)||0===n.symbolLayers.length)return!0;for(var a=0,o=n.symbolLayers.items;a<o.length;a++){var s=o[a];if("fill"!==s.type||null==s.material||"replace"!==s.material.colorMixMode)return!0}}return!1};var R=function(){return function(){this.edges=null,this.material=null}}();t.SymbolInfo=R,t.getSymbolInfo=function(e){for(var t=new R,r=!1,i=!1,n=0,a=e.symbolLayers.items;n<a.length;n++){var o=a[n];if("fill"===o.type&&o.enabled){var s=o.material,u=o.edges;if(s&&!r){var l=s.color;t.material={color:l?[l.r/255,l.g/255,l.b/255]:null,alpha:l?l.a:null,colorMixMode:s.colorMixMode},r=!0}u&&!i&&(t.edges=o.edges,i=!0)}}return t}}.apply(null,i))||(e.exports=n)},769:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(709)],void 0===(n=function(e,t,r){return{now:r}}.apply(null,i))||(e.exports=n)},770:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(342)],void 0===(n=function(e,t,r){function i(e,t,i,n){var a=s;return e?(i&&n&&(a.len=r.vec3d.dist(t,i)),r.vec3d.set(e,a.dir)):n?(a.len=r.vec3d.dist(t,i),r.vec3d.scale(r.vec3d.subtract(i,t,a.dir),1/a.len)):r.vec3d.normalize(r.vec3d.subtract(i,t,a.dir)),a}function n(e,t){return-r.vec3d.dot(t,e)-e[3]}function a(e,t,i){var a=r.vec3d.dot(e,i.dir),o=n(e,t);if(o<0&&a>=0)return!1;if(a>-1e-6&&a<1e-6)return o>0;if((o<0||a<0)&&!(o<0&&a<0))return!0;var s=o/a;return a>0?s<i.clip[1]&&(i.clip[1]=s):s>i.clip[0]&&(i.clip[0]=s),i.clip[0]<=i.clip[1]}function o(e,t,r,i){i.clip[0]=0,i.clip[1]=r?i.len:Number.MAX_VALUE;for(var n=0;n<e.length;n++)if(!a(e[n],t,i))return!1;return!0}Object.defineProperty(t,"__esModule",{value:!0}),t.planeSphere=function(e,t,r){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]<r},t.frustumSphere=function(e,t,r){var i=t[0],n=t[1],a=t[2];return!(e[0][0]*i+e[0][1]*n+e[0][2]*a+e[0][3]>r||e[1][0]*i+e[1][1]*n+e[1][2]*a+e[1][3]>r||e[2][0]*i+e[2][1]*n+e[2][2]*a+e[2][3]>r||e[3][0]*i+e[3][1]*n+e[3][2]*a+e[3][3]>r||e[4][0]*i+e[4][1]*n+e[4][2]*a+e[4][3]>r||e[5][0]*i+e[5][1]*n+e[5][2]*a+e[5][3]>r)},t.frustumRay=function(e,t,r,n){return o(e,t,null,i(n,t,r,!1))},t.frustumPoint=function(e,t){for(var r=0;r<6;r++)if(n(e[r],t)<0)return!1;return!0},t.frustumLineSegment=function(e,t,r,n){return o(e,t,r,i(n,t,r,!0))},t.closestPointOnRay=function(e,t,i,n){var a=r.vec3d.dot(t,r.vec3d.subtract(i,e,n));return r.vec3d.add(e,r.vec3d.scale(t,a,n),n),n};var s={dir:r.vec3d.create(),len:0,clip:r.vec2d.create()}}.apply(null,i))||(e.exports=n)},771:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(341),r(338),r(343),r(975)],void 0===(n=function(e,t,r,i,n,a){function o(e,t,i){for(var n="",a=0;a<i;){var o=e[t+a];if(o<128)n+=String.fromCharCode(o),a++;else if(o>=192&&o<224){if(a+1>=i)throw new r("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");var s=(31&o)<<6|63&e[t+a+1];n+=String.fromCharCode(s),a+=2}else if(o>=224&&o<240){if(a+2>=i)throw new r("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");s=(15&o)<<12|(63&e[t+a+1])<<6|63&e[t+a+2];n+=String.fromCharCode(s),a+=3}else{if(!(o>=240&&o<248))throw new r("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");if(a+3>=i)throw new r("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");if((s=(7&o)<<18|(63&e[t+a+1])<<12|(63&e[t+a+2])<<6|63&e[t+a+3])>=65536){var u=55296+(s-65536>>10),l=56320+(1023&s);n+=String.fromCharCode(u,l)}else n+=String.fromCharCode(s);a+=4}}return n}function s(e,r){for(var i={byteOffset:0,byteCount:0,fields:Object.create(null)},n=0,a=0;a<r.length;a++){var o=r[a],s=o.valueType||o.type,u=t.valueType2ArrayBufferReader[s];i.fields[o.property]=u(e,n),n+=t.valueType2TypedArrayClassMap[s].BYTES_PER_ELEMENT}return i.byteCount=n,i}function u(e,t,i){var n,a,s=[],u=0;for(a=0;a<e;a+=1){if((n=t[a])>0){if(s.push(o(i,u,n-1)),0!==i[u+n-1])throw new r("string-array-error","Invalid string array: missing null termination.")}else s.push(null);u+=n}return s}function l(e,r){return new(0,t.valueType2TypedArrayClassMap[r.valueType])(e,r.byteOffset,r.count*r.valuesPerElement)}function d(e,t){return new Uint8Array(e,t.byteOffset,t.byteCount)}function c(e,t,n){for(var a=null!=t.header?s(e,t.header):{byteOffset:0,byteCount:0,fields:{count:n}},o={header:a,byteOffset:a.byteCount,byteCount:0,entries:Object.create(null)},u=a.byteCount,l=0;l<t.ordering.length;l++){var d=t.ordering[l],c=i.clone(t[d]);if(c.count=a.fields.count,"String"===c.valueType){if(c.byteOffset=u,c.byteCount=a.fields[d+"ByteCount"],"UTF-8"!==c.encoding)throw new r("unsupported-encoding","Unsupported String encoding.",{encoding:c.encoding})}else{if(!p(c.valueType))throw new r("unsupported-value-type","Unsupported binary valueType",{valueType:c.valueType});var h=f(c.valueType);u+=u%h!=0?h-u%h:0,c.byteOffset=u,c.byteCount=h*c.valuesPerElement*c.count}u+=c.byteCount,o.entries[d]=c}return o.byteCount=u-o.byteOffset,o}function h(e,t,i){if(t!==e&&g.error("Invalid "+i+" buffer size\n expected: "+e+", actual: "+t+")"),t<e)throw new r("buffer-too-small","Binary buffer is too small",{expectedSize:e,actualSize:t})}function p(e){return t.valueType2TypedArrayClassMap.hasOwnProperty(e)}function f(e){return p(e)&&t.valueType2TypedArrayClassMap[e].BYTES_PER_ELEMENT}Object.defineProperty(t,"__esModule",{value:!0});var g=n.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader");t.readHeader=s,t.readStringArray=u,t.createTypedView=l,t.createRawView=d,t.createAttributeDataIndex=c,t.createGeometryDataIndex=function(e,t,r){var n=s(e,t&&t.header),a=n.byteCount,o={header:n,byteOffset:n.byteCount,byteCount:0,vertexAttributes:i.clone(t.vertexAttributes)},u=o.vertexAttributes;r||null==u.region||delete u.region;for(var l=n.fields,d=null!=l.vertexCount?l.vertexCount:l.count,c=0;c<t.ordering.length;c++){var p=t.ordering[c];null!=u[p]&&(u[p].byteOffset=a,u[p].count=d,a+=f(u[p].valueType)*u[p].valuesPerElement*d)}var g=l.faceCount;if(t.faces&&g){o.faces=i.clone(t.faces);var m=o.faces;for(c=0;c<t.ordering.length;c++){var v=t.ordering[c];null!=m[v]&&(m[v].byteOffset=a,m[v].count=g,a+=f(m[v].valueType)*m[v].valuesPerElement*g)}}var y=l.featureCount;if(t.featureAttributes&&t.featureAttributeOrder&&y){o.featureAttributes=i.clone(t.featureAttributes);var _=o.featureAttributes;for(c=0;c<t.featureAttributeOrder.length;c++){var b=t.featureAttributeOrder[c];_[b].byteOffset=a,_[b].count=y;var x=f(_[b].valueType);"UInt64"===_[b].valueType&&(x=8),a+=x*_[b].valuesPerElement*y}}return h(a,e.byteLength,"geometry"),o.byteCount=a-o.byteOffset,o},t.readBinaryAttribute=function(e,t,i){if("lepcc-rgb"===e.encoding)return a.decodeRGB(t);if("lepcc-intensity"===e.encoding)return a.decodeIntensity(t);if(null!=e.encoding&&""!==e.encoding)throw new r("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");e["attributeByteCounts "]&&!e.attributeByteCounts&&(g.warn("Warning: Trailing space in 'attributeByteCounts '."),e.attributeByteCounts=e["attributeByteCounts "]),"ObjectIds"===e.ordering[0]&&e.hasOwnProperty("objectIds")&&(g.warn("Warning: Case error in objectIds"),e.ordering[0]="objectIds");var n=c(t,e,i);h(n.byteOffset+n.byteCount,t.byteLength,"attribute");var o=n.entries.attributeValues||n.entries.objectIds;if(o){if("String"===o.valueType){var s=n.entries.attributeByteCounts,p=l(t,s),f=d(t,o);return u(s.count,p,f)}return l(t,o)}throw new r("bad-attribute-storage-info","Bad attributeStorageInfo specification.")},t.valueType2TypedArrayClassMap={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array},t.valueType2ArrayBufferReader={Float32:function(e,t){return new DataView(e,0).getFloat32(t,!0)},Float64:function(e,t){return new DataView(e,0).getFloat64(t,!0)},UInt8:function(e,t){return new DataView(e,0).getUint8(t)},Int8:function(e,t){return new DataView(e,0).getInt8(t)},UInt16:function(e,t){return new DataView(e,0).getUint16(t,!0)},Int16:function(e,t){return new DataView(e,0).getInt16(t,!0)},UInt32:function(e,t){return new DataView(e,0).getUint32(t,!0)},Int32:function(e,t){return new DataView(e,0).getInt32(t,!0)}},t.isValueType=p,t.getBytesPerValue=f}.apply(null,i))||(e.exports=n)},780:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(830)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){void 0===t&&(t=1),this.rctx=e,this.fieldCount=t,this.buffers=[]}return e.prototype.garbageCollect=function(){this.buffers=this.buffers.filter(function(e){return 0!==e.activeCount||(e.dispose(),!1)})},e.prototype.getBuffer=function(e){for(var t=0,i=this.buffers;t<i.length;t++){var n=i[t];if(n.availableCount>=e)return n}if(e>r.MAX_INDEX_COUNT)return null;var a=new r.ManagedTextureBackedBuffer(this.rctx,this.fieldCount);return this.buffers.push(a),a},e.prototype.updateTextures=function(){for(var e=0,t=this.buffers;e<t.length;e++)t[e].textureBuffer.updateTexture()},e}();t.BufferManager=i}.apply(null,i))||(e.exports=n)},781:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(769)],void 0===(n=function(e,t,r){return function(){function e(e){this._filterSampleIndex=0,this._lastTime=NaN,this._totalTime=0,this._numMeasurements=0,this._filterSamples=new Array(e),this.reset(),this._filterSize=e}return e.prototype.reset=function(){this._filterSampleIndex=0;for(var e=0;e<this._filterSize;e++)this._filterSamples[e]=NaN},e.prototype.start=function(){this._tsStart=r.now()},e.prototype.stop=function(){var e=r.now();return this._lastTime=e-this._tsStart,this._totalTime+=this._lastTime,this._numMeasurements++,this._filterSize&&(this._filterSamples[this._filterSampleIndex]=this._lastTime,this._filterSampleIndex=(this._filterSampleIndex+1)%this._filterSize),this._lastTime},e.prototype.getLast=function(){return this._lastTime},e.prototype.getLastFiltered=function(){for(var e=0,t=0;t<this._filterSamples.length;t++)e+=this._filterSamples[t];return e/this._filterSamples.length},e.prototype.getAverage=function(){return this._totalTime/this._numMeasurements},e.prototype.getTotal=function(){return this._totalTime},e.prototype.getNumMeasurements=function(){return this._numMeasurements},e}()}.apply(null,i))||(e.exports=n)},788:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(653),n=r(450),a=r(654),o=r(889),s=r(614),u=r(1008);if(s.default("es6-array")&&s.default("es6-array-fill"))t.from=n.default.Array.from,t.of=n.default.Array.of,t.copyWithin=u.wrapNative(n.default.Array.prototype.copyWithin),t.fill=u.wrapNative(n.default.Array.prototype.fill),t.find=u.wrapNative(n.default.Array.prototype.find),t.findIndex=u.wrapNative(n.default.Array.prototype.findIndex);else{var l=function(e){return isNaN(e)?0:(e=Number(e),isFinite(e)&&(e=Math.floor(e)),Math.min(Math.max(e,0),o.MAX_SAFE_INTEGER))},d=function(e){return e=Number(e),isNaN(e)?0:0!==e&&isFinite(e)?(e>0?1:-1)*Math.floor(Math.abs(e)):e},c=function(e,t){return e<0?Math.max(t+e,0):Math.min(e,t)};t.from=function(e,t,r){if(null==e)throw new TypeError("from: requires an array-like object");t&&r&&(t=t.bind(r));var n,o,s=l(e.length),u="function"==typeof this?Object(new this(s)):new Array(s);if(!a.isArrayLike(e)&&!a.isIterable(e))return u;if(a.isArrayLike(e)){if(0===s)return[];for(var d=0;d<e.length;d++)u[d]=t?t(e[d],d):e[d]}else{d=0;try{for(var c=i.__values(e),h=c.next();!h.done;h=c.next()){var p=h.value;u[d]=t?t(p,d):p,d++}}catch(e){n={error:e}}finally{try{h&&!h.done&&(o=c.return)&&o.call(c)}finally{if(n)throw n.error}}}return void 0!==e.length&&(u.length=s),u},t.of=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Array.prototype.slice.call(e)},t.copyWithin=function(e,t,r,i){if(null==e)throw new TypeError("copyWithin: target must be an array-like object");var n=l(e.length);t=c(d(t),n),r=c(d(r),n),i=c(void 0===i?n:d(i),n);var a=Math.min(i-r,n-t),o=1;for(t>r&&t<r+a&&(o=-1,r+=a-1,t+=a-1);a>0;)r in e?e[t]=e[r]:delete e[t],t+=o,r+=o,a--;return e},t.fill=function(e,t,r,i){var n=l(e.length),a=c(d(r),n);for(i=c(void 0===i?n:d(i),n);a<i;)e[a++]=t;return e},t.find=function(e,r,i){var n=t.findIndex(e,r,i);return-1!==n?e[n]:void 0},t.findIndex=function(e,t,r){var i=l(e.length);if(!t)throw new TypeError("find: second argument must be a function");r&&(t=t.bind(r));for(var n=0;n<i;n++)if(t(e[n],n,e))return n;return-1}}if(s.default("es7-array"))t.includes=u.wrapNative(n.default.Array.prototype.includes);else{t.includes=function(e,t,r){void 0===r&&(r=0);for(var i,n=(i=e.length,i=Number(i),isNaN(i)?0:(isFinite(i)&&(i=Math.floor(i)),Math.min(Math.max(i,0),o.MAX_SAFE_INTEGER))),a=r;a<n;++a){var s=e[a];if(t===s||t!=t&&s!=s)return!0}return!1}}},792:function(e,t,r){var i;!function(t){function r(e){this._callbacks=[],this._errbacks=[],this._cancelCallback=e,this._iscancelled=!1,this._isdone=!1,this._iserr=!1}r.prototype.cancel=function(e){this._callbacks=[],this._errbacks=[],this._iscancelled=!0,this._cancelCallback&&this._cancelCallback(e)},r.prototype.then=function(e,t,r){var i;if(!this._iscancelled)return this._isdone?i=e.apply(r,this.result):this._iserr&&t?i=t.apply(r,this.result):(this._callbacks.push(function(){return e.apply(r,arguments)}),t&&this._errbacks.push(function(){return t.apply(r,arguments)})),i},r.prototype.done=function(){this.result=arguments,this._isdone=!0;for(var e=0;e<this._callbacks.length;e++)this._callbacks[e].apply(null,arguments);this._callbacks=[],this._errbacks=[]},r.prototype.resolve=r.prototype.done,r.prototype.reject=function(){if(!this._iscancelled){this.result=arguments,this._iserr=!0;for(var e=0;e<this._errbacks.length;e++)this._errbacks[e].apply(null,arguments);this._callbacks=[],this._errbacks=[]}},r.prototype.isRejected=function(){return this._iserr},r.prototype.isFulfilled=function(){return this._isdone||this._iserr},r.prototype.isResolved=function(){return this._isdone},r.prototype.isCancelled=function(){return this._iscancelled};var n={Promise:r,join:function(e){function t(e,t){return function(){t&&(s=!0),a+=1,o[e]=Array.prototype.slice.call(arguments),a===n&&(s?i.reject():i.done(o))}}for(var i=new r,n=e.length,a=0,o=[],s=!1,u=0;u<n;u++)e[u].then(t(u,!1),t(u,!0));return 0===e.length&&i.done(),i},chain:function e(t,i){var n=new r;return 0===t.length?n.done.apply(n,i):t[0].apply(null,i).then(function(){t.splice(0,1),e(t,arguments).then(function(){n.done.apply(n,arguments)})}),n}};void 0===(i=function(){return n}.apply(null,[]))||(e.exports=i)}()},813:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(379),r(680),r(445),r(348)],void 0===(n=function(e,t,r,i,n,a){return function(){function e(e){this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this._dirtyMaterials=new Set,this._model=e}return Object.defineProperty(e.prototype,"residentLayerCount",{get:function(){return this._residentGeomRecords.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"residentObjectCount",{get:function(){var e=0;return this._residentGeomRecords.forEach(function(t){e+=t.size}),e},enumerable:!0,configurable:!0}),e.prototype.getDirtyMaterials=function(){return this._dirtyMaterials.size>0?this._dirtyMaterials:null},e.prototype.clearDirtyMaterials=function(){this._dirtyMaterials.clear()},e.prototype.hasDirtyGeometryRecords=function(){var e=!1;return i.everyMap(this._dirtyGeomRecords,function(t){if(e)return!1;i.everyMap(t,function(t){if(!e&&t&&t.size>0)return e=!0,!1})}),e},e.prototype.handleUpdate=function(e,t,r){return a.assert(this[t],"ModelDirtySet doesn't know how to process "+t),this[t](e,r)},e.prototype.shaderTransformationChanged=function(e){var t=this,r=this._residentGeomRecords.get(e.id);r&&r.forEach(function(e,r){var i=t._model.content[n.OBJECT][r];i&&i.hasVolativeTransformation()&&e.forEach(function(e){for(var t=0,r=e[1];t<r.length;t++)r[t].shaderTransformationChanged()})})},e.prototype.commit=function(){return this.commitLayers(r.keysOfMap(this._dirtyGeomRecords))},e.prototype.commitLayers=function(e){for(var t=this,r=[],i=[],o=[],s=this,u=0;u<e.length;u++)!function(u){var l=e[u],d=s._dirtyGeomRecords.get(l);if(!d)return"continue";d.forEach(function(e,s){var u=t._ensureGeomRecord(l,s);e.forEach(function(e,l){var d,c=e[0],h=e[1],p=e[2],f=2&h&&1&p;(4&h||f)&&((d=u.get(l))?i.push.apply(i,d[1]):4===h&&a.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove"),d&&u.delete(l));if(1&h||f){var g=[c,[]],m=t._model.get(n.OBJECT,s);t._model.getGeometryRenderGeometries(m,c,g[1]),r.push.apply(r,g[1]),u.set(l,g)}if(2&h&&!f)if(d=u.get(l)){var v=d[1],y=v.length;if(16&p){m=t._model.get(n.OBJECT,s);for(var _=0;_<y;_++){var b=v[_];t._model.updateRenderGeometryTransformation(m,c,b)}}for(_=0;_<y;_++){b=v[_];o.push({renderGeometry:b,updateType:p})}}else a.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}),0===u.size&&t._residentGeomRecords.get(l).delete(s)}),0===s._residentGeomRecords.get(l).size&&s._residentGeomRecords.delete(l),s._dirtyGeomRecords.delete(l)}(u);return[r,i,o]},e.prototype.getResidentRenderGeometries=function(){return this.getResidentRenderGeometriesFilteredByLayers(r.keysOfMap(this._residentGeomRecords))},e.prototype.getResidentRenderGeometriesFilteredByLayers=function(e){for(var t=[],r=0;r<e.length;r++){var i=e[r],n=this._residentGeomRecords.get(i);n&&n.forEach(function(e){e.forEach(function(e){t.push.apply(t,e[1])})})}return t},e.prototype.visibilityChanged=function(e,t,r){if(null!=t)this._componentPropertyChanged(e,t,r,2);else for(var i=0,n=e.getGeometryRecords();i<n.length;i++){var a=n[i];this._componentPropertyChanged(e,a,r,2)}},e.prototype.componentHighlightChanged=function(e,t,r){if(null!=t)this._componentPropertyChanged(e,t,r,32);else for(var i=0,n=e.getGeometryRecords();i<n.length;i++){var a=n[i];this._componentPropertyChanged(e,a,r,32)}},e.prototype.vertexAttrsUpdated=function(e,t,r){this._updateOrCreateDirtyRecord(e,t,r,2,0,0,2,5,4)},e.prototype.matChanged=function(e){this._dirtyMaterials.add(e.id),this.onMaterialChanged&&this.onMaterialChanged(e)},e.prototype.layerAdded=function(e){for(var t=e.getObjects(),r=0;r<t.length;r++)this.layObjectAdded(e,t[r])},e.prototype.layerRemoved=function(e){for(var t=e.getObjects(),r=0;r<t.length;r++)this.layObjectRemoved(e,t[r])},e.prototype.layObjectAdded=function(e,t){for(var r=e.id,i=t.getGeometryRecords(),n=0;n<i.length;n++)this.objGeometryAdded(t,i[n],r)},e.prototype.layObjectRemoved=function(e,t){for(var r=e.id,i=t.getGeometryRecords(),n=0;n<i.length;n++)this.objGeometryRemoved(t,i[n],r)},e.prototype.layObjectReplaced=function(e,t){this.layObjectRemoved(e,t[0]),this.layObjectAdded(e,t[1])},e.prototype.objDirty=function(e,t){var r=this;t=t||this._getParentLayerId(e);var i=e.id;this._ensureGeomRecord(t,i).forEach(function(i){r._updateOrCreateDirtyRecord(e,i[0],t,2,0,2,0,5,1)})},e.prototype.objTransformation=function(e,t){var r=this;t=t||this._getParentLayerId(e);var i=e.id;this._ensureGeomRecord(t,i).forEach(function(i){r._updateOrCreateDirtyRecord(e,i[0],t,2,0,0,2,5,16)})},e.prototype.objGeometryAdded=function(e,t,r){this._updateOrCreateDirtyRecord(e,t,r,1,4,0,0,0)},e.prototype.objGeometryRemoved=function(e,t,r){this._updateOrCreateDirtyRecord(e,t,r,4,1,2,0,0)},e.prototype.objGeometryReplaced=function(e,t){this.objGeometryRemoved(e,t[0]),this.objGeometryAdded(e,t[1])},e.prototype.objGeometryTransformation=function(e,t){this.objGeometryReplaced(e,t)},e.prototype._componentPropertyChanged=function(e,t,r,i){this._updateOrCreateDirtyRecord(e,t,r,2,0,0,2,5,i)},e.prototype._updateOrCreateDirtyRecord=function(e,t,r,i,n,o,s,u,l){r=r||this._getParentLayerId(e);var d=e.id,c=t.id,h=this._ensureDirtyRecord(r,d),p=h.get(c);if(p){var f=p[1];f&n?h.delete(c):f&o?(p[1]=i,p[2]=l):f&s?p[2]|=l:f&u||a.assert(!1,"ModelDirtySet.objGeometryAdded: inconsistent state")}else h.set(c,[t,i,l])},e.prototype._ensureGeomRecord=function(e,t){var r=this._residentGeomRecords.get(e);r||(r=new Map,this._residentGeomRecords.set(e,r));var i=r.get(t);return i||(i=new Map,r.set(t,i)),i},e.prototype._ensureDirtyRecord=function(e,t){var r=this._dirtyGeomRecords.get(e);r||(r=new Map,this._dirtyGeomRecords.set(e,r));var i=r.get(t);return i||(i=new Map,r.set(t,i)),i},e.prototype._getParentLayerId=function(e){return e.parentLayer.id},e.prototype.formatDebugInfo=function(e){if(e)return"";var t=["ADD","UPD",void 0,"REM"],r="";return this._dirtyGeomRecords.forEach(function(e,i){e.forEach(function(e,n){r.length>0&&(r+="\n"),r+=i+"."+n;var a=[];e.forEach(function(e){var t=e[1];a[t]||(a[t]=[]),a[t].push(e[0].geometry.id)});for(var o=0;o<a.length;o++)if(a[o]){r+=" "+t[o-1]+": ";for(var s=0;s<a[o].length;s++)r+=a[o][s]+", "}})}),r},e}()}.apply(null,i))||(e.exports=n)},814:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(344),r(353),r(343),r(339),r(342),r(815),r(843),r(844),r(995),r(845),r(617),r(724),r(847),r(710),r(800),r(372),r(969)],void 0===(n=function(e,t,r,i,n,a,o,s,u,l,d,c,h,p,f,g,m,v,y){var _=n.getLogger("esri.views.3d.webgl-engine.parts.View"),b=function(){function e(e,t,r,i){var n=this;this._backgroundColor=o.vec4d.createFrom(1,1,1,1),this._lightDirection=o.vec3d.createFrom(0,1,0),this._didRender=!1,this._needsRender=!0,this._idleSuspend=!0,this._shouldRender=!1,this._supersampleScreenshots=!0,this._screenshotQueue=[],this._container=e,this._stage=t,this._initializeContext(i),this._programRepository=new d(this._rctx),this._programRepository.globalOptions.viewingMode=i.viewingMode;this._textureRep=new l(t.getAll(p.ContentType.TEXTURE),this._programRepository,function(){return n._viewport.getCamera().viewport},this._rctx),this._materialRep=new u(this._textureRep,this._programRepository),this._viewport=new f(this._stage,this._programRepository,this._materialRep,this._textureRep,this._rctx),this._initializeViewportCamera(),this._drapedRenderer=new s(this._rctx,this._canvas,this._programRepository,this._materialRep,this._textureRep,r),this._initializeFrameTask()}return Object.defineProperty(e.prototype,"isLoadingResources",{get:function(){return this._viewport.isLoadingResources},enumerable:!0,configurable:!0}),e.prototype._initializeFrameTask=function(){var e=this;this._frameTask={preRender:function(){c.begin(),e._stage.processDirty(),e.needsRender()?(e._shouldRender=!0,e._viewport.getCamera().setGLViewport(e._rctx),e._rctx.setClearColor.apply(e._rctx,e._backgroundColor),e._rctx.clear(16640)):e._shouldRender=!1},render:function(){e._shouldRender&&(e._didRender=!0,x.lightDirection=e._lightDirection,e._viewport.render(x))},postRender:function(){c.end()},update:function(){e.resetNeedsRender(),e._performScreenshots()}}},e.prototype._initializeViewportCamera=function(){var e=this._container.getBoundingClientRect(),t=this._viewport.getCamera();t.viewport[2]=e.width,t.viewport[3]=e.height,this._viewport.setCamera(t)},e.prototype._initializeContext=function(e){this._canvas=e.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");var t={alpha:e.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:null==e.stencil||e.stencil},r=m.createContextOrErrorHTML(this._canvas,t,e.renderContext);this._gl=c.instrumentContext(r);var n={disabledExtensions:e.deactivatedWebGLExtensions||{}};this._rctx=new y(this._gl,n),!e.alpha&&this._rctx.contextAttributes.alpha&&_.error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&i("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas),null!=e.supersampleScreenshots&&(this._supersampleScreenshots=e.supersampleScreenshots)},e.prototype.dispose=function(){this._viewport.dispose(),this._viewport=null,this._drapedRenderer.dispose(),this._drapedRenderer=null,this._programRepository.dispose(),this._programRepository=null,this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._container=null,this._canvas=null,this._gl=null,this._frameTask=null},e.prototype.getCombinedStats=function(){return this._viewport.getCombinedStats()},e.prototype.setNeedsRender=function(){this._didRender=!1,this._needsRender=!0},e.prototype.resetNeedsRender=function(){this._didRender&&(this._needsRender=!1,this._didRender=!1),this._viewport.resetNeedsRender(),this._textureRep.resetNeedsRender()},e.prototype.needsRender=function(){return this._needsRender||!this._idleSuspend||this._viewport.needsRender()||this._textureRep.needsRender()},e.prototype.getFrameTask=function(){return this._frameTask},e.prototype.setLighting=function(e){o.vec3d.set3(0,0,0,this._lightDirection);for(var t=0,r=e.lights;t<r.length;t++){var i=r[t];if(i instanceof h.MainLight){o.vec3d.negate(i.direction,this._lightDirection);break}}this._viewport.setLighting(e),this._needsRender=!0},e.prototype.getEdgeView=function(){return this._viewport.getEdgeView()},e.prototype.getMainLightDirection=function(){return this._lightDirection},e.prototype.getViewParams=function(e){var t={};return e&&!e.backgroundColor||(t.backgroundColor=this._backgroundColor),t},e.prototype.setViewParams=function(e){this._needsRender=!0,e.backgroundColor&&(this._backgroundColor=e.backgroundColor)},e.prototype.setRenderParams=function(e){this._needsRender=!0,void 0!==e.idleSuspend&&(this._idleSuspend=!!e.idleSuspend),this._viewport.setRenderParams(e)},e.prototype.getRenderParams=function(){var e=this._viewport.getRenderParams();return e.anisotropicFiltering=this._textureRep.getMaxAnisotropy(),e.idleSuspend=this._idleSuspend,e},e.prototype.getIdleSuspend=function(){return this._idleSuspend},Object.defineProperty(e.prototype,"renderingContext",{get:function(){return this._rctx},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return"s3tc"===e?!!this._rctx.capabilities.compressedTextureS3TC:"shaderTextureLOD"===e&&!!this._rctx.capabilities.shaderTextureLOD},e.prototype.modify=function(e,t,r,i){this._viewport.modify(e,t,r,i)},e.prototype.setCamera=function(e){this._viewport.setCamera(e)},e.prototype.getCamera=function(){return this._viewport.getCamera()},e.prototype.getCanvas=function(){return this._canvas},e.prototype.getDrapedTextureRenderer=function(){return this._drapedRenderer},e.prototype.takeScreenshot=function(e){var t=this,r=a.createResolver(function(){t._screenshotQueue=t._screenshotQueue.filter(function(e){return e.resolver!==r})});return this._screenshotQueue.push({settings:e,resolver:r}),this._needsRender=!0,r.promise},e.prototype.getFramebufferTexture=function(e){return this._viewport.getFramebufferTexture(e)},Object.defineProperty(e.prototype,"renderPlugins",{get:function(){return this._viewport.renderPlugins},enumerable:!0,configurable:!0}),e.prototype._screenshotSuperSampleSettings=function(e){if(!this._supersampleScreenshots)return e;var t=e.framebufferWidth,i=e.framebufferHeight,n=e.pixelRatio,a=e.region,o=Math.min(T,w/Math.max(t,i));return o<S?e:r({},e,{framebufferWidth:Math.round(t*o),framebufferHeight:Math.round(i*o),pixelRatio:n*o,resample:{region:{x:Math.round(a.x*o),y:Math.round(a.y*o),width:Math.round(a.width*o),height:Math.round(a.height*o)},width:t,height:i}})},e.prototype._readbackScreenshot=function(e){var t=e.framebufferWidth,r=e.framebufferHeight,i=e.region,n=e.resample;if(n){var a=g.createEmptyImageData(t,r,this._ensureScreenshotEncodeCanvas());this._gl.readPixels(0,0,t,r,6408,5121,new Uint8Array(a.data.buffer));var o=g.createEmptyImageData(i.width,i.height,this._ensureScreenshotEncodeCanvas());return g.resampleHermite(a,o,!0,n.region.x,r-(n.region.y+n.region.height),n.region.width,n.region.height)}a=g.createEmptyImageData(i.width,i.height,this._ensureScreenshotEncodeCanvas());return this._gl.readPixels(i.x,r-(i.y+i.height),i.width,i.height,6408,5121,new Uint8Array(a.data.buffer)),a},e.prototype._renderScreenshot=function(e){var t=null,r=this._viewport.getCamera(),i=this._screenshotSuperSampleSettings(e),n=i.framebufferWidth,a=i.framebufferHeight,o=!1;if(n!==r.fullWidth||a!==r.fullHeight){var s=r.copy();s.fullWidth=n,s.fullHeight=a;var u=r.fovX-s.fovX,l=r.fovY-s.fovY;u<0&&u<l?s.fovX=r.fovX:l<0&&l<u&&(s.fovY=r.fovY),this._drapedRenderer.forceUpdate&&this._drapedRenderer.forceUpdate(s),o=!0,t=new v(this._rctx,{width:s.fullWidth,height:s.fullHeight,colorTarget:0,depthStencilTarget:3}),this._rctx.bindFramebuffer(t),s.setGLViewport(this._rctx),this._rctx.setClearColor.apply(this._rctx,this._backgroundColor),this._rctx.clear(16640),this._viewport.render({lightDirection:this._lightDirection,fbo:t,camera:s,pixelRatio:i.pixelRatio})}var d=this._readbackScreenshot(i);return t&&t.dispose(),this._rctx.bindFramebuffer(null),o&&this._drapedRenderer.forceUpdate&&this._drapedRenderer.forceUpdate(r),d},e.prototype._performScreenshots=function(){if(0!==this._screenshotQueue.length){for(var e=0,t=this._screenshotQueue;e<t.length;e++){var r=t[e],i=r.settings;if(this._gl){var n=this._ensureScreenshotEncodeCanvas(),a=this._renderScreenshot(i),o=g.encodeResult(a,i,n,{flipY:!0,premultipliedAlpha:!0});r.resolver(o)}else r.resolver.reject()}this._screenshotQueue=[]}},e.prototype._ensureScreenshotEncodeCanvas=function(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas},e}(),x={lightDirection:o.vec3d.create(),camera:null,fbo:null,pixelRatio:1},w=2048,S=1.5,T=8;return b}.apply(null,i))||(e.exports=n)},815:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(342),r(601),r(630),r(421),r(430),r(417),r(723),r(725),r(460),r(728),r(348),r(617),r(842),r(372),r(368),r(390)],void 0===(n=function(e,t,r,i,n,a,o,s,u,l,d,c,h,p,f,g,m,v){var y=function(){function e(e,t,i,n,a,o){var s=this;this._renderTargets={},this._clearColor=r.vec4d.createFrom(0,0,0,0),this._id2origin={},this._uniqueIdx=0,this._rctx=e,this._canvas=t,this._programRep=i,this._modelDirtySet=o,this._modelDirtySet.onMaterialChanged=function(e){return s.materialChanged(e)},this._renderer=new l(i,n,a,this._rctx,!0),this._sliceHelper=new c,this._renderer.onHasHighlightsChanged=function(e){s.onHasHighlightsChanged&&s.onHasHighlightsChanged(e)},this._renderer.setLighting({lights:[new p.AmbientLight(r.vec3d.createFrom(1,1,1))],groundLightingFactor:1,globalFactor:0})}return e.prototype.dispose=function(){for(var e in this._renderTargets)this._renderTargets[e].dispose();this._renderTargets=null,this._renderer.dispose(),this._renderer=null},e.prototype.createRenderTarget=function(e){return this.createRenderTargetInternal(e,!0)},e.prototype.createHighlightRenderTarget=function(e){return this.createRenderTargetInternal(e,!1)},e.prototype.disposeRenderTarget=function(e){var t=this._renderTargets[e];t&&t.dispose(),delete this._renderTargets[e]},e.prototype.getRenderTargetTexture=function(e){var t=this._renderTargets[e];return t?t.colorTexture:null},e.prototype.addRenderGeometries=function(e){var t=this;e.forEach(function(e){null==e.origin&&(e.origin=t.getOrigin(e.center,e.bsRadius)),e.idx=t._uniqueIdx++}),this._renderer.modify(e,[]),this.onContentChanged&&this.onContentChanged()},e.prototype.removeRenderGeometries=function(e){this._renderer.modify([],e),this.onContentChanged&&this.onContentChanged()},e.prototype.updateRenderGeometries=function(e,t){var r=e.map(function(e){return{renderGeometry:e,updateType:t}});this._renderer.modify([],[],r),this.onContentChanged&&this.onContentChanged()},e.prototype.updateRenderOrder=function(e){e.size>0&&(this._renderer.modifyRenderOrder(e),this.onContentChanged&&this.onContentChanged())},e.prototype.setBackgroundColor=function(e){this._clearColor=e,this.onContentChanged&&this.onContentChanged()},e.prototype.addRenderGeometryHighlight=function(e,t){var r=e.instanceParameters,i=u.generateHighlightId();return r.componentHighlights=a.addHighlight(r.componentHighlights,null,t,i),this.updateRenderGeometries([e],32),i},e.prototype.removeRenderGeometryHighlight=function(e,t){var r=e.instanceParameters;r.componentHighlights=a.removeHighlight(r.componentHighlights,t),this.updateRenderGeometries([e],32)},e.prototype.isEmpty=function(){return this._renderer.isEmpty()&&!i.OVERLAY_DRAW_TEST_TEXTURE},e.prototype.processDirtyMaterials=function(){var e=this._modelDirtySet.getDirtyMaterials();e&&this._renderer.modify([],[],[],e),this._modelDirtySet.clearDirtyMaterials()},Object.defineProperty(e.prototype,"hasHighlights",{get:function(){return this._renderer.hasHighlights},enumerable:!0,configurable:!0}),e.prototype.draw=function(e,t){return this.drawPass(d.MATERIAL,e,t)},e.prototype.drawHighlights=function(e,t){return this.drawPass(d.MATERIAL_HIGHLIGHT,e,t)},e.prototype.drawPass=function(e,t,n){if(this.isEmpty()||e===d.MATERIAL_HIGHLIGHT&&!this.hasHighlights)return!1;if(this.processDirtyMaterials(),!n.views.some(function(e){return e.extent[0]!==e.extent[2]&&e.extent[1]!==e.extent[3]}))return!1;var a=this._renderTargets[t];if(!a)return!1;var o=this._rctx,s=o.gl,u=n.width,l=n.height;a.width===u&&a.height===l||(a.resize(u,l),a.colorTexture.setSamplingMode(9729));var c=b.camera;b.fbo=a,b.pixelRatio=n.pixelRatio||1,c.near=1,c.far=1e4,o.bindFramebuffer(a),o.setDepthTestEnabled(!1),o.setBlendFunctionSeparate(770,771,1,771),o.setClearColor.apply(o,this._clearColor),o.clear(s.COLOR_BUFFER_BIT);for(var h=0;h<n.views.length;h++){var p=n.views[h];c.viewport=p.viewport,r.mat4d.ortho(0,p.extent[2]-p.extent[0],0,p.extent[3]-p.extent[1],c.near,c.far,c.projectionMatrix),r.mat4d.identity(c.viewMatrix),r.mat4d.translate(c.viewMatrix,[-p.extent[0],-p.extent[1],0]),c.setGLViewport(this._rctx),i.OVERLAY_DRAW_TEST_TEXTURE&&this._drawTestTexture(u,l,_[n.index%_.length]),this._renderer.renderGeometryPass(e,b,null,null,this._sliceHelper)}return o.setDepthTestEnabled(!0),o.setBlendFunctionSeparate(770,771,1,771),o.bindFramebuffer(null),o.setViewport(0,0,this._canvas.width,this._canvas.height),a.colorTexture.descriptor.hasMipmap&&a.colorTexture.generateMipmap(),!0},e.prototype._drawTestTexture=function(e,t,i){var n=this._rctx,a=n.gl;if(!this._testPatternMat){for(var u=new Uint8Array(e*t*4),l=0,d=0;d<t;d++)for(var c=0;c<e;c++){var h=Math.floor(c/10),p=Math.floor(d/10);h<2||p<2||10*h>e-20||10*p>t-20?(u[l++]=255,u[l++]=255,u[l++]=255,u[l++]=255):(u[l++]=255,u[l++]=255,u[l++]=255,u[l++]=1&h&&1&p?1&c^1&d?0:255:1&h^1&p?0:128)}var g=new m(n,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:e,height:t},u);this._testPatternMat=new f(this._programRep,g,[1,1,1,1],!0,a.ALWAYS),this._testPatternBindParams={proj:r.mat4d.identity(),view:r.mat4d.identity(),nearFar:[-1,1],origin:[0,0,0],viewInvTransp:null,viewport:null,lightingData:null,fovY:0},this._quadVAO=s.createQuadVAO(n,o.Pos3Tex)}this._testPatternMat.setColor([i[0],i[1],i[2],1]),this._testPatternMat.bind(n,this._testPatternBindParams),this._testPatternMat.bindView(n,this._testPatternBindParams),n.bindVAO(this._quadVAO),n.drawArrays(5,0,v.vertexCount(this._quadVAO,"geometry")),this._testPatternMat.release(n)},e.prototype.getOrigin=function(e,t){var i=0,n=10*t/1e4;n>1&&(i=Math.ceil(h.logWithBase(n,2)));var a=1e4*Math.pow(2,i),o=Math.round(e[0]/a),s=Math.round(e[1]/a),u=Math.round(e[2]/a),l=i+"_"+o+"_"+s+"_"+u,d=this._id2origin[l];return null==d&&(d={vec3:r.vec3d.createFrom(o*a,s*a,u*a),id:l},this._id2origin[l]=d),d},e.prototype.materialChanged=function(e){this.onContentChanged&&this.onContentChanged()},e.prototype.createRenderTargetInternal=function(e,t){for(var r=e,i=0;this._renderTargets[r];)r=e+"_"+ ++i;return this._renderTargets[r]=g.createWithAttachments(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9987,hasMipmap:t,maxAnisotropy:8,width:0,height:0},{colorTarget:0,depthStencilTarget:0}),r},e}(),_=[[1,.5,.5],[.5,.5,1],[.5,1,.5]],b={fbo:null,camera:new n,pixelRatio:1};return y}.apply(null,i))||(e.exports=n)},816:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(359)],void 0===(n=function(e,t,r){return function(){function e(e){null==e?e=16:e<65536&&(e=r.nextHighestPowerOfTwo(e)),this.array=new Float32Array(e),this.size=0}return e.prototype.resize=function(e,t){var r,i;if(void 0===t&&(t=!1),this.size=e,this.size>this.array.length){for(r=this.array.length||1;r<this.size;)r*=2;return i=new Float32Array(r),t&&i.set(this.array),this.array=i,!0}if(this.size<=this.array.length/2){r=this.array.length;for(var n=2*this.size;r>=n;)r=Math.floor(r/2);return i=new Float32Array(r),t&&i.set(this.array.subarray(0,r)),this.array=i,!0}return!1},e.prototype.append=function(e){var t=this.size;this.resize(this.size+e.length,!0),this.array.set(e,t)},e.prototype.erase=function(e,t){for(var r=e;r<t;++r)this.array[r]=0},e.prototype.getArray=function(){return this.array},e.prototype.getSize=function(){return this.size},e}()}.apply(null,i))||(e.exports=n)},817:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(382),r(760),r(376)],void 0===(n=function(e,t,r,i,n){var a=function(){function e(e){this.isEnabled=!1,this.vertexAttributeLocations={position:0},this.vertexBufferLayout=[{name:"position",count:2,type:5126,offset:0,stride:8,normalized:!1}],this.rctx=e}return e.prototype.enable=function(){if(!this.isEnabled){var e=this.rctx;this.program=new i(e,o.shader.vertex,o.shader.fragment,this.vertexAttributeLocations);var t=new Float32Array([-1,-1,3,-1,-1,3]);this.vao=new n(e,this.vertexAttributeLocations,{geometry:this.vertexBufferLayout},{geometry:new r(e,34962,35044,t)}),this.isEnabled=!0}},e.prototype.disable=function(){this.isEnabled&&(this.program.dispose(),this.program=null,this.vao.dispose(),this.vao=null,this.isEnabled=!1)},e.prototype.render=function(e,t){this.enable();var r=this.rctx;r.bindVAO(this.vao),r.bindFramebuffer(t);var i={x:0,y:0,width:0,height:0};null!=t?(i.width=t.descriptor.width,i.height=t.descriptor.height):(i.width=r.gl.canvas.width,i.height=r.gl.canvas.height),r.bindProgram(this.program),r.bindTexture(e.colorTexture,0),this.program.setUniform1i("uColorTexture",0),this.program.setUniform2f("uRcpFrameDimension",1/i.width,1/i.height),r.setFaceCullingEnabled(!1),r.drawArrays(4,0,3)},e}(),o={shader:{vertex:"\n      #version 100\n      precision highp float;\n\n      attribute vec2 position;\n\n      varying   vec2 fCoordinate;\n\n      void main() {\n        fCoordinate = (position + 1.0 ) * 0.5;\n        gl_Position = vec4(position, -1, 1);\n      }",fragment:"\n      #version 100\n      #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      #else\n      precision mediump float;\n      #endif\n\n      /**\n       * @license\n       * Copyright (c) 2011 NVIDIA Corporation. All rights reserved.\n       *\n       * TO  THE MAXIMUM  EXTENT PERMITTED  BY APPLICABLE  LAW, THIS SOFTWARE  IS PROVIDED\n       * *AS IS*  AND NVIDIA AND  ITS SUPPLIERS DISCLAIM  ALL WARRANTIES,  EITHER  EXPRESS\n       * OR IMPLIED, INCLUDING, BUT NOT LIMITED  TO, NONINFRINGEMENT,IMPLIED WARRANTIES OF\n       * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO EVENT SHALL  NVIDIA\n       * OR ITS SUPPLIERS BE  LIABLE  FOR  ANY  DIRECT, SPECIAL,  INCIDENTAL,  INDIRECT,  OR\n       * CONSEQUENTIAL DAMAGES WHATSOEVER (INCLUDING, WITHOUT LIMITATION,  DAMAGES FOR LOSS\n       * OF BUSINESS PROFITS, BUSINESS INTERRUPTION, LOSS OF BUSINESS INFORMATION, OR ANY\n       * OTHER PECUNIARY LOSS) ARISING OUT OF THE  USE OF OR INABILITY  TO USE THIS SOFTWARE,\n       * EVEN IF NVIDIA HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.\n       */\n\n      #define FXAA_EDGE_THRESHOLD      (1.0/8.0)\n      #define FXAA_EDGE_THRESHOLD_MIN  (1.0/24.0)\n      #define FXAA_SEARCH_STEPS        16\n      #define FXAA_SEARCH_THRESHOLD    (1.0/4.0)\n      #define FXAA_SUBPIX_CAP          (3.0/4.0)\n      #define FXAA_SUBPIX_TRIM         (1.0/4.0)\n      #define FXAA_SUBPIX_TRIM_SCALE (1.0/(1.0 - FXAA_SUBPIX_TRIM))\n\n      uniform vec2 uRcpFrameDimension;\n      uniform sampler2D uColorTexture;\n      varying vec2 fCoordinate;\n\n      // Return the luma, the estimation of luminance from rgb inputs.\n      // This approximates luma using one FMA instruction,\n      // skipping normalization and tossing out blue.\n      // FxaaLuma() will range 0.0 to 2.963210702.\n      float FxaaLuma(vec3 rgb) {\n        return rgb.y * (0.587 / 0.299) + rgb.x;\n      }\n      vec3 FxaaLerp3(vec3 a, vec3 b, float amountOfA) {\n        return (vec3(-amountOfA) * b) + ((a * vec3(amountOfA)) + b);\n      }\n      vec4 FxaaTexOff(sampler2D tex, vec2 pos, ivec2 off, vec2 rcpFrame) {\n        float x = pos.x + float(off.x) * rcpFrame.x;\n        float y = pos.y + float(off.y) * rcpFrame.y;\n        return texture2D(tex, vec2(x, y));\n      }\n\n      // pos is the output of FxaaVertexShader interpolated across screen.\n      // xy -> actual texture position {0.0 to 1.0}\n      // rcpFrame should be a uniform equal to  {1.0/frameWidth, 1.0/frameHeight}\n      vec3 FxaaPixelShader(vec2 pos, sampler2D tex, vec2 rcpFrame) {\n        vec3 rgbN = FxaaTexOff(tex, pos.xy, ivec2( 0,-1), rcpFrame).xyz;\n        vec3 rgbW = FxaaTexOff(tex, pos.xy, ivec2(-1, 0), rcpFrame).xyz;\n        vec3 rgbM = FxaaTexOff(tex, pos.xy, ivec2( 0, 0), rcpFrame).xyz;\n        vec3 rgbE = FxaaTexOff(tex, pos.xy, ivec2( 1, 0), rcpFrame).xyz;\n        vec3 rgbS = FxaaTexOff(tex, pos.xy, ivec2( 0, 1), rcpFrame).xyz;\n        float lumaN = FxaaLuma(rgbN);\n        float lumaW = FxaaLuma(rgbW);\n        float lumaM = FxaaLuma(rgbM);\n        float lumaE = FxaaLuma(rgbE);\n        float lumaS = FxaaLuma(rgbS);\n        float rangeMin = min(lumaM, min(min(lumaN, lumaW), min(lumaS, lumaE)));\n        float rangeMax = max(lumaM, max(max(lumaN, lumaW), max(lumaS, lumaE)));\n        float range = rangeMax - rangeMin;\n        if (range < max(FXAA_EDGE_THRESHOLD_MIN, rangeMax * FXAA_EDGE_THRESHOLD)) {\n          return rgbM;\n        }\n        vec3 rgbL = rgbN + rgbW + rgbM + rgbE + rgbS;\n        float lumaL = (lumaN + lumaW + lumaE + lumaS) * 0.25;\n        float rangeL = abs(lumaL - lumaM);\n        float blendL = max(0.0, (rangeL / range) - FXAA_SUBPIX_TRIM) * FXAA_SUBPIX_TRIM_SCALE;\n        blendL = min(FXAA_SUBPIX_CAP, blendL);\n        vec3 rgbNW = FxaaTexOff(tex, pos.xy, ivec2(-1,-1), rcpFrame).xyz;\n        vec3 rgbNE = FxaaTexOff(tex, pos.xy, ivec2( 1,-1), rcpFrame).xyz;\n        vec3 rgbSW = FxaaTexOff(tex, pos.xy, ivec2(-1, 1), rcpFrame).xyz;\n        vec3 rgbSE = FxaaTexOff(tex, pos.xy, ivec2( 1, 1), rcpFrame).xyz;\n        rgbL += (rgbNW + rgbNE + rgbSW + rgbSE);\n        rgbL *= vec3(1.0/9.0);\n        float lumaNW = FxaaLuma(rgbNW);\n        float lumaNE = FxaaLuma(rgbNE);\n        float lumaSW = FxaaLuma(rgbSW);\n        float lumaSE = FxaaLuma(rgbSE);\n        float edgeVert =\n          abs((0.25 * lumaNW) + (-0.5 * lumaN) + (0.25 * lumaNE)) +\n          abs((0.50 * lumaW ) + (-1.0 * lumaM) + (0.50 * lumaE )) +\n          abs((0.25 * lumaSW) + (-0.5 * lumaS) + (0.25 * lumaSE));\n        float edgeHorz =\n          abs((0.25 * lumaNW) + (-0.5 * lumaW) + (0.25 * lumaSW)) +\n          abs((0.50 * lumaN ) + (-1.0 * lumaM) + (0.50 * lumaS )) +\n          abs((0.25 * lumaNE) + (-0.5 * lumaE) + (0.25 * lumaSE));\n        bool horzSpan = edgeHorz >= edgeVert;\n        float lengthSign = horzSpan ? -rcpFrame.y : -rcpFrame.x;\n        if(!horzSpan) {\n          lumaN = lumaW;\n          lumaS = lumaE;\n        }\n        float gradientN = abs(lumaN - lumaM);\n        float gradientS = abs(lumaS - lumaM);\n        lumaN = (lumaN + lumaM) * 0.5;\n        lumaS = (lumaS + lumaM) * 0.5;\n        if (gradientN < gradientS)\n        {\n          lumaN = lumaS;\n          lumaN = lumaS;\n          gradientN = gradientS;\n          lengthSign *= -1.0;\n        }\n        vec2 posN;\n        posN.x = pos.x + (horzSpan ? 0.0 : lengthSign * 0.5);\n        posN.y = pos.y + (horzSpan ? lengthSign * 0.5 : 0.0);\n        gradientN *= FXAA_SEARCH_THRESHOLD;\n        vec2 posP = posN;\n        vec2 offNP = horzSpan ? vec2(rcpFrame.x, 0.0) : vec2(0.0, rcpFrame.y);\n        float lumaEndN = lumaN;\n        float lumaEndP = lumaN;\n        bool doneN = false;\n        bool doneP = false;\n        posN += offNP * vec2(-1.0, -1.0);\n        posP += offNP * vec2( 1.0,  1.0);\n        for(int i = 0; i < FXAA_SEARCH_STEPS; i++) {\n          if(!doneN) {\n            lumaEndN = FxaaLuma(texture2D(tex, posN.xy).xyz);\n          }\n          if(!doneP) {\n            lumaEndP = FxaaLuma(texture2D(tex, posP.xy).xyz);\n          }\n          doneN = doneN || (abs(lumaEndN - lumaN) >= gradientN);\n          doneP = doneP || (abs(lumaEndP - lumaN) >= gradientN);\n          if(doneN && doneP) { break; }\n          if(!doneN) {\n            posN -= offNP;\n          }\n          if(!doneP) {\n            posP += offNP;\n          }\n        }\n        float dstN = horzSpan ? pos.x - posN.x : pos.y - posN.y;\n        float dstP = horzSpan ? posP.x - pos.x : posP.y - pos.y;\n        bool directionN = dstN < dstP;\n        lumaEndN = directionN ? lumaEndN : lumaEndP;\n        if(((lumaM - lumaN) < 0.0) == ((lumaEndN - lumaN) < 0.0)) {\n          lengthSign = 0.0;\n        }\n        float spanLength = (dstP + dstN);\n        dstN = directionN ? dstN : dstP;\n        float subPixelOffset = (0.5 + (dstN * (-1.0/spanLength))) * lengthSign;\n        vec3 rgbF = texture2D(tex, vec2(\n          pos.x + (horzSpan ? 0.0 : subPixelOffset),\n          pos.y + (horzSpan ? subPixelOffset : 0.0))).xyz;\n        return FxaaLerp3(rgbL, rgbF, blendL);\n      }\n\n      void main() {\n        vec4 color;\n        vec2 screenCoord = fCoordinate;\n        // if (screenCoord.x < 0.5) {\n          color.rgb = FxaaPixelShader(screenCoord, uColorTexture, uRcpFrameDimension);\n        // } else if (screenCoord.x < 0.501 && screenCoord.x > 0.499) {\n        //   color.rgb = vec3(1,0,0);\n        // } else {\n        //   color = texture2D(uColorTexture, fCoordinate);\n        // }\n        color.a = 1.0;\n        gl_FragColor = color;\n      }"}};return a}.apply(null,i))||(e.exports=n)},818:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(372)],void 0===(n=function(e,t,r){return function(){function e(e){this._rctx=e,this.fbo=null,this.viewportToRestore=null}return e.prototype.dispose=function(){this.fbo&&(this.fbo.dispose(),this.fbo=null)},Object.defineProperty(e.prototype,"framebuffer",{get:function(){return this.fbo},enumerable:!0,configurable:!0}),e.prototype.prepareHighlightPass=function(e){var t=this._rctx,r=t.gl,i=e.fullViewport,n=i[2],a=i[3];this.updateFBO(n,a),this.viewportToRestore=i,this._rctx.setViewport(0,0,n,a),t.bindFramebuffer(this.fbo),t.setClearColor(0,0,0,0),t.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT)},e.prototype.finish=function(e){var t=this._rctx;t.bindFramebuffer(e),t.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3])},e.prototype.updateFBO=function(e,t){this.fbo?this.fbo.resize(e,t):this.fbo=r.createWithAttachments(this._rctx,{target:3553,pixelFormat:6408,dataType:32819,samplingMode:9729,wrapMode:33071,width:e,height:t},{colorTarget:0,depthStencilTarget:1})},e}()}.apply(null,i))||(e.exports=n)},819:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(359)],void 0===(n=function(e,t,r){return function(){function e(e,t){null==t&&(t=4);var i=r.nextHighestPowerOfTwo(t*e);this.array=new Float32Array(i),this.zeroItem=new Float32Array(e),this.endSlot=0,this.perInstanceDataSize=e,this.emptySlots=[],this.emptySlotsIdx=0,this.id2slot={},this.slot2id=new Array(t)}return e.prototype.prepareFree=function(e){this.emptySlots.length+=e},e.prototype.free=function(e){var t=this.id2slot[e];null!=t&&(this.emptySlots[this.emptySlotsIdx++]=t,this.slot2id[t]=void 0)},e.prototype.prepareAllocate=function(e){var t=e-this.emptySlotsIdx;t>0&&this._resizeArray((this.endSlot+t)*this.perInstanceDataSize)},e.prototype.allocate=function(e){var t;return t=this.emptySlotsIdx>0?this.emptySlots[--this.emptySlotsIdx]:this.endSlot++,this.id2slot[e]=t,this.slot2id[t]=e,t},e.prototype.getSlot=function(e){return this.id2slot[e]},e.prototype.getOffset=function(e){return e*this.perInstanceDataSize},e.prototype.getArray=function(){return this.array},e.prototype.fill=function(e,t,r){this.array.set(r,e*this.perInstanceDataSize+t)},e.prototype.compact=function(){if(this.emptySlotsIdx>0){for(this.emptySlots.length=this.emptySlotsIdx,this.emptySlots.sort(function(e,t){return e-t});this.emptySlotsIdx>0&&this.emptySlots[this.emptySlotsIdx-1]===this.endSlot;)this.emptySlotsIdx--,this.endSlot--;for(;this.emptySlotsIdx>0;){this.emptySlotsIdx--;var e=this.endSlot-1,t=this.emptySlots[this.emptySlotsIdx],r=e*this.perInstanceDataSize,i=t*this.perInstanceDataSize;this.array.set(this.array.subarray(r,r+this.perInstanceDataSize),i),this.array.set(this.zeroItem,r);var n=this.slot2id[e];this.slot2id[e]=void 0,this.slot2id[t]=n,this.id2slot[n]=t,this.endSlot--}}return this._resizeArray(this.endSlot*this.perInstanceDataSize),this.emptySlots.length=0,this.array},e.prototype._resizeArray=function(e){var t,r;if(e>this.array.length){for(t=this.array.length||1;t<e;)t*=2;(r=new Float32Array(t)).set(this.array),this.array=r}else if(e<=this.array.length/2){t=this.array.length;for(var i=2*e;t>=i;)t/=2;(r=new Float32Array(t)).set(this.array.subarray(0,t)),this.array=r}},e}()}.apply(null,i))||(e.exports=n)},820:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){return function(){function e(){}return e.copyIntervals=function(e){for(var t=[],r=0;r<e.length;r++){var i=e[r];t.push([i[0],i[1]])}return t},e.convertFaceToIndexRange=function(e,t){for(var r=0;r<e.length;r++){var i=e[r];i[0]=i[0]*t,i[1]=i[1]*t+(t-1)}},e.sortIntervals=function(e){return e.sort(function(e,t){return e[0]===t[0]?e[1]>t[1]?1:e[1]<t[1]?-1:0:e[0]>t[0]?1:e[0]<t[0]?-1:0})},e.intersectIntervals=function(e,t){if(e.length<=0)return[];for(var r=[],i=0;i<e.length;i++){var n=e[i];if(!(n[1]<t[0]||n[0]>t[1])){var a=[n[0],n[1]];a[0]<t[0]&&(a[0]=t[0]),a[1]>t[1]&&(a[1]=t[1]),r.push(a)}}return r},e.mergeIntervals=function(e){if(e.length<=0)return[];var t=[];e=this.sortIntervals(e),t.push(e[0]);for(var r=1;r<e.length;r++){var i=t[t.length-1];i[1]+1<e[r][0]?t.push(e[r]):i[1]<e[r][1]&&(i[1]=e[r][1],t.pop(),t.push(i))}return t},e.invertIntervals=function(e,t){for(var r=[],i=0,n=0;n<e.length;n++){var a=e[n];a[0]>i&&r.push([i,a[0]-1]),i=a[1]+1}return i<=t&&r.push([i,t]),r},e.offsetIntervals=function(e,t){for(var r=[],i=0;i<e.length;i++){var n=e[i];r.push([n[0]+t,n[1]+t])}return r},e}()}.apply(null,i))||(e.exports=n)},821:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(348),r(372)],void 0===(n=function(e,t,r,i){return function(){function e(e){this._rctx=e,this._depthFBO=void 0,this.viewportToRestore=null,this.width=null,this.height=null}return Object.defineProperty(e.prototype,"enabled",{get:function(){return void 0!==this._depthFBO},set:function(e){e!==this.enabled&&(e?this.enable():this.disable())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"framebuffer",{get:function(){return this._depthFBO},enumerable:!0,configurable:!0}),e.prototype.setupFBOs=function(e){r.assert(this.enabled);var t=e.fullViewport;this.viewportToRestore=t,this.width=t[2],this.height=t[3],this._rctx.setViewport(0,0,this.width,this.height)},e.prototype.prepareDepthPass=function(){r.assert(this.enabled);var e=this._rctx,t=e.gl;this._depthFBO.resize(this.width,this.height),e.bindFramebuffer(this._depthFBO),e.setClearStencil(0),e.setClearColor(0,0,0,0),e.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT),e.setBlendingEnabled(!1)},e.prototype.finish=function(e){var t=this._rctx;t.bindFramebuffer(e),t.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3])},e.prototype.enable=function(){r.assert(!this.enabled),this._depthFBO=i.createWithAttachments(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:0,height:0},{colorTarget:0,depthStencilTarget:3})},e.prototype.disable=function(){r.assert(this.enabled),this._depthFBO.dispose(),this._depthFBO=void 0},e}()}.apply(null,i))||(e.exports=n)},822:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(348),r(372)],void 0===(n=function(e,t,r,i){return function(){function e(e){this.rctx=e,this.normalFBO=void 0,this.viewportToRestore=null,this.width=null,this.height=null}return Object.defineProperty(e.prototype,"enabled",{get:function(){return void 0!==this.normalFBO},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"framebuffer",{get:function(){return this.normalFBO},enumerable:!0,configurable:!0}),e.prototype.setupFBOs=function(e){r.assert(this.enabled);var t=e.fullViewport;this.viewportToRestore=t,this.width=t[2],this.height=t[3],this.rctx.setViewport(0,0,this.width,this.height)},e.prototype.prepareNormalPass=function(){r.assert(this.enabled);var e=this.rctx,t=e.gl;this.normalFBO.resize(this.width,this.height),e.bindFramebuffer(this.normalFBO),e.setClearColor(0,0,0,0),e.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)},e.prototype.finish=function(e){var t=this.rctx;t.bindFramebuffer(e),t.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3])},e.prototype.enable=function(){this.enabled||(this.normalFBO=i.createWithAttachments(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:0,height:0},{colorTarget:0,depthStencilTarget:1}))},e.prototype.disable=function(){this.enabled&&(this.normalFBO.dispose(),this.normalFBO=void 0)},e}()}.apply(null,i))||(e.exports=n)},823:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(460),r(410)],void 0===(n=function(e,t,r,i){return function(){function e(){this.camera=null,this.pixelRatio=1,this.depth=null,this.highlight=null,this.lightingData=null,this.normals=null,this.pass=r.MATERIAL,this.shadowMap=null,this.slot=i.BACKGROUND,this.ssaoHelper=null,this.offscreenRenderingHelper=null,this.sliceHelper=null,this.stencilRenderingHelper=null,this.framebufferTex=null,this.rctx=null,this.options=null,this.renderOccludedOnly=!1}return Object.defineProperty(e.prototype,"isHighlightPass",{get:function(){return this.pass===r.MATERIAL_HIGHLIGHT},enumerable:!0,configurable:!0}),e}()}.apply(null,i))||(e.exports=n)},824:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(668),r(410)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.pluginContext=e,this.pluginsChanged=!1,this.renderPlugins=new Array,this.slots=[];for(var t=0;t<i.MAX_SLOTS;++t)this.slots[t]=[]}return e.prototype.add=function(e,t){this.renderPlugins.push(t);for(var r=0;r<e.length;++r){var i=e[r];this.slots[i].push(t)}t.initializeRenderContext(this.pluginContext),this.pluginsChanged=!0},e.prototype.remove=function(e){this.renderPlugins=this.renderPlugins.filter(function(t){return t!==e});for(var t=0;t<this.slots.length;++t)this.slots[t]=this.slots[t].filter(function(t){return t!==e});e.uninitializeRenderContext(this.pluginContext),this.pluginsChanged=!0},e.prototype.prepareRender=function(e){for(var t=0,r=this.renderPlugins;t<r.length;t++){var i=r[t];i.prepareRender&&i.prepareRender(e)}},e.prototype.render=function(e,t){t.slot=e;for(var r=!1,i=0,n=this.slots[e];i<n.length;i++){var a=n[i];a.render(t)&&(a.didRender=!0,r=!0)}return r},e.prototype.queryDepthRange=function(e){var t=a;t.near=1/0,t.far=-1/0;for(var i=0,n=this.renderPlugins;i<n.length;i++){var o=n[i];if(o.queryDepthRange){var s=o.queryDepthRange(e);s&&r.union(t,s,t)}}return t},e.prototype.needsRender=function(){if(this.pluginsChanged)return!0;for(var e=0,t=this.renderPlugins;e<t.length;e++)if(t[e].needsRender)return!0;return!1},e.prototype.needsHighlight=function(){for(var e=0,t=this.renderPlugins;e<t.length;e++)if(t[e].needsHighlight)return!0;return!1},e.prototype.needsLinearDepth=function(){for(var e=0,t=this.renderPlugins;e<t.length;e++)if(t[e].needsLinearDepth)return!0;return!1},e.prototype.resetNeedsRender=function(){this.pluginsChanged=!1;for(var e=0,t=this.renderPlugins;e<t.length;e++){var r=t[e];r.resetNeedsRender?r.resetNeedsRender():r.didRender&&(r.needsRender=!1,r.didRender=!1)}},e}();t.RenderPluginManager=n;var a={near:0,far:0}}.apply(null,i))||(e.exports=n)},825:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(632),r(382),r(372),r(760),r(368),r(376)],void 0===(n=function(e,t,i,n,a,o,s,u){return function(){function e(e){this._isLoadingResources=!1,this.isEnabled=!1,this.vertexAttributeLocations={vPosition:0},this.vertexBufferLayout=[{name:"vPosition",count:2,type:5126,offset:0,stride:8,normalized:!1}],this.rctx=e}return e.prototype.loadResources=function(e){var t=this;return!!this.data||(this._isLoadingResources=!0,r.e(109).then(function(){var i=[r(1074)];(function(r){t.data=r,t._isLoadingResources=!1,e&&e()}).apply(null,i)}).catch(r.oe),!1)},Object.defineProperty(e.prototype,"isLoadingResources",{get:function(){return this._isLoadingResources},enumerable:!0,configurable:!0}),e.prototype.enable=function(){if(this.isEnabled)return!0;if(!this.loadResources())return!1;var e=this.rctx;this.programEdgeDetect=new o(e,this.data.edgeDetectShader.vertex,this.data.edgeDetectShader.fragment,this.vertexAttributeLocations),this.programBlendWeights=new o(e,this.data.blendWeightShader.vertex,this.data.blendWeightShader.fragment,this.vertexAttributeLocations),this.programBlur=new o(e,this.data.blurShader.vertex,this.data.blurShader.fragment,this.vertexAttributeLocations);var t=new Float32Array([-1,-1,3,-1,-1,3]);return this.vao=new u(e,this.vertexAttributeLocations,{geometry:this.vertexBufferLayout},{geometry:new n(e,34962,35044,t)}),this.tmpFramebufferEdges=a.createWithAttachments(this.rctx,{target:3553,pixelFormat:6407,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4},{colorTarget:0,depthStencilTarget:0}),this.tmpFramebufferBlend=a.createWithAttachments(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4},{colorTarget:0,depthStencilTarget:0}),this.textureArea=this.loadTextureFromBase64(this.data.areaTexture,9729,6407),this.textureSearch=this.loadTextureFromBase64(this.data.searchTexure,9728,6409),this.isEnabled=!0,!0},e.prototype.disable=function(){this.isEnabled&&(this.programEdgeDetect.dispose(),this.programEdgeDetect=null,this.programBlendWeights.dispose(),this.programBlendWeights=null,this.programBlur.dispose(),this.programBlur=null,this.vao.dispose(),this.vao=null,this.textureArea.dispose(),this.textureArea=null,this.textureSearch.dispose(),this.textureSearch=null,this.tmpFramebufferBlend.dispose(),this.tmpFramebufferBlend=null,this.tmpFramebufferEdges.dispose(),this.tmpFramebufferEdges=null,this.isEnabled=!1)},e.prototype.render=function(e,t){this.enable();var r=this.rctx,i={x:0,y:0,width:0,height:0};null!=t?(i.width=t.descriptor.width,i.height=t.descriptor.height):(i.width=r.gl.canvas.width,i.height=r.gl.canvas.height),r.bindVAO(this.vao),r.setFaceCullingEnabled(!0),r.setCullFace(1029),r.setFrontFace(2305),r.setBlendingEnabled(!1),r.setDepthTestEnabled(!1),r.setViewport(i.x,i.y,i.width,i.height),this.tmpFramebufferEdges.resize(i.width,i.height),r.bindFramebuffer(this.tmpFramebufferEdges),r.setClearColor(0,0,0,1),r.clear(r.gl.COLOR_BUFFER_BIT),r.bindProgram(this.programEdgeDetect),r.bindTexture(e.colorTexture,0),this.programEdgeDetect.setUniform1i("tColor",0),this.programEdgeDetect.setUniform4f("uResolution",1/i.width,1/i.height,i.width,i.height),r.drawArrays(4,0,3),this.tmpFramebufferBlend.resize(i.width,i.height),r.bindFramebuffer(this.tmpFramebufferBlend),r.setClearColor(0,0,1,1),r.clear(r.gl.COLOR_BUFFER_BIT),r.bindProgram(this.programBlendWeights),this.programBlendWeights.setUniform4f("uResolution",1/i.width,1/i.height,i.width,i.height),r.bindTexture(this.textureSearch,1),this.programBlendWeights.setUniform1i("tSearch",1),r.bindTexture(this.textureArea,2),this.programBlendWeights.setUniform1i("tArea",2),r.bindTexture(this.tmpFramebufferEdges.colorTexture,3),this.programBlendWeights.setUniform1i("tEdges",3),r.drawArrays(4,0,3),r.bindFramebuffer(t),r.setClearColor(0,1,0,1),r.clear(r.gl.COLOR_BUFFER_BIT),r.bindProgram(this.programBlur),this.programBlur.setUniform4f("uResolution",1/i.width,1/i.height,i.width,i.height),r.bindTexture(e.colorTexture,0),this.programBlur.setUniform1i("tColor",0),r.bindTexture(this.tmpFramebufferBlend.colorTexture,1),this.programBlur.setUniform1i("tBlendWeights",1),r.drawArrays(4,0,3),r.setDepthTestEnabled(!0)},e.prototype.loadTextureFromBase64=function(e,t,r){var n=new s(this.rctx,{pixelFormat:r,dataType:5121,wrapMode:33071,samplingMode:t},null);return i.requestImage(e).then(function(e){n.resize(e.width,e.height),n.setData(e)}),n},e}()}.apply(null,i))||(e.exports=n)},826:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(348)],void 0===(n=function(e,t,r){return function(){function e(e){this._enabled=!1,this._rctx=e}return Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0}),e.prototype.prepareStencilWritePass=function(){r.assert(this.enabled);var e=this._rctx;e.setStencilFunction(519,1,255),e.setStencilOp(7680,7680,7681),e.setStencilWriteMask(255)},e.prototype.finish=function(){if(this.enabled){var e=this._rctx;e.setStencilFunction(519,0,0),e.setStencilOp(7680,7680,7680)}},e.prototype.enableStencilRead=function(){this.enabled&&this._rctx.setStencilFunction(517,1,255)},e.prototype.disableStencilRead=function(){this.enabled&&this._rctx.setStencilFunction(519,0,0)},e.prototype.enable=function(){this._enabled=!0,this._rctx.setStencilTestEnabled(!0)},e.prototype.disable=function(){this._enabled=!1,this._rctx.setStencilTestEnabled(!1)},e}()}.apply(null,i))||(e.exports=n)},827:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(344),r(400),r(396),r(379),r(339),r(446),r(437),r(342),r(359),r(602),r(743),r(622),r(726),r(828),r(779),r(829),r(780),r(892),r(967),r(682),r(833),r(835),r(836),r(382),r(376),r.dj.m(e)],void 0===(n=function(e,t,r,i,n,a,o,s,u,l,d,c,h,p,f,g,m,v,y,_,b,x,w,S,T,O,C,M){Object.defineProperty(t,"__esModule",{value:!0});var R=function(){function t(e,t,r){this.rctx=e,this.programRepository=t,this.callbacks=r,this.profilingCallback=null,this.perObjectData=new Map,this.renderers=new Map,this.localOrigins=new g.LocalOriginManager(new v(1e4)),this.numberOfRenderedEdges=0,this.gpuMemoryUsage=0,this.worker=new x,this.workerThread=null,this.destroyed=!1,this.tmpModelPosition=l.vec3d.create(),this.tmpCameraPosition=l.vec3d.create(),this.componentColorManager=new y.BufferManager(this.rctx,2)}return t.prototype.initialize=function(){var t=this;u.open(s.getAbsMid("./EdgeProcessingWorker",e,M),{client:this}).then(function(e){t.destroyed?e.close():t.workerThread=e});for(var r=_.VertexLayout.createBuffer(4),i=0;i<4;i++)r.sideness.set(i,0,0===i||3===i?0:1),r.sideness.set(i,1,0===i||1===i?0:1);this.verticesBufferObject=O.createVertex(this.rctx,35044,r.buffer)},t.prototype.destroy=function(){this.destroyed||(this.workerThread&&(this.workerThread.close(),this.workerThread=null),this.verticesBufferObject&&(this.verticesBufferObject.dispose(),this.verticesBufferObject=null),this.destroyed=!0)},t.prototype.getGpuMemoryUsage=function(){return this.gpuMemoryUsage},Object.defineProperty(t.prototype,"numberOfRenderedPrimitives",{get:function(){return this.numberOfRenderedEdges},enumerable:!0,configurable:!0}),t.prototype.shouldRender=function(){return this.renderers.size>0},t.prototype.addObject=function(e,t,r){return i(this,void 0,void 0,function(){var i,a,s,u,l,d;return n(this,function(n){switch(n.label){case 0:if(this.hasObject(e))return[2];if(i=new Array,s={loaded:o.create(function(e){return a=e}),renderables:[]},this.perObjectData.set(e,s),r&&r.mergeGeometries&&e.geometries.length>1&&this.canMergeGeometries(e))i.push(this.addObjectMergedGeometries(e,s,t));else for(u=0;u<e.geometries.length;u++)l=e.geometries[u],d=e.geometryRecords[u],d.materials[0].supportsEdges&&(l.data instanceof m?i.push(this.addGeometryPreinterleaved(e,s,l,l.data,d,t)):i.push(this.addGeometryNonPreinterleaved(e,s,l,l.data,d,t[0])));return[4,o.all(i)];case 1:return n.sent(),this.callbacks.setNeedsRender(),a(),[2]}})})},t.prototype.hasObject=function(e){return this.perObjectData.has(e)},t.prototype.updateAllComponentOpacities=function(e,t){return i(this,void 0,void 0,function(){var r,i;return n(this,function(n){switch(n.label){case 0:return(r=this.perObjectData.get(e))?[4,r.loaded]:[2];case 1:return n.sent(),i=t instanceof Array?function(e){return t[e]}:function(e){return t},r.renderables.forEach(function(e){for(var t=e.components.meta.length,r=0;r<t;r++){var n=i(r),a=e.components.meta[r],o=a.index;a.material.opacity=n,e.components.buffer.textureBuffer.setDataElement(o,1,3,255*n)}e.allTransparent=T.determineAllTransparent(e.components.meta)}),this.callbacks.setNeedsRender(),[2]}})})},t.prototype.updateAllComponentMaterials=function(e,t){return i(this,void 0,void 0,function(){var r,i=this;return n(this,function(n){switch(n.label){case 0:return(r=this.perObjectData.get(e))?[4,r.loaded]:[2];case 1:return n.sent(),r.renderables.forEach(function(e){var r=t[0],n=T.determineRequiresUberRenderer(t),a=w.EdgeRenderer.getKey(n,r.type,r.slicePlaneEnabled);if(a!==e.rendererKey){var o=i.renderers.get(e.rendererKey),s=i.aquireRenderer(n,r);o.removeRenderable(e),o.refCount.decrement(),e.rendererKey=a,s.addRenderable(e)}for(var u=0;u<t.length;u++)e.components.meta[u].material=t[u];i.updateComponentBuffer(e.components),e.allTransparent=T.determineAllTransparent(e.components.meta)}),this.callbacks.setNeedsRender(),[2]}})})},t.prototype.updateObjectVisibility=function(e,t){return i(this,void 0,void 0,function(){var r;return n(this,function(i){switch(i.label){case 0:return(r=this.perObjectData.get(e))?[4,r.loaded]:[2];case 1:return i.sent(),r.renderables.forEach(function(e){e.visible=t}),this.callbacks.setNeedsRender(),[2]}})})},t.prototype.removeObject=function(e){var t=this,r=this.perObjectData.get(e);r&&(this.perObjectData.delete(e),r.loaded.then(function(){r.renderables.forEach(function(e){t.removeRenderable(e)}),t.callbacks.setNeedsRender()}))},t.prototype.removeAll=function(){var e=this;this.perObjectData.forEach(function(t,r){e.removeObject(r)})},t.prototype.createSolidEdgeMaterial=function(e){return r({},P,e,{type:"solid"})},t.prototype.createSketchEdgeMaterial=function(e){return r({},E,e,{type:"sketch"})},t.prototype.render=function(e){var t=this;this.localOrigins.updateViewMatrices(e.view),this.renderers.forEach(function(e){0===e.refCount.value&&(t.renderers.delete(e.key),e.dispose())}),this.componentColorManager.garbageCollect(),this.componentColorManager.updateTextures();var r=e.view,i=0,n=0;this.renderers.forEach(function(e){e.forEachRenderable(function(e){i+=e.statistics.averageEdgeLength,n++})});var a={distanceFalloffFactor:40*(i/n),minimumEdgeLength:T.estimateLengthAtDistance(e.viewport[3],e.fovY,1,3.5)},o=this.rctx.capabilities.blendMinMax;o?(this.rctx.setDepthWriteEnabled(!1),this.rctx.setBlendingEnabled(!0),this.rctx.setBlendEquationSeparate(32774,o.MAX),this.rctx.setBlendFunctionSeparate(1,0,1,1)):(this.rctx.setDepthWriteEnabled(!0),this.rctx.setBlendingEnabled(!1)),this.rctx.setDepthTestEnabled(!0),this.rctx.setDepthFunction(515),this.updateObjectCameraDistances(e),this.numberOfRenderedEdges=0,this.renderers.forEach(function(r){t.renderRegularEdges(r,e,a),t.renderSilhouetteEdges(r,e,a)}),this.rctx.setDepthWriteEnabled(!0),this.rctx.setDepthFunction(513),this.rctx.setBlendEquationSeparate(32774,32774),this.rctx.setBlendFunctionSeparate(1,0,1,1),e.view=r},t.prototype.computeModelTransformWithLocalOrigin=function(e,t,r){if(e.getCombinedStaticTransformation(t,r),t.origin)this.localOrigins.register(t.origin);else{var i=l.vec3d.set3(r[12],r[13],r[14],this.tmpModelPosition);t.origin=this.localOrigins.aquire(i)}return f.applyToModelMatrix(t.origin.vec3,r),r},t.prototype.updateComponentBuffer=function(e){for(var t=e.meta,r=e.buffer,i=0;i<t.length;i++){var n=t[i].material,a=t[i].index,o=d.clamp(Math.round(n.size*w.LINE_WIDTH_FRACTION_FACTOR),0,255),s=d.clamp(n.extensionLength,-w.EXTENSION_LENGTH_OFFSET,255-w.EXTENSION_LENGTH_OFFSET)+w.EXTENSION_LENGTH_OFFSET,u="solid"===n.type?0:1,l=255*n.opacity,c=n.color,h=255*c[0],p=255*c[1],f=255*c[2],g=255*c[3];r.textureBuffer.setData(a,0,h,p,f,g),r.textureBuffer.setData(a,1,o,s,u,l)}},t.prototype.createComponentBuffers=function(e){for(var t=[],r=this.componentColorManager.getBuffer(e.length),i=0;i<e.length;i++){var n=e[i],a=r.aquireIndex();t.push({index:a,material:n})}var o={meta:t,buffer:r};return this.updateComponentBuffer(o),o},t.prototype.extractEdges=function(e,t,r,i){return this.worker.process({data:t,originalIndices:i,writerSettings:e,skipDeduplicate:r},this.workerThread)},t.prototype.createEdgeResources=function(e){var t={};if(e.regular.lodInfo.lengths.length>0){var r=new C(this.rctx,_.EdgeShaderAttributeLocations,{vertices:_.glVertexLayout,instances:b.RegularEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:O.createVertex(this.rctx,35044,e.regular.instancesData.buffer)});t.regular={vao:r,lod:e.regular.lodInfo}}if(e.silhouette.lodInfo.lengths.length>0){r=new C(this.rctx,_.EdgeShaderAttributeLocations,{vertices:_.glVertexLayout,instances:b.SilhouetteEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:O.createVertex(this.rctx,35044,e.silhouette.instancesData.buffer)});t.silhouette={vao:r,lod:e.silhouette.lodInfo}}return t},t.prototype.disposeEdgeResources=function(e){e.regular&&(e.regular.vao.vertexBuffers.instances.dispose(),e.regular.vao.dispose(!1),e.regular.vao=null),e.silhouette&&(e.silhouette.vao.vertexBuffers.instances.dispose(),e.silhouette.vao.dispose(!1),e.silhouette.vao=null)},t.prototype.addGeometryNonPreinterleaved=function(e,t,r,a,o,s){return i(this,void 0,void 0,function(){var r,i,u,d;return n(this,function(n){switch(n.label){case 0:return r=a.getAttribute("position"),i=this.computeModelTransformWithLocalOrigin(e,o,l.mat4d.create()),u=o.origin,d={position:r,indices:a.getIndices("position"),modelTransform:i,origin:u},[4,this.addNonPreinterleaved(e,t,d,s)];case 1:return n.sent(),[2]}})})},t.prototype.addNonPreinterleaved=function(e,t,r,a){return i(this,void 0,void 0,function(){var e,i,o,s,u,l,d,c,h,p,f,g,m,v,y;return n(this,function(n){switch(n.label){case 0:for(e=this.aquireRenderer(!1,a),i=r.modelTransform,o=r.origin,s=r.indices,u=r.position,l=u.data.length/u.strideIdx,d=_.EdgeInputBufferLayout.createBuffer(l),c=0;c<l;c++)d.position.set(c,0,u.data[u.offsetIdx+c*u.strideIdx+0]),d.position.set(c,1,u.data[u.offsetIdx+c*u.strideIdx+1]),d.position.set(c,2,u.data[u.offsetIdx+c*u.strideIdx+2]);return h=this.createComponentBuffers([a]),T.fillComponenBufferIndices(h.meta,[0,d.componentIndex.count],d.componentIndex),[4,this.extractEdges(e.writerSettings,d,!1,s)];case 1:return p=n.sent(),f=this.createEdgeResources(p),g=f.regular,m=f.silhouette,v=(g?g.vao.size:0)+(m?m.vao.size:0),y={regular:g,silhouette:m,transform:{modelMatrix:i,origin:o},statistics:{gpuMemoryUsage:v,averageEdgeLength:p.averageEdgeLength},components:h,visible:!0,allTransparent:T.determineAllTransparent(h.meta),distanceToCamera:0,rendererKey:e.key},t.renderables.push(y),e.addRenderable(y),this.gpuMemoryUsage+=v,[2]}})})},t.prototype.addGeometryPreinterleaved=function(e,t,r,a,o,s){return i(this,void 0,void 0,function(){var r,i,u,d,f,g,m,v,y,b,x,w,S,O,C,M,R;return n(this,function(n){switch(n.label){case 0:return(r=a.getAttribute("position"))&&p.isFloat32Array(r.data)?(i=s[0],u=T.determineRequiresUberRenderer(s),d=this.aquireRenderer(u,i),f=this.computeModelTransformWithLocalOrigin(e,o,l.mat4d.create()),g=o.origin,m=a.getIndices("position"),v=new c.BufferViewVec3f(r.data.buffer,4*r.offsetIdx,4*r.strideIdx),y=_.EdgeInputBufferLayout.createBuffer(v.count),h.unrolledCopyVec3(y.position,v),b=this.createComponentBuffers(s),T.fillComponenBufferIndices(b.meta,a.componentOffsets,y.componentIndex,m),x=a.hasPositionData,[4,this.extractEdges(d.writerSettings,y,x,m)]):(console.warn("Geometry has no float32 `position` attribute, skipping it."),[2]);case 1:return w=n.sent(),S=this.createEdgeResources(w),O=S.regular,C=S.silhouette,M=(O?O.vao.size:0)+(C?C.vao.size:0),R={regular:O,silhouette:C,transform:{modelMatrix:f,origin:g},statistics:{gpuMemoryUsage:M,averageEdgeLength:w.averageEdgeLength},components:b,visible:!e.isHidden(o),allTransparent:T.determineAllTransparent(b.meta),distanceToCamera:0,rendererKey:d.key},t.renderables.push(R),d.addRenderable(R),this.gpuMemoryUsage+=M,[2]}})})},t.prototype.canMergeGeometries=function(e){for(var t=null,r=null,i=0;i<e.geometries.length;i++){var n=e.geometries[i],o=e.geometryRecords[i];if(o.materials[0].supportsEdges){if(n.data instanceof m)return!1;if(t){if(!a.equals(t,o.transformation))return!1}else t=o.transformation;if(!r&&o.origin)r=o;else if(r&&o.origin&&r.origin.id!==o.origin.id)return!1}}return!0},t.prototype.addObjectMergedGeometries=function(e,t,r){return i(this,void 0,void 0,function(){var i,a,o,s,u,d,c,h,f,g,m,v,y,_,b,x,w,S,T,O;return n(this,function(n){switch(n.label){case 0:for(i=new Map,a=0,o=null,s=null,T=0;T<e.geometries.length;T++)f=e.geometries[T],u=e.geometryRecords[T],u.materials[0].supportsEdges&&(!s&&u.origin&&(s=u),v=f.data.getIndices("position"),a+=v?v.length:0,(v&&null==o||o===Uint16Array)&&(o=p.isUint16Array(v)?Uint16Array:Uint32Array));for(d=a?new o(a):null,c=[],h=0,T=0;T<e.geometries.length;T++)if(f=e.geometries[T],g=e.geometryRecords[T],g.materials[0].supportsEdges){if(m=f.data.getAttribute("position"),v=f.data.getIndices("position"),null==(y=i.get(m.data))){for(y=c.length/3,_=m.offsetIdx;_<m.data.length;_+=m.strideIdx)c.push(m.data[_+0]),c.push(m.data[_+1]),c.push(m.data[_+2]);i.set(m.data,y)}if(v)for(b=0;b<v.length;b++)d[h++]=y+v[b]}for(x=s||e.geometryRecords[0],w=this.computeModelTransformWithLocalOrigin(e,x,l.mat4d.create()),S=x.origin,T=0;T<e.geometryRecords.length;T++)e.geometryRecords[T].origin=S;return O={position:{data:c,offsetIdx:0,strideIdx:3},indices:d,modelTransform:w,origin:S},[4,this.addNonPreinterleaved(e,t,O,r[0])];case 1:return n.sent(),[2]}})})},t.prototype.aquireRenderer=function(e,t){var r=w.EdgeRenderer.getKey(e,t.type,t.slicePlaneEnabled),i=this.renderers.get(r);return this.strokesTexture||(this.strokesTexture=S.generateStrokesTexture(this.rctx)),i||(i=new w.EdgeRenderer(this.rctx,this.programRepository,{type:t.type,slicePlaneEnabled:t.slicePlaneEnabled,strokesTexture:this.strokesTexture,uber:e}),this.renderers.set(r,i)),i.refCount.increment(),i},t.prototype.removeRenderable=function(e){var t=this.renderers.get(e.rendererKey);t.removeRenderable(e),t.refCount.decrement(),this.disposeEdgeResources(e),this.localOrigins.release(e.transform.origin),this.gpuMemoryUsage-=e.statistics.gpuMemoryUsage;for(var r=0,i=e.components.meta;r<i.length;r++){var n=i[r];e.components.buffer.releaseIndex(n.index)}},t.prototype.updateObjectCameraDistances=function(e){var t=this,r=e.viewInvTransp;l.vec3d.set3(r[3],r[7],r[11],this.tmpCameraPosition),this.perObjectData.forEach(function(e,r){var i=l.vec3d.dist(r.getCenter(),t.tmpCameraPosition);e.renderables.forEach(function(e){return e.distanceToCamera=i})})},t.prototype.renderRegularEdges=function(e,t,r){var i=this;e.bindRegularEdges(t,r),e.forEachRenderable(function(n){if(n.visible&&n.regular&&!n.allTransparent){var a=T.computeEdgeCount(n.regular.lod.lengths,n.distanceToCamera,r);t.view=i.localOrigins.getViewMatrix(n.transform.origin),e.renderRegularEdges(n,t,a),i.numberOfRenderedEdges+=a}})},t.prototype.renderSilhouetteEdges=function(e,t,r){var i=this;e.bindSilhouetteEdges(t,r),e.forEachRenderable(function(n){if(n.visible&&n.silhouette&&!n.allTransparent){var a=T.computeEdgeCount(n.silhouette.lod.lengths,n.distanceToCamera,r);t.view=i.localOrigins.getViewMatrix(n.transform.origin),e.renderSilhouetteEdges(n,t,a),i.numberOfRenderedEdges+=a}})},t}();t.EdgeView=R;var P={color:l.vec4d.createFrom(0,0,0,.2),size:1,extensionLength:0,opacity:1,slicePlaneEnabled:!1},E={color:l.vec4d.createFrom(0,0,0,.2),size:1,extensionLength:0,opacity:1,slicePlaneEnabled:!1}}.apply(null,i))||(e.exports=n)},828:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(342),r(726)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.factory=e,this.originData=new Map}return e.prototype.aquire=function(e){return this.register(this.factory.getOrigin(e))},e.prototype.register=function(e){var t=this.originData.get(e.id);return t?(t.refCount++,t.origin):(this.originData.set(e.id,{refCount:1,viewMatrix:r.mat4d.identity(),origin:e}),e)},e.prototype.release=function(e){var t=this.originData.get(e.id);t&&0==--t.refCount&&this.originData.delete(e.id)},e.prototype.updateViewMatrices=function(e){this.originData.forEach(function(t){r.mat4d.set(e,t.viewMatrix),i.applyToViewMatrix(t.origin.vec3,t.viewMatrix)})},e.prototype.getViewMatrix=function(e){return this.originData.get(e.id).viewMatrix},e}();t.LocalOriginManager=n}.apply(null,i))||(e.exports=n)},829:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){return function(){function e(e){this._gridSize=e,this._origins={}}return e.prototype.getOrigin=function(t){var r=this._gridSize,i=Math.round(t[0]/r),n=Math.round(t[1]/r),a=Math.round(t[2]/r),o=""+e.ORIGIN_PREFIX+i+"/"+n+"/"+a,s=this._origins[o];if(!s){var u=this._gridSize,l=e.OFFSET;s={id:o,vec3:[i*u+l,n*u+l,a*u+l]},this._origins[o]=s}return s},e.ORIGIN_PREFIX="rg_",e.OFFSET=1.11,e}()}.apply(null,i))||(e.exports=n)},830:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(831),r(832)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_INDEX_COUNT=65536;var n=function(){function e(e,n){void 0===n&&(n=1),this.textureBuffer=new i.TextureBackedBuffer(e,n),this.indexManager=new r.SimpleIndexManager(t.MAX_INDEX_COUNT)}return e.prototype.dispose=function(){this.textureBuffer.dispose(),this.textureBuffer=void 0},Object.defineProperty(e.prototype,"availableCount",{get:function(){return this.indexManager.availableCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activeCount",{get:function(){return this.indexManager.activeCount},enumerable:!0,configurable:!0}),e.prototype.aquireIndex=function(){var e=this.indexManager.aquire();return this.textureBuffer.resizeToFit(e),e},e.prototype.releaseIndex=function(e){this.indexManager.release(e)},e}();t.ManagedTextureBackedBuffer=n}.apply(null,i))||(e.exports=n)},831:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.maxCount=e,this._nextIndex=0,this.recycledIndices=[]}return Object.defineProperty(e.prototype,"activeCount",{get:function(){return this._nextIndex-this.recycledIndices.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"availableCount",{get:function(){return this.recycledIndices.length+this.maxCount-this._nextIndex},enumerable:!0,configurable:!0}),e.prototype.aquire=function(){return this.recycledIndices.length>0?this.recycledIndices.pop():this.availableCount?this._nextIndex++:void 0},e.prototype.release=function(e){this.recycledIndices.push(e)},e}();t.SimpleIndexManager=r}.apply(null,i))||(e.exports=n)},832:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(602),r(368)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){void 0===t&&(t=1),this.rctx=e,this.fieldCount=t,this.textureWidth=4096,this.dirty=!0,this.texture=new i(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:this.textureWidth,height:1,flipped:!1}),this.data=new r.BufferViewVec4u8(new ArrayBuffer(4*this.textureWidth))}return e.prototype.dispose=function(){this.texture.dispose(),this.texture=void 0,this.data=void 0},e.prototype.setData=function(e,t,r,i,n,a){var o=e*this.fieldCount+t;this.dirty=!0,this.data.set(o,0,r),this.data.set(o,1,i),this.data.set(o,2,n),this.data.set(o,3,a)},e.prototype.setDataElement=function(e,t,r,i){var n=e*this.fieldCount+t;this.dirty=!0,this.data.set(n,r,i)},e.prototype.resizeToFit=function(e){var t=e*this.fieldCount;if(t>=this.data.count){var i=Math.ceil((t+1)/this.textureWidth)*this.textureWidth,n=new r.BufferViewVec4u8(new ArrayBuffer(4*i));n.typedBuffer.set(this.data.typedBuffer),this.data=n}},e.prototype.updateTexture=function(){if(this.dirty){var e=this.texture.descriptor.width,t=this.texture.descriptor.height;this.data.count>e*t&&this.texture.resize(e,this.data.count/e),this.texture.setData(this.data.typedBuffer),this.dirty=!1}},e.prototype.bind=function(e,t){this.rctx.bindTexture(this.texture,t.unit),e.setUniform1i(t.texName,t.unit),e.setUniform2f(t.invDimName,1/this.texture.descriptor.width,1/this.texture.descriptor.height)},e}();t.TextureBackedBuffer=n}.apply(null,i))||(e.exports=n)},833:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(344),r(345),r(342),r(359),r(420),r(834)],void 0===(n=function(e,t,r,i,n,a,o,s){Object.defineProperty(t,"__esModule",{value:!0}),t.LINE_WIDTH_FRACTION_FACTOR=8,t.EXTENSION_LENGTH_OFFSET=128;var u={type:"solid",slicePlaneEnabled:!1,uber:!0,strokesTexture:null},l=function(){function e(){this._value=0}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e.prototype.increment=function(){this._value++},e.prototype.decrement=function(){this._value--},e}(),d=function(){function e(t,i,a){this.rctx=t,this.programRepository=i,this.refCount=new l,this.renderables=new Set,this.depthBiasZ=-4e-4,this.depthBiasXY=.5,this.tmpViewToWorldNormalMatrix=n.mat3d.create(),this.settings=r({},u,a),this.key=e.getKey(this.settings.uber,this.settings.type,this.settings.slicePlaneEnabled);var o=this.settings.strokesTexture.variants;this.writerSettings={variants:o},this.createPrograms()}return e.prototype.dispose=function(){for(var e in this.programs){var t=this.programs[e];t&&(this.programRepository.decreaseRefCount(t),this.programs[e]=null)}},e.prototype.addRenderable=function(e){this.renderables.add(e)},e.prototype.removeRenderable=function(e){this.renderables.delete(e)},e.prototype.forEachRenderable=function(e){this.renderables.forEach(e)},e.prototype.bindRegularEdges=function(e,t){this.bind(this.programs.regular,e,t)},e.prototype.bindSilhouetteEdges=function(e,t){this.bind(this.programs.silhouette,e,t)},e.prototype.bind=function(e,t,r){this.rctx.bindProgram(e),e.setUniformMatrix4fv("uProj",t.proj),e.setUniform2f("uDepthBias",this.depthBiasXY,this.depthBiasZ),e.setUniform2f("uPixelToNDC",2/t.viewport[2],2/t.viewport[3]),e.setUniform2f("uNDCToPixel",t.viewport[2]/2,t.viewport[3]/2),e.setUniform1f("uDistanceFalloffFactor",r.distanceFalloffFactor),e.setUniform2f("uViewportDimInv",1/t.viewport[2],1/t.viewport[3]),e.setUniform1f("uPixelRatio",t.pixelRatio||1)},e.prototype.renderRegularEdges=function(e,t,r){this.render(this.programs.regular,e,e.regular.vao,t,r)},e.prototype.renderSilhouetteEdges=function(e,t,r){this.render(this.programs.silhouette,e,e.silhouette.vao,t,r)},e.prototype.render=function(e,t,r,i,n){this.setUniforms(e,t,i);var a=this.rctx;a.bindVAO(r),a.capabilities.instancing.drawArraysInstanced(6,0,4,n)},e.prototype.setUniforms=function(e,r,i){r.components.buffer.textureBuffer.bind(e,t.componentDataBindParameters),e.setUniformMatrix4fv("uView",i.view),e.setUniformMatrix4fv("uModel",r.transform.modelMatrix);var a=i.viewInvTransp,s=n.mat4d.toMat3(a,this.tmpViewToWorldNormalMatrix);e.setUniform3f("uCameraPosition",a[3],a[7],a[11]),e.setUniformMatrix3fv("uViewToWorldNormalMatrix",s),(this.settings.uber||"sketch"===this.settings.type)&&this.setSketchUniforms(e),e.setUniform1f("uWorldLineRadiusPerDistance",Math.tan(i.fovY/2)/(i.viewport[3]/2)),e.setUniform3fv("uLocalOrigin",r.transform.origin.vec3),this.settings.slicePlaneEnabled&&o.bindSlicePlane(r.transform.origin.vec3,i.slicePlane,e)},e.prototype.setSketchUniforms=function(e){var t=this.settings.strokesTexture,r=t.texture;this.rctx.bindTexture(r,0),e.setUniform1i("uStrokesTexture",0),e.setUniform2f("uStrokesTextureScale",1/r.descriptor.width,1/r.descriptor.height),e.setUniform1f("uStrokesLog2Resolution",a.log2(t.resolution)),e.setUniform1f("uStrokesNormalizationScale",t.normalizationScale),e.setUniform1f("uStrokesAmplitude",t.amplitude),e.setUniform1f("uStrokeVariants",t.variants)},e.prototype.getOptions=function(e){return r({},e,{antialiasing:!!this.rctx.capabilities.blendMinMax,mode:this.settings.uber?"uber":this.settings.type,slice:this.settings.slicePlaneEnabled})},e.prototype.createPrograms=function(){var e=this.programRepository.getProgram(s.program,this.getOptions({silhouette:!1})),t=this.programRepository.getProgram(s.program,this.getOptions({silhouette:!0}));this.programRepository.increaseRefCount(e),this.programRepository.increaseRefCount(t),this.programs={regular:e,silhouette:t}},e.getKey=function(e,t,r){return e?"edges-uber":"edges-t:"+t+":"+r},e}();t.EdgeRenderer=d,t.componentDataBindParameters={texName:"uComponentDataTex",invDimName:"uComponentDataTexInvDim",unit:2}}.apply(null,i))||(e.exports=n)},834:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(393),r(408)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){return i.glslifyDefineMap({MODE:{value:e.mode,options:{solid:"MODE_SOLID",sketch:"MODE_SKETCH",uber:"MODE_UBER"}},SILHOUETTE:e.silhouette,ANTIALIASING:e.antialiasing,SLICE:e.slice})};t.program={name:"edges",shaders:function(e){return{vertexShader:n(e)+r.resolveIncludes("edgeRenderer/edgeRenderer.vert"),fragmentShader:n(e)+r.resolveIncludes("edgeRenderer/edgeRenderer.frag")}},attributes:{aPosition0:0,aPosition1:1,aComponentIndex:2,aPackedAttributes:3,aVariantOffset:4,aVariantStroke:5,aVariantExtension:6,aNormal:7,aNormalA:7,aNormalB:8,aSideness:9}}}.apply(null,i))||(e.exports=n)},835:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(344),r(359),r(348),r(368)],void 0===(n=function(e,t,r,i,n,a){function o(e,t){if(!e)return null;for(var r=e.length/2,i=s*r,n=new Array(r),a=0,o=1===t,l=0;l<e.length;l+=2){var d=(e[l]+e[l+1])/2;n[a++]=o?Math.min(i,1-(1-d)*u):Math.min(i,d*u)}return n}Object.defineProperty(t,"__esModule",{value:!0}),t.generateStrokesTexture=function(e){for(var r=t.strokesDefinition.resolution,s=r/2,u=new Uint8Array(4*r*r),l=4*r*s,d=t.strokesDefinition.amplitude,c=2*d,h=4*r,p=i.log2(r)+1,f=t.strokesDefinition.strokes.length,g=(p-1)*f*h,m=0,v=t.strokesDefinition.strokes;m<v.length;m++){for(var y=v[m],_=y.distance,b=y.pressure,x=g,w=0;w<p;w++){0!==w&&(_=o(_,0),b=o(b,1));for(var S=0;S<t.strokesDefinition.resolution;S++){var T=.5+(_?_[S%_.length]/c:0),O=b?b[S%b.length]:1;n.packFloatRGBA(T,u,x),n.packFloatRGBA(O,u,x+l),x+=4}x-=h*(f+1)}g+=h}return{resolution:r,texture:new a(e,{pixelFormat:6408,dataType:5121,hasMipmap:!1,samplingMode:9729,width:r,height:r,wrapMode:10497},u),normalizationScale:c,amplitude:d,variants:f}};var s=.1,u=.5;t.strokesDefinition={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-76e-5,27e-5,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]}}.apply(null,i))||(e.exports=n)},836:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(379),r(622)],void 0===(n=function(e,t,r,i){function n(e,t){var i=r.binaryIndexOf(e,t,!0);return-1===i?t<e[0]?0:e.length:i}Object.defineProperty(t,"__esModule",{value:!0}),t.determineRequiresUberRenderer=function(e){if(0===e.length)return!1;for(var t=e[0].type,r=0;r<e.length;r++)if(t!==e[r].type)return!0;return!1},t.determineAllTransparent=function(e){if(0===e.length)return!0;for(var t=0;t<e.length;t++){var r=e[t].material;if(r.size*r.color[3]*r.opacity>0)return!1}return!0},t.cloneIndices=function(e){if(Uint16Array.from)return i.isUint16Array(e)?Uint16Array.from(e):Uint32Array.from(e);for(var t=i.isUint16Array(e)?new Uint16Array(e.length):new Uint32Array(e.length),r=0;r<e.length;r++)t[r]=e[r];return t},t.estimateLengthAtDistance=function(e,t,r,i){return r*(i/e)*2*Math.tan(.5*t)},t.findLowerBoundIndex=n,t.computeEdgeCount=function(e,t,r){return e.length-n(e,t*r.minimumEdgeLength)},t.fillComponenBufferIndices=function(e,t,r,i){for(var n=0;n<e.length;n++){var a=e[n].index,o=t[n],s=t[n+1];if(i)for(var u=o;u<s;u++){var l=i[u];r.set(l,a)}else for(u=o;u<s;u++)r.set(u,a)}}}.apply(null,i))||(e.exports=n)},837:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(342),r(838)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0});var n=r.vec3d.create(),a=function(){function e(){this._renderLighting={main:{intensity:r.vec3d.create(),direction:r.vec3d.createFrom(1,0,0),castShadows:!1},sphericalHarmonics:{sh:{r:[0],g:[0],b:[0]}}},this._shOrder=2,this._oldDirection=r.vec3d.create(),this._oldSpecular=r.vec4d.create(),this._oldDiffuse=r.vec4d.create(),this._oldAmbient=r.vec4d.create()}return e.prototype.setUniforms=function(e,t){if(void 0===t&&(t=!1),t||e.getDefine("GROUND_NORMAL_SHADING")){var r=(1-this._info.groundLightingFactor)*(1-this._info.globalFactor);e.setUniform1f("lightingFixedFactor",r)}else e.setUniform1f("lightingFixedFactor",0);e.setUniform1f("lightingGlobalFactor",this._info.globalFactor),e.setUniform3fv("lightingMainDirection",this._renderLighting.main.direction),e.setUniform3fv("lightingMainIntensity",this._renderLighting.main.intensity),e.setUniform1f("ambientBoostFactor",.4);var i=this._renderLighting.sphericalHarmonics.sh;0===this._shOrder?e.setUniform3f("lightingAmbientSH0",i.r[0],i.g[0],i.b[0]):1===this._shOrder?(e.setUniform4f("lightingAmbientSH_R",i.r[0],i.r[1],i.r[2],i.r[3]),e.setUniform4f("lightingAmbientSH_G",i.g[0],i.g[1],i.g[2],i.g[3]),e.setUniform4f("lightingAmbientSH_B",i.b[0],i.b[1],i.b[2],i.b[3])):2===this._shOrder&&(e.setUniform3f("lightingAmbientSH0",i.r[0],i.g[0],i.b[0]),e.setUniform4f("lightingAmbientSH_R1",i.r[1],i.r[2],i.r[3],i.r[4]),e.setUniform4f("lightingAmbientSH_G1",i.g[1],i.g[2],i.g[3],i.g[4]),e.setUniform4f("lightingAmbientSH_B1",i.b[1],i.b[2],i.b[3],i.b[4]),e.setUniform4f("lightingAmbientSH_R2",i.r[5],i.r[6],i.r[7],i.r[8]),e.setUniform4f("lightingAmbientSH_G2",i.g[5],i.g[6],i.g[7],i.g[8]),e.setUniform4f("lightingAmbientSH_B2",i.b[5],i.b[6],i.b[7],i.b[8])),e.setUniform3fv("lightDirection",this._oldDirection)},e.prototype.set=function(e){this._info=e,i.combineLights(e.lights,this._shOrder,this._renderLighting.main,this._renderLighting.sphericalHarmonics),r.vec3d.negate(this._renderLighting.main.direction,this._oldDirection);var t=1/Math.PI;this._oldAmbient[0]=.282095*this._renderLighting.sphericalHarmonics.sh.r[0]*t,this._oldAmbient[1]=.282095*this._renderLighting.sphericalHarmonics.sh.g[0]*t,this._oldAmbient[2]=.282095*this._renderLighting.sphericalHarmonics.sh.b[0]*t,this._oldAmbient[3]=1,this._oldDiffuse[0]=this._renderLighting.main.intensity[0]*t,this._oldDiffuse[1]=this._renderLighting.main.intensity[1]*t,this._oldDiffuse[2]=this._renderLighting.main.intensity[2]*t,this._oldDiffuse[3]=1;var a=r.vec3d.set(this._oldDiffuse,n);r.vec3d.scale(a,.4*this._info.globalFactor),r.vec3d.add(this._oldAmbient,a)},Object.defineProperty(e.prototype,"globalFactor",{get:function(){return this._info.globalFactor},enumerable:!0,configurable:!0}),e.prototype.getOld=function(){return{ambient:this._oldAmbient,diffuse:this._oldDiffuse,specular:this._oldSpecular,direction:this._oldDirection,helper:this}},e}();t.SceneLighting=a}.apply(null,i))||(e.exports=n)},838:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(342),r(359),r(839),r(617)],void 0===(n=function(e,t,r,i,n,a){function o(e){return(e+1)*(e+1)}function s(e){return i.clamp(Math.floor(Math.sqrt(e)-1),0,2)}function u(e,t,r){var i=e[0],n=e[1],a=e[2],s=r||[];return s.length=o(t),t>=0&&(s[0]=.28209479177),t>=1&&(s[1]=.4886025119*i,s[2]=.4886025119*a,s[3]=.4886025119*n),t>=2&&(s[4]=1.09254843059*i*n,s[5]=1.09254843059*n*a,s[6]=.31539156525*(3*a*a-1),s[7]=1.09254843059*i*a,s[8]=.54627421529*(i*i-n*n)),s}function l(e,t){var r=o(e),i=t||{r:[],g:[],b:[]};i.r.length=i.g.length=i.b.length=r;for(var n=0;n<r;n++)i.r[n]=i.g[n]=i.b[n]=0;return i}function d(e,t){for(var i=s(t.r.length),a=0,o=e;a<o.length;a++){var l=o[a];r.vec3d.negate(l.direction,v),u(v,i,g),n.elementwiseProduct(g,y),n.scalarProduct(g,l.intensity[0],m),n.add(t.r,m),n.scalarProduct(g,l.intensity[1],m),n.add(t.g,m),n.scalarProduct(g,l.intensity[2],m),n.add(t.b,m)}return t}function c(e,t){u(v,0,g);for(var r=0,i=e;r<i.length;r++){var n=i[r];t.r[0]+=g[0]*y[0]*n.intensity[0]*4*Math.PI,t.g[0]+=g[0]*y[0]*n.intensity[1]*4*Math.PI,t.b[0]+=g[0]*y[0]*n.intensity[2]*4*Math.PI}return t}Object.defineProperty(t,"__esModule",{value:!0}),t.numberOfCoefficients=o,t.numberOfCoefficientsInBand=function(e){return 2*e+1},t.orderFromNumberOfCoefficients=s,t.computeCoefficients=u,t.initSHCoefficients=l,t.projectFillLights=d,t.projectAmbientLights=c,t.combineLights=function(e,t,i,o){l(t,o.sh),r.vec3d.set3(0,0,0,i.intensity);var s=!1,u=h,g=p,m=f;u.length=0,g.length=0,m.length=0;for(var v=0,y=e;v<y.length;v++)(x=y[v])instanceof a.MainLight&&!s?(r.vec3d.set(x.direction,i.direction),i.intensity[0]=x.intensity[0],i.intensity[1]=x.intensity[1],i.intensity[2]=x.intensity[2],i.castShadows=x.castShadows,s=!0):x instanceof a.MainLight||x instanceof a.FillLight?u.push(x):x instanceof a.AmbientLight?g.push(x):x instanceof a.SphericalHarmonicsLight&&m.push(x);d(u,o.sh),c(g,o.sh);for(var _=0,b=m;_<b.length;_++){var x=b[_];n.add(o.sh.r,x.sh.r),n.add(o.sh.g,x.sh.g),n.add(o.sh.b,x.sh.b)}};var h=[],p=[],f=[],g=[0],m=[0],v=r.vec3d.create(),y=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398]}.apply(null,i))||(e.exports=n)},839:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.dotProduct=function(e,t){for(var r=0,i=0;i<e.length;i++)r+=e[i]*t[i];return r},t.elementwiseProduct=function(e,t,r){(r=r||e).length=e.length;for(var i=0;i<e.length;i++)r[i]=e[i]*t[i];return r},t.scalarProduct=function(e,t,r){(r=r||e).length=e.length;for(var i=0;i<e.length;i++)r[i]=e[i]*t;return r},t.add=function(e,t,r){(r=r||e).length=e.length;for(var i=0;i<e.length;i++)r[i]=e[i]+t[i];return r}}.apply(null,i))||(e.exports=n)},840:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(369),r(393),r(408)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){return n.glslifyDefineMap({OCCL_TEST:e.occlTest,SIGNED_DISTANCE_FIELD:e.sdf,VV_SIZE:e.vvSize,VV_COLOR:e.vvColor,VERTICAL_OFFSET:e.verticalOffset,SCREEN_SIZE_PERSPECTIVE:e.screenSizePerspective,CENTER_OFFSET_UNITS_SCREEN:e.centerOffsetUnitsScreen,DEBUG_DRAW_BORDER:e.debugDrawBorder,BINARY_HIGHLIGHT_OCCLUSION:e.binaryHighlightOcclusion})};t.colorPass={name:"hud-color",shaders:function(e){return{vertexShader:a(e)+i.resolveIncludes("materials/hud/hud.vert"),fragmentShader:a(e)+i.resolveIncludes("materials/hud/colorPass.frag")}},attributes:r.Default3D},t.highlightPass={name:"hud-highlight",shaders:function(e){return{vertexShader:a(e)+i.resolveIncludes("materials/hud/hud.vert"),fragmentShader:a(e)+i.resolveIncludes("materials/hud/highlightPass.frag")}},attributes:r.Default3D},t.occlusionPass={name:"hud-occlusion",shaders:function(e){return{vertexShader:function(e){return n.glslifyDefineMap({VERTICAL_OFFSET:e.verticalOffset,SCREEN_SIZE_PERSPECTIVE:e.screenSizePerspective,CENTER_OFFSET_UNITS_SCREEN:e.centerOffsetUnitsScreen,SLICE:e.slice})}(e)+i.resolveIncludes("materials/hud/occlusionTest.vert"),fragmentShader:i.resolveIncludes("materials/hud/occlusionTest.frag")}},attributes:r.Default3D}}.apply(null,i))||(e.exports=n)},841:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.startMeasurement=function(e){var t=e.capabilities.disjointTimerQuery;return t?new r(t):null},t.getTimestamp=function(e,t,r){void 0===r&&(r=50);var i=e.capabilities.disjointTimerQuery;if(!i)return null;if(i.timestampBits()<=0)return null;var n=i.createQuery();i.createTimestamp(n);var a=function(){var e=i.resultAvailable(n),o=i.disjoint();if(!e||o)o?t():setTimeout(a,r);else{var s=i.getResult(n);t(s/1e6)}};a()},t.supportsTimestamps=function(e){var t=e.capabilities.disjointTimerQuery;if(!t)return!1;var r=t.timestampBits();return console.log({bits:r}),r>0};var r=function(){function e(e){this.timer=e,this.query=e.createQuery(),this.timer.beginTimeElapsed(this.query)}return e.prototype.stop=function(e,t){void 0===t&&(t=50),this.cb=e,this.checkInterval=t,this.timer.endTimeElapsed(),this.checkQueryResult()},e.prototype.checkQueryResult=function(){var e=this.timer.resultAvailable(this.query),t=this.timer.disjoint();if(!e||t)t?this.cb():setTimeout(this.checkQueryResult.bind(this),this.checkInterval);else{var r=this.timer.getResult(this.query);this.cb(r/1e6)}},e}()}.apply(null,i))||(e.exports=n)},842:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(342),r(410),r(420),r(618)],void 0===(n=function(e,t,r,i,n,a){var o=r.vec4d.createFrom(1,1,1,1);return function(){function e(e,t,r,i,n){this.program=e.getProgram(a.texOnly),this.color=r,this.depthFunc=n,this.blend=i,this.texGLName=t}return e.prototype.beginSlot=function(e){return e===i.INTERNAL_MATERIAL},e.prototype.getProgram=function(){return this.program},e.prototype.setColor=function(e){this.color=e},e.prototype.bind=function(e,t){e.bindProgram(this.program),this.program.setUniformMatrix4fv("model",n.IDENTITY),this.program.setUniformMatrix4fv("proj",t.proj),this.program.setUniform4fv("color",void 0!==this.color?this.color:o),this.program.setUniform1i("tex",0),e.bindTexture(this.texGLName,0),this.blend&&(e.setBlendingEnabled(!0),e.setBlendFunctionSeparate(e.gl.SRC_ALPHA,e.gl.ONE_MINUS_SRC_ALPHA,e.gl.ONE,e.gl.ONE_MINUS_SRC_ALPHA)),e.setDepthTestEnabled(!0),void 0!==this.depthFunc&&e.setDepthFunction(this.depthFunc)},e.prototype.release=function(e){void 0!==this.depthFunc&&e.setDepthFunction(513),this.blend&&e.setBlendingEnabled(!1)},e.prototype.bindView=function(e,t){n.bindView(t.origin,t.view,this.program)},e.prototype.bindInstance=function(e,t){this.program.setUniformMatrix4fv("model",t.transformation)},e.prototype.getDrawMode=function(e){return e.gl.TRIANGLES},e}()}.apply(null,i))||(e.exports=n)},843:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(348)],void 0===(n=function(e,t,r){function i(e,t){return e+"_"+t}var n=function(){function e(e){this.refCnt=0,this.glMaterial=e}return e.prototype.incRefCnt=function(){++this.refCnt},e.prototype.decRefCnt=function(){--this.refCnt,r.assert(this.refCnt>=0)},e.prototype.getRefCnt=function(){return this.refCnt},e.prototype.getGLMaterial=function(){return this.glMaterial},e}();return function(){function e(e,t){this.textureRep=e,this.programRep=t,this.id2glMaterialRef={}}return e.prototype.aquire=function(e){return this.aquireExt(e,"color")},e.prototype.aquireDepthShadowMap=function(e){return this.aquireExt(e,"depthShadowMap")},e.prototype.aquireDepth=function(e){return this.aquireExt(e,"depth")},e.prototype.aquireNormal=function(e){return this.aquireExt(e,"normal")},e.prototype.aquireHighlight=function(e){return this.aquireExt(e,"highlight")},e.prototype.aquireExt=function(e,t){var r,a=i(e.id,t),o=this.id2glMaterialRef[a];if(null==o){var s=e.getGLMaterials()[t];r=s?new s(e,this.programRep,this.textureRep):void 0,o=new n(r),this.id2glMaterialRef[a]=o}else r=o.getGLMaterial();return o.incRefCnt(),r&&this.increaseProgramReferences(r),r},e.prototype.release=function(e){this.releaseExt(e,"color")},e.prototype.releaseDepth=function(e){this.releaseExt(e,"depth")},e.prototype.releaseNormal=function(e){this.releaseExt(e,"normal")},e.prototype.releaseDepthShadowMap=function(e){this.releaseExt(e,"depthShadowMap")},e.prototype.releaseHighlight=function(e){this.releaseExt(e,"highlight")},e.prototype.releaseExt=function(e,t){var r=i(e,t),n=this.id2glMaterialRef[r];if(n.decRefCnt(),0===n.getRefCnt()){var a=n.getGLMaterial();a&&(this.decreaseProgramReferences(a),a.dispose()),delete this.id2glMaterialRef[r]}},e.prototype.updateMaterialParameters=function(e){var t=this.id2glMaterialRef[i(e,"color")];t&&t.getGLMaterial()&&this.updateParamsForMat(t.getGLMaterial());var r=this.id2glMaterialRef[i(e,"depth")];r&&r.getGLMaterial()&&this.updateParamsForMat(r.getGLMaterial());var n=this.id2glMaterialRef[i(e,"depthShadowMap")];n&&n.getGLMaterial()&&this.updateParamsForMat(n.getGLMaterial());var a=this.id2glMaterialRef[i(e,"normal")];a&&a.getGLMaterial()&&this.updateParamsForMat(a.getGLMaterial());var o=this.id2glMaterialRef[i(e,"highlight")];o&&o.getGLMaterial()&&this.updateParamsForMat(o.getGLMaterial())},e.prototype.updateParamsForMat=function(e){e.updateParameters&&(this.decreaseProgramReferences(e),e.updateParameters(),this.increaseProgramReferences(e))},e.prototype.increaseProgramReferences=function(e){for(var t=e.getPrograms(),r=this.programRep,i=0;i<t.length;i++)r.increaseRefCount(t[i])},e.prototype.decreaseProgramReferences=function(e){for(var t=e.getPrograms(),r=this.programRep,i=0;i<t.length;i++)r.decreaseRefCount(t[i])},e}()}.apply(null,i))||(e.exports=n)},844:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(343),r(348),r(368)],void 0===(n=function(e,t,r,i,n){var a=r.getLogger("esri.views.3d.webgl-engine.lib.GLTextureRep"),o=function(){function e(e){this._glTexture=null,this._refCount=0,this._glTexture=e}return e.prototype.incRefCnt=function(){++this._refCount},e.prototype.decRefCnt=function(){--this._refCount,i.assert(this._refCount>=0)},e.prototype.getRefCnt=function(){return this._refCount},e.prototype.setGLTexture=function(e){this._glTexture=e},e.prototype.getGLTexture=function(){return this._glTexture},e}();return function(){function e(e,t,r,i){this.NUM_PARALLEL=8,this.textures=e,this._programRepository=t,this.getViewportToRestore=r,this._rctx=i,this.NUM_PARALLEL=8,this.id2textureRef={},this.loading={},this._queue=[],this.listeners=[],this.afExt=i.capabilities.textureFilterAnisotropic,this.maxMaxAnisotropy=this.afExt?i.parameters.maxMaxAnisotropy:1,this.maxAnisotropy=Math.min(8,this.maxMaxAnisotropy),this._needsRender=!0,this._fallbackTextureData=new Uint8Array(256),this._fallbackTextureTransparentData=new Uint8Array(256);for(var n=0;n<this._fallbackTextureData.length;++n)this._fallbackTextureData[n]=255,this._fallbackTextureTransparentData[n]=(n+1)%4!=0?255:0;this._fallbackTextureDesc={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:8,height:8,maxAnisotropy:8}}return e.prototype.resetNeedsRender=function(){this._needsRender=!1},e.prototype.needsRender=function(){return this._needsRender},e.prototype.aquire=function(e,t,r){var s=this,u=this.id2textureRef[e];if(null==u){var l=this.textures[e];i.assert(void 0!==l),l.setUnloadFunc(this._unload.bind(this));var d=!0===t,c=this._createGLTextureDescription(l);if(u=new o(null),i.assert(null==this.id2textureRef[e]),this.id2textureRef[e]=u,l.initializeThroughRender){var h=l.initializeThroughRender(this._rctx,c);u.setGLTexture(h),r&&r(u)}else if(l.deferredLoading())this.getLoadingCount()<this.NUM_PARALLEL?this._loadImage(e,c,r):this._queue.push([e,c,r]);else try{l.initializeThroughUpload(this._rctx,c,this._programRepository,this.getViewportToRestore(),function(e){u.setGLTexture(e),s._needsRender=!0,r&&r(u)})}catch(e){a.error("#aquire","Error loading texture: "+e.toString())}null==u.getGLTexture()&&u.setGLTexture(new n(this._rctx,this._fallbackTextureDesc,d?this._fallbackTextureTransparentData:this._fallbackTextureData)),this._needsRender=!0}return u.incRefCnt(),u},e.prototype.release=function(e){var t=this.id2textureRef[e];void 0!==t&&(t.decRefCnt(),i.assert(t.getRefCnt()>=0))},e.prototype.getLoadingCount=function(){return Object.keys(this.loading).length},e.prototype.getTexture=function(e){return this.textures[e]},e.prototype.getMaxAnisotropy=function(){return this.maxAnisotropy},e.prototype._unload=function(e){var t=this.id2textureRef[e];if(void 0!==t){var r=t.getGLTexture();r&&r.dispose(),delete this.id2textureRef[e]}this.next(e)},e.prototype._createGLTextureDescription=function(e){var t=e.params&&e.params.wrapClamp;return{target:3553,pixelFormat:6408,dataType:5121,maxAnisotropy:this.afExt&&e.params&&e.params.mipmap&&!e.params.disableAnisotropy?this.maxAnisotropy:void 0,wrapMode:t?33071:void 0}},e.prototype.next=function(e){if(e in this.loading){delete this.loading[e];var t=Object.keys(this.id2textureRef),r=Object.keys(this.loading);this.listeners.forEach(function(i){i(e,t,r)}),this.processQueue()}},e.prototype._loadImage=function(e,t,r){var n=this;i.assert(null==this.loading[e]),this.loading[e]=!0;var a=this.textures[e];i.assert(void 0!==a),setTimeout(function(){var i=n.id2textureRef[e];i&&i.getRefCnt()&&a.initializeThroughUpload(n._rctx,t,n._programRepository,n.getViewportToRestore(),function(t){n.next(e),n._needsRender=!0,i&&i.getRefCnt()&&(i.setGLTexture(t),r&&r(i))})},0)},e.prototype.processQueue=function(){for(var e=[],t=0;t<this._queue.length;++t){var r=this._queue[t][0],i=this.id2textureRef[r];void 0!==i&&(0===i.getRefCnt()?(i.getGLTexture().dispose(),delete this.id2textureRef[r]):e.push(this._queue[t]))}this._queue=e;var n=Math.min(this.NUM_PARALLEL-Object.keys(this.loading).length,this._queue.length);for(t=0;t<n;++t)this._loadImage(this._queue[t][0],this._queue[t][1],this._queue[t][2]);this._queue.splice(0,n)},e}()}.apply(null,i))||(e.exports=n)},845:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(846),r(761)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0});var n=null,a=[];t.enabled=!1,t.begin=function(){t.enabled&&(n=[])},t.trace=function(e){t.enabled&&null!=n&&n.push(e)},t.end=function(){if(t.enabled){var e=n;return n=null,e&&(a.forEach(function(t){return t(e)}),a.length=0),e}},t.instrumentContext=function(e){return t.enabled?i.default(e)?(console.warn("WebGL tracer is not supported on a WebGL2 Context"),e):r.makeDebugContext(e,void 0,function(e,i){t.enabled&&n&&n.push("gl."+e+"("+r.glFunctionArgsToString(e,i)+")")}):e},t.request=function(e){a.push(e)}}.apply(null,i))||(e.exports=n)},846:function(e,t,r){var i;void 0===(i=function(){function e(e){if(null==u)for(var t in u={},l={},e)"number"==typeof e[t]&&(u[e[t]]=t,l[t]=e[t])}function t(){if(null==u)throw"WebGLDebugUtils.init(ctx) not called"}function r(e){t();var r=u[e];return void 0!==r?"gl."+r:"/*UNKNOWN WebGL ENUM*/ 0x"+e.toString(16)}function i(e,t,i,n){var a;if(void 0!==(a=s[e])&&(void 0!==(a=a[t])&&a[i])){if("object"==typeof a[i]&&void 0!==a[i].enumBitwiseOr){for(var o=a[i].enumBitwiseOr,u=0,d=[],c=0;c<o.length;++c){var h=l[o[c]];0!=(n&h)&&(u|=h,d.push(r(h)))}return u===n?d.join(" | "):r(n)}return r(n)}return null===n?"null":void 0===n?"undefined":n.toString()}function n(e,t,r){e.__defineGetter__(r,function(){return t[r]}),e.__defineSetter__(r,function(e){t[r]=e})}function a(e){var t=e.getParameter(e.MAX_VERTEX_ATTRIBS),r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r);for(var i=0;i<t;++i)e.disableVertexAttribArray(i),e.vertexAttribPointer(i,4,e.FLOAT,!1,0,0),e.vertexAttrib1f(i,0);e.deleteBuffer(r);var n=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);for(i=0;i<n;++i)e.activeTexture(e.TEXTURE0+i),e.bindTexture(e.TEXTURE_CUBE_MAP,null),e.bindTexture(e.TEXTURE_2D,null);for(e.activeTexture(e.TEXTURE0),e.useProgram(null),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.DITHER),e.disable(e.SCISSOR_TEST),e.blendColor(0,0,0,0),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.clearColor(0,0,0,0),e.clearDepth(1),e.clearStencil(-1),e.colorMask(!0,!0,!0,!0),e.cullFace(e.BACK),e.depthFunc(e.LESS),e.depthMask(!0),e.depthRange(0,1),e.frontFace(e.CCW),e.hint(e.GENERATE_MIPMAP_HINT,e.DONT_CARE),e.lineWidth(1),e.pixelStorei(e.PACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.UNPACK_COLORSPACE_CONVERSION_WEBGL&&e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.BROWSER_DEFAULT_WEBGL),e.polygonOffset(0,0),e.sampleCoverage(1,!1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilMask(4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.viewport(0,0,e.canvas.width,e.canvas.height),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT);e.getError(););}var o=function(e){window.console&&window.console.error?window.console.error(e):function(e){window.console&&window.console.log&&window.console.log(e)}(e)},s={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},u=null,l=null;return{init:e,mightBeEnum:function(e){return t(),void 0!==u[e]},glEnumToString:r,glFunctionArgToString:i,glFunctionArgsToString:function(e,t){for(var r="",n=t.length,a=0;a<n;++a)r+=(0==a?"":", ")+i(e,n,a,t[a]);return r},makeDebugContext:function t(a,s,u,l){function d(e,t){return function(){u&&u(t,arguments);var r=e[t].apply(e,arguments),i=l.getError();return 0!=i&&(c[i]=!0,s(i,t,arguments)),r}}l=l||a,e(a),s=s||function(e,t,n){for(var a="",s=n.length,u=0;u<s;++u)a+=(0==u?"":", ")+i(t,s,u,n[u]);o("WebGL error "+r(e)+" in "+t+"("+a+")")};var c={},h={};for(var p in a)if("function"==typeof a[p])if("getExtension"!=p)h[p]=d(a,p);else{var f=d(a,p);h[p]=function(){return t(f.apply(a,arguments),s,u,l)}}else n(h,a,p);return h.getError=function(){for(var e in c)if(c.hasOwnProperty(e)&&c[e])return c[e]=!1,e;return a.NO_ERROR},h},makeLostContextSimulatingCanvas:function(e){function t(e){return"function"==typeof e?e:function(t){e.handleEvent(t)}}function r(){++g,h||f==g&&e.loseContext()}function i(e,t){var i=e[t];return function(){if(r(),!h)return i.apply(e,arguments)}}function o(e){return{statusMessage:e,preventDefault:function(){m=!0}}}var s,u=[],l=[],d={},c=1,h=!1,p=[],f=0,g=0,m=!1,v=0,y={};e.getContext=function(t){return function(){var a=t.apply(e,arguments);if(a instanceof WebGLRenderingContext){if(a!=s){if(s)throw"got different context";d=function(e){for(var t in e)"function"==typeof e[t]?d[t]=i(e,t):n(d,e,t);d.getError=function(){if(r(),!h)for(;e=s.getError();)y[e]=!0;for(var e in y)if(y[e])return delete y[e],e;return d.NO_ERROR};for(var a=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],o=0;o<a.length;++o)d[f=a[o]]=function(t){return function(){if(r(),h)return null;var i=t.apply(e,arguments);return i.__webglDebugContextLostId__=c,p.push(i),i}}(e[f]);var u=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];for(o=0;o<u.length;++o)d[f=u[o]]=function(t){return function(){return r(),h?null:t.apply(e,arguments)}}(d[f]);var l=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];for(o=0;o<l.length;++o){var f;d[f=l[o]]=function(t){return function(){return r(),!h&&t.apply(e,arguments)}}(d[f])}return d.checkFramebufferStatus=function(t){return function(){return r(),h?d.FRAMEBUFFER_UNSUPPORTED:t.apply(e,arguments)}}(d.checkFramebufferStatus),d.getAttribLocation=function(t){return function(){return r(),h?-1:t.apply(e,arguments)}}(d.getAttribLocation),d.getVertexAttribOffset=function(t){return function(){return r(),h?0:t.apply(e,arguments)}}(d.getVertexAttribOffset),d.isContextLost=function(){return h},d}(s=a)}return d}return a}}(e.getContext);var _=function(e){u.push(t(e))},b=function(e){l.push(t(e))};return function(e){var t=e.addEventListener;e.addEventListener=function(r,i,n){switch(r){case"webglcontextlost":_(i);break;case"webglcontextrestored":b(i);break;default:t.apply(e,arguments)}}}(e),e.loseContext=function(){if(!h){for(h=!0,f=0,++c;s.getError(););(function(){for(var e=Object.keys(y),t=0;t<e.length;++t)delete y[e]})(),y[s.CONTEXT_LOST_WEBGL]=!0;var t=o("context lost"),r=u.slice();setTimeout(function(){for(var i=0;i<r.length;++i)r[i](t);v>=0&&setTimeout(function(){e.restoreContext()},v)},0)}},e.restoreContext=function(){h&&l.length&&setTimeout(function(){if(!m)throw"can not restore. webglcontestlost listener did not call event.preventDefault";(function(){for(var e=0;e<p.length;++e){var t=p[e];t instanceof WebGLBuffer?s.deleteBuffer(t):t instanceof WebGLFramebuffer?s.deleteFramebuffer(t):t instanceof WebGLProgram?s.deleteProgram(t):t instanceof WebGLRenderbuffer?s.deleteRenderbuffer(t):t instanceof WebGLShader?s.deleteShader(t):t instanceof WebGLTexture&&s.deleteTexture(t)}})(),a(s),h=!1,g=0,m=!1;for(var e=l.slice(),t=o("context restored"),r=0;r<e.length;++r)e[r](t)},0)},e.loseContextInNCalls=function(e){if(h)throw"You can not ask a lost contet to be lost";f=g+e},e.getNumCalls=function(){return g},e.setRestoreTimeout=function(e){v=e},e},resetToInitialState:a}}.apply(null,[]))||(e.exports=i)},847:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(353),r(342),r(630),r(781),r(848)],void 0===(n=function(e,t,r,i,n,a,o){var s=r("dojo-debug-messages"),u=function(){function e(e,t,r,u,l){this._content=new Map,this._stats={renderGeometriesTotal:0,renderGeometriesVisible:0,visualizerRenderTimer:null,viewportRenderTimer:null},this._needsRender=!0,this._rctx=l,this._gl=l.gl,this._visualizer=new o(e,t,r,u,this._rctx),this._camera=new n(i.vec3.createFrom(0,100,-100),i.vec3.createFrom(0,0,0)),s&&(this._stats.visualizerRenderTimer=new a(10),this._stats.viewportRenderTimer=new a(10))}return Object.defineProperty(e.prototype,"isLoadingResources",{get:function(){return this._visualizer.isLoadingResources},enumerable:!0,configurable:!0}),e.prototype.getCombinedStats=function(){var e={},t=this._visualizer.getCombinedStats();for(var r in t)e[r]=t[r];if(e.renderGeometriesTotal=this._stats.renderGeometriesTotal,e.renderGeometriesVisible=this._stats.renderGeometriesVisible,s&&(e.visualizerTotalRenderTime=this._stats.visualizerRenderTimer.getTotal(),e.visualizerCurrentRenderTime=this._stats.visualizerRenderTimer.getLastFiltered(),e.viewportTotalRenderTime=this._stats.viewportRenderTimer.getTotal(),e.viewportCurrentRenderTime=this._stats.viewportRenderTimer.getLastFiltered(),e.totalNumFramesRendered=this._stats.viewportRenderTimer.getNumMeasurements()),void 0!==this._gl.getUsedTextureMemory&&(e.textureMemory=this._gl.getUsedTextureMemory()),void 0!==this._gl.getUsedRenderbufferMemory&&(e.renderbufferMemory=this._gl.getUsedRenderbufferMemory()),void 0!==this._gl.getUsedVBOMemory&&(e.VBOMemory=this._gl.getUsedVBOMemory()),void 0!==this._gl.getUsedTextureMemoryStats){var i=this._gl.getUsedTextureMemoryStats();for(var n in i)e["texMem type: "+n]=i[n]}return e},e.prototype.dispose=function(){this._visualizer.dispose(),this._visualizer=null},e.prototype.setLighting=function(e){this._visualizer.setLighting(e)},e.prototype.setRenderParams=function(e){this._visualizer.setRenderParams(e)},e.prototype.getRenderParams=function(){return this._visualizer.getRenderParams()},e.prototype.getEdgeView=function(){return this._visualizer.getEdgeView()},e.prototype.modify=function(e,t,r,i){this._visualizer.modify(e,t,r,i),this._content=this._visualizer.getContent()},e.prototype.getContent=function(){return this._content},e.prototype.setCamera=function(e){this._camera.copyFrom(e),this._needsRender=!0},e.prototype.getCamera=function(){return this._camera},Object.defineProperty(e.prototype,"renderPlugins",{get:function(){return this._visualizer.renderPlugins},enumerable:!0,configurable:!0}),e.prototype.getFramebufferTexture=function(e){return this._visualizer.getFramebufferTexture(e)},e.prototype.render=function(e){s&&this._stats.viewportRenderTimer.start(),s&&this._stats.visualizerRenderTimer.start(),l.camera=e.camera||this._camera,l.fbo=e.fbo,l.lightDirection=e.lightDirection,l.pixelRatio=e.pixelRatio||1,this._visualizer.render(l),s&&(this._stats.visualizerRenderTimer.stop(),this._stats.viewportRenderTimer.stop())},e.prototype.resetNeedsRender=function(){this._needsRender=!1,this._visualizer.resetNeedsRender()},e.prototype.needsRender=function(){return this._needsRender||this._visualizer.needsRender()},e}(),l={fbo:null,lightDirection:null,camera:null,pixelRatio:1};return u}.apply(null,i))||(e.exports=n)},848:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(849),r(342),r(601),r(668),r(850),r(851),r(853),r(725),r(856),r(460),r(858),r(728),r(859),r(348)],void 0===(n=function(e,t,r,i,n,a,o,s,u,l,d,c,h,p,f,g){var m=g.assert;return function(){function e(e,t,r,i,n){this._drawShadowMapDebugQuad=!1,this._drawSSAOMapDebugQuad=!1,this._needsRender=!0,this._content=new Map,this._stage=e,this._rctx=n,this._renderer=new l(t,r,i,this._rctx,!1),this._programRep=t,this._helpers={shadowMap:new h(t,this._rctx),ssao:new f(t,this._rctx,this.setNeedsRender.bind(this)),highlight:new s(t,this._rctx),renderOccluded:new d(t,this._rctx),slice:new p,offscreenRendering:new u(t,this._rctx)}}return Object.defineProperty(e.prototype,"isLoadingResources",{get:function(){return this._renderer.isLoadingResources},enumerable:!0,configurable:!0}),e.prototype.getCombinedStats=function(){return this._renderer.getCombinedStats()},e.prototype.dispose=function(){this._renderer.dispose(),this._helpers.shadowMap.enabled=!1,this._helpers.shadowMap.dispose(),this._helpers.ssao.enabled=!1,this._helpers.ssao.dispose(),this._helpers.highlight.enabled=!1,this._helpers.renderOccluded.enabled=!1,this._helpers.offscreenRendering.enabled=!1},e.prototype.setLighting=function(e){this._renderer.setLighting(e)},e.prototype.setRenderParams=function(e){void 0!==e.shadowMapResolution&&!1===this._helpers.shadowMap.enabled&&(this._helpers.shadowMap.textureResolution=e.shadowMapResolution),void 0!==e.shadowMap&&(this._helpers.shadowMap.enabled=e.shadowMap),void 0!==e.shadowMapMaxCascades&&(this._helpers.shadowMap.maxCascades=e.shadowMapMaxCascades),this._helpers.highlight.enabled=!0,void 0!==e.ssao&&(this._helpers.ssao.enabled=e.ssao),void 0!==e.ssaoAttenuation&&(this._helpers.ssao.attenuation=e.ssaoAttenuation),void 0!==e.ssaoRadius&&(this._helpers.ssao.radius=e.ssaoRadius),void 0!==e.ssaoFilterRadius&&console.error("The property ssaoFilterRadius is no longer supported as a render parameter."),void 0!==e.ssaoSamples&&(this._helpers.ssao.samples=e.ssaoSamples),void 0!==e.drawShadowMapDebugQuad&&(this._drawShadowMapDebugQuad=e.drawShadowMapDebugQuad),void 0!==e.drawSSAODebugQuad&&(this._drawSSAOMapDebugQuad=e.drawSSAODebugQuad),this._renderer.ssaoEnabled=this._helpers.ssao.enabled,void 0!==e.offscreenRendering&&(this._helpers.offscreenRendering.enabled=e.offscreenRendering),e.background&&(this._helpers.offscreenRendering.background=e.background),void 0!==e.antialiasingEnabled&&(this._renderer.renderOptions.antialiasing=e.antialiasingEnabled?"smaa":"none"),void 0!==e.earlyOcclusionPixelDraw&&(this._renderer.renderOptions.earlyOcclusionPixelDraw=e.earlyOcclusionPixelDraw),void 0!==e.defaultHighlightOptions&&this._helpers.highlight.setDefaultOptions(e.defaultHighlightOptions),void 0!==e.slicePlane&&(this._helpers.slice.plane=e.slicePlane),this._needsRender=!0},e.prototype.getRenderParams=function(){var e={};return e.shadowMap=this._helpers.shadowMap.enabled,e.shadowMapResolution=this._helpers.shadowMap.textureResolution,e.shadowMapMaxCascades=this._helpers.shadowMap.maxCascades,this._helpers.ssao.isSupported&&(e.ssao=this._helpers.ssao.enabled,e.ssaoAttenuation=this._helpers.ssao.attenuation,e.ssaoRadius=this._helpers.ssao.radius,e.ssaoFilterRadius=this._helpers.ssao.filterRadius,e.ssaoSamples=this._helpers.ssao.samples),e},e.prototype.getFramebufferTexture=function(e){switch(e){case"color":return this._helpers.offscreenRendering.colorTexture;case"hudVisibility":return this._helpers.offscreenRendering.hudVisibilityTexture;case"shadowMap":return this._helpers.shadowMap.getDepthTexture()}return this._renderer.getFramebufferTexture(e)},e.prototype.modify=function(e,t,r,i){this._renderer.modify(e,t,r,i);for(var n=0;n<t.length;++n)this._content.delete(t[n].uniqueName);for(n=0;n<e.length;++n)this._content.set(e[n].uniqueName,e[n]);for(n=0;n<r.length;++n)m(this._content.get(r[n].renderGeometry.uniqueName)===r[n].renderGeometry)},e.prototype.getContent=function(){return this._content},e.prototype.getProjectionMatrix=function(e,t,r,n,a){var o=g.fovx2fovy(t,e[2],e[3]);i.mat4d.perspective(180*o/Math.PI,e[2]/e[3],r,n,a)},Object.defineProperty(e.prototype,"renderPlugins",{get:function(){return this._renderer.renderPlugins},enumerable:!0,configurable:!0}),e.prototype.resetNeedsRender=function(){this._needsRender=!1,this._renderer.resetNeedsRender()},e.prototype.needsRender=function(){return this._needsRender||this._renderer.needsRender()},e.prototype.setNeedsRender=function(){this._needsRender=!0},e.prototype.render=function(e){var t=e.camera,a=e.fbo,o=e.lightDirection,s=t.viewport;if(this._renderer.prepareRender(t),this._helpers.shadowMap.enabled){n.ENABLE_PROFILE_DEPTH_RANGE&&r.begin("depthRange");var u=this.computeDepthRange(t);n.ENABLE_PROFILE_DEPTH_RANGE&&r.end("depthRange"),this._helpers.shadowMap.prepare(t,o,this._content,u);for(var l=this._helpers.shadowMap.getCascades(),d=0;d<l.length;++d){var h=l[d];h.camera.setGLViewport(this._rctx),e.camera=h.camera,this._renderer.renderGeometryPass(c.MATERIAL_DEPTH_SHADOWMAP,e,null,null,this._helpers.slice)}e.camera=t,this._helpers.shadowMap.finish(a),t.setGLViewport(this._rctx)}if(this._helpers.shadowMap.bindAll(this._programRep),this._renderer.renderAuxiliaryBuffers(e,this._helpers),this._renderer.render(e,this._helpers),this._drawShadowMapDebugQuad&&this._helpers.shadowMap.enabled){var p=i.mat4d.ortho(s[0],s[2],s[1],s[3],-1,1);this._helpers.shadowMap.drawDebugQuad(p)}if(this._drawSSAOMapDebugQuad&&this._helpers.ssao.enabled){p=i.mat4d.ortho(s[0],s[2],s[1],s[3],-1,1);this._helpers.ssao.drawQuad(p)}},e.prototype.getEdgeView=function(){return this._renderer.edgeView},e.prototype.computeDepthRange=function(e){var t=o.depthRangeFromScene(e,this._content,this._stage.getLayers());return a.union(t,this.renderPlugins.queryDepthRange(e)),t.near=Math.max(e.near,t.near),t.far=Math.min(e.far,t.far),t},e}()}.apply(null,i))||(e.exports=n)},849:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){var r=function(){function e(e,t){void 0===t&&(t=.9),this._alpha=.9,this._name=e,this._alpha=t,this.reset()}return e.prototype.reset=function(){this._count=0,this._sum=0,this._smooth=0,this._min=1/0,this._max=0},Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"average",{get:function(){return this._count>0?this._sum/this._count:0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"smooth",{get:function(){return this._smooth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"min",{get:function(){return this._min},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"max",{get:function(){return this._max},enumerable:!0,configurable:!0}),e.prototype.begin=function(){this._startTime=performance.now()},e.prototype.end=function(){var e=performance.now()-this._startTime;this._count+=1,this._sum+=e,this._smooth=this._alpha*e+(1-this._alpha)*this._smooth,this._min=Math.min(this._min,e),this._max=Math.max(this._max,e)},e.prototype.toJSON=function(){return{name:this.name,count:this.count,average:this.average,smooth:this.smooth,min:this.min,max:this.max}},e}();return function(e){function t(t){return t in n||(n[t]=new e(t)),n[t]}function r(e){console.log(t(e).toJSON())}var i=1e3,n={},a={};e.get=t,e.begin=function(e){t(e).begin()},e.end=function(e,n){void 0===n&&(n=!0),t(e).end();var o=performance.now();!n||e in a&&!(o>=a[e]+i)||(r(e),a[e]=o)},e.log=r,e.logAll=function(){for(var e in n)r(e)}}(r||(r={})),r}.apply(null,i))||(e.exports=n)},850:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(407),r(342),r(770),r(421),r(668),r(348)],void 0===(n=function(e,t,r,i,n,a,o,s){function u(e,t){var r=o.empty(),i=t.getObjects();return t.getSpatialQueryAccelerator()?function(e,t,r){var i=t.eye,n=t.viewForward,a=t.frustumPlanes,s=function(e){return!e.areAllComponentsHidden()},u=r.objectCount;if(u<f)o.set(S,t.near,Math.min(e.near,t.far)),r.forEachInDepthRange(i,n,"front-to-back",S,function(r,i){l(e,t,r),S.far=e.near,i.setRange(S)},a,s),o.set(S,Math.max(e.far,t.near),t.far),r.forEachInDepthRange(i,n,"back-to-front",S,function(r,i){l(e,t,r),S.near=e.far,i.setRange(S)},a,s);else{var d=Math.max(Math.min(u,g),Math.ceil(u*m)),h=r.findClosest(n,"front-to-back",a,s,d),p=r.findClosest(n,"back-to-front",a,s,d);h&&p&&(c(e,t,h.getCenter(),h.getBSRadius()),c(e,t,p.getCenter(),p.getBSRadius()))}}(r,e,t.getSpatialQueryAccelerator()):function(e,t,r){T.clear(),r.forEach(function(e){e.areAllComponentsHidden()||T.add(e)}),T.empty||(T.sort(t),o.set(S,t.near,Math.min(e.near,t.far)),T.forEachInDepthRange(S,"front-to-back",function(r,i,n){i<e.near&&l(e,t,r)}),o.set(S,Math.max(e.far,t.near),t.far),T.forEachInDepthRange(S,"back-to-front",function(t,r,i){e.far=Math.max(e.far,i)}))}(r,e,i),r}function l(e,t,r){if(!r.areAllComponentsHidden()&&n.frustumSphere(t.frustumPlanes,r.getCenter(),r.getBSRadius())){var a=r.objectTransformation,o=w;r.geometryRecords.forEach(function(r){i.mat4d.multiply(a,r.getShaderTransformation(),o);var n=i.mat4d.maxScale(o);d(e,t,r.geometry.boundingInfo,o,n)})}}function d(e,t,r,a,o){var s=t.eye,u=t.viewForward;i.mat4d.multiplyVec3(a,r.center,x);var l=u[0]*(x[0]-s[0])+u[1]*(x[1]-s[1])+u[2]*(x[2]-s[2]),c=r.bsRadius*o;if(!(l-c>e.near&&l+c<e.far)&&n.frustumSphere(t.frustumPlanes,x,c))if(r.bsRadius>p&&r.getChildren())for(var h=r.getChildren(),f=0;f<8;++f)h[f]&&d(e,t,h[f],a,o);else C.unionDepthRangeWithAABB(e,t.viewProjectionMatrix,a,r.bbMin,r.bbMax)}function c(e,t,r,i){var n=t.eye,a=t.viewForward,o=(r[0]-n[0])*a[0]+(r[1]-n[1])*a[1]+(r[2]-n[2])*a[2];e.near=Math.min(e.near,o-i),e.far=Math.max(e.far,o+i)}Object.defineProperty(t,"__esModule",{value:!0});var h=1e4,p=100,f=500,g=500,m=.1;t.depthRangeFromScene=function(e,t,r){if(t.size<h)return O.compute(e,t);var i=o.empty();for(var n in r){var a=r[n];o.union(i,u(e,a))}return i},t.depthRangeFromLayer=u;var v=function(){function e(){this._items=new r({allocator:function(){return{obj:null,distance:0,near:0,far:0}}})}return Object.defineProperty(e.prototype,"length",{get:function(){return this._items.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"empty",{get:function(){return 0===this._items.length},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this._items.clear()},e.prototype.add=function(e){this._items.pushNew().obj=e},e.prototype.sort=function(e){var t=e.eye,r=e.viewForward;this._items.forEach(function(e){var i=e.obj,n=i.getCenter(),a=i.getBSRadius(),o=(n[0]-t[0])*r[0]+(n[1]-t[1])*r[1]+(n[2]-t[2])*r[2];e.distance=o,e.near=o-a,e.far=o+a}),this._items.sort(function(e,t){return e.distance-t.distance})},e.prototype.forEachInDepthRange=function(e,t,r){if("front-to-back"===t)for(var i=0;i<this._items.length;++i){(n=this._items.data[i]).far<e.near||n.near>e.far||r(n.obj,n.near,n.far)}else for(i=this._items.length-1;i>=0;--i){var n;(n=this._items.data[i]).far<e.near||n.near>e.far||r(n.obj,n.near,n.far)}},e}(),y=function(){function e(){this.view=i.mat4d.create(),this.viewProj=i.mat4d.create(),this.planes=[i.vec4d.create(),i.vec4d.create(),i.vec4d.create(),i.vec4d.create(),i.vec4d.create(),i.vec4d.create()],this.geometries=[],this.near=[],this.far=[],this.nearCandidates=[],this.farCandidates=[],this.range={near:0,far:0},this.looseRange={near:0,far:0}}return e.prototype.compute=function(e,t){var r=this;this.reset(),i.mat4d.set(e.viewMatrix,this.view),i.mat4d.multiply(e.projectionMatrix,this.view,this.viewProj),e.copyFrustumPlanes(this.planes);var n=this.view,o=n[2],s=n[6],u=n[10],l=n[14],d=this.range,c=0;if(t.forEach(function(e){var t=e.instanceParameters.componentVisibilities,i=e.componentOffsets;if(!a.isAllHidden(t,i)&&e.castShadow){var n,d;e.hasShaderTransformation?(n=e.getBoundingSphere(e.getShaderTransformation(),1,x),d=x):(n=e.bsRadius,d=e.center);var h=o*d[0]+s*d[1]+u*d[2]+l,p=h-n,f=h+n;r.geometries[c]=e,r.near[c]=-f,r.far[c]=-p,++c}}),0===this.geometries.length)return d;for(var h=0;h<this.geometries.length;++h)this.near[h]>d.far&&(d.far=this.near[h]),this.near[h]>2&&this.far[h]<d.near&&(d.near=this.far[h]);var p=this.looseRange;p.near=Math.max(.5*d.near,2),p.far=2*d.far;var f=0,g=0;for(h=0;h<this.geometries.length;++h)this.near[h]<d.near&&(this.near[h]>=p.near?d.near=this.near[h]:this.nearCandidates[f++]=h),this.far[h]>d.far&&(this.far[h]<=p.far?d.far=this.far[h]:this.farCandidates[g++]=h);if(0===this.nearCandidates.length&&0===this.farCandidates.length)return d;this.nearCandidates.sort(function(e,t){return r.near[e]<r.near[t]?-1:r.near[e]>r.near[t]?1:0}),this.farCandidates.sort(function(e,t){return r.far[e]<r.far[t]?1:r.far[e]>r.far[t]?-1:0});for(h=0;h<this.nearCandidates.length;++h){var m=this.nearCandidates[h];if(this.near[m]<d.near){var v=(y=this.geometries[m]).boundingInfo;this.includeNearBoundingInfoRec(v,y.getShaderTransformation())}}for(h=0;h<this.farCandidates.length;++h){m=this.farCandidates[h];if(this.far[m]>d.far){var y;v=(y=this.geometries[m]).boundingInfo;this.includeFarBoundingInfoRec(v,y.getShaderTransformation())}}return d},e.prototype.reset=function(){this.geometries.length=0,this.near.length=0,this.far.length=0,this.nearCandidates.length=0,this.farCandidates.length=0,this.range.near=Number.MAX_VALUE,this.range.far=-Number.MAX_VALUE},e.prototype.includeNearBoundingInfoRec=function(e,t){var r=e.getBSRadius(),n=e.getCenter();i.mat4d.multiplyVec3(t,n,x);var a=i.mat4d.maxScale(t),o=x[0],s=x[1],u=x[2];if(r*=a,!(this.planes[0][0]*o+this.planes[0][1]*s+this.planes[0][2]*u+this.planes[0][3]>r||this.planes[1][0]*o+this.planes[1][1]*s+this.planes[1][2]*u+this.planes[1][3]>r||this.planes[2][0]*o+this.planes[2][1]*s+this.planes[2][2]*u+this.planes[2][3]>r||this.planes[3][0]*o+this.planes[3][1]*s+this.planes[3][2]*u+this.planes[3][3]>r)){var l=this.view[2]*o+this.view[6]*s+this.view[10]*u+this.view[14],d=l+r;if(!(-(l-r)<2||-d>=this.range.near)){if(-d>this.looseRange.near)return void(this.range.near=-d);if(r>p){var c=e.getChildren();if(void 0!==c){for(var h=0;h<8;++h)void 0!==c[h]&&this.includeNearBoundingInfoRec(c[h],t);return}}C.unionDepthRangeWithAABB(this.range,this.viewProj,t,e.getBBMin(),e.getBBMax())}}},e.prototype.includeFarBoundingInfoRec=function(e,t){var r=e.getBSRadius(),n=e.getCenter();i.mat4d.multiplyVec3(t,n,x);var a=i.mat4d.maxScale(t),o=x[0],s=x[1],u=x[2];if(r*=a,!(this.planes[0][0]*o+this.planes[0][1]*s+this.planes[0][2]*u+this.planes[0][3]>r||this.planes[1][0]*o+this.planes[1][1]*s+this.planes[1][2]*u+this.planes[1][3]>r||this.planes[2][0]*o+this.planes[2][1]*s+this.planes[2][2]*u+this.planes[2][3]>r||this.planes[3][0]*o+this.planes[3][1]*s+this.planes[3][2]*u+this.planes[3][3]>r)){var l=this.view[2]*o+this.view[6]*s+this.view[10]*u+this.view[14]-r;if(!(-l<=this.range.far)){if(-l<this.looseRange.far)return void(this.range.far=-l);if(r>p){var d=e.getChildren();if(void 0!==d){for(var c=0;c<8;++c)void 0!==d[c]&&this.includeFarBoundingInfoRec(d[c],t);return}}C.unionDepthRangeWithAABB(this.range,this.viewProj,t,e.getBBMin(),e.getBBMax())}}},e}();t.DepthRangeFromRenderGeometries=y;var _=function(){function e(){this.modelViewProj=i.mat4d.create(),this.clipPosition=[i.vec4d.create(),i.vec4d.create(),i.vec4d.create(),i.vec4d.create(),i.vec4d.create(),i.vec4d.create(),i.vec4d.create(),i.vec4d.create()]}return e.prototype.unionDepthRangeWithAABB=function(e,t,r,n,a){var o=this.modelViewProj;i.mat4d.multiply(t,r,o);for(var s=!1,u=0;u<8;++u){var l=this.clipPosition[u],d=0===u||3===u||4===u||7===u?n[0]:a[0],c=0===u||1===u||4===u||5===u?n[1]:a[1],h=u<4?n[2]:a[2];l[0]=o[0]*d+o[4]*c+o[8]*h+o[12],l[1]=o[1]*d+o[5]*c+o[9]*h+o[13],l[2]=o[2]*d+o[6]*c+o[10]*h+o[14],l[3]=o[3]*d+o[7]*c+o[11]*h+o[15]}for(u=0;u<12;++u){for(var p=this.clipPosition[b[u][0]],f=this.clipPosition[b[u][1]],g=this.clipPosition[b[u][2]],m=this.clipTriangle(p,f,g),v=!0,y=0;y<m.length;++y){if((_=m[y][3])>=2){v=!1;break}}if(!v){s=!0;for(y=0;y<m.length;++y){var _;(_=m[y][3])<e.near&&(e.near=_),_>e.far&&(e.far=_)}}}return s},e.prototype.inside=function(e,t){return 0===t?e[0]>=-e[3]:1===t?e[1]>=-e[3]:2===t?e[0]<=e[3]:3===t?e[1]<=e[3]:void s.assert(!1)},e.prototype.intersect=function(e,t,r){var n=0;return 0===r?n=(-e[3]-e[0])/(t[0]-e[0]+t[3]-e[3]):1===r?n=(-e[3]-e[1])/(t[1]-e[1]+t[3]-e[3]):2===r?n=(e[3]-e[0])/(t[0]-e[0]-t[3]+e[3]):3===r&&(n=(e[3]-e[1])/(t[1]-e[1]-t[3]+e[3])),i.vec4d.lerp(e,t,n,i.vec4d.create())},e.prototype.clipTriangle=function(e,t,r){for(var i=[e,t,r],n=0;n<4;++n){var a=i;i=[];for(var o=0;o<a.length;++o){var s=a[o],u=a[(o+1)%a.length];this.inside(u,n)?(this.inside(s,n)||i.push(this.intersect(s,u,n)),i.push(u)):this.inside(s,n)&&i.push(this.intersect(s,u,n))}}return i},e}(),b=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],x=i.vec3d.create(),w=i.mat4d.create(),S=o.empty(),T=new v,O=new y,C=new _}.apply(null,i))||(e.exports=n)},851:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(342),r(601),r(369),r(430),r(417),r(348),r(852),r(382),r(372),r(390),r(376)],void 0===(n=function(e,t,r,i,n,a,o,s,u,l,d,c,h){var p=5;return function(){function e(e,t){this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0},this.quadVAO=null,this.blur0Fbo=null,this.blur1Fbo=null,this._rctx=t,this.viewportToRestore=r.vec4d.create(),this.defaultOptions={color:new Float32Array([1,0,1,1]),haloOpacity:1,fillOpacity:.2,haloOpacityOccluded:.25,fillOpacityOccluded:.05},this.blurProgram=e.getProgram(u.blurPass,{gaussianSamples:p}),this.blurGridProgram=e.getProgram(u.blurPass,{gaussianSamples:p,gridOptimization:!0}),this.applyProgram=e.getProgram(u.applyPass),this.applyGridProgram=e.getProgram(u.applyPass,{gridOptimization:!0}),this.applyGridDebugProgram=e.getProgram(u.applyPass,{gridOptimization:!0,gridDebug:!0}),this.downsampleProgram=e.getProgram(u.downsamplePass)}return Object.defineProperty(e.prototype,"enabled",{get:function(){return null!==this.blur0Fbo},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"profilingCallback",{get:function(){return i.HIGHLIGHTS_PROFILE_TO_CONSOLE?function(e){return console.log(e)}:null},enumerable:!0,configurable:!0}),e.prototype.setDefaultOptions=function(e){this.defaultOptions=e},e.prototype.render=function(e,t){var n=!i.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED,a=i.HIGHLIGHTS_VISUALIZE_BLOCKS,o=e.camera,u=e.fbo,l=this._rctx;s.assert(this.enabled),r.vec4d.set(o.fullViewport,this.viewportToRestore);var d=t.width,h=t.height,p=Math.ceil(d/1),f=Math.ceil(h/1);this.blur0Fbo.resize(p,f),this.blur1Fbo.resize(p,f),l.bindVAO(this.quadVAO),l.setDepthWriteEnabled(!1),l.setDepthTestEnabled(!1),l.setBlendingEnabled(!1);var g=null,m=null,v=null,y=null;if(n){var _=this._grid;this._gridUpdateResources(t,32),this._gridComputeMipmap(),v=_.vao,y=4,g=this.blurGridProgram,l.bindProgram(g),l.bindTexture(_.coverageMipmap[_.mipmapLevels].colorTexture,1),g.setUniform1i("coverageTex",1)}else v=this.quadVAO,y=5,g=this.blurProgram,l.bindProgram(g);if(l.bindVAO(v),l.bindFramebuffer(this.blur0Fbo),l.setViewport(0,0,p,f),l.setClearColor(0,0,0,0),l.clear(l.gl.COLOR_BUFFER_BIT),g.setUniform1i("tex",0),l.bindTexture(t.colorTexture,0),g.setUniform2f("blurSize",1/p,0),l.drawArrays(y,0,c.vertexCount(v,"geometry")),l.bindFramebuffer(this.blur1Fbo),l.clear(l.gl.COLOR_BUFFER_BIT),l.bindTexture(this.blur0Fbo.colorTexture,0),g.setUniform2f("blurSize",0,1/f),l.drawArrays(y,0,c.vertexCount(v,"geometry")),l.bindFramebuffer(u),l.setBlendingEnabled(!0),l.setBlendFunctionSeparate(770,771,1,771),l.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3]),n){m=a?this.applyGridDebugProgram:this.applyGridProgram,l.bindProgram(m),m.setUniform1i("coverageTex",2);var b=this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture;l.bindTexture(b,2)}else m=this.applyProgram,l.bindProgram(m);m.setUniform1i("tex",0),l.bindTexture(this.blur1Fbo.colorTexture,0),m.setUniform1i("origin",1),l.bindTexture(t.colorTexture,1);var x=e.pixelRatio||1;m.setUniform4fv("color",this.defaultOptions.color),m.setUniform1f("outlineSize",8.6*x),m.setUniform1f("blurSize",.4*x),m.setUniform4f("opacities",this.defaultOptions.haloOpacity,this.defaultOptions.haloOpacityOccluded,this.defaultOptions.fillOpacity,this.defaultOptions.fillOpacityOccluded),l.drawArrays(y,0,c.vertexCount(v,"geometry")),l.bindVAO(null),l.setDepthWriteEnabled(!0),l.setDepthTestEnabled(!0),l.setBlendingEnabled(!1)},e.prototype.enable=function(){if(!this.enabled){this.quadVAO=o.createQuadVAO(this._rctx);var e={colorTarget:0,depthStencilTarget:0,width:0,height:0},t={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0};this.blur0Fbo=d.createWithAttachments(this._rctx,t,e),this.blur1Fbo=d.createWithAttachments(this._rctx,t,e)}},e.prototype.disable=function(){this.enabled&&(this.quadVAO.dispose(!0),this.blur1Fbo.dispose(),this.blur0Fbo.dispose(),this.quadVAO=null,this.blur0Fbo=null,this.blur1Fbo=null)},e.prototype._gridUpdateResources=function(e,t){var r=this._rctx,i=this._grid,o=!1;if(null===i.coverageMipmap&&(i.coverageMipmap=[e],o=!0),i.viewportWidth===e.width&&i.viewportHeight===e.height||(o=!0,i.viewportWidth=e.width,i.viewportHeight=e.height),i.coverageMipmap[0]=e,i.cellPixelSize!==t&&(i.cellPixelSize=t,o=!0),o){for(var s=1;s<i.coverageMipmap.length;s++)i.coverageMipmap[s].dispose();i.mipmapLevels=Math.ceil(Math.log(i.cellPixelSize)*Math.LOG2E),i.coverageMipmap.length=i.mipmapLevels+1;for(s=0;s<i.mipmapLevels;s++){var u=i.coverageMipmap[s],c={target:3553,pixelFormat:6407,dataType:33635,samplingMode:9729,wrapMode:33071,width:Math.ceil(u.width/2),height:Math.ceil(u.height/2)},p={colorTarget:0,depthStencilTarget:0,width:Math.ceil(u.width/2),height:Math.ceil(u.height/2)},f=d.createWithAttachments(r,c,p);i.coverageMipmap[s+1]=f}}var g=Math.ceil(e.height/i.cellPixelSize),m=Math.ceil(e.width/i.cellPixelSize);if(!i.vao||i.verticalCellCount!==g||i.horizontalCellCount!==m){i.verticalCellCount=g,i.horizontalCellCount=m;for(var v=g+1,y=m+1,_=1/g,b=1/m,x=new Float32Array(24*v*y),w=0,S=0;S<v;S++)for(var T=0;T<y;T++)x[w+0]=(T-.5)*b*2-1,x[w+1]=(S-.5)*_*2-1,x[w+2]=T*b,x[w+3]=S*_,x[w+4]=(T+.5)*b*2-1,x[w+5]=(S-.5)*_*2-1,x[w+6]=T*b,x[w+7]=S*_,x[w+8]=(T-.5)*b*2-1,x[w+9]=(S+.5)*_*2-1,x[w+10]=T*b,x[w+11]=S*_,x[w+12]=(T-.5)*b*2-1,x[w+13]=(S+.5)*_*2-1,x[w+14]=T*b,x[w+15]=S*_,x[w+16]=(T+.5)*b*2-1,x[w+17]=(S-.5)*_*2-1,x[w+18]=T*b,x[w+19]=S*_,x[w+20]=(T+.5)*b*2-1,x[w+21]=(S+.5)*_*2-1,x[w+22]=T*b,x[w+23]=S*_,w+=24;i.vao&&i.vao.dispose(!0),i.vao=new h(r,n.Default3D,{geometry:a.Pos2Tex},{geometry:l.createVertex(r,35044,x)})}},e.prototype._gridComputeMipmap=function(){var e=this._rctx,t=this._grid,r=this.downsampleProgram;e.bindVAO(this.quadVAO);for(var i=0;i<t.mipmapLevels;i++){e.bindFramebuffer(t.coverageMipmap[i+1]),e.bindTexture(t.coverageMipmap[i].colorTexture,0);var n=t.coverageMipmap[i+1].width,a=t.coverageMipmap[i+1].height;e.bindProgram(r),r.setUniform1i("tex",0),r.setUniform2f("invFramebufferDim",1/n,1/a),e.setViewport(0,0,n,a),e.drawArrays(5,0,c.vertexCount(this.quadVAO,"geometry"))}},e}()}.apply(null,i))||(e.exports=n)},852:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(369),r(393),r(408)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){return n.glslifyDefineMap({GRID_OPTIMIZATION:e.gridOptimization,GAUSSIAN_SAMPLES:e.gaussianSamples})},o=function(e){return n.glslifyDefineMap({GRID_OPTIMIZATION:e.gridOptimization,GRID_DEBUG:e.gridDebug})};t.downsamplePass={name:"highlight-downsample",shaders:{vertexShader:i.resolveIncludes("renderer/highlight/downsample.vert"),fragmentShader:i.resolveIncludes("renderer/highlight/downsample.frag")},attributes:r.Default3D},t.blurPass={name:"highlight-blur",shaders:function(e){return{vertexShader:a(e)+i.resolveIncludes("renderer/highlight/blur.vert"),fragmentShader:a(e)+i.resolveIncludes("renderer/highlight/blur.frag")}},attributes:r.Default3D},t.applyPass={name:"highlight-apply",shaders:function(e){return{vertexShader:o(e)+i.resolveIncludes("renderer/highlight/apply.vert"),fragmentShader:o(e)+i.resolveIncludes("renderer/highlight/apply.frag")}},attributes:r.Default3D}}.apply(null,i))||(e.exports=n)},853:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(417),r(854),r(348),r(855),r(390)],void 0===(n=function(e,t,r,i,n,a,o){var s=function(){function e(e,t){this.dimensions={width:4,height:4},this._enabled=!1,this._background={type:"color",color:[0,0,0,1]},this._rctx=t,this.renderTargetHelper=new i.RenderTargetHelper(t);var r=this.renderTargetHelper;this.mainColor=r.registerColorTarget({name:"mainColor"}),this.mainDepth=r.registerDepthTarget({name:"mainDepth"}),this.hudVisibility=r.registerColorTarget({name:"hudVisibility",dataType:32819}),this.tmpColor=r.registerColorTarget({name:"tmpColor"}),this.tmpDepth=r.registerDepthTarget({name:"tmpDepth"}),this._compositeProgram=e.getProgram(a.compositePass),this._compositeTransparentToHUDVisibilityProgram=e.getProgram(a.compositeTransparentToHUDVisibilityPass)}return Object.defineProperty(e.prototype,"width",{get:function(){return this.dimensions.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.dimensions.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"background",{get:function(){return this._background},set:function(e){this._background=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"framebuffer",{get:function(){return this.renderTargetHelper.getFramebuffer(this.dimensions,this.mainColor,this.mainDepth)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"colorTexture",{get:function(){return this.framebuffer.colorTexture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthTexture",{get:function(){return this.renderTargetHelper.getDepthTexture(this.mainDepth,this.dimensions)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hudVisibilityTexture",{get:function(){return this.getColorTexture(this.hudVisibility)},enumerable:!0,configurable:!0}),e.prototype.initializeFrame=function(e,t){n.assert(this.enabled);var r=this._rctx,i=r.gl,a=e.fullViewport;this.dimensions.width=a[2],this.dimensions.height=a[3],this.mainFbo=t,this.bindTarget(this.mainColor,this.mainDepth),r.setClearStencil(0);var o=this._background.color;r.setClearColor(o[0]*o[3],o[1]*o[3],o[2]*o[3],o[3]),r.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT|i.STENCIL_BUFFER_BIT)},e.prototype.renderSeparateAndComposite=function(e,t,r){void 0===t&&(t=u),void 0===r&&(r=l),this.renderToTargets(e,this.tmpColor,this.mainDepth,t),this.composite(this.getColorTexture(this.tmpColor),this.framebuffer,r)},e.prototype.renderHUDVisibility=function(e){this.renderToTargets(e,this.hudVisibility,this.mainDepth,d)},e.prototype.compositeTransparentTerrainOntoHUDVisibility=function(){var e=this,t=this._rctx;this.renderToTargets(function(){var r=e._compositeTransparentToHUDVisibilityProgram;t.bindProgram(r),r.setUniform1i("tex",1),t.bindTexture(e.getColorTexture(e.tmpColor),1),t.setDepthTestEnabled(!1),t.setBlendingEnabled(!1),t.setColorMask(!1,!0,!1,!1),t.bindVAO(e.quadVAO),t.drawArrays(5,0,o.vertexCount(e.quadVAO,"geometry")),t.setColorMask(!0,!0,!0,!0),t.setDepthTestEnabled(!0)},this.hudVisibility,this.mainDepth)},e.prototype.compositeTransparentTerrainOntoMain=function(){this.composite(this.getColorTexture(this.tmpColor),this.framebuffer,"premultiplied-alpha")},e.prototype.bindFramebuffer=function(){this._rctx.bindFramebuffer(this.framebuffer)},e.prototype.renderDepthDetached=function(e){this.bindTarget(this.mainColor),e(),this.bindTarget(this.mainColor,this.mainDepth)},e.prototype.composite=function(e,t,r){void 0===e&&(e=this.framebuffer.colorTexture),void 0===t&&(t=this.mainFbo),void 0===r&&(r=l);var i=this._rctx,n=this._compositeProgram;switch(i.bindFramebuffer(t),i.setDepthTestEnabled(!1),i.bindProgram(n),n.setUniform1i("tex",1),i.bindTexture(e,1),r){case"none":i.setBlendingEnabled(!1);break;case"alpha":i.setBlendFunctionSeparate(770,771,1,771),i.setBlendingEnabled(!0);break;case"premultiplied-alpha":i.setBlendFunction(1,771),i.setBlendingEnabled(!0)}i.bindVAO(this.quadVAO),i.drawArrays(5,0,o.vertexCount(this.quadVAO,"geometry")),i.setDepthTestEnabled(!0),i.setBlendingEnabled(!1)},e.prototype.enable=function(){this.enabled||(this._enabled=!0,this.quadVAO=r.createQuadVAO(this._rctx))},e.prototype.disable=function(){this.enabled&&(this._enabled=!1,this.renderTargetHelper.disposeAllResource(),this.quadVAO.dispose(!0),this.quadVAO=null)},e.prototype.renderToTargets=function(e,t,r,i,n){var a=this._rctx,o=a.gl;this.bindTarget(t,r);var s=0;if(i){var u=Math.max(1e-13,i[3]);a.setClearColor(i[0],i[1],i[2],u),s|=o.COLOR_BUFFER_BIT}n&&(s|=o.DEPTH_BUFFER_BIT),a.clear(s),e(),o.flush(),this.bindTarget(this.mainColor,this.mainDepth)},e.prototype.bindTarget=function(e,t){var r=this.renderTargetHelper.getFramebuffer(this.dimensions,e,t);this._rctx.bindFramebuffer(r)},e.prototype.getColorTexture=function(e){return this.renderTargetHelper.getColorTexture(e,this.dimensions)},e}(),u=[0,0,0,0],l="none",d=[0,1,0,1];return s}.apply(null,i))||(e.exports=n)},854:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(344),r(372),r(891),r(368)],void 0===(n=function(e,t,r,i,n,a){Object.defineProperty(t,"__esModule",{value:!0});var o={dataType:5121},s={},u=function(){function e(e){this.rctx=e,this.framebuffers=new Map,this.depthTextures=new Map,this.depthBuffers=new Map,this.colorTextures=new Map,this.nextId=1,this.depthTextureSupported=e.capabilities.depthTexture}return e.prototype.disposeAllResource=function(){this.depthBuffers.forEach(function(e){return e.dispose()}),this.depthBuffers.clear(),this.depthTextures.forEach(function(e){return e.dispose()}),this.depthTextures.clear(),this.colorTextures.forEach(function(e){return e.dispose()}),this.colorTextures.clear()},e.prototype.getDepthTexture=function(e,t){if(this.depthTextureSupported){var r=this.depthTextures.get(e.id);return r&&(r.descriptor.width===t.width&&r.descriptor.height===t.height||(r.dispose(),r=void 0)),r||(r=new a(this.rctx,{target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:t.width,height:t.height}),this.depthTextures.set(e.id,r)),r}},e.prototype.getDepthBuffer=function(e,t){if(!this.depthTextureSupported){var i=this.depthBuffers.get(e.id);return i?i.descriptor.width===t.width&&i.descriptor.height===t.height||i.resize(t.width,t.height):(i=new n(this.rctx,r({internalFormat:34041},t)),this.depthBuffers.set(e.id,i)),i}},e.prototype.getColorTexture=function(e,t){var r=this.colorTextures.get(e.id);return r&&(r.descriptor.width===t.width&&r.descriptor.height===t.height||(r.dispose(),r=void 0)),r||(r=new a(this.rctx,{target:3553,pixelFormat:6408,dataType:e.dataType,samplingMode:9729,wrapMode:33071,width:t.width,height:t.height}),this.colorTextures.set(e.id,r)),r},e.prototype.registerDepthTarget=function(e){void 0===e&&(e={});var t=this.nextId++;return r({id:t},s,e)},e.prototype.registerColorTarget=function(e){void 0===e&&(e={});var t=this.nextId++;return r({id:t},o,e)},e.prototype.getFramebuffer=function(e,t,r){var n=this.getKey(t,r),a=this.framebuffers.get(n),o=this.getColorTexture(t,e);if(this.depthTextureSupported){var s=r?this.getDepthTexture(r,e):void 0;return a?((a.width!==e.width||a.height!==e.height||a.colorTexture!==o||a.depthStencilTexture!==s)&&(a.detachColorTexture(),a.detachDepthStencilTexture(),a.resize(e.width,e.height),a.attachColorTexture(o),a.attachDepthStencilTexture(s)),a):(a=r?i.createWithAttachments(this.rctx,o,{colorTarget:0,depthStencilTarget:4},s):i.createWithAttachments(this.rctx,o,{colorTarget:0,depthStencilTarget:0}),this.framebuffers.set(n,a),a)}var u=r?this.getDepthBuffer(r,e):void 0;return a?((a.width!==e.width||a.height!==e.height||a.colorTexture!==o)&&(a.detachColorTexture(),a.detachDepthStencilBuffer(),a.resize(e.width,e.height),a.attachColorTexture(o),a.attachDepthStencilBuffer(u)),a):(a=i.createWithAttachments(this.rctx,o,{colorTarget:0,depthStencilTarget:r?3:0},u),this.framebuffers.set(n,a),a)},e.prototype.getKey=function(e,t){return e.id+"_"+(t?t.id:"X")+"_"+e.name+(t?"_"+t.name:"")},e}();t.RenderTargetHelper=u}.apply(null,i))||(e.exports=n)},855:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(369),r(393)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0}),t.compositePass={name:"offscreen-composite",shaders:{vertexShader:i.resolveIncludes("renderer/offscreen/offscreen.vert"),fragmentShader:i.resolveIncludes("renderer/offscreen/offscreen.frag")},attributes:r.Default3D},t.compositeTransparentToHUDVisibilityPass={name:"offscreen-composite-transparent-to-hud-visibility",shaders:{vertexShader:i.resolveIncludes("renderer/offscreen/offscreen.vert"),fragmentShader:i.resolveIncludes("renderer/offscreen/transparentToHUDVisibility.frag")},attributes:r.Default3D}}.apply(null,i))||(e.exports=n)},856:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(342),r(417),r(348),r(857),r(372),r(390)],void 0===(n=function(e,t,r,i,n,a,o,s){return function(){function e(e,t){this._quadVAO=null,this._rctx=t,this._colorFBO=void 0,this._viewportToRestore=r.vec4d.create(),this._combineProgram=e.getProgram(a.combinePass)}return Object.defineProperty(e.prototype,"enabled",{get:function(){return void 0!==this._colorFBO},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0}),e.prototype.setupFBOs=function(e){n.assert(this.enabled);var t=e.fullViewport;this._viewportToRestore=t,this._width=t[2],this._height=t[3],this._rctx.setViewport(0,0,this._width,this._height)},e.prototype.prepareColorPass=function(){n.assert(this.enabled);var e=this._rctx,t=e.gl;this._colorFBO.resize(this._width,this._height),e.bindFramebuffer(this._colorFBO),e.setClearColor(0,0,0,0),e.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)},e.prototype.finish=function(e){var t=this._rctx;t.bindFramebuffer(e),t.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3])},e.prototype.apply=function(){var e=this._rctx,t=this._combineProgram;e.bindProgram(t),e.bindVAO(this._quadVAO),e.bindTexture(this._colorFBO.colorTexture,0),t.setUniform1i("occludedColorMap",0),e.setDepthWriteEnabled(!1),e.setDepthTestEnabled(!1),e.setBlendingEnabled(!0),e.setBlendFunction(770,771),e.drawArrays(5,0,s.vertexCount(this._quadVAO,"geometry")),e.bindVAO(null),e.setDepthWriteEnabled(!0),e.setDepthTestEnabled(!0),e.setBlendingEnabled(!1)},e.prototype.enable=function(){this.enabled||(this._quadVAO=i.createQuadVAO(this._rctx),this._colorFBO=o.createWithAttachments(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:0,height:0},{colorTarget:0,depthStencilTarget:1}))},e.prototype.disable=function(){this.enabled&&(this._quadVAO.dispose(!0),this._quadVAO=void 0,this._colorFBO.dispose(),this._colorFBO=void 0)},e}()}.apply(null,i))||(e.exports=n)},857:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(369),r(393)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0}),t.combinePass={name:"occluded-combine",shaders:{vertexShader:i.resolveIncludes("util/quad.vert"),fragmentShader:i.resolveIncludes("renderer/occluded/combine.frag")},attributes:r.Default3D}}.apply(null,i))||(e.exports=n)},858:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(342),r(359),r(630),r(369),r(430),r(417),r(348),r(618),r(382),r(372),r(368),r(390),r(376)],void 0===(n=function(e,t,r,i,n,a,o,s,u,l,d,c,h,p,f){function g(e,t,i,n,a,o,s,l){r.vec2d.set2(0,0,B);for(var d=0;d<4;++d)r.vec2d.add(B,e[d],B);r.vec2d.scale(B,.25),r.vec2d.set2(0,0,V);for(d=4;d<8;++d)r.vec2d.add(V,e[d],V);r.vec2d.scale(V,.25),r.vec2d.lerp(e[4],e[5],.5,k[0]),r.vec2d.lerp(e[5],e[6],.5,k[1]),r.vec2d.lerp(e[6],e[7],.5,k[2]),r.vec2d.lerp(e[7],e[4],.5,k[3]);var c=0,h=r.vec2d.dist2(k[0],B);for(d=1;d<4;++d){var p=r.vec2d.dist2(k[d],B);p<h&&(h=p,c=d)}r.vec2d.subtract(k[c],e[c+4],z);var f,g,m=z[0];z[0]=-z[1],z[1]=m,r.vec2d.subtract(V,B,G),r.vec2d.lerp(z,G,i),r.vec2d.normalize(z),f=g=r.vec2d.dot(r.vec2d.subtract(e[0],B,H),z);for(d=1;d<8;++d){var v=r.vec2d.dot(r.vec2d.subtract(e[d],B,H),z);v<f?f=v:v>g&&(g=v)}r.vec2d.set(B,n),r.vec2d.scale(z,f-t,H),r.vec2d.add(n,H,n);var y=-1,_=1,b=0,x=0;for(d=0;d<8;++d){r.vec2d.subtract(e[d],n,q),r.vec2d.normalize(q);var w=z[0]*q[1]-z[1]*q[0];w>0?w>y&&(y=w,b=d):w<_&&(_=w,x=d)}u.verify(y>0,"leftArea"),u.verify(_<0,"rightArea"),r.vec2d.scale(z,f,W),r.vec2d.add(W,B,W),r.vec2d.scale(z,g,Q),r.vec2d.add(Q,B,Q),X[0]=-z[1],X[1]=z[0];var S=u.rayRay2D(n,e[x],Q,r.vec2d.add(Q,X,H),1,a),T=u.rayRay2D(n,e[b],Q,H,1,o),O=u.rayRay2D(n,e[b],W,r.vec2d.add(W,X,H),1,s),C=u.rayRay2D(n,e[x],W,H,1,l);u.verify(S,"rayRay"),u.verify(T,"rayRay"),u.verify(O,"rayRay"),u.verify(C,"rayRay")}function m(e,t){return 3*t+e}function v(e,t){return r.vec3d.set3(e[t],e[t+3],e[t+6],Y),Y}function y(e,t,i,n,a){r.vec2d.scale(r.vec2d.subtract(i,n,Z),.5),K[0]=Z[0],K[1]=Z[1],K[2]=0,K[3]=Z[1],K[4]=-Z[0],K[5]=0,K[6]=Z[0]*Z[0]+Z[1]*Z[1],K[7]=Z[0]*Z[1]-Z[1]*Z[0],K[8]=1,K[m(0,2)]=-r.vec2d.dot(v(K,0),e),K[m(1,2)]=-r.vec2d.dot(v(K,1),e);var o=r.vec2d.dot(v(K,0),i)+K[m(0,2)],s=r.vec2d.dot(v(K,1),i)+K[m(1,2)],u=r.vec2d.dot(v(K,0),n)+K[m(0,2)],l=r.vec2d.dot(v(K,1),n)+K[m(1,2)];o=-(o+u)/(s+l),K[m(0,0)]+=K[m(1,0)]*o,K[m(0,1)]+=K[m(1,1)]*o,K[m(0,2)]+=K[m(1,2)]*o,o=1/(r.vec2d.dot(v(K,0),i)+K[m(0,2)]),s=1/(r.vec2d.dot(v(K,1),i)+K[m(1,2)]),K[m(0,0)]*=o,K[m(0,1)]*=o,K[m(0,2)]*=o,K[m(1,0)]*=s,K[m(1,1)]*=s,K[m(1,2)]*=s,K[m(2,0)]=K[m(1,0)],K[m(2,1)]=K[m(1,1)],K[m(2,2)]=K[m(1,2)],K[m(1,2)]+=1,o=-.5*((o=r.vec2d.dot(v(K,1),t)+K[m(1,2)])/(s=r.vec2d.dot(v(K,2),t)+K[m(2,2)])+(u=r.vec2d.dot(v(K,1),i)+K[m(1,2)])/(l=r.vec2d.dot(v(K,2),i)+K[m(2,2)])),K[m(1,0)]+=K[m(2,0)]*o,K[m(1,1)]+=K[m(2,1)]*o,K[m(1,2)]+=K[m(2,2)]*o,o=r.vec2d.dot(v(K,1),t)+K[m(1,2)],u=-(s=r.vec2d.dot(v(K,2),t)+K[m(2,2)])/o,K[m(1,0)]*=u,K[m(1,1)]*=u,K[m(1,2)]*=u,a[0]=K[0],a[1]=K[1],a[2]=0,a[3]=K[2],a[4]=K[3],a[5]=K[4],a[6]=0,a[7]=K[5],a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=K[6],a[13]=K[7],a[14]=0,a[15]=K[8]}for(var _=function(){return function(){this.camera=new n,this.lightMat=r.mat4d.create()}}(),b=function(){function e(e,t){this.doShadowMapMipmapsWork=!1,this.textureRes=4096,this.numCascades=1,this.maxNumCascades=2,this.cascadeDistances=[0,0,0,0,0],this.cascades=[],this.programRep=e,this.rctx=t,this.emptyTexture=s.createEmptyTexture(t);for(var r=0;r<4;++r)this.cascades.push(new _)}return e.prototype.dispose=function(){this.emptyTexture.dispose(),this.emptyTexture=null},Object.defineProperty(e.prototype,"textureResolution",{get:function(){return this.textureRes},set:function(e){this.textureRes=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxCascades",{get:function(){return this.maxNumCascades},set:function(e){this.maxNumCascades=i.clamp(Math.floor(e),1,4)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:function(){return!!this.depthTexture},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0}),e.prototype.getDepthTexture=function(){return this.depthTexture},e.prototype.getCascades=function(){for(var e=0;e<this.numCascades;++e)N[e]=this.cascades[e];return N.length=this.numCascades,N},e.prototype.prepare=function(e,t,i,n){u.assert(this.enabled),r.mat4d.multiply(e.projectionMatrix,e.viewMatrix,w);var a=n.near,o=n.far;a<2&&(a=2),o<2&&(o=2),a>=o&&(a=2,o=4),this.numCascades=Math.min(1+Math.floor(u.logWithBase(o/a,4)),this.maxNumCascades);for(var s=Math.pow(o/a,1/this.numCascades),l=0;l<this.numCascades+1;++l)this.cascadeDistances[l]=a*Math.pow(s,l);r.mat4d.inverse(w,S),r.mat4d.lookAt([0,0,0],[-t[0],-t[1],-t[2]],[0,1,0],F);var d=e.viewMatrix,c=e.projectionMatrix;for(l=0;l<this.numCascades;++l){var h=this.cascades[l],p=-this.cascadeDistances[l],f=-this.cascadeDistances[l+1],m=(c[10]*p+c[14])/Math.abs(c[11]*p+c[15]),v=(c[10]*f+c[14])/Math.abs(c[11]*f+c[15]);u.assert(m<v);for(var _=0;_<8;++_){var b=_%4==0||_%4==3?-1:1,C=_%4==0||_%4==1?-1:1,N=_<4?m:v;r.vec4d.set4(b,C,N,1,T),r.mat4d.multiplyVec4(S,T,O[_]);for(var j=0;j<3;++j)O[_][j]/=O[_][3]}r.vec3d.negate(O[0],L),r.mat4d.translate(F,L,x),h.camera.viewMatrix=x;for(_=0;_<8;++_)r.mat4d.multiplyVec3(h.camera.viewMatrix,O[_]);r.vec3d.set(O[0],M),r.vec3d.set(O[0],R);for(_=1;_<8;++_)for(j=0;j<3;++j)M[j]=Math.min(M[j],O[_][j]),R[j]=Math.max(R[j],O[_][j]);M[2]-=200,R[2]+=200,h.camera.near=-R[2],h.camera.far=-M[2],a=1/O[0][3],o=1/O[4][3],u.assert(a<o);var U=a+Math.sqrt(a*o),B=Math.sin(Math.acos(d[2]*t[0]+d[6]*t[1]+d[10]*t[2]));g(O,U/=B,B,P,E,I,A,D),y(P,E,A,D,h.camera.projectionMatrix),h.camera.projectionMatrix[10]=2/(M[2]-R[2]),h.camera.projectionMatrix[14]=-(M[2]+R[2])/(M[2]-R[2]),r.mat4d.multiply(h.camera.projectionMatrix,h.camera.viewMatrix,h.lightMat);var V=this.textureRes/2;h.camera.viewport[0]=l%2==0?0:V,h.camera.viewport[1]=0===Math.floor(l/2)?0:V,h.camera.viewport[2]=V,h.camera.viewport[3]=V}this.lastOrigin=null,this.cascadeDistances[this.numCascades]=100*o;var k=this.rctx,z=k.gl;k.bindFramebuffer(this.fbo),k.bindTexture(null,7),k.setClearColor(1,1,1,1),k.clear(z.COLOR_BUFFER_BIT|z.DEPTH_BUFFER_BIT),k.setBlendingEnabled(!1)},e.prototype.finish=function(e){u.assert(this.enabled),this.rctx.bindFramebuffer(e),this.doShadowMapMipmapsWork&&this.depthTexture.generateMipmap()},e.prototype.bind=function(e){var t=this.rctx,r=this.enabled;t.bindTexture(r?this.depthTexture:this.emptyTexture,7),t.bindProgram(e),e.setUniform1i("depthTex",7),e.setUniform1f("depthHalfPixelSz",r?.5/this.textureRes:-1),e.setUniform1i("shadowMapNum",this.numCascades),e.setUniform4f("shadowMapDistance",this.cascadeDistances[0],this.cascadeDistances[1],this.cascadeDistances[2],this.cascadeDistances[3])},e.prototype.bindAll=function(e){for(var t=e.getProgramsUsingUniform("shadowMapDistance"),r=0;r<t.length;r++)this.bind(t[r])},e.prototype.bindView=function(e,t){if(this.enabled){var i=this.lastOrigin;if(!i||i[0]!==t[0]||i[1]!==t[1]||i[2]!==t[2]){this.lastOrigin=this.lastOrigin||r.vec3d.create(),r.vec3d.set(t,this.lastOrigin);for(var n=0;n<this.numCascades;++n){r.mat4d.translate(this.cascades[n].lightMat,t,j);for(var a=0;a<16;++a)U[16*n+a]=j[a]}}e.setUniformMatrix4fv("shadowMapMatrix",U)}},e.prototype.drawDebugQuad=function(e){u.assert(this.enabled);var t=this.rctx,r=t.gl;if(!this.debugQuadVAO){var i=new Float32Array([0,0,0,0,256,0,1,0,0,256,0,1,256,256,1,1]);this.debugQuadVAO=new f(t,a.Default3D,{geometry:o.Pos2Tex},{geometry:d.createVertex(t,r.STATIC_DRAW,i)})}var n=this.programRep.getProgram(l.showDepth),s=this.debugQuadVAO;t.setDepthTestEnabled(!1),t.bindProgram(n),n.setUniformMatrix4fv("proj",e),n.setUniform1i("depthTex",0),t.bindTexture(this.depthTexture,0),t.bindVAO(s),p.assertCompatibleVertexAttributeLocations(s,n),t.drawArrays(r.TRIANGLE_STRIP,0,p.vertexCount(s,"geometry")),t.setDepthTestEnabled(!0)},e.prototype.enable=function(){if(!this.enabled){var e=this.rctx.gl,t={target:e.TEXTURE_2D,pixelFormat:e.RGBA,dataType:e.UNSIGNED_BYTE,wrapMode:e.CLAMP_TO_EDGE,samplingMode:e.NEAREST,flipped:!0,width:this.textureRes,height:this.textureRes};this.depthTexture=new h(this.rctx,t),this.fbo=c.createWithAttachments(this.rctx,this.depthTexture,{colorTarget:0,depthStencilTarget:1,width:this.textureRes,height:this.textureRes})}},e.prototype.disable=function(){this.enabled&&this.fbo&&(this.fbo.dispose(),this.fbo=null,this.depthTexture=null)},e}(),x=r.mat4d.create(),w=r.mat4d.create(),S=r.mat4d.create(),T=r.vec4d.create(),O=[],C=0;C<8;++C)O.push(r.vec4d.create());var M=r.vec3d.create(),R=r.vec3d.create(),P=r.vec2d.create(),E=r.vec2d.create(),I=r.vec2d.create(),A=r.vec2d.create(),D=r.vec2d.create(),F=r.mat4d.create(),L=r.vec3d.create(),N=[],j=r.mat4d.create(),U=new Float32Array(64),B=r.vec2d.create(),V=r.vec2d.create(),k=[r.vec2d.create(),r.vec2d.create(),r.vec2d.create(),r.vec2d.create()],z=r.vec2d.create(),G=r.vec2d.create(),H=r.vec2d.create(),q=r.vec2d.create(),W=r.vec2d.create(),Q=r.vec2d.create(),X=r.vec2d.create(),Y=r.vec3d.create(),Z=r.vec2d.create(),K=r.mat3d.create();return b}.apply(null,i))||(e.exports=n)},859:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(343),r(342),r(632),r(369),r(430),r(417),r(348),r(618),r(860),r(382),r(372),r(368),r(390),r(376)],void 0===(n=function(e,t,i,n,a,o,s,u,l,d,c,h,p,f,g,m){var v=i.getLogger("esri.views.3d.webgl-engine.lib.SSAOHelper"),y=function(){function e(e,t,r){this._enabled=!1,this._BLUR_F=2,this._attenuation=.5,this._radius=3,this._samples=16,this._viewportToRestore=n.vec4d.create(),this._rctx=t,this._programRep=e,this._requestRender=r,this._emptyTexture=u.createEmptyTexture(t)}return e.prototype.dispose=function(){this._emptyTexture.dispose(),this._emptyTexture=null},Object.defineProperty(e.prototype,"isSupported",{get:function(){var e=this._rctx,t=-1!==e.parameters.versionString.indexOf("WebGL 0.93"),r=-1!==e.parameters.versionString.indexOf("WebGL 0.94");return!(t||r)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"attenuation",{get:function(){return this._attenuation},set:function(e){this._attenuation=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"radius",{get:function(){return this._radius},set:function(e){this._radius=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"filterRadius",{get:function(){return 4},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"samples",{get:function(){return this._samples},set:function(e){this._samples=e,this._enabled&&this.selectPrograms()},enumerable:!0,configurable:!0}),e.prototype.computeSSAO=function(e,t,r,i){if(this._noiseTexture){l.assert(this.enabled);var a=this._rctx,o=r.width,s=r.height,d=o/this._BLUR_F,c=s/this._BLUR_F;this._ssaoFBO.resize(o,s),this._blur0FBO.resize(d,c),this._blur1FBO.resize(d,c);var h=1*o,p=1*s;a.bindFramebuffer(this._ssaoFBO),n.vec4d.set(e.fullViewport,this._viewportToRestore),a.setViewport(0,0,o,s);var f=this._ssaoProgram,m=this._blurProgram;f.setUniform2f("rnmScale",o/this._noiseTexture.descriptor.width,s/this._noiseTexture.descriptor.height),f.setUniform3fv("pSphere",this._samples<=8?this._data.random8:this._samples<=16?this._data.random16:this._samples<=32?this._data.random32:this._data.random64),a.bindProgram(f);var v=this._data.minDiscrepancy,y=this._samples<v.length?v[this._samples]:5779;f.setUniform1f("numSpiralTurns",y);var x=b,w=_;l.inverseProjectionInfo(e.projectionMatrix,e.fullWidth,e.fullHeight,x,w),f.setUniform4fv("projInfo",x),f.setUniform2fv("zScale",w),f.setUniform2f("nearFar",e.near,e.far);var S=1/e.computePixelSizeAtDist(1);f.setUniform1f("projScale",1*S),f.setUniform2f("screenDimensions",h,p);var T=2*this._radius,O=n.vec3d.dist(e.eye,e.center);T=20*e.computePixelSizeAtDist(O),T=Math.max(.1,T),f.setUniform1f("radius",T),f.setUniform1f("intensity",4*this._attenuation/Math.pow(T,6)),f.setUniform1i("rnm",0),f.setUniform1i("normalMap",1),f.setUniform1i("depthMap",2),a.bindTexture(this._noiseTexture,0),a.bindTexture(i.colorTexture,1),a.bindTexture(r.colorTexture,2);var C=u.createQuadVAO(this._rctx);a.bindVAO(C),a.drawArrays(5,0,g.vertexCount(C,"geometry")),a.bindTexture(this._ssaoFBO.colorTexture,0),a.setViewport(0,0,h/this._BLUR_F,p/this._BLUR_F),a.bindFramebuffer(this._blur0FBO),m.setUniform2f("screenDimensions",h,p),m.setUniform1i("tex",0),m.setUniform1i("normalMap",1),m.setUniform1i("depthMap",2),m.setUniform2f("blurSize",0,1*this._BLUR_F/p),m.setUniform1i("radius",4),m.setUniform1f("g_BlurFalloff",.08),m.setUniform2f("nearFar",e.near,e.far),O>5e4&&(S=Math.max(0,S-(O-5e4))),m.setUniform1f("projScale",S),m.setUniform2f("zScale",1,0),a.drawArrays(5,0,g.vertexCount(C,"geometry")),m.setUniform2f("blurSize",1*this._BLUR_F/h,0),a.bindFramebuffer(this._blur1FBO),a.bindTexture(this._blur0FBO.colorTexture,0),a.drawArrays(5,0,g.vertexCount(C,"geometry")),a.bindFramebuffer(t),a.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3])}},e.prototype.setUniforms=function(e){var t=this.enabled&&this._noiseTexture,r=this._rctx;r.bindTexture(t?this._blur1FBO.colorTexture:this._emptyTexture,6),r.setActiveTexture(0),e.setUniform1i("ssaoTex",6),t?e.setUniform4f("viewportPixelSz",this._viewportToRestore[0],this._viewportToRestore[1],1/this._ssaoFBO.width,1/this._ssaoFBO.height):e.setUniform4f("viewportPixelSz",-1,-1,-1,-1)},e.prototype.bindAll=function(e){for(var t=e.getProgramsUsingUniform("viewportPixelSz"),r=0;r<t.length;r++)this.setUniforms(t[r])},e.prototype.drawQuad=function(e){l.assert(this.enabled);var t=this._showDepthProgram;this._debugQuadVAO||(this._debugQuadVAO=new m(this._rctx,o.Default3D,{geometry:s.Pos2Tex},{geometry:h.createVertex(this._rctx,35044,x)}));var r=this._rctx;r.setDepthTestEnabled(!1),t.setUniformMatrix4fv("proj",new Float32Array(e)),t.setUniform1i("depthTex",0),r.bindTexture(this._ssaoFBO.colorTexture,0),r.bindVAO(this._debugQuadVAO),r.drawArrays(5,0,g.vertexCount(this._debugQuadVAO,"geometry")),r.setDepthTestEnabled(!0)},e.prototype.selectPrograms=function(){var e=this._samples<=8?8:this._samples<=16?16:this._samples<=32?32:64;this._ssaoProgram=this._programRep.getProgram(c.ssaoPass,{samples:e}),this._blurProgram=this._programRep.getProgram(c.blurPass,{radius:4}),this._showDepthProgram=this._programRep.getProgram(d.showDepth)},e.prototype.enable=function(){var e=this;if(!this.enabled){if(!this.isSupported)return void v.warn("SSAO is not supported for this browser or hardware");this._enabled=!0,this.loadResources(function(){e._enabled&&e.initialize()})}},e.prototype.loadResources=function(e){var t=this;this._data?e():r.e(108).then(function(){var i=[r(1075)];(function(r){t._data=r,e()}).apply(null,i)}).catch(r.oe)},e.prototype.initialize=function(){var e=this,t={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0},r={colorTarget:0,depthStencilTarget:0};this._ssaoFBO=p.createWithAttachments(this._rctx,t,r),this._blur0FBO=p.createWithAttachments(this._rctx,t,r),this._blur1FBO=p.createWithAttachments(this._rctx,t,r),a.requestImage(this._data.noiseTexture).then(function(t){e._enabled&&(e._noiseTexture=new f(e._rctx,{target:3553,pixelFormat:6408,dataType:5121,hasMipmap:!0,width:t.width,height:t.height},t),e._requestRender())}),this.selectPrograms()},e.prototype.disable=function(){this.enabled&&(this._enabled=!1,this._quadVAO&&(this._quadVAO.dispose(!0),this._quadVAO=null),this._noiseTexture&&(this._noiseTexture.dispose(),this._noiseTexture=null),this._blur1FBO&&(this._blur1FBO.dispose(),this._blur1FBO=null),this._blur0FBO&&(this._blur0FBO.dispose(),this._blur0FBO=null),this._ssaoFBO&&(this._ssaoFBO.dispose(),this._ssaoFBO=null))},e}(),_=n.vec2d.create(),b=n.vec4d.create(),x=new Float32Array([0,0,0,0,512,0,1,0,0,512,0,1,512,512,1,1]);return y}.apply(null,i))||(e.exports=n)},860:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(369),r(393)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0});t.ssaoPass={name:"ssao",shaders:function(e){return{vertexShader:i.resolveIncludes("util/quad.vert"),fragmentShader:function(e){return"#define SAMPLES "+e.samples+"\n"}(e)+i.resolveIncludes("renderer/ssao/ssao.frag")}},attributes:r.Default3D},t.blurPass={name:"ssao-blur",shaders:function(e){return{vertexShader:i.resolveIncludes("util/quad.vert"),fragmentShader:function(e){return"#define RADIUS "+e.radius+"\n"}(e)+i.resolveIncludes("renderer/ssao/blur.frag")}},attributes:r.Default3D}}.apply(null,i))||(e.exports=n)},861:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(369),r(393),r(408)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){return n.glslifyDefineMap({VIEWING_MODE_GLOBAL:"global"===e.viewingMode,VIEWING_MODE_LOCAL:"local"===e.viewingMode,TEXTURING:"none"!==e.textureMode,TEXTURE_ATLAS:"AtlasTextured"===e.textureMode,VERTEXCOLORS:e.vertexColors,SYMBOLVERTEXCOLORS:e.symbolColors,FLIPV:e.flipV,DOUBLESIDED:e.doubleSided,WINDINGORDERDOUBLESIDED:e.windowOrderDoubleSided,INSTANCED:e.instanced,INSTANCED_DOUBLE_PRECISION:e.instancedDoublePrecision,INSTANCEDCOLOR:e.instancedColor,RECEIVE_SHADOWS:e.receiveShadows,RECEIVE_SSAO:e.receiveSSAO,VV_SIZE:e.vvSize,VV_COLOR:e.vvColor,VERTICAL_OFFSET:e.verticalOffset,SCREEN_SIZE_PERSPECTIVE:e.screenSizePerspective,SLICE:e.slice,GROUND_NORMAL_SHADING:e.groundNormalShading,COMPRESSED_NORMALS:e.compressedNormals,COMPONENTCOLORS:e.componentColor,TRANSPARENCY_DISCARD:e.transparencyDiscard,ALPHA_COVERAGE_CORRECTION:e.alphaCoverageCorrection,BIAS_SHADOWMAP:e.shadowMap})};t.colorPass={name:"default-color",shaders:function(e){return{vertexShader:a(e)+i.resolveIncludes("materials/defaultMaterial/colorPass.vert"),fragmentShader:a(e)+i.resolveIncludes("materials/defaultMaterial/colorPass.frag")}},attributes:r.Default3D},t.depthPass={name:"default-depth",shaders:function(e){return{vertexShader:a(e)+i.resolveIncludes("materials/defaultMaterial/depthPass.vert"),fragmentShader:a(e)+i.resolveIncludes("materials/defaultMaterial/depthPass.frag")}},attributes:r.Default3D},t.normalPass={name:"default-normal",shaders:function(e){return{vertexShader:a(e)+i.resolveIncludes("materials/defaultMaterial/normalPass.vert"),fragmentShader:a(e)+i.resolveIncludes("materials/defaultMaterial/normalPass.frag")}},attributes:r.Default3D},t.highlightPass={name:"default-highlight",shaders:function(e){return{vertexShader:a(e)+i.resolveIncludes("materials/defaultMaterial/highlightPass.vert"),fragmentShader:a(e)+i.resolveIncludes("materials/defaultMaterial/highlightPass.frag")}},attributes:r.Default3D}}.apply(null,i))||(e.exports=n)},862:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(368)],void 0===(n=function(e,t,r){function i(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}Object.defineProperty(t,"__esModule",{value:!0});var n=542327876,a=131072,o=4,s=33776,u=33778,l=33779,d=i("DXT1"),c=i("DXT3"),h=i("DXT5"),p=31,f=0,g=1,m=2,v=3,y=4,_=7,b=20,x=21;t.createDDSTexture=function(e,t,i,w){var S=new Int32Array(i,0,p);if(S[f]!==n)return console.error("Invalid magic number in DDS header"),null;if(!(S[b]&o))return console.error("Unsupported format, must contain a FourCC code"),null;var T,O,C=S[x];switch(C){case d:T=8,O=s;break;case c:T=16,O=u;break;case h:T=16,O=l;break;default:return console.error("Unsupported FourCC code:",function(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}(C)),null}var M=1;S[m]&a&&!1!==w&&(M=Math.max(1,S[_]));for(var R,P,E=S[y],I=S[v],A=S[g]+4,D=[],F=0;F<M;++F)P=Math.floor((E+3)/4)*Math.floor((I+3)/4)*T,R=new Uint8Array(i,A,P),D.push(R),A+=P,E=Math.max(1,E>>1),I=Math.max(1,I>>1);t.samplingMode=M>1?9987:9729,t.hasMipmap=M>1,t.width=S[y],t.height=S[v],t.internalFormat=O;var L=new r(e,t,{type:"compressed",levels:D});return e.bindTexture(L),L}}.apply(null,i))||(e.exports=n)},887:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(450),n=r(614),a=r(660);if(n.default("es6-object")){var o=i.default.Object;t.assign=o.assign,t.getOwnPropertyDescriptor=o.getOwnPropertyDescriptor,t.getOwnPropertyNames=o.getOwnPropertyNames,t.getOwnPropertySymbols=o.getOwnPropertySymbols,t.is=o.is,t.keys=o.keys}else t.keys=function(e){return Object.keys(e).filter(function(e){return!Boolean(e.match(/^@@.+/))})},t.assign=function(e){for(var r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];if(null==e)throw new TypeError("Cannot convert undefined or null to object");var n=Object(e);return r.forEach(function(e){e&&t.keys(e).forEach(function(t){n[t]=e[t]})}),n},t.getOwnPropertyDescriptor=function(e,t){return a.isSymbol(t),Object.getOwnPropertyDescriptor(e,t)},t.getOwnPropertyNames=function(e){return Object.getOwnPropertyNames(e).filter(function(e){return!Boolean(e.match(/^@@.+/))})},t.getOwnPropertySymbols=function(e){return Object.getOwnPropertyNames(e).filter(function(e){return Boolean(e.match(/^@@.+/))}).map(function(e){return Symbol.for(e.substring(2))})},t.is=function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t};if(n.default("es2017-object")){o=i.default.Object;t.getOwnPropertyDescriptors=o.getOwnPropertyDescriptors,t.entries=o.entries,t.values=o.values}else t.getOwnPropertyDescriptors=function(e){return t.getOwnPropertyNames(e).reduce(function(r,i){return r[i]=t.getOwnPropertyDescriptor(e,i),r},{})},t.entries=function(e){return t.keys(e).map(function(t){return[t,e[t]]})},t.values=function(e){return t.keys(e).map(function(t){return e[t]})}},889:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(450);function n(e){return"number"==typeof e&&i.default.isFinite(e)}function a(e){return n(e)&&Math.floor(e)===e}t.EPSILON=1,t.MAX_SAFE_INTEGER=Math.pow(2,53)-1,t.MIN_SAFE_INTEGER=-t.MAX_SAFE_INTEGER,t.isNaN=function(e){return"number"==typeof e&&i.default.isNaN(e)},t.isFinite=n,t.isInteger=a,t.isSafeInteger=function(e){return a(e)&&Math.abs(e)<=t.MAX_SAFE_INTEGER}},890:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1006),r(687)],void 0===(n=function(e,t,r,i){return function(){function e(e){e?this.set(e):this.setDefaults()}return Object.defineProperty(e.prototype,"meterUnitOffset",{get:function(){return this._meterUnitOffset},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"unit",{get:function(){return this._unit},enumerable:!0,configurable:!0}),e.prototype.setUnit=function(e){this._unit=e,this._metersPerElevationInfoUnit=r.getMetersPerUnit(e)},e.prototype.setDefaults=function(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this.featureExpressionInfoContext=null,this.hasOffsetAdjustment=!1,this.setUnit("meters")},e.prototype.set=function(e){this.mode=e.mode,this._meterUnitOffset=e._meterUnitOffset||0,this._renderUnitOffset=e._renderUnitOffset||0,this.featureExpressionInfoContext=e.featureExpressionInfoContext,this.hasOffsetAdjustment=e.hasOffsetAdjustment,this.setUnit(e.unit)},e.prototype.setOffsetMeters=function(e){this._meterUnitOffset=e,this._renderUnitOffset=0},e.prototype.setOffsetElevationInfoUnits=function(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0},e.prototype.setOffsetRenderUnits=function(e){this._meterUnitOffset=0,this._renderUnitOffset=e},e.prototype.addOffsetRenderUnits=function(e){this._renderUnitOffset+=e},e.prototype.mixinApi=function(e){null!=e.mode&&(this.mode=e.mode),null!=e.unit&&this.setUnit(e.unit),null!=e.offset&&this.setOffsetElevationInfoUnits(e.offset)},e.prototype.calculateOffsetRenderUnits=function(e){var t=this._meterUnitOffset,r=this.featureExpressionInfoContext;return null!=r&&(t+=i.execute(r)*this._metersPerElevationInfoUnit),t/e.unitInMeters+this._renderUnitOffset},e}()}.apply(null,i))||(e.exports=n)},894:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this._listeners={}}return e.prototype.hasEventListener=function(e){return null!=this._listeners[e]&&this._listeners[e].size>0},e.prototype.on=function(e,t){var r=this;null==this._listeners[e]&&(this._listeners[e]=new Map);var i={};return this._listeners[e].set(i,t),{remove:function(){return r._listeners[e].delete(i)}}},e.prototype.emit=function(e,t){null!=this._listeners[e]&&this._listeners[e].forEach(function(e){return e(t)})},e}();t.Evented=r}.apply(null,i))||(e.exports=n)},906:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(358),r(354)],void 0===(n=function(e,t,r,i){function n(e,t,n){if(!t)return null;var a=r.toUnitRGBA(t.color),o=n.opacity,s=n.slicePlaneEnabled;switch(t.type){case"solid":return e.createSolidEdgeMaterial({color:a,size:i.pt2px(t.size),extensionLength:i.pt2px(t.extensionLength),opacity:o,slicePlaneEnabled:s});case"sketch":return e.createSketchEdgeMaterial({color:a,size:i.pt2px(t.size),extensionLength:i.pt2px(t.extensionLength),opacity:o,slicePlaneEnabled:s})}}Object.defineProperty(t,"__esModule",{value:!0}),t.createMaterial=function(e,t,r){return n(e,function(e){return e&&e.enabled&&e.edges||null}(t),r)},t.createMaterialFromEdges=n}.apply(null,i))||(e.exports=n)},907:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(407),r(342),r(348)],void 0===(n=function(e,t,r,i,n){function a(e,t,r){e[0]=Math.min(e[0],t[0]-r),e[1]=Math.min(e[1],t[1]-r),e[2]=Math.min(e[2],t[2]-r)}function o(e,t,r){e[0]=Math.max(e[0],t[0]+r),e[1]=Math.max(e[1],t[1]+r),e[2]=Math.max(e[2],t[2]+r)}function s(e,t,r){return(r=r||e)[0]=e[0]+t,r[1]=e[1]+t,r[2]=e[2]+t,r}function u(e,t,r){var i=e[0],n=e[1],a=e[2];return r[0][0]*i+r[0][1]*n+r[0][2]*a+r[0][3]>t||r[1][0]*i+r[1][1]*n+r[1][2]*a+r[1][3]>t||r[2][0]*i+r[2][1]*n+r[2][2]*a+r[2][3]>t||r[3][0]*i+r[3][1]*n+r[3][2]*a+r[3][3]>t||r[4][0]*i+r[4][1]*n+r[4][2]*a+r[4][3]>t||r[5][0]*i+r[5][1]*n+r[5][2]*a+r[5][3]>t}function l(e,t){for(var r=1/0,i=null,n=0;n<8;++n){var a=d(e,t,g[n]);a<r&&(r=a,i=g[n])}return i}function d(e,t,r){return t*(e[0]*r[0]+e[1]*r[1]+e[2]*r[2])}var c,h=function(){function e(e,t,r,n){this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._objectCount=0,this._objectToBoundingSphere=r,n&&(void 0!==n.maximumObjectsPerNode&&(this._maximumObjectsPerNode=n.maximumObjectsPerNode),void 0!==n.maximumDepth&&(this._maximumDepth=n.maximumDepth)),isNaN(e[0])||isNaN(e[1])||isNaN(e[2])||isNaN(t)?this._root=new p(null,i.vec3d.createFrom(0,0,0),.5):this._root=new p(null,e,t/2)}return Object.defineProperty(e.prototype,"center",{get:function(){return this._root.center},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return 2*this._root.halfSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this._root.node},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maximumObjectsPerNode",{get:function(){return this._maximumObjectsPerNode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maximumDepth",{get:function(){return this._maximumDepth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"objectCount",{get:function(){return this._objectCount},enumerable:!0,configurable:!0}),e.prototype.add=function(e,t){var r=this._objectOrObjectsArray(e);t=null==t?r.length:t,this._objectCount+=t,this._grow(r);for(var i=p.acquire(),n=0;n<t;n++){var a=r[n];i.init(this._root),this._isDegenerate(a)?this._degenerateObjects.add(a):this._add(a,i)}p.release(i)},e.prototype.remove=function(e,t){var r=this._objectOrObjectsArray(e);this._objectCount-=r.length;for(var i=p.acquire(),n=0;n<r.length;n++){var a=r[n],o=t||this._boundingSphereFromObject(a,S);this._isValidRadius(o.radius)?(i.init(this._root),this._remove(a,o,i)):this._degenerateObjects.delete(a)}p.release(i),this._shrink()},e.prototype.update=function(e,t){!this._isValidRadius(t.radius)&&this._isDegenerate(e)||(this.remove(e,t),this.add(e))},e.prototype.forEachAlongRay=function(e,t,r){var i=this;this._forEachNode(this._root,function(n){if(!i._intersectsNode(e,t,n))return!1;var a=n.node;return a.terminals.forEach(function(n){i._intersectsObject(e,t,n)&&r(n)}),null!==a.residents&&a.residents.forEach(function(n){i._intersectsObject(e,t,n)&&r(n)}),!0})},e.prototype.forEachDegenerateObject=function(e){this._degenerateObjects.forEach(e)},e.prototype.findClosest=function(e,t,r,i,n){return this._findClosest(e,"front-to-back"===t?c.FRONT_TO_BACK:c.BACK_TO_FRONT,r,i,n)},e.prototype.forEachInDepthRange=function(e,t,r,i,n,a,o,s){this._forEachInDepthRange(e,t,"front-to-back"===r?c.FRONT_TO_BACK:c.BACK_TO_FRONT,i,n,a,o,s)},e.prototype.forEachNode=function(e){this._forEachNode(this._root,function(t){return e(t.node,t.center,2*t.halfSize)})},e.prototype._intersectsNode=function(e,t,r){return s(r.center,2*-r.halfSize,b),s(r.center,2*r.halfSize,x),n.rayBoxTest(e,t,b,x)},e.prototype._intersectsObject=function(e,t,r){var i=this._objectToBoundingSphere.getRadius(r);return!(i>0)||n.raySphere(e,t,this._objectToBoundingSphere.getCenter(r),i)},e.prototype._forEachNode=function(e,t){for(var r=p.acquire().init(e),i=[r];0!==i.length;){if(t(r=i.pop())&&!r.isLeaf())for(var n=0;n<r.node.children.length;n++){r.node.children[n]&&i.push(p.acquire().init(r).advance(n))}p.release(r)}},e.prototype._forEachNodeDepthOrdered=function(e,t,r,i){void 0===i&&(i=c.FRONT_TO_BACK);for(var n=p.acquire().init(e),a=[n],o=function(e,t,r){if(!R.length)for(var i=0;i<8;++i)R[i]={index:0,distance:0};for(i=0;i<8;++i){var n=f[i];R[i].index=i,R[i].distance=d(e,t,n)}for(R.sort(function(e,t){return e.distance-t.distance}),i=0;i<8;++i)r[i]=R[i].index;return r}(r,i,P);0!==a.length;){if(t(n=a.pop())&&!n.isLeaf())for(var s=7;s>=0;--s){var u=o[s];if(!(u>=n.node.children.length))n.node.children[u]&&a.push(p.acquire().init(n).advance(u))}p.release(n)}},e.prototype._findClosest=function(e,t,r,n,a){var o=this,s=1/0,c=1/0,h=null,p=l(e,t),f=0,g=function(i){if(++f,!n||n(i)){var a=o._objectToBoundingSphere.getCenter(i),l=o._objectToBoundingSphere.getRadius(i);if(!r||!u(a,l,r)){var p=d(e,t,a),g=p-l;g<s&&(s=g,c=p+l,h=i)}}};return this._forEachNodeDepthOrdered(this._root,function(n){if(null!=a&&f>=a)return!1;if(r&&u(n.center,n.halfSize*m,r))return!1;if(i.vec3d.scale(p,n.halfSize,_),i.vec3d.add(_,n.center),d(e,t,_)>c)return!1;var o=n.node;return o.terminals.forEach(function(e){g(e)}),null!==o.residents&&o.residents.forEach(function(e){g(e)}),!0},e,t),h},e.prototype._forEachInDepthRange=function(e,t,r,n,a,o,s,h){var p=this,f=-1/0,g=1/0,v={setRange:function(e){r===c.FRONT_TO_BACK?(f=Math.max(f,e.near),g=Math.min(g,e.far)):(f=Math.max(f,-e.far),g=Math.min(g,-e.near))}};v.setRange(n);var y=d(t,r,e),b=l(t,r),x=l(t,-1*r),w=0,S=function(e){if(++w,!s||s(e)){var i=p._objectToBoundingSphere.getCenter(e),n=p._objectToBoundingSphere.getRadius(e),l=d(t,r,i)-y;l-n>g||l+n<f||o&&u(i,n,o)||a(e,v)}};this._forEachNodeDepthOrdered(this._root,function(e){if(null!=h&&w>=h)return!1;if(o&&u(e.center,e.halfSize*m,o))return!1;if(i.vec3d.scale(b,e.halfSize,_),i.vec3d.add(_,e.center),d(t,r,_)-y>g)return!1;if(i.vec3d.scale(x,e.halfSize,_),i.vec3d.add(_,e.center),d(t,r,_)-y<f)return!1;var n=e.node;return n.terminals.forEach(function(e){S(e)}),null!==n.residents&&n.residents.forEach(function(e){S(e)}),!0},t,r)},e.prototype._objectOrObjectsArray=function(e){return Array.isArray(e)?e:(v[0]=e,v)},e.prototype._remove=function(e,t,r){w.length=0;var i=r.advanceTo(t,function(e,t){w.push(e.node,t)})?r.node.terminals:r.node.residents;if(i.removeUnordered(e),0===i.length)for(var n=w.length-2;n>=0;n-=2){var a=w[n],o=w[n+1];if(!this._purge(a,o))break}},e.prototype._nodeIsEmpty=function(e){if(0!==e.terminals.length)return!1;if(null!==e.residents)return 0===e.residents.length;for(var t=0;t<e.children.length;t++)if(e.children[t])return!1;return!0},e.prototype._purge=function(e,t){return t>=0&&(e.children[t]=null),!!this._nodeIsEmpty(e)&&(null===e.residents&&(e.residents=new r({shrink:!0})),!0)},e.prototype._add=function(e,t){t.advanceTo(this._boundingSphereFromObject(e,S))?t.node.terminals.push(e):(t.node.residents.push(e),t.node.residents.length>this._maximumObjectsPerNode&&t.depth<this._maximumDepth&&this._split(t))},e.prototype._split=function(e){var t=e.node.residents;e.node.residents=null;for(var r=0;r<t.length;r++){var i=p.acquire().init(e);this._add(t.data[r],i),p.release(i)}},e.prototype._grow=function(e){var t=this;if(0!==e.length){var r=this._boundingSphereFromObjects(e,function(e,r){return t._boundingSphereFromObject(e,r)},T);if(this._isValidRadius(r.radius)&&!this._fitsInsideTree(r))if(this._nodeIsEmpty(this._root.node))i.vec3d.set(r.center,this._root.center),this._root.halfSize=1.25*r.radius;else{var n=p.acquire();this._rootBoundsForRootAsSubNode(r,n),this._placingRootViolatesMaxDepth(n)?this._rebuildTree(r,n):this._growRootAsSubNode(n),p.release(n)}}},e.prototype._rebuildTree=function(e,t){var r=this;i.vec3d.set(t.center,O.center),O.radius=t.halfSize;var n=this._boundingSphereFromObjects([e,O],function(e){return e},C),a=p.acquire().init(this._root);this._root.initFrom(null,n.center,1.25*n.radius),this._forEachNode(a,function(e){return r.add(e.node.terminals.data,e.node.terminals.length),null!==e.node.residents&&r.add(e.node.residents.data,e.node.residents.length),!0}),p.release(a)},e.prototype._placingRootViolatesMaxDepth=function(e){var t=0;return this._forEachNode(this._root,function(e){return t=Math.max(t,e.depth),!0}),t+Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E>this._maximumDepth},e.prototype._rootBoundsForRootAsSubNode=function(e,t){for(var r=e.radius,i=e.center,n=-1/0,a=this._root.center,o=this._root.halfSize,s=0;s<3;s++){var u=a[s]-o-(i[s]-r),l=i[s]+r-(a[s]+o),d=Math.max(0,Math.ceil(u/(2*o))),c=Math.max(0,Math.ceil(l/(2*o)))+1,h=Math.pow(2,Math.ceil(Math.log(d+c)*Math.LOG2E));n=Math.max(n,h),M[s].min=d,M[s].max=c}for(s=0;s<3;s++){var p=(n-((d=M[s].min)+(c=M[s].max)))/2;d+=Math.ceil(p),c+=Math.floor(p);var f=a[s]-o-d*o*2;y[s]=f+(c+d)*o}return t.initFrom(null,y,n*o,0)},e.prototype._growRootAsSubNode=function(e){var t=this._root.node;i.vec3d.set(this._root.center,T.center),T.radius=this._root.halfSize,this._root.init(e),e.advanceTo(T,null,!0),e.node.children=t.children,e.node.residents=t.residents,e.node.terminals=t.terminals},e.prototype._shrink=function(){for(;;){var e=this._findShrinkIndex();if(-1===e)break;this._root.advance(e),this._root.depth=0}},e.prototype._findShrinkIndex=function(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;for(var e=null,t=this._root.node.children,r=0,i=0;i<t.length&&null==e;)e=t[r=i++];for(;i<t.length;)if(t[i++])return-1;return r},e.prototype._isDegenerate=function(e){var t=this._objectToBoundingSphere.getRadius(e);return!this._isValidRadius(t)},e.prototype._isValidRadius=function(e){return!isNaN(e)&&e!==-1/0&&e!==1/0&&e>0},e.prototype._fitsInsideTree=function(e){var t=this._root.center,r=this._root.halfSize,i=e.center;return e.radius<=r&&i[0]>=t[0]-r&&i[0]<=t[0]+r&&i[1]>=t[1]-r&&i[1]<=t[1]+r&&i[2]>=t[2]-r&&i[2]<=t[2]+r},e.prototype._boundingSphereFromObject=function(e,t){return i.vec3d.set(this._objectToBoundingSphere.getCenter(e),t.center),t.radius=this._objectToBoundingSphere.getRadius(e),t},e.prototype._boundingSphereFromObjects=function(e,t,r){if(1===e.length){var n=t(e[0],T);i.vec3d.set(n.center,r.center),r.radius=n.radius}else{b[0]=1/0,b[1]=1/0,b[2]=1/0,x[0]=-1/0,x[1]=-1/0,x[2]=-1/0;for(var s=0;s<e.length;s++){n=t(e[s],T);this._isValidRadius(n.radius)&&(a(b,n.center,n.radius),o(x,n.center,n.radius))}i.vec3d.scale(i.vec3d.add(b,x,r.center),.5),r.radius=Math.max(x[0]-b[0],x[1]-b[1],x[2]-b[2])/2}return r},e}(),p=function(){function e(e,t,r,n){void 0===r&&(r=0),void 0===n&&(n=0),this.center=i.vec3d.create(),this.initFrom(e,t,r,0)}return e.prototype.init=function(e){return this.initFrom(e.node,e.center,e.halfSize,e.depth)},e.prototype.initFrom=function(t,r,n,a){return void 0===t&&(t=null),void 0===n&&(n=this.halfSize),void 0===a&&(a=this.depth),this.node=t||e.createEmptyNode(),r&&i.vec3d.set(r,this.center),this.halfSize=n,this.depth=a,this},e.prototype.advance=function(t){var r=this.node.children[t];r||(r=e.createEmptyNode(),this.node.children[t]=r),this.node=r,this.halfSize/=2,this.depth++;var i=f[t];return this.center[0]+=i[0]*this.halfSize,this.center[1]+=i[1]*this.halfSize,this.center[2]+=i[2]*this.halfSize,this},e.prototype.advanceTo=function(e,t,r){for(void 0===r&&(r=!1);;){if(this.isTerminalFor(e))return t&&t(this,-1),!0;if(this.isLeaf()&&!r)return t&&t(this,-1),!1;this.isLeaf()&&(this.node.residents=null);var i=this._childIndex(e);t&&t(this,i),this.advance(i)}},e.prototype.isLeaf=function(){return null!=this.node.residents},e.prototype.isTerminalFor=function(e){return e.radius>this.halfSize/2},e.prototype._childIndex=function(e){for(var t=e.center,r=this.center,i=0,n=0;n<3;n++)r[n]<t[n]&&(i|=1<<n);return i},e.createEmptyNode=function(){return{children:[null,null,null,null,null,null,null,null],terminals:new r({shrink:!0}),residents:new r({shrink:!0})}},e.acquire=function(){if(0===this._pool.length)return new e;var t=this._pool[this._pool.length-1];return this._pool.length--,t},e.release=function(e){this._pool.push(e)},e._pool=[],e}();!function(e){e[e.FRONT_TO_BACK=1]="FRONT_TO_BACK",e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(c||(c={}));var f=[[-1,-1,-1],[1,-1,-1],[-1,1,-1],[1,1,-1],[-1,-1,1],[1,-1,1],[-1,1,1],[1,1,1]],g=[[-1,-1,-1],[-1,-1,1],[-1,1,-1],[-1,1,1],[1,-1,-1],[1,-1,1],[1,1,-1],[1,1,1]],m=Math.sqrt(3),v=[null],y=i.vec3d.create(),_=i.vec3d.create(),b=i.vec3d.create(),x=i.vec3d.create(),w=[],S={center:i.vec3d.create(),radius:0},T={center:i.vec3d.create(),radius:0},O={center:i.vec3d.create(),radius:0},C={center:i.vec3d.create(),radius:0},M=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],R=[],P=[];return h}.apply(null,i))||(e.exports=n)},975:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(341)],void 0===(n=function(e,t,r){function i(e,t,r){return{identifier:String.fromCharCode.apply(null,new Uint8Array(e,r+d.identifierOffset,d.identifierLength)),version:t.getUint16(r+d.versionOffset,l),checksum:t.getUint32(r+d.checksumOffset,l)}}function n(e,t){return{sizeLo:e.getUint32(t+c.sizeLo,l),sizeHi:e.getUint32(t+c.sizeHi,l),minX:e.getFloat64(t+c.minX,l),minY:e.getFloat64(t+c.minY,l),minZ:e.getFloat64(t+c.minZ,l),maxX:e.getFloat64(t+c.maxX,l),maxY:e.getFloat64(t+c.maxY,l),maxZ:e.getFloat64(t+c.maxZ,l),errorX:e.getFloat64(t+c.errorX,l),errorY:e.getFloat64(t+c.errorY,l),errorZ:e.getFloat64(t+c.errorZ,l),count:e.getUint32(t+c.count,l),reserved:e.getUint32(t+c.reserved,l)}}function a(e,t,r){var i=[];t=o(e,t,i);for(var n=[],a=0;a<i.length;a++){n.length=0,t=o(e,t,n);for(var s=0;s<n.length;s++)r.push(n[s]+i[a])}return t}function o(e,t,i){var n=new DataView(e,t),a=n.getUint8(0),o=31&a,s=!!(32&a),u=(192&a)>>6,d=0;if(0===u)d=n.getUint32(1,l),t+=5;else if(1===u)d=n.getUint16(1,l),t+=3;else{if(2!==u)throw new r("lepcc-decode-error","Bad count type");d=n.getUint8(1),t+=2}if(s)throw new r("lepcc-decode-error","LUT not implemented");for(var c=Math.ceil(d*o/8),h=new Uint8Array(e,t,c),p=0,f=0,g=0,m=-1>>>32-o,v=0;v<d;v++){for(;f<o;)p|=h[g]<<f,f+=8,g+=1;i[v]=p&m,p>>>=o,(f-=o)+o>32&&(p|=h[g-1]>>8-f)}return t+g}function s(e,t){return{sizeLo:e.getUint32(t+h.sizeLo,l),sizeHi:e.getUint32(t+h.sizeHi,l),count:e.getUint32(t+h.count,l),colorMapCount:e.getUint16(t+h.colorMapCount,l),lookupMethod:e.getUint8(t+h.lookupMethod),compressionMethod:e.getUint8(t+h.compressionMethod)}}function u(e,t){return{sizeLo:e.getUint32(t+p.sizeLo,l),sizeHi:e.getUint32(t+p.sizeHi,l),count:e.getUint32(t+p.count,l),scaleFactor:e.getUint16(t+p.scaleFactor,l),bitsPerPoint:e.getUint8(t+p.bitsPerPoint),reserved:e.getUint8(t+p.reserved)}}Object.defineProperty(t,"__esModule",{value:!0});var l=!0,d={identifierOffset:0,identifierLength:10,versionOffset:10,checksumOffset:12,byteCount:16},c={sizeLo:0,sizeHi:4,minX:8,minY:16,minZ:24,maxX:32,maxY:40,maxZ:48,errorX:56,errorY:64,errorZ:72,count:80,reserved:84,byteCount:88};t.decodeXYZ=function(e){var t=new DataView(e,0),o=0,s=i(e,t,o),u=s.identifier,l=s.version;if(o+=d.byteCount,"LEPCC     "!==u)throw new r("lepcc-decode-error","Bad identifier");if(l>1)throw new r("lepcc-decode-error","Unknown version");var h=n(t,o);if(o+=c.byteCount,h.sizeHi*Math.pow(2,32)+h.sizeLo!==e.byteLength)throw new r("lepcc-decode-error","Bad size");var p=new Float64Array(3*h.count),f=[],g=[],m=[],v=[];if(o=a(e,o,f),o=a(e,o,g),o=a(e,o,m),(o=a(e,o,v))!==e.byteLength)throw new r("lepcc-decode-error","Bad length");for(var y=0,_=0,b=0;b<f.length;b++){_+=f[b];for(var x=0,w=0;w<g[b];w++){x+=m[y];var S=v[y];p[3*y]=Math.min(h.maxX,h.minX+2*h.errorX*x),p[3*y+1]=Math.min(h.maxY,h.minY+2*h.errorY*_),p[3*y+2]=Math.min(h.maxZ,h.minZ+2*h.errorZ*S),y++}}return{errorX:h.errorX,errorY:h.errorY,errorZ:h.errorZ,result:p}};var h={sizeLo:0,sizeHi:4,count:8,colorMapCount:12,lookupMethod:14,compressionMethod:15,byteCount:16};t.decodeRGB=function(e){var t=new DataView(e,0),n=0,a=i(e,t,n),o=a.identifier,u=a.version;if(n+=d.byteCount,"ClusterRGB"!==o)throw new r("lepcc-decode-error","Bad identifier");if(u>1)throw new r("lepcc-decode-error","Unknown version");var l=s(t,n);if(n+=h.byteCount,l.sizeHi*Math.pow(2,32)+l.sizeLo!==e.byteLength)throw new r("lepcc-decode-error","Bad size");if(2!==l.lookupMethod&&1!==l.lookupMethod||0!==l.compressionMethod){if(0===l.lookupMethod&&0===l.compressionMethod){if(3*l.count+n!==e.byteLength||0!==l.colorMapCount)throw new r("lepcc-decode-error","Bad count");return new Uint8Array(e,n).slice()}if(l.lookupMethod<=2&&1===l.compressionMethod){if(n+3!==e.byteLength||1!==l.colorMapCount)throw new r("lepcc-decode-error","Bad count");for(var c=t.getUint8(n),p=t.getUint8(n+1),f=t.getUint8(n+2),g=new Uint8Array(3*l.count),m=0;m<l.count;m++)g[3*m]=c,g[3*m+1]=p,g[3*m+2]=f;return g}throw new r("lepcc-decode-error","Bad method "+l.lookupMethod+","+l.compressionMethod)}if(3*l.colorMapCount+l.count+n!==e.byteLength||l.colorMapCount>256)throw new r("lepcc-decode-error","Bad count");var v=new Uint8Array(e,n,3*l.colorMapCount),y=new Uint8Array(e,n+3*l.colorMapCount,l.count);for(g=new Uint8Array(3*l.count),m=0;m<l.count;m++){var _=y[m];g[3*m]=v[3*_],g[3*m+1]=v[3*_+1],g[3*m+2]=v[3*_+2]}return g};var p={sizeLo:0,sizeHi:4,count:8,scaleFactor:12,bitsPerPoint:14,reserved:15,byteCount:16};t.decodeIntensity=function(e){var t=new DataView(e,0),n=0,a=i(e,t,n),s=a.identifier,l=a.version;if(n+=d.byteCount,"Intensity "!==s)throw new r("lepcc-decode-error","Bad identifier");if(l>1)throw new r("lepcc-decode-error","Unknown version");var c=u(t,n);if(n+=p.byteCount,c.sizeHi*Math.pow(2,32)+c.sizeLo!==e.byteLength)throw new r("lepcc-decode-error","Bad size");var h=new Uint16Array(c.count);if(8===c.bitsPerPoint){if(c.count+n!==e.byteLength)throw new r("lepcc-decode-error","Bad size");for(var f=new Uint8Array(e,n,c.count),g=0;g<c.count;g++)h[g]=f[g]*c.scaleFactor}else if(16===c.bitsPerPoint){if(2*c.count+n!==e.byteLength)throw new r("lepcc-decode-error","Bad size");for(f=new Uint16Array(e,n,c.count),g=0;g<c.count;g++)h[g]=f[g]*c.scaleFactor}else{if(o(e,n,f=[])!==e.byteLength)throw new r("lepcc-decode-error","Bad size");for(g=0;g<c.count;g++)h[g]=f[g]*c.scaleFactor}return h}}.apply(null,i))||(e.exports=n)}}]);