(function(){(this||window).webpackJsonp.registerAbsMids({"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/tasks/operations/urlUtils":403,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/tasks/operations/query":627,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/tasks/operations/pbfQueryUtils":628,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/tasks/operations/pbfFeatureServiceParser":629,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/geometry/support/quantizationUtils":758,"esri/views/2d/layers/features/support/Tile":1422,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/2d/layers/features/support/Tile":1422,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/2d/layers/features/controllers/OnDemandController":1647,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/2d/layers/features/support/DataTile":2337,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/2d/layers/features/support/DataTileFeaturesIndex":2338,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/SetPool":2339})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[89],{1422:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(587),r(737),r(367),r(1084),r(441)],void 0===(i=function(e,t,r,n,i,s,a){function o(e,t){var r=e.bounds,n=t.bounds;return e.key.id!==t.key.id&&e.key.world===t.key.world&&r[0]<=n[0]&&r[1]<=n[1]&&r[2]>=n[2]&&r[3]>=n[3]}Object.defineProperty(t,"__esModule",{value:!0}),t.isParentOf=o,t.isChildOf=function(e,t){return o(t,e)};var u=function(){function e(e,t){this.bounds=i.create(),this.key=new a(0,0,0,0),this.objectIds=new r.default,this.key.set(t);var n=e.getLODInfoAt(this.key);this.tileInfoView=e,this.tileInfoView.getTileBounds(this.bounds,this.key,!0),this.resolution=n.resolution,this.scale=n.scale,this.needsClear=!0}return Object.defineProperty(e.prototype,"id",{get:function(){return this.key.id},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this.tileInfoView,this.id)},e.prototype.createChildTiles=function(){for(var t=this.key.getChildKeys(),r=n.acquire(),i=0;i<t.length;i++)r[i]=new e(this.tileInfoView,t[i]);return r},e.prototype.getQuantizationParameters=function(){return s.default.fromJSON({mode:"view",originPosition:"upperLeft",tolerance:this.resolution,extent:{xmin:this.bounds[0],ymin:this.bounds[1],xmax:this.bounds[2],ymax:this.bounds[3],spatialReference:this.tileInfoView.tileInfo.spatialReference}})},e}();t.Tile=u,t.default=u}.apply(null,n))||(e.exports=i)},1647:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(337),r(335),r(344),r(587),r(364),r(341),r(353),r(343),r(339),r(793),r(336),r(1024),r(1377),r(1424),r(652),r(627),r(1084),r(419),r(1427),r(2337),r(2338),r(1422),r(1645),r(749),r(863)],void 0===(i=function(e,t,r,n,i,s,a,o,u,l,d,c,f,p,h,y,g,m,v,T,_,b,x,I,F,w,q){Object.defineProperty(t,"__esModule",{value:!0});var k=l.getLogger("esri.views.2d.layers.features.controllers.OnDemandController"),j=u("esri-featurelayer-webgl"),E=u("esri-mobile"),P={maxDrillLevel:j&&"object"==typeof j&&null!=j.maxDrillLevel?j.maxDrillLevel:E?1:4,maxRecordCountFactor:j&&"object"==typeof j&&null!=j.maxRecordCountFactor?j.maxRecordCountFactor:E?1:3,enablePBFQuery:!j||"object"!=typeof j||null==j.enablePBFQuery||j.enablePBFQuery},O=new s.default,Q=[],S=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="on-demand",t._queryInfoHash=null,t._processingInMainThread=!1,t._dataTileIndex=new x.default,t._editsQueue=new c({concurrency:1,ordered:!0,process:function(e){return t._processEditsEvent(e)}}),t}return r(t,e),t.prototype.initialize=function(){var e=this;this._fetchQueue=new q({concurrency:10,strategy:"center-first",tileInfoView:new w(this.tileStore.tileInfo),process:function(t){return e._fetchTile(t)}}),this._updateQueue=new F.default({tileInfoView:new w(this.tileStore.tileInfo),process:function(t,r){return e._updateTile(t,r)}}),this.handles.add(this.watch("processor",this._switchProcessor.bind(this)))},t.prototype.destroy=function(){this._fetchQueue.clear(),this._updateQueue.clear(),this.queryEngine&&(this.queryEngine.destroy(),this._set("queryEngine",null))},Object.defineProperty(t.prototype,"processing",{get:function(){return g.fromWorker(this.configuration.processing)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return this._fetchQueue.updating||this._updateQueue.updating},enumerable:!0,configurable:!0}),t.prototype.onEdits=function(e){var t=this;this._fetchQueue.pause(),this._fetchQueue.reset(),this._editsQueue.push(e).then(function(){0===t._editsQueue.length&&t._fetchQueue.resume()})},t.prototype.queryFeatures=function(e){return this.queryEngine.executeQuery(T.fromJSON(e))},t.prototype.queryFeatureCount=function(e){return this.queryEngine.executeQueryForCount(T.fromJSON(e))},t.prototype.queryObjectIds=function(e){return this.queryEngine.executeQueryForIds(T.fromJSON(e))},t.prototype.queryExtent=function(e){return this.queryEngine.executeQueryForExtent(T.fromJSON(e))},t.prototype.redraw=function(){this._updateQueue.pause(),this._manageTiles(this.tileStore.tiles),this._updateQueue.resume()},t.prototype.refresh=function(){},t.prototype.setViewState=function(e){this._fetchQueue.state=e,this._updateQueue.state=e},t.prototype.onTileUpdate=function(e){this.queryEngine&&this._manageTiles(e.added,e.removed)},t.prototype._manageTiles=function(e,t){void 0===t&&(t=null);for(var r=this._dataTileIndex,n=this._fetchQueue,i=this._updateQueue,s="esriGeometryPoint"===this.service.geometryType,a=this,o=0,u=e;o<u.length;o++){!function(e){var t=r.get(e.id);t?(t.displayTile=e,s?r.forEach(function(r){I.isChildOf(r,t)&&(r.displayTile=e)}):t.done=!1):((t=new b.default).tile=e.clone(),t.displayTile=e,r.add(t)),a._processDataTile(t)}(c=u[o])}if(t)for(var l=0,d=t;l<d.length;l++){var c=d[l];O.add(c),i.cancel(c.id)}r.forEach(function(e){O.has(e.displayTile)&&Q.push(e)});for(var f=0,p=Q;f<p.length;f++){var h=p[f];n.has(h.id)&&n.getPromise(h.id).cancel(),r.delete(h)}Q.length=0,O.clear()},t.prototype._processDataTile=function(e){var t=this,r=e.displayTile,n=e.key,i=this._dataTileIndex,s=this._fetchQueue,a=n.id,u=this._queryInfoHash,l=n.level-r.key.level>=P.maxDrillLevel;if(i.add(e),e.done||s.has(a)){if(e.queryInfoHash!==u||e.returnExceeded!==l)if(e.done)e.done=!1;else{if(!s.isOngoing(a))return e.queryInfoHash=u,void(e.returnExceeded=l);s.getPromise(a).cancel()}}else e.queryInfoHash=u,e.returnExceeded=l;e.done?this._invalidateTile(e.displayTile):s.has(a)||s.push(e).then(function(r){return t._handleResponse(e,r)}).catch(function(t){"cancel"!==t.dojoType&&k.error(new o("mapview-controller","Encountered an error when handling tile response",t)),e.done=!0})},t.prototype._handleResponse=function(e,t){if(e.done=!0,p.hydrateOptimizedFeatureSet(t),t.exceededTransferLimit)if(e.returnExceeded)this._dataTileIndex.setTileFeatures(e,t.features),this._deleteChildrenDataTiles(e);else for(var r=0,n=e.tile.createChildTiles();r<n.length;r++){var i=n[r],s=new b.default;s.tile=i,s.displayTile=e.displayTile,this._processDataTile(s)}else this._dataTileIndex.setTileFeatures(e,t.features),this._deleteChildrenDataTiles(e);this._invalidateTile(e.tile)},t.prototype._deleteChildrenDataTiles=function(e){this._dataTileIndex.forEach(function(t){I.isChildOf(t,e)&&Q.push(t)});for(var t=0,r=Q;t<r.length;t++){var n=r[t];this._fetchQueue.has(n.id)&&this._fetchQueue.getPromise(n.id).cancel(),this._dataTileIndex.delete(n)}Q.length=0},t.prototype._fetchTile=function(e){var t=this,r=this._createQuery(e.displayTile,e.tile,e.returnExceeded),n=this.service.source;return P.enablePBFQuery&&this.service.capabilities.query.supportsFormatPBF?m.executeQueryPBF(n,r).then(function(e){return e.data}):m.executeQuery(n,r).then(function(e){return p.convertFromFeatureSet(e.data,t.service.objectIdField)})},t.prototype._invalidateTile=function(e){for(var t=this._updateQueue,r=0,n=this.tileStore.intersections(e,this.processor.queryInfo.pixelBuffer);r<n.length;r++){var i=n[r].tile;t.push(i.id,i.updateTimestamp)}},t.prototype._updateTile=function(e,t){var r=this,n=this.tileStore.get(e),i=this.processor.queryInfo,s=i.returnCentroid,a=i.returnGeometry,o=i.pixelBuffer,u=this.queryEngine.executeTileQuery(n,{pixelBuffer:o,returnGeometry:a,returnCentroid:s}),l=u.features,d=u.objectIds,c={features:l,fields:this.service.fields,objectIdFieldName:this.service.objectIdField,transform:{originPosition:"upperLeft",scale:[n.resolution,n.resolution],translate:[n.bounds[0],n.bounds[3]]}};return this._applyProcessing(c).catch(function(e){return e&&"cancel"!==e.dojoType&&k.error("updating-tile",e),c}).then(function(e){var i=[],s=!0;return r._dataTileIndex.forEach(function(e){n.id!==e.id&&I.isChildOf(e,n)&&s&&!e.done&&(s=!1)}),s&&n&&n.objectIds.forEach(function(e){d.has(e)||i.push(e)}),d.forEach(function(e){n.objectIds.add(e)}),n.updateTimestamp=t,r.processor.onTileData(n,{addOrUpdate:e.features,remove:i}).catch(function(e){e&&"cancel"!==e.dojoType&&k.error("updating-tile",e)})})},t.prototype._processEditsEvent=function(e){var t=this;return d.create(function(r,n){var i=function(e){return e.objectId},s=e.deletedFeatures.map(i),a=t._dataTileIndex.deleteFeaturesById(s),o=e.addedFeatures.concat(e.updatedFeatures).map(i);if(o.length){var u=t.service.source,l=t._createObjectIdsQuery(o);m.executeQuery(u,l).then(function(e){var r=e.data;if(r&&r.features&&r.features.length){var n=p.convertFromFeatureSet(r,t.service.objectIdField).features;a.push.apply(a,t._dataTileIndex.addOrUpdateFeatures(n));for(var i=0,s=a;i<s.length;i++){var o=s[i];t._invalidateTile(o.tile)}}}).then(r,r)}else{for(var d=0,c=a;d<c.length;d++){var f=c[d];t._invalidateTile(f.tile)}r()}})},t.prototype._switchProcessor=function(e,t){var r=e.queryInfo,n=r.definitionExpression,i=r.gdbVersion,s=r.historicMoment,a=this._createQueryInfoHash(e);this._queryInfoHash!==a&&(this._queryInfoHash=a,this.queryEngine&&this.queryEngine.destroy(),this.spatialIndex&&this.spatialIndex.clear(),this._set("spatialIndex",new h.default({geometryType:this.service.geometryType,hasM:!1,hasZ:!1})),this._set("queryEngine",new y.default({definitionExpression:n,fields:this.service.fields,geometryType:this.service.geometryType,objectIdField:this.service.objectIdField,hasM:!1,hasZ:!1,spatialReference:this.spatialReference,cacheSpatialQueries:!0,gdbVersion:i,historicMoment:null!=s&&new Date(s),spatialIndex:this.spatialIndex})),this._dataTileIndex.spatialIndex=this.spatialIndex,this._dataTileIndex.forEach(function(e){e.done=!1})),this._editsQueue.pause(),this._fetchQueue.pause(),this._updateQueue.pause(),this._editsQueue.clear(),this._fetchQueue.reset(),this._updateQueue.clear(),this._manageTiles(this.tileStore.tiles),this._fetchQueue.resume(),this._editsQueue.resume(),this._updateQueue.resume()},t.prototype._createQuery=function(e,t,r){void 0===r&&(r=!0);var n=this.service.geometryType,i=this._createDefaultQuery(),s="esriGeometryPoint"===this.service.geometryType?t:e;return i.maxRecordCountFactor=P.maxRecordCountFactor,i.resultType="tile",i.returnExceededLimitFeatures=r,i.geometry=a.Extent.fromJSON({xmin:t.bounds[0],ymin:t.bounds[1],xmax:t.bounds[2],ymax:t.bounds[3],spatialReference:this.spatialReference}),this.service.capabilities.query.supportsQuantization?(i.quantizationParameters=v.default.fromJSON({mode:"view",originPosition:"upperLeft",tolerance:s.resolution,extent:{xmin:s.bounds[0],ymin:s.bounds[1],xmax:s.bounds[2],ymax:s.bounds[3],spatialReference:this.spatialReference}}),"esriGeometryPolyline"===n&&(i.maxAllowableOffset=s.resolution)):"esriGeometryPolyline"!==n&&"esriGeometryPolygon"!==n||(i.maxAllowableOffset=s.resolution),i},t.prototype._createObjectIdsQuery=function(e){var t=this._createDefaultQuery();return t.objectIds=e,t},t.prototype._createDefaultQuery=function(){var e=this,t=this.processor.queryInfo,r=new T;r.outSpatialReference=a.SpatialReference.fromJSON(this.spatialReference);var n=t.outFields,i=t.orderByFields;return this.processing&&(n=n&&n.filter(function(t){return!e.processing.getField(t)}),i=i&&i.filter(function(t){return!e.processing.getField(t)})),n=n.length/this.service.fields.length>=.75?["*"]:n,r.gdbVersion=t.gdbVersion,r.historicMoment=null!=t.historicMoment?new Date(t.historicMoment):null,r.outFields=n,r.where=t.definitionExpression||"1=1",r.returnGeometry=!0,r.returnCentroid=t.returnCentroid,r.orderByFields=i,r},t.prototype._applyProcessing=function(e){var t=this.processing;if(!t)return d.resolve(e);if(this._processingInMainThread)return this.remoteClient.invoke("executeProcessing",{featureSet:e});try{var r=t.process(e,t.options);return r?"then"in r?r:d.resolve(r):d.reject(new o("FeatureLayer","invalid processing.process() method, returns nothing"))}catch(t){return this._processingInMainThread=!0,this.remoteClient.invoke("executeProcessing",{featureSet:e})}},t.prototype._createQueryInfoHash=function(e){var t=this,r=e.queryInfo,n=r.orderByFields,i=r.outFields,s=e.queryInfo,a=s.definitionExpression,o=s.gdbVersion,u=s.historicMoment;return this.processing&&(i=i&&i.filter(function(e){return!t.processing.getField(e)}),n=n&&n.filter(function(e){return!t.processing.getField(e)})),i&&i.sort(),n&&n.sort(),JSON.stringify({definitionExpression:a,outFields:i.length/this.service.fields.length>=.75?["*"]:i,orderByFields:n,gdbVersion:o,historicMoment:u})},n([f.property()],t.prototype,"_fetchQueue",void 0),n([f.property()],t.prototype,"_updateQueue",void 0),n([f.property()],t.prototype,"configuration",void 0),n([f.property({readOnly:!0,dependsOn:["configuration"]})],t.prototype,"processing",null),n([f.property({readOnly:!0})],t.prototype,"queryEngine",void 0),n([f.property({readOnly:!0})],t.prototype,"spatialIndex",void 0),n([f.property({dependsOn:["_fetchQueue.updating","_updateQueue.updating"]})],t.prototype,"updating",null),n([f.subclass()],t)}(f.declared(_.default));t.default=S}.apply(null,n))||(e.exports=i)},2337:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this.displayTile=null,this.tile=null,this.done=!1,this.queryInfoHash=null,this.returnExceeded=!1}return Object.defineProperty(e.prototype,"key",{get:function(){return this.tile.key},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.tile.id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bounds",{get:function(){return this.tile.bounds},enumerable:!0,configurable:!0}),e}();t.default=r}.apply(null,n))||(e.exports=i)},2338:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(705),r(587),r(2339),r(1377),r(1422)],void 0===(i=function(e,t,r,n,i,s,a){Object.defineProperty(t,"__esModule",{value:!0});var o=[],u=new n.default,l=function(){function e(){this._tileById=new r.default,this._tilesToFeatures=new r.default,this._featureToTiles=new r.default}return e.prototype.destroy=function(){this.clear()},e.prototype.add=function(e){var t=this;if(!this.has(e.id)){var r=e;this._tileById.set(r.id,r),this._tilesToFeatures.set(r,i.default.acquire()),this._tilesToFeatures.forEach(function(e,n){r!==n&&(a.isParentOf(r,n)?e.forEach(function(e){t._link(r,e)}):a.isChildOf(r,n)&&t.spatialIndex.forEachFeatureInBounds(r.bounds,function(n){e.has(n.objectId)&&t._link(r,n.objectId)}))})}},e.prototype.clear=function(){this._tilesToFeatures.forEach(function(e){return i.default.release(e)}),this._tilesToFeatures.clear(),this._featureToTiles.forEach(function(e){return i.default.release(e)}),this._featureToTiles.clear(),this._tileById.clear()},e.prototype.delete=function(e){var t=this,r=this.get(e.id);o.length=0,this._tilesToFeatures.get(r).forEach(function(e){var n=t._featureToTiles.get(e);n.has(r)&&1===n.size?o.push(e):t._unlink(r,e)});for(var n=0,i=o;n<i.length;n++){var s=i[n];this._unlink(r,s)}this.spatialIndex.removeManyById(o),this._tilesToFeatures.delete(r),this._tileById.delete(r.id),o.length=0},e.prototype.forEach=function(e,t){return this._tileById.forEach(e,t)},e.prototype.get=function(e){return this._tileById.get(e)},e.prototype.has=function(e){return this._tileById.has(e)},e.prototype.setTileFeatures=function(e,t){var r=this,n=this.get(e.id);this._tilesToFeatures.has(n)||(this._tileById.set(n.id,n),this._tilesToFeatures.set(n,i.default.acquire()));for(var s=0,a=t;s<a.length;s++){var l=a[s];u.add(l.objectId)}o.length=0,this._tilesToFeatures.get(n).forEach(function(e){if(!u.has(e)){var t=r._featureToTiles.get(e);t.has(n)&&1===t.size?o.push(e):r._unlink(n,e)}});for(var d=0,c=o;d<c.length;d++){var f=c[d];this._unlink(n,f)}this.spatialIndex.removeManyById(o),this.spatialIndex.addMany(t),u.forEach(function(e){r._link(n,e)}),u.clear(),o.length=0},e.prototype.addOrUpdateFeatures=function(e){for(var t=this,r=new n.default,i=new s.default({geometryType:this.spatialIndex.geometryType,hasM:this.spatialIndex.hasM,hasZ:this.spatialIndex.hasZ}),a=0,o=this.deleteFeaturesById(e.map(function(e){return e.objectId}));a<o.length;a++){var u=o[a];r.add(u)}i.addMany(e),this._tileById.forEach(function(e){i.forEachFeatureInBounds(e.bounds,function(n){t._link(e,n.objectId),r.add(e)})}),this.spatialIndex.addMany(e);var l=[];return r.forEach(function(e){return l.push(e)}),l},e.prototype.deleteFeaturesById=function(e){for(var t=this,r=new n.default,s=this,a=0,o=e;a<o.length;a++){!function(e){var n=s._featureToTiles.get(e);n&&(n.forEach(function(n){r.add(n),t._tilesToFeatures.get(n).delete(e)}),i.default.release(n),s._featureToTiles.delete(e))}(o[a])}this.spatialIndex.removeManyById(e);var u=[];return r.forEach(function(e){return u.push(e)}),u},e.prototype._link=function(e,t){this._featureToTiles.get(t)||this._featureToTiles.set(t,i.default.acquire()),this._featureToTiles.get(t).add(e),this._tilesToFeatures.get(e).add(t)},e.prototype._unlink=function(e,t){this._featureToTiles.get(t).delete(e),this._tilesToFeatures.get(e).delete(t),0===this._featureToTiles.get(t).size&&(i.default.release(this._featureToTiles.get(t)),this._featureToTiles.delete(t))},e}();t.default=l}.apply(null,n))||(e.exports=i)},2339:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(587)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this._pool=[],this._set=new r.default}return e.prototype.acquire=function(){if(0===this._pool.length)return new r.default;var e=this._pool.pop();return this._set.delete(e),e},e.prototype.release=function(e){e&&!this._set.has(e)&&(e.clear(),this._pool.length<5e4&&(this._pool.push(e),this._set.add(e)))},e.acquire=function(){return i.acquire()},e.release=function(e){return i.release(e)},e}();t.default=n;var i=new n}.apply(null,n))||(e.exports=i)},403:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.mapParameters=function e(t){var r={};for(var n in t)if("declaredClass"!==n){var i=t[n];if(null!=i&&"function"!=typeof i)if(Array.isArray(i)){r[n]=[];for(var s=0;s<i.length;s++)r[n][s]=e(i[s])}else"object"==typeof i?i.toJSON&&(r[n]=JSON.stringify(i)):r[n]=i}return r}}.apply(null,n))||(e.exports=i)},627:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(344),r(350),r(349),r(422),r(626),r(628),r(403)],void 0===(i=function(e,t,r,n,i,s,a,o,u){function l(e,t){var r=e.geometry,n=e.toJSON(),i=n;if(r&&(i.geometry=JSON.stringify(r),i.geometryType=s.getJsonType(r),i.inSR=r.spatialReference.wkid||JSON.stringify(r.spatialReference)),n.groupByFieldsForStatistics&&(i.groupByFieldsForStatistics=n.groupByFieldsForStatistics.join(",")),n.objectIds&&(i.objectIds=n.objectIds.join(",")),n.orderByFields&&(i.orderByFields=n.orderByFields.join(",")),!n.outFields||t&&(t.returnCountOnly||t.returnExtentOnly||t.returnIdsOnly)?delete i.outFields:-1!==n.outFields.indexOf("*")?i.outFields="*":i.outFields=n.outFields.join(","),n.outSR?i.outSR=n.outSR.wkid||JSON.stringify(n.outSR):r&&(n.returnGeometry||n.returnCentroid)&&(i.outSR=i.inSR),n.returnGeometry&&delete n.returnGeometry,n.outStatistics&&(i.outStatistics=JSON.stringify(n.outStatistics)),n.pixelSize&&(i.pixelSize=JSON.stringify(n.pixelSize)),n.quantizationParameters&&(i.quantizationParameters=JSON.stringify(n.quantizationParameters)),n.source&&(i.layer=JSON.stringify({source:n.source}),delete n.source),n.timeExtent){var a=n.timeExtent;i.time=[null!=a.startTime?a.startTime:"null",null!=a.endTime?a.endTime:"null"],delete n.timeExtent}return i}function d(e,t,s,o,d){void 0===o&&(o={});var c="string"==typeof e?i.urlToObject(e):e,f=t.geometry?[t.geometry]:[];return o.responseType="pbf"===s?"array-buffer":"json",a.normalizeCentralMeridian(f,null,o).then(function(e){var i=e&&e[0];i&&((t=t.clone()).geometry=i);var a=u.mapParameters(r({},c.query,{f:s},d,l(t,d)));return n(c.path+"/query",r({},o,{query:a}))})}Object.defineProperty(t,"__esModule",{value:!0});var c="Layer does not support extent calculation.";t.queryToQueryStringParameters=l,t.executeQuery=function(e,t,r){return d(e,t,"json",r)},t.executeQueryPBF=function(e,t,r){return d(e,t,"pbf",r).then(function(e){var t=o.parsePBFFeatureQuery(e.data),r=e;return r.data=t,r})},t.executeQueryForIds=function(e,t,r){return d(e,t,"json",r,{returnIdsOnly:!0})},t.executeQueryForCount=function(e,t,r){return d(e,t,"json",r,{returnIdsOnly:!0,returnCountOnly:!0})},t.executeQueryForExtent=function(e,t,r){return d(e,t,"json",r,{returnExtentOnly:!0,returnCountOnly:!0}).then(function(e){var t=e.data;if(t.hasOwnProperty("extent"))return e;if(t.features)throw new Error(c);if(t.hasOwnProperty("count"))throw new Error(c);return e})}}.apply(null,n))||(e.exports=i)},628:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(341),r(343),r(425),r(629)],void 0===(i=function(e,t,r,n,i,s){Object.defineProperty(t,"__esModule",{value:!0});var a=n.getLogger("esri.tasks.operations.pbfQueryUtils");t.parsePBFFeatureQuery=function(e){try{var t=s.parseFeatureQuery(e).queryResult.featureResult;if(t&&t.features&&t.features.length&&t.objectIdFieldName)for(var n=t.objectIdFieldName,o=0,u=t.features;o<u.length;o++){var l=u[o];l.attributes&&(l.objectId=l.attributes[n])}return t}catch(e){var d=new r("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:e});return a.error(d),new i.default}}}.apply(null,n))||(e.exports=i)},629:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(593),r(603),r(425),r(595)],void 0===(i=function(e,t,r,n,i,s){function a(e){return e>=x.length?null:x[e]}function o(e){return e>=I.length?null:I[e]}function u(e){return e>=w.length?null:w[e]}function l(e){return e>=F.length?null:F[e]}function d(e){for(var t=new s.default,r=t.coords;e.next();)switch(e.tag()){case 3:for(var n=e.getUInt32(),i=e.pos()+n,a=0;e.pos()<i;)r[a++]=e.getSInt64();break;case 1:case 2:default:e.skip()}return t}function c(e){for(var t=new s.default,r=t.coords,n=t.lengths;e.next();)switch(e.tag()){case 2:for(var i=e.getUInt32(),a=e.pos()+i;e.pos()<a;)n.push(e.getUInt32());break;case 3:for(var o=e.getUInt32(),u=(a=e.pos()+o,0);e.pos()<a;)r[u++]=e.getSInt64();break;case 1:default:e.skip()}return t}function f(e){for(;e.next();)switch(e.tag()){case 1:return e.getString();case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getSInt32();case 5:return e.getUInt32();case 6:return e.getInt64();case 7:return e.getUInt64();case 8:return e.getSInt64();case 9:return e.getBool();default:return e.skip(),null}return null}function p(e){for(var t={type:a(0)};e.next();)switch(e.tag()){case 1:t.name=e.getString();break;case 2:t.type=a(e.getEnum());break;case 3:t.alias=e.getString();break;case 4:t.sqlType=o(e.getEnum());break;case 5:case 6:default:e.skip()}return t}function h(e,t){for(var r=new n.default,i=0;e.next();)switch(e.tag()){case 1:var s=e.getMessage(),a=t[i++].name;r.attributes[a]=f(s);break;case 2:r.geometry=c(e.getMessage());break;case 4:r.centroid=d(e.getMessage());break;default:e.skip()}return r}function y(e){for(var t=[0,0];e.next();)switch(e.tag()){case 1:t[0]=e.getDouble();break;case 2:t[1]=e.getDouble();break;case 3:case 4:t.push(e.getDouble());break;default:e.skip()}return t}function g(e){for(var t=[0,0];e.next();)switch(e.tag()){case 1:t[0]=e.getDouble();break;case 2:t[1]=e.getDouble();break;case 3:case 4:t.push(e.getDouble());break;default:e.skip()}return t}function m(e){for(var t={originPosition:u(0)};e.next();)switch(e.tag()){case 1:t.originPosition=u(e.getEnum());break;case 2:t.scale=y(e.getMessage());break;case 3:t.translate=g(e.getMessage());break;default:e.skip()}return t}function v(e){for(var t={};e.next();)switch(e.tag()){case 1:t.shapeAreaFieldName=e.getString();break;case 2:t.shapeLengthFieldName=e.getString();break;case 3:t.units=e.getString();break;default:e.skip()}return t}function T(e){for(var t={};e.next();)switch(e.tag()){case 1:t.wkid=e.getUInt32();break;case 5:t.wkt=e.getString();break;case 2:case 3:case 4:default:e.skip()}return t}function _(e){var t=new i.default;for(t.geometryType=l(0);e.next();)switch(e.tag()){case 1:t.objectIdFieldName=e.getString();break;case 3:t.globalIdFieldName=e.getString();break;case 4:t.geohashFieldName=e.getString();break;case 5:t.geometryProperties=v(e.getMessage());break;case 7:t.geometryType=l(e.getEnum());break;case 8:t.spatialReference=T(e.getMessage());break;case 10:t.hasZ=e.getBool();break;case 11:t.hasM=e.getBool();break;case 12:var r=e.getMessage();t.transform=m(r);break;case 9:var n=e.getBool();t.exceededTransferLimit=n;break;case 13:var s=e.getMessage();t.fields.push(p(s));break;case 15:var a=e.getMessage();t.features.push(h(a,t.fields));break;case 2:case 6:default:e.skip()}return t}function b(e){for(var t={};e.next();)switch(e.tag()){case 1:t.featureResult=_(e.getMessage());break;default:e.skip()}return t}Object.defineProperty(t,"__esModule",{value:!0});var x=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML"],I=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],F=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"],w=["upperLeft","lowerLeft"];t.parseFeatureQuery=function(e){for(var t=new r(new Uint8Array(e),new DataView(e)),n={};t.next();)switch(t.tag()){case 2:n.queryResult=b(t.getMessage());break;default:t.skip()}return n}}.apply(null,n))||(e.exports=i)},758:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(e){return e&&"upperLeft"===e.originPosition}function n(e,t){var r=e.scale,n=e.translate;return Math.round((t-n[0])/r[0])}function i(e,t){var r=e.scale,n=e.translate;return Math.round((n[1]-t)/r[1])}function s(e,t,r){for(var s,a,o,u,l=[],d=0;d<r.length;d++){var c=r[d];d>0?(o=n(e,c[0]),u=i(e,c[1]),o===s&&u===a||(l.push(t(c,o-s,u-a)),s=o,a=u)):(s=n(e,c[0]),a=i(e,c[1]),l.push(t(c,s,a)))}return l.length>0?l:null}function a(e,t,r,n){return s(e,r?n?_:T:n?T:v,t)}function o(e,t,r,n){for(var i=[],a=r?n?_:T:n?T:v,o=0;o<t.length;o++){var u=s(e,a,t[o]);u&&u.length>=3&&i.push(u)}return i.length?i:null}function u(e,t,r,n){for(var i=[],a=r?n?_:T:n?T:v,o=0;o<t.length;o++){var u=s(e,a,t[o]);u&&u.length>=2&&i.push(u)}return i.length?i:null}function l(e,t){var r=e.scale,n=e.translate;return t*r[0]+n[0]}function d(e,t){var r=e.scale;return e.translate[1]-t*r[1]}function c(e,t,r){var n=new Array(r.length);if(!r.length)return n;var i=e.scale,s=i[0],a=i[1],o=l(e,r[0][0]),u=d(e,r[0][1]);n[0]=t(r[0],o,u);for(var c=1;c<r.length;c++){var f=r[c];o+=f[0]*s,u-=f[1]*a,n[c]=t(f,o,u)}return n}function f(e,t,r){for(var n=new Array(r.length),i=0;i<r.length;i++)n[i]=c(e,t,r[i]);return n}function p(e,t,r,n){return c(e,r?n?_:T:n?T:v,t)}function h(e,t,r,n){return f(e,r?n?_:T:n?T:v,t)}function y(e,t,r,n){return f(e,r?n?_:T:n?T:v,t)}function g(e,t,r){for(var n=r[0],i=n[0],s=n[1],a=Math.min(i,t[0]),o=Math.min(s,t[1]),u=Math.max(i,t[2]),l=Math.max(s,t[3]),d=1;d<r.length;d++){var c=r[d],f=c[0],p=c[1];i+=f,s+=p,f<0&&(a=Math.min(a,i)),f>0&&(u=Math.max(u,i)),p<0?o=Math.min(o,s):p>0&&(l=Math.max(l,s))}return e[0]=a,e[1]=o,e[2]=u,e[3]=l,e}function m(e,t){if(!t.length)return null;e[0]=e[1]=Number.POSITIVE_INFINITY,e[2]=e[3]=Number.NEGATIVE_INFINITY;for(var r=0;r<t.length;r++)g(e,e,t[r]);return e}Object.defineProperty(t,"__esModule",{value:!0});var v=function(e,t,r){return[t,r]},T=function(e,t,r){return[t,r,e[2]]},_=function(e,t,r){return[t,r,e[2],e[3]]};t.toTransform=function(e){return e?{originPosition:"upperLeft",scale:[e.tolerance,e.tolerance],translate:[e.extent.xmin,e.extent.ymax]}:null},t.equals=function(e,t){return e===t||null==e&&null==t||null!=e&&null!=t&&(r(e)?(n=e.translate[0],i=e.translate[1],s=e.scale[0]):(n=e.extent.xmin,i=e.extent.ymax,s=e.tolerance),r(t)?(a=t.translate[0],o=t.translate[1],u=t.scale[0]):(a=t.extent.xmin,o=t.extent.ymax,u=t.tolerance),n===a&&i===o&&s===u);var n,i,s,a,o,u},t.quantizeX=n,t.quantizeY=i,t.quantizeBounds=function(e,t,r){return t[0]=n(e,r[0]),t[3]=i(e,r[1]),t[2]=n(e,r[2]),t[1]=i(e,r[3]),t},t.quantizePoints=a,t.quantizeRings=o,t.quantizePaths=u,t.hydrateX=l,t.hydrateY=d,t.hydrateCoordsArray=c,t.hydrateCoordsArrayArray=f,t.hydrateBounds=function(e,t,r){return r?(t[0]=l(e,r[0]),t[1]=d(e,r[3]),t[2]=l(e,r[2]),t[3]=d(e,r[1]),t):[l(e,t[0]),d(e,t[3]),l(e,t[2]),d(e,t[1])]},t.hydratePoints=p,t.hydratePaths=h,t.hydrateRings=y,t.getQuantizedBoundsCoordsArray=g,t.getQuantizedBoundsCoordsArrayArray=m,t.getQuantizedBoundsPoints=function(e){var t=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];return g(t,t,e)},t.getQuantizedBoundsPaths=function(e){return m([0,0,0,0],e)},t.getQuantizedBoundsRings=function(e){return m([0,0,0,0],e)},t.quantizeExtent=function(e,t,r,s,a){return t.xmin=n(e,r.xmin),t.ymin=i(e,r.ymin),t.xmax=n(e,r.xmax),t.ymax=i(e,r.ymax),t!==r&&(s&&(t.zmin=r.zmin,t.zmax=r.zmax),a&&(t.mmin=r.mmin,t.mmax=r.mmax)),t},t.quantizeMultipoint=function(e,t,r,n,i){return t.points=a(e,r.points,n,i),t},t.quantizePoint=function(e,t,r,s,a){return t.x=n(e,r.x),t.y=i(e,r.y),t!==r&&(s&&(t.z=r.z),a&&(t.m=r.m)),t},t.quantizePolygon=function(e,t,r,n,i){var s=o(e,r.rings,n,i);return s?(t.rings=s,t):null},t.quantizePolyline=function(e,t,r,n,i){var s=u(e,r.paths,n,i);return s?(t.paths=s,t):null},t.hydrateExtent=function(e,t,r,n,i){return t.xmin=l(e,r.xmin),t.ymin=d(e,r.ymin),t.xmax=l(e,r.xmax),t.ymax=d(e,r.ymax),t!==r&&(n&&(t.zmin=r.zmin,t.zmax=r.zmax),i&&(t.mmin=r.mmin,t.mmax=r.mmax)),t},t.hydrateMultipoint=function(e,t,r,n,i){return t.points=p(e,r.points,n,i),t},t.hydratePoint=function(e,t,r,n,i){return t.x=l(e,r.x),t.y=d(e,r.y),t!==r&&(n&&(t.z=r.z),i&&(t.m=r.m)),t},t.hydratePolygon=function(e,t,r,n,i){return t.rings=y(e,r.rings,n,i),t},t.hydratePolyline=function(e,t,r,n,i){return t.paths=h(e,r.paths,n,i),t}}.apply(null,n))||(e.exports=i)}}]);