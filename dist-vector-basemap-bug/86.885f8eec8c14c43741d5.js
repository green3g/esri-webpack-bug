(function(){(this||window).webpackJsonp.registerAbsMids({"esri/layers/support/TileInfo":452,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/support/TileInfo":452,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/support/LOD":638,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/terrain/TilingScheme":686,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/QueueProcessor":793,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/Queue":864,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/throttle":1297,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/graphics/Graphics3DVerticalScale":1307,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/graphics/controllers/FeatureTileController3D":2366,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/support/FeatureTileFetcher3D":2367,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/support/featureReference":2368,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/support/FeatureTileFetcher3DDebugger":2369})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[86],{1297:function(e,t,i){var r,s;r=[i.dj.c(e.i),t],void 0===(s=function(e,t){function i(e,t,i,r){var s=null,n=1e3;"number"==typeof t?(n=t,r=i):(s=t,n=i);var o,a=0,l=function(){a=0,e.apply(r,o)},u=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];s&&s.apply(r,e),o=e,n?a||(a=setTimeout(l,n)):l()};return u.remove=function(){a&&(clearTimeout(a),a=0)},u.forceUpdate=function(){a&&(clearTimeout(a),l())},u.hasPendingUpdates=function(){return!!a},u}Object.defineProperty(t,"__esModule",{value:!0}),t.throttle=i,t.default=i}.apply(null,r))||(e.exports=s)},1307:function(e,t,i){var r,s;r=[i.dj.c(e.i),t,i(443)],void 0===(s=function(e,t,i){return function(){function e(e){this.sourceSpatialReference=e.sourceSpatialReference,this.destSpatialReference=e.destSpatialReference}return e.prototype.adjust=function(e){var t=this._getVerticalUnitScale();1!==t&&this._scaleVerticalUnits(e,t)},e.prototype._getVerticalUnitScale=function(){return this.sourceSpatialReference&&!this.sourceSpatialReference.equals(this.destSpatialReference)?i.getMetersPerVerticalUnitForSR(this.sourceSpatialReference)/i.getMetersPerVerticalUnitForSR(this.destSpatialReference):1},e.prototype._vertexListsScaleZ=function(e,t){for(var i=0;i<e.length;++i)for(var r=e[i],s=0;s<r.length;++s){r[s][2]*=t}},e.prototype._scaleVerticalUnits=function(e,t){for(var i=0;i<e.length;++i){var r=e[i].geometry;r&&r.hasZ&&(this._geometryIsPoint(r)?null!==r.z&&(r.z*=t):this._geometryIsPolyline(r)?this._vertexListsScaleZ(r.paths,t):this._geometryIsPolygon(r)&&this._vertexListsScaleZ(r.rings,t))}},e.prototype._geometryIsPoint=function(e){return"point"===e.type},e.prototype._geometryIsPolygon=function(e){return"polygon"===e.type},e.prototype._geometryIsPolyline=function(e){return"polyline"===e.type},e}()}.apply(null,r))||(e.exports=s)},2366:function(e,t,i){var r,s;r=[i.dj.c(e.i),t,i(337),i(335),i(344),i(346),i(357),i(341),i(365),i(338),i(343),i(624),i(339),i(377),i(336),i(394),i(902),i(1307),i(2367),i(2369),i(601)],void 0===(s=function(e,t,i,r,s,n,o,a,l,u,c,p,h,f,d,y,g,v,m,b,F){var _=c.getLogger("esri.layers.graphics.controllers.FeatureTileController3D"),x=function(e){function t(t){var i=e.call(this)||this;return i.type="feature-tile-3d",i.serviceDataExtent=null,i.serviceDataExtentIsAccurate=!1,i.serviceDataCount=n.constants.NO_SERVICE_DATA_COUNT,i.suspended=!1,i.tileFetcher=null,i.handles=new l,i.fetchDataInfoPromise=null,i}var n;return i(t,e),n=t,Object.defineProperty(t.prototype,"extent",{set:function(e){if(!e||e.spatialReference.equals(this.layerView.view.spatialReference)){var t=this._get("extent");if(t!==e&&!(t&&e&&t.equals(e))){var i=e?e.clone():null;this._set("extent",i)}}else _.error("#extent=","extent needs to be in the same spatial reference as the view")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!!(this.tileFetcher&&this.tileFetcher.updating||this.fetchDataInfoPromise)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"displayLimitExceeded",{get:function(){return!(!this.tileFetcher||!this.tileFetcher.displayLimitExceeded)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filteredDataExtent",{get:function(){var e=this.serviceDataExtentIsAccurate?this.serviceDataExtent:null;return this.extent?e?e.clone().intersection(this.extent):this.extent:e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"displayFeatureLimit",{set:function(e){this._set("displayFeatureLimit",e),"snapshot"===this.mode&&this._set("displayFeatureLimit",s({},e,{perTile:e.max})),this.tileFetcher&&(this.tileFetcher.displayFeatureLimit=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mode",{get:function(){var e=n.constants.NO_SERVICE_DATA_COUNT;return"point"!==this.layerView.layer.geometryType?!e&&this.serviceDataCount<=50?"snapshot":"tiles":this.serviceDataCount!==n.constants.NO_SERVICE_DATA_COUNT&&this.displayFeatureLimit&&this.displayFeatureLimit.min&&this.serviceDataCount<=this.displayFeatureLimit.min?"snapshot":"tiles"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tileDescriptors",{get:function(){return"snapshot"===this.mode?new o([{id:"dummy-tile-full-extent"}]):this.layerView.view.featureTiles.tiles},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"suspendResumeExtentMode",{get:function(){return"snapshot"===this.mode?"computed":"data"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"test",{get:function(){return{fetchDataInfoPromise:this.fetchDataInfoPromise}},enumerable:!0,configurable:!0}),t.prototype.initialize=function(){var e=this,t=h.resolve().then(function(){return e.verifyCapabilities()}).then(function(){return e.fetchServiceDataInfo()}).then(function(){return e.initializeTileFetcher()});this.addResolvingPromise(t)},t.prototype.verifyCapabilities=function(){var e=this.layerView.layer;if(!e.get("capabilities.operations.supportsQuery"))throw new a("graphicscontroller:query-capability-required","Service requires query capabilities to be used as a feature layer",{layer:e})},t.prototype.destroy=function(){this.cancelFetchServiceDataInfo(),this.tileFetcher&&(this.tileFetcher.destroy(),this.tileFetcher=null),this.handles&&(this.handles.destroy(),this.handles=null)},t.prototype.suspend=function(){this.suspended||(this.suspended=!0,this.tileFetcher&&this.tileFetcher.suspend())},t.prototype.resume=function(){this.suspended&&(this.suspended=!1,this.tileFetcher&&this.tileFetcher.resume())},t.prototype.refresh=function(){var e=this,t=function(){e.tileFetcher&&e.tileFetcher.filtersChanged()};this.fetchServiceDataInfo().then(t,t)},t.prototype.initializeTileFetcher=function(){var e=this,t=this.layerView.view,i=this.layerView.layer;this.handles.add(f.whenOnce(t.featureTiles,"tilingScheme",function(){e.handles.add(t.featureTiles.addClient()),e.tileFetcher=new m.FeatureTileFetcher3D({layer:i,filterExtent:e.filteredDataExtent,tilingScheme:t.featureTiles.tilingScheme,tileDescriptors:e.tileDescriptors,features:e.graphics,displayFeatureLimit:e.displayFeatureLimit,verticalScale:new v({sourceSpatialReference:i.spatialReference,destSpatialReference:t.spatialReference}),viewingMode:t.viewingMode}),e.suspended?e.tileFetcher.suspend():e.tileFetcher.resume(),e.handles.add([i.watch("definitionExpression",function(){return e.definitionExpressionChanged()}),i.watch("outFields",function(t,i){return e.attributesChanged(t,i)}),i.on("apply-edits",function(t){return e.tileFetcher.applyEdits(t)}),e.watch("filteredDataExtent",function(t){return e.tileFetcher.filterExtent=t},!0),e.watch("tileDescriptors",function(t){return e.tileFetcher.tileDescriptors=t},!0)],"layer"),e.handles.add(f.init(F,"FEATURE_TILE_FETCH_SHOW_TILES",function(i){i&&e.tileFetcher&&!e.tileFetcher.debugger?(e.tileFetcher.debugger=new b.FeatureTileFetcher3DDebugger(e.tileFetcher,t.featureTiles.tilingScheme.toTileInfo(),t),e.tileFetcher.debugger.update()):!i&&e.tileFetcher&&e.tileFetcher.debugger&&(e.tileFetcher.debugger.destroy(),e.tileFetcher.debugger=null)}))}))},t.prototype.definitionExpressionChanged=function(){this.refresh()},t.prototype.attributesChanged=function(e,t){if(!e||-1===e.indexOf("*"))if(e&&t){for(var i=new Set,r=0,s=e;r<s.length;r++){var n=s[r];i.add(n)}for(var o=0,a=t;o<a.length;o++){n=a[o];if(!i.has(n))return void this.refresh()}}else this.refresh()},t.prototype.createDataInfoQuery=function(){var e=this.layerView.layer,t=e.createQuery();return t.outSpatialReference=this.layerView.view.spatialReference,e.capabilities.query.supportsResultType&&(t.resultType="tile"),t},t.prototype.fullExtentIsAccurate=function(){var e=this.layerView.layer;if(e.definitionExpression)return!1;switch(e.type){case"feature":case"stream":return y.isHostedAgolService(e.url);case"csv":return!0}},t.prototype.fetchServiceDataExtent=function(){var e=this,t=this.layerView,i=t.layer,r=i.capabilities.query.supportsExtent,s=u.clone(t.fullExtentInLocalViewSpatialReference),o=i.fullExtent,a=this.fullExtentIsAccurate(),l=this.serviceDataCount,c=null;if(r&&l<=n.constants.MAX_FEATURE_COUNT_FOR_EXTENT&&(!s||!a)){var p=this.createDataInfoQuery();c=i.queryExtent(p,{timeout:n.constants.QUERY_EXTENT_TIMEOUT}).then(function(t){e._set("serviceDataExtentIsAccurate",!0),e._set("serviceDataExtent",t.extent)})}else s?(this._set("serviceDataExtentIsAccurate",a),this._set("serviceDataExtent",s)):o?c=g.projectGeometry(o,t.view.spatialReference,i.portalItem).then(function(t){e._set("serviceDataExtentIsAccurate",a),e._set("serviceDataExtent",t)}):(this._set("serviceDataExtentIsAccurate",!1),this._set("serviceDataExtent",null));return c&&(c=c.catch(function(t){t&&"cancel"===t.dojoType||(e._set("serviceDataExtentIsAccurate",!!s&&a),e._set("serviceDataExtent",s))})),c},t.prototype.fetchServiceDataInfo=function(){var e=this;this.cancelFetchServiceDataInfo();var t=this.layerView.layer.queryFeatureCount(this.createDataInfoQuery(),{timeout:n.constants.QUERY_COUNT_TIMEOUT}).then(function(t){return e._set("serviceDataCount",t),t}).catch(function(t){if(t&&"cancel"===t.dojoType)throw t;var i=n.constants.NO_SERVICE_DATA_COUNT;return e._set("serviceDataCount",i),i}),i=t.then(function(){return e.fetchServiceDataExtent()}).catch(function(e){e&&"AbortError"===e.name||console.error(e)}).then(function(){i===e.fetchDataInfoPromise&&(e.fetchDataInfoPromise=null)});return i.isFulfilled()||(this.fetchDataInfoPromise=i),t.catch(function(){})},t.prototype.cancelFetchServiceDataInfo=function(){var e=this.fetchDataInfoPromise;e&&(this.fetchDataInfoPromise=null,e.cancel())},r([d.property({readOnly:!0})],t.prototype,"type",void 0),r([d.property({constructOnly:!0})],t.prototype,"graphics",void 0),r([d.property({constructOnly:!0})],t.prototype,"layerView",void 0),r([d.property()],t.prototype,"extent",null),r([d.property({dependsOn:["tileFetcher.updating","fetchDataInfoPromise"]})],t.prototype,"updating",null),r([d.property({dependsOn:["tileFetcher.displayLimitExceeded"]})],t.prototype,"displayLimitExceeded",null),r([d.property({readOnly:!0})],t.prototype,"serviceDataExtent",void 0),r([d.property({readOnly:!0})],t.prototype,"serviceDataExtentIsAccurate",void 0),r([d.property({readOnly:!0})],t.prototype,"serviceDataCount",void 0),r([d.property({readOnly:!0,dependsOn:["extent","serviceDataExtent","serviceDataExtentIsAccurate"]})],t.prototype,"filteredDataExtent",null),r([d.property()],t.prototype,"displayFeatureLimit",null),r([d.property({readOnly:!0,dependsOn:["serviceDataCount","displayFeatureLimit"]})],t.prototype,"mode",null),r([d.property({readOnly:!0,dependsOn:["mode"]})],t.prototype,"tileDescriptors",null),r([d.property({readOnly:!0,dependsOn:["mode"]})],t.prototype,"suspendResumeExtentMode",null),r([d.property()],t.prototype,"tileFetcher",void 0),r([d.property()],t.prototype,"fetchDataInfoPromise",void 0),n=r([d.subclass("esri.layers.graphics.controllers.FeatureTileController3D")],t)}(d.declared(n,p));return function(e){!function(t){t.NO_SERVICE_DATA_COUNT=1/0,t.reset=function(){e.constants.MAX_FEATURE_COUNT_FOR_EXTENT=1e4,e.constants.QUERY_COUNT_TIMEOUT=6e3,e.constants.QUERY_EXTENT_TIMEOUT=1e4}}(e.constants||(e.constants={}))}(x||(x={})),x.constants.reset(),x}.apply(null,r))||(e.exports=s)},2367:function(e,t,i){var r,s;r=[i.dj.c(e.i),t,i(345),i(335),i(344),i(400),i(396),i(346),i(665),i(365),i(680),i(343),i(339),i(793),i(462),i(1297),i(377),i(336),i(367),i(589),i(1084),i(2368)],void 0===(s=function(e,t,i,r,s,n,o,a,l,u,c,p,h,f,d,y,g,v,m,b,F,_){Object.defineProperty(t,"__esModule",{value:!0});var x=_.SingleFeatureReference,T=_.MultiFeatureReference,w=p.getLogger("esri.views.3d.layers.support.FeatureTileFetcher3D"),E=function(e){function t(t){var i=e.call(this,t)||this;return i.updating=!1,i.displayLimitExceeded=!1,i.displayLimitExceededThrottle=1e3,i.handles=new u,i.idToFeatureTile=new Map,i.displayingFeatureReferences=new Map,i.suspended=!0,i.pendingEdits=null,i}return i(t,e),Object.defineProperty(t.prototype,"displayFeatureLimit",{set:function(e){var t=this._get("displayFeatureLimit");if(!(e===t||e&&t&&e.min===t.min&&e.max===t.max&&e.perTile===t.perTile)){var i=t?t.perTile:1/0,r=e?e.perTile:1/0;this._set("displayFeatureLimit",s({},e)),this.perTileLimitUpdated(i,r),this.update()}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filterExtent",{set:function(e){if(e&&this.tilingScheme&&!e.spatialReference.equals(this.tilingScheme.spatialReference))w.error("#filterExtent=","extent needs to be in the same spatial reference as the tiling scheme");else{var t=this._get("filterExtent");if(t!==e&&!(t&&e&&t.equals(e))){var i=e?e.clone():null;this._set("filterExtent",i),this.reclip(i,t)}}},enumerable:!0,configurable:!0}),t.prototype.initialize=function(){var e=this;this.updateDisplayLimitExceededThrottled=y.throttle(this.updateDisplayLimitExceeded,this.displayLimitExceededThrottle,this),this.capabilities=this.calculateCapabilities(),this.fetchQueue=this.createFetchQueue(),this.handles.add(g.on(this,"tileDescriptors","change",function(){return e.update()},function(){return e.update()})),this.objectIdField=this.layer.objectIdField,this.FeatureReferenceClass=this.capabilities.supportsMultipleResolutions?T:x,this.update()},t.prototype.destroy=function(){var e=this;this.handles&&(this.handles.destroy(),this.handles=null),this.updateDisplayLimitExceededThrottled.remove(),this.forEachFeatureTile(function(t){return e.cancelFetchTile(t)}),this.fetchQueue.clear(),this.pendingEdits&&(this.pendingEdits.edits.cancel(j),this.pendingEdits=null)},Object.defineProperty(t.prototype,"paused",{get:function(){return this.suspended||!!this.pendingEdits},enumerable:!0,configurable:!0}),t.prototype.filtersChanged=function(){var e=this;this.fetchQueue.clear(),this.forEachFeatureTile(function(t){e.resetFetchTile(t),e.queueFetchTile(t)}),this.update()},t.prototype.suspend=function(){this.suspended||(this.suspended=!0,this.pause())},t.prototype.resume=function(){this.suspended&&(this.suspended=!1,this.unpause())},t.prototype.pause=function(){this.paused&&(this.fetchQueue.pause(),this.fetchQueue.reset(),this.updated())},t.prototype.unpause=function(){this.paused||(this.update(),this.fetchQueue.resume(),this.updated())},t.prototype.getFeatureTileById=function(e){return this.idToFeatureTile.get(e)||null},t.prototype.forEachFeatureTile=function(e){this.idToFeatureTile.forEach(e)},t.prototype.applyEdits=function(e){var t=this;this.pendingEdits||(this.pendingEdits={edits:h.resolve(),count:0},this.pause()),this.pendingEdits.count++,this.pendingEdits.edits=this.pendingEdits.edits.then(function(){return e.result.catch(function(e){if(e===j)throw e;return null}).then(function(e){if(e)return t.applyEditsDeleteFeatures(e.deletedFeatures),t.applyEditsAddUpdateFeatures(e.addedFeatures,e.updatedFeatures)}).then(function(){0==--t.pendingEdits.count&&(t.pendingEdits=null,t.unpause())})})},t.prototype.applyEditsDeleteFeatures=function(e){var t=this;if(0!==e.length){var i=new Set;e.forEach(function(e){return i.add(e.objectId)}),this.forEachFeatureTile(function(e){if(e.features){var r=e.features.filter(function(e){return!i.has(t.getFeatureId(e))});r.length!==e.features.length&&(e.features=r)}})}},t.prototype.applyEditsAddUpdateFeatures=function(e,t){return n(this,void 0,void 0,function(){var i,r,s,n=this;return o(this,function(o){switch(o.label){case 0:return i=[],r=new Set,e.forEach(function(e){return i.push(e.objectId)}),t.forEach(function(e){i.push(e.objectId),r.add(e.objectId)}),0===i.length?[2]:(s=[],this.forEachFeatureTile(function(e){var t=l.safeCast(n.applyEditsAddUpdateTile(e,i,r));t&&s.push(t)}),[4,h.eachAlways(s)]);case 1:return o.sent(),[2]}})})},t.prototype.applyEditsAddUpdateTile=function(e,t,i){return n(this,void 0,void 0,function(){var r,s,n,a,l,u,c,p=this;return o(this,function(o){switch(o.label){case 0:return e.features?((r=this.createQuery(e)).resultType=void 0,r.objectIds=t,[4,this.queryFeatures(r)]):[2];case 1:if(s=o.sent(),n=null,i.size>0&&((a=e.features.filter(function(e){return!i.has(p.getFeatureId(e))})).length!==e.features.length&&(n=a)),s.features.length>0)for(n||(n=e.features.slice()),this.verticalScale.adjust(s.features),l=0,u=s.features;l<u.length;l++)c=u[l],n.push(c);return n&&(e.features=n),[2]}})})},t.prototype.queryFeatures=function(e){return this.layer.queryFeaturesJSON?this.layer.queryFeaturesJSON(e).then(function(e){return{features:b.fromFeatureSetJSON(e),exceededTransferLimit:!!e.exceededTransferLimit}}):this.layer.queryFeatures(e).then(function(e){return{features:e.features,exceededTransferLimit:!!e.exceededTransferLimit}})},t.prototype.calculateCapabilities=function(){var e=this.layer,t=!!(e.capabilities&&e.capabilities.query&&e.capabilities.query.supportsPagination),i=!!(e.capabilities&&e.capabilities.query&&e.capabilities.query.supportsResultType),r=!!(e.capabilities&&e.capabilities.query&&e.capabilities.query.supportsQuantization);return{supportsMultipleResolutions:this.calculateSupportsMultipleResolutions(),supportsPagination:t,supportsResultType:i,supportsQuantization:r}},t.prototype.calculateSupportsMultipleResolutions=function(){var e=this.layer,t=e.geometryType;return"polyline"===t||"polygon"===t&&e.capabilities&&e.capabilities.query&&e.capabilities.query.supportsQuantization},t.prototype.createFetchQueue=function(){var e=this;return new f({concurrency:6,ordered:!0,peeker:function(t){return e.highestPriorityTile(t)},process:function(t){return l.safeCast(e.fetchTile(t))}})},t.prototype.highestPriorityTile=function(e){return e.reduce(function(e,t){return e&&e.descriptor.loadPriority<=t.descriptor.loadPriority?e:t},null)},t.prototype.update=function(){if(!this.suspended&&this.constructed){var e=this.getListOfTiles();this.markTilesNotAlive(e),this.addTiles(e);var t=this.sortTiles(e);this.removeTiles(t),this.displayTiles(t),this.queueFetchTiles(t),this.updated()}},t.prototype.markTilesNotAlive=function(e){for(var t=0,i=e;t<i.length;t++)i[t].alive=0},t.prototype.addTiles=function(e){var t=this;this.tileDescriptors.forEach(function(i){var r=t.getFeatureTileById(i.id);r?r.alive=1:e.push(t.addTile(i))})},t.prototype.tileHasRelatives=function(e){var t=this;return!c.everyMap(this.idToFeatureTile,function(i){return!t.tilesAreRelated(i,e)})},t.prototype.removeTiles=function(e){for(var t=0,i=e;t<i.length;t++){0===(n=i[t]).alive||n.intersects(this.filterExtent)||this.clearTile(n)}for(var r=!1,s=e.length-1;s>=0;s--){var n;(n=e[s]).displayingFeatures&&n.displayingFeatures.length>0&&this.displayFeatureLimit&&this.displayingFeatureReferences.size<=this.displayFeatureLimit.min&&!this.tileHasRelatives(n)?0===n.alive&&(n.alive=2):0===n.alive&&(this.removeTile(n),s!==e.length-1&&(r=!0),e[s]=e[e.length-1],e.pop())}r&&this.sortTiles(e)},t.prototype.sortTiles=function(e){return e.sort(function(e,t){return e.descriptor.loadPriority-t.descriptor.loadPriority}),e},t.prototype.displayTiles=function(e){for(var t=0,i=e.length-1,r=null;t<=i;)if(!r&&this.isDisplayingFeaturesAtMaximumLimit()){var s=e[i--],n=this.featureCountDifferenceWhenHidingTile(s);this.displayFeatureLimit&&this.displayingFeatureReferences.size-n>=this.displayFeatureLimit.max?this.hideTile(s):r=s}else{s=e[t++];(n=this.featureCountDifferenceWhenShowingTile(s))>0&&r&&(this.hideTile(r),r=null),this.showTile(s)}r&&this.showTile(r)},t.prototype.queueFetchTiles=function(e){var t=e.length-1;if(this.isDisplayingFeaturesAtMaximumLimit())for(var i=e.length-1;i>=0;i--){var r=e[i];if(r.displayingFeatures&&r.displayingFeatures.length>0){t=i;break}}for(i=0;i<=t;i++)this.queueFetchTile(e[i])},t.prototype.reclip=function(e,t){var i=this;if(this.constructed){var r=[];this.forEachFeatureTile(function(s){s.displayingFeatures&&0!==s.displayingFeatures.length&&(s.intersection(t,D),s.intersection(e,P),m.equals(D,P)||(r.push(s),i.hideTileFeatures(s)))});for(var s=0,n=r;s<n.length;s++){var o=n[s];this.showTile(o)}this.updated()}},t.prototype.updated=function(){this._set("updating",this.fetchQueue.length>0),this.debugger&&this.debugger.update(),this.updateDisplayLimitExceededThrottled()},t.prototype.updateDisplayLimitExceeded=function(){if(!this.updating){var e=!1;this.forEachFeatureTile(function(t){(t.perTileDisplayLimitExceeded&&2!==t.alive||!t.displayingFeatures&&!t.isFetchFetching)&&(e=!0)}),this._set("displayLimitExceeded",e)}},t.prototype.perTileLimitUpdated=function(e,t){if(e!==t)if(t<e)for(var i=0,r=this.getListOfTiles();i<r.length;i++){(o=r[i]).features&&o.features.length>t&&(o.features=o.features.slice(0,t),o.perTileDisplayLimitExceeded=!0)}else for(var s=0,n=this.getListOfTiles();s<n.length;s++){var o;(o=n[s]).features&&o.features.length>=e&&(this.cancelFetchTile(o),this.resetFetchTile(o))}},t.prototype.addTile=function(e){var t=new R(e);return this.idToFeatureTile.set(t.id,t),this.resetFetchTile(t),this.referenceDisplayingFeaturesFromRelatedTiles(t),t},t.prototype.referenceDisplayingFeaturesFromRelatedTiles=function(e){var t=this,i=e.descriptor.resolution;this.forEachFeatureTile(function(r){if(r.displayingFeatures&&t.tilesAreRelated(e,r)){e.displayingFeatures||(e.displayingFeatures=[]);for(var s=0,n=r.displayingFeatures;s<n.length;s++){var o=n[s];e.displayingFeatures.push(o);var a=t.getDisplayingFeatureReference(o);a.ref(i,a.feature)}}})},t.prototype.tilesAreRelated=function(e,t){if(e===t)return!1;var i=e.descriptor.lij,r=t.descriptor.lij;if(!i||!r)return!0;var s=i[0]<r[0],n=s?i:r,o=s?r:i,a=o[0]-n[0];if(0===a)return!1;var l=1<<a;return Math.floor(o[1]/l)===n[1]&&Math.floor(o[2]/l)===n[2]},t.prototype.removeTile=function(e){this.clearTile(e),this.idToFeatureTile.delete(e.id)},t.prototype.resetFetchTile=function(e){e.intersects(this.filterExtent)?e.fetchStatus=0:0===e.fetchStatus&&(e.fetchStatus=2)},t.prototype.cancelFetchTile=function(e){var t=e.fetchRequest;t&&(e.fetchRequest=null,e.fetchStatus=0,t.cancel())},t.prototype.fetchTile=function(e){return n(this,void 0,void 0,function(){return o(this,function(t){switch(t.label){case 0:return[4,this.fetchTileAll(e)];case 1:return[2,t.sent()]}})})},t.prototype.setPagingParameters=function(e,t,i){if(!this.capabilities.supportsPagination)return!1;var r=this.capabilities.supportsResultType&&this.layer.tileMaxRecordCount||this.layer.maxRecordCount||S;return e.start=t,i>0&&this.capabilities.supportsResultType?(e.maxRecordCountFactor=Math.ceil(i/r),e.num=i):e.num=Math.min(r,i),!0},t.prototype.fetchTileAll=function(e){return n(this,void 0,void 0,function(){var t,i,r,s,n,a,l,u,c,p;return o(this,function(o){switch(o.label){case 0:t=0,i=[],r=!1,e.perTileDisplayLimitExceeded=!1,o.label=1;case 1:return s=this.createQuery(e),n=this.displayFeatureLimit&&this.displayFeatureLimit.perTile,a=this.setPagingParameters(s,t,n),[4,this.queryFeatures(s)];case 2:return l=o.sent(),u=l.features,c=l.exceededTransferLimit,r=c,i=0===i.length?u:i.concat(u),!a||!c||n>0&&i.length>=n?[3,3]:(e.needsDisplayUpdate?e.features=e.features.concat(u):e.displayingFeatures?e.features=e.displayingFeatures.concat(u):e.features=u,this.update(),t+=s.num,[3,1]);case 3:return(p=this.displayFeatureLimit&&this.displayFeatureLimit.perTile)&&i.length>p?(e.perTileDisplayLimitExceeded=!0,i=i.slice(0,p)):r&&(e.perTileDisplayLimitExceeded=!0),this.verticalScale.adjust(i),[2,i]}})})},t.prototype.createQuery=function(e){var t=this.tilingScheme.spatialReference,i=e.descriptor.extent,r=this.createDefaultQuery();return i&&(r.geometry=m.toExtent(i,t)),this.setResolutionParams(r,e),this.capabilities.supportsResultType&&(r.resultType="tile"),r},t.prototype.createDefaultQuery=function(){var e=this.tilingScheme.spatialReference,t=this.layer.createQuery(),i=this.layer.capabilities&&this.layer.capabilities.data;return i&&i.supportsZ&&null==t.returnZ&&(t.returnZ=!0),t.outSpatialReference=e,t},t.prototype.getEffectiveTileResolution=function(e){var t="global"===this.viewingMode?this.tilingScheme.resolutionAtLevel(3):1/0;return Math.min(e.descriptor.resolution,t)},t.prototype.setResolutionParams=function(e,t){if(this.capabilities.supportsMultipleResolutions){var i=this.layer,r=i.geometryType,s=this.getEffectiveTileResolution(t);null!=s&&("polyline"===r&&(e.maxAllowableOffset=s),this.capabilities.supportsQuantization&&(e.quantizationParameters=new F.default({mode:"view",originPosition:"upper-left",tolerance:s,extent:i.fullExtent})))}},t.prototype.queueFetchTile=function(e){var t=this;if(e.isFetchPending){var i=this.fetchQueue.push(e),r=!1,s=i.then(function(t){e.fetchRequest=null,e.fetchStatus=2,e.features=t}).catch(function(t){e.fetchRequest===s&&(e.fetchRequest=null,e.fetchStatus=2),t&&"cancel"===t.dojoType?r=!0:(e.features=[],w.error("#fetchTile()",t&&t.message?t.message:t))}).then(function(){r||t.update(),t.scheduleUpdated()});s.isFulfilled()?e.fetchStatus=2:(e.fetchRequest=s,e.fetchStatus=1)}},t.prototype.scheduleUpdated=function(){var e=this;this.handles.has("scheduleUpdated")||this.handles.add(d.schedule(function(){e.handles.remove("scheduleUpdated"),e.updated()}),"scheduleUpdated")},t.prototype.getDisplayingFeatureReference=function(e){return this.displayingFeatureReferences.get(this.getFeatureId(e))},t.prototype.showTile=function(e){if(!e.displayingFeatures||e.needsDisplayUpdate){if(!e.features)return void(e.displayingFeatures=[]);for(var t=e.descriptor.resolution,i=0,r=e.features;i<r.length;i++){var s=r[i],n=this.getFeatureId(s),o=this.displayingFeatureReferences.get(n);if(o){var a=o.ref(t,s);a.oldVersion!==a.newVersion&&(O.push(a.oldVersion),M.push(a.newVersion))}else this.displayingFeatureReferences.set(n,new this.FeatureReferenceClass(t,s)),M.push(s)}this.hideTileFeatures(e),O.length>0&&this.features.removeMany(O),M.length>0&&this.features.addMany(M),O.length=0,M.length=0,e.displayingFeatures=e.features}},t.prototype.featureCountDifferenceWhenShowingTile=function(e){if(!e.needsDisplayUpdate)return 0;for(var t=-this.featureCountDifferenceWhenHidingTile(e,!0),i=0,r=e.features;i<r.length;i++){var s=r[i],n=this.getDisplayingFeatureReference(s);(!n||n.isSingle&&n.markedTile===e)&&t++}return t},t.prototype.getFeatureId=function(e){return null!=e.objectId?e.objectId:e.attributes[this.objectIdField]},t.prototype.featureCountDifferenceWhenHidingTile=function(e,t){if(void 0===t&&(t=!1),!e.displayingFeatures)return 0;for(var i=0,r=0,s=e.displayingFeatures;r<s.length;r++){var n=s[r],o=this.getDisplayingFeatureReference(n);o&&o.isSingle&&(t&&(o.markedTile=e),i++)}return i},t.prototype.hideTile=function(e){this.cancelFetchTile(e),this.hideTileFeatures(e)},t.prototype.hideTileFeatures=function(e){if(e.displayingFeatures){for(var t=0,i=e.displayingFeatures;t<i.length;t++){var r=i[t],s=this.getFeatureId(r),n=this.displayingFeatureReferences.get(s);if(n){var o=n.unref(e.descriptor.resolution);o.oldVersion!==o.newVersion&&(null==o.newVersion?this.displayingFeatureReferences.delete(s):I.push(o.newVersion),L.push(o.oldVersion))}}L.length>0&&this.features.removeMany(L),I.length>0&&this.features.addMany(I),I.length=0,L.length=0}e.displayingFeatures=null},t.prototype.clearTile=function(e){this.hideTile(e),e.features=null},t.prototype.isDisplayingFeaturesAtMaximumLimit=function(){return this.displayFeatureLimit&&this.displayingFeatureReferences.size>=this.displayFeatureLimit.max},t.prototype.getListOfTiles=function(){var e=new Array(this.idToFeatureTile.size),t=0;return this.forEachFeatureTile(function(i){return e[t++]=i}),e},r([v.property({constructOnly:!0})],t.prototype,"features",void 0),r([v.property()],t.prototype,"tileDescriptors",void 0),r([v.property({constructOnly:!0})],t.prototype,"tilingScheme",void 0),r([v.property()],t.prototype,"displayFeatureLimit",null),r([v.property({constructOnly:!0})],t.prototype,"layer",void 0),r([v.property({readOnly:!0})],t.prototype,"updating",void 0),r([v.property({readOnly:!0})],t.prototype,"displayLimitExceeded",void 0),r([v.property({constructOnly:!0})],t.prototype,"displayLimitExceededThrottle",void 0),r([v.property()],t.prototype,"filterExtent",null),r([v.property({constructOnly:!0})],t.prototype,"verticalScale",void 0),r([v.property({constructOnly:!0})],t.prototype,"viewingMode",void 0),r([v.subclass("esri.views.3d.layers.support.FeatureTileFetcher3D")],t)}(v.declared(a));t.FeatureTileFetcher3D=E;var R=function(){function e(e){this.descriptor=e,this.fetchRequest=null,this.fetchStatus=0,this.features=null,this.displayingFeatures=null,this.perTileDisplayLimitExceeded=!1,this.alive=1}return Object.defineProperty(e.prototype,"id",{get:function(){return this.descriptor.id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isFetchFetching",{get:function(){return 1===this.fetchStatus},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isFetchPending",{get:function(){return 0===this.fetchStatus},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isFetchDone",{get:function(){return 2===this.fetchStatus},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"needsDisplayUpdate",{get:function(){return this.features&&this.displayingFeatures!==this.features},enumerable:!0,configurable:!0}),e.prototype.intersects=function(e){return!e||!this.descriptor.extent||(m.fromExtent(e,D),m.intersects(this.descriptor.extent,D))},e.prototype.intersection=function(e,t){return void 0===t&&(t=m.create()),e||this.descriptor.extent?(e?(m.fromExtent(e,t),this.descriptor.extent&&m.intersection(t,this.descriptor.extent,t)):m.set(t,this.descriptor.extent),t):t},e}();t.FeatureTile=R;var S=2e3,D=m.create(),P=m.create(),M=[],O=[],I=[],L=[],j={};t.default=E}.apply(null,r))||(e.exports=s)},2368:function(e,t,i){var r,s;r=[i.dj.c(e.i),t,i(589)],void 0===(s=function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){this.highestResolutionVersion=null,this.versions=[],this.markedTile=null,this.ref(e,t)}return Object.defineProperty(e.prototype,"isReferenced",{get:function(){return 0!==this.versions.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSingle",{get:function(){return 1===this.versions.length&&1===this.versions[0].refCount},enumerable:!0,configurable:!0}),e.prototype.ref=function(e,t,r){void 0===r&&(r=n);var s=this.feature;r.oldVersion=s;for(var o=0,a=this.versions;o<a.length;o++){var l=a[o];if(l.resolution===e){l.refCount++;var u=this.highestResolutionVersion===l&&!i.equals(t,l.feature);return(u||this.highestResolutionVersion!==l)&&(l.feature=t),r.newVersion=u?t:s,r}}var c={feature:t,resolution:e,refCount:1};return this.versions.push(c),!this.highestResolutionVersion||e<this.highestResolutionVersion.resolution?(r.newVersion=t,this.highestResolutionVersion=c):r.newVersion=s,r},e.prototype.unref=function(e,t){void 0===t&&(t=n);for(var i=0;i<this.versions.length;i++){var r=this.versions[i];if(r.resolution===e&&0==--r.refCount){if(this.versions[i]=this.versions[this.versions.length-1],this.versions.length--,this.highestResolutionVersion===r)return this.recalculateHighestResolutionVersion(),t.oldVersion=r.feature,t.newVersion=this.feature,t;break}}var s=this.feature;return t.oldVersion=s,t.newVersion=s,t},Object.defineProperty(e.prototype,"feature",{get:function(){return this.highestResolutionVersion?this.highestResolutionVersion.feature:null},enumerable:!0,configurable:!0}),e.prototype.recalculateHighestResolutionVersion=function(){if(0!==this.versions.length){for(var e=this.versions[0],t=1;t<this.versions.length;t++){var i=this.versions[t];i.resolution<e.resolution&&(e=i)}this.highestResolutionVersion=e}else this.highestResolutionVersion=null},e}();t.MultiFeatureReference=r;var s=function(){function e(e,t){this._feature=t,this.refCount=1,this.markedTile=null}return Object.defineProperty(e.prototype,"isReferenced",{get:function(){return 0!==this.refCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSingle",{get:function(){return 1===this.refCount},enumerable:!0,configurable:!0}),e.prototype.ref=function(e,t,r){return void 0===r&&(r=n),this.refCount+=1,r.oldVersion=this._feature,i.equals(this._feature,t)||(this._feature=t),r.newVersion=this._feature,r},e.prototype.unref=function(e,t){return void 0===t&&(t=n),t.oldVersion=this._feature,this.refCount>0&&(this.refCount--,!this.isReferenced)?(t.newVersion=null,t):(t.newVersion=this._feature,t)},Object.defineProperty(e.prototype,"feature",{get:function(){return this._feature},enumerable:!0,configurable:!0}),e}();t.SingleFeatureReference=s;var n={oldVersion:null,newVersion:null}}.apply(null,r))||(e.exports=s)},2369:function(e,t,i){var r,s;r=[i.dj.c(e.i),t,i(383),i(640),i(1293),i(1415),i(739),i(1082),i(686)],void 0===(s=function(e,t,i,r,s,n,o,a,l){Object.defineProperty(t,"__esModule",{value:!0});var u=[[0,179,255],[117,62,128],[0,104,255],[215,189,166],[32,0,193],[98,162,206],[102,112,129],[52,125,0],[142,118,246],[138,83,0],[92,122,255],[122,55,83],[0,142,255],[81,40,179],[0,200,244],[13,24,127],[0,170,147],[19,58,241],[22,44,35]],c=function(){function e(e,t,i){this.loadingGraphics=new Map,this.loadedGraphics=new Map,this.pendingGraphics=new Map,this._enabled=!0,this.tileFetcher=e,this.view=i,this.tilingScheme=new l(t),this.loadedSymbols=u.map(function(e){return new o(new s({material:{color:[e[0],e[1],e[2],.6]},outline:{color:"black",size:1}}))}),this.loadingSymbols=[new o(new s({material:{color:[200,200,200,.4]},outline:{color:[30,30,30],size:1}}))],this.pendingSymbols=[new o(new s({material:{color:[100,100,100,.4]},outline:{color:[30,30,30],size:1}}))],this.dataExtentSymbol=new o(new s({material:{color:[0,0,0,0]},outline:{color:"green",size:4}}))}return e.prototype.destroy=function(){this.enabled=!1},Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(e){this._enabled=e,this.update()},enumerable:!0,configurable:!0}),e.prototype.update=function(){var e=this;this._enabled?(this.synchronizeMaps(this.loadingGraphics,{filter:function(e){return e.isFetchFetching},symbols:this.loadingSymbols}),this.synchronizeMaps(this.loadedGraphics,{filter:function(e){return!e.isFetchFetching},symbols:this.loadedSymbols}),this.synchronizeMaps(this.pendingGraphics,{filter:function(e){return!e.isFetchFetching},symbols:this.pendingSymbols}),this.showDataExtent(this.tileFetcher.filterExtent)):(this.loadingGraphics.forEach(function(t){e.view.graphics.removeMany(t)}),this.loadingGraphics.clear(),this.loadedGraphics.forEach(function(t){e.view.graphics.removeMany(t)}),this.loadedGraphics.clear(),this.pendingGraphics.forEach(function(t){e.view.graphics.removeMany(t)}),this.pendingGraphics.clear(),this.dataExtentGraphic&&(this.view.graphics.remove(this.dataExtentGraphic),this.dataExtentGraphic=null))},e.prototype.showDataExtent=function(e){if(this.dataExtentGraphic&&(this.view.graphics.remove(this.dataExtentGraphic),this.dataExtentGraphic=null),e){var t=r.fromExtent(e);this.dataExtentGraphic=new i({geometry:t,symbol:this.dataExtentSymbol}),this.view.graphics.add(this.dataExtentGraphic)}},e.prototype.synchronizeMaps=function(e,t){var r=this,s=[];e.forEach(function(e,i){var n=r.tileFetcher.getFeatureTileById(i);n&&t.filter(n)||(r.view.graphics.removeMany(e),s.push(i))}),s.forEach(function(t){return e.delete(t)}),this.tileFetcher.forEachFeatureTile(function(s){if(t.filter(s)&&!e.has(s.id)){var o=s.descriptor.lij,l=o[0],u=o[1],c=o[2];r.tilingScheme.ensureMaxLod(l);var p=r.tilingScheme.getExtentGeometry(l,u,c),h=[new i({geometry:p,symbol:t.symbols[l%t.symbols.length]}),new i({geometry:p.center,symbol:new n({verticalOffset:{screenLength:40/.75},callout:{type:"line",color:"white",border:{color:"black"}},symbolLayers:[new a({text:l+"/"+u+"/"+c,halo:{color:"white",size:1/.75},material:{color:"black"},size:16})]})})];e.set(s.id,h),r.view.graphics.addMany(h)}})},e}();t.FeatureTileFetcher3DDebugger=c,t.default=c}.apply(null,r))||(e.exports=s)},452:function(e,t,i){var r,s;r=[i.dj.c(e.i),t,i(344),i(337),i(335),i(364),i(340),i(347),i(336),i(360),i(367),i(443),i(409),i(386),i(638)],void 0===(s=function(e,t,i,r,s,n,o,a,l,u,c,p,h,f,d){var y=a({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc"});return function(e){function t(t){var i=e.call(this)||this;return i.dpi=96,i.format=null,i.origin=null,i.minScale=0,i.maxScale=0,i.size=null,i.spatialReference=null,i}var o;return r(t,e),o=t,t.create=function(e){void 0===e&&(e={size:256,spatialReference:n.SpatialReference.WebMercator});var t=e.resolutionFactor||1,i=e.scales,r=e.size||256,s=e.spatialReference||n.SpatialReference.WebMercator,a=h.getInfo(s),l=a?new n.Point(a.origin[0],a.origin[1],s):new n.Point(0,0,s),u=1/(39.37*p.getMetersPerUnitForSR(s)*96),c=[];if(i)for(var f=0;f<i.length;f++){var d=(v=i[f])*u;c.push({level:f,scale:v,resolution:d})}else{var y=h.isGeographic(s)?512/r*147748799.285417:256/r*591657527.591555,g=Math.ceil(24/t);c.push({level:0,scale:y,resolution:y*u});for(f=1;f<g;f++){var v;d=(v=y/Math.pow(2,t))*u;c.push({level:f,scale:v,resolution:d}),y=v}}return new o({dpi:96,lods:c,origin:l,size:r,spatialReference:s})},Object.defineProperty(t.prototype,"isWrappable",{get:function(){var e=this.spatialReference,t=this.origin;if(e&&t){var i=h.getInfo(e);return e.isWrappable&&Math.abs(i.origin[0]-t.x)<=i.dx}return!1},enumerable:!0,configurable:!0}),t.prototype.readOrigin=function(e,t){return n.Point.fromJSON(i({spatialReference:t.spatialReference},e))},Object.defineProperty(t.prototype,"lods",{set:function(e){var t=this,i=0,r=0,s=[];this._levelToLOD={},e&&(i=-1/0,r=1/0,e.forEach(function(e){s.push(e.scale),i=e.scale>i?e.scale:i,r=e.scale<r?e.scale:r,t._levelToLOD[e.level]=e})),this._set("scales",s),this._set("minScale",i),this._set("maxScale",r),this._set("lods",e),this._initializeUpsampleLevels()},enumerable:!0,configurable:!0}),t.prototype.readSize=function(e,t){return[t.cols,t.rows]},t.prototype.writeSize=function(e,t){t.cols=e[0],t.rows=e[0]},t.prototype.zoomToScale=function(e){var t=this.scales;if(e<=0)return t[0];if(e>=t.length)return t[t.length-1];var i=Math.round(e-.5),r=Math.round(e);return t[r]+(r-e)*(t[i]-t[r])},t.prototype.scaleToZoom=function(e){for(var t=this.scales,i=t.length-1,r=0;r<i;r++){var s=t[r],n=t[r+1];if(s<=e)return r;if(n===e)return r+1;if(s>e&&n<e)return r+1-(e-n)/(s-n)}return r},t.prototype.snapScale=function(e,t){void 0===t&&(t=.95);var i=this.scaleToZoom(e);return i%Math.floor(i)>=t?this.zoomToScale(Math.ceil(i)):this.zoomToScale(Math.floor(i))},t.prototype.tileAt=function(e,t,i,r){var s,n,o=this.lodAt(e);if(!o)return null;if("number"==typeof t)s=t,n=i;else if(h.equals(t.spatialReference,this.spatialReference))s=t.x,n=t.y,r=i;else{var a=f.project(t,this.spatialReference);if(!a)return null;s=a.x,n=a.y,r=i}var l=o.resolution*this.size[0],u=o.resolution*this.size[1];return r||(r={id:null,level:0,row:0,col:0,extent:c.create()}),r.level=e,r.row=Math.floor((this.origin.y-n)/u+.001),r.col=Math.floor((s-this.origin.x)/l+.001),this.updateTileInfo(r),r},t.prototype.updateTileInfo=function(e){var t=this.lodAt(e.level);if(t){var i=t.resolution*this.size[0],r=t.resolution*this.size[1];e.id=e.level+"/"+e.row+"/"+e.col,e.extent||(e.extent=c.create()),e.extent[0]=this.origin.x+e.col*i,e.extent[1]=this.origin.y-(e.row+1)*r,e.extent[2]=e.extent[0]+i,e.extent[3]=e.extent[1]+r}},t.prototype.upsampleTile=function(e){var t=this._upsampleLevels[e.level];return!(!t||-1===t.parentLevel||(e.level=t.parentLevel,e.row=Math.floor(e.row/t.factor+.001),e.col=Math.floor(e.col/t.factor+.001),this.updateTileInfo(e),0))},t.prototype.getTileBounds=function(e,t){var i=this.lodAt(t.level).resolution,r=i*this.size[0],s=i*this.size[1];return e[0]=this.origin.x+t.col*r,e[1]=this.origin.y-(t.row+1)*s,e[2]=e[0]+r,e[3]=e[1]+s,e},t.prototype.lodAt=function(e){return this._levelToLOD&&this._levelToLOD[e]||null},t.prototype.clone=function(){return o.fromJSON(this.write({}))},t.prototype._initializeUpsampleLevels=function(){var e=this.lods;this._upsampleLevels=[];for(var t=null,i=0;i<e.length;i++){var r=e[i];this._upsampleLevels[r.level]={parentLevel:t?t.level:-1,factor:t?t.resolution/r.resolution:0},t=r}},s([l.property({type:Number,json:{write:!0}})],t.prototype,"compressionQuality",void 0),s([l.property({type:Number,json:{write:!0}})],t.prototype,"dpi",void 0),s([l.property({type:String,json:{read:y.read,write:y.write}})],t.prototype,"format",void 0),s([l.property({readOnly:!0,dependsOn:["spatialReference","origin"]})],t.prototype,"isWrappable",null),s([l.property({type:n.Point,json:{write:!0}})],t.prototype,"origin",void 0),s([l.reader("origin")],t.prototype,"readOrigin",null),s([l.property({type:[d],value:null,json:{write:!0}})],t.prototype,"lods",null),s([l.property({readOnly:!0})],t.prototype,"minScale",void 0),s([l.property({readOnly:!0})],t.prototype,"maxScale",void 0),s([l.property({readOnly:!0})],t.prototype,"scales",void 0),s([l.property({cast:function(e){return Array.isArray(e)?e:"number"==typeof e?[e,e]:[256,256]}})],t.prototype,"size",void 0),s([l.reader("size",["rows","cols"])],t.prototype,"readSize",null),s([l.writer("size",{cols:{type:u.Integer},rows:{type:u.Integer}})],t.prototype,"writeSize",null),s([l.property({type:n.SpatialReference,json:{write:!0}})],t.prototype,"spatialReference",void 0),o=s([l.subclass("esri.layers.support.TileInfo")],t)}(l.declared(o))}.apply(null,r))||(e.exports=s)},638:function(e,t,i){var r,s;r=[i.dj.c(e.i),t,i(337),i(335),i(340),i(336),i(360)],void 0===(s=function(e,t,i,r,s,n,o){return function(e){function t(t){var i=e.call(this,t)||this;return i.level=0,i.levelValue=null,i.resolution=0,i.scale=0,i}var s;return i(t,e),s=t,t.prototype.clone=function(){return new s({level:this.level,levelValue:this.levelValue,resolution:this.resolution,scale:this.scale})},r([n.property({type:o.Integer,json:{write:!0}})],t.prototype,"level",void 0),r([n.property({type:String,json:{write:!0}})],t.prototype,"levelValue",void 0),r([n.property({type:Number,json:{write:!0}})],t.prototype,"resolution",void 0),r([n.property({type:Number,json:{write:!0}})],t.prototype,"scale",void 0),s=r([n.subclass("esri.layers.support.LOD")],t)}(n.declared(s))}.apply(null,r))||(e.exports=s)},686:function(e,t,i){var r,s;r=[i.dj.c(e.i),t,i(364),i(341),i(362),i(367),i(443),i(452),i(359),i(387)],void 0===(s=function(e,t,i,r,s,n,o,a,l,u){var c=u.webMercator.x2lon,p=u.webMercator.y2lat,h=function(){function e(t){var i=e._checkUnsupported(t);if(i)throw i;this.spatialReference=t.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isWGS84=this.spatialReference.isWGS84,this.origin=[t.origin.x,t.origin.y],this.pixelSize=[t.size[0],t.size[1]],this.dpi=t.dpi;var r=t.lods.reduce(function(e,t,i){return t.level<e.min&&(e.min=t.level,e.minIndex=i),e.max=Math.max(e.max,t.level),e},{min:1/0,minIndex:0,max:-1/0}),s=t.lods[r.minIndex],n=Math.pow(2,s.level),o=s.resolution*n,a=s.scale*n;this.levels=new Array(r.max+1);for(var l=0;l<this.levels.length;l++)this.levels[l]={resolution:o,scale:a,tileSize:[o*t.size[0],o*t.size[1]]},o/=2,a/=2}return e.prototype.clone=function(){return new e(this.toTileInfo())},e.prototype.toTileInfo=function(){return new a({dpi:this.dpi,origin:{x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference},size:this.pixelSize,spatialReference:this.spatialReference,lods:this.levels.map(function(e,t){return{level:t,scale:e.scale,resolution:e.resolution}})})},e.prototype.getExtent=function(e,t,i,r,s){void 0===r&&(r=n.create());var o=this.levels[e],a=o.tileSize[0],u=o.tileSize[1];return r[0]=this.origin[0]+i*a,r[2]=r[0]+a,r[3]=this.origin[1]-t*u,r[1]=r[3]-u,s&&(this._isWebMercator?(s[0]=c(r[0]),s[1]=p(r[1]),s[2]=c(r[2]),s[3]=p(r[3])):this._isWGS84&&(s[0]=l.deg2rad(r[0]),s[1]=l.deg2rad(r[1]),s[2]=l.deg2rad(r[2]),s[3]=l.deg2rad(r[3]))),r},e.prototype.getExtentGeometry=function(e,t,r,s){return void 0===s&&(s=new i.Extent),this.getExtent(e,t,r,f),s.spatialReference=this.spatialReference,s.xmin=f[0],s.ymin=f[1],s.xmax=f[2],s.ymax=f[3],s.zmin=void 0,s.zmax=void 0,s},e.prototype.ensureMaxLod=function(e){for(;this.levels.length<=e;){var t=this.levels[this.levels.length-1],i=t.resolution/2;this.levels.push({resolution:i,scale:t.scale/2,tileSize:[i*this.pixelSize[0],i*this.pixelSize[1]]})}},e.prototype.capMaxLod=function(e){this.levels.length>e+1&&(this.levels.length=e+1)},e.prototype.getMaxLod=function(){return this.levels.length-1},e.prototype.scaleAtLevel=function(e){return this.levels[0].scale/Math.pow(2,e)},e.prototype.levelAtScale=function(e){var t=this.levels[0].scale;return e>=t?0:Math.log(t/e)*Math.LOG2E},e.prototype.resolutionAtLevel=function(e){return this.levels[0].resolution/Math.pow(2,e)},e.prototype.compatibleWith=function(t){if(!(t instanceof e)){if(e._checkUnsupported(t))return!1;t=new e(t)}if(!t.spatialReference.equals(this.spatialReference))return!1;if(t.pixelSize[0]!==this.pixelSize[0]||t.pixelSize[1]!==this.pixelSize[1])return!1;var i=Math.min(this.levels.length,t.levels.length)-1,r=this.levels[i].resolution,s=.5*r;if(!l.floatEqualAbsolute(t.origin[0],this.origin[0],s)||!l.floatEqualAbsolute(t.origin[1],this.origin[1],s))return!1;var n=Math.max(this.pixelSize[0],this.pixelSize[1]);return s=.5*r/Math.pow(2,i)/n*12,l.floatEqualAbsolute(r,t.levels[i].resolution,s)},e.prototype.rootTilesInExtent=function(t,i,r){var s=this.levels[0].tileSize;e.computeRowColExtent(t,s,this.origin,f);var n=f[1],o=f[3],a=f[0],l=f[2],u=l-a,c=o-n;if(u*c>r){var p=Math.floor(Math.sqrt(r));c>p&&(o=(n=n+Math.floor(.5*c)-Math.floor(.5*p))+p),u>p&&(l=(a=a+Math.floor(.5*u)-Math.floor(.5*p))+p)}for(var h=new Array((l-a)*(o-n)),d=0,y=n;y<o;y++)for(var g=a;g<l;g++)h[d++]=[0,y,g];return i&&(i[0]=this.origin[0]+a*s[0],i[1]=this.origin[1]-o*s[1],i[2]=this.origin[0]+l*s[0],i[3]=this.origin[1]-n*s[1]),h},e.computeRowColExtent=function(e,t,i,r){var s=.001*(e[2]-e[0]+(e[3]-e[1]));r[0]=Math.floor((e[0]+s-i[0])/t[0]),r[2]=Math.ceil((e[2]-s-i[0])/t[0]),r[1]=Math.floor((i[1]-e[3]+s)/t[1]),r[3]=Math.ceil((i[1]-e[1]-s)/t[1])},e.isPowerOfTwo=function(e){var t=e.lods,i=t[0].resolution*Math.pow(2,t[0].level);return!t.some(function(e){return!l.floatEqualRelative(e.resolution,i/Math.pow(2,e.level))})},e.hasGapInLevels=function(e){var t=e.lods.map(function(e){return e.level});t.sort(function(e,t){return e-t});for(var i=1;i<t.length;i++)if(t[i]!==t[0]+i)return!0;return!1},e.tileSizeSupported=function(e){var t=e.size[1];return t===e.size[0]&&0==(t&t-1)&&t>=128&&t<=512},e._checkUnsupported=function(t){return t?t.lods.length<1?new r("tilingscheme:generic","Tiling scheme must have at least one level"):e.isPowerOfTwo(t)?null:new r("tilingscheme:power-of-two","Tiling scheme must be power of two"):new r("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")},e.checkUnsupported=function(t){return e._checkUnsupported(t)||(e.hasGapInLevels(t)?new r("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):e.tileSizeSupported(t)?null:new r("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"))},e.fromExtent=function(t,i){var r=t[2]-t[0],s=t[3]-t[1],n=o.getMetersPerUnitForSR(i),l=1.2*Math.max(r,s),u=new e(new a({size:[256,256],origin:{x:t[0]-.5*(l-r),y:t[3]+.5*(l-s)},lods:[{level:0,resolution:l/256,scale:1/(256/96*.0254/(l*n))}],spatialReference:i}));return u.ensureMaxLod(20),u},e.makeWebMercatorAuxiliarySphere=function(t){void 0===t&&(t=19);var i=new e(e.WebMercatorAuxiliarySphereTileInfo);return i.ensureMaxLod(t),i},e.makeWGS84WithTileSize=function(t,i){void 0===i&&(i=16);var r=256/t,n=new e(new a({size:[t,t],origin:{x:-180,y:90,spatialReference:s.WGS84},spatialReference:s.WGS84,lods:[{level:0,resolution:.703125*r,scale:295497598.570834*r}]}));return n.ensureMaxLod(i),n},e.WebMercatorAuxiliarySphereTileInfo=new a({size:[256,256],origin:{x:-20037508.342787,y:20037508.342787,spatialReference:s.WebMercator},spatialReference:s.WebMercator,lods:[{level:0,resolution:156543.03392800014,scale:591657527.591555}]}),e.WebMercatorAuxiliarySphere=e.makeWebMercatorAuxiliarySphere(19),e}(),f=n.create();return h}.apply(null,r))||(e.exports=s)},793:function(e,t,i){var r,s;r=[i.dj.c(e.i),t,i(380),i(864),i(462)],void 0===(s=function(e,t,i,r,s){return function(){function e(e){this._apiPromises=new Map,this._processingItems=new Map,this._isPaused=!1,this._scheduledNextHandle=null,this.concurrency=1,this.ordered=!1,e.concurrency&&(this.concurrency=e.concurrency),this.ordered=!!e.ordered,this._queue=new r(e.peeker?{peeker:e.peeker}:void 0),this.process=e.process}return Object.defineProperty(e.prototype,"length",{get:function(){return this._processingItems.size+this._queue.length},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this._queue.clear();var e=[];this._processingItems.forEach(function(t){return e.push(t.resultPromise)}),this._processingItems.clear(),e.forEach(function(e){return e.cancel()}),e.length=0,this._apiPromises.forEach(function(t){return e.push(t)}),this._apiPromises.clear(),e.forEach(function(e){return e.cancel()}),this._cancelNext()},e.prototype.find=function(e,t){var i=this,r=void 0;return this._apiPromises.forEach(function(s,n){e.call(t,n)&&(r=i._apiPromises.get(n).promise)}),r},e.prototype.get=function(e){var t=this._apiPromises.get(e);return t&&t.promise||void 0},e.prototype.isOngoing=function(e){return this._processingItems.has(e)},e.prototype.has=function(e){return this._apiPromises.has(e)},e.prototype.pause=function(){this._isPaused||(this._isPaused=!0,this._cancelNext())},e.prototype.push=function(e){var t=this;if(this._apiPromises.has(e))return this._apiPromises.get(e).promise;var r=new i(function(i){var r=t._processingItems.get(e);r?r.resultPromise.cancel(i):(t._remove(e),t._scheduleNext())});return this._add(e,r),this._scheduleNext(),r.promise},e.prototype.reset=function(){var e=[];this._processingItems.forEach(function(t){return e.push(t)}),this._processingItems.clear();for(var t=0,i=e;t<i.length;t++){var r=i[t];r.resultPromise.isFulfilled()?this._processReset(r):(r.isReset=!0,r.resultPromise.cancel())}},e.prototype.resume=function(){this._isPaused&&(this._isPaused=!1,this._scheduleNext())},e.prototype._scheduleNext=function(){var e=this;this._isPaused||this._scheduledNextHandle||(this._scheduledNextHandle=s.schedule(function(){e._scheduledNextHandle=null,e._next()}))},e.prototype._next=function(){for(;this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())},e.prototype._processResult=function(e,t){this._remove(e.item),this._scheduleNext(),e.dfd.resolve(t)},e.prototype._processError=function(e,t){e.isReset?this._processReset(e):(this._remove(e.item),this._scheduleNext(),e.dfd.reject(t))},e.prototype._processReset=function(e){this._remove(e.item),this._add(e.item,e.dfd),this._scheduleNext()},e.prototype._processOrdered=function(e,t){var i=this,r=!1;if(e.isReset)this._processReset(e);else{e.result=t,this._itemsToProcess||(this._itemsToProcess=[]),this._processingItems.forEach(function(e){r||(e.result?i._itemsToProcess.push(e):r=!0)});for(var s=0,n=this._itemsToProcess;s<n.length;s++){var o=n[s];!1===o.result.ok?this._processError(o,o.result.error):this._processResult(o,o.result.value)}this._itemsToProcess.length=0}},e.prototype._process=function(e){var t=this;if(null!=e){var i=this._apiPromises.get(e),r=this.process(e);if(function(e){return e&&"function"==typeof e.then}(r)){var s={item:e,resultPromise:r,result:null,dfd:i,isReset:!1};this._processingItems.set(e,s),this.ordered?r.then(function(e){return t._processOrdered(s,{ok:!0,value:e})},function(e){return t._processOrdered(s,{ok:!1,error:e})}):r.then(function(e){return t._processResult(s,e)},function(e){return t._processError(s,e)})}else i.resolve(r),this._remove(e)}},e.prototype._add=function(e,t){this._apiPromises.set(e,t),this._queue.push(e)},e.prototype._remove=function(e){this._queue.remove(e),this._apiPromises.delete(e),this._processingItems.delete(e)},e.prototype._cancelNext=function(){this._scheduledNextHandle&&(this._scheduledNextHandle.remove(),this._scheduledNextHandle=null)},e}()}.apply(null,r))||(e.exports=s)},864:function(e,t,i){var r,s;r=[i.dj.c(e.i),t],void 0===(s=function(e,t){return function(){function e(e){this._items=[],this._itemSet=new Set,this._peeker=function(e){return e[0]},this._length=0,e&&e.peeker&&(this._peeker=e.peeker)}return Object.defineProperty(e.prototype,"length",{get:function(){return this._length},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this._itemSet.clear(),this._items.length=0,this._length=0},e.prototype.peek=function(){if(0!==this._length)return this._peeker(this._items)},e.prototype.push=function(e){this.contains(e)||this._add(e)},e.prototype.contains=function(e){return this._length>0&&this._itemSet.has(e)},e.prototype.pop=function(){if(0!==this._length){var e=this.peek();return this._remove(e),e}},e.prototype.remove=function(e){this.contains(e)&&this._remove(e)},e.prototype._add=function(e){this._items.push(e),this._itemSet.add(e),this._length++},e.prototype._remove=function(e){this._itemSet.delete(e),this._items.splice(this._items.indexOf(e),1),this._length--},e}()}.apply(null,r))||(e.exports=s)}}]);