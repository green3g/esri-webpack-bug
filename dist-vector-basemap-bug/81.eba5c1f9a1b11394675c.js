(function(){(this||window).webpackJsonp.registerAbsMids({"esri/views/2d/tiling/TileKey":441,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/2d/tiling/TileKey":441,"esri/layers/support/TileInfo":452,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/support/TileInfo":452,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/support/LOD":638,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/2d/libs/gl-matrix/common":655,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/2d/libs/gl-matrix/vec2":683,"esri/views/2d/tiling/enums":706,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/2d/tiling/enums":706,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/2d/tiling/TileSpan":722,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/2d/tiling/TileInfoView":749,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/QueueProcessor":793,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/2d/tiling/LODInfo":806,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/2d/tiling/TileCoverage":807,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/2d/tiling/TileQueue":863,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/Queue":864,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/2d/tiling/TileStrategy":876,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/support/GraphicsManager":1459,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/graphics/controllers/OnDemandController2D":2334,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/graphics/controllers/support/TileSet":2335})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[81],{1459:function(e,t,r){var i,n;i=[r(346)],void 0===(n=function(e){var t=0;return e.createSubclass({constructor:function(){this._deletedGraphicsIndex=new Set,this._intentsIndex=new Map},destroy:function(){this.removeAll(),this._deletedGraphicsIndex=null,this._intentsIndex=null},properties:{graphics:null,indexById:{value:null,dependsOn:["graphics","objectIdField"],get:function(){return this._createIndexById(this.graphics&&this.graphics.toArray(),this.objectIdField)}},numGraphics:{value:0,dependsOn:["indexById"],get:function(){return this.indexById?this.indexById.size:0}},objectIdField:null,updating:{value:!1,dependsOn:["_intentsIndex"],get:function(){return!!(this._intentsIndex&&this._intentsIndex.size>0)}},_intentsIndex:{value:null}},_oldIndex:null,_deletedGraphicsIndex:null,beginPagedUpdate:function(){this._oldIndex=this.indexById,this.indexById=null,this.notifyChange("numGraphics")},addPage:function(e,t){this.add(e,t)},revertPagedUpdate:function(){var e=this._removeLeftOnly(this.indexById,this._oldIndex);this.indexById=this._oldIndex,this._oldIndex=null,this.graphics.removeMany(e),this.notifyChange("numGraphics")},endPagedUpdate:function(){var e=this._removeLeftOnly(this._oldIndex,this.indexById);this._oldIndex=null,this.graphics.removeMany(e),this.notifyChange("numGraphics")},findGraphic:function(e){var t=this.indexById&&this.indexById.get(e);return t&&t.graphic},removeAll:function(){this.indexById=this._oldIndex=null,this.graphics.removeAll(),this.notifyChange("numGraphics")},add:function(e,t){if(e&&e.length){for(var r=this.objectIdField,i=this.indexById=this.indexById||new Map,n=this._oldIndex,o=this._createIndexById(e,r),s=this._extractObjectIds(o),a=this._extractObjectIds(i),l=this._extractObjectIds(n),u=a.concat(l),c=[],h=u.length,p=0;p<h;p++){var f=u[p];s.indexOf(f)>-1&&c.push(f)}c.length&&this._remove(c,!1);var d=this.findIntent(t),y=new Map,g=e.length;for(p=0;p<g;p++){var v=e[p];v&&v.attributes&&y.set(v.attributes[r],d)}e.length&&this._add(e,y)}},remove:function(e){this._remove(e,!1)},delete:function(e){this._remove(e,!0)},isDeleted:function(e){return this._deletedGraphicsIndex.has(e)},createIntentToAdd:function(e){e&&this._intentsIndex.forEach(function(t,r){e.forEach(function(e){t.ignoredIds.add(e)})},this);var r=t++;return this._intentsIndex.set(r,{ignoredIds:new Set}),this.notifyChange("updating"),r},findIntent:function(e){return this._intentsIndex.get(e)},removeIntent:function(e){this._intentsIndex.delete(e),this.notifyChange("updating")},update:function(e,t){if(e&&e.length){for(var r=this.objectIdField,i=this.indexById=this.indexById||new Map,n=this._oldIndex,o=this._createIndexById(e,r),s=this._extractObjectIds(o),a=this._extractObjectIds(i),l=this._extractObjectIds(n),u=a.concat(l),c=[],h=u.length,p=0;p<h;p++){var f=u[p];if(-1===s.indexOf(f))c.push(f);else{var d=i.get(f)||n.get(f),y=d&&d.graphic&&d.graphic._ts,g=o.get(f);(g&&g.graphic&&g.graphic._ts)>y&&c.push(f)}}var v=[],_=s.length;for(p=0;p<_;p++){f=s[p];(-1===u.indexOf(f)||c.indexOf(f)>-1)&&v.push(f)}c.length&&this._remove(c,!1),v.length&&this._add(this._extractGraphics(v,o),t)}},_createIndexById:function(e,t){var r,i,n,o;if(e&&e.length&&t)for(r=new Map,i=0;n=e[i];i++)null!=(o=n.attributes&&n.attributes[t])&&r.set(o,{graphic:n,refCount:1});return r},_add:function(e,t){var r=this.objectIdField;e.forEach(function(e){var i=e.attributes&&e.attributes[r],n=t.get(i);this._addToIndex(e,this.indexById,n)},this),this.graphics.addMany(e),this.notifyChange("numGraphics")},_addToIndex:function(e,t,r){var i=e.attributes&&e.attributes[this.objectIdField];if(t&&null!=i)if(t.has(i)){if(!r||!r.ignoredIds.has(i)){var n=t.get(i);t.set(i,{graphic:e,refCount:n.refCount+1})}}else this.isDeleted(i)||t.set(i,{graphic:e,refCount:1})},_remove:function(e,t){var r;r="object"==typeof(e=e||[])[0]?e.map(function(e){return e.attributes&&e.attributes[this.objectIdField]}.bind(this)):e;var i=this._extractGraphics(r,this._oldIndex),n=this._extractGraphics(r,this.indexById);r.forEach(function(e){t&&this._deletedGraphicsIndex.add(e),this._removeFromIndex(e,this._oldIndex,t),this._removeFromIndex(e,this.indexById,t)}.bind(this)),this.graphics.removeMany(i.concat(n)),this.notifyChange("numGraphics")},_removeFromIndex:function(e,t,r){if(t&&t.has(e))if(r)t.delete(e);else{var i=t.get(e),n=i.refCount-1;0===n?t.delete(e):i.refCount=n}},_removeLeftOnly:function(e,t){var r=[];return e&&e.forEach(function(i,n){var o=i.graphic;!o||t&&t.has(n)||(i.refCount=i.refCount-1,0===i.refCount&&e.delete(n),r.push(o))}),r},_extractGraphics:function(e,t){return e&&t?e.map(function(e){var r=t.get(e);return r&&r.graphic}):[]},_extractObjectIds:function(e){var t=[];return e&&e.forEach(function(e,r){t.push(r)}),t}})}.apply(null,i))||(e.exports=n)},2334:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(337),r(335),r(346),r(341),r(449),r(365),r(343),r(624),r(339),r(336),r(367),r(2335),r(1459),r(452),r(706),r(749),r(441),r(863),r(876)],void 0===(n=function(e,t,r,i,n,o,s,a,l,u,c,h,p,f,d,y,g,v,_,m,w){var I=l.getLogger("esri.views.2d.layers.MapImageLayerView2D"),x=function(){function e(){this.key=new _(0,0,0,0),this.status=g.TileStatus.INITIALIZED}return e.prototype.dispose=function(){},e}();return function(e){function t(t){var r=e.call(this)||this;return r._handles=new a,r._pendingQueries=new Map,r._tileRequests=new Map,r.layer=t.layer,r.layerView=t.layerView,r.graphics=t.graphics,r._tileInfo=y.create({spatialReference:r.layerView.view.spatialReference,size:512}),r._tileInfoView=new v(r._tileInfo),r._tileQueue=new m({tileInfoView:r._tileInfoView,process:function(e){return r._fetchTile(e)}}),r._tileSet=new f({layer:r.layer,tileInfo:r._tileInfo}),r._graphicsManager=new d({graphics:r.graphics,objectIdField:r.layer.objectIdField}),r._tileStrategy=new w({cachePolicy:"purge",acquireTile:function(e){return r._acquireTile(e)},releaseTile:function(e){return r._releaseTile(e)},tileInfoView:r._tileInfoView}),r._handles.add([r.layer.watch("outFields",function(e,t){if(e&&t){if(-1!==t.indexOf("*"))return;e.sort(),t.sort(),JSON.stringify(e)!==JSON.stringify(t)&&r.refresh()}else r.refresh()}),r.layer.watch("definitionExpression, historicMoment",function(){return r.refresh()}),r.layer.on("edits",function(e){return r._editsHandler(e)})],"layer"),r}return r(t,e),t.prototype.destroy=function(){var e=this;this._pendingQueries.forEach(function(e){e.isFulfilled()||e.cancel()}),this._tileStrategy.tiles.forEach(function(t){return e._releaseTile(t)}),this._handles.destroy(),this._graphicsManager.destroy(),this._tileStrategy.destroy(),this._tileQueue.clear(),this._tileRequests.clear()},Object.defineProperty(t.prototype,"graphics",{set:function(e){var t=this,r=this._get("graphics");r!==e&&(this._handles.remove("graphics"),r&&r.forEach(function(e){e.layer=null,e.sourceLayer=null}),e&&(e.forEach(function(e){e.layer=t.layer,e.sourceLayer=t.layer}),this._handles.add([e.on("after-add",function(e){e.item.layer=t.layer,e.item.sourceLayer=t.layer}),e.on("after-remove",function(e){e.item.layer=null})],"graphics")),this._set("graphics",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return this._tileQueue.length>0||this.get("_graphicsManager.updating")},enumerable:!0,configurable:!0}),t.prototype.update=function(e){var t=this;this._tileQueue.pause(),this._tileQueue.state=e.state,this._tileStrategy.update(e);var r=this.layer.objectIdField,i=new Map,n=this._tileStrategy.tiles.reduce(function(e,n){if(n.featureSet){var o=t._graphicsManager.findIntent(n.intentId);n.featureSet.features.forEach(function(t){t&&t.attributes&&(i.set(t.attributes[r],o),e.push(t))})}return e},[]);this._graphicsManager.update(n,i),this._tileQueue.resume(),this.notifyChange("updating")},t.prototype.refresh=function(){var e=this;this._tileQueue.reset(),this._graphicsManager.removeAll(),this._tileStrategy.tiles.forEach(function(t){var r=e._graphicsManager.createIntentToAdd();e.notifyChange("updating");var i=e._tileSet.fetch(t.key).then(function(i){return t.intentId=r,t.featureSet=i,e._graphicsManager.add(t.featureSet.features,t.intentId),t});return i.always(function(){e._graphicsManager.removeIntent(r),e.notifyChange("updating")}),i}),this.notifyChange("updating")},t.prototype._acquireTile=function(e){var t=this,r=new x;r.key.set(e);var i=this._tileQueue.push(r.key).then(function(e){r.status=g.TileStatus.READY,r.attached=!0,r.featureSet=e.featureSet,r.intentId=e.intentId,t._graphicsManager.removeIntent(r.intentId),t.layerView.requestUpdate()});return this._tileRequests.set(r,i),this.notifyChange("updating"),r},t.prototype._releaseTile=function(e){if(this._tileRequests.has(e)){var t=this._tileRequests.get(e);t.isFulfilled()||t.cancel(),this._tileRequests.delete(e),this.layerView.requestUpdate()}},t.prototype._fetchTile=function(e){var t=this,r=this._graphicsManager.createIntentToAdd(),i=this._tileSet.fetch(e).then(function(e){for(var t=Date.now(),i=0,n=e.features;i<n.length;i++)n[i]._ts=t;return{featureSet:e,intentId:r}});return i.catch(function(e){if(t._graphicsManager.removeIntent(r),e&&"cancel"===e.dojoType)return c.reject(e);var i=new o("ondemandcontroller2d:tile-request-failed","Failed to query for features",{error:e});return I.error(i),c.reject(i)}),i},t.prototype._editsHandler=function(e){var t=this,r=function(e){return e.objectId},i=e.deletedFeatures.map(r);this._graphicsManager.delete(i);var n=e.addedFeatures.concat(e.updatedFeatures).map(r);if(n.length){var o=this.layer.createQuery();o.objectIds=n,o.outSpatialReference=this._tileInfo.spatialReference;var s=this._graphicsManager.createIntentToAdd(n),a=this.layer.queryFeatures(o);this._pendingQueries.set(s,a),this.notifyChange("updating"),a.then(function(e){return t._refetchHandler(e,s)}).always(function(){t._graphicsManager.removeIntent(s),t._pendingQueries.delete(s),t.notifyChange("updating")})}},t.prototype._refetchHandler=function(e,t){var r=this,i=e.features;if(i){for(var n=this._tileInfo.spatialReference,o=0,s=this._tileStrategy.tiles;o<s.length;o++){!function(e){var t=e.key.extent,o=p.toExtent(t,n);i.forEach(function(t){t.geometry&&o.intersects(t.geometry)&&r._addFeatureToTile(t,e)})}(s[o])}this._graphicsManager.add(i,t)}},t.prototype._addFeatureToTile=function(e,t){var r,i=t.featureSet.features||[],n=this.layer.objectIdField,o=e.attributes&&e.attributes[n];i.some(function(e){return(e.attributes&&e.attributes[n])===o&&(r=e),!!r}),r?(r.geometry=e.geometry,r.attributes=e.attributes):i.push(e),t.featureSet.features=i},i([h.property()],t.prototype,"graphics",null),i([h.property()],t.prototype,"layer",void 0),i([h.property()],t.prototype,"layerView",void 0),i([h.property()],t.prototype,"updating",null),i([h.subclass("esri.layers.graphics.controllers.OnDemandController2D")],t)}(h.declared(n,u,s))}.apply(null,i))||(e.exports=n)},2335:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(367),r(1084)],void 0===(n=function(e,t,r,i){return function(){function e(e){this.layer=e.layer,this.tileInfo=e.tileInfo}return e.prototype.fetch=function(e){return this._queryTile(e)},e.prototype._queryTile=function(e){return this.layer.queryFeatures(this._createQuery(e))},e.prototype._createQuery=function(e){this.tileInfo.updateTileInfo(e);var t=this.tileInfo.spatialReference,i=this.layer.createQuery();return i.geometry=r.toExtent(e.extent,t),i.outSpatialReference=t,this._setResolutionParams(i,e),i},e.prototype._setResolutionParams=function(e,t){var r=this.layer,n=r.geometryType;if("polyline"===n||"polygon"===n){var o=this.tileInfo.lodAt(t.level).resolution;"polyline"===n&&(e.maxAllowableOffset=o),r.get("capabilities.query.supportsQuantization")&&(e.quantizationParameters=new i.default({mode:"view",originPosition:"upper-left",tolerance:o,extent:r.fullExtent}))}},e}()}.apply(null,i))||(e.exports=n)},441:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(413)],void 0===(n=function(e,t,r){return function(){function e(e,t,r,i){this.set(e,t,r,i)}return e.from=function(t,r,i,n){return e.pool.acquire(t,r,i,n)},e.getId=function(e,t,r,i){return"object"==typeof e?e.level+"/"+e.row+"/"+e.col+"/"+e.world:e+"/"+t+"/"+r+"/"+i},Object.defineProperty(e.prototype,"key",{get:function(){return this},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.toString()},enumerable:!0,configurable:!0}),e.prototype.equals=function(e){return this.level===e.level&&this.row===e.row&&this.col===e.col&&this.world===e.world},e.prototype.release=function(){this.level=0,this.row=0,this.col=0,this.world=0},e.prototype.set=function(e,t,r,i){if(null==e)this.level=0,this.row=0,this.col=0,this.world=0;else if("object"==typeof e)this.level=e.level||0,this.row=e.row||0,this.col=e.col||0,this.world=e.world||0;else if("string"==typeof e){var n=e.split("/"),o=n[0],s=n[1],a=n[2],l=n[3];this.level=parseFloat(o),this.row=parseFloat(s),this.col=parseFloat(a),this.world=parseFloat(l)}else this.level=+e,this.row=+t,this.col=+r,this.world=+i||0;return this},e.prototype.toString=function(){return this.level+"/"+this.row+"/"+this.col+"/"+this.world},e.prototype.getChildKeys=function(){var t=this.level+1,r=this.row<<1,i=this.col<<1,n=this.world;return[e.pool.acquire(t,r,i,n),e.pool.acquire(t,r,i+1,n),e.pool.acquire(t,r+1,i,n),e.pool.acquire(t,r+1,i+1,n)]},e.prototype._compare=function(e){return this.row<e.row?-1:this.row>e.row?1:this.col<e.col?-1:this.col>e.col?1:0},e.sort=function(t){return t.map(function(t){return e.from(t)}).sort(function(e,t){return e._compare(t)}).map(function(e){return e.id})},e.pool=new r(e,!0,null,25,50),e}()}.apply(null,i))||(e.exports=n)},452:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(344),r(337),r(335),r(364),r(340),r(347),r(336),r(360),r(367),r(443),r(409),r(386),r(638)],void 0===(n=function(e,t,r,i,n,o,s,a,l,u,c,h,p,f,d){var y=a({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc"});return function(e){function t(t){var r=e.call(this)||this;return r.dpi=96,r.format=null,r.origin=null,r.minScale=0,r.maxScale=0,r.size=null,r.spatialReference=null,r}var s;return i(t,e),s=t,t.create=function(e){void 0===e&&(e={size:256,spatialReference:o.SpatialReference.WebMercator});var t=e.resolutionFactor||1,r=e.scales,i=e.size||256,n=e.spatialReference||o.SpatialReference.WebMercator,a=p.getInfo(n),l=a?new o.Point(a.origin[0],a.origin[1],n):new o.Point(0,0,n),u=1/(39.37*h.getMetersPerUnitForSR(n)*96),c=[];if(r)for(var f=0;f<r.length;f++){var d=(v=r[f])*u;c.push({level:f,scale:v,resolution:d})}else{var y=p.isGeographic(n)?512/i*147748799.285417:256/i*591657527.591555,g=Math.ceil(24/t);c.push({level:0,scale:y,resolution:y*u});for(f=1;f<g;f++){var v;d=(v=y/Math.pow(2,t))*u;c.push({level:f,scale:v,resolution:d}),y=v}}return new s({dpi:96,lods:c,origin:l,size:i,spatialReference:n})},Object.defineProperty(t.prototype,"isWrappable",{get:function(){var e=this.spatialReference,t=this.origin;if(e&&t){var r=p.getInfo(e);return e.isWrappable&&Math.abs(r.origin[0]-t.x)<=r.dx}return!1},enumerable:!0,configurable:!0}),t.prototype.readOrigin=function(e,t){return o.Point.fromJSON(r({spatialReference:t.spatialReference},e))},Object.defineProperty(t.prototype,"lods",{set:function(e){var t=this,r=0,i=0,n=[];this._levelToLOD={},e&&(r=-1/0,i=1/0,e.forEach(function(e){n.push(e.scale),r=e.scale>r?e.scale:r,i=e.scale<i?e.scale:i,t._levelToLOD[e.level]=e})),this._set("scales",n),this._set("minScale",r),this._set("maxScale",i),this._set("lods",e),this._initializeUpsampleLevels()},enumerable:!0,configurable:!0}),t.prototype.readSize=function(e,t){return[t.cols,t.rows]},t.prototype.writeSize=function(e,t){t.cols=e[0],t.rows=e[0]},t.prototype.zoomToScale=function(e){var t=this.scales;if(e<=0)return t[0];if(e>=t.length)return t[t.length-1];var r=Math.round(e-.5),i=Math.round(e);return t[i]+(i-e)*(t[r]-t[i])},t.prototype.scaleToZoom=function(e){for(var t=this.scales,r=t.length-1,i=0;i<r;i++){var n=t[i],o=t[i+1];if(n<=e)return i;if(o===e)return i+1;if(n>e&&o<e)return i+1-(e-o)/(n-o)}return i},t.prototype.snapScale=function(e,t){void 0===t&&(t=.95);var r=this.scaleToZoom(e);return r%Math.floor(r)>=t?this.zoomToScale(Math.ceil(r)):this.zoomToScale(Math.floor(r))},t.prototype.tileAt=function(e,t,r,i){var n,o,s=this.lodAt(e);if(!s)return null;if("number"==typeof t)n=t,o=r;else if(p.equals(t.spatialReference,this.spatialReference))n=t.x,o=t.y,i=r;else{var a=f.project(t,this.spatialReference);if(!a)return null;n=a.x,o=a.y,i=r}var l=s.resolution*this.size[0],u=s.resolution*this.size[1];return i||(i={id:null,level:0,row:0,col:0,extent:c.create()}),i.level=e,i.row=Math.floor((this.origin.y-o)/u+.001),i.col=Math.floor((n-this.origin.x)/l+.001),this.updateTileInfo(i),i},t.prototype.updateTileInfo=function(e){var t=this.lodAt(e.level);if(t){var r=t.resolution*this.size[0],i=t.resolution*this.size[1];e.id=e.level+"/"+e.row+"/"+e.col,e.extent||(e.extent=c.create()),e.extent[0]=this.origin.x+e.col*r,e.extent[1]=this.origin.y-(e.row+1)*i,e.extent[2]=e.extent[0]+r,e.extent[3]=e.extent[1]+i}},t.prototype.upsampleTile=function(e){var t=this._upsampleLevels[e.level];return!(!t||-1===t.parentLevel||(e.level=t.parentLevel,e.row=Math.floor(e.row/t.factor+.001),e.col=Math.floor(e.col/t.factor+.001),this.updateTileInfo(e),0))},t.prototype.getTileBounds=function(e,t){var r=this.lodAt(t.level).resolution,i=r*this.size[0],n=r*this.size[1];return e[0]=this.origin.x+t.col*i,e[1]=this.origin.y-(t.row+1)*n,e[2]=e[0]+i,e[3]=e[1]+n,e},t.prototype.lodAt=function(e){return this._levelToLOD&&this._levelToLOD[e]||null},t.prototype.clone=function(){return s.fromJSON(this.write({}))},t.prototype._initializeUpsampleLevels=function(){var e=this.lods;this._upsampleLevels=[];for(var t=null,r=0;r<e.length;r++){var i=e[r];this._upsampleLevels[i.level]={parentLevel:t?t.level:-1,factor:t?t.resolution/i.resolution:0},t=i}},n([l.property({type:Number,json:{write:!0}})],t.prototype,"compressionQuality",void 0),n([l.property({type:Number,json:{write:!0}})],t.prototype,"dpi",void 0),n([l.property({type:String,json:{read:y.read,write:y.write}})],t.prototype,"format",void 0),n([l.property({readOnly:!0,dependsOn:["spatialReference","origin"]})],t.prototype,"isWrappable",null),n([l.property({type:o.Point,json:{write:!0}})],t.prototype,"origin",void 0),n([l.reader("origin")],t.prototype,"readOrigin",null),n([l.property({type:[d],value:null,json:{write:!0}})],t.prototype,"lods",null),n([l.property({readOnly:!0})],t.prototype,"minScale",void 0),n([l.property({readOnly:!0})],t.prototype,"maxScale",void 0),n([l.property({readOnly:!0})],t.prototype,"scales",void 0),n([l.property({cast:function(e){return Array.isArray(e)?e:"number"==typeof e?[e,e]:[256,256]}})],t.prototype,"size",void 0),n([l.reader("size",["rows","cols"])],t.prototype,"readSize",null),n([l.writer("size",{cols:{type:u.Integer},rows:{type:u.Integer}})],t.prototype,"writeSize",null),n([l.property({type:o.SpatialReference,json:{write:!0}})],t.prototype,"spatialReference",void 0),s=n([l.subclass("esri.layers.support.TileInfo")],t)}(l.declared(s))}.apply(null,i))||(e.exports=n)},638:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(337),r(335),r(340),r(336),r(360)],void 0===(n=function(e,t,r,i,n,o,s){return function(e){function t(t){var r=e.call(this,t)||this;return r.level=0,r.levelValue=null,r.resolution=0,r.scale=0,r}var n;return r(t,e),n=t,t.prototype.clone=function(){return new n({level:this.level,levelValue:this.levelValue,resolution:this.resolution,scale:this.scale})},i([o.property({type:s.Integer,json:{write:!0}})],t.prototype,"level",void 0),i([o.property({type:String,json:{write:!0}})],t.prototype,"levelValue",void 0),i([o.property({type:Number,json:{write:!0}})],t.prototype,"resolution",void 0),i([o.property({type:Number,json:{write:!0}})],t.prototype,"scale",void 0),n=i([o.subclass("esri.layers.support.LOD")],t)}(o.declared(n))}.apply(null,i))||(e.exports=n)},655:function(e,t,r){var i;void 0===(i=function(){if(!e)var e=1e-6;if(!t)var t="undefined"!=typeof Float32Array?Float32Array:Array;if(!r)var r=Math.random;var i={GLMAT_EPSILON:e,GLMAT_ARRAY_TYPE:t,GLMAT_RANDOM:r,setMatrixArrayType:function(e){i.GLMAT_ARRAY_TYPE=e}},n=Math.PI/180,o=180/Math.PI;return i.toRadian=function(e){return e*n},i.toDegree=function(e){return e*o},i.setMatrixArrayType(Array),i}.apply(null,[]))||(e.exports=i)},683:function(e,t,r){var i,n;i=[r(655)],void 0===(n=function(e){var t=e.GLMAT_ARRAY_TYPE,r=e.GLMAT_RANDOM,i={create:function(){var e=new t(2);return e[0]=0,e[1]=0,e},clone:function(e){var r=new t(2);return r[0]=e[0],r[1]=e[1],r},fromValues:function(e,r){var i=new t(2);return i[0]=e,i[1]=r,i},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e},set:function(e,t,r){return e[0]=t,e[1]=r,e},add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e},subtract:function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}};return i.sub=i.subtract,i.multiply=function(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e},i.mul=i.multiply,i.divide=function(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e},i.div=i.divide,i.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e},i.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e},i.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e},i.scaleAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e},i.distance=function(e,t){var r=t[0]-e[0],i=t[1]-e[1];return Math.sqrt(r*r+i*i)},i.dist=i.distance,i.squaredDistance=function(e,t){var r=t[0]-e[0],i=t[1]-e[1];return r*r+i*i},i.sqrDist=i.squaredDistance,i.length=function(e){var t=e[0],r=e[1];return Math.sqrt(t*t+r*r)},i.len=i.length,i.squaredLength=function(e){var t=e[0],r=e[1];return t*t+r*r},i.sqrLen=i.squaredLength,i.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},i.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},i.normalize=function(e,t){var r=t[0],i=t[1],n=r*r+i*i;return n>0&&(n=1/Math.sqrt(n),e[0]=t[0]*n,e[1]=t[1]*n),e},i.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},i.cross=function(e,t,r){var i=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=i,e},i.lerp=function(e,t,r,i){var n=t[0],o=t[1];return e[0]=n+i*(r[0]-n),e[1]=o+i*(r[1]-o),e},i.random=function(e,t){t=t||1;var i=2*r()*Math.PI;return e[0]=Math.cos(i)*t,e[1]=Math.sin(i)*t,e},i.transformMat2=function(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n,e[1]=r[1]*i+r[3]*n,e},i.transformMat2d=function(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n+r[4],e[1]=r[1]*i+r[3]*n+r[5],e},i.transformMat3=function(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[3]*n+r[6],e[1]=r[1]*i+r[4]*n+r[7],e},i.transformMat4=function(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[4]*n+r[12],e[1]=r[1]*i+r[5]*n+r[13],e},i.forEach=function(){var e=i.create();return function(t,r,i,n,o,s){var a,l;for(r||(r=2),i||(i=0),l=n?Math.min(n*r+i,t.length):t.length,a=i;a<l;a+=r)e[0]=t[a],e[1]=t[a+1],o(e,e,s),t[a]=e[0],t[a+1]=e[1];return t}}(),i.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},i}.apply(null,i))||(e.exports=n)},706:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.INITIALIZED=0]="INITIALIZED",e[e.NO_DATA=1]="NO_DATA",e[e.READY=2]="READY",e[e.MODIFIED=3]="MODIFIED",e[e.INVALID=4]="INVALID"}(t.TileStatus||(t.TileStatus={}))}.apply(null,i))||(e.exports=n)},722:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(413)],void 0===(n=function(e,t,r){return function(){function e(e,t,r){this.row=e,this.colFrom=t,this.colTo=r}return e.pool=new r(e,!0),e}()}.apply(null,i))||(e.exports=n)},749:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(409),r(806),r(807),r(441),r(722)],void 0===(n=function(e,t,r,i,n,o,s){var a=new o("0/0/0/0"),l=function(){function e(e,t,r,i,n,o,s,a){this.x=e,this.ymin=t,this.ymax=r,this.invM=i,this.leftAdjust=n,this.rightAdjust=o,this.leftBound=s,this.rightBound=a}return e.create=function(t,r){var i;t[1]>r[1]&&(t=(i=[r,t])[0],r=i[1]);var n=t[0],o=t[1],s=r[0],a=r[1],l=s-n,u=a-o,c=0!==u?l/u:0,h=(Math.ceil(o)-o)*c,p=(Math.floor(o)-o)*c;return new e(n,Math.floor(o),Math.ceil(a),c,l<0?h:p,l<0?p:h,l<0?s:n,l<0?n:s)},e.prototype.incrRow=function(){this.x+=this.invM},e.prototype.getLeftCol=function(){return Math.max(this.x+this.leftAdjust,this.leftBound)},e.prototype.getRightCol=function(){return Math.min(this.x+this.rightAdjust,this.rightBound)},e}(),u=[[0,0],[0,0],[0,0],[0,0]];return function(){function e(e,t){var r=this;this.tileInfo=e,this.fullExtent=t,this.scales=[],this._lodInfos=null,this._infoByScale={},this._infoByLevel={};var n=e.lods.slice();n.sort(function(e,t){return t.scale-e.scale});var o=this._lodInfos=n.map(function(r){return i.create(e,r,t)});n.forEach(function(e,t){r._infoByLevel[e.level]=o[t],r._infoByScale[e.scale]=o[t],r.scales[t]=e.scale},this),this._wrap=e.isWrappable}return e.prototype.getLODInfoAt=function(e){return this._infoByLevel[e.level]},e.prototype.getTileBounds=function(e,t,r){void 0===r&&(r=!1),a.set(t);var i=this._infoByLevel[a.level];return i?i.getTileBounds(e,a,r):e},e.prototype.getTileCoords=function(e,t,r){void 0===r&&(r=!1),a.set(t);var i=this._infoByLevel[a.level];return i?i.getTileCoords(e,a,r):e},e.prototype.getTileCoverage=function(e,t){void 0===t&&(t=192);var r,i,o,a=this.getClosestInfoForScale(e.scale),c=n.pool.acquire(a),h=this._wrap,p=1/0,f=-1/0,d=c.spans;u[0][0]=u[0][1]=u[1][1]=u[3][0]=-t,u[1][0]=u[2][0]=e.size[0]+t,u[2][1]=u[3][1]=e.size[1]+t;for(var y=0,g=u;y<g.length;y++){var v=g[y];e.toMap(v,v),v[0]=a.getColumnForX(v[0]),v[1]=a.getRowForY(v[1])}for(var _=[],m=3,w=0;w<4;w++)if(u[w][1]!==u[m][1]){var I=l.create(u[w],u[m]);p=Math.min(I.ymin,p),f=Math.max(I.ymax,f),void 0===_[I.ymin]&&(_[I.ymin]=[]),_[I.ymin].push(I),m=w}else m=w;if(null==p||null==f||f-p>100)return null;var x=[];for(r=p;r<f;){null!=_[r]&&(x=x.concat(_[r])),i=1/0,o=-1/0;for(w=x.length-1;w>=0;w--){I=x[w];i=Math.min(i,I.getLeftCol()),o=Math.max(o,I.getRightCol())}if(i=Math.floor(i),o=Math.floor(o),r>=a.first[1]&&r<=a.last[1])if(h)if(a.size[0]<a.worldSize[0]){var b=Math.floor(o/a.worldSize[0]);for(w=Math.floor(i/a.worldSize[0]);w<=b;w++)d.push(new s(r,Math.max(a.getFirstColumnForWorld(w),i),Math.min(a.getLastColumnForWorld(w),o)))}else d.push(new s(r,i,o));else i>a.last[0]||o<a.first[0]||(i=Math.max(i,a.first[0]),o=Math.min(o,a.last[0]),d.push(new s(r,i,o)));r+=1;for(w=x.length-1;w>=0;w--){(I=x[w]).ymax>=r?I.incrRow():x.splice(w,1)}}return c},e.prototype.getTileIdAtParent=function(e,t){var r=o.pool.acquire(t),i=this._infoByLevel[r.level];if(e.resolution<i.resolution)throw new Error("Cannot calculate parent tile. destination LOD's resolution "+e.resolution+" is not a parent resolution of "+i.resolution);if(e.resolution===i.resolution)return r.id;var n=Math.floor(r.col*i.resolution/e.resolution+.01),s=Math.floor(r.row*i.resolution/e.resolution+.01);return o.getId(e.level,s,n,r.world)},e.prototype.getTileParentId=function(e){var t=o.pool.acquire(e),r=this._infoByLevel[t.level],i=this._lodInfos.indexOf(r)-1;if(i<0)return o.pool.release(t),null;var n=this._lodInfos[i],s=this.getTileIdAtParent(n,t);return o.pool.release(t),s},e.prototype.getTileResolution=function(e){var t=this._infoByLevel["object"==typeof e?e.level:e];return t?t.resolution:-1},e.prototype.getTileScale=function(e){var t=this._infoByLevel[e.level];return t?t.scale:-1},e.prototype.intersects=function(e,t){var r=o.pool.acquire(t),i=this._infoByLevel[r.level],n=e.lodInfo;if(n.resolution>i.resolution){var s=o.pool.acquire(this.getTileIdAtParent(n,r)),a=n.denormalizeCol(s.col,s.world),l=e.spans.some(function(e){return e.row===s.row&&e.colFrom<=a&&e.colTo>=a});return o.pool.release(r),o.pool.release(s),l}if(n.resolution<i.resolution){var u=e.spans.reduce(function(e,t){return e[0]=Math.min(e[0],t.row),e[1]=Math.max(e[1],t.row),e[2]=Math.min(e[2],t.colFrom),e[3]=Math.max(e[3],t.colTo),e},[1/0,-1/0,1/0,-1/0]),c=u[0],h=u[1],p=u[2],f=u[3],d=i.denormalizeCol(r.col,r.world),y=n.getColumnForX(i.getXForColumn(d)),g=n.getRowForY(i.getYForRow(r.row)),v=n.getColumnForX(i.getXForColumn(d+1))-1,_=n.getRowForY(i.getYForRow(r.row+1))-1;return o.pool.release(r),!(y>f||v<p||g>h||_<c)}var m=n.denormalizeCol(r.col,r.world),w=e.spans.some(function(e){return e.row===r.row&&e.colFrom<=m&&e.colTo>=m});return o.pool.release(r),w},e.prototype.normalizeBounds=function(e,t,i){if(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],this._wrap){var n=r.getInfo(this.tileInfo.spatialReference),o=-i*(n.valid[1]-n.valid[0]);e[0]+=o,e[2]+=o}return e},e.prototype.getClosestInfoForScale=function(e){var t=this.scales;return this._infoByScale[e]?this._infoByScale[e]:(e=t.reduce(function(t,r,i,n){return Math.abs(r-e)<Math.abs(t-e)?r:t},t[0]),this._infoByScale[e])},e.prototype.scaleToLevel=function(e){var t=this.scales;if(this._infoByScale[e])return this._infoByScale[e].level;for(var r=t.length-1;r>=0;r--)if(e<t[r]){return r===t.length-1?this._infoByScale[t[t.length-1]].level:this._infoByScale[t[r]].level+(t[r]-e)/(t[r]-t[r+1])}return this._infoByScale[t[0]].level},e}()}.apply(null,i))||(e.exports=n)},793:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(380),r(864),r(462)],void 0===(n=function(e,t,r,i,n){return function(){function e(e){this._apiPromises=new Map,this._processingItems=new Map,this._isPaused=!1,this._scheduledNextHandle=null,this.concurrency=1,this.ordered=!1,e.concurrency&&(this.concurrency=e.concurrency),this.ordered=!!e.ordered,this._queue=new i(e.peeker?{peeker:e.peeker}:void 0),this.process=e.process}return Object.defineProperty(e.prototype,"length",{get:function(){return this._processingItems.size+this._queue.length},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this._queue.clear();var e=[];this._processingItems.forEach(function(t){return e.push(t.resultPromise)}),this._processingItems.clear(),e.forEach(function(e){return e.cancel()}),e.length=0,this._apiPromises.forEach(function(t){return e.push(t)}),this._apiPromises.clear(),e.forEach(function(e){return e.cancel()}),this._cancelNext()},e.prototype.find=function(e,t){var r=this,i=void 0;return this._apiPromises.forEach(function(n,o){e.call(t,o)&&(i=r._apiPromises.get(o).promise)}),i},e.prototype.get=function(e){var t=this._apiPromises.get(e);return t&&t.promise||void 0},e.prototype.isOngoing=function(e){return this._processingItems.has(e)},e.prototype.has=function(e){return this._apiPromises.has(e)},e.prototype.pause=function(){this._isPaused||(this._isPaused=!0,this._cancelNext())},e.prototype.push=function(e){var t=this;if(this._apiPromises.has(e))return this._apiPromises.get(e).promise;var i=new r(function(r){var i=t._processingItems.get(e);i?i.resultPromise.cancel(r):(t._remove(e),t._scheduleNext())});return this._add(e,i),this._scheduleNext(),i.promise},e.prototype.reset=function(){var e=[];this._processingItems.forEach(function(t){return e.push(t)}),this._processingItems.clear();for(var t=0,r=e;t<r.length;t++){var i=r[t];i.resultPromise.isFulfilled()?this._processReset(i):(i.isReset=!0,i.resultPromise.cancel())}},e.prototype.resume=function(){this._isPaused&&(this._isPaused=!1,this._scheduleNext())},e.prototype._scheduleNext=function(){var e=this;this._isPaused||this._scheduledNextHandle||(this._scheduledNextHandle=n.schedule(function(){e._scheduledNextHandle=null,e._next()}))},e.prototype._next=function(){for(;this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())},e.prototype._processResult=function(e,t){this._remove(e.item),this._scheduleNext(),e.dfd.resolve(t)},e.prototype._processError=function(e,t){e.isReset?this._processReset(e):(this._remove(e.item),this._scheduleNext(),e.dfd.reject(t))},e.prototype._processReset=function(e){this._remove(e.item),this._add(e.item,e.dfd),this._scheduleNext()},e.prototype._processOrdered=function(e,t){var r=this,i=!1;if(e.isReset)this._processReset(e);else{e.result=t,this._itemsToProcess||(this._itemsToProcess=[]),this._processingItems.forEach(function(e){i||(e.result?r._itemsToProcess.push(e):i=!0)});for(var n=0,o=this._itemsToProcess;n<o.length;n++){var s=o[n];!1===s.result.ok?this._processError(s,s.result.error):this._processResult(s,s.result.value)}this._itemsToProcess.length=0}},e.prototype._process=function(e){var t=this;if(null!=e){var r=this._apiPromises.get(e),i=this.process(e);if(function(e){return e&&"function"==typeof e.then}(i)){var n={item:e,resultPromise:i,result:null,dfd:r,isReset:!1};this._processingItems.set(e,n),this.ordered?i.then(function(e){return t._processOrdered(n,{ok:!0,value:e})},function(e){return t._processOrdered(n,{ok:!1,error:e})}):i.then(function(e){return t._processResult(n,e)},function(e){return t._processError(n,e)})}else r.resolve(i),this._remove(e)}},e.prototype._add=function(e,t){this._apiPromises.set(e,t),this._queue.push(e)},e.prototype._remove=function(e){this._queue.remove(e),this._apiPromises.delete(e),this._processingItems.delete(e)},e.prototype._cancelNext=function(){this._scheduledNextHandle&&(this._scheduledNextHandle.remove(),this._scheduledNextHandle=null)},e}()}.apply(null,i))||(e.exports=n)},806:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(409),r(441)],void 0===(n=function(e,t,r,i){function n(e,t){return[e,t]}function o(e,t,r){return e[0]=t,e[1]=r,e}var s=new i("0/0/0/0");return function(){function e(e,t,r,i,n,o,s,a,l,u,c,h){this.level=e,this.resolution=t,this.scale=r,this.origin=i,this.first=n,this.last=o,this.size=s,this.norm=a,this.worldStart=l,this.worldEnd=u,this.worldSize=c,this.wrap=h}return e.create=function(t,i,s){var a,l,u,c,h=r.getInfo(t.spatialReference),p=n(t.origin.x,t.origin.y),f=n(t.size[0]*i.resolution,t.size[1]*i.resolution),d=n(-1/0,-1/0),y=n(1/0,1/0),g=n(1/0,1/0);return s&&(o(d,Math.max(0,Math.floor((s.xmin-p[0])/f[0])),Math.max(0,Math.floor((p[1]-s.ymax)/f[1]))),o(y,Math.max(0,Math.floor((s.xmax-p[0])/f[0])),Math.max(0,Math.floor((p[1]-s.ymin)/f[1]))),o(g,y[0]-d[0]+1,y[1]-d[1]+1)),t.isWrappable?(a=n(Math.ceil(Math.round(2*h.origin[1]/i.resolution)/t.size[0]),g[1]),l=n(Math.floor((h.origin[0]-p[0])/f[0]),d[1]),u=n(a[0]+l[0]-1,y[1]),c=!0):(l=d,u=y,a=g,c=!1),new e(i.level,i.resolution,i.scale,p,d,y,g,f,l,u,a,c)},e.prototype.normalizeCol=function(e){if(!this.wrap)return e;var t=this.worldSize[0];return e<0?t-1-Math.abs((e+1)%t):e%t},e.prototype.denormalizeCol=function(e,t){return this.wrap?this.worldSize[0]*t+e:e},e.prototype.getWorldForColumn=function(e){return this.wrap?Math.floor(e/this.worldSize[0]):0},e.prototype.getFirstColumnForWorld=function(e){return e*this.worldSize[0]+this.first[0]},e.prototype.getLastColumnForWorld=function(e){return e*this.worldSize[0]+this.first[0]+this.size[0]-1},e.prototype.getColumnForX=function(e){return(e-this.origin[0])/this.norm[0]},e.prototype.getXForColumn=function(e){return this.origin[0]+e*this.norm[0]},e.prototype.getRowForY=function(e){return(this.origin[1]-e)/this.norm[1]},e.prototype.getYForRow=function(e){return this.origin[1]-e*this.norm[1]},e.prototype.getTileBounds=function(e,t,r){void 0===r&&(r=!1),s.set(t);var i=r?s.col:this.denormalizeCol(s.col,s.world),n=s.row;return function(e,t,r,i,n){e[0]=t,e[1]=r,e[2]=i,e[3]=n}(e,this.getXForColumn(i),this.getYForRow(n+1),this.getXForColumn(i+1),this.getYForRow(n)),e},e.prototype.getTileCoords=function(e,t,r){void 0===r&&(r=!1),s.set(t);var i=r?s.col:this.denormalizeCol(s.col,s.world);return Array.isArray(e)?o(e,this.getXForColumn(i),this.getYForRow(s.row)):(e.x=this.getXForColumn(i),e.y=this.getYForRow(s.row)),e},e}()}.apply(null,i))||(e.exports=n)},807:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(737),r(413),r(722)],void 0===(n=function(e,t,r,i,n){return function(){function e(e){this.lodInfo=e,this.spans=r.acquire()}return e.prototype.release=function(){for(var e=0,t=this.spans;e<t.length;e++){var i=t[e];n.pool.release(i)}r.release(this.spans)},e.prototype.forEach=function(e,t){var r=this.spans,i=this.lodInfo,n=i.level;if(0!==r.length)for(var o=0,s=r;o<s.length;o++)for(var a=s[o],l=a.row,u=a.colFrom,c=a.colTo,h=u;h<=c;h++)e.call(t,n,l,i.normalizeCol(h),i.getWorldForColumn(h))},e.pool=new i(e,!0),e}()}.apply(null,i))||(e.exports=n)},863:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(337),r(335),r(346),r(793),r(336),r(683)],void 0===(n=function(e,t,r,i,n,o,s,a){var l=new Set,u=[],c=new Map,h=[0,0];return function(e){function t(t){var r=e.call(this,t)||this;return r._keysToRequests=new Map,r.concurrency=6,r.process=null,r.strategy="scale-first",r.tileInfoView=null,r.tileServers=null,r}return r(t,e),t.prototype.initialize=function(){var e=this,t="scale-first"===this.strategy?this._peekByScaleFirst.bind(this):this._peekByCenterFirst.bind(this),r=this,i=r.tileServers,n=r.concurrency,s=r.process;i&&i.length>0?this._queues=i.map(function(r){return new o({concurrency:n,process:function(t){var i=e._keysToRequests.get(t);return s(i,r)},peeker:t})}):this._queues=[new o({concurrency:n,process:function(t){var r=e._keysToRequests.get(t);return s(r)},peeker:t})]},Object.defineProperty(t.prototype,"length",{get:function(){return this._queues.reduce(function(e,t){return e+t.length},0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onGoingCount",{get:function(){return this._keysToRequests.size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return this.length>0||this.onGoingCount>0},enumerable:!0,configurable:!0}),t.prototype.clear=function(){for(var e=0,t=this._queues;e<t.length;e++)t[e].clear();this._keysToRequests.clear(),this.notifyChange("updating")},t.prototype.find=function(e,t){for(var r=this,i=0,n=this._queues;i<n.length;i++){var o=n[i].find(function(t){return e(r._keysToRequests.get(t).key)});if(o)return o}},t.prototype.getPromise=function(e){for(var t="string"==typeof e?e:e.id,r=0,i=this._queues;r<i.length;r++){var n=i[r].get(t);if(n)return n}},t.prototype.getRequest=function(e){var t="string"==typeof e?e:e.id;return this._keysToRequests.get(t)},t.prototype.has=function(e){return"string"==typeof e?this._keysToRequests.has(e):this._keysToRequests.has(e.id)},t.prototype.isOngoing=function(e){var t="string"==typeof e?e:e.id;return this.has(t)&&this._queues.some(function(e){return e.isOngoing(t)})},t.prototype.pause=function(){for(var e=0,t=this._queues;e<t.length;e++)t[e].pause()},t.prototype.push=function(e){var t=this,r=e.key.id;if(this.has(r))return this.getPromise(r);var i=this._queues[e.key.row%this._queues.length].push(r),n=function(){t._keysToRequests.delete(r),t.notifyChange("updating")};return this._keysToRequests.set(r,e),i.then(n,n),this.notifyChange("updating"),i},t.prototype.reset=function(){for(var e=0,t=this._queues;e<t.length;e++)t[e].reset();this.notifyChange("updating")},t.prototype.resume=function(){for(var e=0,t=this._queues;e<t.length;e++)t[e].resume()},t.prototype._peekByScaleFirst=function(e){if(!this.state)return e[0];for(var t=this.tileInfoView,r=Number.NEGATIVE_INFINITY,i=Number.POSITIVE_INFINITY,n=0,o=e;n<o.length;n++){var s=o[n],a=this._keysToRequests.get(s),h=this.tileInfoView.getTileScale(a.key);c.has(h)||(c.set(h,[]),r=Math.max(h,r),i=Math.min(h,i)),c.get(h).push(a.key),l.add(h)}var p=this.state.scale;c.has(p)||(function(e,t){e.length=0,t.forEach(function(t){return e.push(t)})}(u,l),u.sort(),p=u.reduce(function(e,t,r,i){return Math.abs(t-p)<Math.abs(e-p)?t:e},u[0])),p=Math.min(p,r),p=Math.max(p,i);var f=c.get(p),d=t.getClosestInfoForScale(p),y=d.getColumnForX(this.state.center[0]),g=d.getRowForY(this.state.center[1]);return f.sort(function(e,t){var r=d.denormalizeCol(e.col,e.world),i=d.denormalizeCol(t.col,t.world);return Math.sqrt((y-r)*(y-r)+(g-e.row)*(g-e.row))-Math.sqrt((y-i)*(y-i)+(g-t.row)*(g-t.row))}),l.clear(),c.clear(),f[0].id},t.prototype._peekByCenterFirst=function(e){if(!this.state)return e[0];for(var t=this.tileInfoView,r=this.state.center,i=Number.POSITIVE_INFINITY,n=null,o=0,s=e;o<s.length;o++){var l=s[o],u=this._keysToRequests.get(l);t.getTileCoords(h,u.key);var c=a.distance(h,r);c<i&&(i=c,n=u.key)}return n.id},i([s.property({constructOnly:!0})],t.prototype,"concurrency",void 0),i([s.property({constructOnly:!0})],t.prototype,"process",void 0),i([s.property()],t.prototype,"state",void 0),i([s.property({constructOnly:!0})],t.prototype,"strategy",void 0),i([s.property({constructOnly:!0})],t.prototype,"tileInfoView",void 0),i([s.property({constructOnly:!0})],t.prototype,"tileServers",void 0),i([s.property({readOnly:!0})],t.prototype,"updating",null),i([s.subclass()],t)}(s.declared(n))}.apply(null,i))||(e.exports=n)},864:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){return function(){function e(e){this._items=[],this._itemSet=new Set,this._peeker=function(e){return e[0]},this._length=0,e&&e.peeker&&(this._peeker=e.peeker)}return Object.defineProperty(e.prototype,"length",{get:function(){return this._length},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this._itemSet.clear(),this._items.length=0,this._length=0},e.prototype.peek=function(){if(0!==this._length)return this._peeker(this._items)},e.prototype.push=function(e){this.contains(e)||this._add(e)},e.prototype.contains=function(e){return this._length>0&&this._itemSet.has(e)},e.prototype.pop=function(){if(0!==this._length){var e=this.peek();return this._remove(e),e}},e.prototype.remove=function(e){this.contains(e)&&this._remove(e)},e.prototype._add=function(e){this._items.push(e),this._itemSet.add(e),this._length++},e.prototype._remove=function(e){this._itemSet.delete(e),this._items.splice(this._items.indexOf(e),1),this._length--},e}()}.apply(null,i))||(e.exports=n)},876:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(345),r(441)],void 0===(n=function(e,t,r,i){function n(e,t){e.delete(t)}var o=new i(0,0,0,0),s=new Map,a=[],l=[];return function(){function e(e){this._previousResolution=Number.POSITIVE_INFINITY,this.cachePolicy="keep",this.tileIndex=new Map,this.tiles=[],this.buffer=192,this.acquireTile=e.acquireTile,this.releaseTile=e.releaseTile,this.tileInfoView=e.tileInfoView,e.cachePolicy&&(this.cachePolicy=e.cachePolicy),null!=e.buffer&&(this.buffer=e.buffer)}return e.prototype.destroy=function(){this.tileIndex.clear()},e.prototype.update=function(e){var t=this,r=this.tileIndex,i=this.tileInfoView.getTileCoverage(e.state,this.buffer);if(i){var u=i.spans,c=i.lodInfo,h=c.level,p=e.state.resolution,f=!e.stationary&&p>this._previousResolution;this._previousResolution=p,r.forEach(function(e){return e.visible=!0}),this.tiles.length=0,s.clear();var d=0,y=0;if(u.length>0)for(var g=0,v=u;g<v.length;g++)for(var _=v[g],m=_.row,w=_.colFrom,I=_.colTo,x=w;x<=I;x++){d++;var b=o.set(h,m,c.normalizeCol(x),c.getWorldForColumn(x)).id;if(r.has(b)){if((M=r.get(b)).attached){s.set(b,M),y++;continue}M.attached||f||this._addParentTile(b,s)}else{var M=this.acquireTile(o);this.tileIndex.set(b,M),f||this._addParentTile(b,s)}}var T=y===d;l.length=0,a.length=0,r.forEach(function(e,r){if(o.set(r),!s.has(r)){var n=t.tileInfoView.intersects(i,o);if(!n||!f&&T)if("purge"===t.cachePolicy){!(o.level!==h)&&n||a.push(r)}else(o.level>h||!n)&&a.push(r);else e.attached?l.push(r):o.level>h&&a.push(r)}});for(var S=0,C=l;S<C.length;S++){b=C[S];(M=r.get(b))&&M.attached&&s.set(b,M)}for(var F=0,R=a;F<R.length;F++){b=R[F],M=r.get(b);this.releaseTile(M),n(r,b)}return s.forEach(function(e){return t.tiles.push(e)}),r.forEach(function(e){s.has(e.key.id)||(e.visible=!1)}),l.length=0,a.length=0,s.clear(),T}},e.prototype.clear=function(){var e=this,t=this.tileIndex;t.forEach(function(t){e.releaseTile(t)}),t.clear()},e.prototype._addParentTile=function(e,t){for(var r=e,i=null;r=this.tileInfoView.getTileParentId(r);)if(this.tileIndex.has(r)&&(i=this.tileIndex.get(r))&&i.attached){t.has(i.key.id)||t.set(i.key.id,i);break}},e}()}.apply(null,i))||(e.exports=n)}}]);