(function(){(this||window).webpackJsonp.registerAbsMids({"esri/layers/support/LabelClass":429,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/support/LabelClass":429,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/support/labelUtils":455,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/support/types":648,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/support/LabelExpressionInfo":661,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/string":662,"esri/views/2d/engine/webgl/mesh/templates/WGLMeshTemplate":1411,"esri/views/2d/layers/features/processors/BaseProcessor":1588,"esri/views/2d/engine/webgl/util/vvFlagUtils":1589,"esri/views/2d/engine/webgl/util/BidiText":1590,"esri/views/2d/engine/webgl/mesh/templates/WGLTextTemplate":1664,"esri/views/2d/engine/webgl/mesh/templates/WGLLineTemplate":1665,"esri/views/2d/engine/webgl/mesh/templates/WGLMarkerTemplate":1666,"esri/views/2d/layers/features/processors/SymbolProcessor":2442,"esri/core/MapPool":2443,"esri/views/2d/engine/webgl/collisions/CollisionGrid":2444,"esri/views/2d/engine/webgl/mesh/factories/matcherUtils":2445,"esri/views/2d/engine/webgl/util/Matcher":2446,"esri/views/2d/engine/webgl/mesh/factories/WGLMeshFactory":2447,"esri/views/2d/engine/webgl/mesh/MeshData":2448,"esri/views/2d/engine/webgl/mesh/VertexVector":2449,"esri/views/2d/engine/webgl/mesh/factories/VVFactory":2450,"esri/views/2d/engine/webgl/mesh/templates/WGLLabelTemplate":2451,"esri/views/2d/engine/webgl/mesh/templates/WGLTemplateStore":2452,"esri/views/2d/engine/webgl/mesh/templates/WGLFillTemplate":2453,"esri/views/2d/engine/webgl/mesh/Tesselator":2454,"esri/core/libs/libtess/libtess":2455})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[79],{1411:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(347)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){return function(){}}();t.default=i}.apply(null,i))||(e.exports=n)},1588:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(338),r(336),r(346),r(981),r(337),r(1071)],void 0===(n=function(e,t,r,i,n,s,o,a){Object.defineProperty(t,"__esModule",{value:!0});var l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.initialize=function(){this.handles.add([this.tileStore.on("update",this.onTileUpdate.bind(this))])},t.prototype.destroy=function(){},Object.defineProperty(t.prototype,"supportsTileUpdates",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"spatialReference",{get:function(){var e=this.get("tileStore.spatialReference");return e&&e.toJSON()||null},enumerable:!0,configurable:!0}),i([o.property({readOnly:!0})],t.prototype,"supportsTileUpdates",null),i([o.property({constructOnly:!0})],t.prototype,"remoteClient",void 0),i([o.property({constructOnly:!0})],t.prototype,"service",void 0),i([o.property({dependsOn:["tileStore.spatialReference"]})],t.prototype,"spatialReference",null),i([o.property({constructOnly:!0})],t.prototype,"tileInfo",void 0),i([o.property({constructOnly:!0})],t.prototype,"tileStore",void 0),i([o.subclass()],t)}(o.declared(n,s,a.default));t.default=l}.apply(null,i))||(e.exports=n)},1589:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(623),r(1437)],void 0===(n=function(e,t,r,i){function n(e,t){void 0===t&&(t=!1);var i=r.WGLVVFlag.SIZE_FIELD_STOPS|r.WGLVVFlag.SIZE_MINMAX_VALUE|r.WGLVVFlag.SIZE_SCALE_STOPS|r.WGLVVFlag.SIZE_UNIT_VALUE,n=(e&(r.WGLVVTarget.FIELD_TARGETS_OUTLINE|r.WGLVVTarget.MINMAX_TARGETS_OUTLINE|r.WGLVVTarget.SCALE_TARGETS_OUTLINE|r.WGLVVTarget.UNIT_TARGETS_OUTLINE))>>>4;return t?i&n:i&~n}function s(e){var t=n(e,!1);return e&(r.WGLVVFlag.COLOR|r.WGLVVFlag.OPACITY|r.WGLVVFlag.ROTATION|t)}Object.defineProperty(t,"__esModule",{value:!0}),t.getVVFlags=function(e){if(!e)return r.WGLVVFlag.NONE;for(var t=0,n=0,s=e;n<s.length;n++){var o=s[n];if("size"===o.type){var a=i.getTypeOfSizeVisualVariable(o);t|=a,"outline"===o.target&&(t|=a<<4)}else"color"===o.type?t|=r.WGLVVFlag.COLOR:"opacity"===o.type?t|=r.WGLVVFlag.OPACITY:"rotation"===o.type&&(t|=r.WGLVVFlag.ROTATION)}return t},t.getSizeFlagsMask=n,t.getMarkerVVFlags=s,t.getFillVVFlags=function(e){return e&(r.WGLVVFlag.COLOR|r.WGLVVFlag.OPACITY)},t.getLineVVFlags=function(e,t){if(t)return e&n(e,!0);var i=n(e,!1);return e&(r.WGLVVFlag.COLOR|r.WGLVVFlag.OPACITY|i)},t.getTextVVFlags=function(e){return s(e)}}.apply(null,i))||(e.exports=n)},1590:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1381)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=new r;t.bidiText=function(e){return i.hasBidiChar(e)?(t="rtl"===i.checkContextual(e)?"IDNNN":"ICNNN",[i.bidiTransform(e,t,"VLYSN"),!0]):[e,!1];var t}}.apply(null,i))||(e.exports=n)},1664:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(347),r(343),r(357),r(1027),r(774),r(623),r(1052),r(1061),r(1517),r(1284),r(1584),r(1411),r(1590)],void 0===(n=function(e,t,r,i,n,s,o,a,l,u,p,h,c,d,f){Object.defineProperty(t,"__esModule",{value:!0});var g=i.getLogger("esri.views.2d.engine.webgl.WGLTextTemplate"),_=10,m=24,v=1.2*m,y=10*m,x=function(){function e(e,t,r,i,n,s,o,a,l){this.materialId=e,this.vertexOffsetUpperLeft=t,this.vertexOffsetUpperRight=r,this.vertexOffsetLowerLeft=i,this.vertexOffsetLowerRight=n,this.texFontSizeUpperLeft=s,this.texFontSizeUpperRight=o,this.texFontSizeLowerLeft=a,this.texFontSizeLowerRight=l}return e.from=function(t,r,i,n,s){var o,a,p=t.glyphMosaicItem,h=p.rect,c=p.metrics,d=Math.round(h.x/4),f=Math.round(h.y/4),g=d+Math.round(h.width/4),_=f+Math.round(h.height/4);if(t.codePoint){var m=t.x+0+c.left,v=t.y+-17-c.top;o=new l.Point(m-4,v-4),a=new l.Point(o.x+h.width,o.y+h.height)}else{m=t.x,v=t.y;o=new l.Point(m,v),a=new l.Point(o.x+c.width,o.y+c.height)}var y=new l.Point(o.x,a.y),x=new l.Point(a.x,o.y);if(i){var b=Math.cos(i),E=Math.sin(i);o.rotate(b,E),a.rotate(b,E),y.rotate(b,E),x.rotate(b,E)}return new e(r,u.i1616to32(8*o.x,8*o.y),u.i1616to32(8*x.x,8*x.y),u.i1616to32(8*y.x,8*y.y),u.i1616to32(8*a.x,8*a.y),u.i8888to32(d,f,n,s),u.i8888to32(g,f,n,s),u.i8888to32(d,_,n,s),u.i8888to32(g,_,n,s))},e}();t.ComputedGlyph=x;var b=function(e){function t(t,r,i){var l=e.call(this)||this;l.geometryType=a.WGLGeometryType.TEXT;var u=i.haloColor;l.color=0|(i.color&&s.premultiplyAlphaRGBA(i.color)),l.textSize=n.pt2px(i.font.size);var p=i.xoffset/i.font.size,h=i.yoffset/i.font.size;return l.shapingXOffset=p*m,l.shapingYOffset=h*m,l.haloColor=0|(u&&s.premultiplyAlphaRGBA(u)),l.haloSize=_*n.pt2px(n.toPt(i.haloSize||0)),l.textPropColor=l.color||o.PICTURE_FILL_COLOR,l.textPropSize=n.pt2px(i.font.size),l.textPropAngle=i.angle*Math.PI/180,l.xOffset=n.pt2px(i.xoffset),l.yOffset=n.pt2px(i.yoffset),l.textPropHAnchor="left"===i.horizontalAlignment?0:"right"===i.horizontalAlignment?1:.5,l.textPropVAnchor="top"===i.verticalAlignment?0:"bottom"===i.verticalAlignment?1:.5,l.textPropHaloColor=l.haloColor||4294967295,l.textPropHaloSize=n.pt2px(n.toPt(i.haloSize||0)),l._materialStore=t,l.vvFlags=r,l}return r(t,e),t.fromText=function(e,r,i,n,s){var o=new t(e,r,i);return o.computeGlyphs(s,i.text,!1),o},t.prototype.writeMesh=function(e,t,r,i,n,s,o){var a=t.indexVector,l=t.get("geometry"),u=t.get("visibility"),p=this._getOffset(l);switch(r){case"esriGeometryPoint":var h=n.geometry,c=h.x,d=h.y;return void this._writeVertices(e,a,l,u,p,i,c,d,o);case"esriGeometryPolygon":if(n.centroid){var f=n.centroid;c=f.x,d=f.y;return void this._writeVertices(e,a,l,u,p,i,c,d,o)}default:g.error("Unable to handle geometryType: "+r)}},t.prototype.computeGlyphs=function(e,t,r){if(!t||!t.length)return this._computedGlyphs=[],null;for(var i=this.shapingXOffset,n=this.shapingYOffset,s=this.textPropHAnchor,o=this.textPropVAnchor,l=this._computeShaping(e,y,v,0,i,n,s,o,.5),u=f.bidiText(t),h=u[0],d=u[1],g=l.getShaping(h,d),_=new Array(g.length),b=0;b<g.length;b++){var E=this.textPropAngle,w=this.textSize,T=this.haloSize,S=g[b].glyphMosaicItem,L=this._materialStore.createGlyphMaterial(S,a.WGLGeometryType.TEXT,this.vvFlags);_[b]=x.from(g[b],L,E,w,T)}if(this._computedGlyphs=_,!r)return null;var I=p.getBox(g);return I.width*=this.textSize/m,I.height*=this.textSize/m,new c.default(I.x,I.y,I.width,I.height)},t.prototype._computeShaping=function(e,t,r,i,n,s,o,a,l){return this._shaping=new p([e],y,v,0,[n,s],o,a,.5),this._shaping},t.prototype._getOffset=function(e){var t=!!this.vvFlags?9:5;return e.length/t},t.prototype._writeVertices=function(e,t,r,i,n,s,o,a,l){var p=this._computedGlyphs,c=o,d=a,f=u.i1616to32(2*c,2*d),g=u.i1616to32(2*c+1,2*d),_=0;if(this.haloSize)for(var m=0;m<p.length;m++,_+=4){var v=p[m].materialId,y=this._materialStore.get(v);(x=new h(s,this.geometryType,v)).vertexFrom=n+_,x.indexFrom=t.length,this._writeVertex(x,r,i,s,g,this.haloColor,p[m],y,l),this._writeIndices(x,t,n+_),e.push(x)}for(m=0;m<p.length;m++,_+=4){var x;v=p[m].materialId,y=this._materialStore.get(v);(x=new h(s,this.geometryType,v)).vertexFrom=n+_,x.indexFrom=t.length,this._writeVertex(x,r,i,s,f,this.color,p[m],y,l),this._writeIndices(x,t,n+_),e.push(x)}},t.prototype._writeVertex=function(e,t,r,i,n,s,o,a,l){t.push(n),t.push(i),t.push(s),t.push(o.vertexOffsetUpperLeft),t.push(o.texFontSizeUpperLeft),this._writeVV(t,l,a),r.push(255),t.push(n),t.push(i),t.push(s),t.push(o.vertexOffsetUpperRight),t.push(o.texFontSizeUpperRight),this._writeVV(t,l,a),r.push(255),t.push(n),t.push(i),t.push(s),t.push(o.vertexOffsetLowerLeft),t.push(o.texFontSizeLowerLeft),this._writeVV(t,l,a),r.push(255),t.push(n),t.push(i),t.push(s),t.push(o.vertexOffsetLowerRight),t.push(o.texFontSizeLowerRight),this._writeVV(t,l,a),r.push(255),e.vertexCount+=4},t.prototype._writeVV=function(e,t,r){r.materialKeyInfo.hasVV()&&(e.push(t[a.VVType.SIZE]),e.push(t[a.VVType.COLOR]),e.push(t[a.VVType.OPACITY]),e.push(t[a.VVType.ROTATION]))},t.prototype._writeIndices=function(e,t,r){t.push(r+0),t.push(r+1),t.push(r+2),t.push(r+1),t.push(r+3),t.push(r+2),e.indexCount+=6},t}(d.default);t.default=b}.apply(null,i))||(e.exports=n)},1665:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(347),r(343),r(1027),r(774),r(623),r(623),r(1645),r(1061),r(1518),r(675),r(1284),r(1411)],void 0===(n=function(e,t,r,i,n,s,o,a,l,u,p,h,c,d){Object.defineProperty(t,"__esModule",{value:!0});var f=i.getLogger("esri.views.2d.engine.webgl.WGLLineTemplate"),g=l.allocTriangles(20),_=l.allocTriangles(20),m=[l.allocExtrudeVectors(),l.allocExtrudeVectors()],v=l.allocExtrudeVectors(),y=s.TILE_SIZE+8,x=new l.Tessellator({distanceAlongCorrection:!0}),b=new p.TileClipper(0,0,0,1,8);b.setExtent(s.TILE_SIZE);var E=function(e){function t(t,r,i,n,s,a,l,u,p,h,c){var d=e.call(this)||this;d.capType=a,d.joinType=l,d.fillColor=u,d.tl=p,d.br=h,d.hasPattern=c,d.geometryType=o.WGLGeometryType.LINE;var f=1/s;return d.halfWidth=n>0?.5*(n+f):0,d._materialStore=t,d.vvFlags=r,d.materialId=d._materialStore.createSpriteMaterial(i,d.geometryType,r),d}return r(t,e),t.fromSimpleLine=function(e,r,i,s,o){var a=i.color,l=h.getCapType(i.cap||"round"),p=h.getJoinType(i.join||"round"),c=a&&"none"!==i.style&&n.premultiplyAlphaRGBA(a)||0;if("none"===i.style&&(c=0),!s)return new t(e,r,s,i.width,o,l,p,c,0,0,!1);var d=s.rect,f=s.width,g=s.height,_=d.x+1,m=d.y+1,v=d.x+1+f,y=d.y+1+g,x=u.i1616to32(_,m),b=u.i1616to32(v,y);return new t(e,r,s,i.width,o,l,p,c,x,b,!0)},t.fromPictureLineSymbol=function(e,t,r,i){return f.error("PictureLineSymbol support does not exist!"),null},t.prototype.writeMesh=function(e,t,r,i,n,s,o){if(this.vvFlags&a.WGLVVFlag.COLOR||0!==this.fillColor){var l=this._materialStore.get(this.materialId),u=t.indexVector,p=t.get("geometry"),h=t.get("visibility"),d=this.halfWidth,g=new c(i,this.geometryType,this.materialId),_=this._getOffset(p,l);switch(g.vertexFrom=_,g.indexFrom=u.length,e.push(g),r){case"esriGeometryPolyline":var m=n.geometry.paths,v=this._clipLines(m);return void this._write(g,u,p,h,_,i,d,v,l,o);case"esriGeometryPolygon":var y=n.geometry.rings;v=this._clipLines(y);return void this._write(g,u,p,h,_,i,d,v,l,o);default:f.error("Unable to handle geometryType: "+r)}}},t.prototype._clipLines=function(e){for(var t=[],r=!1,i=0;i<e.length;){var n=[],s=e[i];b.reset(2);var o=s[0],a=o[0],l=o[1];if(r)b.moveTo(a,l);else{if(a<-8||a>y||l<-8||l>y){r=!0;continue}n.push({x:a,y:l})}for(var u=!1,p=s.length,h=1;h<p;++h)if(a+=s[h][0],l+=s[h][1],r)b.lineTo(a,l);else{if(a<-8||a>y||l<-8||l>y){u=!0;break}n.push({x:a,y:l})}if(u)r=!0;else{if(r){var c=b.resultWithStarts();if(c)for(var d=0,f=c;d<f.length;d++){var g=f[d];t.push(g)}}else t.push({line:n,start:0});i++,r=!1}}return t},t.prototype._getOffset=function(e,t){var r=t.materialKeyInfo.hasVV()?11:8;return e.length/r},t.prototype._write=function(e,t,r,i,n,s,o,a,u,p){for(var h=0,c=0,d=a;c<d.length;c++){var f=d[c],_=f.line,y=f.start;if(!(_.length<2))for(var b=_[0],E=_[_.length-1],w=E.x-b.x,T=E.y-b.y,S=w*w+T*T<1e-6,L=y%65535,I=m[1],N=0;N<_.length;N++){var G=_[N],V=I===m[N%2]?m[(N+1)%2]:m[N%2],O=0===N,R=N===_.length-1;if(R&&S&&!this.hasPattern?l.copyExtrudeVectors(V,v):(this._computeExtrudeVectors(V,N,_,S),h+=this._writeVertices(r,i,s,o,G.x,G.y,V,L,h,u,p),!V.capCenter||S&&R||this._writePieIndices(e,t,n,V),S&&O&&!this.hasPattern&&l.copyExtrudeVectors(v,V)),O||this._writeBridgeIndices(e,t,n,I,V),!R){var C=_[N+1],M=[C.x-G.x,C.y-G.y],P=l.length(M),U=[M[0]/P,M[1]/P],A=L+P;if(A>65535){var F=(65535-L)/(A-L),D=G.x+(C.x-G.x)*F,k=G.y+(C.y-G.y)*F,z=I;x.buttCap(z,U,U),h+=this._writeVertices(r,i,s,o,D,k,z,65535,h,u,p),x.bridge(g,V,z),this._writeBridgeIndices(e,t,n,V,z),x.buttCap(z,U,U),L=A-65535}else L=A,I=V}}}e.vertexCount=h},t.prototype._writeVertices=function(e,t,r,i,n,s,o,a,l,p,h){for(var c=0,d=u.i1616to32(n,s),f=o.vectors,g=f.items,_=f.count;c<_;++c){var m=g[c].vector,v=m[0],y=m[1],x=g[c].texCoords,b=x[0],E=x[1],w=g[c].direction,T=w[0],S=w[1],L=u.i1616to32(a,31*i),I=u.i8888to32(Math.round(31*v),Math.round(31*y),Math.round(31*b),Math.round(31*E)),N=u.i8888to32(Math.round(31*T),Math.round(31*S),0,0);e.push(d),e.push(r),e.push(this.fillColor),e.push(I),e.push(L),e.push(this.tl),e.push(this.br),e.push(N),this._writeVV(e,h,p),t.push(255),g[c].base={index:l+c,point:[n,s]}}return c},t.prototype._writeVV=function(e,t,r){r.materialKeyInfo.hasVV()&&(e.push(t[o.VVType.SIZE]),e.push(t[o.VVType.COLOR]),e.push(t[o.VVType.OPACITY]))},t.prototype._writeBridgeIndices=function(e,t,r,i,n){x.bridge(g,i,n);for(var s=0;s<g.count;++s){var o=g.items[s];t.push(r+o.v1.base.index),t.push(r+o.v2.base.index),t.push(r+o.v3.base.index),e.indexCount+=3}},t.prototype._writePieIndices=function(e,t,r,i){x.pie(_,i);for(var n=0;n<_.count;++n){var s=_.items[n];t.push(r+s.v1.base.index),t.push(r+s.v2.base.index),t.push(r+s.v3.base.index),e.indexCount+=3}},t.prototype._computeExtrudeVectors=function(e,t,r,i){var n=r[t],s=[void 0,void 0],o=[void 0,void 0];if(t>0&&t<r.length-1){var a=r[(t+r.length-1)%r.length],u=r[(t+1)%r.length];l.normalize(s,[n.x-a.x,n.y-a.y]),l.normalize(o,[u.x-n.x,u.y-n.y])}else if(0===t){u=r[(t+1)%r.length];if(l.normalize(o,[u.x-n.x,u.y-n.y]),i){var p=r[r.length-2];l.normalize(s,[n.x-p.x,n.y-p.y])}else s=o}else{if(t!==r.length-1)return void console.error("Vertex index 'i' out of range.");a=r[(t+r.length-1)%r.length];if(l.normalize(s,[n.x-a.x,n.y-a.y]),i){var h=r[1];l.normalize(o,[h.x-n.x,h.y-n.y])}else o=s}i||0!==t?i||t!==r.length-1?this._computeJoinExtrudeVectors(e,s,o):this._computeCapExtrudeVectors(e,s,o,l.CapPosition.END):this._computeCapExtrudeVectors(e,s,o,l.CapPosition.START)},t.prototype._computeCapExtrudeVectors=function(e,t,r,i){switch(this.capType){case o.CapType.BUTT:return void x.buttCap(e,t,r);case o.CapType.ROUND:var n=l.getNumberOfSlices(Math.PI),s=i===l.CapPosition.START?-1:1;return void x.roundCap(e,t,r,i,n,s);case o.CapType.SQUARE:return void x.squareCap(e,t,r,i);default:return f.error("Encountered unknown cap type: "+this.capType+", defaulting to BUTT"),void x.buttCap(e,t,r)}},t.prototype._computeJoinExtrudeVectors=function(e,t,r){var i=l.getRads(t,r);if(i>Math.PI-.05)x.rectJoin(e,t,r);else if(this.joinType===o.JoinType.MITER||i<.1)i<.05?x.fastMiterJoin(e,t,r):i<l.MITER_SAFE_RADS?x.miterJoin(e,t,r):x.bevelJoin(e,t,r,l.SYSTEM_MAG_LIMIT);else if(this.joinType===o.JoinType.BEVEL)x.bevelJoin(e,t,r,1);else if(this.joinType===o.JoinType.ROUND){var n=l.getNumberOfSlices(i);i<2.3?n<2||i<.5?x.bevelJoin(e,t,r,1):x.roundJoin(e,t,r,n):x.unitRoundJoin(e,t,r,n)}},t}(d.default);t.default=E}.apply(null,i))||(e.exports=n)},1666:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(347),r(343),r(357),r(1303),r(961),r(1027),r(774),r(623),r(1061),r(1284),r(1411)],void 0===(n=function(e,t,r,i,n,s,o,a,l,u,p,h,c){Object.defineProperty(t,"__esModule",{value:!0});var d=i.getLogger("esri.views.2d.engine.webgl.WGLMeshTemplate"),f=128,g=function(e){function t(t,r,i,n,a,l,h,c,d,g,_){var m=e.call(this)||this;m.geometryType=u.WGLGeometryType.MARKER;var v=o.create(),y=s.create(),x=_.sdf?.5:1;s.translate(y,y,new Float32Array([x*i,x*-n])),a&&s.rotate(y,y,3.14159265359/180*a),m._materialStore=t,m.vvFlags=r,m._materialId=t.createSpriteMaterial(_,m.geometryType,r),m._fillColor=l,m._outlineColor=d,m._sizeOutlineWidth=p.i8888to32(h,c,g,0);var b=Math.round(_.rect.x/4)-f,E=Math.round(_.rect.y/4)-f,w=b+Math.round(_.rect.width/4),T=E+Math.round(_.rect.height/4);return v.set([-.5*h,-.5*c]),o.transformMat2d(v,v,y),m._offsetAndTexUpperLeft=p.i8888to32(v[0],v[1],b,E),v.set([.5*h,-.5*c]),o.transformMat2d(v,v,y),m._offsetAndTexUpperRight=p.i8888to32(v[0],v[1],w,E),v.set([-.5*h,.5*c]),o.transformMat2d(v,v,y),m._offsetAndTexBottomLeft=p.i8888to32(v[0],v[1],b,T),v.set([.5*h,.5*c]),o.transformMat2d(v,v,y),m._offsetAndTexBottomRight=p.i8888to32(v[0],v[1],w,T),m.height=c,m.width=h,m.xOffset=i,m.yOffset=n,m}return r(t,e),t.fromPictureMarker=function(e,r,i,s,o){var a=Math.round(n.pt2px(i.width)),u=Math.round(n.pt2px(i.height)),p=l.PICTURE_FILL_COLOR;return new t(e,r,Math.round(n.pt2px(i.xoffset||0)),Math.round(n.pt2px(i.yoffset||0)),i.angle,p,a,u,0,0,s)},t.fromSimpleMarker=function(e,r,i,s,o){var l=a.premultiplyAlphaRGBA(i.color),u=Math.round(n.pt2px(i.size)),p=u,h=Math.round(n.pt2px(i.xoffset||0)),c=Math.round(n.pt2px(i.yoffset||0)),d=i.outline,f=0|(d&&d.color&&a.premultiplyAlphaRGBA(d.color)),g=0|(d&&d.width&&Math.round(n.pt2px(d.width)));return new t(e,r,h,c,i.angle,l,u,p,f,g,s)},t.prototype.writeMesh=function(e,t,r,i,n,s,o){var a=this._materialStore.get(this._materialId),l=t.indexVector,u=t.get("geometry"),p=t.get("visibility"),c=new h(i,this.geometryType,this._materialId),f=this._getOffset(u,a);switch(e.push(c),c.vertexFrom=f,c.indexFrom=l.length,r){case"esriGeometryPoint":var g=n.geometry,_=g.x,m=g.y;return this._writeVertices(c,u,p,i,this._getPos(_,m),a,o),void this._writeIndices(c,l,f);case"esriGeometryPolyline":var v=n.geometry.paths;return void this._writeMany(c,l,u,p,f,i,v[0],a,o);case"esriGeometryPolygon":var y=n.centroid;if(y){_=y.x,m=y.y;this._writeVertices(c,u,p,i,this._getPos(_,m),a,o),this._writeIndices(c,l,f)}else d.error("Tried to render polygon geometries as markers, but found no centroid!");return;case"esriGeometryMultipoint":var x=n.geometry.points;return void this._writeMany(c,l,u,p,f,i,x,a,o);case"esriGeometryEnvelope":default:d.error("Unable to handle geometryType: "+r)}},t.prototype._getPos=function(e,t){return p.i1616to32(e,t)},t.prototype._writeMany=function(e,t,r,i,n,s,o,a,l){for(var u=0,p=0,h=0,c=0,d=o;c<d.length;c++){var f=d[c],g=f[0],_=f[1];this._writeVertices(e,r,i,s,this._getPos(g+u,_+p),a,l),this._writeIndices(e,t,n+h),u+=g,p+=_,h+=4}},t.prototype._getOffset=function(e,t){var r=t.materialKeyInfo.hasVV()?10:6;return e.length/r},t.prototype._writeVertices=function(e,t,r,i,n,s,o){t.push(n),t.push(this._offsetAndTexUpperLeft),t.push(i),t.push(this._fillColor),t.push(this._outlineColor),t.push(this._sizeOutlineWidth),this._writeVV(t,o,s),r.push(255),t.push(n),t.push(this._offsetAndTexUpperRight),t.push(i),t.push(this._fillColor),t.push(this._outlineColor),t.push(this._sizeOutlineWidth),this._writeVV(t,o,s),r.push(255),t.push(n),t.push(this._offsetAndTexBottomLeft),t.push(i),t.push(this._fillColor),t.push(this._outlineColor),t.push(this._sizeOutlineWidth),this._writeVV(t,o,s),r.push(255),t.push(n),t.push(this._offsetAndTexBottomRight),t.push(i),t.push(this._fillColor),t.push(this._outlineColor),t.push(this._sizeOutlineWidth),this._writeVV(t,o,s),r.push(255),e.vertexCount+=4},t.prototype._writeVV=function(e,t,r){r.materialKeyInfo.hasVV()&&(e.push(t[u.VVType.SIZE]),e.push(t[u.VVType.COLOR]),e.push(t[u.VVType.OPACITY]),e.push(t[u.VVType.ROTATION]))},t.prototype._writeIndices=function(e,t,r){var i=r;t.push(i+0),t.push(i+1),t.push(i+2),t.push(i+1),t.push(i+3),t.push(i+2),e.indexCount+=6},t}(c.default);t.default=g}.apply(null,i))||(e.exports=n)},2442:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(338),r(336),r(342),r(343),r(2443),r(340),r(337),r(360),r(429),r(421),r(774),r(1661),r(675),r(2444),r(2445),r(1585),r(2447),r(2452),r(1590),r(1588)],void 0===(n=function(e,t,r,i,n,s,o,a,l,u,p,h,c,d,f,g,_,m,v,y,x,b){function E(e,t){switch(e){case"esriGeometryPoint":case"esriGeometryPolyline":case"esriGeometryMultipoint":return!0;case"esriGeometryPolygon":return function(e){var t=e&&e.getSymbols();return function(e){return e&&("unique-value"===e.type||"class-breaks"===e.type)&&null!==e.backgroundFillSymbol}(e)||t.some(function(e){return"simple-fill"===e.type||"picture-fill"===e.type})}(t);default:return T.error(new n("mapview-invalid-type",e+" is not supported")),!1}}function w(e,t,r){r.has(e)||r.set(e,new Set);for(var i=r.get(e),n=t.length,s=0;s<n;s++){var o=t.charCodeAt(s);i.add(o)}}Object.defineProperty(t,"__esModule",{value:!0});var T=s.getLogger("esri.views.2d.layers.features.processors.SymbolProcessor"),S=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._symbolToMosaicItemMap=new Map,t._visualSetPromises=new Map,t.type="symbol",t}return r(t,e),t.prototype.destroy=function(){this._visualSetPromises.forEach(function(e,t){e.cancel()}),this._visualSetPromises.clear(),this._symbolToMosaicItemMap.clear(),this.notifyChange("updating")},Object.defineProperty(t.prototype,"supportsTileUpdates",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"labelingInfo",{get:function(){return this.configuration&&this.configuration.labelingInfo?this.configuration.labelingInfo.map(function(e){return p.fromJSON(e)}):null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"labelClassInfos",{get:function(){var e=this;return this.labelingInfo?this.labelingInfo.map(function(t){return{labelOptions:t.getOptions(e.spatialReference),labelExpression:t.getLabelExpression(),labelClass:t}}):null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"matcher",{get:function(){return _.createMatcher(this.renderer,this.factory.materials,this.factory.templates,u.fromJSON(this.spatialReference),this.service.fields)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"factory",{get:function(){var e=this;if(!this.configuration)return null;var t=new m.default,r=new y.default(function(t){return e.remoteClient.invoke("tileRenderer.getMaterialItems",t)},this.configuration.devicePixelRatio);return new v.default(this.service.geometryType,this.service.objectIdField,this.service.fields,this.renderer.visualVariables,this.configuration.devicePixelRatio,u.fromJSON(this.spatialReference),t,r,this.labelingInfo)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"queryInfo",{get:function(){var e=this.configuration,t=e.renderer,r=e.definitionExpression,i=e.outFields,n=e.gdbVersion,s=e.historicMoment,o=this.service.geometryType,a=this._getReturnCentroid(this.rendererInfo.renderer),l=E(o,this.rendererInfo.renderer),u="esriGeometryPoint"===o||"esriGeometryMultipoint"===o||a?20:0,p=null,h=t.visualVariables;return h&&h.some(function(e){if("size"===e.type&&e.field&&!e.normalizationField)return p=[e.field+" DESC"],!0}),{definitionExpression:r,orderByFields:p,outFields:i,pixelBuffer:u,returnCentroid:a,returnGeometry:l,gdbVersion:n,historicMoment:s}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderer",{get:function(){return this.configuration?h.fromJSON(this.configuration.renderer):null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rendererInfo",{get:function(){return this.configuration?d.createRendererInfo(h.fromJSON(this.configuration.renderer),this.tileStore.spatialReference,{fields:this.service.fields}):null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return this._visualSetPromises.size>0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fields",{get:function(){return this.service.fields},enumerable:!0,configurable:!0}),t.prototype.onTileData=function(e,t){var r=this,i=t.addOrUpdate,n=t.remove,s=t.clear,o=(i&&i.length?this._processFeatures(e,i):a.resolve()).then(function(t){var i=t&&t.message||null,o=t&&t.transferList||null;return r.remoteClient.invoke("tileRenderer.onTileData",{tileKey:e.id,data:{addOrUpdate:i,remove:n,clear:s}},o)}).catch(function(t){return r._handleError(e,t)});return this._visualSetPromises.set(e,o),o.then(function(){return r._cleanPromise(e)},function(){return r._cleanPromise(e)}),this.notifyChange("updating"),o},t.prototype.onTileError=function(e,t){var r=this,i=this.remoteClient.invoke("tileRenderer.onTileError",{tileKey:e.id,error:t});return this._visualSetPromises.set(e,i),i.then(function(){return r._cleanPromise(e)},function(){return r._cleanPromise(e)}),this.notifyChange("updating"),i},t.prototype.onTileUpdate=function(e){for(var t=0,r=e.removed;t<r.length;t++){var i=r[t],n=this._visualSetPromises;if(!n.has(i))return;n.get(i).cancel(),n.delete(i),this.notifyChange("updating")}},t.prototype._cleanPromise=function(e){this._visualSetPromises.delete(e),this.notifyChange("updating")},t.prototype._processFeatures=function(e,t){var r=this;if(!t||!t.length)return a.resolve(null);var i=this.factory;return i.analyze(t,this.matcher,{viewingMode:"",scale:e.scale}).then(function(t){return r._getLabelMosaicItems(e,t).then(function(n){return r._writeFeatures(e,t,n,i)})})},t.prototype._writeFeatures=function(e,t,r,i){for(var n=i.createMeshData(t.length),s={viewingMode:"",scale:e.scale},o=0,a=t;o<a.length;o++){var l=a[o];i.write(n,l,s,r,this._symbolToMosaicItemMap)}return this._encodeDisplayData(n)},t.prototype._encodeDisplayData=function(e){var t={},r=new Array;return e.encode(t,r),{message:t,transferList:r}},t.prototype._handleError=function(e,t){if(t&&"cancel"!==t.dojoType)return this.remoteClient.invoke("tileRenderer.onTileError",{tileKey:e.id,error:t.message})},t.prototype._getReturnCentroid=function(e){function t(e){if(!e)return!1;var t=e.type;return"simple-marker"===t||"picture-marker"===t||"text"===t}if("esriGeometryPolygon"===this.service.geometryType&&this.labelingInfo)return!0;if("esriGeometryPolygon"!==this.service.geometryType)return!1;switch(e.type){case"simple":return t(e.symbol);case"unique-value":return t(e.defaultSymbol)||e.uniqueValueInfos.some(function(e){return t(e.symbol)});case"class-breaks":return t(e.defaultSymbol)||e.classBreakInfos.some(function(e){return t(e.symbol)});default:return!0}},t.prototype._getLabelMosaicItems=function(e,t){var r=o.acquire(),i=this._createLabelFeatures(e.scale,t,r),n=this._symbolToMosaicItemMap,s=o.acquire(),l=[],u=0;return r.forEach(function(e,t){if(n.has(t.id)){var r=n.get(t.id).glyphMosaicItems,i=[];e.forEach(function(e){(r&&r.length<e||!r[e])&&(i[e]=e)}),i.length>0&&(s.set(u,t),l.push({symbol:t.toJSON(),id:u,glyphIds:i}),u++)}else{s.set(u,t);var o=[];e.forEach(function(e){return o.push(e)}),l.push({symbol:t.toJSON(),id:u,glyphIds:o}),u++}}),l.length>0?this.remoteClient.invoke("tileRenderer.getMaterialItems",l).then(function(e){for(var t=0,r=e;t<r.length;t++){var a=r[t],l=s.get(a.id);if(l)if(f.isTextSymbol(l))if(n.has(l.id)){var u=n.get(l.id).glyphMosaicItems,p=a.mosaicItem.glyphMosaicItems;if(p)for(var h=0;h<p.length;h++)null!=p[h]&&(u[h]=p[h])}else n.set(l.id,a.mosaicItem);else n.set(l.id,a.mosaicItem)}return o.release(s),i}):(o.release(r),a.resolve(i))},t.prototype._getLabelClassInfos=function(e){return this.labelClassInfos.map(function(e,t){return{id:t,labelClassInfo:e}}).filter(function(t){var r=t.labelClassInfo;return(!r.labelClass.minScale||r.labelClass.minScale>=e||0===r.labelClass.minScale)&&(!r.labelClass.maxScale||r.labelClass.maxScale<=e||0===r.labelClass.maxScale)})},t.prototype._createLabelFeatures=function(e,t,r){if(!this.labelingInfo||!t||0===t.length)return null;var i=this._getLabelClassInfos(e);if(0===i.length)return null;for(var n=o.acquire(),s=i.map(function(e){return e.id}),a=new g.default(c.COLLISION_EARLY_REJECT_BUCKET_SIZE),l=0,u=t;l<u.length;l++){var p=u[l],h=this.service.geometryType,d=0,f=0;if("esriGeometryPoint"===h){var _=p.geometry;d=_.x,f=_.y}else{if("esriGeometryPolygon"!==h)return null;d=p.centroid.x,f=p.centroid.y}var m=p.attributes[this.service.objectIdField];if(!a.checkOverlap(d,f)){for(var v=new Array(i.length),y=0;y<i.length;y++){var b=i[y].labelClassInfo,E=x.bidiText(this._evaluateLabelExpression(p,b)),T=E[0],S=E[1];w(b.labelClass.symbol,T,r),v[y]={text:T,rtl:S}}n.set(m,{text:v,labelingInfo:s})}}return n},t.prototype._evaluateLabelExpression=function(e,t){return t.labelClass.symbol&&p.evaluateWhere(t.labelClass.where,e.attributes)&&t.labelExpression.expression?p.buildLabelText(t.labelExpression.expression,e,this.fields,t.labelOptions):""},i([l.property({readOnly:!0})],t.prototype,"supportsTileUpdates",null),i([l.property()],t.prototype,"configuration",void 0),i([l.property({dependsOn:["configuration"]})],t.prototype,"labelingInfo",null),i([l.property({dependsOn:["labelingInfo"]})],t.prototype,"labelClassInfos",null),i([l.property({dependsOn:["factory"]})],t.prototype,"matcher",null),i([l.property({dependsOn:["configuration","service","fields"]})],t.prototype,"factory",null),i([l.property({constructOnly:!0})],t.prototype,"queryInfo",null),i([l.property({dependsOn:["configuration"]})],t.prototype,"renderer",null),i([l.property({dependsOn:["configuration"]})],t.prototype,"rendererInfo",null),i([l.property({readOnly:!0})],t.prototype,"updating",null),i([l.property({dependsOn:["service"]})],t.prototype,"fields",null),i([l.subclass()],t)}(l.declared(b.default));t.default=S}.apply(null,i))||(e.exports=n)},2443:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(412)],void 0===(n=function(e,t,r){var i=function(){function e(e,t){void 0===e&&(e=50),void 0===t&&(t=50),this._pool=new r(Map,!1,function(e){return e.clear()},t,e)}return e.prototype.acquire=function(){return this._pool.acquire()},e.prototype.release=function(e){this._pool.release(e)},e.acquire=function(){return n.acquire()},e.release=function(e){return n.release(e)},e}(),n=new i(100);return i}.apply(null,i))||(e.exports=n)},2444:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(774)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this._bucketSize=e,this._rowsLength=r.TILE_SIZE/e,this._colsLength=r.TILE_SIZE/e,this._grid=this._initGrid()}return e.prototype.checkOverlap=function(e,t){var r=Math.floor(e/this._bucketSize),i=Math.floor(t/this._bucketSize);return r<0||r>=this._rowsLength||i<0||i>=this._colsLength||!!this._grid[i][r]||(this._grid[i][r]=!0,!1)},e.prototype.reset=function(){this._grid=this._initGrid()},e.prototype._initGrid=function(){for(var e=[],t=0;t<this._rowsLength;t++)e.push(new Array(this._colsLength));return e},e}();t.default=i}.apply(null,i))||(e.exports=n)},2445:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(342),r(343),r(2446)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0});var s=i.getLogger("esri/views/2d/engine/webgl/mesh/factories/matcherUtils");t.createMatcher=function(e,t,i,o,a){switch(e.type){case"simple":return n.default.fromSimpleRenderer(e,t,i);case"unique-value":case"uniqueValue":return n.MapMatcher.fromUVRenderer(e,t,i,o,a);case"class-breaks":case"classBreaks":return n.IntervalMatcher.fromCBRenderer(e,t,i,o,a);default:return s.error(new r("mapview-mesh:invalid-renderer","Unable to handle unknown renderer type")),null}}}.apply(null,i))||(e.exports=n)},2446:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(347),r(343),r(675),r(1589)],void 0===(n=function(e,t,r,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});var o=i.getLogger("esri/views/2d/engine/webgl/util/Matcher"),a=function(){function e(){this._defaultResult=null}return e.fromSimpleRenderer=function(t,r,i){var n=t.getSymbols(),o=t.visualVariables,a=s.getVVFlags(o),l=new e;if(n.length){var u=i.createTemplateGroup(n[0],null,r,a);l.setDefault(u)}return l},e.prototype.size=function(){return 1},e.prototype.getDefault=function(){return this._defaultResult},e.prototype.setDefault=function(e){this._defaultResult=e},e.prototype.match=function(e,t){return this.getDefault()},e}();t.default=a;var l=function(e){function t(t,r,i,s){var o=e.call(this)||this;return o._intervals=[],o._isMaxInclusive=r,i?o._getValue=n.createArcadeFunction(i):t&&t.length?"function"==typeof t?(o._field=null,o._getValue=t):(o._field=t,o._normalizationInfo=s,o._getValue=o._getValueFromField.bind(o)):o._field=null,o}return r(t,e),t.fromCBRenderer=function(e,r,i,n,o){for(var a=e.isMaxInclusive,l=e.visualVariables,u=e.valueExpression,p=e.normalizationField,h=e.normalizationTotal,c=e.normalizationType,d=s.getVVFlags(l),f=new t(e.field,a,u?{valueExpression:u,spatialReference:n,layer:{fields:o}}:null,{normalizationField:p,normalizationTotal:h,normalizationType:c}),g=e.backgroundFillSymbol,_=0,m=e.classBreakInfos;_<m.length;_++){var v=m[_],y=v.symbol,x=i.createTemplateGroup(y,g,r,d),b={min:v.minValue,max:v.maxValue};f.add(b,x)}var E=e.defaultSymbol;if(E){var w=i.createTemplateGroup(E,g,r,d);f.setDefault(w)}return f},t.prototype.add=function(e,t){this._intervals.push({interval:e,result:t}),this._intervals.sort(function(e,t){return e.interval.min-t.interval.min})},t.prototype.size=function(){return e.prototype.size.call(this)+this._intervals.length},t.prototype.match=function(e,t){if(!this._getValue)return this.getDefault();var r=this._getValue(e,t);if(!r&&(null==r||isNaN(r)))return this.getDefault();for(var i=0;i<this._intervals.length;i++){var n=this._intervals[i],s=n.interval,o=n.result,a=r>=s.min,l=this._isMaxInclusive?r<=s.max:r<s.max;if(a&&l)return o}return this.getDefault()},t.prototype._needsNormalization=function(){var e=this._normalizationInfo;return e&&(e.normalizationField||e.normalizationTotal||e.normalizationType)},t.prototype._getValueFromField=function(e){var t=e.attributes[this._field];if(!this._needsNormalization())return t;var r=this._normalizationInfo,i=r.normalizationField,n=r.normalizationTotal,s=r.normalizationType,a=!!i&&e.attributes[i];if(s)switch(s){case"field":return a?t/a:void 0;case"log":return Math.log(t)*Math.LOG10E;case"percent-of-total":return t/n*100;default:return void o.error("Found unknown normalization type: "+s)}else o.error("Normalization is required, but no type was set!")},t}(a);t.IntervalMatcher=l;var u=function(e){function t(t,r,i){var s=e.call(this)||this;return s._resultsMap=new Map,i?s._getValue=n.createArcadeFunction(i):t&&t.length?"function"==typeof t[0]?(s._fields=null,s._getValue=t[0]):(s._fields=t,s._seperator=r||"",s._getValue=s._getValueFromFields.bind(s)):s._fields=null,s}return r(t,e),t.fromUVRenderer=function(e,r,i,n,o){var a=e.uniqueValueInfos,l=e.visualVariables,u=s.getVVFlags(l),p=[e.field];e.field2&&p.push(e.field2),e.field3&&p.push(e.field3);for(var h=e.valueExpression,c=h?{valueExpression:h,spatialReference:n,layer:{fields:o}}:null,d=e.backgroundFillSymbol,f=new t(p,e.fieldDelimiter,c),g=0,_=a;g<_.length;g++){var m=_[g],v=i.createTemplateGroup(m.symbol,d,r,u);f.add(m.value,v)}if(e.defaultSymbol){var y=i.createTemplateGroup(e.defaultSymbol,d,r,u);f.setDefault(y)}return f},t.prototype.add=function(e,t){this._resultsMap.set(e.toString(),t)},t.prototype.size=function(){return e.prototype.size.call(this)+this._resultsMap.size},t.prototype.match=function(e,t){if(!this._getValue)return this.getDefault();var r=this._getValue(e,t);if(!r&&null==r)return this.getDefault();var i=r.toString();return this._resultsMap.has(i)?this._resultsMap.get(i):this.getDefault()},t.prototype._getValueFromFields=function(e){for(var t=[],r=0,i=this._fields;r<i.length;r++){var n=i[r],s=e.attributes[n];t.push(s)}return t.join(this._seperator)},t}(a);t.MapMatcher=u}.apply(null,i))||(e.exports=n)},2447:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(347),r(342),r(343),r(407),r(774),r(623),r(1583),r(2448),r(2449),r(2450),r(2451),r(1665),r(1666),r(1589)],void 0===(n=function(e,t,r,i,n,s,o,a,l,u,p,h,c,d,f,g){Object.defineProperty(t,"__esModule",{value:!0});var _=n.getLogger("esri.views.2d.engine.webgl.WGLMeshFactory"),m={esriGeometryPoint:["above-right","above-center","above-left","center-center","center-left","center-right","below-center","below-left","below-right"],esriGeometryPolygon:["always-horizontal"],esriGeometryPolyline:null,esriGeometryMultipoint:null,esriGeometryEnvelope:null},v=function(){function e(e,t,r,n,s,o,a,l,u){var p=this;this._labelsDebugTemplate=null,this._materials=a,this._geometryType=e,this._idField=t,this._pixelRatio=s,this._vvFlags=g.getVVFlags(n),this._vvFactory=new h.default(n,r,o),this._vvBuf=new ArrayBuffer(16),this._vvBufU32=new Uint32Array(this._vvBuf),this._vvBufF32=new Float32Array(this._vvBuf),this._templateStore=l,u&&(this._validateLabelingInfo(u)?this._labelTemplates=u.map(function(e){return c.default.fromText(p._materials,0,e.symbol,s,e.labelPlacement)}):_.error(new i("mapview-labeling:unsupported-geometry","LabelingInfo failed validation - unable to create labels for layer.")))}return Object.defineProperty(e.prototype,"materials",{get:function(){return this._materials},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"templates",{get:function(){return this._templateStore},enumerable:!0,configurable:!0}),e.prototype.createMeshData=function(e){var t=new Array(5),r=new Array,i=!!g.getMarkerVVFlags(this._vvFlags),n=!!g.getFillVVFlags(this._vvFlags),s=!!g.getLineVVFlags(this._vvFlags,"esriGeometryPolyline"!==this._geometryType),o=!!g.getTextVVFlags(this._vvFlags);return t[a.WGLGeometryType.MARKER]=new p.VertexVectors(a.WGLGeometryType.MARKER,i,e),t[a.WGLGeometryType.FILL]=new p.VertexVectors(a.WGLGeometryType.FILL,n,e),t[a.WGLGeometryType.LINE]=new p.VertexVectors(a.WGLGeometryType.LINE,s,e),t[a.WGLGeometryType.TEXT]=new p.VertexVectors(a.WGLGeometryType.TEXT,o,e),t[a.WGLGeometryType.LABEL]=new p.VertexVectors(a.WGLGeometryType.LABEL,!1,this._labelTemplates&&this._labelTemplates.length>0?e:0),new u.default(r,t,this._materials)},e.prototype.analyze=function(e,t,r){for(var i=e,n=0,s=i;n<s.length;n++){var o=s[n],a=-1;t&&(a=t.match(o,r)),o.groupId=a}return this._templateStore.finalize().then(function(){return i})},e.prototype.write=function(e,t,r,i,n){var s=this._templateStore.getTemplateGroup(t.groupId),o=e,a=t.attributes[this._idField],u=new l(a),p=!!i&&!!this._labelTemplates&&i.has(a);if(s&&(t.geometry||t.centroid)){this._vvFactory.computeVV(this._vvBufF32,t,r);for(var h=u.displayRecords,c=0,d=s;c<d.length;c++){var f=d[c],g=o.get(f.geometryType);f.writeMesh(h,g,this._geometryType,a,t,this._pixelRatio,this._vvBufU32)}if(p){var _=this._getLabelReference(s);this._writeLabelMesh(u,o,a,t,n,i.get(a),_)}o.pushDisplayObject(u)}},e.prototype._hasBadLabelClass=function(e,t){var r=e.labelPlacement,n=m[t];if(!n)return _.error(new i("mapview-labeling:unsupported-geometry-type","Unable to create labels for WebGL Feature Layer, "+t+" is not supported")),!0;if(!n.some(function(e){return e===r})){var s=n[0];r&&_.warn("Found invalid label placement type "+r+" for "+t+". Defaulting to "+s),e.labelPlacement=s}return!1},e.prototype._validateLabelingInfo=function(e){var t=this;return!e.some(function(e){return t._hasBadLabelClass(e,t._geometryType)})},e.prototype._getLabelReference=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];if(i instanceof f.default)return i}return null},e.prototype._writeLabelMesh=function(e,t,r,i,n,s,a){for(var l=e.displayRecords,u=0,p=0,h=-1,c=-1,d=0;d<s.labelingInfo.length;d++){var f=s.labelingInfo[d],g=s.text[d],_=this._labelTemplates[f],m=t.get(_.geometryType),v=n.get(_.symbolId).glyphMosaicItems,y=l.length;_.bindReferenceTemplate(a);var x=_.computeAnchor(this._geometryType,i);if(0===d&&(h=Math.floor(x[0]/o.COLLISION_BUCKET_SIZE),c=Math.floor(x[1]/o.COLLISION_BUCKET_SIZE)),!_.computeGlyphs(v,g)){var b=_.bounds;_.writeMesh(l,m,this._geometryType,r,i,this._pixelRatio,this._vvBufU32),e.anchor=x,e.addMetric(b,y,l.length-y,f);var E=b.center;u=Math.max(b.halfWidth+Math.abs(E[0]),u),p=Math.max(b.halfHeight+Math.abs(E[1]),p)}}if(e.metrics.length){var w=2.5*Math.max(u,p),T=w-e.anchor[0]%o.COLLISION_BUCKET_SIZE,S=w-e.anchor[1]%o.COLLISION_BUCKET_SIZE,L=Math.ceil(Math.abs(T/o.COLLISION_BUCKET_SIZE)),I=Math.ceil(Math.abs(S/o.COLLISION_BUCKET_SIZE));e.xBucket=h,e.yBucket=c,e.xOverflow=L,e.yOverflow=I}},e.prototype._debugLabels=function(e,t,r,i,n){var s=i[0]+n.center[0],o=i[1]+n.center[1],a={geometry:{paths:[[[s-n.width/2,o+n.height/2],[0,-n.height],[n.width,0],[0,n.height],[-n.width,0]]]},attributes:{}},l=this._getLabelDebugTemplate(),u=t.get(l.geometryType);l.writeMesh(e,u,"esriGeometryPolyline",r,a,this._pixelRatio,null)},e.prototype._getLabelDebugTemplate=function(){return this._labelsDebugTemplate||(this._labelsDebugTemplate=this._createLabelsDebugTemplate()),this._labelsDebugTemplate},e.prototype._createLabelsDebugTemplate=function(){var e=new s({style:"solid",width:1,color:[255,0,0,1]});return d.default.fromSimpleLine(this._materials,0,e,null,this._pixelRatio)},e}();t.default=v}.apply(null,i))||(e.exports=n)},2448:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1060),r(1586)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,r){this.displayObjects=e,this.vertexVectorsMap=t,this._materials=r}return e.prototype.get=function(e){return this.vertexVectorsMap[e]},e.prototype.pushDisplayObject=function(e){this.displayObjects.push(e)},e.prototype.encode=function(e,t){var n=r.serializeList(new i.default(Uint32Array,this._guessSize()),this.displayObjects).buffer(),s=this._materials.serialize(new i.default(Uint32Array)).buffer(),o={};for(var a in t.push(n),t.push(s),this.vertexVectorsMap){var l=this.vertexVectorsMap[a];o[a]={},l.transfer(o[a],t)}e.displayObjects=n,e.materialStore=s,e.vertexBuffersMap=o,this.destroy()},e.prototype.destroy=function(){this.vertexVectorsMap=null,this.displayObjects=null},e.prototype._guessSize=function(){for(var e=this.displayObjects,t=Math.min(e.length,4),r=0,i=0;i<t;i++)r=Math.max(r,e[i].displayRecords.length);return 2*(12*e.length+e.length*r*40)},e}();t.default=n}.apply(null,i))||(e.exports=n)},2449:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(675),r(1586)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){this.data=e,this.stride=t,this.vertexCount=0}return e.prototype.transfer=function(e,t){var r=this.data.buffer();e.vertexCount=this.vertexCount,e.data=r,e.stride=this.stride,t.push(r)},e}();t.default=n;var s=function(){function e(e,t,s){this.geometryType=e,this.indexVector=new i.default(Uint32Array,s),this.namedVectors={};var o=r.getStrides(e,t);for(var a in o){var l=o[a],u=void 0;switch(l%4){case 0:case 2:u=new i.default(Uint32Array,l/4*s);break;case 1:case 3:u=new i.default(Uint8Array,l*s)}this.namedVectors[a]=new n(u,l)}}return e.prototype.get=function(e){return this.namedVectors[e].data},e.prototype.transfer=function(e,t){var r=this.indexVector.buffer(),i={};for(var n in t.push(r),this.namedVectors){var s=this.namedVectors[n];i[n]={},s.transfer(i[n],t)}e.geometryType=this.geometryType,e.indexBuffer=r,e.namedBuffers=i,this.destroy()},e.prototype.destroy=function(){this.indexVector=null,this.namedVectors=null},e}();t.VertexVectors=s}.apply(null,i))||(e.exports=n)},2450:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(342),r(343),r(623),r(675),r(1437)],void 0===(n=function(e,t,r,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0});var a,l=i.getLogger("esri.views.2d.engine.webgl.mesh.VVFactory");!function(e){e[e.NONE=0]="NONE",e[e.MISSING_DATA=1]="MISSING_DATA"}(a=t.VVError||(t.VVError={}));var u=function(){function e(){this._vvMap=new Map}return e.prototype.set=function(e,t){this._vvMap.set(e,t)},e.prototype.getValue=function(e,t,r){return this._vvMap.has(e)?this._vvMap.get(e)(t,r):0},e}(),p=function(){function e(e,t,r){this._createVVFunctionMap(e,t,r)}return e.prototype.computeVV=function(e,t,r){if(!this._vvMap)return a.NONE;var i=this._vvMap.getValue(n.VVType.SIZE,t,r),s=this._vvMap.getValue(n.VVType.COLOR,t,r),o=this._vvMap.getValue(n.VVType.OPACITY,t,r),l=this._vvMap.getValue(n.VVType.ROTATION,t,r);return e[n.VVType.SIZE]=this._isErrorVV(i)?NaN:i,e[n.VVType.COLOR]=this._isErrorVV(s)?NaN:s,e[n.VVType.OPACITY]=this._isErrorVV(o)?NaN:o,e[n.VVType.ROTATION]=this._isErrorVV(l)?NaN:l,a.NONE},e.prototype._isErrorVV=function(e){return null===e||isNaN(e)||e===1/0},e.prototype._createVVFunctionMap=function(e,t,r){if(e&&e.length)for(var i=0,n=e;i<n.length;i++){var o=n[i],a=s.getVVType(o.type),l=this._createGetValueFunction(o,t,r);l&&(this._vvMap||(this._vvMap=new u),this._vvMap.set(a,l))}},e.prototype._createGetValueFunction=function(e,t,r){if(s.getVVType(e.type)===n.VVType.SIZE){var i=e,a=o.getTypeOfSizeVisualVariable(i);if(a===n.WGLVVFlag.SIZE_SCALE_STOPS)return null;var l=a===n.WGLVVFlag.SIZE_UNIT_VALUE&&function(e){return o.getVisualVariableSizeValueRepresentationRatio(e,i.valueRepresentation)};return this._createNormalizedFunction(e,t,r,l)}return this._createNormalizedFunction(e,t,r)},e.prototype._createNormalizedFunction=function(e,t,i,n){var o=e.field;if(o){if("string"==typeof o){var a=e.normalizationField;return a?function(e){if(e.attributes[o]&&e.attributes[a]){var t=e.attributes[o]/e.attributes[a];return n?n(t):t}}:n?function(e){return n(e.attributes[o])}:function(e){return e.attributes[o]}}return"function"==typeof o?(l.error(new r("mapview-rendering:unsupported-feature","Function field types are not currently supported. Please use a valueExpression instead")),function(e){}):(l.error(new r("mapview-rendering:invalid-type","The field for a vv must be a string or a number, but got "+typeof o)),function(e){})}if(e.valueExpression&&"$view.scale"!==e.valueExpression){var u={valueExpression:e.valueExpression,spatialReference:i,layer:{fields:t}};return s.createArcadeFunction(u,n)}return l.error("Unable to create a normalized function for visual variable: "+e),function(e){}},e}();t.default=p}.apply(null,i))||(e.exports=n)},2451:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(347),r(343),r(357),r(1303),r(961),r(798),r(1027),r(623),r(1662),r(1061),r(1517),r(1284),r(1584),r(1411),r(1664)],void 0===(n=function(e,t,r,i,n,s,o,a,l,u,p,h,c,d,f,g,_){Object.defineProperty(t,"__esModule",{value:!0});var m=i.getLogger("esri.views.2d.engine.webgl.WGLLabelTemplate"),v=24,y=10,x=1.2*v,b=10*v,E=h.i8888to32(255,255,255,255),w={xOffset:0,yOffset:0,width:0,height:0},T=function(e){function t(t,r,i){var s=e.call(this)||this;s.geometryType=u.WGLGeometryType.LABEL,s.vvFlags=0,s._textBoxVerticalOffset=0,s._textBoxHorizontalOffset=0,s._refTemplate=w,s._xOffset=r.xoffset,s._yOffset=-r.yoffset,s._decorationOffset=p.getFontDecorationOffset(r.font);var a=r.haloColor;s._color=0|(r.color&&l.premultiplyAlphaRGBA(r.color));var h=r.xoffset/r.font.size,c=r.yoffset/r.font.size;s._shapingXOffset=h*v,s._shapingYOffset=c*v,s._haloColor=0|(a&&l.premultiplyAlphaRGBA(a)),s._haloSize=y*n.pt2px(n.toPt(r.haloSize||0)),s._textPropSize=n.pt2px(r.font.size),s._textPropAngle=r.angle*Math.PI/180,s._textPropHJustification="left"===r.horizontalAlignment?0:"right"===r.horizontalAlignment?1:.5;var d=0,f=.5;switch(i){case"above-center":case"above-left":case"above-right":d=-.5,f=0;break;case"below-center":case"below-left":case"below-right":d=.5,f=1}var g=0,_=.5;switch(i){case"above-left":case"center-left":case"below-left":g=-.5,_=1;break;case"above-right":case"center-right":case"below-right":g=.5,_=0}return s._textPropHAnchorPlacement=_,s._textPropVAnchorPlacement=f,s._placementDirection=[g,d],s._materialStore=t,s.symbolId=r.id,s.anchor=o.create(),s}return r(t,e),t.fromText=function(e,r,i,n,s,o){return new t(e,i,s)},Object.defineProperty(t.prototype,"bounds",{get:function(){return this._bounds},enumerable:!0,configurable:!0}),t.prototype.computeGlyphs=function(e,t){var r=t.text;if(!r||!r.length)return this._computedGlyphs=[],1;var i=this._shapingXOffset,n=this._shapingYOffset,a=this._computeShaping(e,b,x,0,i,n,this._textPropHAnchorPlacement,this._textPropVAnchorPlacement,this._textPropHJustification).getShaping(r,t.rtl);isNaN(this._decorationOffset)||c.addDecoration(a,this._decorationOffset);for(var l=new Array(a.length),p=0;p<a.length;p++){var h=this._textPropAngle,d=this._textPropSize,g=this._haloSize,m=a[p].glyphMosaicItem,y=this._materialStore.createGlyphMaterial(m,u.WGLGeometryType.LABEL,this.vvFlags);l[p]=_.ComputedGlyph.from(a[p],y,h,d,g)}if(this._computedGlyphs=l,!a||0===a.length)return 2;var E=c.getBox(a),w=this._textPropSize/v;E.width*=w,E.height*=w,E.x*=w,E.y*=w,this._placementDirection[0]<0?this._textBoxHorizontalOffset=-E.x-E.width:this._placementDirection[0]>0&&(this._textBoxHorizontalOffset=-E.x),this._placementDirection[1]<0?this._textBoxVerticalOffset=-E.y:this._placementDirection[1]>0&&(this._textBoxVerticalOffset=-E.y+E.height);var T=E.width/2,S=E.height/2;if(this._textPropAngle){var L=o.fromValues(-T,-S),I=o.fromValues(T,S),N=s.create();s.rotate(N,N,this._textPropAngle),o.transformMat2d(L,L,N),o.transformMat2d(I,I,N);var G=Math.abs(I[0]-L[0]),V=Math.abs(I[1]-L[1]);E.width=G,E.height=V}var O=new f.default(E.x,E.y,E.width+10,E.height+10);this._bounds=O;var R=this._placementDirection[0]*(this._refTemplate.width+this._bounds.width),C=this._placementDirection[1]*(this._refTemplate.height+this._bounds.height);return this._bounds.center[0]=R+this._xOffset,this._bounds.center[1]=C+this._yOffset,0},t.prototype.bindReferenceTemplate=function(e){this._refTemplate=e||w},t.prototype.computeAnchor=function(e,t){var r=this._refTemplate.xOffset,i=this._refTemplate.yOffset;switch(e){case"esriGeometryPoint":var n=t.geometry,s=n.x,a=n.y;this._setAnchor(s,a);break;case"esriGeometryMultipoint":var l=t.geometry,u=this._computeAnchorMultipoint(l.points);s=u.x,a=u.y;this._setAnchor(s,a);break;case"esriGeometryPolygon":if(t.centroid){var p=t.centroid,h=p.x,c=p.y;this._setAnchor(h,c);break}l=t.geometry;if(!(d=this._computeAnchorRings(l.rings)))break;s=d.x,a=d.y;this._setAnchor(s,a);break;case"esriGeometryPolyline":var d;l=t.geometry;if(!(d=this._computeAnchorRings(l.paths)))break;s=d.x,a=d.y;this._setAnchor(s,a);break;default:m.error("Unable to handle geometryType: "+e)}return o.fromValues(this.anchor[0]+r,this.anchor[1]+i)},t.prototype.writeMesh=function(e,t,r,i,n,s,o){var a=t.indexVector,l=t.get("geometry"),u=t.get("visibility"),p=t.get("visibilityRange"),c=this._getOffset(l),d=this._placementDirection[0]*(this._refTemplate.width+10)+this._textBoxHorizontalOffset,f=this._placementDirection[1]*(this._refTemplate.height+10)+this._textBoxVerticalOffset,g=h.i8888to32(this._refTemplate.xOffset,-this._refTemplate.yOffset,d,f);this._writeVertices(e,a,l,u,p,i,c,g,this.anchor[0],this.anchor[1])},t.prototype._setAnchor=function(e,t){this.anchor[0]=e,this.anchor[1]=t},t.prototype._computeAnchorMultipoint=function(e){return e.length&&e[0].length?{x:e[0][0],y:e[0][1]}:null},t.prototype._computeAnchorRings=function(e){if(!e.length||!e[0].length||!e[0][0].length)return null;var t=a.ringsCentroid(e,!1);return{x:t[0],y:t[1]}},t.prototype._computeShaping=function(e,t,r,i,n,s,o,a,l){return this._shaping=new c([e],b,x,0,[n,s],o,a,l),this._shaping},t.prototype._getOffset=function(e){return e.length/5},t.prototype._writeVertices=function(e,t,r,i,n,s,o,a,l,u){var p=this._computedGlyphs,c=l,f=u,g=h.i1616to32(2*c,2*f),_=h.i1616to32(2*c+1,2*f),m=0,v=(16711680&s)>>16,y=(65280&s)>>8,x=255&s,b=h.i8888to32(0,v,y,x);if(this._haloSize)for(var E=0;E<p.length;E++,m+=4){var w=p[E].materialId,T=this._materialStore.get(w);(S=new d(s,this.geometryType,w)).vertexFrom=o+m,S.indexFrom=t.length,this._writeGlyph(S,r,i,n,b,_,this._haloColor,a,p[E],T),this._writeIndices(S,t,o+m),e.push(S)}for(E=0;E<p.length;E++,m+=4){var S;w=p[E].materialId,T=this._materialStore.get(w);(S=new d(s,this.geometryType,w)).vertexFrom=o+m,S.indexFrom=t.length,this._writeGlyph(S,r,i,n,b,g,this._color,a,p[E],T),this._writeIndices(S,t,o+m),e.push(S)}},t.prototype._writeGlyph=function(e,t,r,i,n,s,o,a,l,u){t.push(s),t.push(o),t.push(l.vertexOffsetUpperLeft),t.push(l.texFontSizeUpperLeft),t.push(a),r.push(255),t.push(s),t.push(o),t.push(l.vertexOffsetUpperRight),t.push(l.texFontSizeUpperRight),t.push(a),r.push(255),t.push(s),t.push(o),t.push(l.vertexOffsetLowerLeft),t.push(l.texFontSizeLowerLeft),t.push(a),r.push(255),t.push(s),t.push(o),t.push(l.vertexOffsetLowerRight),t.push(l.texFontSizeLowerRight),t.push(a),r.push(255),i.push(E),i.push(E),e.vertexCount+=4},t.prototype._writeIndices=function(e,t,r){t.push(r+0),t.push(r+1),t.push(r+2),t.push(r+1),t.push(r+3),t.push(r+2),e.indexCount+=6},t}(g.default);t.default=T}.apply(null,i))||(e.exports=n)},2452:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(342),r(343),r(340),r(623),r(2453),r(1665),r(1666),r(1664),r(1590),r(1589)],void 0===(n=function(e,t,r,i,n,s,o,a,l,u,p,h){Object.defineProperty(t,"__esModule",{value:!0});var c=i.getLogger("esri.views.2d.engine.webgl.mesh.templates.WGLTemplateStore"),d=new Array,f=function(){function e(){this._promise=null,this._resolver=null}return e.prototype.isHeld=function(){return!!this._promise},e.prototype.acquire=function(){var e=this;return this._promise?this._promise.then(function(){return e.acquire()}):(this._promise=n.create(function(t){return e._resolver=t}),n.resolve())},e.prototype.release=function(){var e=this._resolver;this._resolver=null,this._promise=null,e()},e}(),g=function(){function e(e,t){this._idCounter=0,this._templateIdCounter=0,this._idToTemplateGroup=new Map,this._symbolToTemplate=new Map,this._fetchQueue=[],this._idToResolver=new Map,this._pixelRatio=1,this._lock=new f,this._fetchResource=e,this._pixelRatio=t}return e.prototype.createTemplateGroup=function(e,t,r,i){var n=this._hashSymbol(e);if(!this._symbolToTemplate.has(n)){var s=new Array;t&&this._createMeshTemplates(s,r,t,i,this._pixelRatio,!0),this._createMeshTemplates(s,r,e,i,this._pixelRatio,!1);var o=this._createGroupId();this._idToTemplateGroup.set(o,s),this._symbolToTemplate.set(n,o)}return this._symbolToTemplate.get(n)},e.prototype.getTemplateGroup=function(e){return this._idToTemplateGroup.has(e)?this._idToTemplateGroup.get(e):d},e.prototype.finalize=function(){return this._fetchQueue.length||this._lock.isHeld()?(e=this._lock,t=this._fetchAllQueuedResources.bind(this),e.acquire().then(function(){return t()}).then(function(){return e.release()})):n.resolve();var e,t},e.prototype._fetchAllQueuedResources=function(){var e=this;if(!this._fetchQueue.length)return n.resolve();var t=this._fetchQueue;return this._fetchQueue=[],this._fetchResource(t).then(function(t){for(var r=0,i=t;r<i.length;r++){var n=i[r],s=n.id,o=n.mosaicItem;e._idToResolver.get(s)(o),e._idToResolver.delete(s)}}).catch(function(i){"cancel"===i.dojoType?e._fetchQueue=e._fetchQueue.concat(t):c.error(new r("mapview-template-store","Unable to fetch requested texture resources",i))})},e.prototype._createGroupId=function(){return this._idCounter++},e.prototype._createTemplateId=function(){return this._templateIdCounter++},e.prototype._getCodepoints=function(e){for(var t=p.bidiText(e.text)[0],r=[],i=0;i<t.length;i++)r.push(t.charCodeAt(i));return r},e.prototype._getMosaicItem=function(e){var t=this,r=this._createTemplateId(),i="text"===e.type&&this._getCodepoints(e),s=n.create(function(e){return t._idToResolver.set(r,e)});return this._fetchQueue.push({symbol:e.toJSON(),id:r,glyphIds:i}),s},e.prototype._hashSymbol=function(e){return JSON.stringify(e)},e.prototype._createMeshTemplates=function(e,t,r,i,n,p){if(-1!==r.type.indexOf("3d"))return c.error("3D symbols are not supported with MapView"),e;var d=e.length;switch(e.push(null),r.type){case s.EsriSymbolTypeKebab.SIMPLE_MARKER:return this._getMosaicItem(r).then(function(s){e[d]=l.default.fromSimpleMarker(t,h.getMarkerVVFlags(i),r,s.spriteMosaicItem,n)}),e;case s.EsriSymbolTypeKebab.PICTURE_MARKER:return this._getMosaicItem(r).then(function(s){e[d]=l.default.fromPictureMarker(t,h.getMarkerVVFlags(i),r,s.spriteMosaicItem,n)}),e;case s.EsriSymbolTypeKebab.SIMPLE_FILL:var f=r;return this._getMosaicItem(r).then(function(r){e[d]=o.default.fromSimpleFill(t,h.getFillVVFlags(i),f,r.spriteMosaicItem,n,p)}),f.outline&&(e.push(null),this._getMosaicItem(f.outline).then(function(r){e[d+1]=a.default.fromSimpleLine(t,h.getLineVVFlags(i,!0),f.outline,r.spriteMosaicItem,n)})),e;case s.EsriSymbolTypeKebab.PICTURE_FILL:var g=r;return this._getMosaicItem(g).then(function(r){e[d]=o.default.fromPictureFill(t,h.getFillVVFlags(i),g,r.spriteMosaicItem,n,p)}),g.outline&&(e.push(null),this._getMosaicItem(g.outline).then(function(r){e[d+1]=a.default.fromSimpleLine(t,h.getLineVVFlags(i,!0),g.outline,r.spriteMosaicItem,n)})),e;case s.EsriSymbolTypeKebab.SIMPLE_LINE:return this._getMosaicItem(r).then(function(s){e[d]=a.default.fromSimpleLine(t,h.getLineVVFlags(i,!1),r,s.spriteMosaicItem,n)}),e;case s.EsriSymbolTypeKebab.TEXT:return this._getMosaicItem(r).then(function(s){e[d]=u.default.fromText(t,h.getTextVVFlags(i),r,n,s.glyphMosaicItems)}),e;default:return c.error("Unable to create mesh template for unknown symbol type: "+r.type),e}},e}();t.default=g}.apply(null,i))||(e.exports=n)},2453:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(347),r(354),r(343),r(829),r(1027),r(774),r(623),r(623),r(1061),r(1518),r(1284),r(2454),r(1411)],void 0===(n=function(e,t,r,i,n,s,o,a,l,u,p,h,c,d,f){Object.defineProperty(t,"__esModule",{value:!0});var g=n.getLogger("esri.views.2d.engine.webgl.mesh.templates.WGLFillTemplate"),_=[],m=[],v=function(e){function t(t,r,n,s,o,u,p,c){var f=e.call(this)||this;f.fillColor=s,f.tl=o,f.br=u,f.aux=p,f.isBFS=c,f.geometryType=l.WGLGeometryType.FILL,f.useLibtess=!1;var g=i("esri-featurelayer-webgl");return f.useLibtess="libtess"===((g||{}).tesselator||"libtess"),f.useLibtess&&(f._tesselator=new d.default),f.vvFlags=r,f._materialStore=t,f.materialId=f._materialStore.createSpriteMaterial(n,f.geometryType,r),f._tileClipper=new h.TileClipper(0,0,0,1,8),f._tileClipper.setExtent(a.TILE_SIZE),f}return r(t,e),t.fromSimpleFill=function(e,r,i,n,s,a){void 0===a&&(a=!1);var l=i.color,u=l&&"none"!==i.style&&o.premultiplyAlphaRGBA(l)||0;if(!n)return new t(e,r,null,u,0,0,0,a);var h=n.rect,c=n.width,d=n.height,f=h.x+1,g=h.y+1,_=h.x+1+c,m=h.y+1+d;return new t(e,r,n,u,p.i1616to32(f,g),p.i1616to32(_,m),p.i8888to32(p.nextHighestPowerOfTwo(_-f),p.nextHighestPowerOfTwo(m-g),0,0),a)},t.fromPictureFill=function(e,r,i,n,s,o){void 0===o&&(o=!1);var l=a.PICTURE_FILL_COLOR,u=n.rect,h=n.width,c=n.height,d=u.x+1,f=u.y+1,g=u.x+1+h,_=u.y+1+c;return new t(e,r,n,l,p.i1616to32(d,f),p.i1616to32(g,_),p.i8888to32(p.nextHighestPowerOfTwo(i.width),p.nextHighestPowerOfTwo(i.height),0,0),o)},t.prototype.writeMesh=function(e,t,r,i,n,s,o){if(_.length=0,this.vvFlags&u.WGLVVFlag.COLOR||0!==this.fillColor){if("esriGeometryPolygon"!==r)return void g.error("Unable to handle geometryType: "+r);var a=n.geometry,l=this._isClippingRequired(a),p=l?this._clip(a,!this.useLibtess):a.rings;return this.useLibtess?this._writeMeshLibtess(e,t,r,i,p,l,s,o):this._writeMeshEarcut(e,t,r,i,p,l,s,o)}},t.prototype._isClippingRequired=function(e){for(var t=a.TILE_SIZE+8,r=0,i=e.rings;r<i.length;r++){var n=i[r],s=n.length;if(!(s<3)){var o=n[0][0],l=n[0][1];if(o<-8||o>t||l<-8||l>t)return!0;for(var u=1;u<s;++u)if(o+=n[u][0],l+=n[u][1],o<-8||o>t||l<-8||l>t)return!0}}return!1},t.prototype._clip=function(e,t){var r,i;this._tileClipper.reset(3);for(var n=0,s=e.rings;n<s.length;n++){var o=s[n],a=o.length;if(!(a<3)){r=o[0][0],i=o[0][1],this._tileClipper.moveTo(r,i);for(var l=1;l<a;++l)r+=o[l][0],i+=o[l][1],this._tileClipper.lineTo(r,i);this._tileClipper.close()}}return this._tileClipper.result(t)},t.prototype._writeMeshLibtess=function(e,t,r,i,n,s,o,a){if(n&&n.length){var l=this._materialStore.get(this.materialId),u=[],p=t.indexVector,h=t.get("geometry"),d=t.get("visibility"),f=new c(i,this.geometryType,this.materialId),g=this._getOffset(h,l),m=s;f.vertexFrom=g,f.indexFrom=p.length,e.push(f),this._tesselator.beginPolygon(_,u);for(var v=0,y=n;v<y.length;v++){var x=y[v];if(!(x.length<3)){this._tesselator.beginContour();var b=void 0,E=void 0;m?(b=x[0].x,E=x[0].y):(b=x[0][0],E=x[0][1]);var w=[b,E,0];this._tesselator.addVertex(w,w);for(var T=1;T<x.length-1;T++){m?(b=x[T].x,E=x[T].y):(b+=x[T][0],E+=x[T][1]);var S=[b,E,0];this._tesselator.addVertex(S,S)}this._tesselator.endContour()}}this._tesselator.endPolygon(),this._writeVerticesLibTess(f,h,d,i,_,l,a),this._writeIndicesLibTess(f,p,g,u)}},t.prototype._writeMeshEarcut=function(e,t,r,i,n,s,o,a){if(n&&n.length){var l=this._materialStore.get(this.materialId),u=t.indexVector,p=t.get("geometry"),h=t.get("visibility"),d=new c(i,this.geometryType,this.materialId),f=this._getOffset(p,l);d.vertexFrom=f,d.indexFrom=u.length,e.push(d);for(var g=0,v=0,y=s,x=0,b=n;x<b.length;x++){var E=b[x],w=v,T=void 0,S=void 0;y?(T=E[0].x,S=E[0].y):(T=E[0][0],S=E[0][1]),_[v++]=T,_[v++]=S;for(var L=0,I=1;I<E.length;++I){var N=void 0,G=void 0;if(y){var V=T,O=S;N=(T=E[I].x)-V,G=(S=E[I].y)-O}else T+=N=E[I][0],S+=G=E[I][1];L-=N*(S+S+G),_[v++]=T,_[v++]=S}L>0?(w-g>0&&(this._write(d,u,p,h,f,i,_,m,g,w,l,a),g=w),m.length=0):L<0&&w-g>0?m.push(.5*(w-g)):v=w}v-g>0&&this._write(d,u,p,h,f,i,_,m,g,v,l,a),_.length=m.length=0}},t.prototype._write=function(e,t,r,i,n,o,a,l,u,p,h,c){var d=s(a.slice(u,p),l,2);if(d.length){var f=this._getOffset(r,h);this._writeVertices(e,r,i,o,a,l,h,c),this._writeIndices(e,t,f,d)}},t.prototype._getOffset=function(e,t){var r=t.materialKeyInfo.hasVV()?8:6;return e.length/r},t.prototype._writeVertices=function(e,t,r,i,n,s,o,a){for(var l=0;l<n.length;l+=2){var u=p.i1616to32(n[l],n[l+1]);t.push(u),t.push(i),t.push(this.fillColor),t.push(this.tl),t.push(this.br),t.push(this.aux),this._writeVV(t,a,o),r.push(255),e.vertexCount++}},t.prototype._writeIndices=function(e,t,r,i){for(var n=r,s=0;s<i.length;s+=3)t.push(n+i[s]),t.push(n+i[s+1]),t.push(n+i[s+2]),e.indexCount+=3},t.prototype._writeVerticesLibTess=function(e,t,r,i,n,s,o){for(var a=0;a<n.length;a+=2){var l=p.i1616to32(n[a],n[a+1]);t.push(l),t.push(i),t.push(this.fillColor),t.push(this.tl),t.push(this.br),t.push(this.aux),this._writeVV(t,o,s),r.push(255),e.vertexCount++}},t.prototype._writeIndicesLibTess=function(e,t,r,i){for(var n=r,s=0;s<i.length;s++)t.push(n+i[s]),e.indexCount++},t.prototype._writeVV=function(e,t,r){r.materialKeyInfo.hasVV()&&(this.isBFS?(e.push(4294967295),e.push(4294967295)):(e.push(t[l.VVType.COLOR]),e.push(t[l.VVType.OPACITY])))},t}(f.default);t.default=v}.apply(null,i))||(e.exports=n)},2454:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(343),r(2455)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0});var n=r.getLogger("esri.views.2d.engine.webgl.mesh.templates.Tesselator"),s=function(){function e(){this._currentVertexIndex=0,this._indexCounter=0,this._triangleIndices=[-1,-1,-1],this.glu=new i.GluTesselator,this.glu.gluTessCallback(i.gluEnum.GLU_TESS_BEGIN,this._begincallback.bind(this)),this.glu.gluTessCallback(i.gluEnum.GLU_TESS_VERTEX_DATA,this._vertexCallback.bind(this)),this.glu.gluTessCallback(i.gluEnum.GLU_TESS_END,this._endcallback.bind(this)),this.glu.gluTessCallback(i.gluEnum.GLU_TESS_COMBINE,this._combinecallback.bind(this)),this.glu.gluTessCallback(i.gluEnum.GLU_TESS_ERROR,this._errorcallback.bind(this)),this.glu.gluTessCallback(i.gluEnum.GLU_TESS_EDGE_FLAG,this._edgeCallback.bind(this)),this.glu.gluTessProperty(i.gluEnum.GLU_TESS_WINDING_RULE,i.windingRule.GLU_TESS_WINDING_ODD)}return e.prototype.beginPolygon=function(e,t){this._triangleIndices[0]=-1,this._triangleIndices[1]=-1,this._triangleIndices[2]=-1,this._currentVertexIndex=0,this._indexCounter=0,this.glu.gluTessBeginPolygon(e),this._indices=t},e.prototype.endPolygon=function(){this.glu.gluTessEndPolygon()},e.prototype.beginContour=function(){this.glu.gluTessBeginContour()},e.prototype.endContour=function(){this.glu.gluTessEndContour()},e.prototype.addVertex=function(e,t){this.glu.gluTessVertex(e,t)},e.prototype._vertexCallback=function(e,t){if(t[t.length]=e[0],t[t.length]=e[1],this._triangleIndices[this._currentVertexIndex]=-1,this._currentVertexIndex>=2){for(var r=0;r<3;r++)-1===this._triangleIndices[r]&&(this._triangleIndices[r]=this._indexCounter++),this._indices[this._indices.length]=this._triangleIndices[r];this._currentVertexIndex=0}else this._currentVertexIndex++},e.prototype._begincallback=function(e){this._triangleIndices[0]=-1,this._triangleIndices[1]=-1,this._triangleIndices[2]=-1,this._currentVertexIndex=0},e.prototype._endcallback=function(){this._currentVertexIndex=0},e.prototype._errorcallback=function(e){n.error("Encountered error during tesselation: "+e)},e.prototype._combinecallback=function(e,t,r){return[e[0],e[1],e[2]]},e.prototype._edgeCallback=function(e){},e}();t.default=s}.apply(null,i))||(e.exports=n)},2455:function(e,t,r){var i;
/**
   * @license
   * Copyright 2000, Silicon Graphics, Inc. All Rights Reserved.
   * Copyright 2015, Google Inc. All Rights Reserved.
   *
   * Permission is hereby granted, free of charge, to any person obtaining a copy
   * of this software and associated documentation files (the "Software"), to
   * deal in the Software without restriction, including without limitation the
   * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
   * sell copies of the Software, and to permit persons to whom the Software is
   * furnished to do so, subject to the following conditions:
   *
   * The above copyright notice including the dates of first publication and
   * either this permission notice or a reference to http://oss.sgi.com/projects/FreeB/
   * shall be included in all copies or substantial portions of the Software.
   *
   * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
   * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
   * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
   * SILICON GRAPHICS, INC. BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
   * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR
   * IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
   *
   * Original Code. The Original Code is: OpenGL Sample Implementation,
   * Version 1.2.1, released January 26, 2000, developed by Silicon Graphics,
   * Inc. The Original Code is Copyright (c) 1991-2000 Silicon Graphics, Inc.
   * Copyright in any portions created by third parties is as indicated
   * elsewhere herein. All Rights Reserved.
   */void 0===(i=function(){"use strict";var e={DEBUG:!1,assert:function(t,r){if(e.DEBUG&&!t)throw new Error("Assertion failed"+(r?": "+r:""))},GLU_TESS_MAX_COORD:1e150,TRUE_PROJECT:!1,GLU_TESS_DEFAULT_TOLERANCE:0,windingRule:{GLU_TESS_WINDING_ODD:100130,GLU_TESS_WINDING_NONZERO:100131,GLU_TESS_WINDING_POSITIVE:100132,GLU_TESS_WINDING_NEGATIVE:100133,GLU_TESS_WINDING_ABS_GEQ_TWO:100134},primitiveType:{GL_LINE_LOOP:2,GL_TRIANGLES:4,GL_TRIANGLE_STRIP:5,GL_TRIANGLE_FAN:6},errorType:{GLU_TESS_MISSING_BEGIN_POLYGON:100151,GLU_TESS_MISSING_END_POLYGON:100153,GLU_TESS_MISSING_BEGIN_CONTOUR:100152,GLU_TESS_MISSING_END_CONTOUR:100154,GLU_TESS_COORD_TOO_LARGE:100155,GLU_TESS_NEED_COMBINE_CALLBACK:100156},gluEnum:{GLU_TESS_BEGIN:100100,GLU_TESS_VERTEX:100101,GLU_TESS_END:100102,GLU_TESS_ERROR:100103,GLU_TESS_EDGE_FLAG:100104,GLU_TESS_COMBINE:100105,GLU_TESS_BEGIN_DATA:100106,GLU_TESS_VERTEX_DATA:100107,GLU_TESS_END_DATA:100108,GLU_TESS_ERROR_DATA:100109,GLU_TESS_EDGE_FLAG_DATA:100110,GLU_TESS_COMBINE_DATA:100111,GLU_TESS_MESH:100112,GLU_TESS_TOLERANCE:100142,GLU_TESS_WINDING_RULE:100140,GLU_TESS_BOUNDARY_ONLY:100141,GLU_INVALID_ENUM:100900,GLU_INVALID_VALUE:100901}};return e.PQHandle,e.geom={},e.geom.vertEq=function(e,t){return e.s===t.s&&e.t===t.t},e.geom.vertLeq=function(e,t){return e.s<t.s||e.s===t.s&&e.t<=t.t},e.geom.edgeEval=function(t,r,i){e.assert(e.geom.vertLeq(t,r)&&e.geom.vertLeq(r,i));var n=r.s-t.s,s=i.s-r.s;return n+s>0?n<s?r.t-t.t+(t.t-i.t)*(n/(n+s)):r.t-i.t+(i.t-t.t)*(s/(n+s)):0},e.geom.edgeSign=function(t,r,i){e.assert(e.geom.vertLeq(t,r)&&e.geom.vertLeq(r,i));var n=r.s-t.s,s=i.s-r.s;return n+s>0?(r.t-i.t)*n+(r.t-t.t)*s:0},e.geom.transLeq=function(e,t){return e.t<t.t||e.t===t.t&&e.s<=t.s},e.geom.transEval=function(t,r,i){e.assert(e.geom.transLeq(t,r)&&e.geom.transLeq(r,i));var n=r.t-t.t,s=i.t-r.t;return n+s>0?n<s?r.s-t.s+(t.s-i.s)*(n/(n+s)):r.s-i.s+(i.s-t.s)*(s/(n+s)):0},e.geom.transSign=function(t,r,i){e.assert(e.geom.transLeq(t,r)&&e.geom.transLeq(r,i));var n=r.t-t.t,s=i.t-r.t;return n+s>0?(r.s-i.s)*n+(r.s-t.s)*s:0},e.geom.edgeGoesLeft=function(t){return e.geom.vertLeq(t.dst(),t.org)},e.geom.edgeGoesRight=function(t){return e.geom.vertLeq(t.org,t.dst())},e.geom.vertL1dist=function(e,t){return Math.abs(e.s-t.s)+Math.abs(e.t-t.t)},e.geom.vertCCW=function(e,t,r){return e.s*(t.t-r.t)+t.s*(r.t-e.t)+r.s*(e.t-t.t)>=0},e.geom.interpolate_=function(e,t,r,i){return(e=e<0?0:e)<=(r=r<0?0:r)?0===r?(t+i)/2:t+e/(e+r)*(i-t):i+r/(e+r)*(t-i)},e.geom.edgeIntersect=function(t,r,i,n,s){var o,a,l;e.geom.vertLeq(t,r)||(l=t,t=r,r=l),e.geom.vertLeq(i,n)||(l=i,i=n,n=l),e.geom.vertLeq(t,i)||(l=t,t=i,i=l,l=r,r=n,n=l),e.geom.vertLeq(i,r)?e.geom.vertLeq(r,n)?((o=e.geom.edgeEval(t,i,r))+(a=e.geom.edgeEval(i,r,n))<0&&(o=-o,a=-a),s.s=e.geom.interpolate_(o,i.s,a,r.s)):((o=e.geom.edgeSign(t,i,r))+(a=-e.geom.edgeSign(t,n,r))<0&&(o=-o,a=-a),s.s=e.geom.interpolate_(o,i.s,a,n.s)):s.s=(i.s+r.s)/2,e.geom.transLeq(t,r)||(l=t,t=r,r=l),e.geom.transLeq(i,n)||(l=i,i=n,n=l),e.geom.transLeq(t,i)||(l=t,t=i,i=l,l=r,r=n,n=l),e.geom.transLeq(i,r)?e.geom.transLeq(r,n)?((o=e.geom.transEval(t,i,r))+(a=e.geom.transEval(i,r,n))<0&&(o=-o,a=-a),s.t=e.geom.interpolate_(o,i.t,a,r.t)):((o=e.geom.transSign(t,i,r))+(a=-e.geom.transSign(t,n,r))<0&&(o=-o,a=-a),s.t=e.geom.interpolate_(o,i.t,a,n.t)):s.t=(i.t+r.t)/2},e.mesh={},e.mesh.makeEdge=function(t){var r=e.mesh.makeEdgePair_(t.eHead);return e.mesh.makeVertex_(r,t.vHead),e.mesh.makeVertex_(r.sym,t.vHead),e.mesh.makeFace_(r,t.fHead),r},e.mesh.meshSplice=function(t,r){var i=!1,n=!1;t!==r&&(r.org!==t.org&&(n=!0,e.mesh.killVertex_(r.org,t.org)),r.lFace!==t.lFace&&(i=!0,e.mesh.killFace_(r.lFace,t.lFace)),e.mesh.splice_(r,t),n||(e.mesh.makeVertex_(r,t.org),t.org.anEdge=t),i||(e.mesh.makeFace_(r,t.lFace),t.lFace.anEdge=t))},e.mesh.deleteEdge=function(t){var r=t.sym,i=!1;t.lFace!==t.rFace()&&(i=!0,e.mesh.killFace_(t.lFace,t.rFace())),t.oNext===t?e.mesh.killVertex_(t.org,null):(t.rFace().anEdge=t.oPrev(),t.org.anEdge=t.oNext,e.mesh.splice_(t,t.oPrev()),i||e.mesh.makeFace_(t,t.lFace)),r.oNext===r?(e.mesh.killVertex_(r.org,null),e.mesh.killFace_(r.lFace,null)):(t.lFace.anEdge=r.oPrev(),r.org.anEdge=r.oNext,e.mesh.splice_(r,r.oPrev())),e.mesh.killEdge_(t)},e.mesh.addEdgeVertex=function(t){var r=e.mesh.makeEdgePair_(t),i=r.sym;return e.mesh.splice_(r,t.lNext),r.org=t.dst(),e.mesh.makeVertex_(i,r.org),r.lFace=i.lFace=t.lFace,r},e.mesh.splitEdge=function(t){var r=e.mesh.addEdgeVertex(t).sym;return e.mesh.splice_(t.sym,t.sym.oPrev()),e.mesh.splice_(t.sym,r),t.sym.org=r.org,r.dst().anEdge=r.sym,r.sym.lFace=t.rFace(),r.winding=t.winding,r.sym.winding=t.sym.winding,r},e.mesh.connect=function(t,r){var i=!1,n=e.mesh.makeEdgePair_(t),s=n.sym;return r.lFace!==t.lFace&&(i=!0,e.mesh.killFace_(r.lFace,t.lFace)),e.mesh.splice_(n,t.lNext),e.mesh.splice_(s,r),n.org=t.dst(),s.org=r.org,n.lFace=s.lFace=t.lFace,t.lFace.anEdge=s,i||e.mesh.makeFace_(n,t.lFace),n},e.mesh.zapFace=function(t){var r,i=t.anEdge,n=i.lNext;do{if(n=(r=n).lNext,r.lFace=null,null===r.rFace()){r.oNext===r?e.mesh.killVertex_(r.org,null):(r.org.anEdge=r.oNext,e.mesh.splice_(r,r.oPrev()));var s=r.sym;s.oNext===s?e.mesh.killVertex_(s.org,null):(s.org.anEdge=s.oNext,e.mesh.splice_(s,s.oPrev())),e.mesh.killEdge_(r)}}while(r!==i);var o=t.prev,a=t.next;a.prev=o,o.next=a},e.mesh.meshUnion=function(e,t){var r=e.fHead,i=e.vHead,n=e.eHead,s=t.fHead,o=t.vHead,a=t.eHead;return s.next!==s&&(r.prev.next=s.next,s.next.prev=r.prev,s.prev.next=r,r.prev=s.prev),o.next!==o&&(i.prev.next=o.next,o.next.prev=i.prev,o.prev.next=i,i.prev=o.prev),a.next!==a&&(n.sym.next.sym.next=a.next,a.next.sym.next=n.sym.next,a.sym.next.sym.next=n,n.sym.next=a.sym.next),e},e.mesh.deleteMesh=function(e){},e.mesh.makeEdgePair_=function(t){var r=new e.GluHalfEdge,i=new e.GluHalfEdge,n=t.sym.next;return i.next=n,n.sym.next=r,r.next=t,t.sym.next=i,r.sym=i,r.oNext=r,r.lNext=i,i.sym=r,i.oNext=i,i.lNext=r,r},e.mesh.splice_=function(e,t){var r=e.oNext,i=t.oNext;r.sym.lNext=t,i.sym.lNext=e,e.oNext=i,t.oNext=r},e.mesh.makeVertex_=function(t,r){var i=r.prev,n=new e.GluVertex(r,i);i.next=n,r.prev=n,n.anEdge=t;var s=t;do{s.org=n,s=s.oNext}while(s!==t)},e.mesh.makeFace_=function(t,r){var i=r.prev,n=new e.GluFace(r,i);i.next=n,r.prev=n,n.anEdge=t,n.inside=r.inside;var s=t;do{s.lFace=n,s=s.lNext}while(s!==t)},e.mesh.killEdge_=function(e){var t=e.next,r=e.sym.next;t.sym.next=r,r.sym.next=t},e.mesh.killVertex_=function(e,t){var r=e.anEdge,i=r;do{i.org=t,i=i.oNext}while(i!==r);var n=e.prev,s=e.next;s.prev=n,n.next=s},e.mesh.killFace_=function(e,t){var r=e.anEdge,i=r;do{i.lFace=t,i=i.lNext}while(i!==r);var n=e.prev,s=e.next;s.prev=n,n.next=s},e.normal={},e.normal.S_UNIT_X_=1,e.normal.S_UNIT_Y_=0,e.normal.projectPolygon=function(t,r,i,n){var s=!1,o=[r,i,n];0===r&&0===i&&0===n&&(e.normal.computeNormal_(t,o),s=!0);var a,l=e.normal.longAxis_(o),u=t.mesh.vHead;if(e.TRUE_PROJECT){e.normal.normalize_(o);var p=[0,0,0],h=[0,0,0];p[l]=0,p[(l+1)%3]=e.normal.S_UNIT_X_,p[(l+2)%3]=e.normal.S_UNIT_Y_;var c=e.normal.dot_(p,o);for(p[0]-=c*o[0],p[1]-=c*o[1],p[2]-=c*o[2],e.normal.normalize_(p),h[0]=o[1]*p[2]-o[2]*p[1],h[1]=o[2]*p[0]-o[0]*p[2],h[2]=o[0]*p[1]-o[1]*p[0],e.normal.normalize_(h),a=u.next;a!==u;a=a.next)a.s=e.normal.dot_(a.coords,p),a.t=e.normal.dot_(a.coords,h)}else{var d=(l+1)%3,f=(l+2)%3,g=o[l]>0?1:-1;for(a=u.next;a!==u;a=a.next)a.s=a.coords[d],a.t=g*a.coords[f]}s&&e.normal.checkOrientation_(t)},e.normal.dot_=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},e.normal.normalize_=function(t){var r=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];e.assert(r>0),r=Math.sqrt(r),t[0]/=r,t[1]/=r,t[2]/=r},e.normal.longAxis_=function(e){var t=0;return Math.abs(e[1])>Math.abs(e[0])&&(t=1),Math.abs(e[2])>Math.abs(e[t])&&(t=2),t},e.normal.computeNormal_=function(t,r){var i,n=[-2*e.GLU_TESS_MAX_COORD,-2*e.GLU_TESS_MAX_COORD,-2*e.GLU_TESS_MAX_COORD],s=[2*e.GLU_TESS_MAX_COORD,2*e.GLU_TESS_MAX_COORD,2*e.GLU_TESS_MAX_COORD],o=[],a=[],l=t.mesh.vHead;for(i=l.next;i!==l;i=i.next)for(var u=0;u<3;++u){var p=i.coords[u];p<s[u]&&(s[u]=p,a[u]=i),p>n[u]&&(n[u]=p,o[u]=i)}var h=0;if(n[1]-s[1]>n[0]-s[0]&&(h=1),n[2]-s[2]>n[h]-s[h]&&(h=2),s[h]>=n[h])return r[0]=0,r[1]=0,void(r[2]=1);var c=0,d=a[h],f=o[h],g=[0,0,0],_=[d.coords[0]-f.coords[0],d.coords[1]-f.coords[1],d.coords[2]-f.coords[2]],m=[0,0,0];for(i=l.next;i!==l;i=i.next){m[0]=i.coords[0]-f.coords[0],m[1]=i.coords[1]-f.coords[1],m[2]=i.coords[2]-f.coords[2],g[0]=_[1]*m[2]-_[2]*m[1],g[1]=_[2]*m[0]-_[0]*m[2],g[2]=_[0]*m[1]-_[1]*m[0];var v=g[0]*g[0]+g[1]*g[1]+g[2]*g[2];v>c&&(c=v,r[0]=g[0],r[1]=g[1],r[2]=g[2])}c<=0&&(r[0]=r[1]=r[2]=0,r[e.normal.longAxis_(_)]=1)},e.normal.checkOrientation_=function(e){for(var t=0,r=e.mesh.fHead,i=r.next;i!==r;i=i.next){var n=i.anEdge;if(!(n.winding<=0))do{t+=(n.org.s-n.dst().s)*(n.org.t+n.dst().t),n=n.lNext}while(n!==i.anEdge)}if(t<0)for(var s=e.mesh.vHead,o=s.next;o!==s;o=o.next)o.t=-o.t},e.render={},e.render.renderMesh=function(t,r,i){for(var n=!1,s=-1,o=r.fHead.prev;o!==r.fHead;o=o.prev)if(o.inside){n||(t.callBeginCallback(e.primitiveType.GL_TRIANGLES),n=!0);var a=o.anEdge;e.assert(a.lNext.lNext.lNext===a,"renderMesh called with non-triangulated mesh");do{if(i){var l=a.rFace().inside?0:1;s!==l&&(s=l,t.callEdgeFlagCallback(!!s))}t.callVertexCallback(a.org.data),a=a.lNext}while(a!==o.anEdge)}n&&t.callEndCallback()},e.render.renderBoundary=function(t,r){for(var i=r.fHead.next;i!==r.fHead;i=i.next)if(i.inside){t.callBeginCallback(e.primitiveType.GL_LINE_LOOP);var n=i.anEdge;do{t.callVertexCallback(n.org.data),n=n.lNext}while(n!==i.anEdge);t.callEndCallback()}},e.sweep={},e.sweep.SENTINEL_COORD_=4*e.GLU_TESS_MAX_COORD,e.sweep.TOLERANCE_NONZERO_=!1,e.sweep.computeInterior=function(t){t.fatalError=!1,e.sweep.removeDegenerateEdges_(t),e.sweep.initPriorityQ_(t),e.sweep.initEdgeDict_(t);for(var r;null!==(r=t.pq.extractMin());){for(;;){var i=t.pq.minimum();if(null===i||!e.geom.vertEq(i,r))break;i=t.pq.extractMin(),e.sweep.spliceMergeVertices_(t,r.anEdge,i.anEdge)}e.sweep.sweepEvent_(t,r)}var n=t.dict.getMin().getKey();t.event=n.eUp.org,e.sweep.doneEdgeDict_(t),e.sweep.donePriorityQ_(t),e.sweep.removeDegenerateFaces_(t.mesh),t.mesh.checkMesh()},e.sweep.addWinding_=function(e,t){e.winding+=t.winding,e.sym.winding+=t.sym.winding},e.sweep.edgeLeq_=function(t,r,i){var n=t.event,s=r.eUp,o=i.eUp;return s.dst()===n?o.dst()===n?e.geom.vertLeq(s.org,o.org)?e.geom.edgeSign(o.dst(),s.org,o.org)<=0:e.geom.edgeSign(s.dst(),o.org,s.org)>=0:e.geom.edgeSign(o.dst(),n,o.org)<=0:o.dst()===n?e.geom.edgeSign(s.dst(),n,s.org)>=0:e.geom.edgeEval(s.dst(),n,s.org)>=e.geom.edgeEval(o.dst(),n,o.org)},e.sweep.deleteRegion_=function(t,r){r.fixUpperEdge&&e.assert(0===r.eUp.winding),r.eUp.activeRegion=null,t.dict.deleteNode(r.nodeUp),r.nodeUp=null},e.sweep.fixUpperEdge_=function(t,r){e.assert(t.fixUpperEdge),e.mesh.deleteEdge(t.eUp),t.fixUpperEdge=!1,t.eUp=r,r.activeRegion=t},e.sweep.topLeftRegion_=function(t){var r=t.eUp.org;do{t=t.regionAbove()}while(t.eUp.org===r);if(t.fixUpperEdge){var i=e.mesh.connect(t.regionBelow().eUp.sym,t.eUp.lNext);e.sweep.fixUpperEdge_(t,i),t=t.regionAbove()}return t},e.sweep.topRightRegion_=function(e){var t=e.eUp.dst();do{e=e.regionAbove()}while(e.eUp.dst()===t);return e},e.sweep.addRegionBelow_=function(t,r,i){var n=new e.ActiveRegion;return n.eUp=i,n.nodeUp=t.dict.insertBefore(r.nodeUp,n),i.activeRegion=n,n},e.sweep.isWindingInside_=function(t,r){switch(t.windingRule){case e.windingRule.GLU_TESS_WINDING_ODD:return 0!=(1&r);case e.windingRule.GLU_TESS_WINDING_NONZERO:return 0!==r;case e.windingRule.GLU_TESS_WINDING_POSITIVE:return r>0;case e.windingRule.GLU_TESS_WINDING_NEGATIVE:return r<0;case e.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO:return r>=2||r<=-2}return e.assert(!1),!1},e.sweep.computeWinding_=function(t,r){r.windingNumber=r.regionAbove().windingNumber+r.eUp.winding,r.inside=e.sweep.isWindingInside_(t,r.windingNumber)},e.sweep.finishRegion_=function(t,r){var i=r.eUp,n=i.lFace;n.inside=r.inside,n.anEdge=i,e.sweep.deleteRegion_(t,r)},e.sweep.finishLeftRegions_=function(t,r,i){for(var n=r,s=r.eUp;n!==i;){n.fixUpperEdge=!1;var o=n.regionBelow(),a=o.eUp;if(a.org!==s.org){if(!o.fixUpperEdge){e.sweep.finishRegion_(t,n);break}a=e.mesh.connect(s.lPrev(),a.sym),e.sweep.fixUpperEdge_(o,a)}s.oNext!==a&&(e.mesh.meshSplice(a.oPrev(),a),e.mesh.meshSplice(s,a)),e.sweep.finishRegion_(t,n),s=o.eUp,n=o}return s},e.sweep.addRightEdges_=function(t,r,i,n,s,o){var a=!0,l=i;do{e.assert(e.geom.vertLeq(l.org,l.dst())),e.sweep.addRegionBelow_(t,r,l.sym),l=l.oNext}while(l!==n);null===s&&(s=r.regionBelow().eUp.rPrev());for(var u,p=r,h=s;(l=(u=p.regionBelow()).eUp.sym).org===h.org;)l.oNext!==h&&(e.mesh.meshSplice(l.oPrev(),l),e.mesh.meshSplice(h.oPrev(),l)),u.windingNumber=p.windingNumber-l.winding,u.inside=e.sweep.isWindingInside_(t,u.windingNumber),p.dirty=!0,!a&&e.sweep.checkForRightSplice_(t,p)&&(e.sweep.addWinding_(l,h),e.sweep.deleteRegion_(t,p),e.mesh.deleteEdge(h)),a=!1,p=u,h=l;p.dirty=!0,e.assert(p.windingNumber-l.winding===u.windingNumber),o&&e.sweep.walkDirtyRegions_(t,p)},e.sweep.callCombine_=function(t,r,i,n,s){var o=[r.coords[0],r.coords[1],r.coords[2]];r.data=null,r.data=t.callCombineCallback(o,i,n),null===r.data&&(s?t.fatalError||(t.callErrorCallback(e.errorType.GLU_TESS_NEED_COMBINE_CALLBACK),t.fatalError=!0):r.data=i[0])},e.sweep.spliceMergeVertices_=function(t,r,i){var n=[null,null,null,null];n[0]=r.org.data,n[1]=i.org.data,e.sweep.callCombine_(t,r.org,n,[.5,.5,0,0],!1),e.mesh.meshSplice(r,i)},e.sweep.vertexWeights_=function(t,r,i,n,s){var o=e.geom.vertL1dist(r,t),a=e.geom.vertL1dist(i,t),l=s,u=s+1;n[l]=.5*a/(o+a),n[u]=.5*o/(o+a),t.coords[0]+=n[l]*r.coords[0]+n[u]*i.coords[0],t.coords[1]+=n[l]*r.coords[1]+n[u]*i.coords[1],t.coords[2]+=n[l]*r.coords[2]+n[u]*i.coords[2]},e.sweep.getIntersectData_=function(t,r,i,n,s,o){var a=[0,0,0,0],l=[i.data,n.data,s.data,o.data];r.coords[0]=r.coords[1]=r.coords[2]=0,e.sweep.vertexWeights_(r,i,n,a,0),e.sweep.vertexWeights_(r,s,o,a,2),e.sweep.callCombine_(t,r,l,a,!0)},e.sweep.checkForRightSplice_=function(t,r){var i=r.regionBelow(),n=r.eUp,s=i.eUp;if(e.geom.vertLeq(n.org,s.org)){if(e.geom.edgeSign(s.dst(),n.org,s.org)>0)return!1;e.geom.vertEq(n.org,s.org)?n.org!==s.org&&(t.pq.remove(n.org.pqHandle),e.sweep.spliceMergeVertices_(t,s.oPrev(),n)):(e.mesh.splitEdge(s.sym),e.mesh.meshSplice(n,s.oPrev()),r.dirty=i.dirty=!0)}else{if(e.geom.edgeSign(n.dst(),s.org,n.org)<0)return!1;r.regionAbove().dirty=r.dirty=!0,e.mesh.splitEdge(n.sym),e.mesh.meshSplice(s.oPrev(),n)}return!0},e.sweep.checkForLeftSplice_=function(t,r){var i,n=r.regionBelow(),s=r.eUp,o=n.eUp;if(e.assert(!e.geom.vertEq(s.dst(),o.dst())),e.geom.vertLeq(s.dst(),o.dst())){if(e.geom.edgeSign(s.dst(),o.dst(),s.org)<0)return!1;r.regionAbove().dirty=r.dirty=!0,i=e.mesh.splitEdge(s),e.mesh.meshSplice(o.sym,i),i.lFace.inside=r.inside}else{if(e.geom.edgeSign(o.dst(),s.dst(),o.org)>0)return!1;r.dirty=n.dirty=!0,i=e.mesh.splitEdge(o),e.mesh.meshSplice(s.lNext,o.sym),i.rFace().inside=r.inside}return!0},e.sweep.checkForIntersect_=function(t,r){var i=r.regionBelow(),n=r.eUp,s=i.eUp,o=n.org,a=s.org,l=n.dst(),u=s.dst(),p=new e.GluVertex;if(e.assert(!e.geom.vertEq(u,l)),e.assert(e.geom.edgeSign(l,t.event,o)<=0),e.assert(e.geom.edgeSign(u,t.event,a)>=0),e.assert(o!==t.event&&a!==t.event),e.assert(!r.fixUpperEdge&&!i.fixUpperEdge),o===a)return!1;if(Math.min(o.t,l.t)>Math.max(a.t,u.t))return!1;if(e.geom.vertLeq(o,a)){if(e.geom.edgeSign(u,o,a)>0)return!1}else if(e.geom.edgeSign(l,a,o)<0)return!1;e.geom.edgeIntersect(l,o,u,a,p),e.assert(Math.min(o.t,l.t)<=p.t),e.assert(p.t<=Math.max(a.t,u.t)),e.assert(Math.min(u.s,l.s)<=p.s),e.assert(p.s<=Math.max(a.s,o.s)),e.geom.vertLeq(p,t.event)&&(p.s=t.event.s,p.t=t.event.t);var h=e.geom.vertLeq(o,a)?o:a;if(e.geom.vertLeq(h,p)&&(p.s=h.s,p.t=h.t),e.geom.vertEq(p,o)||e.geom.vertEq(p,a))return e.sweep.checkForRightSplice_(t,r),!1;if(!e.geom.vertEq(l,t.event)&&e.geom.edgeSign(l,t.event,p)>=0||!e.geom.vertEq(u,t.event)&&e.geom.edgeSign(u,t.event,p)<=0){if(u===t.event)return e.mesh.splitEdge(n.sym),e.mesh.meshSplice(s.sym,n),n=(r=e.sweep.topLeftRegion_(r)).regionBelow().eUp,e.sweep.finishLeftRegions_(t,r.regionBelow(),i),e.sweep.addRightEdges_(t,r,n.oPrev(),n,n,!0),!0;if(l===t.event){e.mesh.splitEdge(s.sym),e.mesh.meshSplice(n.lNext,s.oPrev()),i=r;var c=(r=e.sweep.topRightRegion_(r)).regionBelow().eUp.rPrev();return i.eUp=s.oPrev(),s=e.sweep.finishLeftRegions_(t,i,null),e.sweep.addRightEdges_(t,r,s.oNext,n.rPrev(),c,!0),!0}return e.geom.edgeSign(l,t.event,p)>=0&&(r.regionAbove().dirty=r.dirty=!0,e.mesh.splitEdge(n.sym),n.org.s=t.event.s,n.org.t=t.event.t),e.geom.edgeSign(u,t.event,p)<=0&&(r.dirty=i.dirty=!0,e.mesh.splitEdge(s.sym),s.org.s=t.event.s,s.org.t=t.event.t),!1}return e.mesh.splitEdge(n.sym),e.mesh.splitEdge(s.sym),e.mesh.meshSplice(s.oPrev(),n),n.org.s=p.s,n.org.t=p.t,n.org.pqHandle=t.pq.insert(n.org),e.sweep.getIntersectData_(t,n.org,o,l,a,u),r.regionAbove().dirty=r.dirty=i.dirty=!0,!1},e.sweep.walkDirtyRegions_=function(t,r){for(var i=r.regionBelow();;){for(;i.dirty;)r=i,i=i.regionBelow();if(!r.dirty&&(i=r,null===(r=r.regionAbove())||!r.dirty))return;r.dirty=!1;var n=r.eUp,s=i.eUp;if(n.dst()!==s.dst()&&e.sweep.checkForLeftSplice_(t,r)&&(i.fixUpperEdge?(e.sweep.deleteRegion_(t,i),e.mesh.deleteEdge(s),s=(i=r.regionBelow()).eUp):r.fixUpperEdge&&(e.sweep.deleteRegion_(t,r),e.mesh.deleteEdge(n),n=(r=i.regionAbove()).eUp)),n.org!==s.org)if(n.dst()===s.dst()||r.fixUpperEdge||i.fixUpperEdge||n.dst()!==t.event&&s.dst()!==t.event)e.sweep.checkForRightSplice_(t,r);else if(e.sweep.checkForIntersect_(t,r))return;n.org===s.org&&n.dst()===s.dst()&&(e.sweep.addWinding_(s,n),e.sweep.deleteRegion_(t,r),e.mesh.deleteEdge(n),r=i.regionAbove())}},e.sweep.connectRightVertex_=function(t,r,i){var n,s=i.oNext,o=r.regionBelow(),a=r.eUp,l=o.eUp,u=!1;(a.dst()!==l.dst()&&e.sweep.checkForIntersect_(t,r),e.geom.vertEq(a.org,t.event)&&(e.mesh.meshSplice(s.oPrev(),a),s=(r=e.sweep.topLeftRegion_(r)).regionBelow().eUp,e.sweep.finishLeftRegions_(t,r.regionBelow(),o),u=!0),e.geom.vertEq(l.org,t.event)&&(e.mesh.meshSplice(i,l.oPrev()),i=e.sweep.finishLeftRegions_(t,o,null),u=!0),u)?e.sweep.addRightEdges_(t,r,i.oNext,s,s,!0):(n=e.geom.vertLeq(l.org,a.org)?l.oPrev():a,n=e.mesh.connect(i.lPrev(),n),e.sweep.addRightEdges_(t,r,n,n.oNext,n.oNext,!1),n.sym.activeRegion.fixUpperEdge=!0,e.sweep.walkDirtyRegions_(t,r))},e.sweep.connectLeftDegenerate_=function(t,r,i){var n=r.eUp;if(e.geom.vertEq(n.org,i))return e.assert(e.sweep.TOLERANCE_NONZERO_),void(e.sweep.TOLERANCE_NONZERO_&&e.sweep.spliceMergeVertices_(t,n,i.anEdge));if(!e.geom.vertEq(n.dst(),i))return e.mesh.splitEdge(n.sym),r.fixUpperEdge&&(e.mesh.deleteEdge(n.oNext),r.fixUpperEdge=!1),e.mesh.meshSplice(i.anEdge,n),void e.sweep.sweepEvent_(t,i);if(e.assert(e.sweep.TOLERANCE_NONZERO_),e.sweep.TOLERANCE_NONZERO_){var s=(r=e.sweep.topRightRegion_(r)).regionBelow(),o=s.eUp.sym,a=o.oNext,l=a;s.fixUpperEdge&&(e.assert(a!==o),e.sweep.deleteRegion_(t,s),e.mesh.deleteEdge(o),o=a.oPrev()),e.mesh.meshSplice(i.anEdge,o),e.geom.edgeGoesLeft(a)||(a=null),e.sweep.addRightEdges_(t,r,o.oNext,l,a,!0)}},e.sweep.connectLeftVertex_=function(t,r){var i=new e.ActiveRegion;i.eUp=r.anEdge.sym;var n=t.dict.search(i).getKey(),s=n.regionBelow(),o=n.eUp,a=s.eUp;if(0!==e.geom.edgeSign(o.dst(),r,o.org)){var l,u=e.geom.vertLeq(a.dst(),o.dst())?n:s;n.inside||u.fixUpperEdge?(l=u===n?e.mesh.connect(r.anEdge.sym,o.lNext):e.mesh.connect(a.dNext(),r.anEdge).sym,u.fixUpperEdge?e.sweep.fixUpperEdge_(u,l):e.sweep.computeWinding_(t,e.sweep.addRegionBelow_(t,n,l)),e.sweep.sweepEvent_(t,r)):e.sweep.addRightEdges_(t,n,r.anEdge,r.anEdge,null,!0)}else e.sweep.connectLeftDegenerate_(t,n,r)},e.sweep.sweepEvent_=function(t,r){t.event=r;for(var i=r.anEdge;null===i.activeRegion;)if((i=i.oNext)===r.anEdge)return void e.sweep.connectLeftVertex_(t,r);var n=e.sweep.topLeftRegion_(i.activeRegion),s=n.regionBelow(),o=s.eUp,a=e.sweep.finishLeftRegions_(t,s,null);a.oNext===o?e.sweep.connectRightVertex_(t,n,a):e.sweep.addRightEdges_(t,n,a.oNext,o,o,!0)},e.sweep.addSentinel_=function(t,r){var i=new e.ActiveRegion,n=e.mesh.makeEdge(t.mesh);n.org.s=e.sweep.SENTINEL_COORD_,n.org.t=r,n.dst().s=-e.sweep.SENTINEL_COORD_,n.dst().t=r,t.event=n.dst(),i.eUp=n,i.windingNumber=0,i.inside=!1,i.fixUpperEdge=!1,i.sentinel=!0,i.dirty=!1,i.nodeUp=t.dict.insert(i)},e.sweep.initEdgeDict_=function(t){t.dict=new e.Dict(t,e.sweep.edgeLeq_),e.sweep.addSentinel_(t,-e.sweep.SENTINEL_COORD_),e.sweep.addSentinel_(t,e.sweep.SENTINEL_COORD_)},e.sweep.doneEdgeDict_=function(t){for(var r,i=0;null!==(r=t.dict.getMin().getKey());)r.sentinel||(e.assert(r.fixUpperEdge),e.assert(1==++i)),e.assert(0===r.windingNumber),e.sweep.deleteRegion_(t,r);t.dict=null},e.sweep.removeDegenerateEdges_=function(t){for(var r,i=t.mesh.eHead,n=i.next;n!==i;n=r){r=n.next;var s=n.lNext;e.geom.vertEq(n.org,n.dst())&&n.lNext.lNext!==n&&(e.sweep.spliceMergeVertices_(t,s,n),e.mesh.deleteEdge(n),s=(n=s).lNext),s.lNext===n&&(s!==n&&(s!==r&&s!==r.sym||(r=r.next),e.mesh.deleteEdge(s)),n!==r&&n!==r.sym||(r=r.next),e.mesh.deleteEdge(n))}},e.sweep.initPriorityQ_=function(t){var r=new e.PriorityQ;t.pq=r;var i,n=t.mesh.vHead;for(i=n.next;i!==n;i=i.next)i.pqHandle=r.insert(i);r.init()},e.sweep.donePriorityQ_=function(e){e.pq.deleteQ(),e.pq=null},e.sweep.removeDegenerateFaces_=function(t){for(var r,i=t.fHead.next;i!==t.fHead;i=r){r=i.next;var n=i.anEdge;e.assert(n.lNext!==n),n.lNext.lNext===n&&(e.sweep.addWinding_(n.oNext,n),e.mesh.deleteEdge(n))}},e.tessmono={},e.tessmono.tessellateMonoRegion_=function(t){var r=t.anEdge;for(e.assert(r.lNext!==r&&r.lNext.lNext!==r);e.geom.vertLeq(r.dst(),r.org);r=r.lPrev());for(;e.geom.vertLeq(r.org,r.dst());r=r.lNext);for(var i,n=r.lPrev();r.lNext!==n;)if(e.geom.vertLeq(r.dst(),n.org)){for(;n.lNext!==r&&(e.geom.edgeGoesLeft(n.lNext)||e.geom.edgeSign(n.org,n.dst(),n.lNext.dst())<=0);)n=(i=e.mesh.connect(n.lNext,n)).sym;n=n.lPrev()}else{for(;n.lNext!==r&&(e.geom.edgeGoesRight(r.lPrev())||e.geom.edgeSign(r.dst(),r.org,r.lPrev().org)>=0);)i=e.mesh.connect(r,r.lPrev()),r=i.sym;r=r.lNext}for(e.assert(n.lNext!==r);n.lNext.lNext!==r;)n=(i=e.mesh.connect(n.lNext,n)).sym},e.tessmono.tessellateInterior=function(t){for(var r,i=t.fHead.next;i!==t.fHead;i=r)r=i.next,i.inside&&e.tessmono.tessellateMonoRegion_(i)},e.tessmono.discardExterior=function(t){for(var r,i=t.fHead.next;i!==t.fHead;i=r)r=i.next,i.inside||e.mesh.zapFace(i)},e.tessmono.setWindingNumber=function(t,r,i){for(var n,s=t.eHead.next;s!==t.eHead;s=n)n=s.next,s.rFace().inside!==s.lFace.inside?s.winding=s.lFace.inside?r:-r:i?e.mesh.deleteEdge(s):s.winding=0},e.Dict=function(t,r){this.head_=new e.DictNode,this.frame_=t,this.leq_=r},e.Dict.prototype.deleteDict_=function(){},e.Dict.prototype.insertBefore=function(t,r){do{t=t.prev}while(null!==t.key&&!this.leq_(this.frame_,t.key,r));var i=new e.DictNode(r,t.next,t);return t.next.prev=i,t.next=i,i},e.Dict.prototype.insert=function(e){return this.insertBefore(this.head_,e)},e.Dict.prototype.deleteNode=function(e){e.next.prev=e.prev,e.prev.next=e.next},e.Dict.prototype.search=function(e){var t=this.head_;do{t=t.next}while(null!==t.key&&!this.leq_(this.frame_,e,t.key));return t},e.Dict.prototype.getMin=function(){return this.head_.next},e.Dict.prototype.getMax=function(){return this.head_.prev},e.DictNode=function(e,t,r){this.key=e||null,this.next=t||this,this.prev=r||this},e.DictNode.prototype.getKey=function(){return this.key},e.DictNode.prototype.getSuccessor=function(){return this.next},e.DictNode.prototype.getPredecessor=function(){return this.prev},e.GluTesselator=function(){this.state_=e.GluTesselator.tessState_.T_DORMANT,this.lastEdge_=null,this.mesh=null,this.errorCallback_=null,this.normal_=[0,0,0],this.windingRule=e.windingRule.GLU_TESS_WINDING_ODD,this.fatalError=!1,this.dict=null,this.pq=null,this.event=null,this.combineCallback_=null,this.boundaryOnly_=!1,this.beginCallback_=null,this.edgeFlagCallback_=null,this.vertexCallback_=null,this.endCallback_=null,this.meshCallback_=null,this.polygonData_=null},e.GluTesselator.tessState_={T_DORMANT:0,T_IN_POLYGON:1,T_IN_CONTOUR:2},e.GluTesselator.prototype.gluDeleteTess=function(){this.requireState_(e.GluTesselator.tessState_.T_DORMANT)},e.GluTesselator.prototype.gluTessProperty=function(t,r){switch(t){case e.gluEnum.GLU_TESS_TOLERANCE:return;case e.gluEnum.GLU_TESS_WINDING_RULE:var i=r;switch(i){case e.windingRule.GLU_TESS_WINDING_ODD:case e.windingRule.GLU_TESS_WINDING_NONZERO:case e.windingRule.GLU_TESS_WINDING_POSITIVE:case e.windingRule.GLU_TESS_WINDING_NEGATIVE:case e.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO:return void(this.windingRule=i)}break;case e.gluEnum.GLU_TESS_BOUNDARY_ONLY:return void(this.boundaryOnly_=!!r);default:return void this.callErrorCallback(e.gluEnum.GLU_INVALID_ENUM)}this.callErrorCallback(e.gluEnum.GLU_INVALID_VALUE)},e.GluTesselator.prototype.gluGetTessProperty=function(t){switch(t){case e.gluEnum.GLU_TESS_TOLERANCE:return 0;case e.gluEnum.GLU_TESS_WINDING_RULE:var r=this.windingRule;return e.assert(r===e.windingRule.GLU_TESS_WINDING_ODD||r===e.windingRule.GLU_TESS_WINDING_NONZERO||r===e.windingRule.GLU_TESS_WINDING_POSITIVE||r===e.windingRule.GLU_TESS_WINDING_NEGATIVE||r===e.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO),r;case e.gluEnum.GLU_TESS_BOUNDARY_ONLY:return e.assert(!0===this.boundaryOnly_||!1===this.boundaryOnly_),this.boundaryOnly_;default:this.callErrorCallback(e.gluEnum.GLU_INVALID_ENUM)}return!1},e.GluTesselator.prototype.gluTessNormal=function(e,t,r){this.normal_[0]=e,this.normal_[1]=t,this.normal_[2]=r},e.GluTesselator.prototype.gluTessCallback=function(t,r){var i=r||null;switch(t){case e.gluEnum.GLU_TESS_BEGIN:case e.gluEnum.GLU_TESS_BEGIN_DATA:return void(this.beginCallback_=i);case e.gluEnum.GLU_TESS_EDGE_FLAG:case e.gluEnum.GLU_TESS_EDGE_FLAG_DATA:return void(this.edgeFlagCallback_=i);case e.gluEnum.GLU_TESS_VERTEX:case e.gluEnum.GLU_TESS_VERTEX_DATA:return void(this.vertexCallback_=i);case e.gluEnum.GLU_TESS_END:case e.gluEnum.GLU_TESS_END_DATA:return void(this.endCallback_=i);case e.gluEnum.GLU_TESS_ERROR:case e.gluEnum.GLU_TESS_ERROR_DATA:return void(this.errorCallback_=i);case e.gluEnum.GLU_TESS_COMBINE:case e.gluEnum.GLU_TESS_COMBINE_DATA:return void(this.combineCallback_=i);case e.gluEnum.GLU_TESS_MESH:return void(this.meshCallback_=i);default:return void this.callErrorCallback(e.gluEnum.GLU_INVALID_ENUM)}},e.GluTesselator.prototype.gluTessVertex=function(t,r){var i=!1,n=[0,0,0];this.requireState_(e.GluTesselator.tessState_.T_IN_CONTOUR);for(var s=0;s<3;++s){var o=t[s];o<-e.GLU_TESS_MAX_COORD&&(o=-e.GLU_TESS_MAX_COORD,i=!0),o>e.GLU_TESS_MAX_COORD&&(o=e.GLU_TESS_MAX_COORD,i=!0),n[s]=o}i&&this.callErrorCallback(e.errorType.GLU_TESS_COORD_TOO_LARGE),this.addVertex_(n,r)},e.GluTesselator.prototype.gluTessBeginPolygon=function(t){this.requireState_(e.GluTesselator.tessState_.T_DORMANT),this.state_=e.GluTesselator.tessState_.T_IN_POLYGON,this.mesh=new e.GluMesh,this.polygonData_=t},e.GluTesselator.prototype.gluTessBeginContour=function(){this.requireState_(e.GluTesselator.tessState_.T_IN_POLYGON),this.state_=e.GluTesselator.tessState_.T_IN_CONTOUR,this.lastEdge_=null},e.GluTesselator.prototype.gluTessEndContour=function(){this.requireState_(e.GluTesselator.tessState_.T_IN_CONTOUR),this.state_=e.GluTesselator.tessState_.T_IN_POLYGON},e.GluTesselator.prototype.gluTessEndPolygon=function(){if(this.requireState_(e.GluTesselator.tessState_.T_IN_POLYGON),this.state_=e.GluTesselator.tessState_.T_DORMANT,e.normal.projectPolygon(this,this.normal_[0],this.normal_[1],this.normal_[2]),e.sweep.computeInterior(this),!this.fatalError){var t=this.mesh;if(this.boundaryOnly_?e.tessmono.setWindingNumber(t,1,!0):e.tessmono.tessellateInterior(t),this.mesh.checkMesh(),this.beginCallback_||this.endCallback_||this.vertexCallback_||this.edgeFlagCallback_)if(this.boundaryOnly_)e.render.renderBoundary(this,this.mesh);else{var r=!!this.edgeFlagCallback_;e.render.renderMesh(this,this.mesh,r)}if(this.meshCallback_)return e.tessmono.discardExterior(this.mesh),this.meshCallback_(this.mesh),this.mesh=null,void(this.polygonData_=null)}e.mesh.deleteMesh(this.mesh),this.polygonData_=null,this.mesh=null},e.GluTesselator.prototype.requireState_=function(e){this.state_!==e&&this.gotoState_(e)},e.GluTesselator.prototype.gotoState_=function(t){for(;this.state_!==t;)if(this.state_<t)switch(this.state_){case e.GluTesselator.tessState_.T_DORMANT:this.callErrorCallback(e.errorType.GLU_TESS_MISSING_BEGIN_POLYGON),this.gluTessBeginPolygon(null);break;case e.GluTesselator.tessState_.T_IN_POLYGON:this.callErrorCallback(e.errorType.GLU_TESS_MISSING_BEGIN_CONTOUR),this.gluTessBeginContour()}else switch(this.state_){case e.GluTesselator.tessState_.T_IN_CONTOUR:this.callErrorCallback(e.errorType.GLU_TESS_MISSING_END_CONTOUR),this.gluTessEndContour();break;case e.GluTesselator.tessState_.T_IN_POLYGON:this.callErrorCallback(e.errorType.GLU_TESS_MISSING_END_POLYGON),this.gluTessEndPolygon()}},e.GluTesselator.prototype.addVertex_=function(t,r){var i=this.lastEdge_;null===i?(i=e.mesh.makeEdge(this.mesh),e.mesh.meshSplice(i,i.sym)):(e.mesh.splitEdge(i),i=i.lNext),i.org.data=r,i.org.coords[0]=t[0],i.org.coords[1]=t[1],i.org.coords[2]=t[2],i.winding=1,i.sym.winding=-1,this.lastEdge_=i},e.GluTesselator.prototype.callBeginCallback=function(e){this.beginCallback_&&this.beginCallback_(e,this.polygonData_)},e.GluTesselator.prototype.callVertexCallback=function(e){this.vertexCallback_&&this.vertexCallback_(e,this.polygonData_)},e.GluTesselator.prototype.callEdgeFlagCallback=function(e){this.edgeFlagCallback_&&this.edgeFlagCallback_(e,this.polygonData_)},e.GluTesselator.prototype.callEndCallback=function(){this.endCallback_&&this.endCallback_(this.polygonData_)},e.GluTesselator.prototype.callCombineCallback=function(e,t,r){return this.combineCallback_&&this.combineCallback_(e,t,r,this.polygonData_)||null},e.GluTesselator.prototype.callErrorCallback=function(e){this.errorCallback_&&this.errorCallback_(e,this.polygonData_)},e.GluFace=function(e,t){this.next=e||this,this.prev=t||this,this.anEdge=null,this.inside=!1},e.GluHalfEdge=function(e){this.next=e||this,this.sym=null,this.oNext=null,this.lNext=null,this.org=null,this.lFace=null,this.activeRegion=null,this.winding=0},e.GluHalfEdge.prototype.rFace=function(){return this.sym.lFace},e.GluHalfEdge.prototype.dst=function(){return this.sym.org},e.GluHalfEdge.prototype.oPrev=function(){return this.sym.lNext},e.GluHalfEdge.prototype.lPrev=function(){return this.oNext.sym},e.GluHalfEdge.prototype.dPrev=function(){return this.lNext.sym},e.GluHalfEdge.prototype.rPrev=function(){return this.sym.oNext},e.GluHalfEdge.prototype.dNext=function(){return this.rPrev().sym},e.GluHalfEdge.prototype.rNext=function(){return this.oPrev().sym},e.GluMesh=function(){this.vHead=new e.GluVertex,this.fHead=new e.GluFace,this.eHead=new e.GluHalfEdge,this.eHeadSym=new e.GluHalfEdge,this.eHead.sym=this.eHeadSym,this.eHeadSym.sym=this.eHead},e.GluMesh.prototype.checkMesh=function(){if(e.DEBUG){var t,r,i=this.fHead,n=this.vHead,s=this.eHead,o=i;for(o=i;(r=o.next)!==i;o=r){e.assert(r.prev===o),t=r.anEdge;do{e.assert(t.sym!==t),e.assert(t.sym.sym===t),e.assert(t.lNext.oNext.sym===t),e.assert(t.oNext.sym.lNext===t),e.assert(t.lFace===r),t=t.lNext}while(t!==r.anEdge)}e.assert(r.prev===o&&null===r.anEdge);var a,l=n;for(l=n;(a=l.next)!==n;l=a){e.assert(a.prev===l),t=a.anEdge;do{e.assert(t.sym!==t),e.assert(t.sym.sym===t),e.assert(t.lNext.oNext.sym===t),e.assert(t.oNext.sym.lNext===t),e.assert(t.org===a),t=t.oNext}while(t!==a.anEdge)}e.assert(a.prev===l&&null===a.anEdge&&null===a.data);var u=s;for(u=s;(t=u.next)!==s;u=t)e.assert(t.sym.next===u.sym),e.assert(t.sym!==t),e.assert(t.sym.sym===t),e.assert(null!==t.org),e.assert(null!==t.dst()),e.assert(t.lNext.oNext.sym===t),e.assert(t.oNext.sym.lNext===t);e.assert(t.sym.next===u.sym&&t.sym===this.eHeadSym&&t.sym.sym===t&&null===t.org&&null===t.dst()&&null===t.lFace&&null===t.rFace())}},e.GluVertex=function(e,t){this.next=e||this,this.prev=t||this,this.anEdge=null,this.data=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0},e.PriorityQ=function(){this.verts_=[],this.order_=null,this.size_=0,this.initialized_=!1,this.heap_=new e.PriorityQHeap},e.PriorityQ.prototype.deleteQ=function(){this.heap_=null,this.order_=null,this.verts_=null},e.PriorityQ.prototype.init=function(){this.order_=[];for(var t=0;t<this.size_;t++)this.order_[t]=t;var r=function(t){return function(r,i){return e.geom.vertLeq(t[r],t[i])?1:-1}}(this.verts_);if(this.order_.sort(r),this.initialized_=!0,this.heap_.init(),e.DEBUG){var i=0+this.size_-1;for(t=0;t<i;++t)e.assert(e.geom.vertLeq(this.verts_[this.order_[t+1]],this.verts_[this.order_[t]]))}},e.PriorityQ.prototype.insert=function(e){if(this.initialized_)return this.heap_.insert(e);var t=this.size_++;return this.verts_[t]=e,-(t+1)},e.PriorityQ.prototype.extractMin=function(){if(0===this.size_)return this.heap_.extractMin();var t=this.verts_[this.order_[this.size_-1]];if(!this.heap_.isEmpty()){var r=this.heap_.minimum();if(e.geom.vertLeq(r,t))return this.heap_.extractMin()}do{--this.size_}while(this.size_>0&&null===this.verts_[this.order_[this.size_-1]]);return t},e.PriorityQ.prototype.minimum=function(){if(0===this.size_)return this.heap_.minimum();var t=this.verts_[this.order_[this.size_-1]];if(!this.heap_.isEmpty()){var r=this.heap_.minimum();if(e.geom.vertLeq(r,t))return r}return t},e.PriorityQ.prototype.remove=function(t){if(t>=0)this.heap_.remove(t);else for(t=-(t+1),e.assert(t<this.verts_.length&&null!==this.verts_[t]),this.verts_[t]=null;this.size_>0&&null===this.verts_[this.order_[this.size_-1]];)--this.size_},e.PriorityQHeap=function(){this.heap_=e.PriorityQHeap.reallocNumeric_([0],e.PriorityQHeap.INIT_SIZE_+1),this.verts_=[null,null],this.handles_=[0,0],this.size_=0,this.max_=e.PriorityQHeap.INIT_SIZE_,this.freeList_=0,this.initialized_=!1,this.heap_[1]=1},e.PriorityQHeap.INIT_SIZE_=32,e.PriorityQHeap.reallocNumeric_=function(e,t){for(var r=new Array(t),i=0;i<e.length;i++)r[i]=e[i];for(;i<t;i++)r[i]=0;return r},e.PriorityQHeap.prototype.init=function(){for(var e=this.size_;e>=1;--e)this.floatDown_(e);this.initialized_=!0},e.PriorityQHeap.prototype.insert=function(t){var r,i=++this.size_;return 2*i>this.max_&&(this.max_*=2,this.handles_=e.PriorityQHeap.reallocNumeric_(this.handles_,this.max_+1)),0===this.freeList_?r=i:(r=this.freeList_,this.freeList_=this.handles_[this.freeList_]),this.verts_[r]=t,this.handles_[r]=i,this.heap_[i]=r,this.initialized_&&this.floatUp_(i),r},e.PriorityQHeap.prototype.isEmpty=function(){return 0===this.size_},e.PriorityQHeap.prototype.minimum=function(){return this.verts_[this.heap_[1]]},e.PriorityQHeap.prototype.extractMin=function(){var e=this.heap_,t=this.verts_,r=this.handles_,i=e[1],n=t[i];return this.size_>0&&(e[1]=e[this.size_],r[e[1]]=1,t[i]=null,r[i]=this.freeList_,this.freeList_=i,--this.size_>0&&this.floatDown_(1)),n},e.PriorityQHeap.prototype.remove=function(t){var r=this.heap_,i=this.verts_,n=this.handles_;e.assert(t>=1&&t<=this.max_&&null!==i[t]);var s=n[t];if(r[s]=r[this.size_],n[r[s]]=s,s<=--this.size_)if(s<=1)this.floatDown_(s);else{var o=i[r[s]],a=i[r[s>>1]];e.geom.vertLeq(a,o)?this.floatDown_(s):this.floatUp_(s)}i[t]=null,n[t]=this.freeList_,this.freeList_=t},e.PriorityQHeap.prototype.floatDown_=function(t){for(var r=this.heap_,i=this.verts_,n=this.handles_,s=t,o=r[s];;){var a=s<<1;a<this.size_&&e.geom.vertLeq(i[r[a+1]],i[r[a]])&&(a+=1),e.assert(a<=this.max_);var l=r[a];if(a>this.size_||e.geom.vertLeq(i[o],i[l]))return r[s]=o,void(n[o]=s);r[s]=l,n[l]=s,s=a}},e.PriorityQHeap.prototype.floatUp_=function(t){for(var r=this.heap_,i=this.verts_,n=this.handles_,s=t,o=r[s];;){var a=s>>1,l=r[a];if(0===a||e.geom.vertLeq(i[l],i[o]))return r[s]=o,void(n[o]=s);r[s]=l,n[l]=s,s=a}},e.ActiveRegion=function(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1},e.ActiveRegion.prototype.regionBelow=function(){return this.nodeUp.getPredecessor().getKey()},e.ActiveRegion.prototype.regionAbove=function(){return this.nodeUp.getSuccessor().getKey()},e}.apply(null,[]))||(e.exports=i)},429:function(e,t,r){var i,n;i=[r(772),r(341),r(339),r(348),r(687),r(661),r(455),r(648),r(393),r(723),r(363),r(375)],void 0===(n=function(e,t,r,i,n,s,o,a,l,u,p,h){function c(e){var t=l.createSyntaxTree(e),r=t&&t.body&&t.body[0]&&t.body[0].body&&t.body[0].body.body;if(!r||1!==r.length)return null;var i="ExpressionStatement"===r[0].type&&r[0].expression;if(!i||"MemberExpression"!==i.type)return null;var n=i.object;if(!n||"Identifier"!==n.type||"$feature"!==n.name)return null;var s=i.property;if(!s)return null;switch(s.type){case"Literal":return s.value;case"Identifier":return s.name}return null}function d(e){return!e||"service"!==e.origin&&(!e.layer||!a.isOfType(e.layer,"map-image"))}var f=i({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0}),g=new u,_=t.createSubclass({declaredClass:"esri.layers.support.LabelClass",properties:{name:{type:String,value:null,json:{write:!0}},labelExpression:{type:String,value:null,json:{read:function(e,t,r,i){var n=t.labelExpressionInfo;if(!n||!n.value&&!n.expression)return e},write:{allowNull:!0,writer:function(e,t,r,i){if(this.labelExpressionInfo&&d(i))if(null!=this.labelExpressionInfo.value)e=this._templateStringToSql(this.labelExpressionInfo.value);else if(null!=this.labelExpressionInfo.expression){var n=c(this.labelExpressionInfo.expression);n&&(e="["+n+"]")}null!=e&&(t[r]=e)}}}},labelExpressionInfo:{value:null,type:s,json:{write:{overridePolicy:function(e,t,r){return d(r)?{allowNull:!0}:{enabled:!1}},writer:function(e,t,r,i){if(null==e&&null!=this.labelExpression&&d(i))e=new s({expression:this.getLabelExpressionArcade()});else if(!e)return;var n=e.toJSON(i);n.expression&&(t[r]=n)}}}},labelPlacement:{type:f.apiValues,value:null,json:{type:f.jsonValues,read:f.read,write:f.write}},maxScale:{type:Number,value:0,json:{write:function(e,t){(e||this.minScale)&&(t.maxScale=e)}}},minScale:{type:Number,value:0,json:{write:function(e,t){(e||this.maxScale)&&(t.minScale=e)}}},requiredFields:{readOnly:!0,dependsOn:["labelExpression","labelExpressionInfo","where"],get:function(){var e=Object.create(null);return this._collectRequiredFields(e),Object.keys(e)}},symbol:{value:null,types:h.labelTypes,json:{origins:{"web-scene":{read:p.read,write:{target:{symbol:{types:h.labelTypes3D}},writer:p.writeTarget}}},read:p.read,write:p.writeTarget}},useCodedValues:{type:Boolean,value:null,json:{write:!0}},where:{type:String,value:null,json:{write:!0}}},getLabelExpression:function(){var e={expression:"",type:"none"};return this.labelExpressionInfo?this.labelExpressionInfo.value?(e.expression=this.labelExpressionInfo.value,e.type="conventional"):this.labelExpressionInfo.expression&&(e.expression=this.labelExpressionInfo.expression,e.type="arcade"):null!=this.labelExpression&&(e.expression=this._sqlToTemplateString(this.labelExpression),e.type="conventional"),e},getLabelExpressionArcade:function(){var e=this.getLabelExpression();if(!e)return null;switch(e.type){case"conventional":return o.convertTemplatedStringToArcade(e.expression);case"arcade":return e.expression}return null},getOptions:function(e){var t={spatialReference:e},r=this.labelExpressionInfo;if(r){var i=r.expression;i&&!r.value&&(t.hasArcadeExpression=!0,t.compiledArcadeFunc=l.createFunction(i))}return t},getLabelExpressionSingleField:function(){var e=this.getLabelExpression();if(!e)return null;switch(e.type){case"conventional":return function(e){var t=e.match(m);return t&&t[1].trim()||null}(e.expression);case"arcade":return c(e.expression)}return null},clone:function(){return new _({labelExpression:this.labelExpression,labelExpressionInfo:r.clone(this.labelExpressionInfo),labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,symbol:this.symbol.clone(),where:this.where,useCodedValues:this.useCodedValues})},_collectRequiredFields:function(e){this._collectLabelExpressionRequiredFields(this.getLabelExpression(),e),this._collectWhereRequiredFields(this.where,e)},_sqlToTemplateString:function(e){return e.replace(new RegExp("\\[","g"),"{").replace(new RegExp("\\]","g"),"}")},_templateStringToSql:function(e){return e.replace(new RegExp("\\{","g"),"[").replace(new RegExp("\\}","g"),"]")},_collectWhereRequiredFields:function(e,t){if(null!=e){var r=e.split(" ");3===r.length&&(t[r[0]]=!0),7===r.length&&(t[r[0]]=!0,t[r[4]]=!0)}},_collectLabelExpressionRequiredFields:function(e,t){if("arcade"===e.type)l.extractFieldNames(e.expression).forEach(function(e){t[e]=!0});else{var r=e.expression.match(/{[^}]*}/g);r&&r.forEach(function(e){t[e.slice(1,-1)]=!0})}}});_.evaluateWhere=function(e,t){var r=function(e,t,r){switch(t){case"=":return e==r;case"<>":return e!=r;case">":return e>r;case">=":return e>=r;case"<":return e<r;case"<=":return e<=r}return!1};try{if(null==e)return!0;var i=e.split(" ");if(3===i.length)return r(t[i[0]],i[1],i[2]);if(7===i.length){var n=r(t[i[0]],i[1],i[2]),s=i[3],o=r(t[i[4]],i[5],i[6]);switch(s){case"AND":return n&&o;case"OR":return n||o}}return!1}catch(t){console.log("Error.: can't parse = "+e)}},_.buildLabelText=function(e,t,r,i){var n="";if(i&&i.hasArcadeExpression){if(i.compiledArcadeFunc){g.repurposeFromGraphicLikeObject(t.geometry,t.attributes,{fields:r});var s={vars:{$feature:g},spatialReference:i.spatialReference},o=l.executeFunction(i.compiledArcadeFunc,s);null!=o&&(n=o.toString())}}else{var a=t&&t.attributes||{};n=e.replace(/{[^}]*}/g,function(e){return _.formatField(e.slice(1,-1),e,a,r,i)})}return n},_.formatField=function(t,i,s,o,a){var l,u,p=i,h=t.toLowerCase();for(l=0;l<o.length;l++)if(o[l].name.toLowerCase()===h){p=s[o[l].name];var c=o[l].domain;if(c&&"object"==typeof c){if("codedValue"==c.type)for(u=0;u<c.codedValues.length;u++)c.codedValues[u].code==p&&(p=c.codedValues[u].name);else"range"==c.type&&c.minValue<=p&&p<=c.maxValue&&(p=c.name);return null==p?"":p}var d=o[l].type;if("date"==d){var f=e.fromJSON(a&&a.dateFormat||"shortDate"),g="DateFormat"+e.getFormat(f);g&&(p=r.substitute({myKey:p},"{myKey:"+g+"}"))}else"integer"!=d&&"small-integer"!=d&&"long"!=d&&"double"!=d||a&&a.numberFormat&&a.numberFormat.digitSeparator&&a.numberFormat.places&&(p=n.format(p,{places:a.numberFormat.places}))}return null==p?"":p};var m=/^\s*\{([^}]+)\}\s*$/i;return _}.apply(null,i))||(e.exports=n)},455:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(662)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i="__begin__",n="__end__",s=new RegExp(i,"ig"),o=new RegExp(n,"ig"),a=new RegExp("^"+i,"i"),l=new RegExp(n+"$","i"),u='"',p=u+" + ",h=" + "+u;t.convertTemplatedStringToArcade=function(e){var t;return e?(t=r.replace(e,function(e,t){return i+'$feature["'+t+'"]'+n}),t=a.test(t)?t.replace(a,""):u+t,t=(t=l.test(t)?t.replace(l,""):t+u).replace(s,p).replace(o,h)):t='""',t}}.apply(null,i))||(e.exports=n)},648:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.isOfType=function(e,t){var r=e.constructor._meta;if(!r||!r.bases)return!1;var i=r.bases,n=Array.isArray(t);return i.some(function(e){var r=e.__accessorMetadata__;if(!r)return!1;var i=r.properties;if(!i||!i.type||!i.type.value)return!1;var s=i.type.value;return n?-1!==t.indexOf(s):s===t})}}.apply(null,i))||(e.exports=n)},661:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(338),r(336),r(341),r(337),r(455)],void 0===(n=function(e,t,r,i,n,s,o){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.value=null,t.expression=null,t}var n;return r(t,e),n=t,t.prototype.readExpression=function(e,t){return t.value?o.convertTemplatedStringToArcade(t.value):e},t.prototype.writeExpression=function(e,t,r){null!=this.value&&(e=o.convertTemplatedStringToArcade(this.value)),t[r]=e},t.prototype.clone=function(){return new n({value:this.value,expression:this.expression})},i([s.property({json:{read:!1,write:!1}})],t.prototype,"value",void 0),i([s.property({json:{write:{allowNull:!0}}})],t.prototype,"expression",void 0),i([s.reader("expression",["expression","value"])],t.prototype,"readExpression",null),i([s.writer("expression")],t.prototype,"writeExpression",null),n=i([s.subclass("esri.layers.support.LabelExpressionInfo")],t)}(s.declared(n))}.apply(null,i))||(e.exports=n)},662:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(402)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.replace=function(e,t,i){return void 0===i&&(i=/\{([^\}]+)\}/g),e.replace(i,"function"==typeof t?t:function(e,i){return r.getDeepValue(i,t)})}}.apply(null,i))||(e.exports=n)}}]);