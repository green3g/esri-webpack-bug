define(["require","exports","../tsSupport/assignHelper","dojo/_base/kernel","../../config","../../request","../has","../Logger","../promiseUtils","../urlUtils","./loaderConfig","./utils","./WorkerFallback"],function(e,r,o,i,l,t,c,a,n,s,f,u,d){function g(s){return n.create(function(t){function a(e){var r=u.receiveMessage(e);if(r)switch(r.type){case y:!function(e){var r,t=l.workers.loaderUrl||f.DEFAULT_LOADER_URL;if(null!=l.default){var a=o({},l);delete a.default,r=JSON.parse(JSON.stringify(a))}else r=JSON.parse(JSON.stringify(l));var n=l.workers.loaderConfig,s=f.default({baseUrl:n.baseUrl,locale:i.locale,has:o({"config-deferredInstrumentation":0,"dojo-test-sniff":0,"esri-secure-context":c("esri-secure-context"),"esri-workers-arraybuffer-transfer":c("esri-workers-arraybuffer-transfer"),"events-keypress-typed":0,"host-webworker":1},n.has),map:o({},n.map),paths:o({},n.paths),packages:n.packages||[]});e.postMessage({type:h,configure:{esriConfig:r,loaderUrl:t,loaderConfig:s}})}(s);break;case m:s.removeEventListener("message",a),s.removeEventListener("error",n),t(s)}}function n(e){e.preventDefault(),s.removeEventListener("message",a),s.removeEventListener("error",n),k.warn("Failed to create Worker. Fallback to execute module in main thread",e),(s=new d).addEventListener("message",a),s.addEventListener("error",n)}s.addEventListener("message",a),s.addEventListener("error",n)})}Object.defineProperty(r,"__esModule",{value:!0});var p=s.normalize(e.toUrl("./worker.js")),v=!s.hasSameOrigin(p,location.href),k=a.getLogger("esri.core.workers"),w=null;c.add("esri-workers-arraybuffer-transfer",!c("safari")||12<=c("safari"));var m=u.MessageType.CONFIGURED,h=u.MessageType.CONFIGURE,y=u.MessageType.HANDSHAKE;r.createWorker=function(){if(!c("esri-workers"))return g(new d);if(v)return w||(w=t(p,{responseType:"text"})),w.then(function(e){return new Worker(URL.createObjectURL(new Blob([e.data],{type:"text/javascript"})))}).catch(function(e){return k.warn("Failed to create Worker. Fallback to execute module in main thread",e),new d}).then(function(e){return g(e)});var r=void 0;try{r=new Worker(p)}catch(e){k.warn("Failed to create Worker. Fallback to execute module in main thread",event),r=new d}return g(r)}});