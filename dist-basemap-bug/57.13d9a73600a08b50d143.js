(function(){(this||window).webpackJsonp.registerAbsMids({"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/FeatureLayer":331,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/Util":349,"esri/core/screenUtils":357,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/screenUtils":357,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/renderers/Renderer":369,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/webgl/Texture":371,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/DefaultVertexAttributeLocations":372,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/symbols/Symbol":373,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/watchUtils":374,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/support/Domain":376,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/webgl/FramebufferObject":377,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/workers/utils":379,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/geometry/support/aaBoundingBox":389,"esri/core/workers/RemoteClient":391,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/workers/RemoteClient":391,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/tasks/support/FeatureSet":394,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/support/Field":396,"esri/core/tsSupport/generatorHelper":398,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/tsSupport/generatorHelper":398,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/shaders/sources/resolver":401,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/support/domains":403,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/tsSupport/awaiterHelper":404,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/tasks/operations/urlUtils":405,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/graphics/graphicUtils":406,"esri/symbols/SimpleLineSymbol":407,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/symbols/SimpleLineSymbol":407,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/PooledArray":411,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/renderers/SimpleRenderer":413,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/renderers/ClassBreaksRenderer":414,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/renderers/HeatmapRenderer":415,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/renderers/UniqueValueRenderer":416,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/RenderSlot":419,"esri/renderers/support/jsonUtils":421,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/renderers/support/jsonUtils":421,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/glUtil3D":422,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/materials/internal/MaterialUtil":424,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/mixins/ScaleRangeLayer":425,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/renderers/support/LegendOptions":426,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/graphics/OptimizedFeatureSet":427,"esri/layers/support/LabelClass":429,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/support/LabelClass":429,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/ComponentUtils":430,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/support/commonProperties":432,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/DefaultVertexBufferLayouts":439,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/mixins/RefreshableLayer":441,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/workers":443,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/tasks/support/AttachmentQuery":444,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/tasks/support/RelationshipQuery":447,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/support/fieldUtils":451,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/IdGen":452,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/requireUtils":454,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/support/labelUtils":455,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/support/FeatureReduction":457,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/support/layerSourceUtils":458,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/ModelContentType":459,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/Stage":462,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/symbols/FillSymbol":464,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/symbols/MarkerSymbol":465,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/support/FeatureTemplate":466,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/symbols/support/urlUtils":591,"@dojo/framework/shim/Set":592,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/symbols/LineSymbol":593,"esri/core/pbf":594,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/pbf":594,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/RenderPass":595,"esri/layers/graphics/OptimizedGeometry":597,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/graphics/OptimizedGeometry":597,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/graphics/dehydratedFeatures":598,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/support/CodedValueDomain":600,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/support/InheritedDomain":601,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/support/RangeDomain":602,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/support/fieldType":603,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/graphics/Graphics3DSymbolCommonCode":604,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/renderers/support/typeUtils":606,"esri/layers/graphics/OptimizedFeature":607,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/graphics/OptimizedFeature":607,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/Geometry":608,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/workers/workers":609,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/workers/Connection":610,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/workers/WorkerOwner":611,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/workers/workerFactory":612,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/workers/loaderConfig":613,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/workers/WorkerFallback":614,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/geometry/support/graphicsUtils":615,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/support/debugFlags":617,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/support/buffer/BufferView":618,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/renderers/support/diffUtils":620,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/support/geometryUtils":622,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/tasks/operations/query":626,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/tasks/operations/pbfQueryUtils":627,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/tasks/operations/pbfFeatureServiceParser":628,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lighting/Lightsources":629,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/shaders/MiscPrograms":630,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/symbols/support/styleUtils":632,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/renderers/support/styleUtils":633,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/Camera":634,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/renderers":638,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/tasks/operations/queryAttachments":639,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/support/imageUtils":640,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/materials/DefaultMaterial":641,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/renderers/support/AuthoringInfo":643,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/renderers/support/AuthoringInfoVisualVariable":644,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/renderers/support/ClassBreakInfo":645,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/renderers/support/HeatmapColorStop":646,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/renderers/support/UniqueValueInfo":647,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/support/types":648,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/tasks/QueryTask":649,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/tasks/operations/queryRelatedRecords":650,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/Material":651,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/support/FeatureProcessing":656,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/HeapSort":657,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/support/FeatureReductionSelection":660,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/support/LabelExpressionInfo":661,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/string":662,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/support/labelingInfo":663,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/layers/LayerView":664,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/support/buffer/InterleavedLayout":665,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/graphics/sources/MemorySource":668,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/materials/internal/bufferWriters":672,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/accessorSupport/typescript":678,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/typescript":679,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/support/FeatureIndex":680,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/support/FeatureType":681,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/support/Relationship":682,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/depthRange":684,"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeProcessingWorker":686,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/edgeRendering/EdgeProcessingWorker":686,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/iteratorUtils":695,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/Object3D":699,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/graphics/featureExpressionInfoUtils":706,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/RenderGeometry":707,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/GLMaterial":708,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/Texture":709,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/symbols/PictureMarkerSymbol":713,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/symbols/SimpleFillSymbol":714,"@dojo/framework/shim/Map":724,"esri/views/3d/layers/SceneLayerWorker":726,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/SceneLayerWorker":726,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/HighlightUtils":734,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/parts/Model":735,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/Renderer":736,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/localOriginHelper":737,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/GLMaterialTexture":738,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/SliceHelper":739,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/LayerView3D":746,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/graphics/dehydratedFeatureComparison":751,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/support/buffer/glUtil":753,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/support/buffer/bufferViewUtil":754,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/materials/HUDMaterial":755,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/geometry/support/quantizationUtils":773,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/support/layerViewUpdatingProperties":776,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/webgl/capabilities/isWebGL2Context":778,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/support/orientedBoundingBox":779,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/i3s/I3SUtil":780,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/SceneLayer":788,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/Performance":792,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/support/intersectionUtils":793,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/i3s/I3SBinaryReader":794,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/geometry/support/heightModelInfoUtils":804,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/PreinterleavedGeometryData":808,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/TextureBackedBuffer/BufferManager":809,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/PerformanceTimer":810,"@dojo/framework/shim/array":814,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/support/PromiseLightweight":819,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/ModelDirtySet":840,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/parts/View":841,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/DrapedRenderer":842,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/Float32ArrayList":843,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/FxaaRenderPass":844,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/HighlightTextureHelper":845,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/InstanceBufferData":846,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/IntervalUtilities":847,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/LinearDepthTextureHelper":848,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/NormalTextureHelper":849,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/RenderContext":850,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/RenderPluginManager":851,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/SmaaRenderPass":852,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/StencilRenderingHelper":853,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/edgeRendering/EdgeView":854,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/LocalOriginManager":855,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/RegularGridLocalOriginFactory":856,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/TextureBackedBuffer/ManagedTextureBackedBuffer":857,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/TextureBackedBuffer/SimpleIndexManager":858,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/TextureBackedBuffer/TextureBackedBuffer":859,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/edgeRendering/EdgeRenderer":860,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/shaders/EdgeRendererPrograms":861,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/edgeRendering/strokes":862,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/edgeRendering/util":863,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lighting/SceneLighting":864,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lighting/SphericalHarmonics":865,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/LongVectorMath":866,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/shaders/HUDPrograms":867,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/webgl/Profiling":868,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/materials/internal/TexOnlyGLMaterial":869,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/GLMaterialRep":870,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/GLTextureRep":871,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/tracer":872,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/webgl-debug":873,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/parts/Viewport":874,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/parts/Visualizer":875,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/TimeProfiler":876,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/depthRangeUtils":877,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/HighlightHelper":878,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/shaders/HighlightPrograms":879,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/OffscreenRenderingHelper":880,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/RenderTargetHelper":881,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/shaders/OffscreenPrograms":882,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/RenderOccludedHelper":883,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/shaders/OccludedPrograms":884,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/ShadowMap":885,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/SSAOHelper":886,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/shaders/SSAOPrograms":887,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/shaders/DefaultPrograms":888,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/DDSUtil":889,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/geometryDataUtils":902,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/graphics/ElevationContext":963,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/webgl/Renderbuffer":964,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/edgeRendering/bufferLayouts":965,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/support/Evented":967,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/support/edgeUtils":984,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/Octree":985,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/support/geometryUtils/lineSegment":1007,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/edgeRendering/edgeBufferWriters":1008,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/screenSizePerspectiveUtils":1009,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/webgl/RenderingContext":1010,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/i3s/LEPCC":1012,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/ProgramRepository":1021,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/GeometryRecord":1043,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/support/meshProcessing":1044,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/BoundingInfo":1045,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/support/symbolColorUtils":1046,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/Layer":1047,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/HighlightSet":1048,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/support/attributeUtils":1050,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/support/dito":1053,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/sql/WhereClause":1055,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/sql/AggregateFunctions":1056,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/sql/StandardizedFunctions":1057,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/sql/WhereGrammar":1058,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/core/sql/sql92grammar":1059,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/support/geometryUtils/plane":1274,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/support/geometryUtils/triangle":1275,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/i3s/I3SProjectionUtil":1278,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/i3s/IdleQueue":1283,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/doublePrecisionUtils":1288,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/SceneLayerView3D":1296,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/i3s/I3SGeometryUtil":1382,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/graphics/controllers/I3SOnDemandController":1398,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/i3s/I3SIndex":1399,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/i3s/I3SLodHandling":1400,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/i3s/I3SNodeLoader":1401,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/i3s/I3SViewportQueries":1402,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/support/ResourceController":1403,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/support/MemoryController":1404,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/support/MemoryManagedLayerView":1405,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/support/MemCache":1406,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/support/StreamDataLoader":1407,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/support/AsyncQuotaRoundRobinQueue":1408,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/support/StreamDataSupplier":1409,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/i3s/I3SQueryEngine":1410,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/layers/support/RangeInfo":1481,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/support/buffer/internals/Mat3":1501,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/support/buffer/internals/Mat4":1502,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/support/buffer/internals/Single":1503,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/support/buffer/internals/Vec2":1504,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/support/buffer/internals/Vec3":1505,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/support/buffer/internals/Vec4":1506,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/support/buffer/workerHelper":1507,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/edgeRendering/edgePreprocessing":1508,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/shaders/sources/shaderRepository":1509,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/webgl/enums":1510,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/webgl/InstanceCounter":1511,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/webgl/capabilities/load":1512,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/webgl/capabilities/DisjointTimerQuery":1513,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/webgl/capabilities/Instancing":1514,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/webgl/capabilities/VertexArrayObjects":1515,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/i3s/Highlights":1576,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/i3s/I3SElevationProvider":1577,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/webgl-engine/lib/Selector":1578,"C:/Users/roemh/web/datafi/node_modules/arcgis-js-api/views/3d/layers/i3s/IDBCache":1579})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[57,6,7,8,14,103],{1007:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(344),r(364)],void 0===(i=function(e,t,r,n){function i(e,t){return void 0===e&&(e=r.vec3d.create()),void 0===t&&(t=r.vec3d.create()),{origin:e,vector:t}}Object.defineProperty(t,"__esModule",{value:!0}),t.create=i,t.fromOriginAndVector=function(e,t,n){return void 0===n&&(n=i()),r.vec3d.set(e,n.origin),r.vec3d.set(t,n.vector),n},t.distance2=function(e,t){var i=r.vec3d.subtract(t,e.origin),a=r.vec3d.dot(e.vector,i),s=r.vec3d.dot(e.vector,e.vector),l=n.clamp(a/s,0,1),u=r.vec3d.subtract(r.vec3d.scale(e.vector,l,o),i,o);return r.vec3d.dot(u,u)};var o=r.vec3d.create()}.apply(null,n))||(e.exports=i)},1008:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(345),r(347),r(344),r(753),r(965)],void 0===(i=function(e,t,r,n,i,o,a){function s(e){var t=u;t[0]=e.position0[0],t[1]=e.position0[1],t[2]=e.position0[2],t[3]=e.position1[0],t[4]=e.position1[1],t[5]=e.position1[2],d[0]=5381;for(var r=0;r<c.length;r++)d[0]=31*d[0]+c[r];return d[0]}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(){}return e.prototype.updateSettings=function(e){this.settings=e},e.prototype.write=function(e,t,r){var n=s(r);p.reseed(n);var i=p.randomRangeInt(0,255),o=p.randomRangeInt(0,this.settings.variants-1),a=p.randomFloat(),l=255*(.5*function(e,t){var r=e<0?-1:1;return Math.pow(Math.abs(e),t)*r}(-(1-Math.min(a/.7,1))+Math.max(0,a-.7)/(1-.7),1.2)+.5);e.position0.setVec(t,r.position0),e.position1.setVec(t,r.position1),e.componentIndex.set(t,r.componentIndex),e.variantOffset.set(t,i),e.variantStroke.set(t,o),e.variantExtension.set(t,l)},e.prototype.trim=function(e,t){return e.slice(0,t)},e}();t.CommonBufferWriter=l;var u=new Float32Array(6),c=new Uint32Array(u.buffer),d=new Uint32Array(1),p=new(function(){function e(e){void 0===e&&(e=1),this.seed=e}return e.prototype.randomFloat=function(){return this.step()/e.LARGE_PRIME},e.prototype.randomRangeInt=function(e,t){var r=t-e;return Math.round(e+this.randomFloat()*r)},e.prototype.reseed=function(e){this.seed=e},e.prototype.step=function(){return this.seed=this.seed*e.SMALL_PRIME%e.LARGE_PRIME},e.LARGE_PRIME=2147483647,e.SMALL_PRIME=16807,e}()),f=function(){function e(){this.commonWriter=new l}return e.prototype.updateSettings=function(e){this.commonWriter.updateSettings(e)},e.prototype.allocate=function(e){return a.RegularEdgeInstancesLayout.createBuffer(e)},e.prototype.write=function(e,t,r){this.commonWriter.write(e,t,r);var n=i.vec3d.normalize(i.vec3d.add(r.faceNormal0,r.faceNormal1,m));e.normal.setVec(t,n)},e.prototype.trim=function(e,t){return this.commonWriter.trim(e,t)},e.Layout=a.RegularEdgeInstancesLayout,e.glLayout=o.glLayout(a.RegularEdgeInstancesLayout,{prefixA:!0,divisor:1}),e}();t.RegularEdgeBufferWriter=f;var h=function(){function e(){this.commonWriter=new l}return e.prototype.updateSettings=function(e){this.commonWriter.updateSettings(e)},e.prototype.allocate=function(e){return a.SilhouetteEdgeInstancesLayout.createBuffer(e)},e.prototype.write=function(e,t,r){this.commonWriter.write(e,t,r),e.normalA.setVec(t,r.faceNormal0),e.normalB.setVec(t,r.faceNormal1)},e.prototype.trim=function(e,t){return this.commonWriter.trim(e,t)},e.Layout=a.SilhouetteEdgeInstancesLayout,e.glLayout=o.glLayout(a.SilhouetteEdgeInstancesLayout,{prefixA:!0,divisor:1}),e}();t.SilhouetteEdgeBufferWriter=h;var m=i.vec3d.create()}.apply(null,n))||(e.exports=i)},1009:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(785),r(364)],void 0===(i=function(e,t,r,n){function i(e){return Math.abs(e*e*e)}function o(e,t,r,n){void 0===n&&(n=d);var o=r.parameters,a=r.paddingPixelsOverride;return n.scale=Math.min(o.divisor/(t-o.offset),1),n.factor=i(e),n.minPixelSize=o.minPixelSize,n.paddingPixels=a,n}function a(e,t){return 0===e?t.minPixelSize:t.minPixelSize*(1+2*t.paddingPixels/e)}function s(e,t){return Math.max(n.lerp(e*t.scale,e,t.factor),a(e,t))}function l(e,t,r){var n=o(e,t,r);return n.minPixelSize=0,n.paddingPixels=0,s(1,n)}Object.defineProperty(t,"__esModule",{value:!0}),t.getSettings=function(e){return new u(e,t.defaultDescription)},t.getLabelSettings=function(e){var r=t.defaultDescription.curvatureDependent,n=t.defaultDescription.scaleStart,i=t.defaultDescription.scaleFallOffRange;return new u(e,{curvatureDependent:{min:{curvature:r.min.curvature,tiltAngle:r.min.tiltAngle,scaleFallOffFactor:c.curvatureDependent.min.scaleFallOffFactor},max:{curvature:r.max.curvature,tiltAngle:r.max.tiltAngle,scaleFallOffFactor:c.curvatureDependent.max.scaleFallOffFactor}},scaleStart:n,scaleFallOffRange:i,minPixelSize:c.minPixelSize})},t.perspectiveFactor=i,t.scaleFactor=o,t.applyScaleFactor=s,t.applyScaleFactorVec2=function(e,t,r){void 0===r&&(r=[0,0]);var i=Math.min(Math.max(t.scale,a(e[1],t)/e[1]),1);return r[0]=n.lerp(e[0]*i,e[0],t.factor),r[1]=n.lerp(e[1]*i,e[1],t.factor),r},t.precomputeScale=l,t.precomputeScaleFactor=function(e,t,r,n){return n.scale=l(e,t,r),n.factor=0,n.minPixelSize=r.parameters.minPixelSize,n.paddingPixels=r.paddingPixelsOverride,n},t.applyPrecomputedScaleFactorVec2=function(e,t,r){void 0===r&&(r=[0,0]);var n=Math.min(Math.max(t.scale,a(e[1],t)/e[1]),1);return r[0]=e[0]*n,r[1]=e[1]*n,r},t.scale=function(e,t,r,n){return s(e,o(t,r,n))};var u=function(){function e(e,t,r,n){void 0===r&&(r={camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0}),this.viewingMode=e,this.description=t,this.parameters=r,this._paddingPixelsOverride=n,"local"===this.viewingMode?(this.coverageCompensation=this.surfaceCoverageCompensationLocal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersLocal):(this.coverageCompensation=this.surfaceCoverageCompensationGlobal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersGlobal)}return Object.defineProperty(e.prototype,"paddingPixelsOverride",{get:function(){return this._paddingPixelsOverride||this.parameters.paddingPixels},enumerable:!0,configurable:!0}),e.prototype.update=function(e){return!(this.parameters&&this.parameters.camera.fovY===e.fovY&&this.parameters.camera.distance===e.distance||(this.calculateParameters(e,this.parameters),0))},e.prototype.overridePadding=function(t){return t!==this.paddingPixelsOverride?new e(this.viewingMode,this.description,this.parameters,t):this},e.prototype.calculateParameters=function(e,t){var r=this.description,n=r.scaleStart,i=r.scaleFallOffRange,o=r.minPixelSize,a=e.fovY,s=e.distance,l=this.calculateCurvatureDependentParameters(e),u=this.coverageCompensation(e,l),c=l.tiltAngle,d=l.scaleFallOffFactor,p=Math.sin(c)*s,f=.5*Math.PI-c-a*(.5-n*u),h=p/Math.cos(f),m=f+a*i*u,v=(h-d*(p/Math.cos(m)))/(1-d);return t.camera.fovY=e.fovY,t.camera.distance=e.distance,t.offset=v,t.divisor=h-v,t.minPixelSize=o,t},e.prototype.calculateCurvatureDependentParametersLocal=function(e,t){return void 0===t&&(t=p),t.tiltAngle=this.description.curvatureDependent.min.tiltAngle,t.scaleFallOffFactor=this.description.curvatureDependent.min.scaleFallOffFactor,t},e.prototype.calculateCurvatureDependentParametersGlobal=function(e,t){void 0===t&&(t=p);var i=this.description.curvatureDependent,o=1+e.distance/r.earthRadius,a=Math.sqrt(o*o-1),s=[i.min.curvature,i.max.curvature],l=s[0],u=s[1],c=n.clamp((a-l)/(u-l),0,1),d=[i.min,i.max],f=d[0],h=d[1];return t.tiltAngle=n.lerp(f.tiltAngle,h.tiltAngle,c),t.scaleFallOffFactor=n.lerp(f.scaleFallOffFactor,h.scaleFallOffFactor,c),t},e.prototype.surfaceCoverageCompensationLocal=function(e,t){return(e.fovY-t.tiltAngle)/e.fovY},e.prototype.surfaceCoverageCompensationGlobal=function(e,t){var n=r.earthRadius*r.earthRadius,i=t.tiltAngle+.5*Math.PI,o=e.fovY,a=e.distance,s=a*a+n-2*Math.cos(i)*a*r.earthRadius,l=Math.sqrt(s),u=Math.sqrt(s-n);return(Math.acos(u/l)-Math.asin(r.earthRadius/(l/Math.sin(i)))+.5*o)/o},e}();t.defaultDescription={curvatureDependent:{min:{curvature:n.deg2rad(10),tiltAngle:n.deg2rad(12),scaleFallOffFactor:.5},max:{curvature:n.deg2rad(70),tiltAngle:n.deg2rad(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0};var c={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};t.copyParameters=function(e,t){return t.camera.distance=e.camera.distance,t.camera.fovY=e.camera.fovY,t.divisor=e.divisor,t.offset=e.offset,t.minPixelSize=e.minPixelSize,t};var d={scale:0,factor:0,minPixelSize:0,paddingPixels:0},p={tiltAngle:0,scaleFallOffFactor:0}}.apply(null,n))||(e.exports=i)},1010:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(354),r(1510),r(1511),r(778),r(1512)],void 0===(i=function(e,t,r,n,i,o,a){function s(e,t){switch(e){case 0:return 2*t;case 4:return t/3;case 5:case 6:return t-2}return 0}return function(){function e(e,t){this.gl=null,this._blendEnabled=!1,this._blendColorState={r:0,g:0,b:0,a:0},this._blendFunctionState={srcRGB:1,dstRGB:0,srcAlpha:1,dstAlpha:0},this._blendEquationState={mode:32774,modeAlpha:32774},this._colorMaskState={r:!0,g:!0,b:!0,a:!0},this._polygonCullingEnabled=!1,this._cullFace=1029,this._frontFace=2305,this._scissorTestEnabled=!1,this._scissorRect={x:0,y:0,width:0,height:0},this._depthTestEnabled=!1,this._depthFunction=513,this._clearDepth=1,this._depthWriteEnabled=!0,this._depthRange={zNear:0,zFar:1},this._viewport=null,this._stencilTestEnabled=!1,this._polygonOffsetFillEnabled=!1,this._polygonOffset=[0,0],this._stencilFunction={face:1032,func:519,ref:0,mask:1},this._clearStencil=0,this._stencilWriteMask=1,this._stencilOperation={face:1032,fail:7680,zFail:7680,zPass:7680},this._lineWidth=1,this._clearColor={r:0,g:0,b:0,a:0},this._activeShaderProgram=null,this._activeVertexBuffer=null,this._activeIndexBuffer=null,this._activeFramebuffer=null,this._activeRenderbuffer=null,this._activeTextureUnit=0,this._textureUnitMap={},this._numOfDrawCalls=0,this._numOfTriangles=0,this.contextVersion=o.default(e)?"webgl2":"webgl",this.gl=e,e instanceof WebGLRenderingContext&&this.gl.getExtension("OES_element_index_uint"),this._capabilities=a.loadCapabilities(e,t);var n=this.gl.getParameter(this.gl.VIEWPORT);this._viewport={x:n[0],y:n[1],width:n[2],height:n[3]};var s=this.capabilities.textureFilterAnisotropic;this._parameters={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:s?this.gl.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY):void 0,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS)},r("esri-webgl-debug")&&(this.instanceCounter=new i),this.enforceState()}return Object.defineProperty(e.prototype,"contextAttributes",{get:function(){return this.gl.getContextAttributes()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parameters",{get:function(){return this._parameters},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this.bindVAO(null),this.unbindBuffer(34962),this.unbindBuffer(34963),this._textureUnitMap={},r("esri-webgl-debug")&&this.instanceCounter.printResourceCount(),this.gl=null},e.prototype.setBlendingEnabled=function(e){this._blendEnabled!==e&&(!0===e?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._blendEnabled=e)},e.prototype.setBlendColor=function(e,t,r,n){e===this._blendColorState.r&&t===this._blendColorState.g&&r===this._blendColorState.b&&n===this._blendColorState.a||(this.gl.blendColor(e,t,r,n),this._blendColorState.r=e,this._blendColorState.g=t,this._blendColorState.b=r,this._blendColorState.a=n)},e.prototype.setBlendFunction=function(e,t){e===this._blendFunctionState.srcRGB&&t===this._blendFunctionState.dstRGB||(this.gl.blendFunc(e,t),this._blendFunctionState.srcRGB=e,this._blendFunctionState.srcAlpha=e,this._blendFunctionState.dstRGB=t,this._blendFunctionState.dstAlpha=t)},e.prototype.setBlendFunctionSeparate=function(e,t,r,n){this._blendFunctionState.srcRGB===e&&this._blendFunctionState.srcAlpha===r&&this._blendFunctionState.dstRGB===t&&this._blendFunctionState.dstAlpha===n||(this.gl.blendFuncSeparate(e,t,r,n),this._blendFunctionState.srcRGB=e,this._blendFunctionState.srcAlpha=r,this._blendFunctionState.dstRGB=t,this._blendFunctionState.dstAlpha=n)},e.prototype.setBlendEquation=function(e){this._blendEquationState.mode!==e&&(this.gl.blendEquation(e),this._blendEquationState.mode=e,this._blendEquationState.modeAlpha=e)},e.prototype.setBlendEquationSeparate=function(e,t){this._blendEquationState.mode===e&&this._blendEquationState.modeAlpha===t||(this.gl.blendEquationSeparate(e,t),this._blendEquationState.mode=e,this._blendEquationState.modeAlpha=t)},e.prototype.setColorMask=function(e,t,r,n){this._colorMaskState.r===e&&this._colorMaskState.g===t&&this._colorMaskState.b===r&&this._colorMaskState.a===n||(this.gl.colorMask(e,t,r,n),this._colorMaskState.r=e,this._colorMaskState.g=t,this._colorMaskState.b=r,this._colorMaskState.a=n)},e.prototype.setClearColor=function(e,t,r,n){this._clearColor.r===e&&this._clearColor.g===t&&this._clearColor.b===r&&this._clearColor.a===n||(this.gl.clearColor(e,t,r,n),this._clearColor.r=e,this._clearColor.g=t,this._clearColor.b=r,this._clearColor.a=n)},e.prototype.setFaceCullingEnabled=function(e){this._polygonCullingEnabled!==e&&(!0===e?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._polygonCullingEnabled=e)},e.prototype.setPolygonOffsetFillEnabled=function(e){this._polygonOffsetFillEnabled!==e&&(!0===e?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._polygonOffsetFillEnabled=e)},e.prototype.setPolygonOffset=function(e,t){this._polygonOffset[0]===e&&this._polygonOffset[1]===t||(this._polygonOffset[0]=e,this._polygonOffset[1]=t,this.gl.polygonOffset(e,t))},e.prototype.setCullFace=function(e){this._cullFace!==e&&(this.gl.cullFace(e),this._cullFace=e)},e.prototype.setFrontFace=function(e){this._frontFace!==e&&(this.gl.frontFace(e),this._frontFace=e)},e.prototype.setScissorTestEnabled=function(e){this._scissorTestEnabled!==e&&(!0===e?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._scissorTestEnabled=e)},e.prototype.setScissorRect=function(e,t,r,n){this._scissorRect.x===e&&this._scissorRect.y===t&&this._scissorRect.width===r&&this._scissorRect.height===n||(this.gl.scissor(e,t,r,n),this._scissorRect.x=e,this._scissorRect.y=t,this._scissorRect.width=r,this._scissorRect.height=n)},e.prototype.setDepthTestEnabled=function(e){this._depthTestEnabled!==e&&(!0===e?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._depthTestEnabled=e)},e.prototype.setClearDepth=function(e){this._clearDepth!==e&&(this.gl.clearDepth(e),this._clearDepth=e)},e.prototype.setDepthFunction=function(e){this._depthFunction!==e&&(this.gl.depthFunc(e),this._depthFunction=e)},e.prototype.setDepthWriteEnabled=function(e){this._depthWriteEnabled!==e&&(this.gl.depthMask(e),this._depthWriteEnabled=e)},e.prototype.setDepthRange=function(e,t){this._depthRange.zNear===e&&this._depthRange.zFar===t||(this.gl.depthRange(e,t),this._depthRange.zNear=e,this._depthRange.zFar=t)},e.prototype.setStencilTestEnabled=function(e){this._stencilTestEnabled!==e&&(!0===e?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._stencilTestEnabled=e)},e.prototype.setClearStencil=function(e){e!==this._clearStencil&&(this.gl.clearStencil(e),this._clearStencil=e)},e.prototype.setStencilFunction=function(e,t,r){this._stencilFunction.func===e&&this._stencilFunction.ref===t&&this._stencilFunction.mask===r||(this.gl.stencilFunc(e,t,r),this._stencilFunction.face=1032,this._stencilFunction.func=e,this._stencilFunction.ref=t,this._stencilFunction.mask=r)},e.prototype.setStencilFunctionSeparate=function(e,t,r,n){this._stencilFunction.face===e&&this._stencilFunction.func===t&&this._stencilFunction.ref===r&&this._stencilFunction.mask===n||(this.gl.stencilFuncSeparate(e,t,r,n),this._stencilFunction.face=e,this._stencilFunction.func=t,this._stencilFunction.ref=r,this._stencilFunction.mask=n)},e.prototype.setStencilWriteMask=function(e){this._stencilWriteMask!==e&&(this.gl.stencilMask(e),this._stencilWriteMask=e)},e.prototype.setStencilOp=function(e,t,r){this._stencilOperation.fail===e&&this._stencilOperation.zFail===t&&this._stencilOperation.zPass===r||(this.gl.stencilOp(e,t,r),this._stencilOperation.face=1032,this._stencilOperation.fail=e,this._stencilOperation.zFail=t,this._stencilOperation.zPass=r)},e.prototype.setStencilOpSeparate=function(e,t,r,n){this._stencilOperation.face===e&&this._stencilOperation.fail===t&&this._stencilOperation.zFail===r&&this._stencilOperation.zPass===n||(this.gl.stencilOpSeparate(e,t,r,n),this._stencilOperation.face=e,this._stencilOperation.face=e,this._stencilOperation.fail=t,this._stencilOperation.zFail=r,this._stencilOperation.zPass=n)},e.prototype.setLineWidth=function(e){var t=this._lineWidth;return this._lineWidth!==e&&(this.gl.lineWidth(e),this._lineWidth=e),t},e.prototype.setActiveTexture=function(e){var t=this._activeTextureUnit;return e>=0&&e!==this._activeTextureUnit&&(this.gl.activeTexture(n.BASE_TEXTURE_UNIT+e),this._activeTextureUnit=e),t},e.prototype.clear=function(e){e&&this.gl.clear(e)},e.prototype.drawArrays=function(e,t,n){r("esri-webgl-debug")&&(this._numOfDrawCalls++,this._numOfTriangles+=s(e,n)),this.gl.drawArrays(e,t,n)},e.prototype.drawElements=function(e,t,n,i){r("esri-webgl-debug")&&(this._numOfDrawCalls++,this._numOfTriangles+=s(e,t)),5123!==n?5125===n&&this.gl.drawElements(e,t,n,i):this.gl.drawElements(e,t,n,i)},e.prototype.logIno=function(){r("esri-webgl-debug")&&console.log("DrawCalls: "+this._numOfDrawCalls+", Triangles: "+this._numOfTriangles)},Object.defineProperty(e.prototype,"capabilities",{get:function(){return this._capabilities},enumerable:!0,configurable:!0}),e.prototype.setViewport=function(e,t,r,n){var i=this._viewport;i.x===e&&i.y===t&&i.width===r&&i.height===n||(i.x=e,i.y=t,i.width=r,i.height=n,this.gl.viewport(e,t,r,n))},e.prototype.getViewport=function(){return{x:this._viewport.x,y:this._viewport.y,width:this._viewport.width,height:this._viewport.height}},e.prototype.bindProgram=function(e){if(!e)return this.gl.useProgram(null),void(this._activeShaderProgram=null);this._activeShaderProgram!==e&&(e.initialize(),this.gl.useProgram(e.glName),this._activeShaderProgram=e)},e.prototype.bindTexture=function(t,r){void 0===r&&(r=0),-1===e._MAX_TEXTURE_IMAGE_UNITS&&(e._MAX_TEXTURE_IMAGE_UNITS=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS)),(r>=e._MAX_TEXTURE_IMAGE_UNITS||r<0)&&console.error("Input texture unit is out of range of available units!");var n=this._textureUnitMap[r];return this.setActiveTexture(r),null==t||null==t.glName?(null!=n&&(this.gl.bindTexture(n.descriptor.target,null),n.setBoundToUnit(r,!1)),void(this._textureUnitMap[r]=null)):n&&n.id===t.id?void t.applyChanges():(this.gl.bindTexture(t.descriptor.target,t.glName),t.setBoundToUnit(r,!0),t.applyChanges(),void(this._textureUnitMap[r]=t))},e.prototype.bindFramebuffer=function(e){if(!e)return this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),void(this._activeFramebuffer=null);this._activeFramebuffer!==e&&(e.initialize()||this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,e.glName),this._activeFramebuffer=e)},e.prototype.bindBuffer=function(t){t&&(34962===t.bufferType?this._activeVertexBuffer=e._bindBuffer(this.gl,t,t.bufferType,this._activeVertexBuffer):this._activeIndexBuffer=e._bindBuffer(this.gl,t,t.bufferType,this._activeIndexBuffer))},e.prototype.bindRenderbuffer=function(e){var t=this.gl;e||(t.bindRenderbuffer(t.RENDERBUFFER,null),this._activeRenderbuffer=null),this._activeRenderbuffer!==e&&(t.bindRenderbuffer(t.RENDERBUFFER,e.glName),this._activeRenderbuffer=e)},e.prototype.unbindBuffer=function(t){34962===t?this._activeVertexBuffer=e._bindBuffer(this.gl,null,t,this._activeVertexBuffer):this._activeIndexBuffer=e._bindBuffer(this.gl,null,t,this._activeIndexBuffer)},e.prototype.bindVAO=function(e){e?this._activeVertexArrayObject&&this._activeVertexArrayObject.id===e.id||(e.bind(),this._activeVertexArrayObject=e):this._activeVertexArrayObject&&(this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null)},e.prototype.getBoundTexture=function(e){return this._textureUnitMap[e]},e.prototype.getBoundFramebufferObject=function(){return this._activeFramebuffer},e.prototype.getBoundVAO=function(){return this._activeVertexArrayObject},e.prototype.resetState=function(){this.bindProgram(null),this.bindVAO(null),this.bindFramebuffer(null),this.unbindBuffer(34962),this.unbindBuffer(34963);for(var e=0;e<this.parameters.maxTextureImageUnits;e++)this.bindTexture(null,e);this.setBlendingEnabled(!1),this.setBlendFunction(1,0),this.setBlendEquation(32774),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(1029),this.setFrontFace(2305),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(513),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(519,0,0),this.setStencilOp(7680,7680,7680),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)},e.prototype.enforceState=function(){var e=this.gl,t=this._capabilities.vao;t&&t.bindVertexArray(null);for(var i=0;i<this.parameters.maxVertexAttributes;i++)e.disableVertexAttribArray(i);if(this._activeVertexBuffer?e.bindBuffer(this._activeVertexBuffer.bufferType,this._activeVertexBuffer.glName):e.bindBuffer(34962,null),this._activeIndexBuffer?e.bindBuffer(this._activeIndexBuffer.bufferType,this._activeIndexBuffer.glName):e.bindBuffer(34963,null),t&&this._activeVertexArrayObject){var o=this._activeVertexArrayObject;this._activeVertexArrayObject&&(this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null),this.bindVAO(o)}e.bindFramebuffer(e.FRAMEBUFFER,this._activeFramebuffer?this._activeFramebuffer.glName:null),e.useProgram(this._activeShaderProgram?this._activeShaderProgram.glName:null),e.blendColor(this._blendColorState.r,this._blendColorState.g,this._blendColorState.b,this._blendColorState.a),e.bindRenderbuffer(e.RENDERBUFFER,this._activeRenderbuffer?this._activeRenderbuffer.glName:null),!0===this._blendEnabled?e.enable(this.gl.BLEND):e.disable(this.gl.BLEND),e.blendEquationSeparate(this._blendEquationState.mode,this._blendEquationState.modeAlpha),e.blendFuncSeparate(this._blendFunctionState.srcRGB,this._blendFunctionState.dstRGB,this._blendFunctionState.srcAlpha,this._blendFunctionState.dstAlpha),e.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a),e.clearDepth(this._clearDepth),e.clearStencil(this._clearStencil),e.colorMask(this._colorMaskState.r,this._colorMaskState.g,this._colorMaskState.b,this._colorMaskState.a),e.cullFace(this._cullFace),e.depthFunc(this._depthFunction),e.depthRange(this._depthRange.zNear,this._depthRange.zFar),!0===this._depthTestEnabled?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),e.depthMask(this._depthWriteEnabled),e.frontFace(this._frontFace),e.lineWidth(this._lineWidth),!0===this._polygonCullingEnabled?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),e.polygonOffset(this._polygonOffset[0],this._polygonOffset[1]),!0===this._polygonOffsetFillEnabled?e.enable(e.POLYGON_OFFSET_FILL):e.disable(e.POLYGON_OFFSET_FILL),e.scissor(this._scissorRect.x,this._scissorRect.y,this._scissorRect.width,this._scissorRect.height),!0===this._scissorTestEnabled?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST),e.stencilFunc(this._stencilFunction.func,this._stencilFunction.ref,this._stencilFunction.mask),e.stencilOpSeparate(this._stencilOperation.face,this._stencilOperation.fail,this._stencilOperation.zFail,this._stencilOperation.zPass),!0===this._stencilTestEnabled?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),e.stencilMask(this._stencilWriteMask);for(var a=0;a<this.parameters.maxTextureImageUnits;a++){e.activeTexture(n.BASE_TEXTURE_UNIT+a),e.bindTexture(3553,null);var s=this._textureUnitMap[a];s&&e.bindTexture(s.descriptor.target,s.glName)}e.activeTexture(n.BASE_TEXTURE_UNIT+this._activeTextureUnit),e.viewport(this._viewport.x,this._viewport.y,this._viewport.width,this._viewport.height),r("esri-webgl-debug")&&(this._numOfDrawCalls=0,this._numOfTriangles=0)},e._bindBuffer=function(e,t,r,n){return t?n===t?n:(e.bindBuffer(r,t.glName),t):(e.bindBuffer(r,null),null)},e._MAX_TEXTURE_IMAGE_UNITS=-1,e}()}.apply(null,n))||(e.exports=i)},1012:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(342)],void 0===(i=function(e,t,r){function n(e,t,r){return{identifier:String.fromCharCode.apply(null,new Uint8Array(e,r+c.identifierOffset,c.identifierLength)),version:t.getUint16(r+c.versionOffset,u),checksum:t.getUint32(r+c.checksumOffset,u)}}function i(e,t){return{sizeLo:e.getUint32(t+d.sizeLo,u),sizeHi:e.getUint32(t+d.sizeHi,u),minX:e.getFloat64(t+d.minX,u),minY:e.getFloat64(t+d.minY,u),minZ:e.getFloat64(t+d.minZ,u),maxX:e.getFloat64(t+d.maxX,u),maxY:e.getFloat64(t+d.maxY,u),maxZ:e.getFloat64(t+d.maxZ,u),errorX:e.getFloat64(t+d.errorX,u),errorY:e.getFloat64(t+d.errorY,u),errorZ:e.getFloat64(t+d.errorZ,u),count:e.getUint32(t+d.count,u),reserved:e.getUint32(t+d.reserved,u)}}function o(e,t,r){var n=[];t=a(e,t,n);for(var i=[],o=0;o<n.length;o++){i.length=0,t=a(e,t,i);for(var s=0;s<i.length;s++)r.push(i[s]+n[o])}return t}function a(e,t,n){var i=new DataView(e,t),o=i.getUint8(0),a=31&o,s=!!(32&o),l=(192&o)>>6,c=0;if(0===l)c=i.getUint32(1,u),t+=5;else if(1===l)c=i.getUint16(1,u),t+=3;else{if(2!==l)throw new r("lepcc-decode-error","Bad count type");c=i.getUint8(1),t+=2}if(s)throw new r("lepcc-decode-error","LUT not implemented");for(var d=Math.ceil(c*a/8),p=new Uint8Array(e,t,d),f=0,h=0,m=0,v=-1>>>32-a,g=0;g<c;g++){for(;h<a;)f|=p[m]<<h,h+=8,m+=1;n[g]=f&v,f>>>=a,(h-=a)+a>32&&(f|=p[m-1]>>8-h)}return t+m}function s(e,t){return{sizeLo:e.getUint32(t+p.sizeLo,u),sizeHi:e.getUint32(t+p.sizeHi,u),count:e.getUint32(t+p.count,u),colorMapCount:e.getUint16(t+p.colorMapCount,u),lookupMethod:e.getUint8(t+p.lookupMethod),compressionMethod:e.getUint8(t+p.compressionMethod)}}function l(e,t){return{sizeLo:e.getUint32(t+f.sizeLo,u),sizeHi:e.getUint32(t+f.sizeHi,u),count:e.getUint32(t+f.count,u),scaleFactor:e.getUint16(t+f.scaleFactor,u),bitsPerPoint:e.getUint8(t+f.bitsPerPoint),reserved:e.getUint8(t+f.reserved)}}Object.defineProperty(t,"__esModule",{value:!0});var u=!0,c={identifierOffset:0,identifierLength:10,versionOffset:10,checksumOffset:12,byteCount:16},d={sizeLo:0,sizeHi:4,minX:8,minY:16,minZ:24,maxX:32,maxY:40,maxZ:48,errorX:56,errorY:64,errorZ:72,count:80,reserved:84,byteCount:88};t.decodeXYZ=function(e){var t=new DataView(e,0),a=0,s=n(e,t,a),l=s.identifier,u=s.version;if(a+=c.byteCount,"LEPCC     "!==l)throw new r("lepcc-decode-error","Bad identifier");if(u>1)throw new r("lepcc-decode-error","Unknown version");var p=i(t,a);if(a+=d.byteCount,p.sizeHi*Math.pow(2,32)+p.sizeLo!==e.byteLength)throw new r("lepcc-decode-error","Bad size");var f=new Float64Array(3*p.count),h=[],m=[],v=[],g=[];if(a=o(e,a,h),a=o(e,a,m),a=o(e,a,v),(a=o(e,a,g))!==e.byteLength)throw new r("lepcc-decode-error","Bad length");for(var y=0,b=0,_=0;_<h.length;_++){b+=h[_];for(var x=0,w=0;w<m[_];w++){x+=v[y];var S=g[y];f[3*y]=Math.min(p.maxX,p.minX+2*p.errorX*x),f[3*y+1]=Math.min(p.maxY,p.minY+2*p.errorY*b),f[3*y+2]=Math.min(p.maxZ,p.minZ+2*p.errorZ*S),y++}}return{errorX:p.errorX,errorY:p.errorY,errorZ:p.errorZ,result:f}};var p={sizeLo:0,sizeHi:4,count:8,colorMapCount:12,lookupMethod:14,compressionMethod:15,byteCount:16};t.decodeRGB=function(e){var t=new DataView(e,0),i=0,o=n(e,t,i),a=o.identifier,l=o.version;if(i+=c.byteCount,"ClusterRGB"!==a)throw new r("lepcc-decode-error","Bad identifier");if(l>1)throw new r("lepcc-decode-error","Unknown version");var u=s(t,i);if(i+=p.byteCount,u.sizeHi*Math.pow(2,32)+u.sizeLo!==e.byteLength)throw new r("lepcc-decode-error","Bad size");if(2!==u.lookupMethod&&1!==u.lookupMethod||0!==u.compressionMethod){if(0===u.lookupMethod&&0===u.compressionMethod){if(3*u.count+i!==e.byteLength||0!==u.colorMapCount)throw new r("lepcc-decode-error","Bad count");return new Uint8Array(e,i).slice()}if(u.lookupMethod<=2&&1===u.compressionMethod){if(i+3!==e.byteLength||1!==u.colorMapCount)throw new r("lepcc-decode-error","Bad count");for(var d=t.getUint8(i),f=t.getUint8(i+1),h=t.getUint8(i+2),m=new Uint8Array(3*u.count),v=0;v<u.count;v++)m[3*v]=d,m[3*v+1]=f,m[3*v+2]=h;return m}throw new r("lepcc-decode-error","Bad method "+u.lookupMethod+","+u.compressionMethod)}if(3*u.colorMapCount+u.count+i!==e.byteLength||u.colorMapCount>256)throw new r("lepcc-decode-error","Bad count");var g=new Uint8Array(e,i,3*u.colorMapCount),y=new Uint8Array(e,i+3*u.colorMapCount,u.count);for(m=new Uint8Array(3*u.count),v=0;v<u.count;v++){var b=y[v];m[3*v]=g[3*b],m[3*v+1]=g[3*b+1],m[3*v+2]=g[3*b+2]}return m};var f={sizeLo:0,sizeHi:4,count:8,scaleFactor:12,bitsPerPoint:14,reserved:15,byteCount:16};t.decodeIntensity=function(e){var t=new DataView(e,0),i=0,o=n(e,t,i),s=o.identifier,u=o.version;if(i+=c.byteCount,"Intensity "!==s)throw new r("lepcc-decode-error","Bad identifier");if(u>1)throw new r("lepcc-decode-error","Unknown version");var d=l(t,i);if(i+=f.byteCount,d.sizeHi*Math.pow(2,32)+d.sizeLo!==e.byteLength)throw new r("lepcc-decode-error","Bad size");var p=new Uint16Array(d.count);if(8===d.bitsPerPoint){if(d.count+i!==e.byteLength)throw new r("lepcc-decode-error","Bad size");for(var h=new Uint8Array(e,i,d.count),m=0;m<d.count;m++)p[m]=h[m]*d.scaleFactor}else if(16===d.bitsPerPoint){if(2*d.count+i!==e.byteLength)throw new r("lepcc-decode-error","Bad size");for(h=new Uint16Array(e,i,d.count),m=0;m<d.count;m++)p[m]=h[m]*d.scaleFactor}else{if(a(e,i,h=[])!==e.byteLength)throw new r("lepcc-decode-error","Bad size");for(m=0;m<d.count;m++)p[m]=h[m]*d.scaleFactor}return p}}.apply(null,n))||(e.exports=i)},1021:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(349),r(417)],void 0===(i=function(e,t,r,n){return function(){function e(e){this._programCacheByTemplate=new Map,this._globalOptions={viewingMode:"global"},this._rctx=e,this._programRefCount=[],this._commonUniforms={model:[],modelNormal:[],lightDirection:[],proj:[],shadowMapDistance:[],viewportPixelSz:[],lightingMainDirection:[]}}return Object.defineProperty(e.prototype,"globalOptions",{get:function(){return this._globalOptions},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this._programCacheByTemplate.forEach(function(e){e.programs.forEach(function(e){e.dispose()})}),this._programCacheByTemplate=null,this._programRefCount=null},e.prototype.getProgram=function(e,t){var r=this;return this._programCacheByTemplate.has(e)||this.addProgramTemplate(e,function(t){return n.createProgram(r._rctx,e,t)}),this.getProgramTemplateInstance(e,t)},e.prototype.addProgramTemplate=function(e,t){this._programCacheByTemplate.set(e,{constructor:t,programs:new Map})},e.prototype.getProgramTemplateInstance=function(e,t){var r=this._programCacheByTemplate.get(e);if(r){var n=t?JSON.stringify(t):"default";if(!r.programs.has(n)){var i=r.constructor(t);r.programs.set(n,i)}return r.programs.get(n)}return null},e.prototype.getProgramsUsingUniform=function(e){return this._commonUniforms[e]||[]},e.prototype.increaseRefCount=function(e){var t=e.id;this._programRefCount[t]?this._programRefCount[t]++:(this._programRefCount[t]=1,this._findCommonUniforms(e))},e.prototype.decreaseRefCount=function(e){var t=e.id;this._programRefCount[t]>1?this._programRefCount[t]--:(this._forgetCommonUniforms(e),this._programRefCount[t]=0)},e.prototype._findCommonUniforms=function(e){for(var t in this._commonUniforms)e.hasUniform(t)&&(r.assert(-1===this._commonUniforms[t].indexOf(e),"common uniforms of program have already been determined"),this._commonUniforms[t].push(e))},e.prototype._forgetCommonUniforms=function(e){for(var t in this._commonUniforms){var r=this._commonUniforms[t],n=r.indexOf(e);n>-1&&(r[n]=r[r.length-1],r.pop())}},e}()}.apply(null,n))||(e.exports=i)},1043:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(452)],void 0===(i=function(e,t,r){return function(){function e(t,r,n,i,o,a){this.id=e._idGen.gen(t.id),this.geometry=t,this.materials=r,this.transformation=n,this.instanceParameters=i,this.origin=o,this.customTransformation=a}return e.prototype.getStaticTransformation=function(){return this.transformation},e.prototype.getShaderTransformation=function(){return this.customTransformation?this.customTransformation(this.transformation):this.transformation},e._idGen=new r,e}()}.apply(null,n))||(e.exports=i)},1044:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(364)],void 0===(i=function(e,t,r){function n(e,t,r,n){for(var i=0;i<n;i++)if(e[t+i]!==e[r+i])return!1;return!0}function i(e,t,r,n,i){for(var o=0;o<i;o++)r[n+o]=e[t+o]}function o(e,t,r){for(var n=0,i=0;i<r;i++)n=(n=e[t+i]+n|0)+(n<<11)+(n>>>2)|0;return n>>>0}Object.defineProperty(t,"__esModule",{value:!0}),t.computeNeighbors=function(e,t){for(var r=e.length/3,n=new Uint32Array(t+1),i=new Uint32Array(t+1),o=function(e,t){e<t?n[e+1]++:i[t+1]++},a=0;a<r;a++){var s=e[3*a],l=e[3*a+1],u=e[3*a+2];o(s,l),o(l,u),o(u,s)}var c=0,d=0;for(a=0;a<t;a++){var p=n[a+1],f=i[a+1];n[a+1]=c,i[a+1]=d,c+=p,d+=f}var h=new Uint32Array(6*r),m=n[t],v=function(e,t,r){if(e<t){var o=n[e+1]++;h[2*o]=t,h[2*o+1]=r}else o=i[t+1]++,h[2*m+2*o]=e,h[2*m+2*o+1]=r};for(a=0;a<r;a++)s=e[3*a],l=e[3*a+1],u=e[3*a+2],v(s,l,a),v(l,u,a),v(u,s,a);var g=function(e,t){for(var r=2*e,n=t-e,i=1;i<n;i++){for(var o=h[r+2*i],a=h[r+2*i+1],s=i-1;s>=0&&h[r+2*s]>o;s--)h[r+2*s+2]=h[r+2*s],h[r+2*s+3]=h[r+2*s+1];h[r+2*s+2]=o,h[r+2*s+3]=a}};for(a=0;a<t;a++)g(n[a],n[a+1]),g(m+i[a],m+i[a+1]);var y=new Int32Array(3*r),b=function(t,r){return t===e[3*r]?0:t===e[3*r+1]?1:t===e[3*r+2]?2:-1},_=function(e,t){var r=b(e,t);y[3*t+r]=-1};for(a=0;a<t;a++){for(var x=n[a],w=n[a+1],S=i[a],T=i[a+1];x<w&&S<T;){var E=h[2*x];E===(C=h[2*m+2*S])?(function(e,t,r,n){var i=b(e,t);y[3*t+i]=n;var o=b(r,n);y[3*n+o]=t}(a,h[2*x+1],C,h[2*m+2*S+1]),x++,S++):E<C?(_(a,h[2*x+1]),x++):(_(C,h[2*m+2*S+1]),S++)}for(;x<w;)_(a,h[2*x+1]),x++;for(;S<T;){var C;_(C=h[2*m+2*S],h[2*m+2*S+1]),S++}}return y};var a=null;t.deduplicate=function(e,t,s,l,u){void 0===s&&(s=0),void 0===l&&(l=0),void 0===u&&(u=e.byteLength/(4*t));var c=new Uint32Array(e,l,u*t),d=new Uint32Array(u),p=Math.floor(1.1*u)+1;(null==a||a.length<2*p)&&(a=new Uint32Array(r.nextHighestPowerOfTwo(2*p)));for(var f=0;f<2*p;f++)a[f]=0;var h=0,m=1.96,v=0!==s?Math.ceil(4*m*m/(s*s)*s*(1-s)):u;for(f=0;f<u;f++){if(f===v){var g=1-h/f;if(g+m*Math.sqrt(g*(1-g)/f)<s)return null;v*=2}for(var y=f*t,b=o(c,y,t),_=b%p,x=h;0!==a[2*_+1];){if(a[2*_]===b){var w=a[2*_+1]-1;if(n(c,y,w*t,t)){x=d[w];break}}++_>=p&&(_-=p)}x===h&&(a[2*_]=b,a[2*_+1]=f+1,h++),d[f]=x}if(0!==s&&1-h/u<s)return null;var S=new Uint32Array(t*h);for(h=0,f=0;f<u;f++)d[f]===h&&(i(c,f*t,S,h*t,t),h++);return{buffer:S.buffer,indices:d,uniqueCount:h}}}.apply(null,n))||(e.exports=i)},1045:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(411),r(344),r(349)],void 0===(i=function(e,t,r,n,i){var o=function(){function e(e,t,r,o){i.assert(e.length>=1),i.assert(r.length%t==0),i.assert(r.length>=e.length*t),i.assert(3===o.size||4===o.size),this.primitiveIndices=e,this.indices=r,this._position=o,this._numIndexPerPrimitive=t;var s=o.data,l=o.offsetIdx,u=o.strideIdx,c=0,d=e.length,p=l+u*r[t*e[c]];for(a.clear(),a.push(p),this.bbMin=n.vec3d.createFrom(s[p],s[p+1],s[p+2]),this.bbMax=n.vec3d.create(this.bbMin);c<d;++c)for(var f=t*e[c],h=0;h<t;++h){p=l+u*r[f+h],a.push(p);var m=s[p];this.bbMin[0]=Math.min(m,this.bbMin[0]),this.bbMax[0]=Math.max(m,this.bbMax[0]),m=s[p+1],this.bbMin[1]=Math.min(m,this.bbMin[1]),this.bbMax[1]=Math.max(m,this.bbMax[1]),m=s[p+2],this.bbMin[2]=Math.min(m,this.bbMin[2]),this.bbMax[2]=Math.max(m,this.bbMax[2])}this.center=n.vec3d.create(),n.vec3d.lerp(this.bbMin,this.bbMax,.5,this.center),this.bsRadius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);var v=this.bsRadius*this.bsRadius;for(c=0;c<a.length;++c){var g=s[p=a.data[c]]-this.center[0],y=s[p+1]-this.center[1],b=s[p+2]-this.center[2],_=g*g+y*y+b*b;if(!(_<=v)){var x=Math.sqrt(_),w=.5*(x-this.bsRadius);this.bsRadius=this.bsRadius+w,v=this.bsRadius*this.bsRadius;var S=w/x;this.center[0]+=g*S,this.center[1]+=y*S,this.center[2]+=b*S}}a.clear()}return e.prototype.getCenter=function(){return this.center},e.prototype.getBSRadius=function(){return this.bsRadius},e.prototype.getBBMin=function(){return this.bbMin},e.prototype.getBBMax=function(){return this.bbMax},e.prototype.getPrimitiveIndices=function(){return this.primitiveIndices},e.prototype.getIndices=function(){return this.indices},e.prototype.getPosition=function(){return this._position},e.prototype.getChildren=function(){if(this.children)return this.children;if(n.vec3d.dist2(this.bbMin,this.bbMax)>1){for(var t=n.vec3d.lerp(this.bbMin,this.bbMax,.5,n.vec3d.create()),r=this.primitiveIndices.length,i=new Uint8Array(r),o=new Array(8),a=0;a<8;++a)o[a]=0;var s=this._position,l=s.data,u=s.offsetIdx,c=s.strideIdx;for(a=0;a<r;++a){for(var d=0,p=this._numIndexPerPrimitive*this.primitiveIndices[a],f=u+c*this.indices[p],h=l[f],m=l[f+1],v=l[f+2],g=1;g<this._numIndexPerPrimitive;++g){var y=l[f=u+c*this.indices[p+g]],b=l[f+1],_=l[f+2];y<h&&(h=y),b<m&&(m=b),_<v&&(v=_)}h<t[0]&&(d|=1),m<t[1]&&(d|=2),v<t[2]&&(d|=4),i[a]=d,++o[d]}var x=0;for(a=0;a<8;++a)o[a]>0&&++x;if(x<2)return;var w=new Array(8);for(a=0;a<8;++a)w[a]=o[a]>0?new Uint32Array(o[a]):void 0;for(a=0;a<8;++a)o[a]=0;for(a=0;a<r;++a){w[d=i[a]][o[d]++]=this.primitiveIndices[a]}this.children=new Array(8);for(a=0;a<8;++a)void 0!==w[a]&&(this.children[a]=new e(w[a],this._numIndexPerPrimitive,this.indices,this._position))}return this.children},e}(),a=new r;return o}.apply(null,n))||(e.exports=i)},1046:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.encodeSymbolColor=function(e,t,o,a){if(void 0===a&&(a=0),null==e||"ignore"===t)return o[a+0]=255,o[a+1]=255,o[a+2]=255,void(o[a+3]=255);o[a+0]=Math.floor(255*e[0]),o[a+1]=Math.floor(255*e[1]),o[a+2]=Math.floor(255*e[2]);var s=Math.floor(e[3]*r);o[a+3]=0===s?0:"tint"===t?s:"replace"===t?s+n:s+i},t.isOpaqueSymbolColor=function(e,t){void 0===t&&(t=0);var r=e[t+3];return r===n||r===i||r===o};var r=85,n=r,i=2*r,o=3*r}.apply(null,n))||(e.exports=i)},1047:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(382),r(344),r(452),r(459),r(985)],void 0===(i=function(e,t,r,n,i,o,a){return function(){function e(t,r,i){this._parentStages=[],this._children=new Set,this.id=e._idGen.gen(i),this.name=t,r=r||{},this.group=r.group||"",this.isPickable=null==r.isPickable||r.isPickable,this.translation=n.vec3d.create(r.translation),this._extent=[n.vec3d.createFrom(0,0,0),n.vec3d.createFrom(1e3,1e3,1e3)],this._extentDirty=!0}return e.prototype.getParentStages=function(){return this._parentStages},e.prototype.addParentStage=function(e){-1===this._parentStages.indexOf(e)&&this._parentStages.push(e)},e.prototype.removeParentStage=function(e){var t=this._parentStages.indexOf(e);t>-1&&this._parentStages.splice(t,1)},e.prototype.getName=function(){return this.name},e.prototype.getGroup=function(){return this.group},e.prototype.getTranslation=function(){return this.translation},e.prototype.getObjectIds=function(){return r.keysOfSet(this._children,function(e){return e.id})},e.prototype.getObjects=function(){return r.keysOfSet(this._children)},e.prototype.getExtent=function(){return this._updateExtent(),this._extent},e.prototype.addObject=function(e){this._children.add(e),e.addParentLayer(this),this.notifyDirty("layObjectAdded",e),this._invalidateExtent(),this._octree&&this._octree.add(e)},e.prototype.hasObject=function(e){return this._children.has(e)},e.prototype.removeObject=function(e){return!!this._children.delete(e)&&(e.removeParentLayer(this),this.notifyDirty("layObjectRemoved",e),this._invalidateExtent(),this._octree&&this._octree.remove(e),!0)},e.prototype.notifyObjectBBChanged=function(e,t){this._octree&&this._octree.update(e,t)},e.prototype.getCenter=function(){this._updateExtent();var e=n.vec3d.create();return n.vec3d.lerp(this._extent[0],this._extent[1],.5,e)},e.prototype.getBSRadius=function(){return this._updateExtent(),.5*n.vec3d.dist(this._extent[0],this._extent[1])},e.prototype.getSpatialQueryAccelerator=function(){return!this._octree&&this._children.size>50&&this._createOctree(),this._octree},e.prototype.shaderTransformationChanged=function(){this.notifyDirty("shaderTransformationChanged",null)},e.prototype.invalidateSpatialQueryAccelerator=function(){this._octree=null},e.prototype.notifyDirty=function(e,t,r,n){r=r||o.LAYER;for(var i=n||this,a=0;a<this._parentStages.length;a++)this._parentStages[a].notifyDirty(r,i,e,t)},e.prototype._createOctree=function(){for(var e=this.getExtent(),t=0,i=0;i<3;i++)t=Math.max(t,e[1][i]-e[0][i]);var o=n.vec3d.create();n.vec3d.lerp(e[0],e[1],.5,o),this._octree=new a(o,1.2*t,{getRadius:function(e){return e.getBSRadius()},getCenter:function(e){return e.getCenter()}}),this._octree.add(r.keysOfSet(this._children))},e.prototype._invalidateExtent=function(){this._extentDirty=!0},e.prototype._updateExtent=function(){var e=this;if(this._extentDirty){if(this._extentDirty=!1,0===this._children.size)return void(this._extent=[[0,0,0],[0,0,0]]);var t=null;this._children.forEach(function(r){var i=r.getBBMin(),o=r.getBBMax();if(t)for(var a=0;a<3;++a)e._extent[0][a]=Math.min(e._extent[0][a],i[a]),e._extent[1][a]=Math.max(e._extent[1][a],o[a]);else t=[n.vec3d.create(i),n.vec3d.create(o)]}),this._extent=t}},e._idGen=new i,e}()}.apply(null,n))||(e.exports=i)},1048:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){return function(){function e(){this.items=[]}return e.prototype.addObject=function(e,t){this.items.push({type:"object",highlightId:t,object:e})},e.prototype.addRenderGeometry=function(e,t,r){this.items.push({type:"renderGeometry",highlightId:r,renderGeometry:e,renderer:t})},e.prototype.addExternal=function(e,t){this.items.push({type:"external",highlightId:t,remove:e})},e.prototype.remove=function(e){for(var t=this.items.length-1;t>=0;--t){var r=this.items[t];r.highlightId===e&&(this.removeHighlight(r),this.items.splice(t,1))}},e.prototype.removeObject=function(e){for(var t=this.items.length-1;t>=0;--t){var r=this.items[t];"object"===r.type&&r.object===e&&(this.removeHighlight(r),this.items.splice(t,1))}},e.prototype.removeRenderGeometry=function(e){for(var t=this.items.length-1;t>=0;--t){var r=this.items[t];"renderGeometry"===r.type&&r.renderGeometry===e&&(this.removeHighlight(r),this.items.splice(t,1))}},e.prototype.removeAll=function(){var e=this;this.items.forEach(function(t){e.removeHighlight(t)}),this.items=[]},e.prototype.removeHighlight=function(e){switch(e.type){case"object":e.object.removeHighlights(e.highlightId);break;case"renderGeometry":e.renderer.removeRenderGeometryHighlight(e.renderGeometry,e.highlightId);break;case"external":e.remove(e.highlightId)}},e}()}.apply(null,n))||(e.exports=i)},1050:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.attributeLookup=function(e,t){for(var r=t.toLowerCase(),n=0,i=Object.keys(e);n<i.length;n++){var o=i[n];if(o.toLowerCase()===r)return e[o]}return null}}.apply(null,n))||(e.exports=i)},1053:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(344)],void 0===(i=function(e,t,r){function n(e,t,n,i,o,s,l,u,c,d,p){return function(e,t,n){for(var i=r.vec3d.dist2(e.maxVert[0],e.minVert[0]),o=0,a=1;a<7;++a){var s=r.vec3d.dist2(e.maxVert[a],e.minVert[a]);s>i&&(i=s,o=a)}r.vec3d.set(e.minVert[o],t),r.vec3d.set(e.maxVert[o],n)}(e,i,o),r.vec3d.dist2(i,o)<f?1:(r.vec3d.subtract(i,o,l),r.vec3d.normalize(l),function(e,t,n,i){for(var o=e.data,a=e.offsetIdx,s=e.strideIdx,l=Number.NEGATIVE_INFINITY,u=0,c=a;c<o.length;c+=s){r.vec3d.set3(o[c]-t[0],o[c+1]-t[1],o[c+2]-t[2],T);var d=n[0]*T[0]+n[1]*T[1]+n[2]*T[2],p=r.vec3d.length2(n),f=r.vec3d.length2(T)-d*d/p;f>l&&(l=f,u=c)}return r.vec3d.set3(o[u],o[u+1],o[u+2],i),l}(t,i,l,s)<f?2:(r.vec3d.subtract(o,s,u),r.vec3d.normalize(u),r.vec3d.subtract(s,i,c),r.vec3d.normalize(c),r.vec3d.cross(u,l,n),r.vec3d.normalize(n),a(t,n,l,u,c,d),0))}function i(e,t,n,i,s,l,u,c,d,p){o(e,t,n,i,s,v,g),void 0!==v[0]&&(r.vec3d.subtract(v,n,y),r.vec3d.normalize(y),r.vec3d.subtract(v,i,b),r.vec3d.normalize(b),r.vec3d.subtract(v,s,_),r.vec3d.normalize(_),r.vec3d.cross(b,l,x),r.vec3d.normalize(x),r.vec3d.cross(_,u,w),r.vec3d.normalize(w),r.vec3d.cross(y,c,S),r.vec3d.normalize(S),a(e,x,l,b,y,d),a(e,w,u,_,b,d),a(e,S,c,y,_,d)),void 0!==g[0]&&(r.vec3d.subtract(g,n,y),r.vec3d.normalize(y),r.vec3d.subtract(g,i,b),r.vec3d.normalize(b),r.vec3d.subtract(g,s,_),r.vec3d.normalize(_),r.vec3d.cross(b,l,x),r.vec3d.normalize(x),r.vec3d.cross(_,u,w),r.vec3d.normalize(w),r.vec3d.cross(y,c,S),r.vec3d.normalize(S),a(e,x,l,b,y,d),a(e,w,u,_,b,d),a(e,S,c,y,_,d))}function o(e,t,n,i,o,a,s){!function(e,t,n,i,o){var a=e.data,s=e.offsetIdx,l=e.strideIdx;r.vec3d.set3(a[s],a[s+1],a[s+2],i),r.vec3d.set(i,o),n[0]=r.vec3d.dot(M,t),n[1]=n[0];for(var u=s+l;u<a.length;u+=l){r.vec3d.set3(a[u],a[u+1],a[u+2],M);var c=r.vec3d.dot(M,t);c<n[0]&&(n[0]=c,r.vec3d.set(M,i)),c>n[1]&&(n[1]=c,r.vec3d.set(M,o))}}(e,t,E,s,a);var l=r.vec3d.dot(n,t);E[1]-f<=l&&(a[0]=void 0),E[0]+f>=l&&(s[0]=void 0)}function a(e,t,n,i,o,a){if(!(r.vec3d.length2(t)<f)){r.vec3d.cross(n,t,C),r.vec3d.cross(i,t,O),r.vec3d.cross(o,t,P),s(e,t,E),I[1]=E[0],A[1]=E[1],R[1]=A[1]-I[1];for(var l=[n,i,o],u=[C,O,P],c=0;c<3;++c){s(e,l[c],E),I[0]=E[0],A[0]=E[1],s(e,u[c],E),I[2]=E[0],A[2]=E[1],R[0]=A[0]-I[0],R[2]=A[2]-I[2];var d=p(R);d<a.quality&&(r.vec3d.set(l[c],a.b0),r.vec3d.set(t,a.b1),r.vec3d.set(u[c],a.b2),a.quality=d)}}}function s(e,t,r){var n=e.data,i=e.offsetIdx,o=e.strideIdx;r[0]=Number.POSITIVE_INFINITY,r[1]=Number.NEGATIVE_INFINITY;for(var a=i;a<n.length;a+=o){var s=n[a]*t[0]+n[a+1]*t[1]+n[a+2]*t[2];r[0]=Math.min(r[0],s),r[1]=Math.max(r[1],s)}}function l(e,t,n){r.vec3d.set(e,n.center),r.vec3d.scale(t,.5,n.halfSize),r.quat4.identity(n.quaternion)}function u(e,t,n){r.vec3d.set(t,D),Math.abs(t[0])>Math.abs(t[1])&&Math.abs(t[0])>Math.abs(t[2])?D[0]=0:Math.abs(t[1])>Math.abs(t[2])?D[1]=0:D[2]=0,r.vec3d.length2(D)<f&&(D[0]=D[1]=D[2]=1),r.vec3d.cross(t,D,F),r.vec3d.normalize(F),r.vec3d.cross(t,F,L),r.vec3d.normalize(L),c(e,t,F,L,N,j),r.vec3d.subtract(j,N,V),d(t,F,L,N,j,V,n)}function c(e,t,r,n,i,o){s(e,t,E),i[0]=E[0],o[0]=E[1],s(e,r,E),i[1]=E[0],o[1]=E[1],s(e,n,E),i[2]=E[0],o[2]=E[1]}function d(e,t,n,i,o,a,s){B[0]=e[0],B[3]=e[1],B[6]=e[2],B[1]=t[0],B[4]=t[1],B[7]=t[2],B[2]=n[0],B[5]=n[1],B[8]=n[2],r.quat4.fromRotationMatrix(B,s.quaternion),r.vec3d.add(i,o,z),r.vec3d.scale(z,.5),r.vec3d.scale(e,z[0],s.center),r.vec3d.scale(t,z[1],U),r.vec3d.add(s.center,U),r.vec3d.scale(n,z[2],U),r.vec3d.add(s.center,U),r.vec3d.scale(a,.5,s.halfSize)}function p(e){return e[0]*e[1]+e[0]*e[2]+e[1]*e[2]}Object.defineProperty(t,"__esModule",{value:!0});var f=1e-6,h=r.vec3d.create(),m=r.vec3d.create();t.computeOBB=function(e,t){var o=e.data,a=e.strideIdx,s=o.length/a;if(!(s<=0)){var f=new k(e);r.vec3d.add(f.minProj,f.maxProj,h),r.vec3d.scale(h,.5),r.vec3d.subtract(f.maxProj,f.minProj,m);var v=p(m),g=new G;g.quality=v,s<14&&(e={data:new Float64Array(f.buffer,112,42),size:3,offsetIdx:0,strideIdx:3});var y=r.vec3d.create(),b=r.vec3d.create(),_=r.vec3d.create(),x=r.vec3d.create(),w=r.vec3d.create(),S=r.vec3d.create(),T=r.vec3d.create();switch(n(f,e,T,y,b,_,x,w,S,g)){case 1:return void l(h,m,t);case 2:return void u(e,x,t)}i(e,T,y,b,_,x,w,S,g),c(e,g.b0,g.b1,g.b2,N,j);var E=r.vec3d.create();r.vec3d.subtract(j,N,E),g.quality=p(E),g.quality<v?d(g.b0,g.b1,g.b2,N,j,E,t):l(h,m,t)}};var v=r.vec3d.create(),g=r.vec3d.create(),y=r.vec3d.create(),b=r.vec3d.create(),_=r.vec3d.create(),x=r.vec3d.create(),w=r.vec3d.create(),S=r.vec3d.create(),T=r.vec3d.create(),E=r.vec2d.create(),C=r.vec3d.create(),O=r.vec3d.create(),P=r.vec3d.create(),A=r.vec3d.create(),I=r.vec3d.create(),R=r.vec3d.create(),M=r.vec3d.create(),D=r.vec3d.create(),F=r.vec3d.create(),L=r.vec3d.create(),N=r.vec3d.create(),j=r.vec3d.create(),V=r.vec3d.create(),U=r.vec3d.create(),B=r.mat3.create(),z=r.vec3d.create(),k=function(){return function(e){this.minVert=[],this.maxVert=[],this.buffer=new ArrayBuffer(448);var t=0;for(this.minProj=new Float64Array(this.buffer,t,7),t+=56,this.maxProj=new Float64Array(this.buffer,t,7),t+=56;this.minVert.length<7;)this.minVert.push(new Float64Array(this.buffer,t,3)),t+=24;for(;this.maxVert.length<7;)this.maxVert.push(new Float64Array(this.buffer,t,3)),t+=24;for(var n=0;n<7;++n)this.minProj[n]=Number.POSITIVE_INFINITY,this.maxProj[n]=Number.NEGATIVE_INFINITY;var i=[],o=[],a=e.data,s=e.offsetIdx,l=e.strideIdx;for(n=s;n<a.length;n+=l){var u=a[n];u<this.minProj[0]&&(this.minProj[0]=u,i[0]=n),u>this.maxProj[0]&&(this.maxProj[0]=u,o[0]=n),(u=a[n+1])<this.minProj[1]&&(this.minProj[1]=u,i[1]=n),u>this.maxProj[1]&&(this.maxProj[1]=u,o[1]=n),(u=a[n+2])<this.minProj[2]&&(this.minProj[2]=u,i[2]=n),u>this.maxProj[2]&&(this.maxProj[2]=u,o[2]=n),(u=a[n]+a[n+1]+a[n+2])<this.minProj[3]&&(this.minProj[3]=u,i[3]=n),u>this.maxProj[3]&&(this.maxProj[3]=u,o[3]=n),(u=a[n]+a[n+1]-a[n+2])<this.minProj[4]&&(this.minProj[4]=u,i[4]=n),u>this.maxProj[4]&&(this.maxProj[4]=u,o[4]=n),(u=a[n]-a[n+1]+a[n+2])<this.minProj[5]&&(this.minProj[5]=u,i[5]=n),u>this.maxProj[5]&&(this.maxProj[5]=u,o[5]=n),(u=a[n]-a[n+1]-a[n+2])<this.minProj[6]&&(this.minProj[6]=u,i[6]=n),u>this.maxProj[6]&&(this.maxProj[6]=u,o[6]=n)}for(n=0;n<7;++n){var c=i[n];r.vec3d.set3(a[c],a[c+1],a[c+2],this.minVert[n]),c=o[n],r.vec3d.set3(a[c],a[c+1],a[c+2],this.maxVert[n])}}}(),G=function(){return function(){this.b0=r.vec3d.createFrom(1,0,0),this.b1=r.vec3d.createFrom(0,1,0),this.b2=r.vec3d.createFrom(0,0,1),this.quality=0}}()}.apply(null,n))||(e.exports=i)},1055:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(814),r(724),r(1259),r(1056),r(1057),r(1058)],void 0===(i=function(e,t,r,n,i,o,a,s){function l(e){return i(e,["YYYY-M-D H:m:s","YYYY-M-D H:mZ","YYYY-M-D H:m:sZ","YYYY-M-D H:m","YYYY-m-d"]).toDate()}function u(e){return i(e,["YYYY-M-D"]).toDate()}function c(e){return!0===e}function d(e){return Array.isArray(e)?e:[e]}function p(e){return null!==e?!0!==e:null}function f(e,t){if(null==e)return null;for(var r=!1,n=0,i=t;n<i.length;n++){var o=i[n];if(null==o)r=null;else if(e===o){r=!0;break}}return r}function h(e,t,r){if(null==e)return null;for(var n=t,i=r,o="",a="-[]/{}()*+?.\\^$|",s=0,l=0;l<n.length;l++){var u=n.charAt(l);switch(s){case 0:u===i?s=1:a.indexOf(u)>=0?o+="\\"+u:o+="%"===u?".*":"_"===u?".":u;break;case 1:a.indexOf(u)>=0?o+="\\"+u:o+=u,s=0}}return new RegExp("^"+o+"$").test(e)}function m(e){return e instanceof Date?e.valueOf():e}function v(e){for(var t=[],r={},n=0,i=e;n<i.length;n++){var o=i[n],a=o.toLowerCase();void 0===r[a]&&(t.push(o),r[a]=1)}return t}return function(){function e(){this.parseTree=null,this.parameters=null,this._hasStandardizedFunctions=null,this._hasAggregateFunctions=null}return e.create=function(t){var r=new e;r.parseTree=s.WhereGrammar.parse(t);var n=!0,i=!0;return r.visitAll(r.parseTree,function(e){if("function"===e.type){var t=e.name,r=e.args.value.length;n&&(n=a.isStandardized(t,r)),i&&(i=o.isAggregate(t,r))}}),r._hasStandardizedFunctions=n,r._hasAggregateFunctions=i,r},e.prototype.isStandardized=function(){return this._hasStandardizedFunctions},e.prototype.isAggregate=function(){return this._hasAggregateFunctions},e.prototype.setVariablesDictionary=function(e){this.parameters=e},e.prototype.testFeature=function(e){return!!this.evaluateNode(this.parseTree,e)},e.prototype.testSet=function(e){var t=this,r=new n.default;this.visitAll(this.parseTree,function(e){"column_ref"!==e.type||r.has(e.column)||r.set(e.column,e)});for(var i={},o=0,a=e;o<a.length;o++){!function(e){r.forEach(function(r,n){var o=t.featureValue(e,n,r);i[n]?i[n].push(o):i[n]=[o]})}(a[o])}return!!this.evaluateNode(this.parseTree,{attributes:i})},e.prototype.calculateValue=function(e){return this.evaluateNode(this.parseTree,e)},e.prototype.getFunctions=function(){var e=[];return this.visitAll(this.parseTree,function(t){"function"===t.type&&e.push(t.name.toLowerCase())}),v(e)},e.prototype.getExpressions=function(){var e=new n.default;return this.visitAll(this.parseTree,function(t){if("function"===t.type){var r=t.name.toLowerCase(),n=t.args.value[0];if("column_ref"===n.type){var i=n.column,o=r+"-"+i;e.has(o)||e.set(o,{aggregateType:r,field:i})}}}),r.from(e.values())},e.prototype.getFields=function(){var e=[];return this.visitAll(this.parseTree,function(t){"column_ref"===t.type&&e.push(t.column)}),v(e)},e.prototype.getVariables=function(){var e=[];return this.visitAll(this.parseTree,function(t){"param"===t.type&&e.push(t.value.toLowerCase())}),v(e)},e.prototype.featureValue=function(e,t,r){var n=function(e){return e&&"object"==typeof e.attributes}(e)?e.attributes:e,i=n[t];if(void 0!==i)return i;for(var o in n)if(t.toLowerCase()===o.toLowerCase())return r.column=o,n[o];return null},e.prototype.visitAll=function(e,t){if(null!=e)switch(t(e),e.type){case"when_clause":this.visitAll(e.operand,t),this.visitAll(e.value,t);break;case"case_expression":for(var r=0,n=e.clauses;r<n.length;r++){var i=n[r];this.visitAll(i,t)}"simple"===e.format&&this.visitAll(e.operand,t),null!==e.else&&this.visitAll(e.else,t);break;case"expr_list":for(var o=0,a=e.value;o<a.length;o++){i=a[o];this.visitAll(i,t)}break;case"unary_expr":this.visitAll(e.expr,t);break;case"binary_expr":this.visitAll(e.left,t),this.visitAll(e.right,t);break;case"function":this.visitAll(e.args,t)}},e.prototype.evaluateNode=function(e,t){switch(e.type){case"case_expression":if("simple"===e.format){for(var r=m(this.evaluateNode(e.operand,t)),n=0;n<e.clauses.length;n++)if(r===m(this.evaluateNode(e.clauses[n].operand,t)))return this.evaluateNode(e.clauses[n].value,t);if(null!==e.else)return this.evaluateNode(e.else,t)}else{for(n=0;n<e.clauses.length;n++)if(c(this.evaluateNode(e.clauses[n].operand,t)))return this.evaluateNode(e.clauses[n].value,t);if(null!==e.else)return this.evaluateNode(e.else,t)}return null;case"param":return this.parameters[e.value.toLowerCase()];case"expr_list":for(var i=[],s=0,v=e.value;s<v.length;s++){var g=v[s];i.push(this.evaluateNode(g,t))}return i;case"unary_expr":return p(this.evaluateNode(e.expr,t));case"binary_expr":switch(e.operator){case"AND":return function(e,t){return null!=e&&null!=t?!0===e&&!0===t:!1!==e&&!1!==t&&null}(this.evaluateNode(e.left,t),this.evaluateNode(e.right,t));case"OR":return function(e,t){return null!=e&&null!=t?!0===e||!0===t:!0===e||!0===t||null}(this.evaluateNode(e.left,t),this.evaluateNode(e.right,t));case"IS":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return null===this.evaluateNode(e.left,t);case"ISNOT":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return null!==this.evaluateNode(e.left,t);case"IN":var y=d(this.evaluateNode(e.right,t));return f(this.evaluateNode(e.left,t),y);case"NOT IN":y=d(this.evaluateNode(e.right,t));return p(f(this.evaluateNode(e.left,t),y));case"BETWEEN":var b=this.evaluateNode(e.left,t),_=this.evaluateNode(e.right,t);return null==b||null==_[0]||null==_[1]?null:b>=_[0]&&b<=_[1];case"NOTBETWEEN":b=this.evaluateNode(e.left,t),_=this.evaluateNode(e.right,t);return null==b||null==_[0]||null==_[1]?null:b<_[0]||b>_[1];case"LIKE":return h(this.evaluateNode(e.left,t),this.evaluateNode(e.right,t),e.escape);case"NOT LIKE":return p(h(this.evaluateNode(e.left,t),this.evaluateNode(e.right,t),e.escape));case"<>":case"<":case">":case">=":case"<=":case"=":return function(e,t,r){if(null==t||null==r)return null;var n=m(t),i=m(r);switch(e){case"<>":return n!==i;case"=":return n===i;case">":return n>i;case"<":return n<i;case">=":return n>=i;case"<=":return n<=i}}(e.operator,this.evaluateNode(e.left,t),this.evaluateNode(e.right,t));case"*":return this.evaluateNode(e.left,t)*this.evaluateNode(e.right,t);case"-":return this.evaluateNode(e.left,t)-this.evaluateNode(e.right,t);case"+":return this.evaluateNode(e.left,t)+this.evaluateNode(e.right,t);case"/":return this.evaluateNode(e.left,t)/this.evaluateNode(e.right,t)}throw new Error("Not Supported Operator "+e.operator);case"null":case"bool":case"string":case"number":return e.value;case"date":return u(e.value);case"timestamp":return l(e.value);case"column_ref":return"CURRENT_DATE"===e.column.toUpperCase()?((g=new Date).setHours(0,0,0,0),g):"CURRENT_TIMESTAMP"===e.column.toUpperCase()?new Date:this.featureValue(t,e.column,e);case"function":var x=this.evaluateNode(e.args,t);return this.isAggregate()?o.aggregateFunction(e.name,x):a.evaluateFunction(e.name,x)}throw new Error("Unsupported sql syntax "+e.type)},e}()}.apply(null,n))||(e.exports=i)},1056:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t/e.length}function n(e){for(var t=r(e),n=e.length,i=0,o=0,a=e;o<a.length;o++){var s=a[o];i+=Math.pow(s-t,2)}return n>1?i/(n-1):0}Object.defineProperty(t,"__esModule",{value:!0}),t.aggregateFunction=function(e,t){var r=i[e.toLowerCase()];if(null==r)throw new Error("Function Not Recognised");if(t.length<r.minParams||t.length>r.maxParams)throw new Error("Invalid Parameter count for call to "+e.toUpperCase());return r.evaluate(t)},t.isAggregate=function(e,t){var r=i[e.toLowerCase()];return null!=r&&t>=r.minParams&&t<=r.maxParams};var i={min:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.min.apply(Math,e[0])}},max:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.max.apply(Math,e[0])}},avg:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:r(e[0])}},sum:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:function(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t}(e[0])}},stddev:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.sqrt(n(e[0]))}},count:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:e[0].length}},var:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:n(e[0])}}}}.apply(null,n))||(e.exports=i)},1057:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(781)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.evaluateFunction=function(e,t){var r=n[e.toLowerCase()];if(null==r)throw new Error("Function Not Recognised");if(t.length<r.minParams||t.length>r.maxParams)throw new Error("Invalid Parameter count for call to "+e.toUpperCase());return r.evaluate(t)},t.isStandardized=function(e,t){var r=n[e.toLowerCase()];return null!=r&&t>=r.minParams&&t<=r.maxParams};var n={extract:{minParams:2,maxParams:2,evaluate:function(e){var t=e[0],r=e[1];if(null==r)return null;if(r instanceof Date)switch(t.toUpperCase()){case"SECOND":return r.getSeconds();case"MINUTE":return r.getMinutes();case"HOUR":return r.getHours();case"DAY":return r.getDate();case"MONTH":return r.getMonth()+1;case"YEAR":return r.getFullYear()}throw new Error("Invalid Parameter for call to EXTRACT")}},substring:{minParams:2,maxParams:3,evaluate:function(e){if(2===e.length){var t=e[0],r=e[1];return null==t||null==r?null:t.toString().substring(r-1)}if(3===e.length){t=e[0],r=e[1];var n=e[2];return null==t||null==r||null==n?null:n<=0?"":t.toString().substring(r-1,r+n-1)}}},position:{minParams:2,maxParams:2,evaluate:function(e){var t=e[0],r=e[1];return null==t||null==r?null:r.indexOf(t)+1}},trim:{minParams:2,maxParams:3,evaluate:function(e){var t=3===e.length,n=t?e[1]:" ",i=t?e[2]:e[1];if(null==n||null==i)return null;var o="("+r.escapeString(n)+")";switch(e[0]){case"BOTH":return i.replace(new RegExp("^"+o+"*|"+o+"*$","g"),"");case"LEADING":return i.replace(new RegExp("^"+o+"*","g"),"");case"TRAILING":return i.replace(new RegExp(o+"*$","g"),"")}throw new Error("Invalid Parameter for call to TRIM")}},abs:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.abs(e[0])}},ceiling:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.ceil(e[0])}},floor:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.floor(e[0])}},log:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.log(e[0])}},log10:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.log(e[0])*Math.LOG10E}},sin:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.sin(e[0])}},cos:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.cos(e[0])}},tan:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.tan(e[0])}},asin:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.asin(e[0])}},acos:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.acos(e[0])}},atan:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.atan(e[0])}},sign:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:e[0]>0?1:e[1]<0?-1:0}},power:{minParams:2,maxParams:2,evaluate:function(e){return null==e[0]||null==e[1]?null:Math.pow(e[0],e[1])}},mod:{minParams:2,maxParams:2,evaluate:function(e){return null==e[0]||null==e[1]?null:e[0]%e[1]}},round:{minParams:1,maxParams:2,evaluate:function(e){var t=e[0],r=2===e.length?Math.pow(10,e[1]):1;return null==t?null:Math.round(t*r)/r}},truncate:{minParams:1,maxParams:2,evaluate:function(e){return null==e[0]?null:1===e.length?parseInt(e[0].toFixed(0),10):parseFloat(e[0].toFixed(e[1]))}},char_length:{minParams:1,maxParams:1,evaluate:function(e){return"string"==typeof e[0]||e[0]instanceof String?e[0].length:0}},concat:{minParams:1,maxParams:1/0,evaluate:function(e){for(var t="",r=0;r<e.length;r++){if(null==e[r])return null;t+=e[r].toString()}return t}},lower:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:e[0].toString().toLowerCase()}},upper:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:e[0].toString().toUpperCase()}}}}.apply(null,n))||(e.exports=i)},1058:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1059)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.parse=function(e){return r.parse(e)},e}();t.WhereGrammar=n}.apply(null,n))||(e.exports=i)},1059:function(e,t,r){var n;void 0===(n=function(){"use strict";function e(t,r,n,i){this.message=t,this.expected=r,this.found=n,this.location=i,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,e)}return function(e,t){function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r}(e,Error),e.buildMessage=function(e,t){function r(e){return e.charCodeAt(0).toString(16).toUpperCase()}function n(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(e){return"\\x0"+r(e)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(e){return"\\x"+r(e)})}function i(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(e){return"\\x0"+r(e)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(e){return"\\x"+r(e)})}function o(e){return a[e.type](e)}var a={literal:function(e){return'"'+n(e.text)+'"'},class:function(e){var t,r="";for(t=0;t<e.parts.length;t++)r+=e.parts[t]instanceof Array?i(e.parts[t][0])+"-"+i(e.parts[t][1]):i(e.parts[t]);return"["+(e.inverted?"^":"")+r+"]"},any:function(e){return"any character"},end:function(e){return"end of input"},other:function(e){return e.description}};return"Expected "+function(e){var t,r,n=new Array(e.length);for(t=0;t<e.length;t++)n[t]=o(e[t]);if(n.sort(),n.length>0){for(t=1,r=1;t<n.length;t++)n[t-1]!==n[t]&&(n[r]=n[t],r++);n.length=r}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,-1).join(", ")+", or "+n[n.length-1]}}(e)+" but "+(t?'"'+n(t)+'"':"end of input")+" found."},{SyntaxError:e,parse:function(t,r){function n(e,t){return{type:"literal",text:e,ignoreCase:t}}function i(e,t,r){return{type:"class",parts:e,inverted:t,ignoreCase:r}}function o(e){var r,n=hi[e];if(n)return n;for(r=e-1;!hi[r];)r--;for(n={line:(n=hi[r]).line,column:n.column};r<e;)10===t.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return hi[e]=n,n}function a(e,t){var r=o(e),n=o(t);return{start:{offset:e,line:r.line,column:r.column},end:{offset:t,line:n.line,column:n.column}}}function s(e){fi<mi||(fi>mi&&(mi=fi,vi=[]),vi.push(e))}function l(){var e,t;return e=fi,de()!==ge&&(t=c())!==ge&&de()!==ge?e=_e(t):(fi=e,e=ge),e}function u(){var e,t,r,n,i,o,a,s;if(e=fi,(t=c())!==ge){for(r=[],n=fi,(i=de())!==ge&&(o=le())!==ge&&(a=de())!==ge&&(s=c())!==ge?n=i=[i,o,a,s]:(fi=n,n=ge);n!==ge;)r.push(n),n=fi,(i=de())!==ge&&(o=le())!==ge&&(a=de())!==ge&&(s=c())!==ge?n=i=[i,o,a,s]:(fi=n,n=ge);r!==ge?e=t=xe(t,r):(fi=e,e=ge)}else fi=e,e=ge;return e}function c(){var e,t,r,n,i,o,a,s;if(e=fi,(t=d())!==ge){for(r=[],n=fi,(i=de())!==ge&&(o=X())!==ge&&(a=de())!==ge&&(s=d())!==ge?n=i=[i,o,a,s]:(fi=n,n=ge);n!==ge;)r.push(n),n=fi,(i=de())!==ge&&(o=X())!==ge&&(a=de())!==ge&&(s=d())!==ge?n=i=[i,o,a,s]:(fi=n,n=ge);r!==ge?e=t=we(t,r):(fi=e,e=ge)}else fi=e,e=ge;return e}function d(){var e,t,r,n,i,o,a,s;if(e=fi,(t=p())!==ge){for(r=[],n=fi,(i=de())!==ge&&(o=W())!==ge&&(a=de())!==ge&&(s=p())!==ge?n=i=[i,o,a,s]:(fi=n,n=ge);n!==ge;)r.push(n),n=fi,(i=de())!==ge&&(o=W())!==ge&&(a=de())!==ge&&(s=p())!==ge?n=i=[i,o,a,s]:(fi=n,n=ge);r!==ge?e=t=we(t,r):(fi=e,e=ge)}else fi=e,e=ge;return e}function p(){var e,r,n,i,o;return e=fi,(r=q())===ge&&(r=fi,33===t.charCodeAt(fi)?(n=Se,fi++):(n=ge,0===gi&&s(Te)),n!==ge?(i=fi,gi++,61===t.charCodeAt(fi)?(o=Ee,fi++):(o=ge,0===gi&&s(Ce)),gi--,o===ge?i=void 0:(fi=i,i=ge),i!==ge?r=n=[n,i]:(fi=r,r=ge)):(fi=r,r=ge)),r!==ge&&(n=de())!==ge&&(i=p())!==ge?e=r=Oe(i):(fi=e,e=ge),e===ge&&(e=function(){var e,t,r;return e=fi,(t=v())!==ge&&de()!==ge?((r=function(){var e;return(e=function(){var e,t,r,n,i,o;if(fi,e=[],t=fi,(r=de())!==ge&&(n=f())!==ge&&(i=de())!==ge&&(o=v())!==ge?t=r=[r,n,i,o]:(fi=t,t=ge),t!==ge)for(;t!==ge;)e.push(t),t=fi,(r=de())!==ge&&(n=f())!==ge&&(i=de())!==ge&&(o=v())!==ge?t=r=[r,n,i,o]:(fi=t,t=ge);else e=ge;return e!==ge&&(e=Ae(e)),e}())===ge&&(e=function(){var e,t,r,n;return e=fi,(t=m())!==ge&&de()!==ge&&(r=ue())!==ge&&de()!==ge&&(n=u())!==ge&&de()!==ge&&ce()!==ge?(t=Ye(t,n),e=t):(fi=e,e=ge),e===ge&&(e=fi,(t=m())!==ge&&de()!==ge&&(r=ue())!==ge&&de()!==ge&&(n=ce())!==ge?(t=Je(t),e=t):(fi=e,e=ge),e===ge&&(e=fi,(t=m())!==ge&&de()!==ge&&(r=E())!==ge?(t=Ze(t,r),e=t):(fi=e,e=ge))),e}())===ge&&(e=function(){var e,t,r,n,i,o;return e=fi,(t=q())!==ge&&de()!==ge&&(r=Q())!==ge&&de()!==ge&&(n=v())!==ge&&de()!==ge&&(i=W())!==ge&&de()!==ge&&(o=v())!==ge?(t=He(r,n,o),e=t):(fi=e,e=ge),e===ge&&(e=fi,(t=Q())!==ge&&de()!==ge&&(r=v())!==ge&&de()!==ge&&(n=W())!==ge&&de()!==ge&&(i=v())!==ge?(t=qe(t,r,i),e=t):(fi=e,e=ge)),e}())===ge&&(e=function(){var e,t,r,n;return e=fi,(t=k())!==ge&&de()!==ge&&(r=q())!==ge&&de()!==ge&&(n=v())!==ge?(t=ke(t,n),e=t):(fi=e,e=ge),e===ge&&(e=fi,(t=k())!==ge&&de()!==ge&&(r=v())!==ge?(t=Ge(t,r),e=t):(fi=e,e=ge)),e}())===ge&&(e=function(){var e,t,r,n;return e=fi,(t=h())!==ge&&de()!==ge&&(r=O())!==ge&&de()!==ge&&H()!==ge&&de()!==ge&&(n=P())!==ge?(t=Xe(t,r,n),e=t):(fi=e,e=ge),e===ge&&(e=fi,(t=h())!==ge&&de()!==ge&&(r=O())!==ge?(t=Qe(t,r),e=t):(fi=e,e=ge)),e}()),e}())===ge&&(r=null),r!==ge?(t=Pe(t,r),e=t):(fi=e,e=ge)):(fi=e,e=ge),e}()),e}function f(){var e;return t.substr(fi,2)===Ie?(e=Ie,fi+=2):(e=ge,0===gi&&s(Re)),e===ge&&(62===t.charCodeAt(fi)?(e=Me,fi++):(e=ge,0===gi&&s(De)),e===ge&&(t.substr(fi,2)===Fe?(e=Fe,fi+=2):(e=ge,0===gi&&s(Le)),e===ge&&(t.substr(fi,2)===Ne?(e=Ne,fi+=2):(e=ge,0===gi&&s(je)),e===ge&&(60===t.charCodeAt(fi)?(e=Ve,fi++):(e=ge,0===gi&&s(Ue)),e===ge&&(61===t.charCodeAt(fi)?(e=Ee,fi++):(e=ge,0===gi&&s(Ce)),e===ge&&(t.substr(fi,2)===Be?(e=Be,fi+=2):(e=ge,0===gi&&s(ze)))))))),e}function h(){var e,t,r,n,i;return e=fi,t=fi,(r=q())!==ge&&(n=de())!==ge&&(i=G())!==ge?t=r=[r,n,i]:(fi=t,t=ge),t!==ge&&(t=We(t)),(e=t)===ge&&(e=G()),e}function m(){var e,t,r,n,i;return e=fi,t=fi,(r=q())!==ge&&(n=de())!==ge&&(i=z())!==ge?t=r=[r,n,i]:(fi=t,t=ge),t!==ge&&(t=We(t)),(e=t)===ge&&(e=z()),e}function v(){var e,t,r,n,i,o,a,s;if(e=fi,(t=y())!==ge){for(r=[],n=fi,(i=de())!==ge&&(o=g())!==ge&&(a=de())!==ge&&(s=y())!==ge?n=i=[i,o,a,s]:(fi=n,n=ge);n!==ge;)r.push(n),n=fi,(i=de())!==ge&&(o=g())!==ge&&(a=de())!==ge&&(s=y())!==ge?n=i=[i,o,a,s]:(fi=n,n=ge);r!==ge?e=t=we(t,r):(fi=e,e=ge)}else fi=e,e=ge;return e}function g(){var e;return 43===t.charCodeAt(fi)?(e=Ke,fi++):(e=ge,0===gi&&s($e)),e===ge&&(45===t.charCodeAt(fi)?(e=et,fi++):(e=ge,0===gi&&s(tt))),e}function y(){var e,t,r,n,i,o,a,s;if(e=fi,(t=_())!==ge){for(r=[],n=fi,(i=de())!==ge&&(o=b())!==ge&&(a=de())!==ge&&(s=_())!==ge?n=i=[i,o,a,s]:(fi=n,n=ge);n!==ge;)r.push(n),n=fi,(i=de())!==ge&&(o=b())!==ge&&(a=de())!==ge&&(s=_())!==ge?n=i=[i,o,a,s]:(fi=n,n=ge);r!==ge?e=t=rt(t,r):(fi=e,e=ge)}else fi=e,e=ge;return e}function b(){var e;return 42===t.charCodeAt(fi)?(e=nt,fi++):(e=ge,0===gi&&s(it)),e===ge&&(47===t.charCodeAt(fi)?(e=ot,fi++):(e=ge,0===gi&&s(at))),e}function _(){var e,t;return(e=function(){var e,t;return(e=P())===ge&&(e=function(){var e,t,r,n;return e=fi,(t=function(){var e,t,r,n;return e=fi,(t=M())!==ge&&(r=D())!==ge&&(n=F())!==ge?(t=Qt(t,r,n),e=t):(fi=e,e=ge),e===ge&&(e=fi,(t=M())!==ge&&(r=D())!==ge?(t=Yt(t,r),e=t):(fi=e,e=ge),e===ge&&(e=fi,(t=M())!==ge&&(r=F())!==ge?(t=Jt(t,r),e=t):(fi=e,e=ge),e===ge&&(e=fi,(t=M())!==ge&&(t=Zt(t)),e=t))),e}())!==ge?(r=fi,gi++,n=w(),gi--,n===ge?r=void 0:(fi=r,r=ge),r!==ge?(t=Xt(t),e=t):(fi=e,e=ge)):(fi=e,e=ge),e}())===ge&&(e=function(){var e,t;return e=fi,(t=U())!==ge&&(t=At()),(e=t)===ge&&(e=fi,(t=B())!==ge&&(t=It()),e=t),e}())===ge&&((t=V())!==ge&&(t=Pt()),(e=t)===ge)&&(e=function(){var e,t,r;return e=fi,(t=re())!==ge&&de()!==ge&&(r=O())!==ge?(t=Ot(r),e=t):(fi=e,e=ge),e}())===ge&&(e=function(){var e,t,r;return e=fi,(t=te())!==ge&&de()!==ge&&(r=O())!==ge?(t=Ct(r),e=t):(fi=e,e=ge),e}()),e}())===ge&&(e=function(){var e,t,r,n;return e=fi,(t=K())!==ge&&de()!==ge&&ue()!==ge&&de()!==ge&&(r=function(){var e;return(e=function(){var e,r,n,i;return e=fi,t.substr(fi,4).toLowerCase()===xn?(r=t.substr(fi,4),fi+=4):(r=ge,0===gi&&s(wn)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?(r=Sn(),e=r):(fi=e,e=ge)):(fi=e,e=ge),e}())===ge&&(e=function(){var e,r,n,i;return e=fi,t.substr(fi,5).toLowerCase()===Tn?(r=t.substr(fi,5),fi+=5):(r=ge,0===gi&&s(En)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?(r=Cn(),e=r):(fi=e,e=ge)):(fi=e,e=ge),e}())===ge&&(e=function(){var e,r,n,i;return e=fi,t.substr(fi,3).toLowerCase()===On?(r=t.substr(fi,3),fi+=3):(r=ge,0===gi&&s(Pn)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?(r=An(),e=r):(fi=e,e=ge)):(fi=e,e=ge),e}())===ge&&(e=function(){var e,r,n,i;return e=fi,t.substr(fi,4).toLowerCase()===In?(r=t.substr(fi,4),fi+=4):(r=ge,0===gi&&s(Rn)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?(r=Mn(),e=r):(fi=e,e=ge)):(fi=e,e=ge),e}())===ge&&(e=function(){var e,r,n,i;return e=fi,t.substr(fi,6).toLowerCase()===Dn?(r=t.substr(fi,6),fi+=6):(r=ge,0===gi&&s(Fn)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?(r=Ln(),e=r):(fi=e,e=ge)):(fi=e,e=ge),e}())===ge&&(e=function(){var e,r,n,i;return e=fi,t.substr(fi,6).toLowerCase()===Nn?(r=t.substr(fi,6),fi+=6):(r=ge,0===gi&&s(jn)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?(r=Vn(),e=r):(fi=e,e=ge)):(fi=e,e=ge),e}()),e}())!==ge&&de()!==ge&&Y()!==ge&&de()!==ge&&(n=c())!==ge&&de()!==ge&&ce()!==ge?(t=_t(r,n),e=t):(fi=e,e=ge),e}())===ge&&(e=function(){var e,t,r,n,i,o,a,s,l;return e=fi,(t=Z())!==ge&&de()!==ge&&ue()!==ge&&de()!==ge&&(r=c())!==ge&&de()!==ge&&Y()!==ge&&de()!==ge&&(n=c())!==ge&&de()!==ge?(i=fi,(o=J())!==ge&&(a=de())!==ge&&(s=c())!==ge&&(l=de())!==ge?i=o=[o,a,s,l]:(fi=i,i=ge),i===ge&&(i=null),i!==ge&&(o=ce())!==ge?(t=xt(r,n,i),e=t):(fi=e,e=ge)):(fi=e,e=ge),e}())===ge&&(e=function(){var e,t,r,n,i;return e=fi,(t=$())!==ge&&de()!==ge&&ue()!==ge&&de()!==ge?((r=C())===ge&&(r=null),r!==ge&&de()!==ge&&(n=c())!==ge&&de()!==ge&&Y()!==ge&&de()!==ge&&(i=c())!==ge&&de()!==ge&&ce()!==ge?(t=wt(r,n,i),e=t):(fi=e,e=ge)):(fi=e,e=ge),e===ge&&(e=fi,(t=$())!==ge&&de()!==ge&&ue()!==ge&&de()!==ge?((r=C())===ge&&(r=null),r!==ge&&de()!==ge&&(n=c())!==ge&&de()!==ge&&ce()!==ge?(t=St(r,n),e=t):(fi=e,e=ge)):(fi=e,e=ge)),e}())===ge&&(e=function(){var e,t,r,n;return e=fi,(t=ee())!==ge&&de()!==ge&&ue()!==ge&&de()!==ge&&(r=c())!==ge&&de()!==ge&&z()!==ge&&de()!==ge&&(n=c())!==ge&&de()!==ge&&ce()!==ge?(t=Tt(r,n),e=t):(fi=e,e=ge),e}())===ge&&(e=function(){var e,t,r;return e=fi,(t=fe())!==ge&&de()!==ge&&ue()!==ge&&de()!==ge?((r=u())===ge&&(r=null),r!==ge&&de()!==ge&&ce()!==ge?(t=Et(t,r),e=t):(fi=e,e=ge)):(fi=e,e=ge),e}())===ge&&(e=function(){var e;return(e=function(){var e,t,r,n,i,o;if(e=fi,(t=ne())!==ge)if(de()!==ge)if((r=c())!==ge)if(de()!==ge){for(n=[],i=I();i!==ge;)n.push(i),i=I();n!==ge&&(i=de())!==ge&&(o=ie())!==ge?(t=zt(r,n),e=t):(fi=e,e=ge)}else fi=e,e=ge;else fi=e,e=ge;else fi=e,e=ge;else fi=e,e=ge;if(e===ge)if(e=fi,(t=ne())!==ge)if(de()!==ge)if((r=c())!==ge)if(de()!==ge){for(n=[],i=I();i!==ge;)n.push(i),i=I();n!==ge&&(i=de())!==ge&&(o=R())!==ge&&de()!==ge&&ie()!==ge?(t=kt(r,n,o),e=t):(fi=e,e=ge)}else fi=e,e=ge;else fi=e,e=ge;else fi=e,e=ge;else fi=e,e=ge;return e}())===ge&&(e=function(){var e,t,r,n,i;if(e=fi,(t=ne())!==ge)if(de()!==ge){for(r=[],n=A();n!==ge;)r.push(n),n=A();r!==ge&&(n=de())!==ge&&(i=ie())!==ge?(t=Gt(r),e=t):(fi=e,e=ge)}else fi=e,e=ge;else fi=e,e=ge;if(e===ge)if(e=fi,(t=ne())!==ge)if(de()!==ge){for(r=[],n=A();n!==ge;)r.push(n),n=A();r!==ge&&(n=de())!==ge&&(i=R())!==ge&&de()!==ge&&ie()!==ge?(t=Ht(r,i),e=t):(fi=e,e=ge)}else fi=e,e=ge;else fi=e,e=ge;return e}()),e}())===ge&&(e=function(){var e;return fi,(e=function(){var e;return fi,(e=function(){var e,t,r,n;if(e=fi,(t=w())!==ge){for(r=[],n=T();n!==ge;)r.push(n),n=T();r!==ge?(t=ct(t,r),e=t):(fi=e,e=ge)}else fi=e,e=ge;return e}())!==ge&&(e=ut(e)),e}())!==ge&&(e=lt(e)),e}())===ge&&(e=E())===ge&&(e=fi,ue()!==ge&&de()!==ge&&(t=c())!==ge&&de()!==ge&&ce()!==ge?e=st(t):(fi=e,e=ge)),e}function x(){var e,t,r,n;if(e=fi,(t=w())!==ge){for(r=[],n=S();n!==ge;)r.push(n),n=S();r!==ge?e=t=ct(t,r):(fi=e,e=ge)}else fi=e,e=ge;return e}function w(){var e;return dt.test(t.charAt(fi))?(e=t.charAt(fi),fi++):(e=ge,0===gi&&s(pt)),e}function S(){var e;return ft.test(t.charAt(fi))?(e=t.charAt(fi),fi++):(e=ge,0===gi&&s(ht)),e}function T(){var e;return mt.test(t.charAt(fi))?(e=t.charAt(fi),fi++):(e=ge,0===gi&&s(vt)),e}function E(){var e,r,n;return fi,e=fi,64===t.charCodeAt(fi)?(r=gt,fi++):(r=ge,0===gi&&s(yt)),r!==ge&&(n=x())!==ge?e=r=[r,n]:(fi=e,e=ge),e!==ge&&(e=bt(e)),e}function C(){var e;return(e=function(){var e,r,n,i;return e=fi,t.substr(fi,7).toLowerCase()===pn?(r=t.substr(fi,7),fi+=7):(r=ge,0===gi&&s(fn)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?(r=hn(),e=r):(fi=e,e=ge)):(fi=e,e=ge),e}())===ge&&(e=function(){var e,r,n,i;return e=fi,t.substr(fi,8).toLowerCase()===mn?(r=t.substr(fi,8),fi+=8):(r=ge,0===gi&&s(vn)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?(r=gn(),e=r):(fi=e,e=ge)):(fi=e,e=ge),e}())===ge&&(e=function(){var e,r,n,i;return e=fi,t.substr(fi,4).toLowerCase()===yn?(r=t.substr(fi,4),fi+=4):(r=ge,0===gi&&s(bn)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?(r=_n(),e=r):(fi=e,e=ge)):(fi=e,e=ge),e}()),e}function O(){var e;return(e=P())===ge&&(e=E()),e}function P(){var e,r,n,i,o;if(e=fi,39===t.charCodeAt(fi)?(r=Rt,fi++):(r=ge,0===gi&&s(Mt)),r===ge&&(t.substr(fi,2)===Dt?(r=Dt,fi+=2):(r=ge,0===gi&&s(Ft))),r!==ge){for(n=[],i=fi,t.substr(fi,2)===Lt?(o=Lt,fi+=2):(o=ge,0===gi&&s(Nt)),o!==ge&&(o=jt()),(i=o)===ge&&(Vt.test(t.charAt(fi))?(i=t.charAt(fi),fi++):(i=ge,0===gi&&s(Ut)));i!==ge;)n.push(i),i=fi,t.substr(fi,2)===Lt?(o=Lt,fi+=2):(o=ge,0===gi&&s(Nt)),o!==ge&&(o=jt()),(i=o)===ge&&(Vt.test(t.charAt(fi))?(i=t.charAt(fi),fi++):(i=ge,0===gi&&s(Ut)));n!==ge?(39===t.charCodeAt(fi)?(i=Rt,fi++):(i=ge,0===gi&&s(Mt)),i!==ge?e=r=Bt(n):(fi=e,e=ge)):(fi=e,e=ge)}else fi=e,e=ge;return e}function A(){var e,t,r;return e=fi,oe()!==ge&&de()!==ge&&(t=c())!==ge&&de()!==ge&&ae()!==ge&&de()!==ge&&(r=c())!==ge?e=qt(t,r):(fi=e,e=ge),e}function I(){var e,t,r;return e=fi,oe()!==ge&&de()!==ge&&(t=c())!==ge&&de()!==ge&&ae()!==ge&&de()!==ge&&(r=c())!==ge?e=qt(t,r):(fi=e,e=ge),e}function R(){var e,t;return e=fi,se()!==ge&&de()!==ge&&(t=c())!==ge?e=Wt(t):(fi=e,e=ge),e}function M(){var e,r,n;return(e=L())===ge&&(e=fi,45===t.charCodeAt(fi)?(r=et,fi++):(r=ge,0===gi&&s(tt)),r===ge&&(43===t.charCodeAt(fi)?(r=Ke,fi++):(r=ge,0===gi&&s($e))),r!==ge&&(n=L())!==ge?e=r=Kt(r,n):(fi=e,e=ge)),e}function D(){var e,r,n;return e=fi,46===t.charCodeAt(fi)?(r=$t,fi++):(r=ge,0===gi&&s(er)),r!==ge?((n=L())===ge&&(n=null),n!==ge?e=r=tr(n):(fi=e,e=ge)):(fi=e,e=ge),e}function F(){var e,t,r;return e=fi,(t=j())!==ge&&(r=L())!==ge?e=t=rr(t,r):(fi=e,e=ge),e}function L(){var e,t;if(fi,e=[],(t=N())!==ge)for(;t!==ge;)e.push(t),t=N();else e=ge;return e!==ge&&(e=nr(e)),e}function N(){var e;return ir.test(t.charAt(fi))?(e=t.charAt(fi),fi++):(e=ge,0===gi&&s(or)),e}function j(){var e,r,n;return e=fi,ar.test(t.charAt(fi))?(r=t.charAt(fi),fi++):(r=ge,0===gi&&s(sr)),r!==ge?(lr.test(t.charAt(fi))?(n=t.charAt(fi),fi++):(n=ge,0===gi&&s(ur)),n===ge&&(n=null),n!==ge?e=r=cr(r,n):(fi=e,e=ge)):(fi=e,e=ge),e}function V(){var e,r,n,i;return e=fi,t.substr(fi,4).toLowerCase()===dr?(r=t.substr(fi,4),fi+=4):(r=ge,0===gi&&s(pr)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?e=r=[r,n]:(fi=e,e=ge)):(fi=e,e=ge),e}function U(){var e,r,n,i;return e=fi,t.substr(fi,4).toLowerCase()===fr?(r=t.substr(fi,4),fi+=4):(r=ge,0===gi&&s(hr)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?e=r=[r,n]:(fi=e,e=ge)):(fi=e,e=ge),e}function B(){var e,r,n,i;return e=fi,t.substr(fi,5).toLowerCase()===mr?(r=t.substr(fi,5),fi+=5):(r=ge,0===gi&&s(vr)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?e=r=[r,n]:(fi=e,e=ge)):(fi=e,e=ge),e}function z(){var e,r,n,i;return e=fi,t.substr(fi,2).toLowerCase()===gr?(r=t.substr(fi,2),fi+=2):(r=ge,0===gi&&s(yr)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?e=r=br():(fi=e,e=ge)):(fi=e,e=ge),e}function k(){var e,r,n,i;return e=fi,t.substr(fi,2).toLowerCase()===_r?(r=t.substr(fi,2),fi+=2):(r=ge,0===gi&&s(xr)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?e=r=wr():(fi=e,e=ge)):(fi=e,e=ge),e}function G(){var e,r,n,i;return e=fi,t.substr(fi,4).toLowerCase()===Sr?(r=t.substr(fi,4),fi+=4):(r=ge,0===gi&&s(Tr)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?e=r=Er():(fi=e,e=ge)):(fi=e,e=ge),e}function H(){var e,r,n,i;return e=fi,t.substr(fi,6).toLowerCase()===Cr?(r=t.substr(fi,6),fi+=6):(r=ge,0===gi&&s(Or)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?e=r=Pr():(fi=e,e=ge)):(fi=e,e=ge),e}function q(){var e,r,n,i;return e=fi,t.substr(fi,3).toLowerCase()===Ar?(r=t.substr(fi,3),fi+=3):(r=ge,0===gi&&s(Ir)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?e=r=Rr():(fi=e,e=ge)):(fi=e,e=ge),e}function W(){var e,r,n,i;return e=fi,t.substr(fi,3).toLowerCase()===Mr?(r=t.substr(fi,3),fi+=3):(r=ge,0===gi&&s(Dr)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?e=r=Fr():(fi=e,e=ge)):(fi=e,e=ge),e}function X(){var e,r,n,i;return e=fi,t.substr(fi,2).toLowerCase()===Lr?(r=t.substr(fi,2),fi+=2):(r=ge,0===gi&&s(Nr)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?e=r=jr():(fi=e,e=ge)):(fi=e,e=ge),e}function Q(){var e,r,n,i;return e=fi,t.substr(fi,7).toLowerCase()===Vr?(r=t.substr(fi,7),fi+=7):(r=ge,0===gi&&s(Ur)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?e=r=Br():(fi=e,e=ge)):(fi=e,e=ge),e}function Y(){var e,r,n,i;return e=fi,t.substr(fi,4).toLowerCase()===zr?(r=t.substr(fi,4),fi+=4):(r=ge,0===gi&&s(kr)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?e=r=Gr():(fi=e,e=ge)):(fi=e,e=ge),e}function J(){var e,r,n,i;return e=fi,t.substr(fi,3).toLowerCase()===Hr?(r=t.substr(fi,3),fi+=3):(r=ge,0===gi&&s(qr)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?e=r=Wr():(fi=e,e=ge)):(fi=e,e=ge),e}function Z(){var e,r,n,i;return e=fi,t.substr(fi,9).toLowerCase()===Xr?(r=t.substr(fi,9),fi+=9):(r=ge,0===gi&&s(Qr)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?e=r=Yr():(fi=e,e=ge)):(fi=e,e=ge),e}function K(){var e,r,n,i;return e=fi,t.substr(fi,7).toLowerCase()===Jr?(r=t.substr(fi,7),fi+=7):(r=ge,0===gi&&s(Zr)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?e=r=Kr():(fi=e,e=ge)):(fi=e,e=ge),e}function $(){var e,r,n,i;return e=fi,t.substr(fi,4).toLowerCase()===$r?(r=t.substr(fi,4),fi+=4):(r=ge,0===gi&&s(en)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?e=r=tn():(fi=e,e=ge)):(fi=e,e=ge),e}function ee(){var e,r,n,i;return e=fi,t.substr(fi,8).toLowerCase()===rn?(r=t.substr(fi,8),fi+=8):(r=ge,0===gi&&s(nn)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?e=r=on():(fi=e,e=ge)):(fi=e,e=ge),e}function te(){var e,r,n,i;return e=fi,t.substr(fi,9).toLowerCase()===an?(r=t.substr(fi,9),fi+=9):(r=ge,0===gi&&s(sn)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?e=r=ln():(fi=e,e=ge)):(fi=e,e=ge),e}function re(){var e,r,n,i;return e=fi,t.substr(fi,4).toLowerCase()===un?(r=t.substr(fi,4),fi+=4):(r=ge,0===gi&&s(cn)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?e=r=dn():(fi=e,e=ge)):(fi=e,e=ge),e}function ne(){var e,r,n,i;return e=fi,t.substr(fi,4).toLowerCase()===Un?(r=t.substr(fi,4),fi+=4):(r=ge,0===gi&&s(Bn)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?e=r=zn():(fi=e,e=ge)):(fi=e,e=ge),e}function ie(){var e,r,n,i;return e=fi,t.substr(fi,3).toLowerCase()===kn?(r=t.substr(fi,3),fi+=3):(r=ge,0===gi&&s(Gn)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?e=r=Hn():(fi=e,e=ge)):(fi=e,e=ge),e}function oe(){var e,r,n,i;return e=fi,t.substr(fi,4).toLowerCase()===qn?(r=t.substr(fi,4),fi+=4):(r=ge,0===gi&&s(Wn)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?e=r=Xn():(fi=e,e=ge)):(fi=e,e=ge),e}function ae(){var e,r,n,i;return e=fi,t.substr(fi,4).toLowerCase()===Qn?(r=t.substr(fi,4),fi+=4):(r=ge,0===gi&&s(Yn)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?e=r=Jn():(fi=e,e=ge)):(fi=e,e=ge),e}function se(){var e,r,n,i;return e=fi,t.substr(fi,4).toLowerCase()===Zn?(r=t.substr(fi,4),fi+=4):(r=ge,0===gi&&s(Kn)),r!==ge?(n=fi,gi++,i=S(),gi--,i===ge?n=void 0:(fi=n,n=ge),n!==ge?e=r=$n():(fi=e,e=ge)):(fi=e,e=ge),e}function le(){var e;return 44===t.charCodeAt(fi)?(e=ei,fi++):(e=ge,0===gi&&s(ti)),e}function ue(){var e;return 40===t.charCodeAt(fi)?(e=ri,fi++):(e=ge,0===gi&&s(ni)),e}function ce(){var e;return 41===t.charCodeAt(fi)?(e=ii,fi++):(e=ge,0===gi&&s(oi)),e}function de(){var e,t;for(e=[],t=pe();t!==ge;)e.push(t),t=pe();return e}function pe(){var e;return ai.test(t.charAt(fi))?(e=t.charAt(fi),fi++):(e=ge,0===gi&&s(si)),e}function fe(){var e,r,n,i;if(e=fi,(r=x())!==ge&&(r=ut(r)),(e=r)===ge)if(e=fi,96===t.charCodeAt(fi)?(r=li,fi++):(r=ge,0===gi&&s(ui)),r!==ge){if(n=[],ci.test(t.charAt(fi))?(i=t.charAt(fi),fi++):(i=ge,0===gi&&s(di)),i!==ge)for(;i!==ge;)n.push(i),ci.test(t.charAt(fi))?(i=t.charAt(fi),fi++):(i=ge,0===gi&&s(di));else n=ge;n!==ge?(96===t.charCodeAt(fi)?(i=li,fi++):(i=ge,0===gi&&s(ui)),i!==ge?e=r=pi(n):(fi=e,e=ge)):(fi=e,e=ge)}else fi=e,e=ge;return e}function he(e,t,r,n){var i={type:"binary_expr",operator:e,left:t,right:r};return void 0!==n&&(i.escape=n),i}function me(e,t){for(var r=e,n=0;n<t.length;n++)r=he(t[n][1],r,t[n][3]);return r}r=void 0!==r?r:{};var ve,ge={},ye={start:l},be=l,_e=function(e){return e},xe=function(e,t){var r={type:"expr_list"},n=function(e,t,r){return function(e,t){for(var r=[e],n=0;n<t.length;n++)r.push(t[n][3]);return r}(e,t)}(e,t);return r.value=n,r},we=function(e,t){return me(e,t)},Se="!",Te=n("!",!1),Ee="=",Ce=n("=",!1),Oe=function(e){return function(e,t){return{type:"unary_expr",operator:e,expr:t}}("NOT",e)},Pe=function(e,t){return""==t||null==t||null==t?e:"arithmetic"==t.type?me(e,t.tail):he(t.op,e,t.right,t.escape)},Ae=function(e){return{type:"arithmetic",tail:e}},Ie=">=",Re=n(">=",!1),Me=">",De=n(">",!1),Fe="<=",Le=n("<=",!1),Ne="<>",je=n("<>",!1),Ve="<",Ue=n("<",!1),Be="!=",ze=n("!=",!1),ke=function(e,t){return{op:e+"NOT",right:t}},Ge=function(e,t){return{op:e,right:t}},He=function(e,t,r){return{op:"NOT"+e,right:{type:"expr_list",value:[t,r]}}},qe=function(e,t,r){return{op:e,right:{type:"expr_list",value:[t,r]}}},We=function(e){return e[0]+" "+e[2]},Xe=function(e,t,r){return{op:e,right:t,escape:r.value}},Qe=function(e,t){return{op:e,right:t,escape:""}},Ye=function(e,t){return{op:e,right:t}},Je=function(e){return{op:e,right:{type:"expr_list",value:[]}}},Ze=function(e,t){return{op:e,right:t}},Ke="+",$e=n("+",!1),et="-",tt=n("-",!1),rt=function(e,t){return me(e,t)},nt="*",it=n("*",!1),ot="/",at=n("/",!1),st=function(e){return e.paren=!0,e},lt=function(e){return{type:"column_ref",table:"",column:e}},ut=function(e){return e},ct=function(e,t){return e+t.join("")},dt=/^[A-Za-z_\x80-\uFFFF]/,pt=i([["A","Z"],["a","z"],"_",["","￿"]],!1,!1),ft=/^[A-Za-z0-9_]/,ht=i([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),mt=/^[A-Za-z0-9_.\x80-\uFFFF]/,vt=i([["A","Z"],["a","z"],["0","9"],"_",".",["","￿"]],!1,!1),gt="@",yt=n("@",!1),bt=function(e){return{type:"param",value:e[1]}},_t=function(e,t){return{type:"function",name:"extract",args:{type:"expr_list",value:[{type:"string",value:e},t]}}},xt=function(e,t,r){return{type:"function",name:"substring",args:{type:"expr_list",value:r?[e,t,r[2]]:[e,t]}}},wt=function(e,t,r){return{type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==e?"BOTH":e},t,r]}}},St=function(e,t){return{type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==e?"BOTH":e},t]}}},Tt=function(e,t){return{type:"function",name:"position",args:{type:"expr_list",value:[e,t]}}},Et=function(e,t){return{type:"function",name:e,args:t||{type:"expr_list",value:[]}}},Ct=function(e){return{type:"timestamp",value:e.value}},Ot=function(e){return{type:"date",value:e.value}},Pt=function(){return{type:"null",value:null}},At=function(){return{type:"bool",value:!0}},It=function(){return{type:"bool",value:!1}},Rt="'",Mt=n("'",!1),Dt="N'",Ft=n("N'",!1),Lt="''",Nt=n("''",!1),jt=function(){return"'"},Vt=/^[^']/,Ut=i(["'"],!0,!1),Bt=function(e){return{type:"string",value:e.join("")}},zt=function(e,t){return{type:"case_expression",format:"simple",operand:e,clauses:t,else:null}},kt=function(e,t,r){return{type:"case_expression",format:"simple",operand:e,clauses:t,else:r.value}},Gt=function(e){return{type:"case_expression",format:"searched",clauses:e,else:null}},Ht=function(e,t){return{type:"case_expression",format:"searched",clauses:e,else:t.value}},qt=function(e,t){return{type:"when_clause",operand:e,value:t}},Wt=function(e){return{type:"else_clause",value:e}},Xt=function(e){return{type:"number",value:e}},Qt=function(e,t,r){return parseFloat(e+t+r)},Yt=function(e,t){return parseFloat(e+t)},Jt=function(e,t){return parseFloat(e+t)},Zt=function(e){return parseFloat(e)},Kt=function(e,t){return e[0]+t},$t=".",er=n(".",!1),tr=function(e){return"."+(null!=e?e:"")},rr=function(e,t){return e+t},nr=function(e){return e.join("")},ir=/^[0-9]/,or=i([["0","9"]],!1,!1),ar=/^[eE]/,sr=i(["e","E"],!1,!1),lr=/^[+\-]/,ur=i(["+","-"],!1,!1),cr=function(e,t){return"e"+(null===t?"":t)},dr="null",pr=n("NULL",!0),fr="true",hr=n("TRUE",!0),mr="false",vr=n("FALSE",!0),gr="in",yr=n("IN",!0),br=function(){return"IN"},_r="is",xr=n("IS",!0),wr=function(){return"IS"},Sr="like",Tr=n("LIKE",!0),Er=function(){return"LIKE"},Cr="escape",Or=n("ESCAPE",!0),Pr=function(){return"ESCAPE"},Ar="not",Ir=n("NOT",!0),Rr=function(){return"NOT"},Mr="and",Dr=n("AND",!0),Fr=function(){return"AND"},Lr="or",Nr=n("OR",!0),jr=function(){return"OR"},Vr="between",Ur=n("BETWEEN",!0),Br=function(){return"BETWEEN"},zr="from",kr=n("FROM",!0),Gr=function(){return"FROM"},Hr="for",qr=n("FOR",!0),Wr=function(){return"FOR"},Xr="substring",Qr=n("SUBSTRING",!0),Yr=function(){return"SUBSTRING"},Jr="extract",Zr=n("EXTRACT",!0),Kr=function(){return"EXTRACT"},$r="trim",en=n("TRIM",!0),tn=function(){return"TRIM"},rn="position",nn=n("POSITION",!0),on=function(){return"POSITION"},an="timestamp",sn=n("TIMESTAMP",!0),ln=function(){return"TIMESTAMP"},un="date",cn=n("DATE",!0),dn=function(){return"DATE"},pn="leading",fn=n("LEADING",!0),hn=function(){return"LEADING"},mn="trailing",vn=n("TRAILING",!0),gn=function(){return"TRAILING"},yn="both",bn=n("BOTH",!0),_n=function(){return"BOTH"},xn="year",wn=n("YEAR",!0),Sn=function(){return"YEAR"},Tn="month",En=n("MONTH",!0),Cn=function(){return"MONTH"},On="day",Pn=n("DAY",!0),An=function(){return"DAY"},In="hour",Rn=n("HOUR",!0),Mn=function(){return"HOUR"},Dn="minute",Fn=n("MINUTE",!0),Ln=function(){return"MINUTE"},Nn="second",jn=n("SECOND",!0),Vn=function(){return"SECOND"},Un="case",Bn=n("CASE",!0),zn=function(){return"CASE"},kn="end",Gn=n("END",!0),Hn=function(){return"END"},qn="when",Wn=n("WHEN",!0),Xn=function(){return"WHEN"},Qn="then",Yn=n("THEN",!0),Jn=function(){return"THEN"},Zn="else",Kn=n("ELSE",!0),$n=function(){return"ELSE"},ei=",",ti=n(",",!1),ri="(",ni=n("(",!1),ii=")",oi=n(")",!1),ai=/^[ \t\n\r]/,si=i([" ","\t","\n","\r"],!1,!1),li="`",ui=n("`",!1),ci=/^[^`]/,di=i(["`"],!0,!1),pi=function(e){return e.join("")},fi=0,hi=[{line:1,column:1}],mi=0,vi=[],gi=0;if("startRule"in r){if(!(r.startRule in ye))throw new Error("Can't start parsing from rule \""+r.startRule+'".');be=ye[r.startRule]}if((ve=be())!==ge&&fi===t.length)return ve;throw ve!==ge&&fi<t.length&&s({type:"end"}),function(t,r,n){return new e(e.buildMessage(t,r),t,r,n)}(vi,mi<t.length?t.charAt(mi):null,mi<t.length?a(mi,mi+1):a(mi,mi))}}}.apply(null,[]))||(e.exports=n)},1274:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(344)],void 0===(i=function(e,t,r){function n(e){return void 0===e&&(e=t.UP),[e[0],e[1],e[2],e[3]]}function i(e,t,i){return void 0===i&&(i=n()),r.vec3d.set(t,i),i[3]=-r.vec3d.dot(t,e),i}function o(e,t,o,a){return void 0===a&&(a=n()),r.vec3d.cross(t,e,l),i(o,r.vec3d.normalize(l),a)}Object.defineProperty(t,"__esModule",{value:!0}),t.create=n,t.fromValues=function(e,t,r,i,o){return void 0===o&&(o=n()),o[0]=e,o[1]=t,o[2]=r,o[3]=i,o},t.fromNormalAndOffset=function(e,t,i){return void 0===i&&(i=n()),r.vec3d.set(e,i),i[3]=t,i},t.fromPositionAndNormal=i,t.projectVector=function(e,t,n){return void 0===n&&(n=t),r.vec3d.cross(e,r.vec3d.cross(t,e,s),n)},t.distance=function(e,t){return r.vec3d.dot(e,t)+e[3]},t.fromPoints=function(e,t,i,l){return void 0===l&&(l=n()),o(r.vec3d.subtract(e,t,a),r.vec3d.subtract(i,t,s),e,l)},t.set=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},t.negate=function(e,t){return void 0===t&&(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},t.fromVectorsAndPoint=o,t.intersectRay=function(e,t,n,i){var o=r.vec3d.dot(e,n);if(0===o)return!1;var a=-(r.vec3d.dot(e,t)+e[3])/o;return!(a<0||(r.vec3d.add(t,r.vec3d.scale(n,a,i),i),0))},t.UP=[0,0,1,0];var a=r.vec3d.create(),s=r.vec3d.create(),l=r.vec3d.create()}.apply(null,n))||(e.exports=i)},1275:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(344),r(1007)],void 0===(i=function(e,t,r,n){function i(e,t,n){var i=r.vec2d.dist(e,t),o=r.vec2d.dist(t,n),a=r.vec2d.dist(n,e),s=(i+o+a)/2;return Math.sqrt(s*(s-i)*(s-o)*(s-a))}Object.defineProperty(t,"__esModule",{value:!0}),t.create=function(e,t,n){return void 0===e&&(e=r.vec3d.create()),void 0===t&&(t=r.vec3d.create()),void 0===n&&(n=r.vec3d.create()),{p0:e,p1:t,p2:n}},t.distance2=function(e,t){var i=e.p0,f=e.p1,h=e.p2,m=r.vec3d.subtract(f,i,o),v=r.vec3d.subtract(h,f,a),g=r.vec3d.subtract(i,h,s),y=r.vec3d.subtract(t,i,l),b=r.vec3d.subtract(t,f,u),_=r.vec3d.subtract(t,h,c),x=r.vec3d.cross(m,g),w=r.vec3d.dot(r.vec3d.cross(m,x,d),y),S=r.vec3d.dot(r.vec3d.cross(v,x,d),b),T=r.vec3d.dot(r.vec3d.cross(g,x,d),_);if(w>0&&S>0&&T>0){var E=r.vec3d.dot(x,y);return E*E/r.vec3d.dot(x,x)}var C=n.distance2(n.fromOriginAndVector(i,m,p),t),O=n.distance2(n.fromOriginAndVector(f,v,p),t),P=n.distance2(n.fromOriginAndVector(h,g,p),t);return Math.min(C,O,P)},t.areaPoints2d=i,t.area2d=function(e){return i(e.p0,e.p1,e.p2)};var o=r.vec3d.create(),a=r.vec3d.create(),s=r.vec3d.create(),l=r.vec3d.create(),u=r.vec3d.create(),c=r.vec3d.create(),d=r.vec3d.create(),p=n.create()}.apply(null,n))||(e.exports=i)},1278:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(344),r(785),r(388)],void 0===(i=function(e,t,r,n,i){function o(e,t,i){var o,a,s,l=r.vec3d.create(),u=e[3],p=Math.ceil(Math.log(u)*Math.LOG2E/d),f=Math.pow(2,p*d+c);if(i.isGeographic){var h=f/n.earthRadius*180/Math.PI;a=Math.round(e[1]/h);var m=Math.max(-90,Math.min(90,a*h)),v=h/Math.cos((Math.abs(m)-h/2)/180*Math.PI),g=(o=Math.round(e[0]/v))*v;l[0]=g,l[1]=m}else o=Math.round(e[0]/f),a=Math.round(e[1]/f),l[0]=o*f,l[1]=a*f;var y=e[2]+t;return s=Math.round(y/f),l[2]=s*f,{center:l,id:p+"_"+o+"_"+a+"_"+s}}Object.defineProperty(t,"__esModule",{value:!0});var a=1e3,s=new Float64Array(3*a),l=r.vec3d.create(),u=r.mat4d.create();t.computeGlobalTransformation=function(e,t,n,a){var s=o(e,t,n).center,l=r.mat4d.create();return i.computeLinearTransformation(n,s,l,a),l},t.reprojectPoints=function(e,t,n,o,c,d,p){var f=e.data,h=e.offsetIdx,m=e.strideIdx;r.mat4d.inverse(n,u),r.vec3d.set(t,l),l[2]+=o;var v=[0,0,0],g=f.length/m;i.vectorToVector(l,c,v,d);for(var y=0;y<g;y+=a){for(var b=Math.min(a,g-y),_=0;_<b;_++){var x=h+m*(y+_);s[3*_]=f[x]+v[0],s[3*_+1]=f[x+1]+v[1],s[3*_+2]=f[x+2]+v[2]}for(i.bufferToBuffer(s,d,0,s,p,0,b),_=0;_<b;_++){var w=s[3*_],S=s[3*_+1],T=s[3*_+2],E=h+m*(y+_);f[E]=u[0]*w+u[4]*S+u[8]*T+u[12],f[E+1]=u[1]*w+u[5]*S+u[9]*T+u[13],f[E+2]=u[2]*w+u[6]*S+u[10]*T+u[14]}}},t.createOrigin=function(e,t,r,n){var a=o(e,t,r),s=a.center,l=a.id;return i.vectorToVector(s,r,s,n),{vec3:s,id:l}};var c=1,d=5-c}.apply(null,n))||(e.exports=i)},1283:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(380),r(449)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this._deferreds=[],this._values=[]}return e.prototype.push=function(e){var t=new r;return this._deferreds.push(t),this._values.push(e),t.promise},e.prototype.unshift=function(e){var t=new r;return this._deferreds.unshift(t),this._values.unshift(e),t.promise},e.prototype.length=function(){return this._deferreds.length},e.prototype.process=function(){this._deferreds.shift().resolve(this._values.shift())},e.prototype.cancelAll=function(){for(var e=new n,t=0,r=this._deferreds;t<r.length;t++)r[t].cancel(e);this._deferreds.length=0,this._values.length=0},e}();t.IdleQueue=i}.apply(null,n))||(e.exports=i)},1288:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(e,t,r){for(var n=0;n<r;++n)t[2*n]=e[n],t[2*n+1]=e[n]-t[2*n]}Object.defineProperty(t,"__esModule",{value:!0}),t.encodeDouble=function(e,t){i[0]=e,i[1]=e-i[0],t[0]=i[0],t[1]=i[1]},t.encodeDoubleArray=r,t.decodeDoubleArray=function(e,t,r){for(var n=0;n<r;++n)t[n]=e[2*n]+e[2*n+1]},t.encodeDoubleArraySplit=function(e,t,o,a){for(var s=0;s<a;++s)n[0]=e[s],r(n,i,1),t[s]=i[0],o[s]=i[1]};var n=new Float64Array(1),i=new Float32Array(2)}.apply(null,n))||(e.exports=i)},1296:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(338),r(336),r(404),r(398),r(449),r(362),r(384),r(382),r(358),r(354),r(695),r(339),r(343),r(340),r(454),r(460),r(374),r(443),r(337),r(389),r(442),r(752),r(1398),r(762),r(1035),r(418),r(746),r(726),r(406),r(1576),r(1577),r(1278),r(1410),r(780),r(1579),r(1050),r(984),r(776),r(1046),r(344),r(364),r(779),r(388),r(753),r(631),r(462),r(608),r(1047),r(699),r(808),r(709),r(349),r(809),r(641),r.dj.m(e)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,c,d,p,f,h,m,v,g,y,b,_,x,w,S,T,E,C,O,P,A,I,R,M,D,F,L,N,j,V,U,B,z,k,G,H,q,W,X,Q,Y,J,Z,K,$,ee,te,re){function ne(e){return W.isArrayBuffer(e.data)}function ie(e,t){return(0|e)+(0|t)|0}var oe=X.ModelContentType,ae=h.getLogger("esri.views.3d.layers.SceneLayerView3D"),se=[1,1,1,1],le=[.8,.8,.8],ue=[.5,.5,.5],ce=function(){return function(){}}(),de=10,pe=function(t){function s(){var e=null!==t&&t.apply(this,arguments)||this;return e._queryEngine=null,e._highlights=new R(e),e._elevationProvider=null,e._worker=new A,e._workerThread=null,e._texId2Meta=new Map,e._nodeId2Meta=new Map,e._rendererVersion=0,e._rendererFields=null,e._colorVariable=null,e._opacityVariable=null,e._symbolInfos=new Map,e._idbCache=new N.IDBCache("esri-scenelayer-cache","geometries",de),e._cancelCount=0,e._hasColors=!1,e._hasTextures=!1,e._hasData=!1,e.slicePlaneEnabled=!1,e.alwaysLoadEverythingModeEnabled=!1,e._cacheKeySuffix=null,e._definitionExpressionErrors=0,e._maxDefinitionExpressionErrors=20,e._tmpAttributeOnlyGraphic=new l(null,null,{}),e}return r(s,t),Object.defineProperty(s.prototype,"hasTexturesOrVertexColors",{get:function(){return this._hasData?this._hasTextures||this._hasColors?"yes":"probably-not":"unknown"},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"rendererNeedsTextures",{get:function(){return L.rendererNeedsTextures(this.layer.renderer)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"elevationOffset",{get:function(){var e=null!=this.layer?this.layer.elevationInfo:null;if(null!=e&&"absolute-height"===e.mode){var t=w.getMetersPerVerticalUnitForSR(this.layer.spatialReference),r=C.getMetersPerUnit(e.unit);return(e.offset||0)*r/t}return 0},enumerable:!0,configurable:!0}),s.prototype._enableSecretAlwayLoadMode=function(){this.layer.store.lodModel&&"always-load"===this.layer.store.lodModel&&(this.alwaysLoadEverythingModeEnabled=!0)},Object.defineProperty(s.prototype,"uncompressedTextureDownsamplingEnabled",{get:function(){return this.view.qualitySettings.sceneService.uncompressedTextureDownsamplingEnabled&&!this.useCompressedTextures},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"useCompressedTextures",{get:function(){var e=this.layer.version,t=!d("trident")||e.major>1||1===e.major&&e.minor>3;return this.view._stage.has("s3tc")&&t},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"_enableMipMaps",{get:function(){return!this.uncompressedTextureDownsamplingEnabled},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"_enableAtlasMipMaps",{get:function(){return this._enableMipMaps},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"_atlasBiasCompensationEnabled",{get:function(){return!this.view._stage.has("shaderTextureLOD")&&this._enableAtlasMipMaps},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"_disableAtlasAnisotropy",{get:function(){return this._atlasBiasCompensationEnabled},enumerable:!0,configurable:!0}),s.prototype.initialize=function(){var t=this;if(b.open(v.getAbsMid("./SceneLayerWorker",e,re),{client:this}).then(function(e){t.destroyed?e.close():t._workerThread=e}),L.checkSceneLayerValid(this.layer),L.checkSceneLayerCompatibleWithView(this.layer,this.view),this._controller=new T({layerView:this}),this.gpuMemoryEstimate=0,this.texMemoryEstimate=0,this.geoMemoryEstimate=0,this._stage=this.view._stage,this._isIntegratedMesh=this.layer instanceof S,this._isIntegratedMesh||!this.layer.store.defaultGeometrySchema)this._hasSymbolColors=!1;else{var r=this.layer.store.defaultGeometrySchema.featureAttributes;this._hasSymbolColors=!!(r&&r.faceRange&&r.id)}this._hasVertexColors=null!=this.layer.store.defaultGeometrySchema.vertexAttributes.color&&(null==this.layer.cachedDrawingInfo||!this.layer.cachedDrawingInfo.color),this._isIntegratedMesh||(this._edgeView=this._stage.view.getEdgeView()),this._memCache=this.view.resourceController.getMemCache(this.layer.uid,function(e){return t._deleteNodeStageData(e)}),this._addThisLayerToStage(),this._elevationProvider=new M({layerView:this,stageLayer:this._stageLayer}),this.handles.add([y.init(this.view,"clippingArea",function(){return t._clippingAreaChanged()}),y.init(this.layer,"renderer",function(e){return t._rendererChange(e)}),y.init(this.layer,"objectIdFilter",function(){return t._filterChange()}),y.init(this.layer,"rangeInfos",function(e){return t._rangeInfosChanged(e)}),y.init(this,"_controller.parsedDefinitionExpression",function(){return t._filterChange()}),y.watch(this,"fullOpacity",function(e){return t._opacityChange(e)}),y.watch(this,"slicePlaneEnabled",function(e){return t._slicePlaneEnabledChange(e)}),y.watch(this,"elevationOffset",function(e,r){return t._reloadAll(r)}),y.watch(this,["rendererNeedsTextures","uncompressedTextureDownsamplingEnabled"],function(){t._reloadAll(),t._memCache.clear()}),y.init(this,"suspended",function(e){return t._suspendedChange(e)})],"sceneLayerHandles"),this._idbCache.init().catch(function(e){ae.warn("Failed to initialize IndexedDB cache: "+e)}),this._cacheKeySuffix=L.getCacheKeySuffix(this.layer.spatialReference,this.view.renderSpatialReference),this._componentColorManager=this._hasSymbolColors?new ee.BufferManager(this._stage.view.renderingContext):null,this._enableSecretAlwayLoadMode()},s.prototype.destroy=function(){this.handles.remove("sceneLayerHandles"),this._workerThread&&(this._workerThread.close(),this._workerThread=null),this._removeAllNodeDataFromStage(),this._memCache.destroy(),this._memCache=null,this._removeThisLayerFromStage(),this._stage=null,this._idbCache&&(this._idbCache.destroy(),this._idbCache=null),null!=this._controller&&(this._controller.destroy(),this._controller=null),this._highlights.destroy(),this._texId2Meta=null,this._nodeId2Meta=null,this.emit("visible-geometry-changed"),this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle.remove(),this._visibleGeometryChangedSchedulerHandle=null)},s.prototype.canResume=function(){return this.inherited(arguments)&&(!this._controller||this._controller.rootNodeVisible)},s.prototype.isUpdating=function(){return!(!this._controller||!this._controller.updating)},s.prototype.memEstimateTextureAdded=function(e){var t=e.getEstimatedTexMemRequired();return this.gpuMemoryEstimate+=t,this.texMemoryEstimate+=t,t},s.prototype.memEstimateTextureRemoved=function(e){var t=e.getEstimatedTexMemRequired();this.gpuMemoryEstimate-=t,this.texMemoryEstimate-=t},s.prototype.memEstimateGeometryAdded=function(e){var t=e.estimateGpuMemoryUsage();return this.gpuMemoryEstimate+=t,this.geoMemoryEstimate+=t,t},s.prototype.memEstimateGeometryRemoved=function(e){var t=e.estimateGpuMemoryUsage();this.gpuMemoryEstimate-=t,this.geoMemoryEstimate-=t},s.prototype.isNodeLoaded=function(e){return this._nodeId2Meta.has(e.id)},s.prototype.getUsedMemory=function(){var e=0;return this._nodeId2Meta.forEach(function(t){return e+=t.node.memory}),e},s.prototype.getUnloadedMemory=function(){return this._controller?this._controller.getUnloadedMemoryEstimate():0},s.prototype._suspendedChange=function(e){if(e)this._removeAllNodeDataFromStage(),this.view.elevationProvider.unregister(this._elevationProvider);else{var t=this._isIntegratedMesh?"im":"scene";this.view.elevationProvider.register(t,this._elevationProvider)}},s.prototype.getStats=function(){var e={index:0,nodes:this._nodeId2Meta.size.toString(),textures:this._texId2Meta.size,"Total GPU Memory Estimate":(this.gpuMemoryEstimate/1048576).toFixed(1)+"MB","Geometry Memory Estimate":(this.geoMemoryEstimate/1048576).toFixed(1)+"MB","Texture Memory Estimate":(this.texMemoryEstimate/1048576).toFixed(1)+"MB"};return this._controller&&(this._cachingEnabled()&&(e.IDBCache=Math.round(100*this._idbCache.getHitRate())+"% hit"),this._controller.updateStats(e)),e},s.prototype._addThisLayerToStage=function(){for(var e=this._stage,t=new Uint8Array(256),r=0;r<t.length;r++)t[r]=255;this._whiteTexture=new K(t,"white",{width:8,height:8}),e.add(oe.TEXTURE,this._whiteTexture);var n=this.layer.id,i=new Y(n,{},n);this._stageLayer=i,e.add(oe.LAYER,i),this._stage.addToViewContent([i.id])},s.prototype._removeThisLayerFromStage=function(){if(null!=this._stageLayer){var e=this._stage;e.remove(oe.TEXTURE,this._whiteTexture.id),this._removeAllNodeDataFromStage(),$.assert(0===this._nodeId2Meta.size),$.assert(0===this._texId2Meta.size),e.remove(oe.LAYER,this._stageLayer.id),this._stageLayer=void 0,this.gpuMemoryEstimate=0}},s.prototype.getLoadedAttributes=function(e){var t=this._nodeId2Meta.get(e.id);if(t)return t.loadedAttributes},s.prototype.getAttributeData=function(e){var t=this._nodeId2Meta.get(e.id);if(t)return t.attributeData},s.prototype.setAttributeData=function(e,t,r){var n=this._nodeId2Meta.get(e.id);n&&(n.loadedAttributes=t,n.attributeData=r,n.cachedRendererVersion=this._getInvalidRendererVersion(),this._updateEngineObject(e,n))},s.prototype.getLoadedNodeIDs=function(){return u.keysOfMap(this._nodeId2Meta)},s.prototype._calcEngineMaterialTransparencyParams=function(e,t,r){var n=this.fullOpacity,i=1-k.clamp($.fallbackIfUndefined(t.transparency,0),0,1);return{opacity:i,layerOpacity:n,transparent:i<1||n<1||e&&f.endsWith(e.channels,"a")||!0===t.useVertexColorAlpha||r}},s.prototype._calcEngineMaterialDoubleSidedParams=function(e){return null==e.doubleSided||e.doubleSided},s.prototype._calcEngineMaterialCullFaceParams=function(e){return e.cullFace?e.cullFace:null!=e.doubleSided?e.doubleSided?"none":"back":"none"},s.prototype._getMaterialParameters=function(e,t,r,n){var i;if(null!=e){var o=this._texId2Meta.get(t);i=o&&o.engineTex?o.engineTex.id:this._whiteTexture.id}var a=r.params,s=$.fallbackIfUndefined(a.diffuse,le);"standard"!==r.type&&ae.warn("Unknown material type '"+r.type+"', must be 'standard'");var l=this._isIntegratedMesh,u={ambient:s,diffuse:s,specular:$.fallbackIfUndefined(a.specular,ue),atlasRegions:a.vertexRegions,textureId:i,vertexColors:this._hasVertexColors,componentIndices:this._hasSymbolColors,componentColorBuffer:this._hasSymbolColors&&n?n.textureBuffer:null,flipV:!1,doubleSided:this._calcEngineMaterialDoubleSidedParams(a),cullFace:this._calcEngineMaterialCullFaceParams(a),writeStencil:l,receiveSSAO:!l,groundNormalShading:l,compressedNormals:!l,slicePlaneEnabled:this.slicePlaneEnabled};if(!l){var c=this._calcEngineMaterialTransparencyParams(e,a);f.mixin(u,c)}return u},s.prototype._createEngineMaterial=function(e,t,r,n,i,o,a){var s=null==t?null:this._getI3STexEncoding(t),l=this._getMaterialParameters(t,r,n,a),u=new te(l,i);if(u.metadata={i3sMatId:i,i3sTexId:r,i3sTex:t,i3sMatParams:n.params},null!=t){var c=this._texId2Meta.get(r);c?c.usedByEngineMats.push(u):(c={id:r,usedByEngineMats:[u],images:t.images,encoding:s,atlas:!0===t.atlas,wrap:"none"!==t.wrap[0]||"none"!==t.wrap[1]},this._texId2Meta.set(r,c));var d=function(e,t){for(var r=0,n=e;r<n.length;r++){var i=n[r];if(i.i3sTexId===t)return i.data}return null}(o,r);if(null!=d&&null==c.engineTex){var p=function(e,t,r,n,i){var o,a=!1;t.encoding===L.DDS_ENCODING_STRING?o=K.DDS_ENCODING:a=!(k.isPowerOfTwo(e.width)&&k.isPowerOfTwo(e.height));var s=t.usedByEngineMats.some(function(e){return e.getParams().atlasRegions})||t.atlas,l=(s?n:r)&&!a;return{mipmap:l,wrapClamp:s||!t.wrap,disableAnisotropy:s&&l&&i,encoding:o,noUnpackFlip:!0}}(d,c,this._enableMipMaps,this._enableAtlasMipMaps,this._disableAtlasAnisotropy);c.engineTex=new K(d,c.id,p),this._stage.add(oe.TEXTURE,c.engineTex),e.memory+=this.memEstimateTextureAdded(c.engineTex)}if(null!=c.engineTex)for(var f=c.engineTex.id,h=0,m=c.usedByEngineMats;h<m.length;h++){m[h].setParameterValues({textureId:f})}}return u},s.prototype._getI3STexEncoding=function(e){var t=L.getAppropriateTextureEncoding(e.encoding,this.useCompressedTextures);return t>-1?e.encoding[t]:e.encoding},s.prototype._getVertexBufferLayout=function(e,t){var r=e.params.materialID,n=t.materialDefinitions[r];$.assert(void 0!==n,"geometry wants unknown material "+r);var i,o=e.params.textureID||"none";"none"!==o&&(null!=t.textureDefinitions&&null!=t.textureDefinitions[o]||ae.warn("textureDefinitions missing in shared resource"),i=t.textureDefinitions[o]);var a=this._getMaterialParameters(i,o,n);return q.glLayout(te.getVertexBufferLayout(a))},s.prototype._createEngineMat=function(e,t,r,n,i){var o=t.params.materialID,a=r.materialDefinitions[o];$.assert(void 0!==a,"geometry wants unknown material "+o);var s,l=t.params.textureID||"none";return"none"!==l&&(null!=r.textureDefinitions&&null!=r.textureDefinitions[l]||ae.warn("textureDefinitions missing in shared resource"),s=r.textureDefinitions[l]),this._createEngineMaterial(e,s,l,a,o,n,i)},s.prototype._getObjectIdField=function(){return this.layer.objectIdField||"OBJECTID"},s.prototype._findGraphicNodeAndIndex=function(e){var t=j.attributeLookup(e.attributes,this._getObjectIdField()),r=null;return p.everyMap(this._nodeId2Meta,function(e,n){var i=e.featureIds.indexOf(t);return-1===i||(r={node:e.node,index:i},!1)}),r},s.prototype._getGraphicIndices=function(e,t){var r=this._nodeId2Meta.get(e.id);if(!r)return[];for(var n=[],i=this._getObjectIdField(),o=0,a=t;o<a.length;o++){var s=a[o],l=j.attributeLookup(s.attributes,i),u=r.featureIds.indexOf(l);-1!==u&&n.push(u)}return n},s.prototype.whenGraphicBounds=function(e){var t=this._findGraphicNodeAndIndex(e);if(!t)return m.reject();var r=this._nodeId2Meta.get(t.node.id).engineObject,n=this._boundingBoxCornerPoints(t.index,r,new Float64Array(24));if(H.bufferToBuffer(n,this.view.renderSpatialReference,0,n,this.view.spatialReference,0,8)){var i=x.empty();return x.expandWithBuffer(i,n,0,8),m.resolve({boundingBox:i,screenSpaceObjects:[]})}},s.prototype.whenGraphicAttributes=function(e,t){var r=this;return L.whenGraphicAttributes(this.layer,[e],this._getObjectIdField(),t,function(){var t=r._findGraphicNodeAndIndex(e);return{node:t.node,indices:[t.index]}},{ignoreUnavailableFields:!0,populateObjectId:!0}).then(function(e){return e[0]})},s.prototype.getGraphicFromStageObject=function(e,t){if(this.layer instanceof S)return m.reject();var r=this._getMetadata(e),n=e.getComponentFromTriangleNr(0,t);if(null!=n&&null!=r.featureIds&&n<r.featureIds.length){var i=this._createGraphic(n,r);return m.resolve(i)}return m.reject()},s.prototype._getMetadata=function(e){var t=e.getMetadata();return this._nodeId2Meta.get(t.i3sNode)},s.prototype._getCacheKey=function(e){return e.baseUrl+this._cacheKeySuffix},s.prototype._getMemCacheKey=function(e,t){return void 0===t&&(t=this.elevationOffset),e+"#"+t},s.prototype._cachingEnabled=function(){return!this._controller.disableCache&&0===this.elevationOffset&&null!=this._cacheKeySuffix},s.prototype.additionalCancelNodeLoadingHandler=function(){this._cancelCount=ie(this._cancelCount,1)},s.prototype._handleCancelled=function(e){if(ie(this._cancelCount,-e)>0)throw new a},s.prototype.loadCachedGPUData=function(e){return this._memCache.pop(this._getMemCacheKey(e.id))},s.prototype.loadCachedNodeData=function(e,t){var r=this,n=this._cancelCount;return this._cachingEnabled()?this._idbCache.get(this._getCacheKey(e)).then(function(i){if(null==i)return null;if(r._handleCancelled(n),i.nodeVersion!==e.version)return r._idbCache.remove(r._getCacheKey(e)),null;e.obb||(e.obb=G.clone(i.nodeObb),r._controller.updateVisibility(e.id));return r.rendererNeedsTextures&&i.textureData.some(function(e){if(null==e.data)return!0;var t=i.sharedResource.textureDefinitions[e.i3sTexId],n=r._getI3STexEncoding(t);return e.encoding!==n})?t(i.allGeometryData,i.sharedResource).then(function(t){return i.textureData=t,t.every(ne)&&r._idbCache.put(r._getCacheKey(e),i).catch(function(t){t&&"indexedb:not-initialized"===t.name||ae.warn("Failed to update node with textures in IndexedDB cache: "+e.id+": "+t)}),r._handleCancelled(n),i}):i}):m.resolve(null)},s.prototype.addNodeData=function(e,t){var r=this;return this._transformBundle(e,t).then(function(t){return r._controller.reschedule(e.id,t)}).then(function(n){e.obb||(e.obb=n.obb,r._controller.updateVisibility(e.id));var i={allGeometryData:t.allGeometryData,transformedGeometries:n.transformedGeometries,textureData:t.textureData,sharedResource:t.sharedResource,nodeVersion:e.version,nodeObb:e.obb,byteSize:function(e,t){for(var r=1024,n=0,i=e;n<i.length;n++){var o=i[n];r+=o.interleavedVertexData.byteLength+(o.indices?o.indices.byteLength:0),r+=o.positionData.data.byteLength+o.positionData.indices.byteLength}for(var a=0,s=t;a<s.length;a++){var l=s[a];W.isArrayBuffer(l.data)&&(r+=l.data.byteLength)}return r}(n.transformedGeometries,t.textureData)};if(r._cachingEnabled()){var o=i.textureData.map(function(e){return ne(e)?e:{i3sTexId:e.i3sTexId,encoding:e.encoding,data:null}});r._idbCache.put(r._getCacheKey(e),{allGeometryData:i.allGeometryData,transformedGeometries:i.transformedGeometries,textureData:o,sharedResource:i.sharedResource,nodeVersion:i.nodeVersion,nodeObb:i.nodeObb,byteSize:i.byteSize}).catch(function(t){return ae.warn("Failed to store node in IndexedDB cache: "+e.id+": "+t)})}return r.addCachedNodeData(e,i,t.attributeDataInfo)})},s.prototype._transformBundle=function(e,t){for(var r=this,n=[],i=[t.geometryBuffer],o=0,a=t.allGeometryData;o<a.length;o++)for(var s=0,l=a[o].geometries;s<l.length;s++){var u=l[s];n.push(this._getVertexBufferLayout(u,t.sharedResource))}var c={geometryBuffer:t.geometryBuffer,geometryData:t.allGeometryData,layouts:n,mbs:e.mbs,obb:e.obb,elevationOffset:this.elevationOffset,needNormals:!this._isIntegratedMesh&&this._controller.isMeshPyramid,normalReferenceFrame:this.layer.normalReferenceFrame||"none",indexSR:this._controller.crsIndex.toJSON(),vertexSR:this._controller.crsVertex.toJSON(),renderSR:this.view.renderSpatialReference.toJSON()};return this._workerThread?this._workerThread.invoke("process",c,i):this._controller.reschedule(e.id,c).then(function(e){return r._worker.transform(e)})},s.prototype.addCachedGPUData=function(e,t,r){return this.alwaysLoadEverythingModeEnabled||this._controller.isGeometryVisible(e)?(t.attributeData=r?r.attributeData:null,t.loadedAttributes=r?r.loadedAttributes:null,this._nodeId2Meta.set(e.id,t),t.engineObject.setHidden(t.engineObject.geometryRecords[0],!1),this._updateEngineObject(e,t),this._highlights.objectCreated(t.engineObject),m.resolve()):(this._memCache.put(this._getMemCacheKey(e.id),t,e.memory),m.resolve())},s.prototype.addCachedNodeData=function(e,t,r){var n=this;if(this._nodeId2Meta.has(e.id))return this._addOrUpdateEdgeRendering(this._nodeId2Meta.get(e.id)),this._applyFilters(e),m.resolve();if(this.suspended||!this.alwaysLoadEverythingModeEnabled&&!this._controller.isGeometryVisible(e))return m.resolve();var i=t.allGeometryData,o=t.transformedGeometries,a=t.textureData,s=t.sharedResource;if(0===i.length)return m.resolve();if(1!==i.length&&console.warn("Node with",i.length,"geometries is unsupported"),!this.rendererNeedsTextures)for(var l=0,u=a;l<u.length;l++){u[l].data=null}var c={};c[oe.OBJECT]={},c[oe.GEOMETRY]={},c[oe.MATERIAL]={};var d=0,p=!1;e.memory=0;var f=i[0],h=f.componentOffsets,v=f.geometries,g=f.featureIds,y=null,b=null;if(this._hasSymbolColors){y=this._componentColorManager.getBuffer(g.length),b=new Uint16Array(g.length);for(var _=0;_<g.length;_++)b[_]=y.aquireIndex()}for(var x,w=e.id+"|"+g[0],S=[],T=[],E=[],C=[],O=0,P=v;O<P.length;O++){var A=P[O],I=this._createEngineMat(e,A,s,a,y),R=o[d++];x=R.corMatrices.globalTrafo,p=p||R.hasColors;var M=new Z(new Float32Array(R.interleavedVertexData),R.layout,R.positionData,h||Z.DefaultOffsets,R.indices||Z.DefaultIndices,!0);this._hasSymbolColors&&this._setComponentIndices(M,b);var F=null!=A.transformation?z.mat4d.create(A.transformation):z.mat4d.identity(),L=S.length,N=new Q(M,w+(L>0?"_"+L:""));S.push(N),E.push(F),C.push([I]),T.push(D.createOrigin(e.mbs,this.elevationOffset,this._controller.crsIndex,this.view.renderSpatialReference)),e.memory+=this.memEstimateGeometryAdded(N.data),c[oe.MATERIAL][I.id]=I,c[oe.GEOMETRY][N.id]=N}var j={i3sNode:e.id,layerUid:this.layer.uid},V=new J({idHint:e.id,name:w,geometries:S,materials:C,transformations:E,origins:T,castShadow:!0,metadata:j});V.setObjectTransformation(x),c[oe.OBJECT][V.id]=V;var U=new ce;return U.node=e,U.engineObject=V,U.featureIds=g,U.attributeData=r?r.attributeData:null,U.loadedAttributes=r?r.loadedAttributes:null,U.componentColorBuffer=y,U.componentIndices=b,U.cachedRendererVersion=this._getInvalidRendererVersion(),U.cachedSymbolInfos=[],!this._hasTextures&&null!=e.textureData&&e.textureData.length>0&&(this._hasTextures=!0),this._hasColors||(this._hasColors=p),this._hasData=!0,this.notifyChange("hasTexturesOrVertexColors"),m.create(function(t){n._addOrUpdateEdgeRendering(U).then(function(){if(n._nodeId2Meta.has(e.id))return n._edgeView&&n._edgeView.removeObject(U.engineObject),t();var r=n._stageLayer,i=n._stage,o=c[oe.OBJECT];for(var a in o)o.hasOwnProperty(a)&&r.addObject(o[a]);for(var s in c)if(c.hasOwnProperty(s)){var l=c[s];for(var u in l)l.hasOwnProperty(u)&&null==i.get(s,u)&&i.add(s,l[u])}if(n._nodeId2Meta.set(e.id,U),n.suspended)return n._removeNodeStageData(e.id),t();n._setObjectSymbology(U),n._applyFilters(e),n._highlights.objectCreated(V),n.visibleGeometryChanged(V),t()})})},s.prototype._clippingAreaChanged=function(){var e=this,t=x.create();H.extentToBoundingBox(this.view.clippingArea,t,this.view.renderSpatialReference)?this._clippingArea=t:this._clippingArea=null,this._updateFilters(),this._nodeId2Meta.forEach(function(t){return e._applyFilters(t.node)}),this._controller&&this._controller.updateClippingArea(this.view.clippingArea)},s.prototype._filterChange=function(){var e=this;this._updateFilters(),this._nodeId2Meta.forEach(function(t){return e._applyFilters(t.node)})},s.prototype._updateFilters=function(){var e=this,t=[];if(this.layer.objectIdFilter){var r=new Float64Array(this.layer.objectIdFilter.ids),n="include"===this.layer.objectIdFilter.method;r.sort(),t.push(function(t,i){return e._objectIdFilter(r,n,i)})}if(this._controller&&this._controller.parsedDefinitionExpression&&this._controller.definitionExpressionFields){this._definitionExpressionErrors=0;var i=this._controller.parsedDefinitionExpression,o=this._controller.definitionExpressionFields;t.push(function(t,r){return e._sqlFilter(t,i,o,r)})}this._clippingArea&&t.push(function(t,r){return e._boundingboxFilter(t,e._clippingArea,r)}),this._filters=t},s.prototype._sqlFilter=function(e,t,r,n){var i={},o=new l(null,null,i);o.layer=this.layer,o.sourceLayer=this.layer;for(var a=this.layer.objectIdField,s=0,u=0,c=this._nodeId2Meta.get(e.id),d=c.featureIds,p=c.attributeData,f=r.every(function(e){return null!=p[e]||e===a}),h=0;h<d.length&&s<n.length;h++)if(n[s]===d[h]){var m=!0;if(f){i[a]=d[h];for(var v=0,g=r;v<g.length;v++){var y=g[v];y!==a&&(i[y]=L.getCachedAttributeValue(p[y],h))}m=this._evaluateClause(t,o)}m&&(n[u]=n[s],u++),s++}n.length=u},s.prototype._evaluateClause=function(e,t){try{return e.testFeature(t)}catch(e){return this._definitionExpressionErrors<this._maxDefinitionExpressionErrors&&ae.error("Error while evaluating definitionExpression: "+e),this._definitionExpressionErrors++,this._definitionExpressionErrors===this._maxDefinitionExpressionErrors&&ae.error("Further errors are ignored"),!1}},s.prototype._objectIdFilter=function(e,t,r){for(var n=0,i=0;n<r.length;)u.binaryIndexOf(e,r[n])>=0===t&&(r[i]=r[n],i++),n++;r.length=i},s.prototype._boundingboxFilter=function(e,t,r){var n=[0,0,0,0];H.mbsToMbs(e.mbs,this._controller.crsIndex,n,this.view.renderSpatialReference);var i=null!=t?L.intersectBoundingBoxWithMbs(t,n):2;if(2!==i){if(0===i)return void(r.length=0);var o=0,a=0,s=this._nodeId2Meta.get(e.id),l=s.featureIds,u=s.engineObject.getObjectTransformation(),c=s.engineObject.getGeometryRecords()[0].getShaderTransformation();if(z.mat4d.multiply(u,c),0===u[1]&&0===u[2]&&0===u[3]&&0===u[4]&&0===u[6]&&0===u[7]&&0===u[8]&&0===u[9]&&0===u[11]&&1===u[15]){var d=he;d[0]=(t[0]-u[12])/u[0],d[1]=(t[1]-u[13])/u[5],d[2]=(t[2]-u[14])/u[10],d[3]=(t[3]-u[12])/u[0],d[4]=(t[4]-u[13])/u[5],d[5]=(t[5]-u[14])/u[10];for(var p=s.engineObject.getGeometryRecords()[0].geometry,f=p.componentCount,h=0;h<f&&o<r.length;h++)if(r[o]===l[h]){var m=p.getComponentAABB(h,me);x.intersects(d,m)&&(r[a]=r[o],a++),o++}r.length=a}}},s.prototype._addOrUpdateEdgeRendering=function(e){return i(this,void 0,void 0,function(){var t,r,n,i,a,s;return o(this,function(o){switch(o.label){case 0:return this._edgeView?(t=e.engineObject,r=this._edgeView.hasObject(t),n=this._extractObjectEdgeMaterials(e),i=n.hasEdges,a=n.perFeatureEdgeMaterials,i?(s=!t.isHidden(t.geometryRecords[0]),r?(this._edgeView.updateAllComponentMaterials(t,a),this._edgeView.updateObjectVisibility(t,s),[3,3]):[3,1]):[3,4]):[2];case 1:return s?[4,this._edgeView.addObject(t,a)]:[3,3];case 2:o.sent(),o.label=3;case 3:return[3,5];case 4:r&&this._edgeView.removeObject(t),o.label=5;case 5:return[2]}})})},s.prototype._applyFilters=function(e){var t=this._nodeId2Meta.get(e.id);t&&(this._applyFiltersToObjects(e,t),this._updateEdgeRendering(t))},s.prototype._applyFiltersToObjects=function(e,t){var r=t.engineObject;if(r.unhideAllComponents(),0!==this._filters.length){for(var n=t.featureIds,i=n.slice(),o=0,a=this._filters;o<a.length;o++)(0,a[o])(e,i);if(i.length!==n.length)for(var s=0,l=r.getGeometryRecords()[0],u=0;u<n.length;u++){var c=n[u];s>=i.length||i[s]!==c?r.setComponentVisibility(l,u,!1):s++}}},s.prototype._removeAllNodeDataFromStage=function(e){var t=this;void 0===e&&(e=this.elevationOffset),this._nodeId2Meta.forEach(function(r,n){return t._removeNodeStageData(n,e)})},s.prototype.removeNodeData=function(e){var t=this;e.forEach(function(e){return t._removeNodeStageData(e.id)})},s.prototype._removeNodeStageData=function(e,t){void 0===t&&(t=this.elevationOffset);var r=this._nodeId2Meta.get(e);if(r){var n=r.engineObject;n.setHidden(n.geometryRecords[0],!0),this.visibleGeometryChanged(n),this._addOrUpdateEdgeRendering(r),this._nodeId2Meta.delete(e),this._highlights.objectDeleted(n),this._memCache.put(this._getMemCacheKey(e,t),r,r.node.memory)}},s.prototype._deleteNodeStageData=function(e){var t=this._stage,r=this._stageLayer,n=e.engineObject;this._edgeView&&this._edgeView.removeObject(n),r.removeObject(n);for(var i=0,o=n.getGeometryRecords();i<o.length;i++){var a=o[i];this.memEstimateGeometryRemoved(a.geometry.data),t.remove(oe.GEOMETRY,a.geometry.id);for(var s=0,l=a.materials;s<l.length;s++){var u=l[s];this._removeMaterial(u,t)}}if(e.componentIndices){for(var c=0;c<e.componentIndices.length;c++)e.componentColorBuffer.releaseIndex(e.componentIndices[c]);this._componentColorManager.garbageCollect()}t.remove(oe.OBJECT,n.id)},s.prototype._removeMaterial=function(e,t){t.remove(oe.MATERIAL,e.id);var r=e.metadata.i3sTexId;if(r){var n=this._texId2Meta.get(r);if(n){var i=n.usedByEngineMats;if(u.removeUnordered(i,e)||ae.error("Missing reference from material to texture"),0===i.length){var o=n.engineTex;o&&o!==this._whiteTexture&&(this.memEstimateTextureRemoved(o),t.remove(oe.TEXTURE,n.engineTex.id)),this._texId2Meta.delete(r)}}}},s.prototype.setPolygonOffset=function(e,t){var r=this._nodeId2Meta.get(e.id);if(r)for(var n=0,i=r.engineObject.getGeometryRecords();n<i.length;n++)for(var o=0,a=i[n].materials;o<a.length;o++){a[o].setParameterValues({polygonOffset:t})}},s.prototype._getInvalidRendererVersion=function(){return ie(this._rendererVersion,-1)},s.prototype._rendererChange=function(e){if(this._currentRenderer=e,this._rendererVersion=ie(this._rendererVersion,1),this._rendererFields=null,this._colorVariable=null,this._opacityVariable=null,e&&e.requiredFields&&(this._rendererFields=L.findFieldsCaseInsensitive(e.requiredFields,this.layer.fields)),e&&e.visualVariables)for(var t=0,r=e.visualVariables;t<r.length;t++){var n=r[t];"color"===n.type?this._colorVariable=n:"opacity"===n.type?this._opacityVariable=n:ae.warn("Unsupported visual variable type for 3D Object Scene Services: "+n.type)}if(e&&(e.colorInfo||e.sizeInfo)&&ae.warn("renderer.colorInfo and renderer.sizeInfo are not supported for 3D Object Scene Services. Use visualVariables instead."),e)for(var i=0,o=e.getSymbols();i<o.length;i++){var a=o[i];"mesh-3d"!==a.type&&ae.error("Symbols of type '"+a.type+"' are not supported for 3D Object Scene Services.")}this.view.resourceController.setMemoryDirty()},s.prototype._getSymbolInfos=function(e){return this._hasSymbolColors&&e.cachedRendererVersion!==this._rendererVersion&&this._updateCachedRendererData(e),e.cachedSymbolInfos},s.prototype._getSymbolColors=function(e){return this._hasSymbolColors&&e.cachedRendererVersion!==this._rendererVersion&&this._updateCachedRendererData(e),e.cachedSymbolColors},s.prototype._updateCachedRendererData=function(e){if(e.cachedRendererVersion=this._rendererVersion,this._hasSymbolColors){var t=e.featureIds?e.featureIds.length:1,r={},n=this._tmpAttributeOnlyGraphic;n.attributes=r;for(var i=this._currentRenderer,o=null!=e.featureIds?this.layer.objectIdField:null,a=null!=e.attributeData?this._rendererFields:null,s=0;s<t;s++){if(null!=o&&(r[o]=e.featureIds[s]),null!=a)for(var l=0,u=a;l<u.length;l++){var c=u[l];e.attributeData[c]&&(r[c]=L.getCachedAttributeValue(e.attributeData[c],s))}var d=i&&i.getSymbol(n),p=null;d instanceof E&&(this._symbolInfos.has(d.id)||this._symbolInfos.set(d.id,L.getSymbolInfo(d)),p=this._symbolInfos.get(d.id)),e.cachedSymbolInfos[s]=p,null==e.cachedSymbolColors&&(e.cachedSymbolColors=new Uint8Array(4*e.featureIds.length));var f=null,h=null;if(this._colorVariable){var m=i.getColor(n,{colorInfo:this._colorVariable,color:ge});m&&((f=ve)[0]=m.r/255,f[1]=m.g/255,f[2]=m.b/255,this._opacityVariable||null===m.a||(h=m.a))}if(this._opacityVariable&&(h=i.getOpacity(n,{opacityInfo:this._opacityVariable})),p&&p.material){var v=p.material;f=null==f||null==h?I.overrideColor(f,h,v.color,v.alpha,se,ve):I.overrideColor(f,h,null,null,se,ve),B.encodeSymbolColor(f,v.colorMixMode,e.cachedSymbolColors,4*s)}else B.encodeSymbolColor(null,null,e.cachedSymbolColors,4*s)}}},s.prototype._extractObjectEdgeMaterials=function(e){for(var t=[],r=e.engineObject,n=e.featureIds?e.featureIds.length:1,i=this._edgeView.createSolidEdgeMaterial({color:[0,0,0,0],opacity:0}),o={opacity:this.fullOpacity,slicePlaneEnabled:this.slicePlaneEnabled},a=!1,s=null,l=null,u=this._getSymbolInfos(e),c=0;c<n;c++){var d=u[c];r.getComponentVisibility(r.getGeometryRecords()[0],c)&&d?(l!==d&&(l=d,(s=V.createMaterialFromEdges(this._edgeView,d.edges,o))&&(a=!0)),t.push(null!=s?s:i)):t.push(i)}return{hasEdges:a,perFeatureEdgeMaterials:t}},s.prototype._setObjectSymbology=function(e){if(this._hasSymbolColors){for(var t=e.featureIds?e.featureIds.length:1,r=!1,n=this._getSymbolColors(e),i=e.componentColorBuffer.textureBuffer,o=0;o<t;o++){var a=4*o,s=e.componentIndices[o];i.setData(s,0,n[a],n[a+1],n[a+2],n[a+3]),B.isOpaqueSymbolColor(n,a)||(r=!0)}this._updateObjectOpacity(e.engineObject,r)}},s.prototype._setComponentIndices=function(e,t){for(var r=e.getAttribute($.VertexAttrConstants.COMPONENTINDEX),n=r.data,i=r.offsetIdx,o=r.strideIdx,a=e.getIndices($.VertexAttrConstants.COMPONENTINDEX),s=0;s<t.length;s++)for(var l=e.componentOffsets[s],u=e.componentOffsets[s+1],c=l;c<u;c++){n[i+a[c]*o]=t[s]}},s.prototype._rangeInfosChanged=function(e){null!=e&&e.length>0&&ae.warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")},s.prototype._reloadAll=function(e){void 0===e&&(e=this.elevationOffset),this._removeAllNodeDataFromStage(e),null!=this._controller&&this._controller.restartNodeLoading()},s.prototype._opacityChange=function(e){var t=this;this._nodeId2Meta.forEach(function(e){t._updateObjectOpacity(e.engineObject),t._updateEdgeRendering(e)})},s.prototype._updateObjectOpacity=function(e,t){for(var r=0,n=e.getGeometryRecords();r<n.length;r++)for(var i=0,o=n[r].materials;i<o.length;i++){var a=o[i],s=a.metadata;void 0!==t&&(s.symbolIsTransparent=t);var l=a.getParams(),u=this._calcEngineMaterialTransparencyParams(s.i3sTex,s.i3sMatParams,s.symbolIsTransparent);l.transparent===u.transparent&&l.layerOpacity===u.layerOpacity||a.setParameterValues(u)}},s.prototype._updateEngineObject=function(e,t){this._setObjectSymbology(t),this._addOrUpdateEdgeRendering(t),this._applyFilters(e),this.visibleGeometryChanged(t.engineObject)},s.prototype._slicePlaneEnabledChange=function(e){var t=this,r={slicePlaneEnabled:e};this._nodeId2Meta.forEach(function(e){for(var n=0,i=e.engineObject.getGeometryRecords();n<i.length;n++)for(var o=0,a=i[n].materials;o<a.length;o++){a[o].setParameterValues(r)}t._updateEdgeRendering(e)})},s.prototype._updateEdgeRendering=function(e){this._edgeView&&this._edgeView.hasObject(e.engineObject)&&this._addOrUpdateEdgeRendering(e)},s.prototype.queryExtent=function(e){return this._ensureQueryEngine().queryExtent(e)},s.prototype.queryFeatureCount=function(e){return this._ensureQueryEngine().queryFeatureCount(e)},s.prototype.queryFeatures=function(e){return this._ensureQueryEngine().queryFeatures(e)},s.prototype.queryObjectIds=function(e){return this._ensureQueryEngine().queryObjectIds(e)},s.prototype._ensureQueryEngine=function(){return this._queryEngine||(this._queryEngine=this._createQueryEngine()),this._queryEngine},s.prototype._createQueryEngine=function(){var e=this,t={id:0,index:0,meta:null,bbCorners:new Float64Array(24)};return new F(this.layer,{forAll:function(r,n){e._forAllFeatures(function(n,i,o){t.id=n,t.index=i,t.meta=o,e._boundingBoxCornerPoints(i,o.engineObject,t.bbCorners),r(t)},n)},createGraphic:function(t){return e._createGraphic(t.index,t.meta)},requestFields:function(t,r,n){return L.whenGraphicAttributes(e.layer,r,e._getObjectIdField(),n,function(){var n=e._getGraphicIndices(t,r);return{node:t,indices:n}},{ignoreUnavailableFields:!1})},createExtentBuilder:function(){return e._createExtentBuilder()}},{enableObjectId:!0,enableOutFields:!!this.layer.objectIdField})},s.prototype._createExtentBuilder=function(){var e=this.view.renderSpatialReference,t=this.view.spatialReference,r=x.empty(),n=new Float64Array(24);return{add:function(i){H.bufferToBuffer(i.bbCorners,e,0,n,t,0,8)&&x.expandWithBuffer(r,n,0,8)},getExtent:function(){return x.toExtent(r,t)}}},s.prototype._forAllFeatures=function(e,t,r){var n=this;this._nodeId2Meta.forEach(function(i,o){n._forAllFeaturesOfNode(i,e,r),t&&t(i.node)})},s.prototype._forAllFeaturesOfNode=function(e,t,r){for(var n=e.featureIds,i=e.engineObject.getGeometryRecords()[0],o=0;o<n.length;o++)if(r||e.engineObject.getComponentVisibility(i,o)){t(n[o],o,e,i)}},s.prototype._createGraphic=function(e,t){var r={};if(null!=t.featureIds&&(r[this._getObjectIdField()]=t.featureIds[e]),null!=t.attributeData)for(var n=0,i=Object.keys(t.attributeData);n<i.length;n++){var o=i[n];r[o]=L.getCachedAttributeValue(t.attributeData[o],e)}var a=new l(null,null,r);return a.layer=this.layer,a.sourceLayer=this.layer,a},s.prototype._boundingBoxCornerPoints=function(e,t,r){for(var n=t.geometries[0].getComponentAABB(e,he),i=0;i<8;++i)fe[0]=1&i?n[0]:n[3],fe[1]=2&i?n[1]:n[4],fe[2]=4&i?n[2]:n[5],z.mat4d.multiplyVec3(t.objectTransformation,fe),r[3*i]=fe[0],r[3*i+1]=fe[1],r[3*i+2]=fe[2];return r},s.prototype.highlight=function(e,t){var r=this,n=this._highlights;if(e instanceof O){var i=n.acquireSet(t),o=i.set,a=i.handle;return this.queryObjectIds(e).then(function(e){return n.setFeatureIds(o,e)}),a}if("number"==typeof e?e=[e]:e instanceof l?e=[e]:e instanceof c&&(e=e.toArray()),Array.isArray(e)&&e.length>0){if(e[0]instanceof l){var s=e.map(function(e){return j.attributeLookup(e.attributes,r._getObjectIdField())}),u=n.acquireSet(t),d=u.set;a=u.handle;return n.setFeatureIds(d,s),a}if("number"==typeof e[0]){s=e;var p=n.acquireSet(t);d=p.set,a=p.handle;return n.setFeatureIds(d,s),a}}return{remove:function(){}}},s.prototype.visibleGeometryChanged=function(e){var t=this;e?this._elevationProvider.objectChanged(e):this._elevationProvider.layerChanged(),null==this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle=g.schedule(function(){t.emit("visible-geometry-changed"),t._visibleGeometryChangedSchedulerHandle=null}))},n([_.property()],s.prototype,"layer",void 0),n([_.property()],s.prototype,"_controller",void 0),n([_.property({dependsOn:["_controller.updating"]})],s.prototype,"updating",void 0),n([_.property({dependsOn:["_controller.rootNodeVisible"]})],s.prototype,"suspended",void 0),n([_.property(U.updatingPercentage)],s.prototype,"updatingPercentage",void 0),n([_.property({readOnly:!0,aliasOf:"_controller.updatingPercentage"})],s.prototype,"updatingPercentageValue",void 0),n([_.property({readOnly:!0})],s.prototype,"hasTexturesOrVertexColors",null),n([_.property({readOnly:!0,dependsOn:["layer.renderer"]})],s.prototype,"rendererNeedsTextures",null),n([_.property({readOnly:!0,dependsOn:["layer.elevationInfo"]})],s.prototype,"elevationOffset",null),n([_.property({type:Boolean})],s.prototype,"slicePlaneEnabled",void 0),n([_.property()],s.prototype,"alwaysLoadEverythingModeEnabled",void 0),n([_.property({dependsOn:["view.qualitySettings.sceneService.uncompressedTextureDownsamplingEnabled","useCompressedTextures"]})],s.prototype,"uncompressedTextureDownsamplingEnabled",null),n([_.property({dependsOn:["layer.version"]})],s.prototype,"useCompressedTextures",null),n([_.subclass("esri.views.3d.layers.SceneLayerView3D")],s)}(_.declared(P)),fe=z.vec3d.create(),he=x.create(),me=x.create(),ve=[0,0,0,0],ge=new s([0,0,0,0]);return pe}.apply(null,n))||(e.exports=i)},1382:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(794),r(344),r(1044),r(349)],void 0===(i=function(e,t,r,n,i,o){function a(e,t,r,n,i,o,a){switch(r){case 1:for(var s=0;s<a;s++)n[i]=e[t],t+=1,i+=o;break;case 2:for(s=0;s<a;s++)n[i]=e[t],n[i+1]=e[t+1],t+=2,i+=o;break;case 3:for(s=0;s<a;s++)n[i]=e[t],n[i+1]=e[t+1],n[i+2]=e[t+2],t+=3,i+=o;break;case 4:for(s=0;s<a;s++)n[i]=e[t],n[i+1]=e[t+1],n[i+2]=e[t+2],n[i+3]=e[t+3],t+=4,i+=o;break;default:throw p("Unhandled stride size "+r)}}function s(e,t,r,n,i,o){switch(t){case 1:for(var a=0;a<o;a++)r[n]=e,n+=i;break;case 2:for(a=0;a<o;a++)r[n]=e,r[n+1]=e,n+=i;break;case 3:for(a=0;a<o;a++)r[n]=e,r[n+1]=e,r[n+2]=e,n+=i;break;case 4:for(a=0;a<o;a++)r[n]=e,r[n+1]=e,r[n+2]=e,r[n+3]=e,n+=i;break;default:throw p("Unhandled stride size "+t)}}function l(e){switch(e){case 5120:return Int8Array;case 5126:return Float32Array;case 5124:return Int32Array;case 5122:return Int16Array;case 5121:return Uint8Array;case 5125:return Uint32Array;case 5123:return Uint16Array}throw new Error("Unhandled data type: "+e)}function u(e){switch(e){case 5120:return"Int8";case 5126:return"Float32";case 5124:return"Int32";case 5122:return"Int16";case 5121:return"UInt8";case 5125:return"UInt32";case 5123:return"UInt16"}throw new Error("Unhandled data type: "+e)}function c(e){return e%Uint32Array.BYTES_PER_ELEMENT==0}function d(e){return e>0&&e%Uint32Array.BYTES_PER_ELEMENT==0}function p(e){return new Error("I3SGeometryUtil processing failed: "+e)}function f(e){var t=e.normals,r=e.positions,i=e.normalInd,a=e.positionInd;o.assert(e.normalInd.length===e.positionInd.length);for(var s=n.vec3.create(),l=n.vec3.create(),u=n.vec2.create(),c=r.data,d=r.offsetIdx,p=r.strideIdx,f=t.data,h=t.offsetIdx,m=t.strideIdx,v=0;v<a.length;v+=3){var g=a[v],y=d+p*g,b=c[y],_=c[y+1],x=c[y+2];y=d+p*(g=a[v+1]),s[0]=c[y]-b,s[1]=c[y+1]-_,s[2]=c[y+2]-x,y=d+p*(g=a[v+2]),l[0]=c[y]-b,l[1]=c[y+1]-_,l[2]=c[y+2]-x,n.vec3.cross(s,l,s),o.encodeNormal(s,u);for(var w=0;w<3;w++){var S=h+m*i[v+w];f[S]=o.encodeInt16(u[0]),f[S+1]=o.encodeInt16(u[1])}}}function h(e,t,r){var n=e.length/3,i=t.data,a=t.offsetIdx,s=t.strideIdx;if(null!=r)for(var l=r,u=l[0],c=l[1],d=l[2],p=l[4],f=l[5],h=l[6],m=l[8],v=l[9],b=l[10],_=0;_<n;_++){var x=e[3*_],w=e[3*_+1],S=e[3*_+2];g[0]=u*x+c*w+d*S,g[1]=p*x+f*w+h*S,g[2]=m*x+v*w+b*S,o.encodeNormal(g,y),i[a+_*s]=o.encodeInt16(y[0]),i[a+_*s+1]=o.encodeInt16(y[1])}else for(_=0;_<n;_++)g[0]=e[3*_],g[1]=e[3*_+1],g[2]=e[3*_+2],o.encodeNormal(g,y),i[a+_*s]=o.encodeInt16(y[0]),i[a+_*s+1]=o.encodeInt16(y[1])}Object.defineProperty(t,"__esModule",{value:!0});var m=new Uint8Array(64);t.interleaveGeometryBuffer=function(e,t,r,n,i){void 0===n&&(n=[]),void 0===i&&(i=[]);var o=e.params.vertexAttributes,f=o.position.count;if(!d(r[0].stride))throw p("Layout stride must use "+Uint32Array.BYTES_PER_ELEMENT+"-byte words");for(var h=r[0].stride/Uint32Array.BYTES_PER_ELEMENT,v=new Uint32Array(h*f),g=0,y=r=r.slice(0).sort(function(e,t){return e.offset-t.offset});g<y.length;g++)!function(e){if(-1!==i.indexOf(e.name))return"continue";var r=o[e.name],h=l(e.type),g=void 0,y=!1;if(null==r){var b=n.filter(function(t){return t.name===e.name})[0];if(!b)throw p("Geometry definition is missing attribute");r={valueType:u(e.type),byteOffset:0,count:f,valuesPerElement:e.count};for(var _=0;_<m.length;_++)m[_]=b.byteValue;g=m.buffer,y=!0}else g=t;if(u(e.type)!==r.valueType)throw p("Geometry definition type must match attribute type");if(!c(r.byteOffset)||!c(e.offset))throw p(e.name+" offset must use "+Uint32Array.BYTES_PER_ELEMENT+"-byte words");if(!d(r.valuesPerElement*h.BYTES_PER_ELEMENT)||!d(e.count*h.BYTES_PER_ELEMENT))throw p(e.name+" data must use "+Uint32Array.BYTES_PER_ELEMENT+"-byte words");var x=new Uint32Array(g),w=r.byteOffset/Uint32Array.BYTES_PER_ELEMENT,S=r.valuesPerElement*h.BYTES_PER_ELEMENT/Uint32Array.BYTES_PER_ELEMENT,T=e.offset/Uint32Array.BYTES_PER_ELEMENT,E=e.stride/Uint32Array.BYTES_PER_ELEMENT;y?s(x[0],S,v,T,E,f):a(x,w,S,v,T,E,f)}(y[g]);return v.buffer},t.processAndInterleaveNormals=function(e,t,n,i,o){if("none"===e)f(o);else{var a="earth-centered"===e?i:null;h(r.createTypedView(n,t.params.vertexAttributes.normal),o.normals,a)}};var v=65536;t.extractPositionData=function(e,t,r){var n=t[0];if(null==n||"position"!==n.name||5126!==n.type)return null;for(var o=new Float32Array(e),a=n.stride/4,s=3*o.length/a,l=new Float32Array(s),u=0;u<s/3;u++)l[3*u]=o[u*a+n.offset],l[3*u+1]=o[u*a+n.offset+1],l[3*u+2]=o[u*a+n.offset+2];var c,d=i.deduplicate(l.buffer,3),p=d.uniqueCount<v;if(r)for(c=new(p?Uint16Array:Uint32Array)(r.length),u=0;u<r.length;u++)c[u]=d.indices[r[u]];else c=p?new Uint16Array(d.indices):d.indices;return{data:new Float32Array(d.buffer),indices:c}};var g=n.vec3.create(),y=n.vec2.create()}.apply(null,n))||(e.exports=i)},1398:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(338),r(336),r(449),r(433),r(346),r(382),r(446),r(366),r(354),r(343),r(411),r(624),r(340),r(374),r(337),r(1055),r(389),r(752),r(788),r(1399),r(1400),r(1401),r(780),r(1402),r(1283),r(344),r(388),r(1403)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,c,d,p,f,h,m,v,g,y,b,_,x,w,S,T,E,C,O,P,A){function I(e,t){return e.length===t.length&&e.every(function(e){return R(t,e.name)>=0})}function R(e,t){for(var r=t.toLowerCase(),n=0;n<e.length;n++)if(e[n].name.toLowerCase()===r)return n;return-1}function M(e){return null!=e.loadedAttributes&&null!=e.attributeData}var D=d.getLogger("esri.layers.graphics.controllers.I3SOnDemandController"),F=function(e){function t(t){var r=e.call(this)||this;return r.nodeIndex={},r.screenSizeFactor=0,r.featureTarget=5e4,r.updating=!0,r.updatingPercentage=0,r.leafsReached=!1,r.uncompressedTextureDownsamplingEnabled=!1,r.alwaysLoadEverythingModeEnabled=!1,r._lodFactorProperty=null,r._featureLOD=1,r._stableFeatureLOD=!1,r._isIdle=!1,r._cameraDirty=!0,r._hasFeatures=!1,r._downloadingNodes=new Set,r._loadingNodes=new Set,r._updatingNodes=new Map,r._progressMaxNumNodes=1,r._poi=null,r._requiredAttributesDirty=!0,r._updatesDisabled=!1,r.disableCache=!1,r._restartNodeLoading=!1,r._fields=null,r._attributeStorageInfo=null,r._handles=new u,r._idleQueue=new C.IdleQueue,r._errorCount=0,r}return r(t,e),Object.defineProperty(t.prototype,"isMeshPyramid",{get:function(){return"mesh-pyramids"===this.layer.profile||"MeshPyramid"===this.layer.store.lodType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"streamDataSupplier",{get:function(){return this.layerView.view.resourceController.getStreamDataSupplier(A.ClientType.SCENE,{trackRequests:!0})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parsedDefinitionExpression",{get:function(){if(!(this.layer instanceof _&&this.layer.definitionExpression))return null;try{var e=g.create(this.layer.definitionExpression);if(!e.isStandardized())return D.error("definitionExpression is using non standard function"),null;var t=[],r=e.getFields();return T.findFieldsCaseInsensitive(r,this.layer.fields,{missingFields:t}),t.length>0?(D.error("definitionExpression references unknown fields: "+t.join(", ")),null):e}catch(e){return D.error("Failed to parse definitionExpression: "+e),null}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"definitionExpressionFields",{get:function(){if(this.parsedDefinitionExpression){var e=this.parsedDefinitionExpression.getFields();return T.findFieldsCaseInsensitive(e,this._fields)}return null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"crsVertex",{get:function(){return T.getVertexCrs(this.layer)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"crsIndex",{get:function(){return T.getIndexCrs(this.layer)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rootNodeVisible",{get:function(){var e=this._rootNodeId&&this.nodeIndex[this._rootNodeId];return!e||!this._viewportQueries||this._viewportQueries.isNodeVisible(e)},enumerable:!0,configurable:!0}),t.prototype.initialize=function(){var e=this;this.updateEventListener={needsUpdate:function(){return!1},idleBegin:function(){e._updateIdleState(!0)},idleEnd:function(){e._updateIdleState(!1)}},this.updateEventListenerWhileSuspended={idleBegin:function(){return e._startNodeLoadingWhileSuspended()}},this._lodHandling=new w(this.layerView,function(){return e.updatingChanged()});var t=this.layerView.layer;this.layer=t,this._defaultGeometrySchema=t.store.defaultGeometrySchema,this._rootNodeUrl=t.store.rootNode;var r=this._rootNodeUrl.split("/");this._rootNodeId=r[r.length-1],this.disableCache=c("disable-feature:idb-cache"),t instanceof _?("mesh"===t.geometryType?this._lodFactorProperty="qualitySettings.sceneService.3dObject.lodFactor":"point"===t.geometryType&&(this._lodFactorProperty="qualitySettings.sceneService.point.lodFactor"),this._fields=t.fields,this._attributeStorageInfo=t.attributeStorageInfo):t instanceof b&&(this._lodFactorProperty="qualitySettings.sceneService.integratedMesh.lodFactor");var n=o([this.layer.when(),this.layerView.when()]).then(function(){if(!e.destroyed&&e.layerView&&!e.layerView.destroyed){var t=e.layerView.view;e.setClippingArea(t.clippingArea);var r=t.pointsOfInterest;e._centerOnSurface=r.centerOnSurfaceFrequent,e._handles.add(e._centerOnSurface.watch("renderLocation",function(){return e._pointOfInterestChanged()}));var n=e.layerView.view.resourceController;n.memoryEvents.on("quality-changed",function(){return e._setCameraDirty()}),e._handles.add(m.init(e.layerView,"suspended",function(t){e._idleFrameWorker&&(e._idleFrameWorker.remove(),e._idleFrameWorker=null,e.restartNodeLoading()),e._frameWorker&&(e._frameWorker.remove(),e._frameWorker=null),t?e._idleFrameWorker=n.registerIdleFrameWorker(e.updateEventListenerWhileSuspended):(e._idleFrameWorker=n.registerIdleFrameWorker(e.updateEventListener),e._frameWorker=n.registerFrameWorker(function(t){return e._frame(t)}))}),"layerview"),e._handles.add(e.layer.watch("elevationInfo",function(t){return e._elevationInfoChanged(t)}),"layer"),e.watch("uncompressedTextureDownsamplingEnabled",function(){return e.restartNodeLoading()}),e.watch("alwaysLoadEverythingModeEnabled",function(){return e.restartNodeLoading()}),e._handles.add(t.state.watch("camera",function(){return e._setCameraDirty()})),e._handles.add(e.watch("featureTarget",function(){e._stableFeatureLOD=!1})),e._lodFactorProperty&&e._handles.add(e.layerView.view.watch(e._lodFactorProperty,function(){return e._setCameraDirty()}),"quality")}});this.addResolvingPromise(n),this.when(function(){return e._startNodeLoading()})},t.prototype.destroy=function(){this._idleFrameWorker&&(this._idleFrameWorker.remove(),this._idleFrameWorker=null),this._frameWorker&&(this._frameWorker.remove(),this._frameWorker=null),this._handles.destroy(),this._nodeLoader=null},t.prototype._getRequiredAttributes=function(){if(!(null!=this._attributeStorageInfo&&this.layer instanceof _&&this._fields))return[];var e=Object.create(null);if(this.layer.renderer&&this.layer.renderer.collectRequiredFields(e),this.layer.labelsVisible&&this.layer.labelingInfo&&this.layer.labelingInfo.forEach(function(t){t._collectRequiredFields(e)}),null!=this.definitionExpressionFields)for(var t=0,r=this.definitionExpressionFields;t<r.length;t++){var n=r[t];e[n]=!0}var i=this._attributeStorageInfo,o=this._fields,a=this.layer.objectIdField;return Object.keys(e).map(function(e){var t=R(i,e),r=R(o,e);return t>=0&&r>=0?{index:t,name:o[r].name,field:o[r],attributeStorageInfo:i[t]}:null}).filter(function(e){return null!=e&&e.name!==a}).sort(function(e,t){return t.index-e.index}).filter(function(e,t,r){return 0===t||r[t-1].index!==e.index})},t.prototype._requiredFieldsChange=function(){this._requiredAttributesDirty=!0,this.restartNodeLoading()},t.prototype._labelingChanged=function(){I(this._requiredAttributes,this._getRequiredAttributes())||this._requiredFieldsChange()},t.prototype.setClippingArea=function(e){var t=y.create();P.extentToBoundingBox(e,t,this.layerView.view.renderSpatialReference)?this._clippingArea=t:this._clippingArea=null},t.prototype._pointOfInterestChanged=function(){this._poi&&(this._calculatePointOfInterest(this._poi),this._viewportQueries&&(this._viewportQueries.updatePointOfInterest(this._poi),this._index&&(this._index.progressiveLoadPenalty=N.distancePenalty*this._viewportQueries.distCameraToPOI(),this._index.requestReload())))},t.prototype._calculatePointOfInterest=function(e){void 0===e&&(e=O.vec3d.create());var t=this._centerOnSurface.renderLocation,r=O.vec3d.create();O.vec3d.subtract(t,this.camPos,r),O.vec3d.normalize(r);var n=this.layerView.view.renderCoordsHelper,i=O.vec3d.create();n.worldUpAtPosition(t,i);var o=Math.acos(O.vec3d.dot(i,r))-.5*Math.PI;return O.vec3d.lerp(this.camPos,t,Math.max(0,Math.min(1,o/(.5*Math.PI))),e),e},t.prototype.updateClippingArea=function(e){this.setClippingArea(e),this._cameraDirty=!0,this._viewportQueries&&this._viewportQueries.updateExtent(this._clippingArea)},t.prototype._setCameraDirty=function(){this._cameraDirty=!0,this.updatingChanged()},t.prototype.getBaseUrl=function(){return this.layer.parsedUrl.path},t.prototype.updateElevationChanged=function(e,t,r){T.findIntersectingNodes(e,t,this.nodeIndex.root,this.crsIndex,this.nodeIndex,function(e){r.push(e)});for(var n=0;n<r.length;n++){var i=r.data[n];this._viewportQueries.invalidateCache(i.id),i.id===this._rootNodeId&&this.notifyChange("rootNodeVisible")}r.length&&this.restartNodeLoading()},t.prototype._elevationInfoChanged=function(e){this._viewportQueries.invalidateCache(),this._initViewData()},t.prototype.restartNodeLoading=function(){this._restartNodeLoading=!0,this.updatingChanged()},t.prototype.schedule=function(e,t){var r=this;return this._idleQueue.push(t).then(function(t){if(!r._loadingNodes.has(e)&&!r._updatingNodes.has(e))throw new i;return t})},t.prototype.reschedule=function(e,t){var r=this;return this._idleQueue.unshift(t).then(function(t){if(!r._loadingNodes.has(e)&&!r._updatingNodes.has(e))throw new i;return t})},t.prototype.getUnloadedMemoryEstimate=function(){return this._index?this._index.getUnloadedMemoryEstimate()*this._getLodDropFactor():0},t.prototype._frame=function(e){null!==this._viewportQueries&&this._viewportQueries.setCameraIdle(!this._cameraDirty),this.layerView.visible&&this._processLogError(e,!1)},t.prototype._processLogError=function(e,t){void 0===t&&(t=!0);try{this._process(e,t)}catch(e){this._errorCount<50?D.error("Error during processing: "+e):50===this._errorCount&&D.error("Too many errors for this layer. Further errors will not be displayed."),this._errorCount++}},t.prototype._process=function(e,t){var r=this;if(this._restartNodeLoading&&(this.cancelNodeLoading(),this._startNodeLoading()),null!=this._nodeLoader&&null!=this._index){this._updateViewData()&&(t=!1);var n=function(r){!t&&e.done()||r()&&(t=!1)};for(n(function(){return r._processIndex()}),n(function(){return r._processNodes(e,t)});this._idleQueue.length()>0&&(t||!e.done());)t=!1,this._idleQueue.process();this._updateFeatureLOD(),n(function(){return r._prefetchIndex()}),this.updatingChanged(),this._lodHandling.lodGlobalHandling()}},t.prototype._processIndex=function(){var e=Math.min(10-this._index.getIndexLoading(),this._getAvailableLoadTokens(1));this._index.update(s.keysOfSet(this._loadingNodes));var t=this._index.getFeatureEstimate().leafsReached;return this._index.isLoading()||t===this._get("leafsReached")||this._set("leafsReached",t),this._index.load(e)},t.prototype._prefetchIndex=function(){if(this._loadingNodes.size>0)return!1;var e=Math.min(10-this._index.getIndexLoading(),this._getAvailableLoadTokens(1));return this._index.prefetch(e)},t.prototype._updateFeatureLOD=function(){var e=this._index.getFeatureEstimate(),t=this.featureTarget*this._getLOD()/this._featureLOD;if(e.estimate){var r=!this._index.isLoading();if(!r&&!this._index.isPrefetching()&&this._index.getIndexMissing()>500){if(this._featureLOD<=1e-4)return;this._featureLOD/=1.5,this._stableFeatureLOD=!1}else if(r&&e.estimate<t){if(this._featureLOD>=1e4||e.leafsReached||this._stableFeatureLOD)return;var n=this._featureLOD,i=Math.min(.1*(t/e.estimate-1),.1);if(this._featureLOD*=1+i,!this._index.checkFeatureTarget(t,this._getLOD()))return this._featureLOD=n,void(this._stableFeatureLOD=!0)}else{if(!(e.estimate>1.2*t||r&&e.estimate>t))return;if(this._featureLOD<=1e-4)return;this._featureLOD/=1+.25*(e.estimate/t-1),this._stableFeatureLOD=!1}this._featureLOD=Math.min(1e4,Math.max(1e-4,this._featureLOD)),this._viewportQueries.updateScreenSpaceErrorBias(this._getLOD()),this._index.requestReload()}},t.prototype._processNodes=function(e,t){var r=this,n=(this._isIdle?100:2)-this._loadingNodes.size,i=this._index.getUpdates(n);return i.cancel.forEach(this._cancelNodeIdLoading,this),i.update.forEach(function(n){!t&&e.done()||(t=!1,r._updateLoadedNode(n))}),i.add.forEach(function(n){!t&&e.done()||(t=!1,r._loadNode(n))}),!t},t.prototype._cancelNodeLoading=function(){var e=this;this._loadingNodes.clear(),this._downloadingNodes.clear(),this._updatingNodes.forEach(function(t,r){return e._updatingNodes.get(r).cancel()}),this._updatingNodes.clear()},t.prototype._cancelNodeIdLoading=function(e){this._loadingNodes.delete(e),this._downloadingNodes.delete(e)},t.prototype._getAvailableLoadTokens=function(e){return Math.floor((12-1*this._index.getIndexLoading()-2*this._downloadingNodes.size)/e)},t.prototype._hasNodeLoadToken=function(){var e=this._isIdle?5:2;return!(this._downloadingNodes.size>=e)&&this._getAvailableLoadTokens(2)>0},t.prototype.updatingChanged=function(){var e=(this._index?this._index.getIndexMissing():0)+3*(this._index?this._index.getNodesMissing():0)+2*this._loadingNodes.size,t=!(!(e>0||this._updatingNodes.size>0||this._index&&this._index.isPrefetching()||this._restartNodeLoading||this._cameraDirty||this._idleQueue.length()>0||this._lodHandling&&this._lodHandling.requiresLODGlobalHandling)&&this._isIdle);0===e&&(this._progressMaxNumNodes=1),this._progressMaxNumNodes=Math.max(e,this._progressMaxNumNodes),t!==this._get("updating")&&this._set("updating",t);var r=100*e/this._progressMaxNumNodes;r!==this._get("updatingPercentage")&&this._set("updatingPercentage",r)},t.prototype._initViewData=function(){var e=this.layerView.view,t=e.state.camera,r=e.renderCoordsHelper;this.camPos=O.vec3d.create(e.pointsOfInterest.renderPointOfView),this.screenSizeFactor=1/t.perPixelRatio,this._poi=this._calculatePointOfInterest();var n=this._getLOD();this._viewportQueries=new E(this.crsIndex,r,t,this._poi,this._clippingArea,e.elevationProvider,this.layer.elevationInfo,{progressiveLoadFactor:this._getProgressiveLoadFactor(this.layer,n),screenspaceErrorBias:n,angleDependentLoD:n<.5,disableLod:this.alwaysLoadEverythingModeEnabled}),this._cameraDirty=!1,this.notifyChange("rootNodeVisible")},t.prototype._updateViewData=function(){if(!this._cameraDirty||!this._index)return!1;var e=this.layerView.view,t=e.state.camera;this.camPos=O.vec3d.create(e.pointsOfInterest.renderPointOfView),this.screenSizeFactor=1/t.perPixelRatio,this._poi=this._calculatePointOfInterest(this._poi),this._viewportQueries.updateCamera(t),this._viewportQueries.updatePointOfInterest(this._poi);var r=this._getLOD();this._viewportQueries.updateScreenSpaceErrorBias(r),this._index.progressiveLoadPenalty=N.distancePenalty*this._viewportQueries.distCameraToPOI(),this._index.requestReload(),this._stableFeatureLOD=!1;var n=!this.alwaysLoadEverythingModeEnabled&&this._removeInvisibleNodes();return this._cameraDirty=!1,this.notifyChange("rootNodeVisible"),n},t.prototype._getProgressiveLoadFactor=function(e,t){return e instanceof _&&"mesh"===e.geometryType?t>=1&&c("enable-feature:progressive-3dobject")?N.factor3dObject:1:e instanceof b&&(t>=1&&!c("disable-feature:progressive-im"))?N.factorIM:1},t.prototype._getLOD=function(){return(this._lodFactorProperty&&this.layerView.view.get(this._lodFactorProperty)||1)*this.layerView.view.resourceController.memoryFactor*this._featureLOD},t.prototype._getLodDropFactor=function(){return Math.min(this.layerView.view.resourceController.memoryFactor,.5)/.5},t.prototype._startNodeLoadingWhileSuspended=function(){this._initViewData(),this.alwaysLoadEverythingModeEnabled&&this.layerView.visible&&!this.layerView.get("parent.suspended")||this._removeInvisibleNodes()},t.prototype.isGeometryVisible=function(e){return this._viewportQueries.isGeometryVisible(e)},t.prototype.updateVisibility=function(e){return this._viewportQueries.updateNode(e)},t.prototype._shouldLoadNode=function(e){if(!this._lodHandling.shouldLoadNode(e))return!1;var t=this._getLodDropFactor();return!(t>0&&this._viewportQueries.maxDistance>0&&this._lodHandling.childrenEmpty(e)&&this._viewportQueries.distToPOI(e)>this._viewportQueries.maxDistance*t)&&(!e.obb||this._viewportQueries.isGeometryVisible(e))},t.prototype._startNodeLoading=function(){var e=this;if(this._restartNodeLoading=!1,!this._updatesDisabled&&null!=this.streamDataSupplier){this._initViewData(),this._requiredAttributesDirty&&(this._requiredAttributes=this._getRequiredAttributes(),this._requiredAttributesDirty=!1,this._handles.add([this.layer.watch("renderer",function(){return e._requiredFieldsChange()}),this.layer.watch("definitionExpression",function(){return e._requiredFieldsChange()}),this.layer.watch("labelsVisible",function(){return e._labelingChanged()}),this.layer.watch("labelingInfo",function(){return e._labelingChanged()})],"requiredAttributes"));var t=S.TextureFormat.Normal;this.layerView.useCompressedTextures?t=S.TextureFormat.Compressed:this.uncompressedTextureDownsamplingEnabled&&(t=S.TextureFormat.Downsampled);var r=this._defaultGeometrySchema,n={textureFormat:t,loadTextureData:this.layerView.rendererNeedsTextures,loadFeatureData:!this.isMeshPyramid||null==r||null==r.ordering};this._nodeLoader=new S(this.streamDataSupplier,D,r,this._requiredAttributes,n);var i=N.distancePenalty*this._viewportQueries.distCameraToPOI();this._index=new x(this.getBaseUrl(),this._rootNodeUrl,this._rootNodeId,i,this.nodeIndex,this.streamDataSupplier,this._viewportQueries,D,function(t){return e.layerView.isNodeLoaded(t)},function(t){return e._shouldLoadNode(t)},function(t){return e._enableFromGPUCache(t)},function(t){return e._needsUpdate(t)});var o=this.layerView.view.renderSpatialReference,a=this.crsIndex.equals(o)||this.crsIndex.isWGS84&&o.equals(P.SphericalECEFSpatialReference);this._index.ignoreServiceOBB=!a,this.alwaysLoadEverythingModeEnabled||this._removeInvisibleNodes(),this._lodHandling.startNodeLoading(function(t){return e._viewportQueries.isNodeVisible(t)},function(t){return e._viewportQueries.isGeometryVisible(t)},function(t){return e._index.nodeTraversalState(t)},this.nodeIndex,this._rootNodeId,{maxLodLevel:this._viewportQueries.maxLodLevel}),this.updatingChanged()}},t.prototype.isNodeLoading=function(){return null!=this._nodeLoader&&null!=this._index},t.prototype.cancelNodeLoading=function(){this.isNodeLoading()&&(this._nodeLoader.cancelAll(),this.streamDataSupplier.cancelAll(),this._idleQueue.cancelAll(),this._cancelNodeLoading(),this._nodeLoader=null,this._index=null,this._poi=null,this.layerView.additionalCancelNodeLoadingHandler&&this.layerView.additionalCancelNodeLoadingHandler(),this.updatingChanged())},t.prototype._removeInvisibleNodes=function(){var e=this.layerView.getLoadedNodeIDs(),t=this._getLodDropFactor(),r=this._viewportQueries.maxDistance*t,n=t>0&&r>0;L.clear();for(var i=0;i<e.length;i++){var o=this.nodeIndex[e[i]];(!this._viewportQueries.isGeometryVisible(o)||n&&this._lodHandling.childrenEmpty(o)&&this._viewportQueries.distToPOI(o)>r)&&(this._lodHandling.setLodGlobalDirty(),L.push(o))}return L.length>0&&(this.layerView.removeNodeData(L),L.clear(),!0)},t.prototype._needsUpdate=function(e){if(null==e.featureData||0===e.featureData.length||this._updatingNodes.has(e.id))return!1;var t=this.layerView.getLoadedAttributes(e);return null!=t&&t!==this._requiredAttributes},t.prototype._updateLoadedNode=function(e){var t=this,r=e.baseUrl,n=I(this.layerView.getLoadedAttributes(e),this._requiredAttributes)?h.resolve(this.layerView.getAttributeData(e)):this._nodeLoader.loadAttributes(e,r,this._requiredAttributes);this._updatingNodes.set(e.id,n),n.then(function(r){return t.schedule(e.id).then(function(){return t.layerView.setAttributeData(e,t._requiredAttributes,r)})}).catch(function(r){r instanceof i||t.layerView.setAttributeData(e,t._requiredAttributes,{})}).always(function(){t._updatingNodes.delete(e.id),t.updatingChanged()}),this.updatingChanged()},t.prototype._loadNode=function(e){var t=this;e.notInCache&&!this._hasNodeLoadToken()||(this._loadingNodes.add(e.id),this.updatingChanged(),this._loadAndAddBundle(e).always(function(){t._loadingNodes.delete(e.id),t._hasFeatures=t._hasFeatures||!!e.numFeatures,t.updatingChanged()}))},t.prototype._loadAndAddBundle=function(e){return 1!==e.featureData.length&&D.warn("Node ${node.id} has ${node.featureData.length} bundles. Only the first bundle will be loaded."),e.notInCache?this._loadUncached(e):this._loadCached(e).then(function(t){t||(e.notInCache=!0)}).catch(function(t){t instanceof i||(e.notInCache=!0)})},t.prototype._enableFromGPUCache=function(e){if(this.disableCache||!this.layerView.loadCachedGPUData||!this.layerView.addCachedGPUData)return!1;var t=this.layerView.loadCachedGPUData(e);return!!(t&&M(t)&&I(t.loadedAttributes,this._requiredAttributes))&&(this.layerView.addCachedGPUData(e,t,t),this._lodHandling.lodSwapBundleLoaded(e),!0)},t.prototype._loadCached=function(e){var t=this,r=this.layerView;return!this.disableCache&&r.loadCachedNodeData&&r.addCachedNodeData?this.schedule(e.id).then(function(){return r.loadCachedNodeData(e,function(e,r){return t._nodeLoader.loadTextures(e,r)})}).then(function(n){if(null==n)return!1;var i=t._requiredAttributes;return M(n)&&I(n.loadedAttributes,i)?t.reschedule(e.id).then(function(){return r.addCachedNodeData(e,n,n)}).then(function(){return t._lodHandling.lodSwapBundleLoaded(e),!0}):t.reschedule(e.id).then(function(){return t._nodeLoader.loadAttributes(e,e.baseUrl,i)}).then(function(r){return t.reschedule(e.id,{loadedAttributes:i,attributeData:r})}).then(function(t){return r.addCachedNodeData(e,n,t)}).then(function(){return t._lodHandling.lodSwapBundleLoaded(e),!0})}):h.resolve(!1)},t.prototype._loadUncached=function(e){var t=this;return this._downloadingNodes.add(e.id),this._nodeLoader.loadBundleData(e,0).then(function(r){return t._downloadingNodes.delete(e.id),t.schedule(e.id,r)}).then(function(r){return t.layerView.addNodeData(e,r)}).then(function(){t._lodHandling.lodSwapBundleLoaded(e),e.notInCache=!1}).catch(function(t){t instanceof i||(D.error("Failed to load node '"+e.id+"' bundle 0: "+t),e.failed=!0)})},t.prototype._updateIdleState=function(e){e!==this._isIdle&&(this._isIdle=e,this._viewportQueries&&this._viewportQueries.setCameraIdle(!0),this.updatingChanged())},t.prototype.updateStats=function(e){e.index=Object.keys(this.nodeIndex).length,this._hasFeatures&&(e.detail=this._featureLOD,e.target=Math.round(this.featureTarget*this._getLOD()/this._featureLOD)),this._index&&this._index.updateStats(e)},n([v.property({readOnly:!0})],t.prototype,"isMeshPyramid",null),n([v.property({readOnly:!0})],t.prototype,"streamDataSupplier",null),n([v.property({readOnly:!0,dependsOn:["layer.definitionExpression"]})],t.prototype,"parsedDefinitionExpression",null),n([v.property({readOnly:!0,dependsOn:["parsedDefinitionExpression"]})],t.prototype,"definitionExpressionFields",null),n([v.property({readOnly:!0})],t.prototype,"crsVertex",null),n([v.property({readOnly:!0})],t.prototype,"crsIndex",null),n([v.property({readOnly:!0})],t.prototype,"nodeIndex",void 0),n([v.property()],t.prototype,"camPos",void 0),n([v.property()],t.prototype,"screenSizeFactor",void 0),n([v.property()],t.prototype,"featureTarget",void 0),n([v.property()],t.prototype,"layerView",void 0),n([v.property()],t.prototype,"layer",void 0),n([v.property({readOnly:!0})],t.prototype,"updating",void 0),n([v.property({readOnly:!0})],t.prototype,"updatingPercentage",void 0),n([v.property({readOnly:!0})],t.prototype,"leafsReached",void 0),n([v.property({readOnly:!0})],t.prototype,"rootNodeVisible",null),n([v.property({aliasOf:"layerView.uncompressedTextureDownsamplingEnabled"})],t.prototype,"uncompressedTextureDownsamplingEnabled",void 0),n([v.property({aliasOf:"layerView.alwaysLoadEverythingModeEnabled"})],t.prototype,"alwaysLoadEverythingModeEnabled",void 0),n([v.subclass("esri.layers.graphics.controllers.I3SOnDemandController")],t)}(v.declared(a,f,l)),L=new p,N={factorIM:.2,factor3dObject:.05,distancePenalty:10};return F}.apply(null,n))||(e.exports=i)},1399:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(345),r(411),r(350),r(780),r(779)],void 0===(i=function(e,t,r,n,i,o,a){var s=["version","level","sharedResource","attributeData","geometryData","textureData","lodSelection"],l=function(){function e(e,t,r,o,a,s,l,c,d,p,f,h){var m=this;this.rootId=r,this.progressiveLoadPenalty=o,this.nodeIndex=a,this.streamDataSupplier=s,this.viewportQueries=l,this.logger=c,this._isLoaded=d,this._isSelected=p,this._enable=f,this._needsUpdate=h,this._dirty=!0,this._loading=!0,this._prefetching=!0,this._loadingNodes=new Set,this._indexMissing=1,this._nodesMissing=0,this._maxUnloadedPrio=Number.NEGATIVE_INFINITY,this._nodeTraversalState={},this._version=0,this._featureEstimate={estimate:0,leafsReached:!1},this._unloadedMemoryEstimate=0,this._missing=new n,this._prefetch=new n,this._updates=new u,this.ignoreServiceOBB=!1,this._maxLodLevel=this.viewportQueries.maxLodLevel,this.rootUrl=i.makeAbsolute(t,e),this.traverseVisible(function(e,t){return m.nodeTraversalState(t)})}return e.prototype.requestReload=function(){this._dirty=!0,this._loading=!0,this._prefetching=!0,++this._version},e.prototype.update=function(e){var t=this;if(this._dirty){this._indexMissing=0,this._nodesMissing=0,this._maxUnloadedPrio=Number.NEGATIVE_INFINITY,this._missing.clear(),this._prefetch.clear(),this._updates.reset(e),this._loading=!1,this._prefetching=!1;var n=!0,i=new c,o=new c;if(this.traverseVisible(function(a,s,l){if(t._updateFeatureEstimate(s,o),!s)return++t._indexMissing,t._loading=!0,t._prefetching=!1,void(t._loadingNodes.has(a.id)||t._missing.push(r({},a,{baseUrl:l})));if(0===t._missing.length&&s.children)for(var u=0,c=s.children;u<c.length;u++){var d=c[u];t.nodeIndex[d.id]||(t._prefetching=!0,t._loadingNodes.has(d.id)||t._prefetch.push(r({},d,{baseUrl:s.baseUrl})))}if(!s.failed&&s.featureData&&0!==s.featureData.length){if(t._isLoaded(s))return i.known+=s.memory,++i.knownNodes,t._isSelected(s)?s.children&&(n=!1):(i.unremoved+=s.memory,n=!1),void(t._needsUpdate(s)&&t._updates.update.push(s));if(s.memory&&(i.known+=s.memory,++i.knownNodes),t._isSelected(s)){if(++t._nodesMissing,s.children&&(n=!1),s.memory?(i.missing+=s.memory,i.known+=s.memory,++i.knownNodes):++i.missingNodes,e.indexOf(s.id)>=0)return void(t._updates.cancel=t._updates.cancel.filter(function(e){return e!==s.id}));t._enable(s)||t._updates.add.push(s)}}}),this._unloadedMemoryEstimate=i.missing-i.unremoved,i.knownNodes>3&&(this._unloadedMemoryEstimate+=i.missingNodes*i.known/i.knownNodes),this._unloadedMemoryEstimate=.8*Math.max(0,this._unloadedMemoryEstimate),this._featureEstimate.estimate=o.known-o.missing,this._featureEstimate.leafsReached=n,o.knownNodes>0){var a=o.known/o.knownNodes,s=o.missing-o.unremoved+o.missingNodes*a;this._featureEstimate.estimate+s>0&&(this._featureEstimate.estimate+=s)}this._dirty=this._indexMissing>0||this._nodesMissing>0||this._updates.add.length>0||this._updates.update.length>0||this._updates.cancel.length>0}},e.prototype.checkFeatureTarget=function(e,t){var r=this,n=this.viewportQueries.updateScreenSpaceErrorBias(t);++this._version;var i=new c;this.traverseVisible(function(e,t){return r._updateFeatureEstimate(t,i)});var o=i.known-i.missing;if(i.knownNodes>0){var a=i.known/i.knownNodes,s=i.missing-i.unremoved+i.missingNodes*a;o+s>0&&(o+=s)}return this.viewportQueries.updateScreenSpaceErrorBias(n),++this._version,o<=e},e.prototype._updateFeatureEstimate=function(e,t){if(e&&!e.failed&&e.featureData&&0!==e.featureData.length)return this._isLoaded(e)?(t.known+=e.numFeatures,++t.knownNodes,void(this._isSelected(e)||(t.unremoved+=e.numFeatures))):void(this._isSelected(e)&&(e.numFeatures?(t.missing+=e.numFeatures,t.known+=e.numFeatures,++t.knownNodes):++t.missingNodes))},e.prototype.load=function(e){var t=this;return o.buildTopNodeMap(this._missing,e,function(e){return t.entryPriority(e)}),this._missing.length<=0?this._loading:(this._maxUnloadedPrio=this.entryPriority(this._missing.front()),this._missing.forEach(function(e){return t._loadNode(e)}),this._missing.clear(),this._loading)},e.prototype.prefetch=function(e){var t=this;return o.buildTopNodeMap(this._prefetch,e,function(e){return t.entryPriority(e)}),this._prefetch.forEach(function(e){return t._loadNode(e)}),this._prefetch.clear(),this._prefetching},e.prototype.isLoading=function(){return this._loading},e.prototype.isPrefetching=function(){return this._prefetching},e.prototype.getIndexLoading=function(){return this._loadingNodes.size},e.prototype.getIndexMissing=function(){return this._indexMissing},e.prototype.getUnloadedMemoryEstimate=function(){return this._unloadedMemoryEstimate},e.prototype.getNodesMissing=function(){return this._nodesMissing},e.prototype.getUpdates=function(e){var t=this;return o.buildTopNodeMap(this._updates.add,e,function(e){return t.entryPriority(e)},this._maxUnloadedPrio),o.buildTopNodeMap(this._updates.update,Number.POSITIVE_INFINITY,function(e){return t.entryPriority(e)}),this._updates},e.prototype.getFeatureEstimate=function(){return this._featureEstimate},e.prototype.nodeTraversalState=function(e){if(!e)return null;var t=this._nodeTraversalState[e.id];if(t&&t.version===this._version)return t;var r=this.viewportQueries.getLodLevel(e),n=this.viewportQueries.hasLOD(e),i=!0;if(n)if(e.parentNode){var o=this.nodeIndex[e.parentNode.id];if(null==o)return null;var a=this._nodeTraversalState[o.id];i=a&&r>a.lodLevel}else i=r>0;return t?(t.lodLevel=r,t.isChosen=i,t.version=this._version,t):(this._nodeTraversalState[e.id]={nodeHasLOD:n,lodLevel:r,isChosen:i,version:this._version},this._nodeTraversalState[e.id])},e.prototype._loadNode=function(e){var t=this;this._loadingNodes.add(e.id);var r=i.makeAbsolute(e.href,e.baseUrl);this.streamDataSupplier.request(r,"json").then(function(e,r){var n=r,i={id:n.id,mbs:n.mbs,parentNode:n.parentNode,children:n.children,featureData:n.featureData};s.forEach(function(e){i[e]=n.hasOwnProperty(e)?n[e]:null}),n.hasOwnProperty("obb")&&!t.ignoreServiceOBB&&(i.obb=a.clone(n.obb),i.hasServiceOBB=!0,t.viewportQueries.updateNode(i.id)),t.nodeIndex[i.id]=i,i.baseUrl=e,i.featureData&&1===i.featureData.length&&i.featureData[0].featureRange&&(i.numFeatures=i.featureData[0].featureRange[1]-i.featureData[0].featureRange[0]+1),t.nodeTraversalState(i),t._loadingNodes.delete(i.id),t._dirty=!0},function(n){t.loadErrorCallback(r),t._loadingNodes.delete(e.id),t._dirty=!0})},e.prototype.entryPriority=function(e){if(e.id===this.rootId)return 0;var t=0,r=this.nodeIndex[e.id];if(null!=r&&null!=r.parentNode){var n=this._nodeTraversalState[r.parentNode.id];null!=n&&(t=n.lodLevel)}for(var i=this.progressiveLoadPenalty,o=r;o;o=o.parentNode?this.nodeIndex[o.parentNode.id]:null)if(this._isLoaded(o)){i=0;break}var a=this.viewportQueries.distToPOI(e);return-a-t*(a+this.progressiveLoadPenalty)+i},e.prototype.traverseVisible=function(e){var t=this.nodeIndex[this.rootId];t?this._traverse({id:this.rootId,mbs:t.mbs,href:this.rootUrl},t,e,""):e({id:this.rootId,mbs:null,href:this.rootUrl},null,"")},e.prototype._traverse=function(e,t,r,n){if(t.children&&0!==t.children.length){if(this.viewportQueries.isNodeVisible(t)){r(e,t,n);var i=this.nodeTraversalState(t);if(!i.nodeHasLOD||i.lodLevel!==this._maxLodLevel)for(var o=0,a=t.children;o<a.length;o++){var s=a[o],l=this.nodeIndex[s.id];l?this._traverse(s,l,r,t.baseUrl):this.viewportQueries.isNodeVisible(s)&&r(s,null,t.baseUrl)}}}else this.viewportQueries.isGeometryVisible(t)&&r(e,t,n)},e.prototype.loadErrorCallback=function(e){this.logger.warn("Error loading node: "+e)},e.prototype.updateStats=function(e){if(this._nodesMissing&&(e.nodes+=" + "+Math.round(this._nodesMissing)),this._indexMissing&&(e.index+=" + "+this._indexMissing),this._featureEstimate.estimate){var t=this._featureEstimate.estimate-e.features;t>0?e.features+=" + "+t:t<0&&(e.features+=" - "+-t)}},e}(),u=function(){function e(){this.update=new n,this.add=new n,this.cancel=[]}return e.prototype.reset=function(e){this.add.clear(),this.update.clear(),this.cancel=e},e}(),c=function(){return function(){this.known=0,this.knownNodes=0,this.missing=0,this.missingNodes=0,this.unremoved=0}}();return l}.apply(null,n))||(e.exports=i)},1400:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(411)],void 0===(i=function(e,t,r){var n=function(){function e(e,t){this.layerView=e,this.lodGlobalDirtyChanged=t}return e.prototype.startNodeLoading=function(e,t,r,n,i,o){this._lodGlobalDirty=!1,this._maxLodLevel=o.maxLodLevel,this._nodeIndex=n,this._rootId=i,this._nodeTraversalState=r,this._isNodeVisible=e,this._isGeometryVisible=t,this.lodGlobalDirtyChanged(this._lodGlobalDirty)},e.prototype.shouldLoadNode=function(e){var t=this._nodeTraversalState(e);return!!t.isChosen&&(t.lodLevel===this._maxLodLevel||this.childrenEmpty(e))},e.prototype.setLodGlobalDirty=function(){this._lodGlobalDirty=!0,this.lodGlobalDirtyChanged(this._lodGlobalDirty)},e.prototype.lodSwapBundleLoaded=function(e){this.setLodGlobalDirty()},Object.defineProperty(e.prototype,"requiresLODGlobalHandling",{get:function(){return null!=this._rootId&&(!0===this._lodGlobalDirty||this.layerView.view.resourceController.usedMemory>1.1)},enumerable:!0,configurable:!0}),e.prototype.lodGlobalHandling=function(){if(this.requiresLODGlobalHandling){var e=this._rootId,t=this.layerView.view.resourceController.usedMemory,r=Math.max(0,Math.floor(10*(t-1)));i.clear(),this._lodGlobalHandlingRecursion(e,r),this.layerView.removeNodeData(i),i.clear(),this._lodGlobalDirty=!1,this.lodGlobalDirtyChanged(this._lodGlobalDirty)}},e.prototype._lodGlobalHandlingRecursion=function(e,t){var r=this._nodeIndex[e];if(null==r)return!1;var n=this._nodeTraversalState(r),o=n.isChosen&&(!n.nodeHasLOD||n.lodLevel===this._maxLodLevel),a=this.layerView.isNodeLoaded(r);if(a&&null!=this.layerView.setPolygonOffset){var s=!o;this.layerView.setPolygonOffset(r,s)}if(o&&a)return this._removeChildrenRecursive(r),!0;var l=!1;if(null!=r.children&&0!==r.children.length){l=!0;for(var u=0,c=r.children;u<c.length;u++){var d=c[u],p=this._nodeIndex[d.id];if(p?this._isGeometryVisible(p):this._isNodeVisible(d)){var f=this._lodGlobalHandlingRecursion(d.id,t);l=l&&f}}}a&&!o&&(l||i.length<t)&&(i.push(r),a=!1);var h=!r.featureData||0===r.featureData.length;return l||a||h},e.prototype._removeChildrenRecursive=function(e){if(null!=e.children)for(var t=0,r=e.children;t<r.length;t++){var n=r[t],o=this._nodeIndex[n.id];null!=o&&(this._removeChildrenRecursive(o),i.push(o))}},e.prototype._subtreeEmpty=function(e){return!this.layerView.isNodeLoaded(e)&&this.childrenEmpty(e)},e.prototype.childrenEmpty=function(e){if(null==e.children)return!0;for(var t=0,r=e.children;t<r.length;t++){var n=r[t];if(this._isNodeVisible(n)){var i=this._nodeIndex[n.id];if(null!=i&&!this._subtreeEmpty(i))return!1}}return!0},e}(),i=new r;return n}.apply(null,n))||(e.exports=i)},1401:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(380),r(449),r(339),r(340),r(350),r(794),r(780),r(349)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u){var c=function(){function e(t,r,n,i,s){this.loader=t,this.logger=r,this.defaultGeometrySchema=n,this.requiredAttributes=i,this.options=s,this.cancelled=!1,this.loadShared=function(t){if(null==t.sharedResource)return o.resolve({});var r=a.makeAbsolute(t.sharedResource.href,t.baseUrl);return this.load(r,"json").then(function(t){return e.fixTextureEncodings(t),e.addAbsoluteHrefTexture(t,r),t})}}return e.prototype.cancelAll=function(){this.cancelled=!0},e.prototype.load=function(e,t){var n=this.loader.request(e,t),i=new r;return n.then(function(e,t){i.resolve(t)},function(t){i.reject(new Error("Failed to load: "+e))}),i.promise},e.prototype.loadAttribute=function(e,t,r){var n=a.makeAbsolute(r,e);return this.load(n,"binary").then(function(e){return s.readBinaryAttribute(t,e)})},e.prototype.loadAttributes=function(e,t,r){var n=this,i=r.map(function(r){return null==e.attributeData||null==e.attributeData[r.index]?(n.logger.error("Missing attributeData for '"+r.name+"' on node '"+e.id+"'"),o.resolve(null)):n.loadAttribute(t,r.attributeStorageInfo,e.attributeData[r.index].href).catch(function(t){return n.logger.error("Failed to load attributeData for '"+r.name+"' on node '"+e.id+"'"),null})});return o.all(i).then(function(e){for(var t={},n=0;n<r.length;++n)e[n]&&(t[r[n].name]=e[n]);return t})},e.prototype.prepareBinaryGeometryData=function(e,t,r,n){var o=e.geometries[0];if(i.mixin(o.params,r),n||null!=r.vertexAttributes.region||delete r.vertexAttributes.region,null!=r.featureAttributes){var a=r.featureAttributes;if(a.faceRange){var u=s.createTypedView(t,a.faceRange),c=a.faceRange.valuesPerElement,d=r.header.fields.featureCount;e.componentOffsets=l.convertFlatRangesToOffsets(u,d,c)}if(a.id){e.featureIds=[];var p=1,f=s.valueType2TypedArrayClassMap[a.id.valueType];"UInt64"===a.id.valueType&&(f=Uint32Array,p=2);for(var h=new f(t,a.id.byteOffset,a.id.count*a.id.valuesPerElement*p),m=0;m<r.header.fields.featureCount;m++)if(e.featureIds[m]=h[m*a.id.valuesPerElement*p],2===p){var v=h[m*a.id.valuesPerElement*p+1];if(v>=2097150)throw new Error("ID exceeded maximum range supported by javascript (max = 53bit-1 = 9007199254740991)");e.featureIds[m]+=4294967296*v}}}},e.prototype.loadBundleData=function(e,t){var r=this,n=e.baseUrl,i=null,l=this.loadShared(e),u=null;null!=this.requiredAttributes&&(u=this.loadAttributes(e,n,this.requiredAttributes));var c=null;if(null!=e.geometryData){var d=e.geometryData[t],p=a.makeAbsolute(d.href,n);c=this.load(p,"binary")}return l.then(function(n){return r.handleCancelled(),(r.options.loadFeatureData?r.loadFeatureData(e,t):o.resolve(null)).then(function(t){r.handleCancelled();var a,l=r.options.loadFeatureData?r.collectGeometries(e,t,n):r.meshPyramidGeometryData(e,n);a=null!=c?c.then(function(e){i=e;var t=Object.keys(n.materialDefinitions)[0],o=n.materialDefinitions[t].params.vertexRegions,a=s.createGeometryDataIndex(e,r.defaultGeometrySchema,o);return r.prepareBinaryGeometryData(l[0],e,a,o),l}):o.resolve(l);var d=r.loadTextures(l,n);return o.all([d,a,u])}).then(function(e){var t=e[0],o=e[1],a=e[2];r.handleCancelled();var s=null;return a&&(s={attributeData:a,loadedAttributes:r.requiredAttributes}),{allGeometryData:o,attributeDataInfo:s,geometryBuffer:i,sharedResource:n,textureData:t}})})},e.addAbsoluteHrefTexture=function(e,t){var r=e.textureDefinitions;if(null!=r)for(var n=0,i=Object.keys(r);n<i.length;n++)for(var o=0,s=r[i[n]].images;o<s.length;o++){var l=s[o];Array.isArray(l.href)?l.hrefConcat=l.href.map(function(e){return a.makeAbsolute(e,t)}):l.hrefConcat=a.makeAbsolute(l.href,t)}},e.fixTextureEncodings=function(e){var t=e.textureDefinitions;if(null!=t)for(var r in t){var n=t[r];if(Array.isArray(n.encoding))for(var i=0;i<n.encoding.length;i++){var o;"data:"===(o=n.encoding[i]).substring(0,5)&&(n.encoding[i]=o.substring(5))}else"data:"===(o=n.encoding).substring(0,5)&&(n.encoding=o.substring(5))}},e.prototype.loadTexture=function(e,t,r,n){var i=this;return n===l.DDS_ENCODING_STRING?this.load(e,"binary").then(function(e){return i.handleCancelled(),{i3sTexId:t,data:e,encoding:n}}):this.load(e,"image").then(function(e){var o=e;if(i.handleCancelled(),r&&e.width*e.height>=4096){var a=Math.ceil(e.width/2),s=Math.ceil(e.height/2),l=document.createElement("canvas");l.width=a,l.height=s,l.getContext("2d").drawImage(e,0,0,a,s),o=l}return{i3sTexId:t,data:o,encoding:n}})},e.prototype.loadTextures=function(t,r){for(var n=[],i=0;i<t.length;i++){var a=t[i].geometries;if(null!=a)for(var s=0,c=a;s<c.length;s++){var d=c[s].params.textureID||"none";if("none"!==d){null!=r.textureDefinitions&&null!=r.textureDefinitions[d]||this.logger.warn("textureDefinitions missing in shared resource. i3sTexId: "+d);var p=r.textureDefinitions[d];if(u.assert(void 0!==p,"geometry wants unknown texture "+d),0===p.images.length)continue;var f=p.images.length-1,h=p.images[f],m=this.options.textureFormat===e.TextureFormat.Compressed,v=this.options.textureFormat===e.TextureFormat.Downsampled,g=l.getAppropriateTextureEncoding(p.encoding,m),y=g>-1?p.encoding[g]:p.encoding,b=g>-1?h.hrefConcat[g]:h.hrefConcat;this.options.loadTextureData?n.push(this.loadTexture(b,d,v,y)):n.push({i3sTexId:d,encoding:y,data:null})}}}return o.all(n)},e.prototype.meshPyramidGeometryData=function(e,t){return[{featureIds:[],geometries:[{type:"ArrayBufferView",params:{materialID:t.materialDefinitions?Object.keys(t.materialDefinitions)[0]:null,textureID:t.textureDefinitions?Object.keys(t.textureDefinitions)[0]:null}}],featureDataPosition:[0,0,0]}]},e.prototype.collectGeometries=function(e,t,r){for(var n=[],i=0,o=t.featureData;i<o.length;i++){var a=o[i],s=a.geometries;if(null!=s)for(var l=0;l<s.length;l++){var u=a.geometries[l];n.push({featureIds:[a.id],featureDataPosition:a.position,geometries:[u]})}else null!=a.position&&n.push({featureIds:[a.id],featureDataPosition:a.position,geometries:null})}return n},e.prototype.loadFeatureData=function(e,t){var r=a.makeAbsolute(e.featureData[t].href,e.baseUrl);return this.load(r,"json")},e.prototype.handleCancelled=function(){if(this.cancelled)throw new n},e}();return function(e){!function(e){e[e.Compressed=0]="Compressed",e[e.Normal=1]="Normal",e[e.Downsampled=2]="Downsampled"}(e.TextureFormat||(e.TextureFormat={}))}(c||(c={})),c}.apply(null,n))||(e.exports=i)},1402:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(400),r(963),r(706),r(604),r(780),r(344),r(622),r(779),r(388),r(349)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,c,d){return function(){function e(e,t,o,a,u,c,d,p){void 0===p&&(p={}),this.indexSR=e,this._renderCoordsHelper=t,this.extent=u,this.elevationProvider=c,this.options=p,this._computedOBBs={},this._computedMBSs={},this._isNodeVisibleCached={},this.fp=[],this._idleCamera=!0,this.maxDistance=0,this.maxLodLevel=2,this._tmp1=[0,0,0],this._tmp2=[0,0,0],this._tmp3=[0,0,0],this._tmp0=[0,0,0],this.supportedMetrics=["maxScreenThreshold","screenSpaceRelative","removedFeatureDiameter","distanceRangeFromDefaultCamera"],this.screenspaceErrorBias=p.screenspaceErrorBias||1,this.progressiveLoadFactor=p.progressiveLoadFactor||1,this.enableLoD=!p.disableLod;for(var f=0;f<8;++f)this.fp[f]=l.plane.create();this.updateCamera(o),this._poi=s.vec3d.create(a),this.engineSR=this._renderCoordsHelper.spatialReference,d?(this._elevationContext=new n,this._elevationContext.featureExpressionInfoContext=i.createContext(i.extractExpressionInfo(d,!1)),this._elevationContext.mixinApi(d)):this._elevationContext=null,this.tmpPoint=new r({x:0,y:0,z:0,spatialReference:e})}return e.prototype.updateCamera=function(e){d.matrixToFrustumPlanes(e.viewMatrix,e.projectionMatrix,this.fp),this._screenSizeFactor=1/e.perPixelRatio,this._camPos=e.eye,this._isNodeVisibleCached={}},e.prototype.updateNode=function(e){delete this._isNodeVisibleCached[e]},e.prototype.updatePointOfInterest=function(e){s.vec3d.set(e,this._poi),this.maxDistance=0},e.prototype.updateScreenSpaceErrorBias=function(e){var t=this.screenspaceErrorBias;return this.screenspaceErrorBias=e,t},e.prototype.setCameraIdle=function(e){this._idleCamera!==e&&(this._idleCamera=e,this._isNodeVisibleCached={})},e.prototype.updateExtent=function(e){this.extent=e,this._isNodeVisibleCached={}},e.prototype.computeMbs=function(e){var t=this._computedMBSs[e.id];return t||(t=s.vec4d.createFrom(e.mbs[0],e.mbs[1],e.mbs[2],-1),this._computedMBSs[e.id]=t),t[3]<0&&(s.vec4d.set(e.mbs,t),this._elevationContext&&t[3]<1e5&&(this.tmpPoint.x=t[0],this.tmpPoint.y=t[1],this.tmpPoint.z=t[2],t[2]=o.computeElevation(this.elevationProvider,this.tmpPoint,this._elevationContext,this._renderCoordsHelper,null)),c.mbsToMbs(t,this.indexSR,t,this.engineSR)),t},e.prototype.computeObb=function(e){if(e.obb&&!(e.obb.halfSize[0]<0)){var t=this._computedOBBs[e.id];return t||((t=u.clone(e.obb)).halfSize[0]=-1,this._computedOBBs[e.id]=t),t.halfSize[0]<0&&(t.halfSize[0]=e.obb.halfSize[0],s.vec3d.set(e.obb.center,t.center),this._elevationContext&&e.mbs[3]<1e5&&(this.tmpPoint.x=e.obb.center[0],this.tmpPoint.y=e.obb.center[1],this.tmpPoint.z=e.obb.center[2],t.center[2]=o.computeElevation(this.elevationProvider,this.tmpPoint,this._elevationContext,this._renderCoordsHelper,null)),c.bufferToBuffer(t.center,this.indexSR,0,t.center,this.engineSR,0,1)),t}},e.prototype._isNodeVisible=function(e){var t=this.computeMbs(e);if(!this.isMBSinExtent(t))return!1;if(e.hasServiceOBB&&e.obb){var r=this.computeObb(e);return u.isVisible(r,this.fp)}return this.isMBSVisible(t)},e.prototype.isNodeVisible=function(e){return!this.enableLoD||(this._idleCamera?null!=this._isNodeVisibleCached[e.id]?this._isNodeVisibleCached[e.id]:(this._isNodeVisibleCached[e.id]=this._isNodeVisible(e),this._isNodeVisibleCached[e.id]):this._isNodeVisible(e))},e.prototype.isGeometryVisible=function(e){if(!this.isNodeVisible(e))return!1;if(e.hasServiceOBB)return!0;var t=this.computeObb(e);return!t||u.isVisible(t,this.fp)},e.prototype.invalidateCache=function(e){if(null==e){for(var t=0,r=Object.keys(this._computedMBSs);t<r.length;t++){var n=r[t];this._computedMBSs[n][3]=-1}for(var i=0,o=Object.keys(this._computedOBBs);i<o.length;i++){n=o[i];this._computedOBBs[n].halfSize[0]=-1}}else this._computedMBSs[e]&&(this._computedMBSs[e][3]=-1),this._computedOBBs[e]&&(this._computedOBBs[e].halfSize[0]=-1)},e.prototype.isMBSinExtent=function(e){return!this.extent||0!==a.intersectBoundingBoxWithMbs(this.extent,e)},e.prototype.isMBSVisible=function(e){var t=e[0],r=e[1],n=e[2],i=e[3],o=this.fp;return o[0][0]*t+o[0][1]*r+o[0][2]*n+o[0][3]<=i&&o[1][0]*t+o[1][1]*r+o[1][2]*n+o[1][3]<=i&&o[2][0]*t+o[2][1]*r+o[2][2]*n+o[2][3]<=i&&o[3][0]*t+o[3][1]*r+o[3][2]*n+o[3][3]<=i&&o[4][0]*t+o[4][1]*r+o[4][2]*n+o[4][3]<=i&&o[5][0]*t+o[5][1]*r+o[5][2]*n+o[5][3]<=i},e.prototype.calcScreenSpaceSize=function(e,t){var r=this.computeMbs(e),n=r[3],i=s.vec3d.dist2(r,this._camPos)-n*n;return i<0?.5*Number.MAX_VALUE:t/Math.sqrt(i)*this._screenSizeFactor},e.prototype.calcCameraDistance=function(e){var t=this.computeMbs(e);return Math.max(0,s.vec3d.dist(t,this._camPos)-t[3])},e.prototype.calcAngleDependentLoD=function(e){var t=this.computeMbs(e),r=t[3],n=(Math.abs(t[0]*(t[0]-this._camPos[0])+t[1]*(t[1]-this._camPos[1])+t[2]*(t[2]-this._camPos[2]))/s.vec3d.length(t)+r)/s.vec3d.dist(t,this._camPos);return Math.min(1,n)},e.prototype.hasLOD=function(e){return null!=e.lodSelection},e.prototype.hasFeatures=function(e){return null!=e.featureData},e.prototype.getDistancePlanarMode=function(e,t,r){var n=e[0]-t[0],i=e[1]-t[1],o=e[2]-t[2],a=n+n+i*i;if(a<=r*r)return Math.abs(o);var s=Math.sqrt(a)-r;return Math.sqrt(o*o+s*s)},e.prototype.getDistanceGlobeMode=function(e,t,r){var n=s.vec3d.length(t),i=s.vec3d.length(e)-n;if(s.vec3d.scale(e,s.vec3d.dot(e,t)/s.vec3d.length2(e),this._tmp0),s.vec3d.dist2(t,this._tmp0)<=r*r)return Math.abs(i);var o=s.vec3d.scale(t,1/n,this._tmp0),a=r,l=n,u=a*a/2/l,c=s.vec3d.scale(o,l-u,this._tmp1),d=e,p=s.vec3d.subtract(d,c,this._tmp2),f=s.vec3d.subtract(p,s.vec3d.scale(o,s.vec3d.dot(o,p),this._tmp3),this._tmp2),h=s.vec3d.add(c,s.vec3d.scale(f,a/s.vec3d.length(f),this._tmp2),this._tmp2),m=s.vec3d.dist(d,h);if(i>=2e5){var v=s.vec3d.subtract(d,h,this._tmp1),g=s.vec3d.dot(v,o)/s.vec3d.length(v);g<.08&&(g=1e-4),m/=g}return m},e.prototype.getDistance=function(e,t,r){return this.engineSR===c.SphericalECEFSpatialReference?this.getDistanceGlobeMode(e,t,r):this.getDistancePlanarMode(e,t,r)},e.prototype._selectErrorMetric=function(e){for(var t=0;t<e.length;t++)if(this.supportedMetrics.indexOf(e[t].metricType)>=0)return e[t];return null},e.prototype.getLodLevel=function(e){if(!e.lodSelection||e.lodSelection.length<=0||!1===this.hasFeatures(e))return 0;if(null==e.children||0===e.children.length)return this.maxLodLevel;var t=this.enableLoD?this._selectErrorMetric(e.lodSelection):null;if(null==t)return 0;if(this.progressiveLoadFactor<1){var r=this.progressiveLoadFactor*this.screenspaceErrorBias,n=this.screenspaceErrorBias;return this.evaluateLODmetric(e,r,t)?this.evaluateLODmetric(e,n,t)?2:1:0}return this.evaluateLODmetric(e,this.screenspaceErrorBias,t)?this.maxLodLevel:0},e.prototype.evaluateLODmetric=function(e,t,r){switch(r.metricType){case"screenSpaceRelative":var n=this.computeMbs(e),i=2*this.getDistance(this._camPos,n,n[3])/this._screenSizeFactor;return r.maxError*t<=i;case"maxScreenThreshold":var o=this.calcScreenSpaceSize(e,e.mbs[3]*t);return this.options.angleDependentLoD&&(o*=this.calcAngleDependentLoD(e)),o<r.maxError;case"removedFeatureDiameter":return this.calcScreenSpaceSize(e,r.maxError)*t<10;case"distanceRangeFromDefaultCamera":return this.calcCameraDistance(e)>r.maxError*t}return!1},e.prototype.distToPOI=function(e){var t=this.computeMbs(e),r=s.vec3d.dist(t,this._poi)-t[3];return this.maxDistance=Math.max(this.maxDistance,r),r},e.prototype.distCameraToPOI=function(){return s.vec3d.dist(this._camPos,this._poi)},e}()}.apply(null,n))||(e.exports=i)},1403:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(366),r(701),r(460),r(1404),r(1407),r(1409),r(349)],void 0===(i=function(e,t,r,n,i,o,a,s,l){function u(){var e={};for(var t in c.ClientType)e[c.ClientType[t]]=0;return e[c.ClientType.TERRAIN]=15,e[c.ClientType.SCENE]=20,e[c.ClientType.SYMBOLOGY]=5,new a(e)}var c=function(){function e(t,a,s){void 0===a&&(a=i),void 0===s&&(s=n);var l=this;this._view=t,this._budget=null,this._memoryController=null,this._streamDataLoader=u(),this._frameWorkers=[],this._nextFrameWorker=0,this._idleWorkers=[],this._nextIdleWorker=0,this._idleUpdatesStartFired=!1,this._lastTargetChangeTime=0,this._handles=new r,this._frameTask=null,this.idleTimeout=300,this.idleBudget=100,this._budget=new e.Budget(s),this._lastTargetChangeTime=s(),this._memoryController=new o(this._view),this._handles.add(this._view.watch("state.camera",function(){return l.cameraChangedHandler()},!0)),this._frameTask=a.addFrameTask({update:function(e){return l.frameUpdate(e)}})}return e.prototype.destroy=function(){this._frameTask&&(this._frameTask.remove(),this._frameTask=null),this._handles.remove(),this._streamDataLoader&&(this._streamDataLoader.destroy(),this._streamDataLoader=null)},Object.defineProperty(e.prototype,"enableBudget",{set:function(e){this._budget.enabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"updating",{get:function(){return this._memoryController.updating},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxGpuMemory",{set:function(e){this._memoryController.setMaxGpuMemory(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"additionalCacheMemory",{set:function(e){this._memoryController.setAdditionalCacheMemory(e)},enumerable:!0,configurable:!0}),e.prototype.setMemoryDirty=function(){this._memoryController.setDirty()},Object.defineProperty(e.prototype,"memoryFactor",{get:function(){return this._memoryController.getMemoryFactor()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"usedMemory",{get:function(){return this._memoryController.getUsedMemory()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"memoryEvents",{get:function(){return this._memoryController.events},enumerable:!0,configurable:!0}),e.prototype.getMemCache=function(e,t){return this._memoryController.getMemCache(e,t)},e.prototype.getStreamDataSupplier=function(e,t){return new s(e,this._streamDataLoader,t)},e.prototype.registerIdleFrameWorker=function(e){var t=this;l.assert(!e.idleFrame||e.needsUpdate,"needsUpdate has to be specified if idleFrame is specified");var r={callbacks:e};return this.addIdleFrameWorker(r),{remove:function(){t.removeIdleFrameWorker(r)}}},e.prototype.registerFrameWorker=function(e){var t=this,r={callback:e};return this.addFrameWorker(r),{remove:function(){t.removeFrameWorker(r)}}},e.prototype.addIdleFrameWorker=function(e){this._idleWorkers.push(e),this.isIdle()&&this._idleUpdatesStartFired&&e.callbacks.idleBegin&&e.callbacks.idleBegin()},e.prototype.removeIdleFrameWorker=function(e){var t=this._idleWorkers,r=t.indexOf(e);l.assert(r>=0,"worker not registered"),this._idleUpdatesStartFired&&e.callbacks.idleEnd&&e.callbacks.idleEnd(),t.splice(r,1),this._nextIdleWorker>=t.length&&(this._nextIdleWorker=0)},e.prototype.addFrameWorker=function(e){this._frameWorkers.push(e)},e.prototype.removeFrameWorker=function(e){var t=this._frameWorkers,r=t.indexOf(e);l.assert(r>=0,"worker not registerted"),t.splice(r,1),this._nextFrameWorker>=this._frameWorkers.length&&(this._nextFrameWorker=0)},e.prototype.cameraChangedHandler=function(){this._lastTargetChangeTime=this._budget.now(),this.setMemoryDirty(),this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this.callIdleFrameWorkersEnd())},e.prototype.frameUpdate=function(e){var t=this.isIdle()?0:5,r=e.frameDuration-e.elapsedFrameTime-t,n=this.idleBudget-e.elapsedFrameTime;this._view._stage&&!this._view._stage.getIdleSuspend()&&(n=r);var i=Math.max(this.isIdle()?n:r,5);this._budget.reset(i),this._view.stateManager&&this._view.stateManager.step(e.deltaTime/1e3),this._memoryController.update();for(var o=0;o<this._frameWorkers.length;++o){var a=(this._nextFrameWorker+o)%this._frameWorkers.length;if(this._frameWorkers[a].callback(this._budget),this._budget.remaining()<t){this._nextFrameWorker=(a+1)%this._frameWorkers.length;break}}this.isIdle()&&!this._budget.done()&&(this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this.callIdleFrameWorkersBegin()),this.callIdleFrameWorkers())},e.prototype.isIdle=function(){return this._budget.now()-this._lastTargetChangeTime>this.idleTimeout},e.prototype.callIdleFrameWorkersBegin=function(){this._idleWorkers.forEach(function(e){e.callbacks.idleBegin&&e.callbacks.idleBegin()})},e.prototype.callIdleFrameWorkersEnd=function(){this._idleWorkers.forEach(function(e){e.callbacks.idleEnd&&e.callbacks.idleEnd()})},e.prototype.callIdleFrameWorkers=function(){for(var e=0;e<this._idleWorkers.length;++e){var t=(this._nextIdleWorker+e)%this._idleWorkers.length;if(this._budget.done())return void(this._nextIdleWorker=t);var r=this._idleWorkers[t];r.callbacks.needsUpdate&&r.callbacks.needsUpdate()&&r.callbacks.idleFrame(this._budget)}},e}();return function(e){!function(e){e.TERRAIN="terrain",e.SCENE="scene",e.SYMBOLOGY="symbology"}(e.ClientType||(e.ClientType={}));var t=function(){function e(e){this._nowFunc=e,this.enabled=!0,this.begin=0,this.budget=0}return e.prototype.now=function(){return this._nowFunc()},e.prototype.reset=function(e){this.begin=this.now(),this.budget=this.enabled?e:Number.MAX_VALUE},e.prototype.done=function(){return this.enabled&&this.elapsed()>=this.budget},e.prototype.remaining=function(){return this.enabled?Math.max(this.budget-this.elapsed(),0):Number.POSITIVE_INFINITY},e.prototype.elapsed=function(){return this.now()-this.begin},e}();e.Budget=t}(c||(c={})),c}.apply(null,n))||(e.exports=i)},1404:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(343),r(1405),r(967),r(1406)],void 0===(i=function(e,t,r,n,i,o){var a=r.getLogger("esri.views.3d.support.MemoryController");return function(){function e(e){this._view=e,this._minQuality=.1,this._maxQuality=1,this._memoryHWM=1,this._memoryLWM=.75,this._divideRate=1.3,this._throttle=5,this.events=new i.Evented,this._maxMemory=500,this._additionalCacheMemory=100,this._quality=1,this._stableQuality=0,this._throttled=0,this._memoryUsed=0,this._memoryCommitted=0,this._cacheStorage=new o.Storage,this.updating=!1}return e.prototype.getMemCache=function(e,t){return new o(e,this._cacheStorage,t)},e.prototype.setMaxGpuMemory=function(e){null!=e&&e>0&&(this._maxMemory=e,this.setDirty())},e.prototype.setAdditionalCacheMemory=function(e){null!=e&&e>=0&&(this._additionalCacheMemory=e,this.setDirty())},e.prototype.disableMemCache=function(){this._additionalCacheMemory=-4096},e.prototype.getMemoryFactor=function(){return this._quality},e.prototype._updateQuality=function(e){return(e=Math.min(Math.max(e,this._minQuality),this._maxQuality))!==this._quality&&(this._quality=e,this.events.emit("quality-changed",this._quality),!0)},e.prototype.getUsedMemory=function(){return this._memoryUsed},e.prototype.setDirty=function(){this._stableQuality=0},e.prototype.update=function(){if(this._updateMemory(),!(this._memoryCommitted<=0)){this._throttled=Math.max(0,this._throttled-1);var e=this._layersUpdating();if(e){if(this._quality<=this._minQuality)return;(this._memoryCommitted>1.1*this._memoryHWM||this._memoryUsed>this._memoryHWM)&&(this._stableQuality>0?this._updateQuality(this._stableQuality):(0===this._throttled||this._memoryUsed>1.05)&&(this._updateQuality(this._quality/this._divideRate),this._throttled=this._throttle))}else if(this._memoryUsed>this._memoryHWM&&(this._stableQuality=0,e=this._updateQuality(this._quality/this._divideRate)),this._memoryCommitted<this._memoryLWM&&this._quality<this._maxQuality&&this._stableQuality!==this._quality){this._stableQuality=this._quality;var t=.1*(this._memoryLWM-this._memoryCommitted+.1);e=this._updateQuality(this._quality+t)}this.updating!==e&&(this.updating=e,this.events.emit("updating-changed",this.updating))}},e.prototype._layersUpdating=function(){var e=!1;return this._view.allLayerViews.forEach(function(t){e=e||t.updating}),e},e.prototype._updateMemory=function(){var e=0,t=0;this._view.basemapTerrain&&this._view.basemapTerrain.getUsedMemory&&(e+=this._view.basemapTerrain.getUsedMemory());var r=this._view._stage&&this._view._stage.view&&this._view._stage.view.getEdgeView();r&&(e+=r.getGpuMemoryUsage()),this._view.allLayerViews&&this._view.allLayerViews.forEach(function(r){n.isMemoryManagedLayerView(r)&&(e+=r.getUsedMemory(),t+=r.getUnloadedMemory())});var i=null==this._warnMemoryUsage||Math.round(10*e)!==Math.round(10*this._warnMemoryUsage),o=1048576*this._maxMemory;if(e>o&&i){this._warnMemoryUsage=e;var s=function(e){return(e/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB"},l=Math.round(100*this._quality);a.warn("GPU Memory Limit exceeded! Limit: "+s(o)+" Current: "+s(e)+" Projected: "+s(e+t)+" Quality: "+l+"%")}this._memoryUsed=e/o,this._memoryCommitted=(e+t)/o;var u=o-e;this._cacheStorage.maxSize=Math.max(0,u+1048576*this._additionalCacheMemory),this.events.emit("memory-used",this._memoryUsed)},e}()}.apply(null,n))||(e.exports=i)},1405:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.isMemoryManagedLayerView=function(e){return"function"==typeof e.getUsedMemory}}.apply(null,n))||(e.exports=i)},1406:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(339),r(411)],void 0===(i=function(e,t,r,n){var i=new n,o=function(){function e(e,t,r){this._namespace=e,this._storage=t,this._priority=0,this._removeFunc=!1,this._hit=0,this._miss=0,i.push(this),this._namespace+=":",r&&(this._storage.registerRemoveFunc(this._namespace,r),this._removeFunc=!0)}return Object.defineProperty(e.prototype,"priority",{get:function(){return this._priority},set:function(e){isNaN(e)||(this._priority=Math.max(0,e))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"namespace",{get:function(){return this._namespace.slice(0,-1)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hitRate",{get:function(){return this._hit/(this._hit+this._miss)},enumerable:!0,configurable:!0}),e.prototype.resetHitRate=function(){this._hit=this._miss=0},e.prototype.destroy=function(){this._storage.clear(this._namespace),this._removeFunc&&this._storage.deregisterRemoveFunc(this._namespace),i.removeUnordered(this)},e.prototype.put=function(e,t,r){this._storage.put(this._namespace+e,t,r,this._priority)},e.prototype.pop=function(e){var t=this._storage.pop(this._namespace+e);return void 0===t?++this._miss:++this._hit,t},e.prototype.clear=function(){this._storage.clear(this._namespace)},e.prototype.clearAll=function(){this._storage.clearAll()},e.prototype.getSize=function(){return this._storage.getSize()},e.prototype.getMaxSize=function(){return this._storage.maxSize},e.prototype.getStats=function(){return this._storage.getStats()},e.prototype.resetStats=function(){this._storage.resetStats()},e}();return function(e){var t=function(){function e(){this._db=new Map,this._size=0,this._age=0,this._hit=0,this._miss=0,this._maxSize=10485760,this._removeFuncs=[]}return e.prototype.registerRemoveFunc=function(e,t){this._removeFuncs.push([e,t])},e.prototype.deregisterRemoveFunc=function(e){this._removeFuncs=this._removeFuncs.filter(function(t){return t[0]!==e})},Object.defineProperty(e.prototype,"maxSize",{get:function(){return this._maxSize},set:function(e){this._maxSize=Math.max(e,0),this._size>this._maxSize&&this._removeEntries()},enumerable:!0,configurable:!0}),e.prototype.put=function(e,t,r,n){if(r>this._maxSize){if(this._db.has(e)){var i=this._db.get(e);this._size-=i.size,this._db.delete(e)}this._notifyRemoved(e,t)}else if(!r||r<0)console.warn("Refusing to cache entry with invalid size "+r);else{if(this._db.has(e)){i=this._db.get(e);this._notifyRemoved(e,i.entry),this._size+=r-i.size,i.entry=t,i.lastUsed=this._age+n,i.size=r}else this._db.set(e,{entry:t,size:r,lastUsed:this._age+n}),this._size+=r;++this._age,this._size>this._maxSize&&this._removeEntries()}},e.prototype.pop=function(e){if(this._db.has(e)){var t=this._db.get(e);return this._size-=t.size,this._db.delete(e),++this._hit,t.entry}++this._miss},e.prototype.getSize=function(){return this._size},e.prototype.getStats=function(){var e=this,t={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},n={},o=this._age,a=this._age;this._db.forEach(function(e,t){o=Math.min(o,e.lastUsed),a=Math.max(a,e.lastUsed),i.forEach(function(i){var o=i.namespace;if(r.startsWith(t,o)){var a=n[o]||0;return n[o]=a+e.size,!1}})}),t.Entries+=" / "+o+" - "+a;var s={};i.forEach(function(e){var t=e.namespace;if(!isNaN(e.hitRate)&&e.hitRate>0){var r=n[t]||0;n[t]=r,s[t]=Math.round(100*e.hitRate)+"%"}else s[t]="0%"});var l=Object.keys(n);return l.forEach(function(t){return n[t]=n[t]/e._size*100}),l.sort(function(e,t){return n[t]-n[e]}),l.forEach(function(e){return t[e]=Math.round(n[e])+"% / "+s[e]}),t},e.prototype.resetStats=function(){this._hit=this._miss=0,i.forEach(function(e){return e.resetHitRate()})},e.prototype.clear=function(e){var t=this;this._db.forEach(function(n,i){r.startsWith(i,e)&&(t._size-=n.size,t._db.delete(i),t._notifyRemoved(i,n.entry))})},e.prototype.clearAll=function(){var e=this;this._db.forEach(function(t,r){e._notifyRemoved(r,t.entry)}),this._size=0,this._db.clear()},e.prototype._getHitRate=function(){return this._hit/(this._hit+this._miss)},e.prototype._notifyRemoved=function(e,t){this._removeFuncs.forEach(function(n){r.startsWith(e,n[0])&&n[1](t)})},e.prototype._removeEntries=function(){var e=[];this._db.forEach(function(t,r){e.push([t.lastUsed,r])}),e.sort(function(e,t){return e[0]-t[0]});for(var t=0,r=e;t<r.length;t++){var n=r[t][1],i=this._db.get(n);if(this._size-=i.size,this._db.delete(n),this._notifyRemoved(n,i.entry),this._size<=.9*this.maxSize)return}},e}();e.Storage=t}(o||(o={})),o}.apply(null,n))||(e.exports=i)},1407:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(351),r(382),r(339),r(1408),r(819),r(792),r(349)],void 0===(i=function(e,t,r,n,i,o,a,s,l){var u;return function(e){e[e.QUEUED=1]="QUEUED",e[e.DOWNLOADING=2]="DOWNLOADING",e[e.CANCELLED=4]="CANCELLED"}(u||(u={})),function(){function e(e){this.tasks=new Map,this.clientPromiseToTask=new Map,this.loadQueue=new o(this.startLoading.bind(this),this.doneLoadingCallback,this,e)}return e.prototype.destroy=function(){var e=this;this.tasks.forEach(function(t){for(var r=0,n=t.clientPromises;r<n.length;r++){var i=n[r];i.isRejected()||i.reject(t.url,null),e.cancelTask(i)}}),this.loadQueue.clear(),this.loadQueue=null,this.tasks=null,this.clientPromiseToTask=null},e.prototype.request=function(e,t,r){var n=this,i=new a.Promise(function(){n.cancel(i)});return this.createOrUpdateTask(e,t,r,i),i},e.prototype.createTask=function(e,t,r,n,i){var o={url:e,docType:t,clientType:r,key:n,result:null,status:u.QUEUED,clientPromises:[],downloadObj:null,_cancelledInQueue:!1,startTime:0,duration:0,size:0};this.updateTask(o,i),this.tasks.set(n,o),this.loadQueue.push(o)},e.prototype.cancel=function(e){this.cancelTask(e)},e.prototype.hasPendingDownloads=function(){return this.tasks.size>0},Object.defineProperty(e.prototype,"tests",{get:function(){return{loadQueue:this.loadQueue}},enumerable:!0,configurable:!0}),e.prototype.taskKey=function(e,t,r){return e+":"+t+":"+r},e.prototype.updateTask=function(e,t){this.clientPromiseToTask.set(t,e),e.clientPromises.push(t)},e.prototype.createOrUpdateTask=function(e,t,r,n){var i=this.taskKey(e,t,r),o=this.tasks.get(i);o?this.updateTask(o,n):this.createTask(e,t,r,i,n)},e.prototype.cancelTask=function(e){var t=this.clientPromiseToTask.get(e);t&&(n.removeUnordered(t.clientPromises,e),this.clientPromiseToTask.delete(e),0===t.clientPromises.length&&(t.status===u.DOWNLOADING&&(this.loadQueue.workerCancelled(t),t.status=u.CANCELLED,t.downloadObj.cancel(),t.downloadObj=null),t.status=u.CANCELLED,this.tasks.delete(t.key)))},e.prototype.doneLoadingCallback=function(e,t){l.assert(e.status===u.DOWNLOADING);for(var r=e.result,n=0,o=e.clientPromises;n<o.length;n++){var a=o[n];this.clientPromiseToTask.delete(a),t?a.isRejected()||a.reject(e.url,t):(r||(r=i.clone(e.result)),a.done(e.url,r),r instanceof HTMLImageElement||(r=null))}this.tasks.delete(e.key)},e.prototype.startLoading=function(e,t){if(e.status===u.CANCELLED)return!1;var n,i;switch(e.status=u.DOWNLOADING,e.docType){case"binary":i="array-buffer",n=0;break;case"image":i="image";break;default:i="json"}return e.startTime=s.now(),e.downloadObj=r(e.url,{responseType:i,timeout:n}),e.downloadObj.then(function(r){e.duration=s.now()-e.startTime,e.size="binary"===e.docType?r.data.byteLength:0,e.result=r.data,t(e)},function(r){e.downloadObj.isCanceled()||t(e,r)}),!0},e}()}.apply(null,n))||(e.exports=i)},1408:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(382),r(349)],void 0===(i=function(e,t,r,n){return function(){function e(e,t,r,n){for(var i in this.workerFunc=e,this.robin=0,this.type2id={},this.tasks=[],this.typeNumWorkers=[],this.typeWorkerQuota=[],this.typeStatistics=[],this.totalNumWorkers=0,this.maxTotalNumWorkers=0,this.numTypes=0,n)this.tasks[this.robin]=[],this.typeNumWorkers[this.robin]=0,this.typeStatistics[this.robin]={requests:0,size:0,duration:0,speed:0},this.typeWorkerQuota[this.robin]=n[i],this.type2id[i]=this.robin++,this.maxTotalNumWorkers+=n[i];this.numTypes=this.tasks.length,this.robin=0;var o=this;this.taskCallback=function(e){e._cancelledInQueue||(t.apply(r,arguments),o.taskFinished(e))}}return e.prototype.setWorkerQuota=function(e){for(var t in n.assert(r.equals(Object.keys(this.typeWorkerAllication),Object.keys(e))),this.typeWorkerAllication=e,this.maxTotalNumWorkers=0,e){var i=this.type2id[t];this.typeWorkerQuota[i]=e[t],this.maxTotalNumWorkers+=e[t]}},e.prototype.setWorkerFunc=function(e){this.workerFunc=e},e.prototype.push=function(e){var t=this.type2id[e.clientType];this.totalNumWorkers<this.maxTotalNumWorkers?(this.typeNumWorkers[t]++,this.totalNumWorkers++,this.workerFunc(e,this.taskCallback)):this.tasks[t].push(e)},e.prototype._getStatsForType=function(e){var t=this.type2id[e];return{quota:this.typeWorkerQuota[t],workers:this.typeNumWorkers[t],queueSize:this.tasks[t].length,requestStats:this.typeStatistics[t]}},e.prototype.removeTasks=function(e,t){for(var r=[],n=0,i=this.tasks[this.type2id[t]];n<i.length;n++){var o=i[n];-1===e.indexOf(o)&&r.push(o)}this.tasks[this.type2id[t]]=r},e.prototype.workerCancelled=function(e){this.taskFinished(e),e._cancelledInQueue=!0},e.prototype.clear=function(){for(var e=0;e<this.tasks.length;e++)this.tasks[e]=[]},e.prototype.taskFinished=function(e){var t=this.type2id[e.clientType];this.typeNumWorkers[t]--,this.totalNumWorkers--,this.typeStatistics[t].requests++,this.typeStatistics[t].size+=e.size||0,this.typeStatistics[t].duration+=e.duration||0,this.typeStatistics[t].speed=this.typeStatistics[t].duration>0?this.typeStatistics[t].size/this.typeStatistics[t].duration:0,n.assert(this.typeNumWorkers[t]>=0),this.next()},e.prototype.next=function(){var e=this.robin,t=!1;do{this.typeNumWorkers[e]<this.typeWorkerQuota[e]&&this.processQueue(e)&&(t=!0),e=(e+1)%this.numTypes}while(!t&&e!==this.robin);if(!t)do{this.processQueue(e)&&(t=!0),e=(e+1)%this.numTypes}while(!t&&e!==this.robin);this.robin=e},e.prototype.processQueue=function(e){for(;this.tasks[e].length>0;)if(this.workerFunc(this.tasks[e].shift(),this.taskCallback))return this.typeNumWorkers[e]++,this.totalNumWorkers++,!0;return!1},e}()}.apply(null,n))||(e.exports=i)},1409:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){return function(){function e(e,t,r){this._clientType=e,this._loader=t,this._activeRequests=null,r&&r.trackRequests&&(this._activeRequests=new Map)}return e.prototype.request=function(e,t){var r=this,n=this._loader.request(e,t,this._clientType);if(this._activeRequests){this._activeRequests.set(e,n);var i=function(){r._activeRequests.delete(e)};n.then(i,i)}return n},e.prototype.cancelRequest=function(e){this._loader.cancel(e)},e.prototype.cancelAll=function(){var e=this;this._activeRequests&&(this._activeRequests.forEach(function(t){e._loader.cancel(t)}),this._activeRequests.clear())},e.prototype.hasPendingDownloads=function(){return this._loader.hasPendingDownloads()},e}()}.apply(null,n))||(e.exports=i)},1410:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(433),r(342),r(340),r(598),r(394)],void 0===(i=function(e,t,r,n,i,o,a){return function(){function e(e,t,r){this._layer=e,this._support=t,this._options=r}return e.prototype.queryExtent=function(e){var t=this;return this._rejectUnsupported(e).then(function(){var r=0,n=t._support.createExtentBuilder();return t._forAllQueried(e,function(e){r++,n.add(e)}),{count:r,extent:0===r?null:n.getExtent()}})},e.prototype.queryFeatureCount=function(e){var t=this;return this._rejectUnsupported(e).then(function(){var r=0;return t._forAllQueried(e,function(){return r++}),r})},e.prototype.queryFeatures=function(e){var t=this;return this._rejectUnsupported(e).then(function(){var o=[],a=e&&e.outFields,s=[];return t._forAllQueried(e,function(e){return s.push(t._support.createGraphic(e))},function(e){a&&(o.push(t._support.requestFields(e,s,a)),s=[])})>0&&!e.num?i.reject(new n("Unsupported Query","Large feature query, use Query.num and Query.start to batch")):(a||o.push(i.resolve(s)),r(o))}).then(function(e){for(var r=[],n=0;n<e.length;++n)for(var i=e[n],s=0;s<i.length;++s)r.push(o.hydrateGraphic(i[s],t._layer));var l=new a;return l.features=r,l})},e.prototype.queryObjectIds=function(e){var t=this;return this._rejectUnsupported(e).then(function(){var r=[];return t._forAllQueried(e,function(e){return r.push(e.id)}),r})},e.defaultExtentBuilder=function(e){var t=null;return{add:function(r){var n=e(r);n&&(t=null!=t?t.union(n):n.clone())},getExtent:function(){return t}}},e.prototype._forAllQueried=function(e,t,r){var n=[];if(e&&e.objectIds){var i=e.objectIds;n.push(function(e){return i.indexOf(e.id)>=0})}var o=e&&e.start||0,a=e&&e.num||1e4;return n.push(function(){return a<=0?(--a,!1):o>0?(--o,!1):(--a,!0)}),this._support.forAll(function(e){for(var r=0,i=n;r<i.length;r++)if(!(0,i[r])(e))return;t(e)},r),Math.max(0,-a)},e.prototype._rejectUnsupported=function(e){if(null==e)return i.resolve();var t=function(e){return i.reject(new n("Unsupported Query","Unsupported property '"+e+"'"))};return null!=e.distance?t("distance"):null!=e.geometryPrecision?t("geometryPrecision"):e.groupByFieldsForStatistics&&e.groupByFieldsForStatistics.length?t("groupByFieldsForStatistics"):null!=e.maxAllowableOffset?t("maxAllowableOffset"):e.multipatchOption?t("multipatchOption"):e.orderByFields&&e.orderByFields.length?t("orderByFields"):e.outSpatialReference?t("outSpatialReference"):e.outStatistics&&e.outStatistics.length?t("outStatistics"):e.pixelSize?t("pixelSize"):e.quantizationParameters?t("quantizationParameters"):e.relationParameter?t("relationParameter"):e.returnDistinctValues?t("returnDistinctValues"):e.text?t("text"):e.timeExtent?t("timeExtent"):e.where?t("where"):e.geometry?t("geometry"):!this._options.enableOutFields&&e.outFields&&e.outFields.length?t("outFields"):!this._options.enableObjectId&&e.objectIds&&e.objectIds.length?t("objectIds"):i.resolve()},e}()}.apply(null,n))||(e.exports=i)},1481:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(338),r(336),r(341),r(337)],void 0===(i=function(e,t,r,n,i,o){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name=null,t.field=null,t.currentRangeExtent=null,t.fullRangeExtent=null,t.type="rangeInfo",t}return r(t,e),n([o.property({type:String,json:{read:!0,write:!0}})],t.prototype,"name",void 0),n([o.property({type:String,json:{read:!0,write:!0}})],t.prototype,"field",void 0),n([o.property({type:[Number],json:{read:!0,write:!0}})],t.prototype,"currentRangeExtent",void 0),n([o.property({type:[Number],json:{read:!0,write:!0}})],t.prototype,"fullRangeExtent",void 0),n([o.property({type:String,readOnly:!0,json:{read:!1,write:!0}})],t.prototype,"type",void 0),n([o.subclass("esri.layers.support.RangeInfo")],t)}(o.declared(i));t.RangeInfo=a,t.default=a}.apply(null,n))||(e.exports=i)},1501:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,r,n){void 0===r&&(r=0),this.TypedArrayConstructor=e,this.elementCount=9;var i=this.TypedArrayConstructor;void 0===n&&(n=9*i.BYTES_PER_ELEMENT);var o=0===t.byteLength?0:r;this.data=new i(t,o),this.elementStride=n/i.BYTES_PER_ELEMENT}return e.prototype.getMat=function(e,t){for(var r=e*this.elementStride,n=0;n<9;n++)t[n]=this.data[r+n];return t},e.prototype.setMat=function(e,t){for(var r=e*this.elementStride,n=0;n<9;n++)this.data[r+n]=t[n]},e.prototype.get=function(e,t){return this.data[e*this.elementStride+t]},e.prototype.set=function(e,t,r){this.data[e*this.elementStride+t]=r},Object.defineProperty(e.prototype,"count",{get:function(){return Math.ceil(this.data.length/this.elementStride)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"buffer",{get:function(){return this.data.buffer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"typedBuffer",{get:function(){return this.data},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stride",{get:function(){return this.elementStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT},enumerable:!0,configurable:!0}),e.ElementCount=9,e}();t.BufferViewMat3=r}.apply(null,n))||(e.exports=i)},1502:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,r,n){void 0===r&&(r=0),this.TypedArrayConstructor=e,this.elementCount=16;var i=this.TypedArrayConstructor;void 0===n&&(n=16*i.BYTES_PER_ELEMENT);var o=0===t.byteLength?0:r;this.data=new i(t,o),this.elementStride=n/i.BYTES_PER_ELEMENT}return e.prototype.getMat=function(e,t){for(var r=e*this.elementStride,n=0;n<16;n++)t[n]=this.data[r+n];return t},e.prototype.setMat=function(e,t){for(var r=e*this.elementStride,n=0;n<16;n++)this.data[r+n]=t[n]},e.prototype.get=function(e,t){return this.data[e*this.elementStride+t]},e.prototype.set=function(e,t,r){this.data[e*this.elementStride+t]=r},Object.defineProperty(e.prototype,"count",{get:function(){return Math.ceil(this.data.length/this.elementStride)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"buffer",{get:function(){return this.data.buffer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"typedBuffer",{get:function(){return this.data},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stride",{get:function(){return this.elementStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT},enumerable:!0,configurable:!0}),e.ElementCount=16,e}();t.BufferViewMat4=r}.apply(null,n))||(e.exports=i)},1503:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,r,n,i){void 0===r&&(r=0),this.TypedArrayConstructor=e,this.elementCount=1;var o=this.TypedArrayConstructor;void 0===n&&(n=o.BYTES_PER_ELEMENT);var a=0===t.byteLength?0:r;this.data=null==i?new o(t,a):new o(t,a,(i-r)/o.BYTES_PER_ELEMENT),this.elementStride=n/o.BYTES_PER_ELEMENT}return e.prototype.get=function(e){return this.data[e*this.elementStride]},e.prototype.set=function(e,t){this.data[e*this.elementStride]=t},Object.defineProperty(e.prototype,"count",{get:function(){return Math.ceil(this.data.length/this.elementStride)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"buffer",{get:function(){return this.data.buffer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"typedBuffer",{get:function(){return this.data},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stride",{get:function(){return this.elementStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT},enumerable:!0,configurable:!0}),e.ElementCount=1,e}();t.BufferViewSingle=r}.apply(null,n))||(e.exports=i)},1504:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(344)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,r,n,i){void 0===r&&(r=0),this.TypedArrayConstructor=e,this.elementCount=2;var o=this.TypedArrayConstructor;void 0===n&&(n=2*o.BYTES_PER_ELEMENT);var a=0===t.byteLength?0:r;this.data=null==i?new o(t,a):new o(t,a,(i-r)/o.BYTES_PER_ELEMENT),this.elementStride=n/o.BYTES_PER_ELEMENT}return e.prototype.getVec=function(e,t){return r.vec2d.set2(this.data[e*this.elementStride],this.data[e*this.elementStride+1],t)},e.prototype.setVec=function(e,t){this.data[e*this.elementStride]=t[0],this.data[e*this.elementStride+1]=t[1]},e.prototype.get=function(e,t){return this.data[e*this.elementStride+t]},e.prototype.set=function(e,t,r){this.data[e*this.elementStride+t]=r},Object.defineProperty(e.prototype,"count",{get:function(){return Math.ceil(this.data.length/this.elementStride)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"buffer",{get:function(){return this.data.buffer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"typedBuffer",{get:function(){return this.data},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stride",{get:function(){return this.elementStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"typedBufferStride",{get:function(){return this.elementStride},enumerable:!0,configurable:!0}),e.ElementCount=2,e}();t.BufferViewVec2Impl=n}.apply(null,n))||(e.exports=i)},1505:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(344)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,r,n,i){void 0===r&&(r=0),this.TypedArrayConstructor=e,this.elementCount=3;var o=this.TypedArrayConstructor;void 0===n&&(n=3*o.BYTES_PER_ELEMENT);var a=0===t.byteLength?0:r;this.data=null==i?new o(t,a):new o(t,a,(i-r)/o.BYTES_PER_ELEMENT),this.elementStride=n/o.BYTES_PER_ELEMENT}return e.prototype.getVec=function(e,t){return r.vec3d.set3(this.data[e*this.elementStride],this.data[e*this.elementStride+1],this.data[e*this.elementStride+2],t)},e.prototype.setVec=function(e,t){this.data[e*this.elementStride]=t[0],this.data[e*this.elementStride+1]=t[1],this.data[e*this.elementStride+2]=t[2]},e.prototype.get=function(e,t){return this.data[e*this.elementStride+t]},e.prototype.set=function(e,t,r){this.data[e*this.elementStride+t]=r},Object.defineProperty(e.prototype,"count",{get:function(){return Math.ceil(this.data.length/this.elementStride)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"buffer",{get:function(){return this.data.buffer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"typedBuffer",{get:function(){return this.data},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stride",{get:function(){return this.elementStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"typedBufferStride",{get:function(){return this.elementStride},enumerable:!0,configurable:!0}),e.ElementCount=3,e}();t.BufferViewVec3Impl=n}.apply(null,n))||(e.exports=i)},1506:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(344)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,r,n,i){void 0===r&&(r=0),this.TypedArrayConstructor=e,this.elementCount=4;var o=this.TypedArrayConstructor;void 0===n&&(n=4*o.BYTES_PER_ELEMENT);var a=0===t.byteLength?0:r;this.data=null==i?new o(t,a):new o(t,a,(i-r)/o.BYTES_PER_ELEMENT),this.elementStride=n/o.BYTES_PER_ELEMENT}return e.prototype.getVec=function(e,t){return r.vec4d.set4(this.data[e*this.elementStride],this.data[e*this.elementStride+1],this.data[e*this.elementStride+2],this.data[e*this.elementStride+3],t)},e.prototype.setVec=function(e,t){this.data[e*this.elementStride]=t[0],this.data[e*this.elementStride+1]=t[1],this.data[e*this.elementStride+2]=t[2],this.data[e*this.elementStride+3]=t[3]},e.prototype.get=function(e,t){return this.data[e*this.elementStride+t]},e.prototype.set=function(e,t,r){this.data[e*this.elementStride+t]=r},Object.defineProperty(e.prototype,"count",{get:function(){return Math.ceil(this.data.length/this.elementStride)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"buffer",{get:function(){return this.data.buffer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"typedBuffer",{get:function(){return this.data},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stride",{get:function(){return this.elementStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"typedBufferStride",{get:function(){return this.elementStride},enumerable:!0,configurable:!0}),e.ElementCount=4,e}();t.BufferViewVec4Impl=n}.apply(null,n))||(e.exports=i)},1507:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(345),r(618),r(665)],void 0===(i=function(e,t,r,n,i){function o(e){var t=new Array;return e.fields.forEach(function(e,n){var i=r({},e,{constructor:s(e.constructor)});t.push([n,i])}),{stride:e.stride,fields:t,fieldNames:e.fieldNames}}function a(e){var t=i.newLayout();return t.stride=e.stride,t.fieldNames=e.fieldNames,e.fields.forEach(function(e){return t.fields.set(e[0],r({},e[1],{constructor:function(e){return u.get(e)}(e[1].constructor)}))}),t}function s(e){return e.ElementType+"_"+e.ElementCount}Object.defineProperty(t,"__esModule",{value:!0}),t.packInterleavedBuffer=function(e,t){return t.push(e.buffer),{buffer:e.buffer,layout:o(e.layout)}},t.unpackInterleavedBuffer=function(e){return a(e.layout).createView(e.buffer)},t.packLayout=o,t.unpackLayout=a;var l=[n.BufferViewFloat,n.BufferViewVec2f,n.BufferViewVec3f,n.BufferViewVec4f,n.BufferViewMat4f,n.BufferViewFloat64,n.BufferViewVec2f64,n.BufferViewVec3f64,n.BufferViewVec4f64,n.BufferViewUint8,n.BufferViewVec2u8,n.BufferViewVec3u8,n.BufferViewVec4u8,n.BufferViewUint16,n.BufferViewVec2u16,n.BufferViewVec3u16,n.BufferViewVec4u16,n.BufferViewUint32,n.BufferViewVec2u32,n.BufferViewVec3u32,n.BufferViewVec4u32,n.BufferViewInt8,n.BufferViewVec2i8,n.BufferViewVec3i8,n.BufferViewVec4i8,n.BufferViewInt16,n.BufferViewVec2i16,n.BufferViewVec3i16,n.BufferViewVec4i16,n.BufferViewInt32,n.BufferViewVec2i32,n.BufferViewVec3i32,n.BufferViewVec4i32],u=new Map;l.forEach(function(e){return u.set(s(e),e)})}.apply(null,n))||(e.exports=i)},1508:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(382),r(344),r(364),r(631)],void 0===(i=function(e,t,r,n,i,o){function a(e,t){return e.cosAngle<t}function s(e,t){return e.cosAngle>t}function l(e,t){var r=Math.acos(e.cosAngle),i=d.fwd,o=d.ortho;return n.vec3d.normalize(n.vec3d.direction(e.position0,e.position1,i)),r*(n.vec3d.dot(n.vec3d.cross(e.faceNormal0,e.faceNormal1,o),i)>0?-1:1)>t}function u(e){for(var t=e.faces.length/3,r=e.vertices.position,i=e.faces,o=p.v0,a=p.v1,s=p.v2,l=new Float32Array(3*t),u=0;u<t;u++){var c=i[3*u+0],d=i[3*u+1],f=i[3*u+2];r.getVec(c,o),r.getVec(d,a),r.getVec(f,s),n.vec3d.subtract(a,o),n.vec3d.subtract(s,o),n.vec3d.normalize(n.vec3d.cross(a,s,o)),l[3*u+0]=o[0],l[3*u+1]=o[1],l[3*u+2]=o[2]}return l}Object.defineProperty(t,"__esModule",{value:!0});var c=-1;t.extractEdges=function(e,t,p,h){void 0===h&&(h=f);var m=e.vertices.position,v=e.vertices.componentIndex,g=i.deg2rad(h.anglePlanar),y=i.deg2rad(h.angleSignificantEdge),b=Math.cos(y),_=Math.cos(g),x=d.edge,w=x.position0,S=x.position1,T=x.faceNormal0,E=x.faceNormal1,C=u(e),O=function(e){for(var t=e.faces.length/3,r=e.faces,n=e.neighbors,i=0,o=0;o<t;o++){var a=n[3*o+0],s=n[3*o+1],l=n[3*o+2],u=r[3*o+0],d=r[3*o+1],p=r[3*o+2];i+=a===c||u<d?1:0,i+=s===c||d<p?1:0,i+=l===c||p<u?1:0}for(var f=new Int32Array(4*i),h=0,o=0;o<t;o++){var a=n[3*o+0],s=n[3*o+1],l=n[3*o+2],u=r[3*o+0],d=r[3*o+1],p=r[3*o+2];(a===c||u<d)&&(f[h++]=u,f[h++]=d,f[h++]=o,f[h++]=a),(s===c||d<p)&&(f[h++]=d,f[h++]=p,f[h++]=o,f[h++]=s),(l===c||p<u)&&(f[h++]=p,f[h++]=u,f[h++]=o,f[h++]=l)}return f}(e),P=O.length/4,A=t.allocate(P),I=0,R=P,M=p.allocate(R),D=0,F=0,L=0,N=r.range(0,P),j=new Float32Array(P);o.forEach(j,function(e,t,r){m.getVec(O[4*t+0],w),m.getVec(O[4*t+1],S),r[t]=n.vec3d.dist(w,S)}),N.sort(function(e,t){return j[t]-j[e]});for(var V=new Array,U=new Array,B=0;B<P;B++){var z=N[B],k=j[z],G=O[4*z+0],H=O[4*z+1],q=O[4*z+2],W=O[4*z+3],X=W===c;if(m.getVec(G,w),m.getVec(H,S),X)n.vec3d.set3(C[3*q+0],C[3*q+1],C[3*q+2],T),n.vec3d.set(T,E),x.componentIndex=v.get(G),x.cosAngle=n.vec3d.dot(T,E);else if(n.vec3d.set3(C[3*q+0],C[3*q+1],C[3*q+2],T),n.vec3d.set3(C[3*W+0],C[3*W+1],C[3*W+2],E),x.componentIndex=v.get(G),x.cosAngle=n.vec3d.dot(T,E),s(x,_))continue;F+=k,L++,X||a(x,b)?(t.write(A,I++,x),V.push(k)):l(x,g)&&(p.write(M,D++,x),U.push(k))}var Q=new Float32Array(V.reverse()),Y=new Float32Array(U.reverse());return{regular:{instancesData:t.trim(A,I),lodInfo:{lengths:Q}},silhouette:{instancesData:p.trim(M,D),lodInfo:{lengths:Y}},averageEdgeLength:F/L}};var d={edge:{position0:n.vec3d.create(),position1:n.vec3d.create(),faceNormal0:n.vec3d.create(),faceNormal1:n.vec3d.create(),componentIndex:0,cosAngle:0},ortho:n.vec3d.create(),fwd:n.vec3d.create()},p={v0:n.vec3d.create(),v1:n.vec3d.create(),v2:n.vec3d.create()},f={anglePlanar:4,angleSignificantEdge:35}}.apply(null,n))||(e.exports=i)},1509:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){return{edgeRenderer:{"adjustProjectedPosition.glsl":"uniform vec2 uDepthBias;\nuniform vec2 uViewportDimInv;\n\n// Utility function to check for NaN values\nbool isNaN(float val) {\n  return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;\n  // important: some nVidias failed to cope with version below.\n  // Probably wrong optimization.\n  /*return ( val <= 0.0 || 0.0 <= val ) ? false : true;*/\n}\n\n// An offset in xy screen space, along the projected normal of the edge\n// This reduces depth fighting when looking at a face from a flat angle\nvec2 calculateProjectedBiasXY(vec4 projPos, vec3 worldNormal) {\n  float offsetXY = uDepthBias.x;\n  float offsetZ  = uDepthBias.y;\n\n  // screen space pixel offset\n  // we multiply by two to account for the fact that NDC go from -1 to 1\n  // we multiply by projPos.w to compensate for the perspective divison that happens later\n  // normalizing over xyz means that the xy influence is reduced the more the normal is pointing\n  // towards the camera\n  vec4 projNormal = uProj * uView * vec4(worldNormal, 0.0);\n\n  return offsetXY * projPos.w * 2.0 * uViewportDimInv * normalize(projNormal.xyz).xy;\n}\n\n// A z-offset, using a depth based heuristic.\nfloat calculateProjectedBiasZ(vec4 projPos) {\n  float offsetZ = uDepthBias.y;\n  return sqrt(projPos.z) * offsetZ;\n}\n\nvec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {\n  vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);\n\n  // we currently have to do this check because some geometries come with 0 length edge normals.\n  // see https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/12890\n  if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {\n    projPos.xy += offsetXY;\n  }\n\n  projPos.z += calculateProjectedBiasZ(projPos);\n\n  return projPos;\n}\n","edgeRenderer.frag":"#include <util/fsPrecision.glsl>\n#include <util/slice.glsl>\n\nvarying vec4 vColor;\nvarying float vRadius;\nvarying vec3 vPosition;\nvarying vec3 vWorldPosition;\nvarying float vLineLengthPixels;\nvarying float vSizeFalloffFactor;\nvarying float vLineIndex;\n\n// At which coverage threshold we discard a fragment completely\n#define COVERAGE_TEST_THRESHOLD 0.01\n\n#include <edgeRenderer/lineOffset.glsl>\n\nvec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {\n  float lineOffset = calculateLineOffset();\n  float positionX = position.x - lineOffset;\n\n  if (radius < 1.0) {\n    // Handle this specifically for subpixel sizes:\n    // 1. Compute correct coverage (note coverage is computed by\n    //    0.5 - dist, so we make sure that that will lead to correct\n    //    subpixel coverage\n    // 2. Ignore rounded caps\n    float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);\n    float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);\n\n    float coverage = min(coverageX, coverageY);\n\n    return vec2(0.5 - coverage, 0.0);\n  }\n  else {\n    // Between -radius -> 0 for start cap, 0 for line, 0 -> radius\n    float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);\n\n    vec2 lineToPosition = vec2(positionX, positionOnCap);\n    return vec2(length(lineToPosition) - radius, positionOnCap / radius);\n  }\n}\n\nvoid main() {\n\n  float radius = vRadius * calculateLinePressure();\n\n  vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);\n  float coverage = clamp(0.5 - distance.x, 0.0, 1.0);\n\n#ifdef ANTIALIASING\n\n  const float coverageLimit = COVERAGE_TEST_THRESHOLD;\n\n#else /* ANTIALIASING */\n\n  // Use subpixel coverage computation when lines get subpixel widths\n  // so we still render them appropriately. Otherwise discard anything\n  // that is not fully within the line\n  float coverageLimit = radius <= 0.5 ? COVERAGE_TEST_THRESHOLD : 0.75;\n\n#endif /* ANTIALIASING */\n\n  if (coverage < coverageLimit) {\n    discard;\n  }\n\n  discardBySlice(vWorldPosition);\n\n  float alpha = vColor.a * coverage;\n\n  gl_FragColor = vec4(vColor.rgb, alpha);\n}\n","edgeRenderer.vert":"#include <util/vsPrecision.glsl>\n\n// Transformations\nuniform mat4 uProj;\nuniform mat4 uView;\nuniform mat4 uModel;\nuniform vec3 uCameraPosition;\n\n// Line configuration\n\n// Conversion constants\nuniform vec2 uPixelToNDC;\nuniform vec2 uNDCToPixel;\nuniform float uPixelRatio;\n\n// Inputs\nattribute vec3 aPosition0;\nattribute vec3 aPosition1;\nattribute float aVariantOffset;\nattribute float aVariantStroke;\nattribute float aVariantExtension;\n\n#ifdef SILHOUETTE\n\nattribute vec3 aNormalA;\nattribute vec3 aNormalB;\n\n#else /* SILHOUETTE */\n\nattribute vec3 aNormal;\n\n#endif /* SILHOUETTE */\n\nattribute vec2 aSideness;\nattribute vec2 aPackedAttributes;\n\nstruct UnpackedAttributes {\nvec2 sideness;\nvec2 sidenessNorm;\nfloat lineWidthPixels;\nfloat extensionLengthPixels;\n\n#if (MODE == MODE_UBER)\n\nfloat type;\n\n#endif\n};\n\n// Output required to compute color\nvarying vec4 vColor;\n\n// Output required to compute distance to line/caps\nvarying vec3 vPosition;\nvarying vec3 vWorldPosition;\nvarying float vRadius;\nvarying float vLineLengthPixels;\nvarying float vSizeFalloffFactor;\n\n#include <edgeRenderer/adjustProjectedPosition.glsl>\n#include <edgeRenderer/styleOutputs.glsl>\n#include <edgeRenderer/lineAmplitude.glsl>\n#include <edgeRenderer/util.glsl>\n\nvec4 calculateGeometricOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\n  vec2 sideness = unpackedAttributes.sideness;\n  vec2 sidenessNorm = unpackedAttributes.sidenessNorm;\n\n  vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;\n\n  vec4 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);\n  vec4 projPosV0 = uProj * viewPosV0;\n  vec4 projPosV1 = uProj * viewPosV1;\n  vec4 projPos = uProj * viewPos;\n\n  vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);\n  vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * uNDCToPixel;\n  float lineLengthPixels = length(screenSpaceLinePixels);\n\n  float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;\n  vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;\n  vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;\n\n  float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * uPixelRatio;\n  float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;\n\n  float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;\n  float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * uPixelRatio;\n\n  vSizeFalloffFactor = falloffFactor;\n\n  float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;\n  float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;\n\n#ifdef ANTIALIASING\n\n  const float aaPaddingPixels = 1.0;\n\n  // Line size with padding\n  float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;\n  float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;\n\n  // Line length with padding\n  float aaPaddedLineLengthPixels = extendedLineLengthPixels + aaPaddingPixels + aaPaddingPixels;\n  float halfAAPaddedLineLengthPixels = aaPaddedLineLengthPixels * 0.5;\n\n#else /* ANTIALIASING */\n\n  // Even if there is no AA, we still want to do proper <1px rendering,\n  // so we effectively clamp the pixel sizes to minimum of 1px and compute\n  // coverage in the fragment shader\n  float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;\n  float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;\n\n  float halfAAPaddedLineLengthPixels = max(extendedLineLengthPixels, 1.0) * 0.5;\n\n#endif /* ANTIALIASING */\n\n  // Half line width in NDC including padding for anti aliasing\n  vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * uPixelToNDC;\n  vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * uPixelToNDC;\n  vec2 extensionLengthNDC = extensionLengthPixels * uPixelToNDC;\n\n  // Compute screen space position of vertex, offsetting for line size and end caps\n  vec2 ndcOffset = (\n      screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)\n    + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC\n  );\n\n  projPos.xy += ndcOffset * projPos.w;\n  projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;\n\n  projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));\n\n  // Line length with end caps\n  float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;\n\n  float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;\n\n  // Position in pixels with origin at first vertex of line segment\n  vPosition = vec3(\n    halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,\n    pixelPositionAlongLine,\n    pixelPositionAlongLine / extendedLineLengthPixels\n  );\n\n  // The line width radius in pixels\n  vRadius = lineWidthPixels * 0.5;\n  vLineLengthPixels = extendedLineLengthPixels;\n\n#ifdef SILHOUETTE\n\n  gl_Position = isSilhouetteEdge(viewPosV0, aNormalA, aNormalB) ? projPos : vec4(10, 10, 10, 1);\n\n#else /* SILHOUETTE */\n\n  gl_Position = projPos;\n\n#endif /* SILHOUETTE */\n\n#if (MODE == MODE_UBER)\n\n  if (unpackedAttributes.type <= 0.0 && lineLengthPixels <= 3.0) {\n    gl_Position = vec4(10, 10, 10, 1);\n  }\n\n#elif (MODE == MODE_SKETCH)\n\n  if (lineLengthPixels <= 3.0) {\n    gl_Position = vec4(10, 10, 10, 1);\n  }\n\n#endif\n\n  return projPos;\n}\n\n#if (MODE == MODE_UBER)\n\nUnpackedAttributes unpackAttributes(ComponentData component) {\n\n  vec2 sidenessNorm = aSideness;\n  vec2 sideness = sidenessNorm * 2.0 - 1.0;\n\n  float fType = component.type;\n  float extensionLengthPixels = component.extensionLength;\n  float lineWidth = component.lineWidth;\n\n  if (fType <= 0.0) {\n    extensionLengthPixels *= aVariantExtension * 2.0 - 1.0;\n  }\n\n  return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);\n}\n\n#else /* (MODE == MODE_UBER) */\n\nUnpackedAttributes unpackAttributes(ComponentData component) {\n  vec2 sidenessNorm = aSideness;\n  vec2 sideness = sidenessNorm * 2.0 - 1.0;\n  float extensionLengthPixels = component.extensionLength;\n\n#if (MODE == MODE_SKETCH)\n\n  extensionLengthPixels *= aVariantExtension * 2.0 - 1.0;\n\n#endif\n\n  float lineWidth = component.lineWidth;\n\n  return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);\n}\n\n#endif /* (MODE == MODE_UBER) */\n\nvoid main() {\n  ComponentData component = readComponentData();\n  UnpackedAttributes unpackedAttributes = unpackAttributes(component);\n\n  vec4 worldPosV0 = uModel * vec4(aPosition0, 1.0);\n  vec4 worldPosV1 = uModel * vec4(aPosition1, 1.0);\n\n  vec4 viewPosV0 = uView * worldPosV0;\n  vec4 viewPosV1 = uView * worldPosV1;\n\n#ifdef SILHOUETTE\n\n  vec3 worldNormal = silhouetteWorldNormal(aNormalA, aNormalB);\n\n#else /* SILHOUETTE */\n\n  vec3 worldNormal = modelToWorldNormal(aNormal);\n\n#endif /* SILHOUETTE */\n\n  // General geometric computation for all types of edges\n  vec4 projPos = calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal, unpackedAttributes);\n\n  // Component color\n  vColor = component.color;\n\n  // Specific computation for different edge styles\n  calculateStyleOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, projPos, worldNormal, unpackedAttributes);\n}\n","lineAmplitude.glsl":"// Solid\n\n#if (MODE == MODE_UBER || MODE == MODE_SOLID)\n\n  float calculateLineAmplitudeSolid() {\n    return 0.0;\n  }\n\n#endif\n\n#if (MODE == MODE_SOLID)\n\n  float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\n    return calculateLineAmplitudeSolid();\n  }\n\n#endif\n\n// Sketch\n\n#if (MODE == MODE_UBER || MODE == MODE_SKETCH)\n\n  uniform float uStrokesAmplitude;\n\n  float calculateLineAmplitudeSketch() {\n    return uStrokesAmplitude;\n  }\n\n#endif\n\n#if (MODE == MODE_SKETCH)\n\n  float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\n    return calculateLineAmplitudeSketch();\n  }\n\n#endif\n\n// Uber\n\n#if (MODE == MODE_UBER)\n\n  float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\n    float type = unpackedAttributes.type;\n\n    if (type <= 0.0) {\n      return calculateLineAmplitudeSketch();\n    }\n    else {\n      return calculateLineAmplitudeSolid();\n    }\n  }\n\n#endif\n","lineOffset.glsl":"#include <util/encoding.glsl>\n\n// Sketch\n\n#if (MODE == MODE_UBER || MODE == MODE_SKETCH)\n\n  uniform sampler2D uStrokesTexture;\n  uniform float uStrokesNormalizationScale;\n\n  varying vec2 vStrokeUV;\n\n  float calculateLineOffsetSketch() {\n    float offsetNorm = rgba2float(texture2D(uStrokesTexture, vStrokeUV));\n    return (offsetNorm - 0.5) * uStrokesNormalizationScale;\n  }\n\n  float calculateLinePressureSketch() {\n    return rgba2float(texture2D(uStrokesTexture, vStrokeUV + vec2(0, 0.5)));\n  }\n\n#endif\n\n#if (MODE == MODE_SKETCH)\n\n  float calculateLineOffset() {\n    return calculateLineOffsetSketch();\n  }\n\n  float calculateLinePressure() {\n    return calculateLinePressureSketch();\n  }\n\n#endif\n\n// Solid\n\n#if (MODE == MODE_UBER || MODE == MODE_SOLID)\n\n  float calculateLineOffsetSolid() {\n    return 0.0;\n  }\n\n  float calculateLinePressureSolid() {\n    return 1.0;\n  }\n\n#endif\n\n#if (MODE == MODE_SOLID)\n\n  float calculateLineOffset() {\n    return calculateLineOffsetSolid();\n  }\n\n  float calculateLinePressure() {\n    return calculateLinePressureSolid();\n  }\n\n#endif\n\n// Uber\n\n#if (MODE == MODE_UBER)\n  varying float vType;\n\n  float calculateLineOffset() {\n    if (vType <= 0.0) {\n      return calculateLineOffsetSketch();\n    }\n    else {\n      return calculateLineOffsetSolid();\n    }\n  }\n\n  float calculateLinePressure() {\n    if (vType <= 0.0) {\n      return calculateLinePressureSketch();\n    }\n    else {\n      return calculateLinePressureSolid();\n    }\n  }\n#endif\n","styleOutputs.glsl":"#if (MODE == MODE_UBER || MODE == MODE_SKETCH)\n\n  uniform vec2 uStrokesTextureScale;\n  uniform float uStrokesLog2Resolution;\n  uniform float uStrokeVariants;\n\n  varying vec2 vStrokeUV;\n  varying float vLineIndex;\n\n  void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {\n    vec2 sidenessNorm = unpackedAttributes.sidenessNorm;\n\n    float lineIndex = clamp(ceil(log2(lineLength)), 0.0, uStrokesLog2Resolution);\n\n    vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * uStrokeVariants + aVariantStroke + 0.5) * uStrokesTextureScale;\n    vStrokeUV.x += aVariantOffset;\n\n    vLineIndex = lineIndex;\n  }\n#endif\n\n#if (MODE == MODE_SOLID)\n  void calculateStyleOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec4 projPos, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\n  }\n#elif (MODE == MODE_SKETCH)\n  void calculateStyleOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec4 projPos, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\n    calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);\n  }\n#elif (MODE == MODE_UBER)\n  varying float vType;\n\n  void calculateStyleOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec4 projPos, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\n    vType = unpackedAttributes.type;\n\n    if (unpackedAttributes.type <= 0.0) {\n      calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);\n    }\n  }\n#endif\n","util.glsl":"uniform float uDistanceFalloffFactor;\n\nfloat distanceBasedPerspectiveFactor(float distance) {\n  return clamp(sqrt(uDistanceFalloffFactor / distance), 0.0, 1.0);\n}\n\nuniform sampler2D uComponentDataTex;\nuniform vec2 uComponentDataTexInvDim;\n\nattribute float aComponentIndex;\n\n#define COMPONENT_COLOR_FIELD_OFFSET 0.0\n#define COMPONENT_OTHER_FIELDS_OFFSET 1.0\n#define COMPONENT_FIELD_COUNT 2.0\n\n#define LINE_WIDTH_FRACTION_FACTOR 8.0\n#define EXTENSION_LENGTH_OFFSET 128.0\n\n#define COMPONENT_TEX_WIDTH 4096.0\n\nvec2 componentTextureCoords(float componentIndex, float fieldOffset) {\n  float fieldIndex = COMPONENT_FIELD_COUNT * componentIndex + fieldOffset;\n\n  float rowIndex = floor(fieldIndex / COMPONENT_TEX_WIDTH);\n  float colIndex = mod(fieldIndex, COMPONENT_TEX_WIDTH);\n\n  vec2 linearIndex = vec2(\n    (colIndex + 0.5) / COMPONENT_TEX_WIDTH,\n    (rowIndex + 0.5) * uComponentDataTexInvDim.y\n  );\n\n  return linearIndex;\n}\n\nstruct ComponentData {\n  vec4 color;\n  float lineWidth;\n  float extensionLength;\n  float type;\n};\n\nComponentData readComponentData() {\n  vec2 colorIndex = componentTextureCoords(aComponentIndex, COMPONENT_COLOR_FIELD_OFFSET);\n  vec2 otherIndex = componentTextureCoords(aComponentIndex, COMPONENT_OTHER_FIELDS_OFFSET);\n\n  vec4 colorValue = texture2D(uComponentDataTex, colorIndex);\n  vec4 otherValue = texture2D(uComponentDataTex, otherIndex);\n\n  return ComponentData(\n    vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity\n    otherValue.x * (255.0 / LINE_WIDTH_FRACTION_FACTOR),\n    otherValue.y * 255.0 - EXTENSION_LENGTH_OFFSET,\n    -(otherValue.z * 255.0) + 0.5 // SOLID (=0/255) needs to be > 0.0, SKETCHY (=1/255) needs to be <= 0;\n  );\n}\n\nvec3 modelToWorldNormal(vec3 normal) {\n  return (uModel * vec4(normal, 0)).xyz;\n}\n\nvec3 silhouetteWorldNormal(vec3 normalA, vec3 normalB) {\n  return modelToWorldNormal(normalize(normalA + normalB));\n}\n\n// Fall-off extension length for shorter strokes, starting from strokes that are 256 size,\n// fall-off exponentially\nfloat calculateExtensionLength(float extensionLength, float lineLength) {\n  return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);\n}\n\n#ifdef SILHOUETTE\n\n// #uniforms: uView, uModel\nbool isSilhouetteEdge(vec4 viewPos, vec3 normalA, vec3 normalB) {\n  // transform the two face normals\n  vec3 viewNormalA = (uView * uModel * vec4(normalA, 0.0)).xyz;\n  vec3 viewNormalB = (uView * uModel * vec4(normalB, 0.0)).xyz;\n\n  // compute the direction from the edge to the camera\n  vec3 viewDir = -viewPos.xyz;\n\n  // check which of the two faces are visible\n  // display the edge if exactly one of the two is visible\n  float faceAVisible = dot(viewDir, viewNormalA); // positive if visible\n  float faceBVisible = dot(viewDir, viewNormalB); // positive if visible\n\n  // 1 if exactly one face visible, 0 otherwise\n  return faceAVisible * faceBVisible < 0.0;\n}\n\n#endif /* SILHOUETTE */\n"},environment:{"realisticAtmosphere.frag":"#include <util/fsPrecision.glsl>\n#include <util/encoding.glsl>\n#include <util/color.glsl>\n\n// Light\nuniform vec3 v3LightDir;      // The direction vector to the light source\nuniform vec3 v3InvWavelength; // 1 / pow(wavelength, 4) for the red, green, and blue channels\nuniform vec3 v3InvWavelengthScaled; //v3InvWavelength * fKr4PI + fKm4PI\n\n// Atmosphere\nconst float fKrESun = 0.075;        // Kr * ESun = 0.005 * 15.0\nconst float fKmESun = 0.015;        // Km * ESun = 0.005 * 15\n\n// Radii\nuniform vec4 v4Radii; // (fInnerRadius, fInnerRadius^2, fOuterRadius, fOuterRadius^2)\n\nfloat fInnerRadius = v4Radii[0];   // The inner (planetary) radius\nfloat fInnerRadius2 = v4Radii[1];  // fInnerRadius^2\nfloat fOuterRadius = v4Radii[2];   // The outer (atmosphere) radius\nfloat fOuterRadius2 = v4Radii[3];  // fOuterRadius^2\n\n// Atmosphere parameters:\n// fScale:                    1.0 / (fOuterRadius - fInnerRadius)\n// fScaleDepth:               The scale depth (i.e. the altitude at which the atmosphere's average density is found)\n// fScaleOverScaleDepth:      fScale / fScaleDepth\n// fOneOverScaleDepth:        1.0 / fScaleDepth\n\n// fScaleDepthBlue:           The scale depth (i.e. the altitude at which the atmosphere's average density is found)\n// fScaleOverScaleDepthBlue:  fScale / fScaleDepthBlue\n// fOneOverScaleDepthBlue;    1.0 / fScaleDepthBlue\n\nuniform vec4 v4AtmosParams1; // (fScale, fScaleDepth, fScaleOverScaleDepth, fOneOverScaleDepth)\nuniform vec4 v4AtmosParams2; // (g, fScaleDepthBlue, fScaleOverScaleDepthBlue, fOneOverScaleDepthBlue)\n\nfloat fScale = v4AtmosParams1.x;\nvec2 v2ScaleDepth = vec2(v4AtmosParams1.y,v4AtmosParams2.y);//fScaleDepth, fScaleDepthBlue\nvec2 v2ScaleOverScaleDepth = vec2(v4AtmosParams1.z,v4AtmosParams2.z);//fScaleOverScaleDepth, fScaleOverScaleDepthBlue\nvec2 v2OneOverScaleDepth = vec2(v4AtmosParams1.w,v4AtmosParams2.w);//fOneOverScaleDepth, fOneOverScaleDepthBlue\n\n#ifndef HAZE\nuniform vec4 v4AtmosParams3; // (g2, fMiePhaseCoefficients, fLowerAlphaBlendBound, fOneOverOuterRadiusMinusAlphaBlendBound)\nuniform float fInnerFadeDistance;\nuniform float fAltitudeFade;\n\nfloat g = v4AtmosParams2.x;\nfloat g2 = v4AtmosParams3.x;\nfloat fMiePhaseCoefficients = v4AtmosParams3.y;\nfloat fLowerAlphaBlendBound = v4AtmosParams3.z;\nfloat fOneOverOuterRadiusMinusAlphaBlendBound = v4AtmosParams3.w;\n#endif\n\n// Camera\nuniform vec3 v3CameraPos;     // The camera's current position\nuniform vec2 nearFar;\n\nuniform vec4 v4SphereComp;              // (fCameraHeight, fCameraHeight2, fC, fCSur)\nfloat fCameraHeight = v4SphereComp[0];  // The camera's current height\nfloat fCameraHeight2 = v4SphereComp[1]; // fCameraHeight^2\nfloat fC = v4SphereComp[2];             // fCameraHeight2 - fOuterRadius2; // C = ||o-c||^2 - r^2\nfloat fCSur = v4SphereComp[3];          // fCameraHeight2 - (fInnerRadius2 - 63756370000.0); // C = ||o-c||^2 - r^2\n\n// Camera HDR\n#ifdef HAZE\nconst float fExposure = 1.5;\n#else\nconst float fExposure = 2.0;\n#endif\n\n#ifdef HAZE\n// Depth texture\nuniform sampler2D tDepth;\n#endif\n\n// Testing variables\nuniform float showTest;\n\n// Varyings\nvarying vec3 v3EyeDir;\nvarying vec3 v3WorldRay;\nvarying vec2 vtc;\n\n// Loop constants for integral approximation\nconst float fSamples = 5.0;\nconst int maxSamples = 5;\n\n#ifdef HAZE\n  const float fOneOverGamma = 1.0;//Gamma = 1.0\n#else\n  const float fOneOverGamma = 0.454545; // Gamma = 2.2\n#endif\n  const vec3 v3OneOverGamma = vec3(fOneOverGamma);\n\n// ToneMapping operators\nvec3 expTM(vec3 inputColor,float exposure){\n    return pow(1.0 - exp(inputColor * -exposure), v3OneOverGamma);\n}\n\n#ifndef HAZE\nvec3 reinhardTM(vec3 inputColor, float exposure){\n  vec3 intermediate = inputColor *exposure;\n  intermediate /= (1.0+intermediate);\n  return pow(intermediate, v3OneOverGamma);\n}\n#endif\n\n// Approximation for inner integral based on a radii ratio of 10.25:10\nfloat scale(float fCos){\n  float x = 1.0 - fCos;\n  return exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\n}\n\nvoid main() {\n  vec3 cameraPosition = v3CameraPos;\n\n  // Debug variables\n  vec3 test = vec3(0.0,0.0,0.0);\n\n  // Obtain ray from Camera\n  vec3 worldSpaceRay = normalize(v3WorldRay);\n\n  // Compute Atmosphere intersection; i.e. ray/sphere intersection\n  float B = 2.0 * dot(cameraPosition, worldSpaceRay); // B = 2(l * (o-c))\n  float det = B*B - 4.0 * fC; // det = B^2 - 4.0* C\n\n  // idealized sphere intersection to discard early some pixels\n  float detSur = B*B - 4.0 * fCSur; // det = B^2 - 4.0* C\n\n  // the minimal sample start position:\n  // at the camera by default, on the earth radius surface if the camera is underground.\n  float fMinRayStart = 0.0;\n#ifndef HAZE\n  // When the ray intersects the earth surface, fade the sky to a simple light direction\n  // based color. This is used to make sure we have a white background in underground\n  // mode (at noon).\n  float fSurfaceBlend = 0.0;\n  vec4 surfaceColor = vec4(0.0);\n  if (detSur >= 0.0) {\n    float nearSurfaceT = max(0.0, 0.5 *(-B - sqrt(detSur)));\n    float farSurfaceT = max(0.0, 0.5 *(-B + sqrt(detSur)));\n\n    if (nearSurfaceT == 0.0) {\n      fMinRayStart = farSurfaceT;\n    }\n\n    // Compute lighting at the point where the ray enters the earth surface\n    // Lighting computation is copied from the terrain shader.\n    vec3 vPos = cameraPosition + worldSpaceRay * nearSurfaceT;\n    float fLightAngle = dot(v3LightDir, normalize(vPos));\n    float fBrightness = max(0.0, (smoothstep(-1.0, 0.8, 2.0 * fLightAngle)));\n\n    // Make the surface transparent based on altitude\n    surfaceColor = vec4(fBrightness, fBrightness, fBrightness, 1.0 - fAltitudeFade);\n\n    // Fade based on the distance the ray travels below the earth surface\n    float fRelDist = (farSurfaceT - nearSurfaceT) / fInnerFadeDistance;\n\n    // early exit\n    if (fRelDist > 1.0) {\n      gl_FragColor = surfaceColor;\n      return;\n    }\n\n    fSurfaceBlend = smoothstep(0.0, 1.0, fRelDist * fRelDist);\n  }\n#endif\n\n  // Inside Atmosphere\n  if (det >= 0.0) {\n#ifdef HAZE\n    // only use red channel from depth texture.\n    // see 'Issues' at https://www.khronos.org/registry/webgl/extensions/WEBGL_depth_texture\n    float depthSample = texture2D(tDepth, vtc).r;\n\n    float zNear = nearFar[0];\n    float zFar = nearFar[1];\n\n    // http://web.archive.org/web/20130416194336/http://olivers.posterous.com/linear-depth-in-glsl-for-real\n    float zNorm = 2.0 * depthSample - 1.0;\n    float linDepth = 2.0 * zNear * zFar /\n      (zFar + zNear - zNorm * (zFar - zNear));\n\n    float rayEndT;\n    float altitudeAlpha = 1.0;\n\n    // find intersections with ground, but only between the near and far\n    // clipping planes.\n    if (depthSample < 1.0 && depthSample > 0.0) {\n      vec3 cameraSpaceRay = normalize(v3EyeDir);\n      cameraSpaceRay /= cameraSpaceRay.z;\n      cameraSpaceRay *= linDepth;\n\n      float cameraSpaceRayLength = length(cameraSpaceRay);\n\n      vec3 v3World = cameraPosition + worldSpaceRay * cameraSpaceRayLength;\n      float v3WorldRadius2 = dot(v3World, v3World);\n\n      // Handle tall structures:\n      // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/5450\n      float transitionStart = fInnerRadius + 20000.0;\n      float transitionHeight = 25000.0;\n      float transitionEnd = transitionStart + transitionHeight;\n\n      float edge0 = transitionStart * transitionStart;\n      float edge1 = transitionEnd * transitionEnd;\n\n      altitudeAlpha = 1.0 - clamp((v3WorldRadius2 - edge0) / (edge1 - edge0), 0.0, 1.0);\n      rayEndT = cameraSpaceRayLength;\n\n      if (altitudeAlpha > 0.0 && detSur > 0.0) {\n        float nearSurfaceT = 0.5 *(-B - sqrt(detSur));\n        float interp = clamp(((fCameraHeight - fInnerRadius) - 2000000.0) / 6000000.0, 0.0, 1.0);\n        rayEndT = mix(cameraSpaceRayLength, nearSurfaceT, interp);\n      }\n    }\n#endif\n\n    float rayStartT = 0.5 *(-B - sqrt(det)); //near intersection with atmosphere\n#ifdef HAZE\n    float nearT = abs(rayStartT);\n    float farT = abs(rayEndT);\n#else\n    float rayEndT = 0.5 *(-B + sqrt(det)); //far intersection with atmosphere\n\n#endif\n\n    float fDistance; // calculate its scattering offset\n    // Calculate the ray's starting position\n    if (rayStartT < fMinRayStart)\n    { // ray starts from camera or inner radius sphere to far\n      rayStartT = fMinRayStart;\n#ifndef HAZE\n      // clamp to value at inner radius altitude\n      fDistance = fScale * min(0.0, fInnerRadius - fCameraHeight);\n#endif\n    }\n#ifndef HAZE\n    else\n    { // outside atmosphere\n      fDistance = -1.0;\n    }\n#endif\n\n    // Initialize the scattering loop variables\n    vec3 v3Start = cameraPosition + worldSpaceRay * rayStartT;\n\n#ifdef HAZE\n    vec3 v3End = cameraPosition + worldSpaceRay * rayEndT;\n\n    float fEndLength = length(v3End);\n    float fAltitudeEnd = fEndLength - fInnerRadius;\n    float fAltitudeStart = length(v3Start) - fInnerRadius;\n\n    // for camera positions below altitude 0, invert the altitudes, to achieve\n    // a similar haze as above ground. Note that there is a small but visible change\n    // when the camera passes altitude 0.\n    if (fAltitudeStart < 0.0) {\n      fAltitudeStart = -fAltitudeStart;\n      fAltitudeEnd = -fAltitudeEnd;\n    }\n\n    // computed for the original end point to get consistent light angles after possible inversions\n    float fLightAngle = dot(v3LightDir, v3End) / fEndLength;\n\n    if (nearT > farT)\n    {\n      if (fAltitudeStart < fAltitudeEnd)\n      {\n        // Switch positive slopes for flipped rays\n        v3End = cameraPosition + worldSpaceRay * rayStartT;\n        v3Start = cameraPosition + worldSpaceRay * rayEndT;\n        worldSpaceRay *= -1.0;\n        float fTmp = fAltitudeStart;\n        fAltitudeStart = fAltitudeEnd;\n        fAltitudeEnd = fTmp;\n      }\n      else if (fAltitudeStart == fAltitudeEnd)\n      { // create minuscule fake slope for integration if the slope is zero\n        fAltitudeStart += 1.0; //BUGFIX, if the height of camera and ground is equal the equation breaks, add fake meter to camera height to get\n        // slope for the camera function\n      }\n    }\n\n    // Calculate its scattering offset\n    // Assumes camera constrains of WSV 3.8\n    float fCameraDepth;\n    float fCameraDepthBlue;\n    if (fAltitudeStart > fOuterRadius - fInnerRadius)\n    { // outside atmosphere\n      fDistance = fInnerRadius - fOuterRadius;\n    } else\n    {\n      fDistance = fAltitudeEnd - fAltitudeStart;\n    }\n\n#endif\n    vec2 v2OpticalStartDepth = exp(fDistance * v2OneOverScaleDepth);\n\n    float fRayLength = rayEndT - rayStartT;\n    float fSampleLength = fRayLength / fSamples;\n    float fScaledLength = fSampleLength * fScale;\n    vec3 v3SampleRay = worldSpaceRay * fSampleLength;\n    vec3 v3SamplePoint = v3Start + v3SampleRay * 0.5;\n\n#ifdef HAZE\n    float fCameraAngle = dot(-worldSpaceRay, v3End) / length(v3End);\n    float fScaleCameraAngle = scale(fCameraAngle);\n    vec2 v2CameraOffset = fScaleCameraAngle*v2OpticalStartDepth;\n\n    float scaledValues = scale(fLightAngle) + fScaleCameraAngle;\n    vec2 v2ScaledValuesDepth = scaledValues * v2ScaleDepth;\n#else\n    float fCameraAngle = dot(worldSpaceRay, v3Start / length(v3Start));\n    float angleMultiplier = fCameraAngle>0.0?fCameraAngle:0.0;\n\n    float fScaleCameraAngle = scale(fCameraAngle);\n    vec2 v2CameraOffset = fScaleCameraAngle*v2OpticalStartDepth * v2ScaleDepth;\n#endif\n\n    // Loop variables\n    vec3 v3FrontColor = vec3(0.0, 0.0, 0.0);\n    vec3 v3FrontColorBlue = vec3(0.0, 0.0, 0.0);\n    vec3 v3Attenuate= vec3(0.0, 0.0, 0.0);\n    vec3 v3AttenuateBlue = vec3(0.0, 0.0, 0.0);\n\n    // Now loop through the sample rays\n    for(int i=0; i<maxSamples; i++) {\n      float fHeight = length(v3SamplePoint);\n      float fAltitude = abs(fHeight - fInnerRadius);\n\n      vec2 v2Depth = exp(-fAltitude * v2ScaleOverScaleDepth);\n#ifdef HAZE\n      vec2 v2Scatter = v2Depth*v2ScaledValuesDepth-v2CameraOffset;\n#else\n      float fLightAngle = dot(v3LightDir, v3SamplePoint) / fHeight;\n      float fCameraAngle = dot(worldSpaceRay, v3SamplePoint) / fHeight;\n      float fTempScaledValues = scale(fLightAngle) - scale(fCameraAngle);\n      vec2 v2Scatter = v2CameraOffset + fTempScaledValues*v2Depth* v2ScaleDepth;\n#endif\n      v3Attenuate = exp(-v2Scatter.x * v3InvWavelengthScaled);\n      v3AttenuateBlue = exp(-v2Scatter.y * v3InvWavelengthScaled);\n\n      v3FrontColor += v3Attenuate * v2Depth.x;\n      v3FrontColorBlue += v3AttenuateBlue * v2Depth.y;\n\n      v3SamplePoint += v3SampleRay;\n    }\n\n    // Phase computation\n    // clamp to avoid numerical instability at fCos == -1.0 (and close values) to display fake sun\n    float fCos = clamp(dot(v3LightDir, -worldSpaceRay ),-0.9999999,1.0);\n    float fOnePlusCos2 = fCos*fCos + 1.0;\n#ifdef HAZE\n    // Finally, scale the Rayleigh colors and set up the varying variables for the pixel shader\n    vec3 colorCoefficients = (fScaledLength* 0.75 * fOnePlusCos2)*(fKrESun*v3InvWavelength+fKmESun);\n\n    // Scaled Length is only applied afterwards to save multiplications\n    vec3 v3Color = colorCoefficients *v3FrontColor;\n    vec3 v3ColorBlue = colorCoefficients *v3FrontColorBlue;\n#else\n    vec3 v3RayleighCoefficients = (fScaledLength*0.75 * fOnePlusCos2*fKrESun)*v3InvWavelength;\n    float fMieCoefficients = fScaledLength*fKmESun * fMiePhaseCoefficients * fOnePlusCos2 / pow(1.0 + g2 - 2.0*g*fCos, 1.5);\n\n    // Calculate the attenuation factor for the ground\n    vec3 v3Color = v3RayleighCoefficients * v3FrontColor + fMieCoefficients * v3FrontColor;\n    vec3 v3ColorBlue = v3RayleighCoefficients * v3FrontColorBlue + fMieCoefficients * v3FrontColorBlue;\n#endif\n\n    // HDR to LDR conversion\n    vec3 ldrBlue = expTM(v3ColorBlue,2.0*fExposure);\n    vec3 ldrRed = expTM(v3Color,fExposure);\n\n    // mix reddish and blueish atmosphere\n    vec3 LDR = mix(ldrBlue,ldrRed,0.2);\n#ifdef HAZE\n    LDR *= (1.0-fCameraAngle);\n    vec3 hsv = rgb2hsv(LDR);\n    hsv.y = clamp(hsv.y*1.5,0.0,1.0); // boost haze saturation by 50%\n    LDR = hsv2rgb(hsv);\n    vec3 finalColor = LDR;\n    // when rendering we specify the blend functions such that\n    // newDestColor = oldDestColor*(1.0-finalColor) + finalColor\n#else\n    // reinhard tonemapper for looking upwards\n    vec3 ldrReinhard = reinhardTM(v3Color,fExposure);\n    LDR += angleMultiplier*ldrReinhard;\n\n    // height dependent parameter to smooth out reddish atmosphere\n    float side = (rayEndT+rayStartT)*0.5;\n    float atmoHeight = sqrt(fCameraHeight2 - side*side);\n    float h2 = clamp(1.0-(atmoHeight-fLowerAlphaBlendBound)/(fOuterRadius-fLowerAlphaBlendBound),0.0,1.0);\n\n    vec3 finalColor = LDR*h2;\n    vec3 hsv = rgb2hsv(finalColor);\n    hsv.y = clamp(hsv.y*1.5,0.0,1.0); // boost sky saturation by 50%\n    finalColor = hsv2rgb(hsv);\n#endif\n\n#ifndef HAZE\n    float atmosStrength = clamp((length(ldrRed)-0.05)*1.05,0.0,1.0);\n    gl_FragColor = vec4(finalColor, atmosStrength*clamp(1.0-(atmoHeight-fInnerRadius)/(fOuterRadius-fInnerRadius),0.0,1.0));\n    if (fSurfaceBlend > 0.0) {\n      gl_FragColor = mix(gl_FragColor, surfaceColor, fSurfaceBlend);\n    }\n#else\n    gl_FragColor = vec4(finalColor, 1.0) * altitudeAlpha;\n#endif\n\n    // Debug variable overlay\n    if(showTest>0.0){\n      gl_FragColor = vec4(test,1.0);\n    }\n  } else { // Outside Atmosphere\n    gl_FragColor = vec4(0.0);\n  }\n}\n","realisticAtmosphere.vert":"#include <util/vsPrecision.glsl>\n\n// Camera\nuniform vec2 halfSizeNearPlane;\nuniform vec3 v3CameraUp;\nuniform vec3 v3CameraRight;\nuniform vec3 v3CameraDir;\nuniform vec2 v2CameraCenterOffset;\n\n// Attributes\nattribute vec3 position;\nattribute vec2 uv0;\n\n// Varyings\nvarying vec3 v3WorldRay;\nvarying vec2 vtc;\n\n#ifdef HAZE\nvarying vec3 v3EyeDir;\n#endif\n\nvoid main(void) {\n  vec3 v3Pos = position;\n  vtc = uv0;\n  vec2 rayvtc = uv0 - v2CameraCenterOffset;\n\n#ifdef HAZE\n  v3EyeDir = vec3((2.0*halfSizeNearPlane *rayvtc)-halfSizeNearPlane,-1.0);\n#else\n  vec3 v3EyeDir = vec3((2.0*halfSizeNearPlane *rayvtc)-halfSizeNearPlane,-1.0);\n#endif\n  v3WorldRay = v3EyeDir.z*v3CameraDir + v3EyeDir.y*v3CameraUp + v3EyeDir.x*v3CameraRight;\n  gl_Position = vec4(v3Pos, 1.0);\n}\n","simpleAtmosphere.frag":"#include <util/fsPrecision.glsl>\n\nuniform sampler2D tex;\n\nvarying vec2 vtc;\nvarying float falloff;\n\n#ifndef PANORAMIC\nuniform float altitudeFade;\nvarying float innerFactor;\n#endif\n\nvoid main() {\n  vec4 texColor = texture2D(tex, vtc);\n\n#ifdef PANORAMIC\n  gl_FragColor = texColor * falloff;\n#else\n  vec4 atmosphereColor = texColor * falloff;\n  vec4 innerColor = vec4(texColor.rgb * falloff, 1.0 - altitudeFade);\n  gl_FragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));\n#endif\n}\n","simpleAtmosphere.vert":"#include <util/vsPrecision.glsl>\n\nuniform mat4 proj;\nuniform mat4 view;\n\n#ifndef PANORAMIC\nconst float TWICEPI = 2.0*3.14159265;\nconst float ATMOSPHERE_RIM_SEGMENTS = 128.0;\n\nuniform vec3 silCircleCenter;\nuniform vec3 silCircleV1;\nuniform vec3 silCircleV2;\nuniform vec2 texV;\n\nuniform float innerScale;  // scale for inner rim\nvarying float innerFactor; // 0: outer atmosphere, 1: inner atmosphere\n#endif\n\nuniform vec3 lightDirection;\n\nattribute vec3 position;\nvarying vec2 vtc;\nvarying float falloff;\n\nvoid main(void) {\n\n#ifdef PANORAMIC\n\n  vec3 pos = position;\n  float ndotl = lightDirection.z;\n  vtc = vec2(0, position.z+0.05);\n\n#else\n\n  innerFactor = clamp(-position.z, 0.0, 1.0);\n  float scale = position.y * (1.0 + innerFactor * innerScale);\n  float phi = position.x * (TWICEPI / ATMOSPHERE_RIM_SEGMENTS) + 1.0;\n  vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;\n  float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), lightDirection);\n\n  vtc.x = position.x / ATMOSPHERE_RIM_SEGMENTS;\n  vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;\n\n#endif\n\n  falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));\n\n  gl_Position = proj * view * vec4(pos, 1.0);\n  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane\n}\n","simpleAtmosphereFade.frag":"#include <util/fsPrecision.glsl>\n\nvarying vec4 color;\n\nvoid main() {\n  gl_FragColor = color;\n}\n","simpleAtmosphereFade.vert":"#include <util/vsPrecision.glsl>\n\nattribute vec2 position;\n\nuniform vec3 lightDirection;\nuniform vec3 cameraPosition;\n\nuniform float undergroundFadeAlpha;\n\nvarying vec4 color;\n\nvoid main(void) {\n  float ndotl = dot(normalize(cameraPosition), lightDirection);\n  float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));\n\n  color = vec4(vec3(lighting), undergroundFadeAlpha);\n\n  gl_Position = vec4(position.xy, 1.0, 1.0); // on the far plane\n}\n","stars.frag":"#include <util/fsPrecision.glsl>\n\nvarying vec4 vcolor;\nvarying float vsize;\n\nvoid main() {\n  float cap = 0.7;\n  float scale = 1.0/cap;\n  float helper = clamp(length(abs(gl_PointCoord-vec2(0.5))),0.0,cap);\n  float alpha = clamp((cap-helper)*scale,0.0,1.0);\n  float intensity = alpha*alpha*alpha;\n  if (vsize < 3.0)\n    intensity *= 0.5;\n  gl_FragColor = vec4(1.0,1.0,1.0,intensity);\n  gl_FragColor.xyz *= vcolor.xyz;\n}\n","stars.vert":"#include <util/vsPrecision.glsl>\n#include <util/alignPixel.glsl>\n\nuniform mat4 proj;\nuniform mat4 view;\nuniform mat4 model;\nuniform vec4 viewport;\nuniform float pixelRatio;\n\nattribute vec3 position;\nattribute vec4 color;\nattribute float size;\n\nvarying vec4 vcolor;\nvarying float vsize;\n\nvoid main(void) {\n  vec4 posProj = proj * view * model*vec4(position*1.0e25,1.0);//move infinitely far away\n  gl_Position = alignToPixelCenter(posProj, viewport.zw); //pixel align position\n  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane\n  vcolor = color / 1.2;\n  vsize = size * 5.0 * pixelRatio;\n  gl_PointSize = vsize;\n}\n"},materials:{checkerBoard:{"checkerBoard.frag":"#include <util/enableExtensions.glsl>\n#include <util/fsPrecision.glsl>\n\nuniform vec2 size;\nuniform vec4 color1;\nuniform vec4 color2;\n\nvarying vec2 vUV;\n\nvoid main() {\n  vec2 uvScaled = vUV / (2.0 * size);\n\n  vec2 uv = fract(uvScaled - 0.25);\n  vec2 ab = clamp((abs(uv - 0.5) - 0.25) / fwidth(uvScaled), -0.5, 0.5);\n  float fade = smoothstep(0.25, 0.5, max(fwidth(uvScaled.x), fwidth(uvScaled.y)));\n  float t = mix(abs(ab.x + ab.y), 0.5, fade);\n\n  gl_FragColor = mix(color2, color1, t);\n}\n","checkerBoard.vert":"#include <util/vsPrecision.glsl>\n\nuniform mat4 proj;\nuniform mat4 view;\nuniform mat4 model;\n\nattribute vec3 position;\nattribute vec2 uv0;\n\nvarying vec2 vUV;\n\nvoid main(void) {\n  vUV = uv0;\n  gl_Position = proj * view * vec4((model * vec4(position, 1.0)).xyz, 1.0);\n}\n"},color:{"color.frag":"#include <util/fsPrecision.glsl>\n#include <util/slice.glsl>\n\nuniform vec4 eColor;\n#ifdef VERTEX_COLORS\nvarying vec4 vColor;\n#endif\n\nvarying vec3 vpos;\n\nvoid main() {\n  discardBySlice(vpos);\n\n#ifdef VERTEX_COLORS\n  gl_FragColor = vColor * eColor;\n#else\n  gl_FragColor = eColor;\n#endif\n}\n","color.vert":"#include <util/vsPrecision.glsl>\n\nuniform mat4 proj;\nuniform mat4 view;\nuniform mat4 model;\n\nattribute vec3 position;\n#ifdef VERTEX_COLORS\nattribute vec4 color;\n\nvarying vec4 vColor;\n#endif\n\nvarying vec3 vpos;\n\nvoid main(void) {\n#ifdef VERTEX_COLORS\n  vColor = color * 0.003921568627451; // = 1/255;\n#endif\n  vpos = (model * vec4(position, 1.0)).xyz;\n\n  gl_Position = proj * view * vec4(vpos, 1.0);\n}\n"},defaultMaterial:{"colorMixMode.glsl":"#include <util/color.glsl>\n\n/*\n * The color mix modes are encoded in the symbol color as follows:\n *  - Fully transparent symbols are represented with alpha 0 for\n *    all color mix modes (except ignore).\n *  - color mix mode ignore is encoded as multiply with white\n *  - the other 3 color mix modes (tint, replace, multiply) are\n *    equally distributed on the remaining 255 alpha values, which\n *    gives us 85 possible alpha values\n *\n * alpha             0 : fully transparent\n * alpha in [  1 -  85]: tint\n * alpha in [ 86 - 170]: replace\n * alpha in [171 - 255]: multiply\n */\nvec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {\n  float symbolAlpha = 0.0;\n\n  const float maxTint = 85.0;\n  const float maxReplace = 170.0;\n  const float scaleAlpha = 3.0;\n\n  if (symbolColor.a == 0.0) {\n    colorMixMode = 1; // fully transparent -> multiply\n    symbolAlpha = 0.0;\n  }\n  else if (symbolColor.a <= maxTint) {\n    colorMixMode = 0; // tint\n    symbolAlpha = scaleAlpha * symbolColor.a;\n  }\n  else if (symbolColor.a <= maxReplace) {\n    colorMixMode = 3; // replace\n    symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);\n  }\n  else {\n    colorMixMode = 1;  // multiply\n    symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);\n  }\n\n  return vec4(symbolColor.rgb, symbolAlpha);\n}\n\nvec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {\n\n  // workaround for artifacts in OSX using Intel Iris Pro\n  // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n  vec3 internalMixed = internalColor * textureColor;\n  vec3 allMixed = internalMixed * externalColor;\n\n  if (mode == 1 /* multiply */) {\n    return allMixed;\n  }\n  else if (mode == 2 /* ignore */ ) {\n    return internalMixed;\n  }\n  else if (mode == 3 /* replace */ ) {\n    return externalColor;\n  }\n  else {\n    // tint (or something invalid)\n    vec3 hsvIn = rgb2hsv(internalMixed);\n    vec3 hsvTint = rgb2hsv(externalColor);\n    vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, hsvIn.z * hsvTint.z);\n    return hsv2rgb(hsvOut);\n  }\n}\n\nfloat mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {\n\n  // workaround for artifacts in OSX using Intel Iris Pro\n  // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n  float internalMixed = internalOpacity * textureOpacity;\n  float allMixed = internalMixed * externalOpacity;\n\n  if (mode == 2 /* ignore */ ) {\n    return internalMixed;\n  }\n  else if (mode == 3 /* replace */ ) {\n    return externalOpacity;\n  }\n  else {\n    // multiply or tint (or something invalid)\n    return allMixed;\n  }\n}\n","colorPass.frag":"#include <util/enableExtensions.glsl>\n#include <util/fsPrecision.glsl>\n#include <util/slice.glsl>\n#include <util/sceneLighting.glsl>\n\n#ifdef TEXTURING\nuniform sampler2D tex;\nuniform vec2 texSize;\nvarying vec2 vtc;\n#ifdef TEXTURE_ATLAS\nvarying vec4 regionV;\n#endif\n#endif\n\nuniform vec3 camPos;\nuniform vec3 localOrigin;\n\n// material parameters\n//////////////////////////////////////////\nuniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 specular;\nuniform float opacity;\nuniform float layerOpacity;\n\n#if defined(SYMBOLVERTEXCOLORS) || defined(COMPONENTCOLORS)\nvarying mediump float colorMixMode; // varying int is not supported in WebGL\n#else\nuniform int colorMixMode;\n#endif\n\n#ifdef RECEIVE_SHADOWS\nuniform sampler2D depthTex;\nuniform int shadowMapNum;\nuniform vec4 shadowMapDistance;\nuniform mat4 shadowMapMatrix[4];\nuniform float depthHalfPixelSz;\n#endif\n\n#ifdef RECEIVE_SSAO\nuniform sampler2D ssaoTex;\nuniform vec4 viewportPixelSz;\n#endif\n\nvarying vec3 vpos;\nvarying vec3 vnormal;\n#if defined(VERTEXCOLORS)\nvarying vec4 vcolor;\n#endif\nvarying vec4 vcolorExt;\n\n#ifdef RECEIVE_SHADOWS\nvarying float linearDepth;\n#include <util/shadow.glsl>\n#endif\n\n#ifdef TEXTURING\n#include <materials/defaultMaterial/texturing.glsl>\n#endif\n\n#include <materials/defaultMaterial/colorMixMode.glsl>\n\nvoid main() {\n  discardBySlice(vpos);\n\n#ifdef TEXTURING\n  vec4 texColor = textureLookup(tex, vtc);\n\n  if (texColor.a * coverageCorrectionFactor(vtc) < ALPHA_THRESHOLD) {\n    discard;\n  }\n#else /* TEXTURING */\n  vec4 texColor = vec4(1,1,1,1);\n#endif /* TEXTURING */\n\n  vec3 viewDir = vpos - camPos;\n\n  // compute normal\n  // TODO: this is not in sync with the normal pass\n#ifdef GROUND_NORMAL_SHADING\n#ifdef VIEWING_MODE_GLOBAL\n  vec3 normal = normalize(vpos + localOrigin);\n#else\n  vec3 normal = vec3(0,0,1);\n#endif\n#else\n#ifdef DOUBLESIDED\n  vec3 normal = dot(vnormal, viewDir)>0.0 ? -vnormal : vnormal;\n#elif defined(WINDINGORDERDOUBLESIDED)\n  vec3 normal = gl_FrontFacing ? vnormal : -vnormal;\n#else\n  vec3 normal = vnormal;\n#endif\n  normal = normalize(normal);\n#endif\n\n  // compute ssao\n#ifdef RECEIVE_SSAO\n  float ssao = texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n  ssao = viewportPixelSz.z < 0.0 ? 1.0 : ssao;\n#else\n  float ssao = 1.0;\n#endif\n\n  // At global scale we create some additional ambient light based on the main light to simulate global illumination\n  float additionalAmbientScale;\n  vec3 additionalLight = sceneLightingAdditionalLightGlobal(vpos + localOrigin, ssao, additionalAmbientScale);\n\n  // compute shadowing\n  float shadow = 0.0;\n#ifdef RECEIVE_SHADOWS\n  shadow = evalShadow(vpos, linearDepth, depthTex, shadowMapNum, shadowMapDistance, shadowMapMatrix, depthHalfPixelSz);\n#elif defined(VIEWING_MODE_GLOBAL)\n  // at global scale (and in global scenes) we fall back to this approximation\n  // to shadow objects on the dark side of the earth\n  shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);\n#endif\n\n  vec3 matColor = max(ambient, diffuse); // combine the old material parameters into a single one\n#if defined(VERTEXCOLORS)\n  // Internal colors: varying vcolor + uniform ambient/diffuse, external colors: varying vcolorExt\n  vec3 albedo_ = mixExternalColor(vcolor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n  float opacity_ = layerOpacity * mixExternalOpacity(vcolor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n#else\n  // Internal colors: uniform ambient/diffuse, external colors: varying vcolorExt\n  vec3 albedo_ = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n  float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n#endif\n  albedo_+= 0.25 * specular; // don't completely ignore specular for now\n\n#ifdef TRANSPARENCY_DISCARD\n  if (opacity_ < 0.001) {\n    discard;\n  }\n#endif\n\n  vec3 shadedColor = evaluateSceneLighting(normal, albedo_, shadow, 1.0 - ssao, additionalLight);\n  gl_FragColor = vec4(shadedColor, opacity_);\n}\n","colorPass.vert":"#include <util/vsPrecision.glsl>\n\n#include <materials/defaultMaterial/commonInputs.glsl>\n\n#ifdef INSTANCEDCOLOR\nattribute vec4 instanceColor;\n#endif\nattribute vec3 position;\n#ifdef COMPRESSED_NORMALS\nattribute vec2 normalCompressed;\n#else\nattribute vec3 normal;\n#endif\nvarying vec3 vpos;\nvarying vec3 vnormal;\n\n#ifdef TEXTURING\nattribute vec2 uv0;\nvarying vec2 vtc;\n#ifdef TEXTURE_ATLAS\nattribute vec4 region;\nvarying vec4 regionV;\n#endif\n#endif\n\n#ifdef COMPONENTCOLORS\nuniform sampler2D uComponentColorTex;\nuniform vec2 uComponentColorTexInvDim;\n\nattribute float componentIndex;\n\nvec4 readComponentColor() {\n  float normalizedIndex = (componentIndex + 0.5) * uComponentColorTexInvDim.x;\n  vec2 indexCoord = vec2(\n    mod(normalizedIndex, 1.0),\n    (floor(normalizedIndex) + 0.5) * uComponentColorTexInvDim.y\n  );\n  return texture2D(uComponentColorTex, indexCoord);\n}\n#endif\n\n#ifdef RECEIVE_SHADOWS\nvarying float linearDepth;\n#endif\n\n#ifdef VERTEXCOLORS\nattribute vec4 color;\n#endif\n\n#ifdef SYMBOLVERTEXCOLORS\nattribute vec4 symbolColor;\n#endif\n\n#if defined(VERTEXCOLORS)\nvarying vec4 vcolor;\n#endif\n\n// Workaround for https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/13452\n// We pass the externalColor uniform from VS to FS through the vcolorExt varying because\n// there is a driver bug for Intel Integrated Graphics which led to rendering artifacts\n// since the introduction of https://devtopia.esri.com/WebGIS/arcgis-js-api/pull/12673\n// This should be further cleaned up later with through the following issue:\n// https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/12763\nuniform vec4 externalColor;\nvarying vec4 vcolorExt;\n\n#if defined(SYMBOLVERTEXCOLORS) || defined(COMPONENTCOLORS)\nvarying mediump float colorMixMode; // varying int is not supported in WebGL\n#endif\n\n#include <util/visualVariables.glsl>\n\n#if defined(VV_SIZE) || defined(VV_COLOR)\nattribute vec4 instanceFeatureAttribute;\n#endif\n\n#include <materials/defaultMaterial/commonFunctions.glsl>\n#include <materials/defaultMaterial/localCenter.glsl>\n#include <materials/defaultMaterial/localNormal.glsl>\n#include <materials/defaultMaterial/colorMixMode.glsl>\n\nvoid main() {\n  vpos = calculateVPos();\n\n#ifdef INSTANCED_DOUBLE_PRECISION\n  vnormal = normalize(modelNormal * localNormal().xyz);\n\n  vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\n  vpos -= originDelta;\n\n#ifdef VERTICAL_OFFSET\n  vec3 centerPos = model * localCenter().xyz;\n  vpos += calculateVerticalOffset(centerPos, localOrigin);\n#endif\n#else /* INSTANCED_DOUBLE_PRECISION */\n  vnormal = normalize((modelNormal * localNormal()).xyz);\n\n#ifdef VERTICAL_OFFSET\n  vec3 centerPos = (model * localCenter()).xyz;\n  vpos += calculateVerticalOffset(centerPos, localOrigin);\n#endif\n#endif /* INSTANCED_DOUBLE_PRECISION */\n\n  gl_Position = proj * view * vec4(vpos, 1.0);\n\n#ifdef RECEIVE_SHADOWS\n  // Shadowmap's cascading index used to be based on '1.0 / gl_FragCoord.w'\n  // (i.e. the perspective interpolation of 'gl_Position.w'). Precision\n  // issues on iPad/iPhone with the 'w' component require the depth to be\n  // passed as varying to properly drive the cascading shadow map index.\n  linearDepth = gl_Position.w;\n#endif\n\n#ifdef VERTEXCOLORS\n  vcolor = color * 0.003921568627451; // = 1/255\n#endif\n\n  vcolorExt = externalColor;\n\n#ifdef INSTANCEDCOLOR\n  vcolorExt *= instanceColor;\n#endif\n#ifdef VV_COLOR\n  vcolorExt *= vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);\n#endif\n#ifdef SYMBOLVERTEXCOLORS\n  int symbolColorMixMode;\n  vcolorExt *= decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451; // = 1/255;\n  colorMixMode = float(symbolColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts\n#endif\n#ifdef COMPONENTCOLORS\n  int symbolColorMixMode;\n  vcolorExt *= decodeSymbolColor(readComponentColor() * 255.0, symbolColorMixMode) * 0.003921568627451; // = 1/255;\n  colorMixMode = float(symbolColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts\n#endif\n\n#ifdef TEXTURING\n#ifndef FLIPV\n  vtc = uv0;\n#else\n  vtc = vec2(uv0.x, 1.0-uv0.y);\n#endif\n#ifdef TEXTURE_ATLAS\n  regionV = region;\n#endif\n#endif /* TEXTURING */\n\n}\n","commonFunctions.glsl":"#include <materials/defaultMaterial/localPosition.glsl>\n#include <util/doublePrecision.glsl>\n\nvec3 calculateVPos() {\n#ifdef INSTANCED_DOUBLE_PRECISION\n  return model * localPosition().xyz;\n#else\n  return (model * localPosition()).xyz;\n#endif\n}\n\n#ifdef VERTICAL_OFFSET\n#ifdef SCREEN_SIZE_PERSPECTIVE\n#include <util/screenSizePerspective.glsl>\n#endif\n\nvec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n  float viewDistance = length((view * vec4(worldPos, 1)).xyz);\n  float verticalOffsetOffsetDistance = verticalOffset.x * viewDistance;\n\n#ifdef VIEWING_MODE_GLOBAL\n  vec3 worldNormal = normalize(worldPos + localOrigin);\n#else\n  vec3 worldNormal = vec3(0, 0, 1);\n#endif\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n  float cosAngle = dot(worldNormal, normalize(worldPos - camPos));\n\n  float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);\n#else\n  float verticalOffsetScreenHeight = verticalOffset.x;\n#endif\n\n  // Screen sized offset in world space, used for example for line callouts\n  float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);\n\n  return worldNormal * worldOffset;\n}\n#endif\n","commonInputs.glsl":"uniform mat4 proj;\nuniform mat4 view;\n#ifdef INSTANCED_DOUBLE_PRECISION\nuniform vec3 viewOriginHi;\nuniform vec3 viewOriginLo;\n#endif\nuniform vec3 camPos;\nuniform vec3 localOrigin;\n\n#ifdef INSTANCED\n#ifdef INSTANCED_DOUBLE_PRECISION\nattribute vec3 modelOriginHi;\nattribute vec3 modelOriginLo;\nattribute mat3 model;\nattribute mat3 modelNormal;\n#else /* INSTANCED_DOUBLE_PRECISION */\nattribute mat4 model;\nattribute mat4 modelNormal;\n#endif /* INSTANCED_DOUBLE_PRECISION */\n#else /* INSTANCED */\nuniform mat4 model;\nuniform mat4 modelNormal;\n#endif /* INSTANCED */\n\n#ifdef VERTICAL_OFFSET\n// [ verticalOffsetPerDistance, minWorldLength, maxWorldLength ]\nuniform vec4 verticalOffset;\n#ifdef SCREEN_SIZE_PERSPECTIVE\nuniform vec4 screenSizePerspectiveAlignment;\n#endif\n#endif\n","depthPass.frag":"#include <util/enableExtensions.glsl>\n#include <util/fsPrecision.glsl>\n#include <util/encoding.glsl>\n#include <util/depth.glsl>\n#include <util/slice.glsl>\n\nvarying float depth;\nvarying vec3 vpos;\n\n#ifdef TEXTURING\nuniform sampler2D tex;\nuniform vec2 texSize;\nvarying vec2 vtc;\n#ifdef TEXTURE_ATLAS\nvarying vec4 regionV;\n#endif\n#endif\n\n#ifdef TEXTURING\n#include <materials/defaultMaterial/texturing.glsl>\n#endif\n\nvoid main() {\n  discardBySlice(vpos);\n\n#ifdef TEXTURING\n  if (textureLookup(tex, vtc).a * coverageCorrectionFactor(vtc) < ALPHA_THRESHOLD) {\n    discard;\n  }\n#endif\n\n#ifndef BIAS_SHADOWMAP\n  gl_FragColor = float2rgba(depth);\n#else\n  gl_FragColor = float2rgba(calcFragDepth(depth));\n#endif\n}\n","depthPass.vert":"#include <util/vsPrecision.glsl>\n\n#include <materials/defaultMaterial/commonInputs.glsl>\n\nuniform vec2 nearFar;\nattribute vec3 position;\n\nvarying float depth;\nvarying vec3 vpos;\n\n#ifdef TEXTURING\nattribute vec2 uv0;\nvarying vec2 vtc;\n#ifdef TEXTURE_ATLAS\nattribute vec4 region;\nvarying vec4 regionV;\n#endif\n#endif\n\n#include <util/visualVariables.glsl>\n\n#if defined(VV_CUSTOM_MODEL_MATRIX)\nattribute vec4 instanceFeatureAttribute;\n#endif\n\n#include <materials/defaultMaterial/commonFunctions.glsl>\n#include <materials/defaultMaterial/localCenter.glsl>\n\nvoid main(void) {\n  vpos = calculateVPos();\n\n#ifdef INSTANCED_DOUBLE_PRECISION\n  vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\n  vpos -= originDelta;\n\n#ifdef VERTICAL_OFFSET\n  vec3 centerPos = model * localCenter().xyz;\n  vpos += calculateVerticalOffset(centerPos, localOrigin);\n#endif\n#else /* INSTANCED_DOUBLE_PRECISION */\n#ifdef VERTICAL_OFFSET\n  vec3 centerPos = (model * localCenter()).xyz;\n  vpos += calculateVerticalOffset(centerPos, localOrigin);\n#endif\n#endif /* INSTANCED_DOUBLE_PRECISION */\n\n  vec4 eye = view * vec4(vpos, 1);\n\n  gl_Position = proj * eye;\n  depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;\n\n#ifdef TEXTURING\n#ifndef FLIPV\n  vtc = uv0;\n#else\n  vtc = vec2(uv0.x, 1.0-uv0.y);\n#endif\n#ifdef TEXTURE_ATLAS\n  regionV = region;\n#endif\n#endif /* TEXTURING */\n\n}\n","highlightPass.frag":"#include <util/enableExtensions.glsl>\n#include <util/fsPrecision.glsl>\n#include <util/slice.glsl>\n#include <util/highlight.glsl>\n\nvarying vec3 vpos;\n\n#ifdef TEXTURING\nuniform sampler2D tex;\nuniform vec2 texSize;\nvarying vec2 vtc;\n#ifdef TEXTURE_ATLAS\nvarying vec4 regionV;\n#endif\n#endif\n\nuniform sampler2D depthTex;\nuniform vec4 highlightViewportPixelSz;\n\n#ifdef TEXTURING\n#include <materials/defaultMaterial/texturing.glsl>\n#endif\n\nvoid main() {\n  discardBySlice(vpos);\n\n#ifdef TEXTURING\n  if (textureLookup(tex, vtc).a * coverageCorrectionFactor(vtc) < ALPHA_THRESHOLD) {\n    discard;\n  }\n#endif\n\n  gl_FragColor = highlightData(gl_FragCoord, depthTex, highlightViewportPixelSz);\n}\n","highlightPass.vert":"#include <util/vsPrecision.glsl>\n\n#include <materials/defaultMaterial/commonInputs.glsl>\n\nattribute vec3 position;\n\nvarying vec3 vpos;\n\n#ifdef TEXTURING\nattribute vec2 uv0;\nvarying vec2 vtc;\n#ifdef TEXTURE_ATLAS\nattribute vec4 region;\nvarying vec4 regionV;\n#endif\n#endif\n\n#include <util/visualVariables.glsl>\n\n#if defined(VV_CUSTOM_MODEL_MATRIX)\nattribute vec4 instanceFeatureAttribute;\n#endif\n\n#include <materials/defaultMaterial/commonFunctions.glsl>\n#include <materials/defaultMaterial/localCenter.glsl>\n\nvoid main(void) {\n  vpos = calculateVPos();\n\n#ifdef INSTANCED_DOUBLE_PRECISION\n  vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\n  vpos -= originDelta;\n\n#ifdef VERTICAL_OFFSET\n  vec3 centerPos = model * localCenter().xyz;\n  vpos += calculateVerticalOffset(centerPos, localOrigin);\n#endif\n#else /* INSTANCED_DOUBLE_PRECISION */\n#ifdef VERTICAL_OFFSET\n  vec3 centerPos = (model * localCenter()).xyz;\n  vpos += calculateVerticalOffset(centerPos, localOrigin);\n#endif\n#endif /* INSTANCED_DOUBLE_PRECISION */\n\n  gl_Position = proj * view * vec4(vpos, 1);\n\n#ifdef TEXTURING\n#ifndef FLIPV\n  vtc = uv0;\n#else\n  vtc = vec2(uv0.x, 1.0-uv0.y);\n#endif\n#ifdef TEXTURE_ATLAS\n  regionV = region;\n#endif\n#endif /* TEXTURING */\n\n}\n","localCenter.glsl":"#ifdef VV_CUSTOM_MODEL_MATRIX\n# ifdef VERTICAL_OFFSET\nvec4 localCenter() { return vvTransformPosition(vec3(0, 0, 0), instanceFeatureAttribute); }\n# endif\n#else\n# ifdef VERTICAL_OFFSET\nvec4 localCenter() { return vec4(vec3(0, 0, 0), 1.0); }\n# endif\n#endif\n","localNormal.glsl":"#include <util/normalEncoding.glsl>\n\n#ifdef VV_CUSTOM_MODEL_MATRIX\n# ifdef COMPRESSED_NORMALS\nvec4 localNormal() { return vvTransformNormal(decodeNormal(normalCompressed), instanceFeatureAttribute); }\n# else\nvec4 localNormal() { return vvTransformNormal(normal, instanceFeatureAttribute); }\n# endif\n#else\n# ifdef COMPRESSED_NORMALS\nvec4 localNormal() { return vec4(decodeNormal(normalCompressed), 1.0); }\n# else\nvec4 localNormal() { return vec4(normal, 1.0); }\n# endif\n#endif\n","localPosition.glsl":"#ifdef VV_CUSTOM_MODEL_MATRIX\nvec4 localPosition() { return vvTransformPosition(position, instanceFeatureAttribute); }\n#else\nvec4 localPosition() { return vec4(position, 1.0); }\n#endif\n","normalPass.frag":"#include <util/enableExtensions.glsl>\n#include <util/fsPrecision.glsl>\n#include <util/slice.glsl>\n\nvarying vec3 vnormal;\nvarying vec3 vpos;\n\n#ifdef TEXTURING\nuniform sampler2D tex;\nuniform vec2 texSize;\nvarying vec2 vtc;\n#ifdef TEXTURE_ATLAS\nvarying vec4 regionV;\n#endif\n#endif\n\n#ifdef TEXTURING\n#include <materials/defaultMaterial/texturing.glsl>\n#endif\n\nvoid main() {\n  discardBySlice(vpos);\n\n#ifdef TEXTURING\n  if (textureLookup(tex, vtc).a * coverageCorrectionFactor(vtc) < ALPHA_THRESHOLD) {\n    discard;\n  }\n#endif\n\n  vec3 normal = normalize(vnormal);\n  if (gl_FrontFacing == false) normal = -normal;\n\n#ifndef ALPHA_ZERO\n  gl_FragColor = vec4(vec3(.5) + .5 * normal, 1.0);\n#else\n  gl_FragColor = vec4(vec3(.5) + .5 * normal, 0.0);\n#endif\n}\n","normalPass.vert":"#include <util/vsPrecision.glsl>\n\n#include <materials/defaultMaterial/commonInputs.glsl>\n\nuniform mat4 viewNormal;\nattribute vec3 position;\n#ifdef COMPRESSED_NORMALS\nattribute vec2 normalCompressed;\n#else\nattribute vec3 normal;\n#endif\n\n#ifdef TEXTURING\nattribute vec2 uv0;\nvarying vec2 vtc;\n#ifdef TEXTURE_ATLAS\nattribute vec4 region;\nvarying vec4 regionV;\n#endif\n#endif\n\nvarying vec3 vnormal;\nvarying vec3 vpos;\n\n#include <util/visualVariables.glsl>\n\n#if defined(VV_CUSTOM_MODEL_MATRIX)\nattribute vec4 instanceFeatureAttribute;\n#endif\n\n#include <materials/defaultMaterial/commonFunctions.glsl>\n#include <materials/defaultMaterial/localCenter.glsl>\n#include <materials/defaultMaterial/localNormal.glsl>\n\nvoid main(void) {\n  vpos = calculateVPos();\n\n#ifdef INSTANCED_DOUBLE_PRECISION\n  vpos += modelOriginHi;\n  vnormal = normalize((viewNormal * vec4(modelNormal * localNormal().xyz, 1.0)).xyz);\n\n  vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\n  vpos -= originDelta;\n\n#ifdef VERTICAL_OFFSET\n  vec3 centerPos = model * localCenter().xyz;\n  vpos += calculateVerticalOffset(centerPos, localOrigin);\n#endif\n#else /* INSTANCED_DOUBLE_PRECISION */\n  vnormal = normalize((viewNormal * modelNormal * localNormal()).xyz);\n\n#ifdef VERTICAL_OFFSET\n  vec3 centerPos = (model * localCenter()).xyz;\n  vpos += calculateVerticalOffset(centerPos, localOrigin);\n#endif\n#endif /* INSTANCED_DOUBLE_PRECISION */\n\n  gl_Position = proj * view * vec4(vpos, 1);\n\n#ifdef TEXTURING\n#ifndef FLIPV\n  vtc = uv0;\n#else\n  vtc = vec2(uv0.x, 1.0-uv0.y);\n#endif\n#ifdef TEXTURE_ATLAS\n  regionV = region;\n#endif\n#endif /* TEXTURING */\n\n}\n","texturing.glsl":"float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {\n  // from:\n  //   - OpenGLES Common Profile Specification Version 2.0.25, Section 3.7.7 - Texture Minification\n  //   - https://www.opengl.org/discussion_boards/showthread.php/171485-Texture-LOD-calculation-(useful-for-atlasing)\n  //   - http://www.linedef.com/virtual-texture-demo.html\n  float deltaMaxSqr = max(dot(ddx, ddx), dot(ddy, ddy));\n  return max(0.0, 0.5 * log2(deltaMaxSqr));\n}\n\n// based on https://medium.com/@bgolus/anti-aliased-alpha-test-the-esoteric-alpha-to-coverage-8b177335ae4f\nfloat coverageCorrectionFactor(vec2 uv) {\n#ifdef ALPHA_COVERAGE_CORRECTION\n  const float MipScale = 0.25;\n  uv *= texSize;\n#ifdef TEXTURE_ATLAS\n  uv *= region.zw - region.xy;\n#endif\n  return 1.0 + max(0.0, calcMipMapLevel(dFdx(uv), dFdy(uv))) * MipScale;\n#else\n  return 1.0;\n#endif\n}\n\n#ifdef ALPHA_COVERAGE_CORRECTION\n  #define ALPHA_THRESHOLD 0.5\n#else\n  #define ALPHA_THRESHOLD 0.33\n#endif\n\nvec4 textureAtlasLookup(sampler2D tex, vec2 uv, vec4 region, vec2 texSize) {\n  //[umin, vmin, umax, vmax]\n  vec2 atlasScale = region.zw - region.xy;\n  vec2 uvAtlas = fract(uv) * atlasScale + region.xy;\n\n  vec4 texColor;\n\n  // calculate derivative of continuous texture coordinate\n  // to avoid mipmapping artifacts caused by manual wrapping in shader\n  vec2 dUVdx = dFdx(uv) * atlasScale;\n  vec2 dUVdy = dFdy(uv) * atlasScale;\n\n#ifdef GL_EXT_shader_texture_lod\n  return texture2DGradEXT(tex, uvAtlas, dUVdx, dUVdy);\n#else\n  // use bias to compensate for difference in automatic vs desired mipmap level\n  vec2 dUVdxAuto = dFdx(uvAtlas);\n  vec2 dUVdyAuto = dFdy(uvAtlas);\n  float mipMapLevel = calcMipMapLevel(dUVdx * texSize, dUVdy * texSize);\n  float autoMipMapLevel = calcMipMapLevel(dUVdxAuto * texSize, dUVdyAuto * texSize);\n\n  return texture2D(tex, uvAtlas, mipMapLevel - autoMipMapLevel);\n#endif\n}\n\nvec4 textureLookup(sampler2D tex, vec2 uv) {\n#ifdef TEXTURE_ATLAS\n  return textureAtlasLookup(tex, uv, regionV, texSize);\n#else\n  return texture2D(tex, uv);\n#endif\n}\n\n"},hud:{"colorPass.frag":"#include <materials/hud/hudHeader.glsl>\n\nvoid main() {\n#include <materials/hud/hudMain.glsl>\n}\n","highlightPass.frag":"#include <materials/hud/hudHeader.glsl>\n#include <util/highlight.glsl>\n\nuniform sampler2D depthTex;\nuniform vec4 highlightViewportPixelSz;\n\nvoid main() {\n#include <materials/hud/hudMain.glsl>\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\n  // Instead of deciding on a per-pixel basis if the highlight is occluded,\n  // do it for all highlight pixel based on the centroid occlusion. This\n  // is a temporary solution for:\n  // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/9645\n  if (voccluded == 1.0) {\n    gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);\n  } else {\n    gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);\n  }\n#else\n  gl_FragColor = highlightData(gl_FragCoord, depthTex, highlightViewportPixelSz);\n#endif\n}\n","hud.vert":"#include <util/vsPrecision.glsl>\n#include <util/alignPixel.glsl>\n#include <util/hud.glsl>\n#include <util/visualVariables.glsl>\n\nuniform vec2 screenOffset;\nuniform vec2 anchorPos;\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\nuniform vec4 screenSizePerspective;\n#endif\n\n#ifdef DEBUG_DRAW_BORDER\nvarying vec3 debugBorderCoords;\n#endif\n\nattribute vec2 uv0;\nattribute vec4 color;\nattribute vec2 size;\nattribute vec4 auxpos2;\n\nvarying vec4 vcolor;\n\nvarying vec2 vtc;\nvarying vec2 vsize;\n\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\nvarying float voccluded;\n#endif\n\nvoid main(void) {\n  ProjectHUDAux projectAux;\n  vec4 posProj = projectPositionHUD(projectAux);\n\n  vec2 inputSize;\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n\n  inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);\n\n  vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n\n#else\n\n  inputSize = size;\n\n  vec2 screenOffsetScaled = screenOffset;\n#endif\n\n#ifdef VV_SIZE\n  // only use width (.xx) for proportional scaling\n  // (if no width was defined in vv, width\n  //  will be a copy of height vv)\n  inputSize *= vvGetScale(auxpos2).xx;\n#endif\n\n  vec2 combinedSize = inputSize * pixelRatio;\n  vec4 quadOffset = vec4(0);\n\n#if defined(OCCL_TEST) || defined(BINARY_HIGHLIGHT_OCCLUSION)\n  bool visible = testVisibilityHUD(posProj);\n#endif\n\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\nvoccluded = visible ? 0.0 : 1.0;\n#endif\n\n#ifdef OCCL_TEST\n  if (visible) {\n#endif\n    // UV goes from 0 to 1.99999, where the integer part is used\n    // for the normalized vertex coordinates, and the fractional\n    // part is used for texture sampling\n    vec2 uv01 = floor(uv0);\n    vec2 uv = uv0 - uv01;\n\n    // Displace icon based on anchor position (normalized for size) and\n    // absolute screen offset. anchorPos is [-0.5, 0.5]\n    quadOffset.xy = ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;\n\n#ifdef SIGNED_DISTANCE_FIELD\n\n    // SDF primitives might be scaled so that the SDF texture resolution does\n    // not match the resolution of the canvas, but we still want to render\n    // outline-only ('cross' and 'x') primitives cleanly. Aligning to a screen\n    // pixel border at the geometry center achieves this, since SDF textures\n    // always have power of 2 dimensions.\n    posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;\n#else\n    posProj += quadOffset;\n\n    // Aligning vertex positions to the nearest (using 'floor') screen pixel\n    // border renders textures with pixel-perfect results. If the texture\n    // resolution does not match the canvas resolution then aligning is\n    // redundant.\n    if (inputSize.x == size.x) {\n      posProj = alignToPixelOrigin(posProj, viewport.zw);\n    }\n#endif\n\n    gl_Position = posProj;\n\n    vtc = uv;\n\n#ifdef DEBUG_DRAW_BORDER\n    debugBorderCoords = vec3(uv01, 1.0 / combinedSize);\n#endif\n\n    vsize = inputSize;\n#ifdef OCCL_TEST\n  } else {\n    vtc = vec2(.0);\n\n#ifdef DEBUG_DRAW_BORDER\n    debugBorderCoords = vec3(0);\n#endif\n\n  }\n#endif\n\n  gl_Position = posProj;\n\n#ifdef VV_COLOR\n  vcolor = vvGetColor(auxpos2, vvColorValues, vvColorColors);\n#else\n  vcolor = color / 255.0;\n#endif\n}\n","hudHeader.glsl":"#include <util/enableExtensions.glsl>\n#include <util/fsPrecision.glsl>\n#include <util/encoding.glsl>\n#include <util/color.glsl>\n\nuniform sampler2D tex;\nuniform vec4 overrideColor;\nuniform vec4 outlineColor;\nuniform float outlineSize;\n\nvarying vec4 vcolor;\n\nvarying vec2 vtc;\nvarying vec2 vsize;\n\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\nvarying float voccluded;\n#endif\n\n#ifdef DEBUG_DRAW_BORDER\nvarying vec3 debugBorderCoords;\n#endif\n","hudMain.glsl":"#ifdef SIGNED_DISTANCE_FIELD\n  vec4 color = vec4(0.0, 0.0, 0.0, 0.0);\n  vec4 fillPixelColor = overrideColor * vcolor;\n\n  // Attempt to sample texel centers to avoid that thin cross outlines\n  // disappear with large symbol sizes.\n  // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041\n  const float txSize = 128.0;\n  const float texelSize = 1.0 / txSize;\n  // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel\n  vec2 scaleFactor = (vsize - txSize) * texelSize;\n  vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;\n\n  // Get distance and map it into [-0.5, 0.5]\n  float d = rgba2float(texture2D(tex, samplePos)) - 0.5;\n\n  // Distance in output units (i.e. pixels)\n  float dist = d * vsize.x;\n\n  // Create smooth transition from the icon into its outline\n  fillPixelColor.a *= clamp(0.5 - dist, 0.0, 1.0);\n\n  if (outlineSize > 0.25) {\n    vec4 outlinePixelColor = outlineColor;\n    float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);\n\n    // Create smooth transition around outline\n    outlinePixelColor.a *= clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);\n\n    // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)\n    float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);\n    vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +\n      vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);\n\n    gl_FragColor = vec4(compositeColor, compositeAlpha);\n  }\n  else {\n    gl_FragColor = premultiplyAlpha(fillPixelColor);\n  }\n\n  // visualize SDF:\n  // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);\n#else\n\n  // HUDMaterial is rendered with a blending mode that assumes a pre-multiplied\n  // fragment color. Input textures should already be pre-multiplied and so\n  // don't require adjustment, but the override and vertex colors must be\n  // modulated by their alpha values.\n\n  gl_FragColor = texture2D(tex, vtc, -0.5) * premultiplyAlpha(overrideColor * vcolor);\n\n#endif\n\n#ifdef DEBUG_DRAW_BORDER\n   float isBorder = float(any(lessThan(debugBorderCoords.xy, vec2(debugBorderCoords.z))) || any(greaterThan(debugBorderCoords.xy, vec2(1.0 - debugBorderCoords.z))));\n   gl_FragColor = mix(gl_FragColor, vec4(1, 0, 1, 1), isBorder);\n#endif\n\n  if (gl_FragColor.a < 0.1) {\n    discard;\n  }\n","occlusionTest.frag":"#include <util/fsPrecision.glsl>\n\nuniform vec4 color;\n\nvoid main() {\n  gl_FragColor = color;\n}\n","occlusionTest.vert":"#include <util/vsPrecision.glsl>\n#include <util/alignPixel.glsl>\n#include <util/hud.glsl>\n#include <util/slice.glsl>\n\nvoid main(void) {\n  vec4 posProjCenter;\n\n  // Check for special value of position (0, 0, 0) which is used by the Renderer when graphics\n  // are removed before the VBO is recompacted. If this is the case, then we just project outside\n  // of clip space.\n  if (dot(position, position) > 0.0) {\n    // Render single point to center of the pixel to avoid subpixel filtering to affect\n    // the marker color\n    ProjectHUDAux projectAux;\n    vec4 posProj = projectPositionHUD(projectAux);\n    posProjCenter = alignToPixelCenter(posProj, viewport.zw);\n\n    vec3 vpos = projectAux.posModel;\n    if (rejectBySlice(vpos)) {\n      // Project out of clip space\n      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n    }\n  }\n  else {\n    // Project out of clip space\n    posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n  }\n\n  gl_Position = posProjCenter;\n  gl_PointSize = 1.0;\n}\n"},lineCallout:{"lineCallout.frag":"#include <util/fsPrecision.glsl>\n\nuniform vec4 color;\nuniform vec4 borderColor;\n\nvarying vec4 coverageSampling;\nvarying vec2 lineSizes;\n\nvoid main() {\n  // Mix between line and border coverage offsets depending on whether we need\n  // a border (based on the sidedness).\n  vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);\n\n  // Mix between border and line color based on the line coverage (conceptually the line\n  // blends on top of the border background).\n  //\n  // Anti-alias by blending final result using the full (including optional border) coverage\n  // and the color alpha\n  float borderAlpha = color.a * borderColor.a * coverage.y;\n  float colorAlpha = color.a * coverage.x;\n\n  float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);\n\n#ifdef DEPTH_HUD\n\n  if (finalAlpha < 0.01) {\n    discard;\n  }\n\n#else\n\n  // Compute the finalRgb, but keep it pre-multiplied (for unpre-multiplied you\n  // need to divide by finalAlpha). We avoid the division here by setting the\n  // appropriate blending function in the material.\n  vec3 finalRgb = mix(borderColor.rgb * borderAlpha, color.rgb, colorAlpha);\n\n  gl_FragColor = vec4(finalRgb, finalAlpha);\n\n#endif\n\n}\n","lineCallout.vert":"#include <util/vsPrecision.glsl>\n#include <util/alignPixel.glsl>\n#include <util/hud.glsl>\n#include <util/slice.glsl>\n\nattribute vec2 uv0;\n\nuniform float lineSize;\nuniform vec2 pixelToNDC;\nuniform float borderSize;\nuniform vec2 screenOffset;\n\nvarying vec4 coverageSampling;\nvarying vec2 lineSizes;\n\nvoid main(void) {\n\n  ProjectHUDAux projectAux;\n  vec4 endPoint = projectPositionHUD(projectAux);\n\n  vec3 vpos = projectAux.posModel;\n  if (rejectBySlice(vpos)) {\n    gl_Position = vec4(1e38, 1e38, 1e38, 1);\n    return;\n  }\n\n#ifdef OCCL_TEST\n  if (!testVisibilityHUD(endPoint)) {\n    gl_Position = vec4(1e38, 1e38, 1e38, 1);\n    return;\n  }\n#endif\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n  vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n  vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);\n#else\n  vec2 screenOffsetScaled = screenOffset;\n#endif\n\n  // Add view dependent polygon offset to get exact same original starting point. This is mostly\n  // used to get the correct depth value\n  vec3 posView = (view * (model * vec4(position, 1.0))).xyz;\n  applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);\n\n  vec4 startPoint = proj * vec4(posView, 1.0);\n\n  // Apply screen offset to both start and end point\n  vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;\n\n  startPoint.xy += screenOffsetNorm * startPoint.w;\n  endPoint.xy += screenOffsetNorm * endPoint.w;\n\n  // Align start and end to pixel origin\n  vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);\n  vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);\n\n#ifdef DEPTH_HUD\n\n#ifdef DEPTH_HUD_ALIGN_START\n  endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);\n#else\n  startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);\n#endif\n\n#endif\n\n  vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);\n\n  // The direction of the line in screen space\n  vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);\n  vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n\n  float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);\n  float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);\n\n#else\n\n  float lineSizeScaled = lineSize;\n  float borderSizeScaled = borderSize;\n\n#endif\n\n  float halfPixelSize = lineSizeScaled * 0.5;\n  // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned\n  // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,\n  // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel\n  // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).\n  float halfWholePixelSize = floor(lineSizeScaled) * 0.5;\n  float halfPixelSizeInt = floor(halfWholePixelSize);\n\n  // Sub-pixel offset if we need to grow sub-pixels to the left\n  float subpixelOffset = -fract(lineSizeScaled) * float(halfWholePixelSize > 0.0);\n\n  // Pixel offset aligning to whole pixels and adding subpixel offset if needed\n  float pixelOffset = -halfPixelSizeInt + subpixelOffset;\n\n  // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size\n  float padding = 1.0 + borderSizeScaled;\n  vec2 ndcOffset = (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;\n\n  // Offset x/y from the center of the line in screen space\n  projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;\n\n  // Compute a coverage varying which we can use in the fragment shader to determine\n  // how much a pixel is actually covered by the line (i.e. to anti alias the line).\n  // This works by computing two coordinates that can be linearly interpolated and then\n  // subtracted to find out how far away from the line edge we are.\n  float edgeDirection = (uv0.x * 2.0 - 1.0);\n\n  float halfBorderSize = 0.5 * borderSizeScaled;\n  float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;\n  float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);\n\n  float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);\n\n  coverageSampling = vec4(\n    // Edge coordinate\n    outerEdgeCoverageSampler,\n\n    // Border edge coordinate\n    outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,\n\n    // Line offset\n    halfPixelSize - 0.5,\n\n    // Border offset\n    halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)\n  );\n\n  lineSizes = vec2(lineSizeScaled, borderSizeScaled);\n\n  gl_Position = projectedPosition;\n}\n"},measurementArrow:{"measurementArrow.frag":"#include <util/fsPrecision.glsl>\n\nuniform float outlineSize;\nuniform vec4 outlineColor;\nuniform float stripeLength;\nuniform vec4 stripeEvenColor;\nuniform vec4 stripeOddColor;\n\nvarying vec2 vtc;\nvarying float vlength;\nvarying float vradius;\n\n#define INV_SQRT2 (1.0 / sqrt(2.0))\n\nvec4 arrowColor(vec2 tc, float len) {\n  float d = INV_SQRT2 * (tc.x - abs(tc.y));\n  d = min(d, INV_SQRT2 * (len - tc.x - abs(tc.y)));\n  d = min(d, 1.0 - abs(tc.y));\n\n  if (d < 0.0) {\n    return vec4(0.0);\n  } else if (d < outlineSize) {\n    return outlineColor;\n  } else {\n    return fract(0.5 / stripeLength * tc.x * vradius) >= 0.5 ? stripeOddColor : stripeEvenColor;\n  }\n}\n\nvoid main(void) {\n  vec2 ntc = vec2(vtc.x / vradius, vtc.y);\n  vec4 color = arrowColor(ntc, vlength / vradius);\n  if (color.a == 0.0) {\n    discard;\n  }\n  gl_FragColor = color;\n}\n","measurementArrow.vert":"#include <util/vsPrecision.glsl>\n\nuniform mat4 proj;\nuniform mat4 view;\nuniform mat4 model;\n\nuniform float width;\n\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv0;\nattribute float auxpos1;\n\nvarying vec2 vtc;\nvarying float vlength;\nvarying float vradius;\n\nvoid main(void) {\n  vec3 bitangent = normal;\n\n  vtc = uv0;\n  vlength = auxpos1;\n  vradius = 0.5 * width;\n\n  vec4 pos = view * vec4((model * vec4(position + vradius * bitangent * uv0.y, 1.0)).xyz, 1.0);\n  gl_Position = proj * pos;\n}\n"},nativeLine:{"colorPass.frag":"#include <util/fsPrecision.glsl>\n#include <util/slice.glsl>\n\nuniform vec4 color;\nvarying vec3 vpos;\n\nvoid main() {\n  discardBySlice(vpos);\n\n  gl_FragColor = color;\n}\n","highlightPass.frag":"#include <util/fsPrecision.glsl>\n#include <util/slice.glsl>\n#include <util/highlight.glsl>\n\nvarying vec3 vpos;\n\nuniform sampler2D depthTex;\nuniform vec4 highlightViewportPixelSz;\n\nvoid main() {\n  discardBySlice(vpos);\n\n  gl_FragColor = highlightData(gl_FragCoord, depthTex, highlightViewportPixelSz);\n}\n","nativeLine.vert":"#include <util/vsPrecision.glsl>\n\nuniform mat4 proj;\nuniform mat4 view;\nuniform mat4 model;\n\nattribute vec3 position;\n\nvarying vec3 vpos;\n\nvoid main(void) {\n  vpos = (model * vec4(position, 1.0)).xyz;\n  gl_Position = proj * view * vec4(vpos, 1.0);\n}\n"},ribbonLine:{"colorPass.frag":"#include <util/fsPrecision.glsl>\n#include <util/slice.glsl>\n\nuniform vec4 eColor;\nvarying vec4 vColor;\nvarying vec2 vtc;\nvarying vec3 vpos;\n\n#ifdef STIPPLE\nuniform float stippleLengthDoubleInv;\n#endif\n\nvoid main() {\n  discardBySlice(vpos);\n\n#ifdef STIPPLE\n  if (fract(vtc.x * stippleLengthDoubleInv) > 0.5) {\n    discard;\n  }\n#endif\n\n  gl_FragColor = eColor * vColor;\n}\n","highlightPass.frag":"#include <util/fsPrecision.glsl>\n#include <util/slice.glsl>\n\nvarying vec2 vtc;\nvarying vec3 vpos;\n\n#ifdef STIPPLE\nuniform float stippleLengthDoubleInv;\n#endif\n\nvoid main() {\n  discardBySlice(vpos);\n\n#ifdef STIPPLE\n  if (fract(vtc.x * stippleLengthDoubleInv) > 0.5) {\n    discard;\n  }\n#endif\n\n  gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);\n}\n","ribbonLine.vert":'#include <util/vsPrecision.glsl>\n\nuniform mat4 proj;\nuniform mat4 view;\nuniform mat4 model;\n\nuniform float extLineWidth;\nuniform float nearPlane;\n\nattribute vec3 position;\nattribute vec2 uv0;\nattribute vec4 color;\n\nvarying vec2 vtc;\nvarying vec4 vColor;\nvarying vec3 vpos;\n\nattribute float size;\n\n#ifndef WALL\nuniform float miterLimit;\nattribute vec3 auxpos1;\nattribute vec3 auxpos2;\n#endif\n\n#ifdef SCREENSCALE\nuniform vec2 screenSize;\n\nvec4 toScreenCoords(vec3 vertex) {\n  vec4 vClipSpace = proj * view * vec4((model * vec4(vertex, 1.0)).xyz, 1.0);\n  vClipSpace.xy *= screenSize;\n  return vClipSpace/abs(vClipSpace.w);\n}\n\n#define VECTYPE vec2\n#define ZEROVEC vec2(0.0, 0.0)\n#define PERPENDICULAR(v) vec2(v.y, -v.x);\n#define ISOUTSIDE (left.x * right.y - left.y * right.x)*uv0.y > 0.0\n\n#else //ifdef SCREENSCALE\n\n#define VECTYPE vec3\n#define ZEROVEC vec3(0.0, 0.0, 0.0)\n// these macros are only valid for "strip" type lines:\n#define PERPENDICULAR(v) cross(up/*vec3(0.0, 1.0, 0.0)*/, v)\n#define ISOUTSIDE dot(cross(left, right), up/*vec3(0.0, 1.0, 0.0)*/)*uv0.y < 0.0\n\n#endif //ifdef SCREENSCALE\n\nfloat interp(float ncp, vec4 a, vec4 b) {\n  return (-ncp - a.z) / (b.z - a.z);\n}\n\n#ifdef SCREENSCALE\n\nvoid clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next) {\n  float vnp = nearPlane*0.99;\n\n  //We have four vertices per point on the line. Start and end vertices\n  //are treated differently --\x3e d > 0, d < 0\n  float d = abs(uv0.y) - 1.1;\n\n  //current pos behind ncp --\x3e we need to clip\n  if(pos.z > -nearPlane) {\n    if (d < 0.0) {\n      //previous in front of ncp\n      if(prev.z < -nearPlane) {\n        pos = mix(prev, pos, interp(vnp, prev, pos));\n        next = pos;\n      } else {\n        pos = vec4(0, 0, 0, 1);\n      }\n    }\n    //next in front of ncp\n    if(d > 0.0) {\n      if(next.z < -nearPlane) {\n        pos = mix(pos, next, interp(vnp, pos, next));\n        prev = pos;\n      } else {\n        pos = vec4(0, 0, 0, 1);\n      }\n    }\n  } else {\n    //current position visible\n    //previous behind ncp\n    if (prev.z > -nearPlane) {\n      prev = mix(pos, prev, interp(vnp, pos, prev));\n    }\n    //next behind ncp\n    if (next.z > -nearPlane) {\n      next = mix(next, pos, interp(vnp, next, pos));\n    }\n  }\n\n  pos= proj * pos;\n  pos.xy *= screenSize;\n  pos /= pos.w;\n\n  next = proj * next;\n  next.xy *= screenSize;\n  next /= next.w;\n\n  prev = proj * prev;\n  prev.xy *= screenSize;\n  prev /= prev.w;\n}\n\n#endif // SCREENSCALE\n\nvoid main(void) {\n  vpos = (model * vec4(position, 1.0)).xyz;\n\n#ifdef SCREENSCALE\n// Check for special value of uv0.y which is used by the Renderer when graphics\n// are removed before the VBO is recompacted. If this is the case, then we just\n// project outside of clip space.\nif (uv0.y == 0.0) {\n  // Project out of clip space\n  gl_Position = vec4(1e038, 1e038, 1e038, 1.0);\n}\nelse {\n#endif\n\nfloat lineWidth = extLineWidth + size;\n\n#ifdef SCREENSCALE\n\n#if 0\n  vec4 pos = toScreenCoords(position.xyz);\n  vec2 left = (pos - toScreenCoords(auxpos1)).xy;\n  vec2 right = (toScreenCoords(auxpos2) - pos).xy;\n#else\n  vec4 pos  = view * vec4((model * vec4(position.xyz, 1.0)).xyz, 1.0);\n  vec4 prev = view * vec4((model * vec4(auxpos1.xyz, 1.0)).xyz, 1.0);\n  vec4 next = view * vec4((model * vec4(auxpos2.xyz, 1.0)).xyz, 1.0);\n\n  clipAndTransform(pos, prev, next);\n\n  vec2 left = (pos - prev).xy;\n  vec2 right = (next - pos).xy;\n#endif\n\n#else // ifdef SCREENSCALE\n  vec4 pos = vec4(position, 1.0);\n#ifndef WALL\n  vec3 left = position.xyz - auxpos1;\n  vec3 right = auxpos2 - position.xyz;\n  vec3 up = normalize(position.xyz);\n#endif // ifndef WALL\n#endif // ifdef SCREENSCALE\n\n#ifdef WALL\n  float displacementLen = lineWidth;\n  vec3 displacementDir = normalize(position.xyz);//vec3(0.0, 1.0, 0.0);\n#else // ifdef WALL\n\n  float leftLen = length(left);\n  left = (leftLen > 0.001) ? left/leftLen : ZEROVEC;\n\n  float rightLen = length(right);\n  right = (rightLen > 0.001) ? right/rightLen : ZEROVEC;\n\n  // determine if vertex is on the "outside or "inside" of the join\n  bool isOutside = ISOUTSIDE;\n\n  // compute miter join position first\n  float displacementLen = lineWidth;\n  VECTYPE displacementDir = normalize(left + right);\n  displacementDir = PERPENDICULAR(displacementDir);\n  if (leftLen > 0.001 && rightLen > 0.001) {\n    float nDotSeg = dot(displacementDir, left);\n    displacementLen /= length(nDotSeg*left - displacementDir);\n\n    // limit displacement of inner vertices\n    if (!isOutside) {\n      displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));\n    }\n  }\n\n  if (isOutside && (displacementLen > miterLimit*lineWidth)) {\n    // convert to bevel join if miterLimit is exceeded\n    if (leftLen < 0.001) {\n      displacementDir = right;\n    }\n    else if (rightLen < 0.001) {\n      displacementDir = left;\n    }\n    else {\n      displacementDir = (abs(uv0.y) - 1.1 < 0.0) ? left : right;\n    }\n    displacementDir = normalize(displacementDir);\n    displacementDir = PERPENDICULAR(displacementDir);\n    displacementLen = lineWidth;\n  }\n\n#endif // ifdef WALL\n\n#ifdef SCREENSCALE\n  pos.xy += displacementDir * floor(uv0.y + 0.5) * displacementLen;\n  pos.xy /= screenSize;\n#else\n  pos.xyz += displacementDir * floor(uv0.y + 0.5) * displacementLen;\n  pos = proj * view * model * pos;\n#endif\n\n  vtc = uv0;\n  vColor = color * 0.003921568627451; // = 1/255\n  gl_Position = pos;\n\n#ifdef SCREENSCALE\n  }\n#endif\n}\n'}},misc:{"blendLayers.frag":"#include <util/fsPrecision.glsl>\n\nvarying vec2 uv;\n\nuniform sampler2D tex;\nuniform float opacity;\n\nvoid main() {\n  vec4 color = texture2D(tex, uv);\n\n  // Note: output in pre-multiplied alpha for correct alpha compositing\n  gl_FragColor = vec4(color.xyz, 1.0) * color.a * opacity;\n}\n","blendLayers.vert":"#include <util/vsPrecision.glsl>\n\nattribute vec3 position;\nattribute vec2 uv0;\n\nuniform float scale;\nuniform vec2 offset;\n\nvarying vec2 uv;\n\nvoid main(void) {\n  gl_Position = vec4(position, 1.0);\n  uv = uv0 * scale + offset;;\n}\n","showDepth.frag":"#include <util/fsPrecision.glsl>\n#include <util/encoding.glsl>\n\nuniform sampler2D depthTex;\nvarying vec2 vtc;\n\nvoid main() {\n// gl_FragColor = vec4(vec3(texture2D(depthTex, vtc).a), 1.0);\n   gl_FragColor = vec4(rgba2float(texture2D(depthTex, vtc)));\n// gl_FragColor = texture2D(depthTex, vtc);\n}\n","showDepth.vert":"#include <util/vsPrecision.glsl>\n\nuniform mat4 proj;\nattribute vec2 position;\nattribute vec2 uv0;\nvarying vec2 vtc;\n\nvoid main(void) {\n  gl_Position = proj * vec4(position.x, position.y, .0, 1.0);\n  vtc = uv0;\n}\n","simple.frag":"#include <util/fsPrecision.glsl>\n\nuniform vec4 color;\n\nvoid main() {\n  gl_FragColor = color;\n}\n","simple.vert":"#include <util/vsPrecision.glsl>\n\nuniform mat4 proj;\nuniform mat4 view;\nuniform mat4 model;\n\nattribute vec3 position;\n\nvoid main(void) {\n  gl_Position = proj * view * vec4((model * vec4(position, 1.0)).xyz, 1.0);\n}\n","texOnly.frag":"#include <util/fsPrecision.glsl>\n\nuniform sampler2D tex;\nuniform vec4 color;\nvarying vec2 vtc;\n\nvoid main() {\n  vec4 texColor = texture2D(tex, vtc);\n  gl_FragColor = texColor * color;\n}\n","texOnly.vert":"#include <util/vsPrecision.glsl>\n\nuniform mat4 proj;\nuniform mat4 view;\nuniform mat4 model;\n\nattribute vec3 position;\nattribute vec2 uv0;\n\nvarying vec2 vtc;\n\nvoid main(void) {\n  gl_Position = proj * view * vec4((model * vec4(position, 1.0)).xyz, 1.0);\n  vtc = uv0;\n}\n"},pointRenderer:{"pointRenderer.frag":"#include <util/fsPrecision.glsl>\n#include <util/encoding.glsl>\n\n#ifdef DEPTH_PASS\nvarying float depth;\n#else\nvarying vec3 vColor;\n#endif\n\nvoid main(void) {\n  vec2 vOffset = gl_PointCoord - vec2(0.5, 0.5);\n  float r2 = dot(vOffset, vOffset);\n\n  if (r2 > 0.25) {\n    discard;\n  }\n\n#ifdef DEPTH_PASS\n  gl_FragColor = float2rgba(depth);\n#else\n  gl_FragColor = vec4(vColor, 1.0);\n#endif\n}\n","pointRenderer.vert":"#include <util/slice.glsl>\n#include <util/vsPrecision.glsl>\n\nattribute vec3 aPosition;\nattribute vec3 aColor;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\nuniform vec2 uScreenMinMaxSize;\nuniform vec2 uPointScale;\nuniform vec3 uClipMin;\nuniform vec3 uClipMax;\n\n#ifdef DEPTH_PASS\nuniform vec2 nearFar;\n\nvarying float depth;\n#else\nvarying vec3 vColor;\n#endif\n\nvoid main(void) {\n\n  // Move clipped points outside of clipspace\n  if (aPosition.x < uClipMin.x || aPosition.y < uClipMin.y || aPosition.z < uClipMin.z ||\n      aPosition.x > uClipMax.x || aPosition.y > uClipMax.y || aPosition.z > uClipMax.z) {\n    gl_Position = vec4(0.0,0.0,0.0,2.0);\n    gl_PointSize = 0.0;\n    return;\n  }\n\n  if (rejectBySlice(aPosition)) {\n    gl_Position = vec4(0.0,0.0,0.0,2.0);\n    gl_PointSize = 0.0;\n    return;\n  }\n\n  // Position in camera space\n  vec4 camera = uModelViewMatrix * vec4(aPosition, 1.0);\n\n  float pointSize = uPointScale.x;\n  vec4 position = uProjectionMatrix * camera;\n\n  // Calculate Size\n#ifdef DRAW_SCREEN_SIZE\n    float clampedScreenSize = pointSize;\n#else\n    float pointRadius = 0.5 * pointSize;\n    vec4 cameraOffset = camera + vec4(0.0, pointRadius, 0.0, 0.0);\n    vec4 positionOffset = uProjectionMatrix * cameraOffset;\n    float radius = abs(positionOffset.y - position.y);\n\n    float viewHeight = uPointScale.y;\n\n    // screen diameter = (2 * r / w) * (h / 2)\n    float screenPointSize = (radius / position.w) * viewHeight;\n    float clampedScreenSize = clamp(screenPointSize, uScreenMinMaxSize.x, uScreenMinMaxSize.y);\n\n    // Shift towards camera, to move rendered point out of terrain i.e. to\n    // the camera-facing end of the virtual point when considering it as a\n    // 3D sphere.\n    camera.xyz -= normalize(camera.xyz) * pointRadius * clampedScreenSize / screenPointSize;\n    position = uProjectionMatrix * camera;\n#endif\n\n  gl_PointSize = clampedScreenSize;\n  gl_Position = position;\n\n#ifdef DEPTH_PASS\n  depth = (-camera.z - nearFar[0]) / (nearFar[1] - nearFar[0]);\n#else\n  vColor = aColor;\n#endif\n}\n"},renderer:{highlight:{"apply.frag":"#include <util/fsPrecision.glsl>\n\n// ===============================================================================\n// Merging blurred outlines with source image, advanced version\n\n// Defines:\n// GRID_OPTIMIZATION (set or !set)\n// GRID_DEBUG (set or !set)\n// ===============================================================================\n\nuniform sampler2D tex;\nuniform sampler2D origin;\n\nuniform vec4 color;\nuniform float outlineSize;\nuniform float blurSize;\nuniform vec4 opacities; // [outline, outlineOccluded, fill, fillOccluded]\n\nvarying vec2 uv;\n\nvoid main() {\n  #if defined(GRID_OPTIMIZATION) && defined(GRID_DEBUG)\n    gl_FragColor = vec4(uv, 0, 1.0);\n  #else\n    // Read the highlight intensity from the blurred highlight image\n    vec4 blurredHighlightValue = texture2D(tex, uv);\n    float highlightIntensity = blurredHighlightValue.a;\n\n    // Discard all pixels which are not affected by highlight\n    if (highlightIntensity == 0.0) {\n      discard;\n    }\n\n    vec4 origin_color = texture2D(origin, uv);\n\n    float outlineIntensity;\n    float fillIntensity;\n\n    // if occluded\n    if (blurredHighlightValue.g > blurredHighlightValue.b) {\n      outlineIntensity = color.w * opacities[1];\n      fillIntensity = color.w * opacities[3];\n    }\n    // if unoccluded\n    else {\n      outlineIntensity = color.w * opacities[0];\n      fillIntensity = color.w * opacities[2];\n    }\n\n    float inner = 1.0 - outlineSize / 9.0;\n    float outer = 1.0 - (outlineSize + blurSize) / 9.0;\n\n    float outlineFactor = smoothstep(outer, inner, highlightIntensity);\n    //float fillFactor = smoothstep(0.6, 0.72, highlightIntensity);\n    float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;\n    float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;\n\n    // Blending equation: gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n    // I.e., color should not be premultiplied with alpha\n    gl_FragColor = vec4(color.xyz, intensity);\n  #endif\n}\n","apply.vert":"#include <util/vsPrecision.glsl>\n\nattribute vec2 position;\nvarying vec2 uv;\n\n#ifdef GRID_OPTIMIZATION\n  attribute vec2 uv0;\n  uniform sampler2D coverageTex;\n#endif\n\nvoid main() {\n  #ifdef GRID_OPTIMIZATION\n    #ifdef GRID_DEBUG\n      vec4 cov = texture2D(coverageTex, uv0);\n      // if no highlight pixel set in this block,\n      // or all pixels set, hide block\n      if (cov.r == 0.0 || cov.g == 1.0 || cov.b == 1.0) {\n        gl_Position = vec4(0,0,0,0);\n        return;\n      }\n      gl_Position = vec4(position, .0, 1.0);\n      uv = uv0;\n      return;\n    #else\n      vec4 cov = texture2D(coverageTex, uv0);\n      // if no highlight pixel set in this block, hide block\n      if (cov.r == 0.0) {\n        gl_Position = vec4(0,0,0,0);\n        return;\n      }\n    #endif\n  #endif\n\n  gl_Position = vec4(position, .0, 1.0);\n  uv = position.xy * .5 + vec2(.5);\n}\n","blur.frag":"#include <util/fsPrecision.glsl>\n\n// ===============================================================================\n// Gaussian blur with linear sampling. Supports different number of samples, but\n// only 5 samples have proper weights. Uses linear texture interpolation to reduce\n// the number of samples taken.\n\n// Defines:\n// GRID_OPTIMIZATION (set or !set)\n// GAUSSIAN_SAMPLES (3,5,7)\n\n// This technique requires linear filtering on source texture\n// http://rastergrid.com/blog/2010/09/efficient-gaussian-blur-with-linear-sampling/\n// ===============================================================================\n\nuniform sampler2D tex;\n\n#ifdef GRID_OPTIMIZATION\n  uniform vec2 blurSize;\n  varying vec3 blurCoordinate;\n#else\n  varying vec2 blurCoordinates[GAUSSIAN_SAMPLES];\n#endif\n\nvoid main() {\n  #ifdef GRID_OPTIMIZATION\n    vec2 uv = blurCoordinate.xy;\n    vec4 center = texture2D(tex, uv);\n\n    // do not blur if no pixel or all pixels in neighborhood are set\n    if (blurCoordinate.z == 1.0) {\n      gl_FragColor = center;\n    }\n    else {\n      vec4 sum = vec4(0.0);\n\n      #if GAUSSIAN_SAMPLES == 3\n        // not proper gaussian weights\n        sum += center * 0.204164;\n        sum += texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\n        sum += texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\n      #elif GAUSSIAN_SAMPLES == 5\n        sum += center * 0.204164;\n        sum += texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\n        sum += texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\n        sum += texture2D(tex, uv + blurSize * 3.294215) * 0.093913;\n        sum += texture2D(tex, uv - blurSize * 3.294215) * 0.093913;\n      #elif GAUSSIAN_SAMPLES == 7\n        // not proper gaussian weights\n        sum += center * 0.204164;\n        sum += texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\n        sum += texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\n        sum += texture2D(tex, uv + blurSize * 3.294215) * 0.093913;\n        sum += texture2D(tex, uv - blurSize * 3.294215) * 0.093913;\n        sum += texture2D(tex, uv + blurSize * 5.1) * 0.03;\n        sum += texture2D(tex, uv - blurSize * 5.1) * 0.03;\n      #elif GAUSSIAN_SAMPLES == 9\n        // not proper gaussian weights\n        sum += center * 0.154164;\n        sum += texture2D(tex, uv + blurSize * 1.5) * 0.204005;\n        sum += texture2D(tex, uv - blurSize * 1.5) * 0.204005;\n        sum += texture2D(tex, uv + blurSize * 3.5) * 0.123913;\n        sum += texture2D(tex, uv - blurSize * 3.5) * 0.123913;\n        sum += texture2D(tex, uv + blurSize * 5.5) * 0.123913;\n        sum += texture2D(tex, uv - blurSize * 5.5) * 0.123913;\n        sum += texture2D(tex, uv + blurSize * 7.5) * 0.05;\n        sum += texture2D(tex, uv - blurSize * 7.5) * 0.05;\n      #endif\n\n      gl_FragColor = sum;\n    }\n  #else\n    vec4 sum = vec4(0.0);\n\n    #if GAUSSIAN_SAMPLES == 3\n      // not proper gaussian weights\n      sum += texture2D(tex, blurCoordinates[0]) * 0.204164;\n      sum += texture2D(tex, blurCoordinates[1]) * 0.304005;\n      sum += texture2D(tex, blurCoordinates[2]) * 0.304005;\n    #elif GAUSSIAN_SAMPLES == 5\n      sum += texture2D(tex, blurCoordinates[0]) * 0.204164;\n      sum += texture2D(tex, blurCoordinates[1]) * 0.304005;\n      sum += texture2D(tex, blurCoordinates[2]) * 0.304005;\n      sum += texture2D(tex, blurCoordinates[3]) * 0.093913;\n      sum += texture2D(tex, blurCoordinates[4]) * 0.093913;\n    #elif GAUSSIAN_SAMPLES == 7\n      // not proper gaussian weights\n      sum += texture2D(tex, blurCoordinates[0]) * 0.204164;\n      sum += texture2D(tex, blurCoordinates[1]) * 0.304005;\n      sum += texture2D(tex, blurCoordinates[2]) * 0.304005;\n      sum += texture2D(tex, blurCoordinates[3]) * 0.093913;\n      sum += texture2D(tex, blurCoordinates[4]) * 0.093913;\n      sum += texture2D(tex, blurCoordinates[5]) * 0.03;\n      sum += texture2D(tex, blurCoordinates[6]) * 0.03;\n    #elif GAUSSIAN_SAMPLES == 9\n      // not proper gaussian weights\n      sum += texture2D(tex, blurCoordinates[0]) * 0.154164;\n      sum += texture2D(tex, blurCoordinates[1]) * 0.204005;\n      sum += texture2D(tex, blurCoordinates[2]) * 0.204005;\n      sum += texture2D(tex, blurCoordinates[3]) * 0.123913;\n      sum += texture2D(tex, blurCoordinates[4]) * 0.123913;\n      sum += texture2D(tex, blurCoordinates[5]) * 0.09;\n      sum += texture2D(tex, blurCoordinates[6]) * 0.09;\n      sum += texture2D(tex, blurCoordinates[7]) * 0.05;\n      sum += texture2D(tex, blurCoordinates[8]) * 0.05;\n    #endif\n\n    gl_FragColor = sum;\n  #endif\n}\n","blur.vert":"#include <util/vsPrecision.glsl>\n\nattribute vec2 position;\nattribute vec2 uv0;\n\n#ifdef GRID_OPTIMIZATION\n  uniform sampler2D coverageTex;\n  varying vec3 blurCoordinate;\n#else\n  uniform vec2 blurSize;\n  varying vec2 blurCoordinates[GAUSSIAN_SAMPLES];\n#endif\n\nvoid main() {\n  gl_Position = vec4(position, 0.0, 1.0);\n\n  #ifdef GRID_OPTIMIZATION\n    // sample the coverage texture at the block center\n    // and if no coverage detected, create degenerate triangle\n    vec4 cov = texture2D(coverageTex, uv0);\n    if (cov.r == 0.0) {\n      gl_Position = vec4(0,0,0,0);\n    }\n\n    // create texture coordinate for blur center\n    // encode information about fully inside block in z coordinate\n    blurCoordinate = vec3(gl_Position.xy * .5 + vec2(.5), max(cov.g, cov.b));\n  #else\n    vec2 uv = position.xy * .5 + vec2(.5);\n\n    #if GAUSSIAN_SAMPLES == 3\n      // not proper gaussian weights\n      blurCoordinates[0] = uv;\n      blurCoordinates[1] = uv + blurSize * 1.407333;\n      blurCoordinates[2] = uv - blurSize * 1.407333;\n    #elif GAUSSIAN_SAMPLES == 5\n      blurCoordinates[0] = uv;\n      blurCoordinates[1] = uv + blurSize * 1.407333;\n      blurCoordinates[2] = uv - blurSize * 1.407333;\n      blurCoordinates[3] = uv + blurSize * 3.294215;\n      blurCoordinates[4] = uv - blurSize * 3.294215;\n    #elif GAUSSIAN_SAMPLES == 7\n      // not proper gaussian weights\n      blurCoordinates[0] = uv;\n      blurCoordinates[1] = uv + blurSize * 1.407333;\n      blurCoordinates[2] = uv - blurSize * 1.407333;\n      blurCoordinates[3] = uv + blurSize * 3.294215;\n      blurCoordinates[4] = uv - blurSize * 3.294215;\n      blurCoordinates[5] = uv + blurSize * 5.1;\n      blurCoordinates[6] = uv - blurSize * 5.1;\n    #elif GAUSSIAN_SAMPLES == 9\n      // not proper gaussian weights\n      blurCoordinates[0] = uv;\n      blurCoordinates[1] = uv + blurSize * 1.407333;\n      blurCoordinates[2] = uv - blurSize * 1.407333;\n      blurCoordinates[3] = uv + blurSize * 3.294215;\n      blurCoordinates[4] = uv - blurSize * 3.294215;\n      blurCoordinates[5] = uv + blurSize * 5.1;\n      blurCoordinates[6] = uv - blurSize * 5.1;\n      blurCoordinates[7] = uv + blurSize * 7.1;\n      blurCoordinates[8] = uv - blurSize * 7.1;\n    #endif\n  #endif\n}\n","downsample.frag":"#include <util/fsPrecision.glsl>\n\n// ===============================================================================\n// Smartly downsamples a texture, halfing its resolution. This allows for a square\n// screen region to check if none, any or all pixels were set.\n\n// The red channel is always ceiled after interpolating the 4 merged pixels.\n// This allows to evaluate:\n// any(pixels.red != 0.0) as red == 1.0\n// none(pixels.red != 0.0) as red == 0.0\n\n// The green and blue channels are set to floor(max(green, blue)).\n// This allows to evaluate:\n// all(pixels.green || pixels.blue) as green == 1.0\n// ===============================================================================\n\nuniform sampler2D tex;\nuniform vec2 invFramebufferDim;\n\nvoid main() {\n  vec2 coord = gl_FragCoord.xy * invFramebufferDim;\n  vec4 value = texture2D(tex, coord);\n  float mx = floor(max(value.g, value.b));\n  gl_FragColor = vec4(ceil(value.r), mx, mx, 1.0);\n}\n","downsample.vert":"#include <util/vsPrecision.glsl>\n\nattribute vec2 position;\n\nvoid main() {\n  gl_Position = vec4(vec2(1.0) - position * 2.0, .0, 1.0);\n}\n"},laserLine:{"laserLine.frag":"#include <util/enableExtensions.glsl>\n#include <util/fsPrecision.glsl>\n#include <util/encoding.glsl>\n\n//--------------------------------------------------------------------------\n// Uniforms\n//--------------------------------------------------------------------------\n\nuniform sampler2D depthMap;\n\nuniform vec2 nearFar;\nuniform vec4 projInfo;\nuniform vec2 zScale;\nuniform float maxPixelDistance;\n\n// focus plane in camera space\nuniform vec4 focusPlane;\n\n// focus sphere in camera space\nuniform vec4 focusSphere;\n\n// segment plane in camera space\nuniform vec4 segmentPlane;\n\n// line segment\nuniform vec3 segmentStart;\nuniform vec3 segmentEnd;\n\n// styling\nuniform vec3 glowColor;\nuniform float glowWidth;\nuniform vec3 innerColor;\nuniform float innerWidth;\nuniform float globalAlpha;\n\n//--------------------------------------------------------------------------\n// Inputs\n//--------------------------------------------------------------------------\n\nvarying vec2 uv;\n\n//--------------------------------------------------------------------------\n// Defines\n//--------------------------------------------------------------------------\n\n#define INFINITY 100000.0\n\n\n\n// reconstruct depth value from linear depth map\nfloat linearDepth(vec2 uv) {\n  return -(rgba2float(texture2D(depthMap, uv)) * (nearFar[1] - nearFar[0]) + nearFar[0]);\n}\n\n// reconstruct position in view space\nvec3 reconstructPosition(vec2 fragCoord, float depth) {\n  return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);\n}\n\nfloat planeDistancePixels(vec4 plane, vec3 pos) {\n  // compute distance to plane\n  float dist = dot(plane.xyz, pos) + plane.w;\n  // compute derivative of distance function with respect to pixels\n  float width = fwidth(dist);\n  // normalize distance by the derivative to get a measurement with respect to pixels\n  // the clamping is used to prevent excessive artifacts along depth discontinuities\n  dist /= min(width, maxPixelDistance);\n  return abs(dist);\n}\n\nfloat sphereDistancePixels(vec4 sphere, vec3 pos) {\n  // compute distance to sphere\n  float dist = distance(sphere.xyz, pos) - sphere.w;\n  // compute derivative of distance function with respect to pixels\n  float width = fwidth(dist);\n  // normalize distance by the derivative to get a measurement with respect to pixels\n  // the clamping is used to prevent excessive artifacts along depth discontinuities\n  dist /= min(width, maxPixelDistance);\n  return abs(dist);\n}\n\nvec4 blendPremultiplied(vec4 source, vec4 dest) {\n  float oneMinusSourceAlpha = 1.0 - source.a;\n\n  return vec4(\n    source.rgb + dest.rgb * oneMinusSourceAlpha,\n    source.a + dest.a * oneMinusSourceAlpha\n  );\n}\n\nvec4 premultipliedColor(vec3 rgb, float alpha) {\n  return vec4(rgb * alpha, alpha);\n}\n\n// computes laser line color based on distance in pixels\nvec4 laserLineProfile(float dist) {\n  if (dist > glowWidth) {\n    return vec4(0.0);\n  }\n\n  float innerAlpha = (1.0 - smoothstep(0.0, innerWidth, dist));\n  float glowAlpha = pow(max(0.0, 1.0 - dist / glowWidth), 8.0);\n\n  return blendPremultiplied(\n    premultipliedColor(innerColor, innerAlpha),\n    premultipliedColor(glowColor, glowAlpha)\n  );\n}\n\nvoid main() {\n  // do not draw laserline on background\n  float depth = linearDepth(uv);\n  if (-depth == nearFar[0]) {\n    discard;\n  }\n\n  // reconstruct position in view space\n  vec3 pos = reconstructPosition(gl_FragCoord.xy, depth);\n\n  // empirical hack to fade out laser line in problematic areas:\n  // the derivatives to normalize the distance function are valid inside smooth surfaces,\n  // but break down at depth discontinuities (e.g. edges). We fade out the laser lines in\n  // areas where depth valus have large variations in order to avoid this problem.\n  float ddepth = fwidth(depth);\n  float depthDiscontinuityAlpha = 1.0 - smoothstep(0.0, 0.01, -ddepth / depth);\n\n  // reconstruct normal using derivatives\n  vec3 normal = normalize(cross(dFdx(pos), dFdy(pos)));\n\n  // distance to focus plane\n  float focusPlaneDistance = planeDistancePixels(focusPlane, pos);\n\n  // distance to focus sphere\n  float focusSphereDistance = sphereDistancePixels(focusSphere, pos);\n\n  // distance to segment plane\n  float segmentDistance = INFINITY;\n  float segmentLength = length(segmentEnd - segmentStart);\n  vec3 segmentDir = (segmentEnd - segmentStart) / segmentLength;\n  float t = dot(segmentDir, pos - segmentStart);\n\n  if (segmentLength > 0.0 && t >= 0.0 && t <= segmentLength) {\n    segmentDistance = planeDistancePixels(segmentPlane, pos);\n  }\n\n  // evaluate color profile for both planes and the sphere\n  vec4 focusPlaneColor = laserLineProfile(focusPlaneDistance);\n  vec4 focusSphereColor = laserLineProfile(focusSphereDistance);\n  vec4 segmentColor = laserLineProfile(segmentDistance);\n\n  // empirical hack to fade out laser line when planes are nearly parallel\n  float focusPlaneAlpha = 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, focusPlane.xyz)));\n  float focusSphereAlpha = 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, normalize(pos - focusSphere.xyz))));\n  float segmentAlpha = 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, segmentPlane.xyz)));\n\n  // combine colors\n  vec4 color = max(\n    focusPlaneColor * focusPlaneAlpha,\n    max(\n      focusSphereColor * focusSphereAlpha,\n      segmentColor * segmentAlpha\n    )\n  );\n\n  gl_FragColor = color * globalAlpha * depthDiscontinuityAlpha;\n}\n"},occluded:{"combine.frag":"#include <util/fsPrecision.glsl>\n\nuniform sampler2D occludedColorMap;\n\nvarying vec2 uv;\n\nvoid main() {\n  vec4 occludedColor = texture2D(occludedColorMap, uv);\n  gl_FragColor = occludedColor * vec4(1.0, 1.0, 1.0, 0.4);\n}\n"},offscreen:{"offscreen.frag":"#include <util/fsPrecision.glsl>\n\nuniform sampler2D tex;\n\nvarying vec2 vtc;\n\nvoid main() {\n  gl_FragColor = texture2D(tex, vtc);\n}\n","offscreen.vert":"#include <util/vsPrecision.glsl>\n\nattribute vec2 position;\nvarying vec2 vtc;\n\nvoid main(void) {\n  gl_Position = vec4(position.xy, 0.0, 1.0);\n  vtc = position.xy * 0.5 + 0.5;\n}\n","transparentToHUDVisibility.frag":"#include <util/fsPrecision.glsl>\n\nuniform sampler2D tex;\n\nvarying vec2 vtc;\n\nvoid main() {\n  gl_FragColor = vec4(1.0 - texture2D(tex, vtc).a);\n}\n"},ssao:{"blur.frag":"#include <util/fsPrecision.glsl>\n#include <renderer/ssao/common.glsl>\n\n#ifndef RADIUS\n#define RADIUS 4\n#endif\n\nuniform sampler2D normalMap;\nuniform sampler2D depthMap;\nuniform sampler2D tex;\n\nuniform vec2 blurSize;\n\nuniform float g_BlurFalloff;\nuniform float projScale;\n\nuniform vec2    nearFar;\n//set z scaling, used to prevent division in ortho mode\nuniform vec2 zScale;\n\nvarying vec2 uv;\n\nfloat BlurFunction(vec2 uv, float r, float center_d, inout float w_total, float sharpness) {\n  float c = texture2D(tex, uv).r;\n  float d = getDepthLinear(depthMap, nearFar, uv);\n\n  float ddiff = d - center_d;\n\n  float w = exp(-r*r*g_BlurFalloff - ddiff*ddiff*sharpness);\n\n  w_total += w;\n\n  return w*c;\n}\n\nvoid main(void) {\n  float b = 0.0;\n  float w_total = 0.0;\n\n  float center_d =  getDepthLinear(depthMap, nearFar, uv);\n\n  float sharpness = -0.05*projScale/(center_d*zScale.x+zScale.y);\n  for (int r = -RADIUS; r <= RADIUS; ++r) {\n    float rf = float(r);\n    vec2 uvOffset = uv + rf*blurSize;\n    b += BlurFunction(uvOffset, rf, center_d, w_total, sharpness);\n  }\n\n  gl_FragColor = vec4(b/w_total);\n}\n","common.glsl":"#include <util/encoding.glsl>\n\nfloat getDepthLinear(sampler2D depthMap, vec2 nearFar, vec2 ssC) {\n  return -(rgba2float(texture2D(depthMap, ssC))*(nearFar[1] - nearFar[0])+nearFar[0]);\n}\n","ssao.frag":"#include <util/fsPrecision.glsl>\n#include <renderer/ssao/common.glsl>\n\n#ifndef SAMPLES\n#define SAMPLES 4\n#endif\n\nuniform mat4 projMatrixInv;\n\nuniform sampler2D normalMap;\nuniform sampler2D depthMap;\n\nuniform float intensity;\n\nuniform float projScale;\nuniform float radius;\nuniform vec2 nearFar;\nuniform vec4 projInfo;\nuniform vec2 screenDimensions;\n\n//noise texture lookup could be replaced with hash function if WebGL gets XOR functionality\nuniform vec3 pSphere[SAMPLES]; //tap position\nuniform vec2 rnmScale;\nuniform sampler2D rnm; //noise texture\n\n//set z scaling, used to prevent division in ortho mode\nuniform vec2 zScale;\n\nvarying vec2  uv;\nvarying vec4  camPos;\n\nfloat fallOffFunction(float vv, float vn, float bias) {\n  float radius2 = radius * radius;\n\n  // A: From the HPG12 paper\n  // Note large epsilon to avoid overdarkening within cracks\n  // return float(vv < radius2) * max((vn - bias) / (epsilon + vv), 0.0) * radius2 * 0.6;\n\n  // B: Smoother transition to zero (lowers contrast, smoothing out corners). [Recommended]\n  float f = max(radius2 - vv, 0.0); return f * f * f * max(vn-bias, 0.0);\n\n  // C: Medium contrast (which looks better at high radii), no division.  Note that the\n  // contribution still falls off with radius^2, but we've adjusted the rate in a way that is\n  // more computationally efficient and happens to be aesthetically pleasing.\n  // return 4.0 * max(1.0 - vv * invRadius2, 0.0) * max(vn - bias, 0.0);\n\n  // D: Low contrast, no division operation\n  // return 2.0 * float(vv < radius * radius) * max(vn - bias, 0.0);\n}\n\n\n/** Compute the occlusion due to sample point \\a Q about camera-space point \\a C with unit normal \\a n_C */\nfloat aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {\n  vec3 v = Q - C;\n  float vv = dot(v, v);\n  float vn = dot(normalize(v), n_C);\n  return fallOffFunction(vv, vn, 0.1);\n}\n\n\n/**\n * Reconstruct camera-space P.xyz from screen-space S = (x, y) in\n * pixels and camera-space z < 0.  Assumes that the upper-left pixel center\n * is at (0.5, 0.5) [but that need not be the location at which the sample tap\n * was placed!]\n *\n * Costs 3 MADD.  Error is on the order of 10^3 at the far plane, partly due to z precision.\n */\nvec3 reconstructCSPosition(vec2 S, float z) {\n  return vec3(( (S.xy) * projInfo.xy + projInfo.zw)*(z*zScale.x+zScale.y), z);\n}\n\nvoid main(void) {\n  //Hash function used in the HPG12 AlchemyAO paper\n  //Not supported in WebGL -> using texture lookup as in old SSAO shader instead\n  //ivec2 ssC = ivec2(gl_FragCoord.xy);\n  //float randomPatternRotationAngle = float((3 * ssC.x ^ ssC.y + ssC.x * ssC.y) * 10);\n  vec3 fres = normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));\n\n  float currentPixelDepth = getDepthLinear(depthMap, nearFar, uv);\n\n  if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {\n    gl_FragColor = vec4(0);\n    return;\n  }\n\n  vec3 currentPixelPos = reconstructCSPosition(gl_FragCoord.xy,currentPixelDepth);\n\n  // get the normal of current fragment\n  vec4 norm4 = texture2D(normalMap, uv);\n  vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;\n  bool isTerrain = norm4.w<0.5;\n\n  float sum = .0;\n\n  vec4 occluderFragment;\n  vec3 ray;\n\n  vec3 tapPixelPos;\n\n  // note: the factor 2.0 should not be necessary, but makes ssao much nicer.\n  // bug or deviation from CE somewhere else?\n  float ps = projScale/(2.0*currentPixelPos.z*zScale.x+zScale.y);\n\n  for(int i = 0; i < SAMPLES; ++i) {\n    // get a vector (randomized inside of a sphere with radius 1.0) from a texture and reflect it\n    //float ssR;\n    //vec2 unitOffset = tapLocation(i, randomPatternRotationAngle, ssR);\n    // get the depth of the occluder fragment\n    //vec2 offset = vec2(-unitOffset*radius*ssR*ps);\n\n    vec2 unitOffset = reflect(pSphere[i], fres).xy;\n    vec2 offset = vec2(-unitOffset*radius*ps);\n\n    //don't use current or very nearby samples\n    if ( abs(offset.x)<2.0 || abs(offset.y)<2.0) continue;\n\n    vec2 tc = vec2(gl_FragCoord.xy + offset);\n    if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenDimensions.x || tc.y > screenDimensions.y) continue;\n    vec2 tcTap = tc/screenDimensions;\n    float occluderFragmentDepth = getDepthLinear(depthMap, nearFar, tcTap);\n\n    if (isTerrain) {\n      bool isTerrainTap = texture2D(normalMap, tcTap).w<0.5;\n      if (isTerrainTap) {\n        continue;\n      }\n    }\n\n    tapPixelPos = reconstructCSPosition(tc, occluderFragmentDepth);\n\n    sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);\n  }\n\n  // output the result\n\n  float A = max(1.0-sum*intensity/float(SAMPLES),0.0);\n\n  // Anti-tone map to reduce contrast and drag dark region farther\n  // (x^0.2 + 1.2 * x^4)/2.2\n  A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;\n\n  //gl_FragColor = vec4(norm/2.0+0.5, 1.0);\n  //gl_FragColor = vec4(-currentPixelDepth/1000.0);\n  //gl_FragColor = vec4(tapPixelPos.x/100.0);\n  gl_FragColor = vec4(A);\n}\n"}},terrainRenderer:{"colorPass.frag":"#include <util/enableExtensions.glsl>\n#include <util/fsPrecision.glsl>\n#include <util/sceneLighting.glsl>\n#include <util/screenSizePerspective.glsl>\n#include <util/shadow.glsl>\n#include <terrainRenderer/overlay.glsl>\n\nuniform vec3 lightDirection;\nuniform vec3 viewDirection;\nuniform sampler2D depthTex;\nuniform int shadowMapNum;\nuniform vec4 shadowMapDistance;\nuniform mat4 shadowMapMatrix[4];\nuniform float depthHalfPixelSz;\nuniform sampler2D ssaoTex;\nuniform vec4 viewportPixelSz;\nuniform sampler2D tex;\nuniform float opacity;\n\n#if defined(WIREFRAME_TEXTURE) || defined(TILE_BORDERS)\nstruct WireframeSettings {\n  float width;\n  float falloff;\n  float subdivision;\n  vec4 color;\n  float wireOpacity;\n  float surfaceOpacity;\n};\n\nuniform WireframeSettings wireframe;\n#endif\n\nvarying vec3 vnormal;\nvarying vec3 vpos;\nvarying vec2 vtc;\n\n#if defined(WIREFRAME_TEXTURE) || defined(TILE_BORDERS)\nvarying vec2 vuv;\n#endif\n\n#ifdef ATMOSPHERE\nvarying vec3 wpos;\nvarying vec3 wview;\nvarying vec3 wnormal;\nvarying vec3 wlight;\n#endif\n\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\nuniform vec4 screenSizePerspective;\n\nvarying float screenSizeDistanceToCamera;\nvarying float screenSizeCosAngle;\n#endif\n\nconst vec3 ambient = vec3(0.2,0.2,0.2);\nconst vec3 diffuse = vec3(0.8,0.8,0.8);\nconst float diffuseHardness = 2.5;\n\n#ifdef OVERLAY\nuniform sampler2D overlay0Tex;\nuniform sampler2D overlay1Tex;\nuniform float overlayOpacity;\nvarying vec4 vtcOverlay;\n#endif\n\n#ifdef RECEIVE_SHADOWS\nvarying float linearDepth;\n#endif\n\nfloat lum(vec3 c) {\n  float max = max(max(c.r, c.g), c.b);\n  float min = min(min(c.r, c.g), c.b);\n  return (min + max) * 0.5;\n}\n\n#ifdef ATMOSPHERE\nvec3 atmosphere(vec3 lightPos, vec3 normal, vec3 view) {\n  vec3 surfaceColor   = vec3(0.0);\n  vec3 fuzzySpecColor = vec3(1.0);\n  vec3 subColor       = vec3(0.0);\n  float rollOff       = 1.0;\n\n  vec3 Ln = normalize(lightPos);\n  vec3 Nn = normalize(normal);\n  vec3 Hn = normalize(view + Ln);\n\n  float ldn = dot(Ln, Nn);\n  float diffComp = max(0.0, ldn);\n  float vdn = 1.0 - dot(view, Nn);\n  float ndv = dot(view, Ln);\n\n  vec3 diffContrib = surfaceColor * diffComp;\n  float subLamb = max(0.0, smoothstep(-rollOff, 1.0, ldn) - smoothstep(0.0, 1.0, ldn));\n\n  vec3 subContrib = subLamb * subColor;\n  vec3 vecColor = vec3(vdn);\n\n  vec3 diffuseContrib = (subContrib + diffContrib);\n  vec3 specularContrib = (vecColor * fuzzySpecColor);\n\n  return (diffContrib + specularContrib) * rollOff;\n}\n#endif\n\nvoid main() {\n  vec3 a = ambient;\n\n  float shadow = 0.0;\n#ifdef RECEIVE_SHADOWS\n  shadow = evalShadow(vpos, linearDepth, depthTex, shadowMapNum, shadowMapDistance, shadowMapMatrix, depthHalfPixelSz);\n#endif\n  float vndl = dot(normalize(vnormal), lightDirection);\n  float k = smoothstep(0.0, 1.0, clamp(vndl*diffuseHardness, 0.0, 1.0));\n  vec3 d = (1.0 - shadow/1.8) * diffuse * k;\n\n  float ssao = viewportPixelSz.w < .0 ? 1.0 : texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n  vec4 tileColor = texture2D(tex, vtc) * opacity;\n\n#ifdef OVERLAY\n  vec4 overlayColor = getOverlayColor(overlay0Tex, overlay1Tex, vtcOverlay, overlayOpacity);\n\n  // tileColor and overlayTexCols have pre-multiplied alpha\n  tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;\n#endif\n\n  vec3 atm = vec3(0.0);\n#ifdef ATMOSPHERE\n  float ndotl = max(0.0, min(1.0, vndl));\n  atm = atmosphere(wlight, wnormal, -viewDirection);\n  atm *= max(0.0, min(1.0, (1.0-lum(tileColor.rgb)*1.5))); //avoid atmosphere on bright base maps\n  atm *= max(0.0, min(1.0, ndotl*2.0)); // avoid atmosphere on dark side of the globe\n  atm *= tileColor.a; // premultiply with tile alpha\n#endif\n\n  vec3 albedo = atm + tileColor.rgb;\n  vec3 normal = normalize(vnormal);\n\n  // heuristic shading function used in the old terrain, now used to add ambient lighting\n  float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));\n  vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n\n  gl_FragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);\n\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\n  // This is only used for debug rendering the screenSize perspective\n\n  float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, screenSizePerspective);\n\n  if (perspectiveScale <= 0.25) {\n    gl_FragColor = mix(gl_FragColor, vec4(1, 0, 0, 1), perspectiveScale * 4.0);\n  }\n  else if (perspectiveScale <= 0.5) {\n    gl_FragColor = mix(gl_FragColor, vec4(0, 0, 1, 1), (perspectiveScale - 0.25) * 4.0);\n  }\n  else if (perspectiveScale >= 0.99) {\n    gl_FragColor = mix(gl_FragColor, vec4(0, 1, 0, 1), 0.2);\n  }\n  else {\n    gl_FragColor = mix(gl_FragColor, vec4(1, 0, 1, 1), (perspectiveScale - 0.5) * 2.0);\n  }\n\n#endif\n\n#if defined(WIREFRAME_TEXTURE) || defined(TILE_BORDERS)\n\n  vec2 vuvScaled = vuv * wireframe.subdivision;\n  vec2 vuvMod = fract(vuvScaled);\n\n  vec2 dVuv = fwidth(vuvScaled);\n  dVuv = max(vec2(0.00001), dVuv); // workaround against flickering skirts, see #10245\n\n  vec2 edgeFactors = smoothstep((wireframe.width - wireframe.falloff) * dVuv,\n                                wireframe.width * dVuv, min(vuvMod, 1.0 - vuvMod));\n\n  float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);\n\n#ifdef WIREFRAME_TEXTURE\n  vec3 wireframeColor = mix(gl_FragColor.rgb, wireframe.color.rgb, edgeFactor * wireframe.color.a);\n  float wireframeAlpha = mix(wireframe.surfaceOpacity, wireframe.wireOpacity, edgeFactor);\n  gl_FragColor = vec4(wireframeColor * wireframeAlpha, wireframeAlpha * gl_FragColor.a);\n#endif\n\n\n#ifdef TILE_BORDERS\n  dVuv = fwidth(vuv);\n  edgeFactors = smoothstep((wireframe.width - wireframe.falloff) * dVuv,\n                            wireframe.width * dVuv, min(vuv, 1.0 - vuv));\n  edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);\n\n  gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);\n#endif\n\n#endif // defined(WIREFRAME_TEXTURE) || defined(TILE_BORDERS)\n}\n","colorPass.vert":"#include <util/vsPrecision.glsl>\n#include <terrainRenderer/skirts.glsl>\n\nuniform mat4 proj;\nuniform mat4 view;\nuniform vec3 origin;\nuniform vec4 texOffsetAndScale;\nuniform mat4 viewNormal;\nuniform float skirtScale;\n\nattribute vec3 position;\nattribute vec2 uv0;\n\nvarying vec3 vnormal;\nvarying vec3 vpos;\nvarying vec2 vtc;\n\n#ifdef RECEIVE_SHADOWS\nvarying float linearDepth;\n#endif\n\n#if defined(WIREFRAME_TEXTURE) || defined(TILE_BORDERS)\nvarying vec2 vuv;\n#endif\n\n#ifdef ATMOSPHERE\nuniform vec3 lightDirection;\nvarying vec3 wpos;\nvarying vec3 wview;\nvarying vec3 wnormal;\nvarying vec3 wlight;\n#endif\n\n#ifdef OVERLAY\n// these variables combine two possible overlays into one by using a vec4:\n// components x/y are x/y of overlay 0, and components z/w are x/y of overlay 1\nuniform vec4 overlayTexOffset;\nuniform vec4 overlayTexScale;\nvarying vec4 vtcOverlay;\n#endif\n\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\n\nuniform vec4 screenSizePerspective;\n\nvarying float screenSizeDistanceToCamera;\nvarying float screenSizeCosAngle;\n\n#endif\n\nvoid main(void) {\n  vpos = position;\n\n#ifdef SPHERICAL\n  vnormal = normalize(vpos + origin);\n#else\n  vnormal = vec3(0, 0, 1); // WARNING: up-axis dependent code\n#endif\n\nvec2 uv = uv0;\nvpos = applySkirts(uv, vpos, vnormal, skirtScale);\n\n#ifdef ATMOSPHERE\n  wpos = (view * vec4(vpos, 1.0)).xyz;\n  wnormal = (viewNormal * vec4(normalize(vpos+origin), 1.0)).xyz;\n  wlight = (view  * vec4(lightDirection, 1.0)).xyz;\n#endif\n\n#if defined(WIREFRAME_TEXTURE) || defined(TILE_BORDERS)\n  vuv = uv;\n#endif\n\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\n\n  vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;\n\n  screenSizeDistanceToCamera = length(viewPos);\n\n  vec3 viewSpaceNormal = (viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz;\n  screenSizeCosAngle = abs(viewSpaceNormal.z);\n\n#endif\n\n  gl_Position = proj * view * vec4(vpos, 1.0);\n\n#ifdef RECEIVE_SHADOWS\n  // Shadowmap's cascading index used to be based on '1.0 / gl_FragCoord.w'\n  // (i.e. the perspective interpolation of 'gl_Position.w'). Precision\n  // issues on iPad/iPhone with the 'w' component require the depth to be\n  // passed as varying to properly drive the cascading shadow map index.\n  linearDepth = gl_Position.w;\n#endif\n\n  vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;\n\n#ifdef OVERLAY\n  vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;\n#endif\n}\n","depthPass.frag":"#include <util/enableExtensions.glsl>\n#include <util/fsPrecision.glsl>\n#include <util/encoding.glsl>\n#include <util/depth.glsl>\n\nvarying float depth;\nvarying vec3 vpos;\n\nvoid main() {\n#ifndef BIAS_SHADOWMAP\n  gl_FragColor = float2rgba(depth);\n#else\n  gl_FragColor = float2rgba(calcFragDepth(depth));\n#endif\n}\n","depthPass.vert":"#include <util/vsPrecision.glsl>\n#include <terrainRenderer/skirts.glsl>\n\nuniform vec3 origin;\nuniform mat4 proj;\nuniform mat4 view;\nuniform vec2 nearFar;\nuniform float skirtScale;\n\nattribute vec3 position;\nattribute vec2 uv0;\n\nvarying float depth;\nvarying vec3 vpos;\n\nvoid main(void) {\n#ifdef SPHERICAL\n  vec3 normal = normalize(position + origin);\n#else\n  vec3 normal = vec3(0.0, 0.0, 1.0);\n#endif\n\n  vec2 uv = uv0;\n  vpos = applySkirts(uv, position, normal.xyz, skirtScale);\n\n  vec4 eye = view * vec4(vpos, 1.0);\n  gl_Position = proj * eye;\n  depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;\n}\n","highlightPass.frag":"#include <util/fsPrecision.glsl>\n#include <util/highlight.glsl>\n#include <terrainRenderer/overlay.glsl>\n\nuniform sampler2D overlay0Tex;\nuniform sampler2D overlay1Tex;\nuniform float overlayOpacity;\n\nuniform sampler2D depthTex;\nuniform vec4 highlightViewportPixelSz;\n\nvarying vec4 vtcOverlay;\n\nvoid main() {\n  vec4 overlayColor = getOverlayColor(overlay0Tex, overlay1Tex, vtcOverlay, overlayOpacity);\n\n  if (overlayColor.a == 0.0) {\n    // Here we have to write black, instead of discarding the fragment in order to overwrite\n    // the highlights which might have been written by skirts of other tiles.\n    // As a consequence skirts are not visible, but terrain overwrites draped highlights.\n    gl_FragColor = vec4(0,0,0,0);\n    return;\n  }\n\n  gl_FragColor = highlightData(gl_FragCoord, depthTex, highlightViewportPixelSz);\n}\n","highlightPass.vert":"#include <util/vsPrecision.glsl>\n#include <terrainRenderer/skirts.glsl>\n\nuniform vec3 origin;\nuniform mat4 proj;\nuniform mat4 view;\nuniform vec4 overlayTexScale;\nuniform vec4 overlayTexOffset;\nuniform float skirtScale;\n\nattribute vec3 position;\nattribute vec2 uv0;\n\nvarying vec3 vpos;\nvarying vec4 vtcOverlay;\n\nvoid main() {\n  #ifdef SPHERICAL\n    vec3 vnormal = normalize(position + origin);\n  #else\n    vec3 vnormal = vec3(0, 0, 1); // WARNING: up-axis dependent code\n  #endif\n\n  vec2 uv = uv0;\n  vpos = applySkirts(uv, position, vnormal, skirtScale);\n\n  vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;\n\n  gl_Position = proj * view * vec4(vpos, 1.0);\n}\n","normalPass.frag":"#include <util/fsPrecision.glsl>\n\nvarying vec3 vnormal;\nvarying vec3 vpos;\n\nvoid main() {\n  vec3 normal = normalize(vnormal);\n  if (gl_FrontFacing == false) normal = -normal;\n\n#ifndef ALPHA_ZERO\n  gl_FragColor = vec4(vec3(.5) + .5 * normal, 1.0);\n#else\n  gl_FragColor = vec4(vec3(.5) + .5 * normal, 0.0);\n#endif\n}\n","normalPass.vert":"#include <util/vsPrecision.glsl>\n#include <terrainRenderer/skirts.glsl>\n\nuniform vec3 origin;\nuniform mat4 proj;\nuniform mat4 view;\nuniform mat4 viewNormal;\nuniform float skirtScale;\n\nattribute vec3 position;\nattribute vec2 uv0;\n\nvarying vec3 vnormal;\nvarying vec3 vpos;\n\nvoid main(void) {\n#ifdef SPHERICAL\n  vec4 normal = vec4(normalize(position + origin), 1.0);\n#else\n  vec4 normal = vec4(0.0, 0.0, 1.0, 1.0);\n#endif\n\n  vec2 uv = uv0;\n  vpos = applySkirts(uv, position, normal.xyz, skirtScale);\n\n  gl_Position = proj * view * vec4(vpos, 1.0);\n  vnormal = normalize((viewNormal * normal).xyz);\n}\n","overlay.glsl":"vec4 getOverlayColor(sampler2D overlay0Tex, sampler2D overlay1Tex, vec4 texCoords, float opacity) {\n  vec4 color = vec4(0, 0, 0, 0);\n\n  if ((texCoords.x > 0.0) && (texCoords.x < 1.0) && (texCoords.y > 0.0) && (texCoords.y < 1.0)) {\n    // inner overlay texture coordinates are within bounds -> sample from inner overlay\n    color = texture2D(overlay0Tex, texCoords.xy);\n  } else if ((texCoords.z > 0.0) && (texCoords.z < 1.0) && (texCoords.w > 0.0) && (texCoords.w < 1.0)) {\n    // sample from outer overlay\n    color = texture2D(overlay1Tex, texCoords.zw);\n  }\n\n  return color * opacity;\n}\n","skirts.glsl":'vec3 applySkirts(inout vec2 uv, vec3 vpos, vec3 vnormal, float skirtScale) {\n  float skirtLength = 0.0;\n\n  if (uv.x >= 2.0) {\n    skirtLength = uv.y * skirtScale;\n    // decode original uv-coordinates (see "encodeSkirtPos")\n    vec2 x = vec2(uv.x) - vec2(3.5, 4.5);\n    uv = clamp(vec2(1.5) - abs(x), vec2(0.0), vec2(1.0));\n  }\n\n  return vpos - vnormal * skirtLength;\n}\n'},util:{"alignPixel.glsl":"vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {\n  // From clip space to (0 : 1), bias towards right pixel edge\n  vec2 xy = vec2(.500123) + .5 * clipCoord.xy / clipCoord.w;\n\n  // Size of a pixel in range (0 : 1)\n  vec2 pixelSz = vec2(1.0) / widthHeight;\n\n  // Round to nearest pixel center\n  vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;\n\n  // Convert back to clip space\n  vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;\n\n  return vec4(result, clipCoord.zw);\n}\n\nvec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {\n  // From clip space to (0 : 1),\n  vec2 xy = vec2(.5) + .5 * clipCoord.xy / clipCoord.w;\n\n  // Size of a pixel in range (0 : 1)\n  vec2 pixelSz = vec2(1.0) / widthHeight;\n\n  // Round to nearest pixel border, (0 : 1)\n  vec2 ij = floor((xy + .5 * pixelSz) * widthHeight) * pixelSz;\n\n  // Convert back to clip space\n  vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;\n\n  return vec4(result, clipCoord.zw);\n}\n","color.glsl":"vec4 premultiplyAlpha(vec4 v) {\n  return vec4(v.rgb * v.a, v.a);\n}\n\nvec3 rgb2hsv(vec3 c) {\n  vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n  vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n  vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n\n  float d = q.x - min(q.w, q.y);\n  float e = 1.0e-10;\n  return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n}\n\nvec3 hsv2rgb(vec3 c) {\n  vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n  vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n  return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\n","depth.glsl":"float calcFragDepth(const in float depth) {\n  //calc polygon offset\n  const float SLOPE_SCALE = 2.0;\n  const float BIAS = 2.0 * .000015259;    // 1 / (2^16 - 1)\n  float m = max(abs(dFdx(depth)), abs(dFdy(depth)));\n  float result = depth + SLOPE_SCALE * m + BIAS;\n  return clamp(result, .0, .999999);\n}\n","doublePrecision.glsl":"// based on https://www.thasler.com/blog/blog/glsl-part2-emu\nvec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n  vec3 t1 = hiA + hiB;\n  vec3 e = t1 - hiA;\n  vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n  return t1 + t2;\n}\n","enableExtensions.glsl":"\n#extension GL_OES_standard_derivatives : enable\n#extension GL_EXT_shader_texture_lod : enable\n","encoding.glsl":"// This is the maximum float value representable as 32bit fixed point,\n// it is rgba2float(vec4(1)) inlined.\nconst float MAX_RGBA_FLOAT =\n  255.0 / 256.0 +\n  255.0 / 256.0 / 256.0 +\n  255.0 / 256.0 / 256.0 / 256.0 +\n  255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n// Factors to convert to fixed point, i.e. factors (256^0, 256^1, 256^2, 256^3)\nconst vec4 fixedPointFactors = vec4(1, 256, 256 * 256, 256 * 256 * 256);\n\nvec4 float2rgba(const float value) {\n  // Make sure value is in the domain we can represent\n  float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n  // Decompose value in 32bit fixed point parts represented as\n  // uint8 rgba components. Decomposition uses the fractional part after multiplying\n  // by a power of 256 (this removes the bits that are represented in the previous\n  // component) and then converts the fractional part to 8bits.\n  vec4 fixedPointU8 = floor(fract(valueInValidDomain * fixedPointFactors) * 256.0);\n\n  // Convert uint8 values (from 0 to 255) to floating point representation for\n  // the shader\n  const float toU8AsFloat = 1.0 / 255.0;\n\n  return fixedPointU8 * toU8AsFloat;\n}\n\n// Factors to convert rgba back to float\nconst vec4 rgba2float_factors = vec4(\n  255.0 / (256.0),\n  255.0 / (256.0 * 256.0),\n  255.0 / (256.0 * 256.0 * 256.0),\n  255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n);\n\nfloat rgba2float(vec4 rgba) {\n  // Convert components from 0->1 back to 0->255 and then\n  // add the components together with their corresponding\n  // fixed point factors, i.e. (256^1, 256^2, 256^3, 256^4)\n  return dot(rgba, rgba2float_factors);\n}\n","fsPrecision.glsl":"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\nprecision highp sampler2D;\n#else\nprecision mediump float;\nprecision mediump sampler2D;\n#endif\n","highlight.glsl":"vec4 highlightData(vec4 fragCoord, sampler2D depthTex, vec4 viewportPixelSize) {\n  float sceneDepth = texture2D(depthTex, (fragCoord.xy - viewportPixelSize.xy) * viewportPixelSize.zw).r;\n  if (fragCoord.z > sceneDepth + 5e-6) {\n    return vec4(1.0, 1.0, 0.0, 1.0);\n  }\n  else {\n    return vec4(1.0, 0.0, 1.0, 1.0);\n  }\n}\n","hud.glsl":"#include <util/screenSizePerspective.glsl>\n\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec4 auxpos1;\n\nuniform mat4 proj;\n\nuniform mat4 view;\nuniform mat4 viewNormal;\n\nuniform mat4 model;\nuniform mat4 modelNormal;\n\nuniform vec4 viewport;\n\nuniform vec3 camPos;\n\nuniform float polygonOffset;\nuniform float cameraGroundRelative;\nuniform float pixelRatio;\n\n#ifdef VERTICAL_OFFSET\n\n// [ screenLength, distanceFactor, minWorldLength, maxWorldLength ]\nuniform vec4 verticalOffset;\n\n#endif\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n\n// [ divisor, offset, minPixelSize, paddingPixels ]\nuniform vec4 screenSizePerspectiveAlignment;\n\n#endif\n\nuniform sampler2D hudVisibilityTexture;\n\n\n// Corresponds to cos(10 deg), used to compare against dot product of two vectors\nconst float SMALL_OFFSET_ANGLE = 0.984807753012208;\n\nstruct ProjectHUDAux {\n  vec3 posModel;\n  vec3 posView;\n  vec3 vnormal;\n\n  float distanceToCamera;\n  float absCosAngle;\n};\n\n\n/**\n  * Apply the simulated polygon offset for HUD objects that improves\n  * issues with Z-fighting.\n  *\n  * @param posView {vec3} (inout) the position in view space. Will be modified in place.\n  * @param pointGroundDistance {float} the distance from the point geometry to the ground surface.\n  * @param absCosAngle {float} the absolute cosine of the angle between the world-up at the point geometry\n  *   and the view direction.\n  *\n  * Dependencies:\n  *\n  *   Attributes:\n  *     - auxpos1: contains centerOffset and pointGroundDistance\n  *\n  *   Uniforms:\n  *     - cameraGroundRelative: indicates whether camera is above (1) or below (-1) ground.\n  *         This is used for emulated polygon offset for improved visibility of points sitting on the surface.\n  *     - polygonOffset: a constant polygon offset to bring the point closer to the viewer for\n  *         reduced flickering.\n  *     - viewport: the viewport [x, y, width, height]\n  */\nfloat applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {\n  float pointGroundSign = sign(pointGroundDistance);\n\n  if (pointGroundSign == 0.0) {\n    pointGroundSign = 1.0;\n  }\n\n  // cameraGroundRelative is -1 if camera is below ground, 1 if above ground\n  // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise\n  float groundRelative = cameraGroundRelative * pointGroundSign;\n\n  // view angle dependent part of polygon offset emulation\n  // we take the absolute value because the sign that is dropped is\n  // instead introduced using the ground-relative position of the symbol and the camera\n  if (polygonOffset > .0) {\n    float cosAlpha = clamp(absCosAngle, 0.01, 1.0);\n\n    float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;\n    float factor = (1.0 - tanAlpha / viewport[2]);\n\n    // same side of the terrain\n    if (groundRelative > 0.0) {\n      posView *= factor;\n    }\n    // opposite sides of the terrain\n    else {\n      posView /= factor;\n    }\n  }\n\n  return groundRelative;\n}\n\n/**\n  * Project the 3d position of a HUD object from world space to clip space. In addition\n  * to standard model view projection, it also emulates a polygon offset to\n  * help with points above/below ground and icon flickering. The resulting location\n  * is the anchor of the HUD object, i.e. the position that is used also for testing\n  * visibility of the HUD object. Note that the returned projected position is not\n  * aligned to a pixel center or border, it is up to the caller to align if necessary.\n  *\n  * Dependencies:\n  *\n  *   Attributes:\n  *     - position: contains the point world position\n  *     - normal: contains the world normal pointing up at the point\n  *     - auxpos1: contains centerOffset and pointGroundDistance\n  *\n  *   Uniforms:\n  *     - model: the object -> world transformation matrix\n  *     - modelNormal: the object -> world normal transformation matrix (inv transp of model)\n  *     - view: the world -> view transformation matrix\n  *     - viewNormal: the world -> view normal transformation matrix (inv transp of view)\n  *     - proj: the view -> clip projection matrix\n  *     - verticalOffset: a vec4 containing:\n  *         - the screen height of the vertical offset\n  *         - the screen height of the vertical offset as a fraction of camera distance.\n  *         - the minimum world size vertical offset.\n  *         - the maximum world size vertical offset.\n  *       This will do a screen sized offset of the point along its normal (used for line callouts)\n  *     - screenSizePerspectiveAlignment: a vec3 containing\n  *         - the view distance dependent divisor\n  *         - the view distance dependent offset\n  *         - the minimum pixel size\n  *         - the amount of padding in pixels around the region to be scaled (not used for alignment)\n  *     - cameraGroundRelative: indicates whether camera is above (1) or below (-1) ground.\n  *         This is used for emulated polygon offset for improved visibility of points sitting on the surface.\n  *     - polygonOffset: a constant polygon offset to bring the point closer to the viewer for\n  *         reduced flickering.\n  *     - camPos: the position of the camera in world space\n  *     - viewport: the viewport [x, y, width, height]\n  */\nvec4 projectPositionHUD(out ProjectHUDAux aux) {\n  // centerOffset is in view space and is used to implement world size offsetting\n  // of labels with respect to objects. It also pulls the label towards the viewer\n  // so that the label is visible in front of the object.\n  vec3 centerOffset = auxpos1.xyz;\n\n  // The pointGroundDistance is the distance of the geometry to the ground and is\n  // negative if the point is below the ground, or positive if the point is above\n  // ground.\n  float pointGroundDistance = auxpos1.w;\n\n  aux.posModel = (model * vec4(position, 1.0)).xyz;\n  aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;\n  aux.vnormal = (modelNormal * vec4(normal, 1.0)).xyz;\n\n  // Screen sized offset in world space, used for example for line callouts\n  // Note: keep this implementation in sync with the CPU implementation, see\n  //   - MaterialUtil.verticalOffsetAtDistance\n  //   - HUDMaterial.applyVerticalOffsetTransformation\n\n  aux.distanceToCamera = length(aux.posView);\n\n  vec3 viewDirObjSpace = normalize(camPos - aux.posModel);\n  float cosAngle = dot(aux.vnormal, viewDirObjSpace);\n\n  aux.absCosAngle = abs(cosAngle);\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n\n#if defined(VERTICAL_OFFSET) || defined(CENTER_OFFSET_UNITS_SCREEN)\n  vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);\n#endif\n\n#endif\n\n#ifdef VERTICAL_OFFSET\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n  float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);\n#else\n  float verticalOffsetScreenHeight = verticalOffset.x;\n#endif\n\n  float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);\n  vec3 modelOffset = aux.vnormal * worldOffset;\n\n  aux.posModel += modelOffset;\n\n  vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;\n  aux.posView += viewOffset;\n\n  // Since we elevate the object, we need to take that into account\n  // in the distance to ground\n  pointGroundDistance += worldOffset;\n\n#endif\n\n  float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);\n\n#ifndef CENTER_OFFSET_UNITS_SCREEN\n  // Apply x/y in view space, but z in screen space (i.e. along posView direction)\n  aux.posView += vec3(centerOffset.x, centerOffset.y, 0);\n\n  // Same material all have same z != 0.0 condition so should not lead to\n  // branch fragmentation and will save a normalization if it's not needed\n  if (centerOffset.z != 0.0) {\n    aux.posView -= normalize(aux.posView) * centerOffset.z;\n  }\n#endif\n\n  vec4 posProj = proj * vec4(aux.posView, 1.0);\n\n#ifdef CENTER_OFFSET_UNITS_SCREEN\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n  float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);\n#else\n  float centerOffsetY = centerOffset.y;\n#endif\n\n  posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;\n\n#endif\n\n  // constant part of polygon offset emulation\n  posProj.z -= groundRelative * polygonOffset * posProj.w;\n\n  return posProj;\n}\n\nuniform float uRenderTransparentlyOccludedHUD;\n\n/**\n  * Test for visibility of a HUD object.\n  *\n  * Dependencies:\n  *\n  *   Uniforms:\n  *     - hudVisibilityTexture: the texture that contains the visibility information\n  *     - markerColor: the special marker color that is used to write visibility information\n  *     - viewport: the viewport\n  */\nbool testVisibilityHUD(vec4 posProj) {\n  // For occlusion testing, use the nearest pixel center to avoid\n  // subpixel filtering messing up the color we use to test for\n  vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);\n\n  vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);\n\n  // the red pixel here indicates that the occlusion pixel passed the depth test against solid geometry and was written\n  // the green pixel stores transparency of transparent geometry (1.0 -> fully transparent)\n  // note that we also check against green == 0.0, i.e. transparent geometry that has opaque parts\n\n  // thus we render visible pixels that are occluded by semi-transparent (but not fully transparent!) geometry here\n  if (uRenderTransparentlyOccludedHUD > 0.5) {\n    // multiplying by uRenderTransparentlyOccludedHUD allows us to ignore the second condition if\n    // uRenderTransparentlyOccludedHUD = 0.75\n    return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * uRenderTransparentlyOccludedHUD < 1.0;\n  }\n  // and visible pixels that are not occluded by semi-transparent geometry here\n  else {\n    return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;\n  }\n\n  // return texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w).r > 0.0;\n}\n","normalEncoding.glsl":"vec3 decodeNormal(vec2 f) {\n    float z = 1.0 - abs(f.x) - abs(f.y);\n    return vec3(f + sign(f) * min(z, 0.0), z);\n}\n","quad.vert":"#include <util/vsPrecision.glsl>\n\nattribute vec2 position;\nvarying vec2 uv;\n\nvoid main(void) {\n  gl_Position = vec4(position.x, position.y, .0, 1.0);\n  uv = position * .5 + vec2(.5);\n}\n","sceneLighting.glsl":"// Scene Lighting Definitions:\n// ================================\n\n// defines:\n//   - SH_ORDER: 1|2|3\n// input:\n//   - normal: vec3\n//   - albedo: vec3\n//   - shadow: float\n//   - ssao: float\n// return:\n//   - color: vec3\n\n// main light\n/////////////////////////////////////////\nuniform vec3 lightingMainDirection;\nuniform vec3 lightingMainIntensity;\n\n// ambient lighting\n/////////////////////////////////////////\n#ifndef SH_ORDER\n  #define SH_ORDER 2\n#endif\n\n#if SH_ORDER == 0\n  uniform vec3 lightingAmbientSH0;\n#elif SH_ORDER == 1\n  uniform vec4 lightingAmbientSH_R;\n  uniform vec4 lightingAmbientSH_G;\n  uniform vec4 lightingAmbientSH_B;\n#elif SH_ORDER == 2\n  uniform vec3 lightingAmbientSH0;\n  uniform vec4 lightingAmbientSH_R1;\n  uniform vec4 lightingAmbientSH_G1;\n  uniform vec4 lightingAmbientSH_B1;\n  uniform vec4 lightingAmbientSH_R2;\n  uniform vec4 lightingAmbientSH_G2;\n  uniform vec4 lightingAmbientSH_B2;\n#endif\n\n// special tweaking\n//////////////////////////////////////////\nuniform float lightingFixedFactor;\nuniform float lightingGlobalFactor;\n\nuniform float ambientBoostFactor;\n\n// evaluation\n//////////////////////////////////////////\n\nvec3 evaluateSceneLighting(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight) {\n  // evaluate the main light\n  float dotVal = mix(clamp(-dot(normal, lightingMainDirection), 0.0, 1.0), 1.0, lightingFixedFactor);\n  vec3 mainLight = (1.0 - shadow) * lightingMainIntensity * dotVal;\n\n  // evaluate the sh ambient light\n  #if SH_ORDER == 0\n    vec3 ambientLight = 0.282095 * lightingAmbientSH0;\n  #elif SH_ORDER == 1\n    vec4 sh0 = vec4(\n      0.282095,\n      0.488603 * normal.x,\n      0.488603 * normal.z,\n      0.488603 * normal.y\n    );\n    vec3 ambientLight = vec3(\n      dot(lightingAmbientSH_R, sh0),\n      dot(lightingAmbientSH_G, sh0),\n      dot(lightingAmbientSH_B, sh0)\n    );\n  #elif SH_ORDER == 2\n    vec3 ambientLight = 0.282095 * lightingAmbientSH0;\n\n    vec4 sh1 = vec4(\n      0.488603 * normal.x,\n      0.488603 * normal.z,\n      0.488603 * normal.y,\n      1.092548 * normal.x * normal.y\n    );\n    vec4 sh2 = vec4(\n      1.092548 * normal.y * normal.z,\n      0.315392 * (3.0 * normal.z * normal.z - 1.0),\n      1.092548 * normal.x * normal.z,\n      0.546274 * (normal.x * normal.x - normal.y * normal.y)\n    );\n    ambientLight += vec3(\n      dot(lightingAmbientSH_R1, sh1),\n      dot(lightingAmbientSH_G1, sh1),\n      dot(lightingAmbientSH_B1, sh1)\n    );\n    ambientLight += vec3(\n      dot(lightingAmbientSH_R2, sh2),\n      dot(lightingAmbientSH_G2, sh2),\n      dot(lightingAmbientSH_B2, sh2)\n    );\n  #endif\n  ambientLight *= (1.0 - ssao);\n\n  // inverse gamma correction on the albedo color\n  float gamma = 2.1;\n  vec3 albedoGammaC = pow(albedo, vec3(gamma));\n\n  // physically correct BRDF normalizes by PI\n  const float PI = 3.14159;\n  vec3 totalLight = mainLight + ambientLight + additionalLight;\n  totalLight = min(totalLight, vec3(PI, PI, PI));\n  vec3 outColor = vec3((albedoGammaC / PI) * (totalLight));\n\n  // apply gamma correction to the computed color\n  outColor = pow(outColor, vec3(1.0/gamma));\n\n  return outColor;\n}\n\nvec3 sceneLightingAdditionalLightGlobal(vec3 worldPos, float ssao, out float additionalAmbientScale) {\n  // heuristic lighting model originally used in the terrain shading\n  // now used to generated additional ambient light\n\n#ifdef VIEWING_MODE_GLOBAL\n    float vndl = -dot(normalize(worldPos), lightingMainDirection);\n#else\n    float vndl = -dot(vec3(0,0,1), lightingMainDirection);\n#endif\n\n  additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));\n  return ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n}\n","screenSizePerspective.glsl":"// Note that the implementation here should be kept in sync with the corresponding\n// CPU implementation (used for hitTest etc) in screenSizePerspectiveUtils.ts\n\n/**\n * Compute the screen size perspective lower bound from pre-computed screen\n * size perspective factors (or parameters, since both store the pixel lower\n * bound information in the same place). When computing the minimum size,\n * the padding (e.g. text halo) is scaled with the same factor as the\n * original size scales to reach the minimum size.\n *\n * {\n *    x: N/A\n *    y: N/A\n *    z: minPixelSize (abs),\n *    w: sizePaddingInPixels (abs)\n * }\n */\nfloat screenSizePerspectiveMinSize(float size, vec4 factor) {\n\n  // Original calculation:\n  //   padding = 2 * factor.w\n  //   minSize = factor.z\n  //\n  //   minSize + minSize / size * padding\n  //\n  // Incorporates padding (factor.w, e.g. text halo size) into the\n  // minimum bounds calculation, taking into account that padding\n  // would scale down proportionally to the size.\n  //\n  // Calculation below is the same, but avoids division by zero when\n  // size would be zero, without branching using step.\n  // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10683\n\n  // nonZeroSize is 1 if size > 0, and 0 otherwise\n  float nonZeroSize = 1.0 - step(size, 0.0);\n\n  return (\n    factor.z * (\n      1.0 +\n      nonZeroSize *                // Multiply by nzs ensures if size is 0, then we ignore\n                                   // proportionally scaled padding\n      2.0 * factor.w / (\n        size + (1.0 - nonZeroSize) // Adding 1 - nzs ensures we divide either by size, or by 1\n      )\n    )\n  );\n}\n\n/**\n * Computes the view angle dependent screen size perspective factor. The goal\n * of this factor is that:\n *\n *   1. There is no perspective when looking top-down\n *   2. There is a smooth and quick transition to full perspective when\n *      tilting.\n */\nfloat screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {\n  return absCosAngle * absCosAngle * absCosAngle;\n}\n\n/**\n * Precomputes a set of factors that can be used to apply screen size perspective\n * The factors are based on the viewing angle, distance to camera and the screen size\n * perspective parameters:\n * {\n *    x: distanceDivisor,\n *    y: distanceOffset,\n *    z: minPixelSize (abs),\n *    w: sizePaddingInPixels (abs)\n * }\n *\n * The result is a set of factors that can be used to apply the perspective:\n *\n * {\n *    x: distance based relative scale factor (0 -> 1)\n *    y: view dependent scale factor\n *    z: minPixelSize (abs)\n *    w: sizePaddingInPixels (abs)\n * }\n */\nvec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {\n  return vec4(min(params.x / (distanceToCamera - params.y), 1.0), screenSizePerspectiveViewAngleDependentFactor(absCosAngle), params.z, params.w);\n}\n\n/**\n * Applies screen size perspective factors to a single dimension size, given the viewing angle,\n * distance to camera and perspective parameters. The factors can be calculated from the screen size\n * perspective parameters using screenSizePerspectiveScaleFactorFloat.\n *\n * Note that for single scale application, the screenSizePerspectiveScaleFloat can be used, which\n * will call this method, providing it the factors calculated from screenSizePerspectiveScaleFactorFloat.\n */\n\nfloat applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {\n  return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));\n}\n\n/**\n * Applies screen size perspective parameters to a single dimension size, given the viewing angle,\n * distance to camera and perspective parameters\n * {\n *    x: distanceDivisor,\n *    y: distanceOffset,\n *    z: minPixelSize (abs),\n *    w: sizePaddingInPixels (abs)\n * }\n */\nfloat screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {\n  return applyScreenSizePerspectiveScaleFactorFloat(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\n}\n\n/**\n * Applies screen size perspective factors to a vec2 size (width/height), given the viewing angle,\n * distance to camera and perspective parameters. The factors can be calculated from the screen size\n * perspective parameters using screenSizePerspectiveScaleFactorVec2.\n *\n * Note that for single scale application, the screenSizePerspectiveScaleVec2 can be used, which\n * will call this method, providing it the factors calculated from screenSizePerspectiveScaleFactorVec2.\n */\nvec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {\n  return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / size.y, 1.0), size, factor.y);\n}\n\n/**\n * Applies screen size perspective parameters to a vec2 size (width/height), given the viewing angle,\n * distance to camera and perspective parameters\n * {\n *    x: distanceDivisor,\n *    y: distanceOffset,\n *    z: minPixelSize (abs),\n *    w: sizePaddingInPixels (abs)\n * }\n */\nvec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {\n  return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\n}\n","shadow.glsl":'#include <util/encoding.glsl>\n\n// "matrix" parameter used to have const qualifier as well, but IE11 couldn\'t deal with it at time of writing.\n// once IE11 is fine with it, const should probably be re-introduced\nfloat evalShadow(const in vec3 vpos, const in float depth, const in sampler2D depthTex, const int num, const in vec4 distance, in mat4 matrix[4], const in float halfPxSz) {\n  //choose correct cascade\n  int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;\n\n  if (i >= num) { return .0; }\n\n  mat4 mat = i == 0 ? matrix[0] : i == 1 ? matrix[1] : i == 2 ? matrix[2] : matrix[3];\n\n  vec4 lv = mat * vec4(vpos, 1.0);\n  lv.xy /= lv.w;\n\n  //vertex completely outside? -> no shadow\n  vec3 lvpos = .5 * lv.xyz + vec3(.5);\n  if (lvpos.z >= 1.0) { return .0; }\n  if (lvpos.x < .0 || lvpos.x > 1.0 || lvpos.y < .0 || lvpos.y > 1.0) { return .0; }\n\n  //calc coord in cascade texture\n  vec2 uv = vec2(float(i - 2 * (i / 2)) *.5, float(i / 2) * .5) + .5 * lvpos.xy;\n\n  float texSize = .5 / halfPxSz;\n\n  //filter, offset by half pixels\n  vec2 st = fract((vec2(halfPxSz) + uv) * texSize);\n\n  float s00 = rgba2float(texture2D(depthTex, uv + vec2(-halfPxSz, -halfPxSz))) < lvpos.z ? 1.0 : .0;\n  float s10 = rgba2float(texture2D(depthTex, uv + vec2(halfPxSz, -halfPxSz))) < lvpos.z ? 1.0 : .0;\n  float s11 = rgba2float(texture2D(depthTex, uv + vec2(halfPxSz, halfPxSz))) < lvpos.z ? 1.0 : .0;\n  float s01 = rgba2float(texture2D(depthTex, uv + vec2(-halfPxSz, halfPxSz))) < lvpos.z ? 1.0 : .0;\n\n  return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);\n}\n',"slice.glsl":"#ifdef SLICE\nuniform vec3 slicePlaneOrigin;\nuniform vec3 slicePlaneBasis1;\nuniform vec3 slicePlaneBasis2;\n\nbool sliceByPlane(vec3 pos) {\n  vec3 rel = pos - slicePlaneOrigin;\n\n  vec3 slicePlaneNormal = cross(slicePlaneBasis1, slicePlaneBasis2);\n  float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);\n\n  float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);\n  float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);\n\n  float basis1Dot = dot(slicePlaneBasis1, rel);\n  float basis2Dot = dot(slicePlaneBasis2, rel);\n\n  return (dot(slicePlaneNormal, pos) + slicePlaneW) < 0.0\n    && -basis1Dot - basis1Len2 < 0.0\n    && basis1Dot - basis1Len2 < 0.0\n    && -basis2Dot - basis2Len2 < 0.0\n    && basis2Dot - basis2Len2 < 0.0;\n}\n\n#define rejectBySlice(_pos_) sliceByPlane(_pos_)\n#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }\n\n#else // SLICE\n\n#define rejectBySlice(_pos_) false\n#define discardBySlice(_pos_) {}\n\n#endif // SLICE\n","visualVariables.glsl":"#if defined(VV_SIZE)\n  #define VV_CUSTOM_MODEL_MATRIX\n#endif\n\n#if defined(VV_SIZE)\n  uniform vec3 vvSizeMinSize;\n  uniform vec3 vvSizeMaxSize;\n  uniform vec3 vvSizeOffset;\n  uniform vec3 vvSizeFactor;\n#elif defined(VV_CUSTOM_MODEL_MATRIX)\n  uniform vec3 vvSizeValue;\n#endif\n\n#ifdef VV_CUSTOM_MODEL_MATRIX\n  uniform mat3 vvSymbolRotation;\n#endif\n\n#ifdef VV_CUSTOM_MODEL_MATRIX\n  uniform vec3 vvSymbolAnchor;\n#endif\n\n#ifdef VV_COLOR\n  #define VV_COLOR_N 8\n  uniform float vvColorValues[VV_COLOR_N];\n  uniform vec4 vvColorColors[VV_COLOR_N];\n#endif\n\n// Evaluation of size\n#if defined(VV_SIZE)\n  vec3 vvGetScale(vec4 featureAttribute) {\n    return clamp(vvSizeOffset + featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);\n  }\n#elif defined(VV_CUSTOM_MODEL_MATRIX)\n  vec3 vvGetScale(vec4 featureAttribute) {\n    return vvSizeValue;\n  }\n#endif\n\n// Applying the model matrix\n#ifdef VV_CUSTOM_MODEL_MATRIX\n  vec4 vvTransformPosition(vec3 position, vec4 featureAttribute) {\n    return vec4(vvSymbolRotation * (vvGetScale(featureAttribute) * (position + vvSymbolAnchor)), 1.0);\n  }\n\n  vec4 vvTransformNormal(vec3 normal, vec4 featureAttribute) {\n    // Normal transform is the inverse transpose of model transform\n    return vec4(vvSymbolRotation * normal / vvGetScale(featureAttribute), 1.0);\n  }\n#endif\n\n#ifdef VV_COLOR\n  vec4 vvGetColor(vec4 featureAttribute, float values[VV_COLOR_N], vec4 colors[VV_COLOR_N]) {\n    float value = featureAttribute.y;\n    if (value <= values[0]) {\n      return colors[0];\n    }\n\n    for (int i = 1; i < VV_COLOR_N; ++i) {\n      if (values[i] >= value) {\n        float f = (value - values[i-1]) / (values[i] - values[i-1]);\n        return mix(colors[i-1], colors[i], f);\n      }\n    }\n\n    return colors[VV_COLOR_N - 1];\n  }\n#endif\n","vsPrecision.glsl":"precision highp float;\nprecision highp sampler2D;\n"}}}.apply(null,n))||(e.exports=i)},1510:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BASE_TEXTURE_UNIT=33984}.apply(null,n))||(e.exports=i)},1511:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){return function(){function e(){this._instanceCount={textureCount:0,bufferCount:0,vaoCount:0,programCount:0,framebufferCount:0,renderBufferCount:0}}return e.prototype.incrementCount=function(e){switch(e){case 0:this._instanceCount.textureCount++;break;case 1:this._instanceCount.bufferCount++;break;case 2:this._instanceCount.vaoCount++;break;case 3:this._instanceCount.programCount++;break;case 4:this._instanceCount.framebufferCount++;break;case 5:this._instanceCount.renderBufferCount++}},e.prototype.decrementCount=function(e){switch(e){case 0:this._instanceCount.textureCount--;break;case 1:this._instanceCount.bufferCount--;break;case 2:this._instanceCount.vaoCount--;break;case 3:this._instanceCount.programCount--;break;case 4:this._instanceCount.framebufferCount--;break;case 5:this._instanceCount.renderBufferCount--}},e.prototype.printResourceCount=function(){console.log("Live objects:"),console.log("Textures: "+this._instanceCount.textureCount),console.log("Buffers: "+this._instanceCount.bufferCount),console.log("VAOs: "+this._instanceCount.vaoCount),console.log("Programs: "+this._instanceCount.programCount),console.log("Framebuffers: "+this._instanceCount.framebufferCount),console.log("Renderbuffers: "+this._instanceCount.renderBufferCount)},e}()}.apply(null,n))||(e.exports=i)},1512:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1513),r(1514),r(778),r(1515)],void 0===(i=function(e,t,r,n,i,o){function a(e,t){if(i.default(e))return{MIN:e.MIN,MAX:e.MAX};if(t.blendMinMax)return null;var r=e.getExtension("EXT_blend_minmax");return r?{MIN:r.MIN_EXT,MAX:r.MAX_EXT}:null}function s(e,t){if(i.default(e))return!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_float")?{R16F:e.R16F,RG16F:e.RG16F,RGBA16F:e.RGBA16F,R32F:e.R32F,RG32F:e.RG32F,RGBA32F:e.RGBA32F,R11F_G11F_B10F:e.R11F_G11F_B10F}:null;if(e instanceof WebGLRenderingContext){var r=!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_half_float"),n=!t.colorBufferFloat&&e.getExtension("WEBGL_color_buffer_float");return r||n?{RGBA16F:r?r.RGBA16F_EXT:void 0,RGBA32F:n?n.RGBA32F_EXT:void 0}:null}}function l(e,t,r,n,o){if(n&&i.default(e))return!0;if(t[r])return!1;for(var a=0,s=o;a<s.length;a++){var l=s[a];if(e.getExtension(l))return!0}return!1}Object.defineProperty(t,"__esModule",{value:!0}),t.loadCapabilities=function(e,t){var i=t&&t.disabledExtensions||{};return l(e,i,"standardDerivatives",!0,["OES_standard_derivatives"]),{instancing:n.load(e),vao:o.load(e,i),compressedTextureS3TC:function(e,t){if(t.compressedTextureS3TC)return null;var r=e.getExtension("WEBGL_compressed_texture_s3tc");return r?{COMPRESSED_RGB_S3TC_DXT1:r.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:r.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:r.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:r.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}(e,i),textureFilterAnisotropic:function(e,t){if(t.textureFilterAnisotropic)return null;var r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return r?{MAX_TEXTURE_MAX_ANISOTROPY:r.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:r.TEXTURE_MAX_ANISOTROPY_EXT}:null}(e,i),disjointTimerQuery:r.load(e,i),colorBufferFloat:s(e,i),blendMinMax:a(e,i),depthTexture:l(e,i,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"]),standardDerivatives:!0,shaderTextureLOD:l(e,i,"shaderTextureLOD",!0,["EXT_shader_texture_lod"]),textureFloatLinear:l(e,i,"textureFloatLinear",!1,["OES_texture_float_linear"]),fragDepth:l(e,i,"fragDepth",!0,["EXT_frag_depth"])}}}.apply(null,n))||(e.exports=i)},1513:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(778)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.load=function(e,t){if(t.disjointTimerQuery)return null;var n=e.getExtension("EXT_disjoint_timer_query")||e.getExtension("EXT_disjoint_timer_query_webgl2");return n?r.default(e)?{createQuery:function(){return e.createQuery()},resultAvailable:function(t){return e.getQueryParameter(t,e.QUERY_RESULT_AVAILABLE)},getResult:function(t){return e.getQueryParameter(t,e.QUERY_RESULT)},disjoint:function(){return e.getParameter(n.GPU_DISJOINT_EXT)},beginTimeElapsed:function(t){return e.beginQuery(n.TIME_ELAPSED_EXT,t)},endTimeElapsed:function(){return e.endQuery(n.TIME_ELAPSED_EXT)},createTimestamp:function(e){return n.queryCounterEXT(e,n.TIMESTAMP_EXT)},timestampBits:function(){return e.getQuery(n.TIMESTAMP_EXT,n.QUERY_COUNTER_BITS_EXT)}}:{createQuery:function(){return n.createQueryEXT()},resultAvailable:function(e){return n.getQueryObjectEXT(e,n.QUERY_RESULT_AVAILABLE_EXT)},getResult:function(e){return n.getQueryObjectEXT(e,n.QUERY_RESULT_EXT)},disjoint:function(){return e.getParameter(n.GPU_DISJOINT_EXT)},beginTimeElapsed:function(e){return n.beginQueryEXT(n.TIME_ELAPSED_EXT,e)},endTimeElapsed:function(){return n.endQueryEXT(n.TIME_ELAPSED_EXT)},createTimestamp:function(e){return n.queryCounterEXT(e,n.TIMESTAMP_EXT)},timestampBits:function(){return n.getQueryEXT(n.TIMESTAMP_EXT,n.QUERY_COUNTER_BITS_EXT)}}:null}}.apply(null,n))||(e.exports=i)},1514:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(778)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.load=function(e){if(r.default(e))return{drawArraysInstanced:e.drawArraysInstanced.bind(e),drawElementsInstanced:e.drawElementsInstanced.bind(e),vertexAttribDivisor:e.vertexAttribDivisor.bind(e)};var t=e.getExtension("ANGLE_instanced_arrays");return t?{drawArraysInstanced:t.drawArraysInstancedANGLE.bind(t),drawElementsInstanced:t.drawElementsInstancedANGLE.bind(t),vertexAttribDivisor:t.vertexAttribDivisorANGLE.bind(t)}:null}}.apply(null,n))||(e.exports=i)},1515:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(778)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.load=function(e,t){if(r.default(e))return{createVertexArray:e.createVertexArray.bind(e),deleteVertexArray:e.deleteVertexArray.bind(e),bindVertexArray:e.bindVertexArray.bind(e)};if(t.vao)return null;var n=e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object");return n?{createVertexArray:n.createVertexArrayOES.bind(n),deleteVertexArray:n.deleteVertexArrayOES.bind(n),bindVertexArray:n.bindVertexArrayOES.bind(n)}:null}}.apply(null,n))||(e.exports=i)},1576:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1048)],void 0===(i=function(e,t,r){var n=function(){return function(e){this.highlightSet=new r,this.ids=new Set,this.options=e}}();return function(){function e(e){this.highlights=[],this.layerView=e}return e.prototype.destroy=function(){this.highlights.forEach(function(e){return e.highlightSet.removeAll()}),this.highlights=null},e.prototype.acquireSet=function(e){var t=this,r=new n(e);return this.highlights.push(r),{set:r,handle:{remove:function(){return t.releaseSet(r)}}}},e.prototype.releaseSet=function(e){e.highlightSet.removeAll();var t=this.highlights?this.highlights.indexOf(e):-1;-1!==t&&this.highlights.splice(t,1)},e.prototype.setFeatureIds=function(e,t){t.forEach(function(t){return e.ids.add(t)}),this.layerView._forAllFeatures(function(t,r,n,i){if(e.ids.has(t)){var o=n.engineObject.setComponentHighlight(i,r,e.options);e.highlightSet.addObject(n.engineObject,o)}},null,!0)},e.prototype.objectCreated=function(e){var t=this;this.highlights.forEach(function(r){t.layerView._forAllFeaturesOfNode(t.layerView._getMetadata(e),function(t,n,i,o){if(r.ids.has(t)){var a=e.setComponentHighlight(o,n,r.options);r.highlightSet.addObject(e,a)}},!0)})},e.prototype.objectDeleted=function(e){this.highlights.forEach(function(t){t.highlightSet.removeObject(e)})},e.prototype.allObjectsDeleted=function(){this.highlights.forEach(function(e){return e.highlightSet.removeAll()})},e}()}.apply(null,n))||(e.exports=i)},1577:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(338),r(336),r(346),r(343),r(337),r(367),r(598),r(344),r(967),r(1578)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,c,d){var p=s.empty(),f={spatialReference:null,extent:p},h=u.vec3d.create(),m=u.vec3d.create(),v=u.vec3d.create(),g=o.getLogger("esri.views.3d.layers.i3s.I3SElevationProvider");return function(e){function t(t){return e.call(this)||this}return r(t,e),t.prototype.initialize=function(){this.renderCoordsHelper=this.layerView.view.renderCoordsHelper,this.intersectLayers=[this.stageLayer],this.selector=new d(this.layerView.view.viewingMode);var e=this.layerView.layer.fullExtent;this.zmin=e.zmin,this.zmax=e.zmax},t.prototype.getElevation=function(e){if(l.isPoint(e)){if(!this.renderCoordsHelper.toRenderCoords(e,h))return g.error("could not project point for elevation alignment"),-1/0}else if(!this.renderCoordsHelper.toRenderCoords(e,this.spatialReference,h))return g.error("could not project point for elevation alignment"),-1/0;var t=this.layerView.elevationOffset,r=this.zmin+t,n=this.zmax+t;return u.vec3d.set(h,m),u.vec3d.set(h,v),this.renderCoordsHelper.setAltitude(n,m),this.renderCoordsHelper.setAltitude(r,v),this.selector.init(this.intersectLayers,m,v,null,null,1,!1),this.selector.minResult.getIntersectionPoint(h)?this.renderCoordsHelper.getAltitude(h):-1/0},t.prototype.layerChanged=function(){this.spatialReference&&(f.extent=this.computeLayerExtent(this.intersectLayers[0]),f.spatialReference=this.spatialReference,this.emit("elevation-change",f))},t.prototype.objectChanged=function(e){this.spatialReference&&(f.extent=this.computeObjectExtent(e),f.spatialReference=this.spatialReference,this.emit("elevation-change",f))},t.prototype.computeObjectExtent=function(e){return s.empty(p),this.expandExtent(e,p),p},t.prototype.computeLayerExtent=function(e){s.empty(p);for(var t=0,r=e.getObjects();t<r.length;t++){var n=r[t];this.expandExtent(n,p)}return p},t.prototype.expandExtent=function(e,t){for(var r=e.getBBMin(!0),n=e.getBBMax(!0),i=0;i<8;++i)h[0]=1&i?r[0]:n[0],h[1]=2&i?r[1]:n[1],h[2]=4&i?r[2]:n[2],u.mat4d.multiplyVec3(e.objectTransformation,h),this.renderCoordsHelper.fromRenderCoords(h,h,this.spatialReference),s.expand(t,h);return t},n([a.property({constructOnly:!0})],t.prototype,"layerView",void 0),n([a.property({constructOnly:!0})],t.prototype,"stageLayer",void 0),n([a.property({readOnly:!0,aliasOf:"layerView.view.elevationProvider.spatialReference"})],t.prototype,"spatialReference",void 0),n([a.subclass("esri.views.3d.layers.i3s.I3SElevationProvider")],t)}(a.declared(i,c.Evented))}.apply(null,n))||(e.exports=i)},1578:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(354),r(344),r(699),r(810)],void 0===(i=function(e,t,r,n,i,o){var a=n.vec3d.create(),s=n.vec3d.create(),l=n.vec3d.create(),u=r("dojo-debug-messages"),c=function(){function e(e){this.minResult=new d,this.maxResult=new d,this._normalDir=null,this._transform=n.mat4d.create(),this._transformInverse=new p({value:this._transform},n.mat4d.inverse,n.mat4d.create),this._transformInverseTranspose=new p(this._transformInverse,n.mat4d.transpose,n.mat4d.create),this._transformTranspose=new p({value:this._transform},n.mat4d.transpose,n.mat4d.create),this._transformInverseRotation=new p({value:this._transform},n.mat4d.toInverseMat3,n.mat3d.create),this.enableHUDSelection=!0,this.enableTerrain=!0,this.enableInvisibleTerrain=!1,this.enableBackfacesTerrain=!0,this.performanceInfo={queryDuration:0,numObjectsTested:0},this.viewingMode=e||"global",u&&(this._timer=new o(1))}return e.prototype.init=function(e,t,r,i,o,a,s,c){var d=this;if(t&&r&&n.vec3d.subtract(r,t,l),this.minResult.init(t,r),this.maxResult.init(t,r),this._numObjectsTested=0,this.point=i,this.camera=o,this.isSelection=s,this.p0=t,this.p1=r,this.hudResults=[],null==a&&(a=1e-5),this.tolerance=a,e){var p=function(e){d.intersectObject(e,c)};u&&this._timer.start();for(var f=0,h=e;f<h.length;f++){var m=h[f],v=m.getSpatialQueryAccelerator?m.getSpatialQueryAccelerator():void 0;if(v)v.forEachAlongRay(this.p0,l,p),s&&v.forEachDegenerateObject(p);else for(var g=0,y=m.getObjects();g<y.length;g++){p(y[g])}}u&&(this._timer.stop(),this.performanceInfo.queryDuration=this._timer.getLast(),this.performanceInfo.numObjectsTested=this._numObjectsTested)}},Object.defineProperty(e.prototype,"transformInverse",{get:function(){return this._transformInverse.value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"transformInverseTranspose",{get:function(){return this._transformInverseTranspose.value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"transformInverseRotation",{get:function(){return this._transformInverseRotation.value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"transformTranspose",{get:function(){return this._transformTranspose.value},enumerable:!0,configurable:!0}),e.prototype.getDirection=function(){return this._normalDir||(this._normalDir=n.vec3d.create(),n.vec3d.normalize(l,this._normalDir)),this._normalDir},e.prototype.intersectObject=function(e,t){var r=this;this._numObjectsTested++;for(var i,o=e.id,l=e.getGeometryRecords(),u=e.objectTransformation,c=0;c<l.length;c++){var p=l[c],f=p.geometry,h=p.materials,m=p.instanceParameters;m.hidden||(i=f.id,n.mat4d.set(u,this._transform),n.mat4d.multiply(this._transform,p.getShaderTransformation()),this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate(),n.mat4d.multiplyVec3(this.transformInverse,this.p0,a),n.mat4d.multiplyVec3(this.transformInverse,this.p1,s),h[0].intersect(f,m,this._transform,this,a,s,function(n,a,s,l,u,c){if(n>=0){if(null!=t&&!t(r.p0,r.p1,n))return;if(u){var p=new d;p.init(r.p0,r.p1),p.set(e,o,n,a,l,c,i,s),r.hudResults.push(p)}else(null==r.minResult.priority||l>=r.minResult.priority)&&(null==r.minResult.dist||n<r.minResult.dist)&&r.minResult.set(e,o,n,a,l,null,i,s),(null==r.maxResult.priority||l>=r.maxResult.priority)&&(null==r.maxResult.dist||n>r.maxResult.dist)&&r.maxResult.set(e,o,n,a,l,null,i,s)}},p.customTransformation),this.minResult.geometryId===i&&n.mat4d.set(this._transform,this.minResult.transformation),this.maxResult.geometryId===i&&n.mat4d.set(this._transform,this.maxResult.transformation))}},e.DEFAULT_TOLERANCE=1e-5,e}(),d=function(){function e(e,t){this.transformation=n.mat4d.identity(),this.normal=n.vec3d.create(),this.init(e,t)}return e.prototype.getIntersectionPoint=function(e){return null!=this.dist&&(n.vec3d.lerp(this.p0,this.p1,this.dist,e),!0)},e.prototype.getTransformedNormal=function(e){return n.vec3d.set(this.normal,f),f[3]=0,n.mat4d.multiplyVec4(this.transformation,f),n.vec3d.set(f,e),n.vec3d.normalize(e),e},e.prototype.set=function(e,t,r,o,a,s,l,u){e instanceof i&&(e={type:"stage",obj:e}),this.dist=r,n.vec3d.set(o,this.normal),this.target=e,this.name=t,this.priority=a,this.center=s?n.vec3d.create(s):null,this.geometryId=l,this.triangleNr=u},e.prototype.copyFrom=function(e){this.p0=e.p0,this.p1=e.p1,this.dist=e.dist,this.target=e.target,this.name=e.name,this.priority=e.priority,this.center=e.center?n.vec3d.create(e.center):null,this.geometryId=e.geometryId,this.triangleNr=e.triangleNr,this.intersector=e.intersector,n.vec3d.set(e.normal,this.normal)},e.prototype.setIntersector=function(e){this.intersector=e},e.prototype.init=function(e,t){this.dist=void 0,this.target=void 0,this.name=void 0,this.priority=void 0,this.center=null,this.geometryId=null,this.triangleNr=null,this.intersector="Stage",this.p0=e,this.p1=t},e}(),p=function(){function e(e,t,r){this.original=e,this.update=t,this.dirty=!0,this.transform=r()}return e.prototype.invalidate=function(){this.dirty=!0},Object.defineProperty(e.prototype,"value",{get:function(){return this.dirty&&(this.update(this.original.value,this.transform),this.dirty=!1),this.transform},enumerable:!0,configurable:!0}),e}(),f=n.vec4d.create();return c}.apply(null,n))||(e.exports=i)},1579:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(342),r(340)],void 0===(i=function(e,t,r,n){function i(e){return n.create(function(t,r){e.oncomplete=function(){return t()},e.onerror=function(){return r(e.error)},e.onabort=function(){return r(e.error)}})}function o(e){return n.create(function(t,r){"done"===e.readyState?null!=e.error?r(e.error):t(e.result):(e.onsuccess=function(){return t(e.result)},e.onerror=function(){return r(e.error)})})}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,r){this._db=null,this._quotaReductionPromise=null,this._gcCounter=0,this._hit=0,this._miss=0,this._destroyed=!1,this.gcFrequency=50,this.maxByteSize=1073741824,this.quotaReductionFactor=.2,this._dbName=e,this._storeName=t,this._version=r}return e.prototype.init=function(){var e=this;return n.resolve().then(function(){var t=indexedDB.open(e._dbName,e._version);return t.onupgradeneeded=function(r){var n=t.result,i=t.transaction,o=n.objectStoreNames.contains(e._storeName)?i.objectStore(e._storeName):n.createObjectStore(e._storeName),a=n.objectStoreNames.contains("last_access")?i.objectStore("last_access"):n.createObjectStore("last_access");a.indexNames.contains("date")||a.createIndex("date","date",{unique:!1}),a.indexNames.contains("byteSize")||a.createIndex("byteSize","byteSize",{unique:!1}),r.oldVersion<e._version&&(o.clear(),a.clear())},o(t)}).then(function(t){e._destroyed?t.close():e._db=t})},e.prototype.destroy=function(){this._db&&(this._db.close(),this._db=null),this._destroyed=!0},e.prototype.getHitRate=function(){return this._hit/(this._hit+this._miss)},e.prototype.put=function(e,t){var i=this;return null==this._db?n.reject(new r("indexedb:not-initialized","IndexedDB Cache is not initialized")):(null!=this._quotaReductionPromise?this._quotaReductionPromise:n.resolve()).then(function(){return i._put(e,t)}).catch(function(r){if("QuotaExceededError"===r.name)return null==i._quotaReductionPromise&&(i._quotaReductionPromise=i._getCacheSize().then(function(e){return i._removeLeastRecentlyAccessed(t.byteSize+Math.ceil(e*i.quotaReductionFactor))}),i._quotaReductionPromise.always(function(){i._quotaReductionPromise=null})),i._quotaReductionPromise.then(function(){return i._put(e,t)});throw r}).then(function(){--i._gcCounter<0&&(i._gcCounter=i.gcFrequency,i._getCacheSize().then(function(e){return i._removeLeastRecentlyAccessed(e-i.maxByteSize)}))})},e.prototype.get=function(e){var t=this;return null==this._db?n.resolve(null):n.resolve().then(function(){return o(t._db.transaction(t._storeName,"readonly").objectStore(t._storeName).get(e))}).then(function(r){return null==r?++t._miss:(++t._hit,t._db.transaction("last_access","readwrite").objectStore("last_access").put({date:(new Date).getTime(),byteSize:r.byteSize},e)),r}).catch(function(e){return++t._miss,null})},e.prototype.remove=function(e){var t=this;return null==this._db?n.resolve():n.resolve().then(function(){var r=t._db.transaction([t._storeName,"last_access"],"readwrite"),n=r.objectStore(t._storeName),o=r.objectStore("last_access");return n.delete(e),o.delete(e),i(r)})},e.prototype._put=function(e,t){var r=this._db.transaction([this._storeName,"last_access"],"readwrite");return r.objectStore(this._storeName).put(t,e),r.objectStore("last_access").put({date:(new Date).getTime(),byteSize:t.byteSize},e),i(r)},e.prototype._removeLeastRecentlyAccessed=function(e){if(!(e<=0)){var t=this._db.transaction([this._storeName,"last_access"],"readwrite"),r=t.objectStore(this._storeName),n=t.objectStore("last_access"),o=0,a=n.index("date").openCursor(null,"next");return a.onsuccess=function(t){var i=a.result;null!=i&&(null!=i.value.byteSize&&(o+=i.value.byteSize),r.delete(i.primaryKey),n.delete(i.primaryKey),o<e&&i.continue())},i(t)}},e.prototype._getCacheSize=function(){var e=this._db.transaction("last_access"),t=e.objectStore("last_access"),r=0,n=t.index("byteSize").openKeyCursor();return n.onsuccess=function(e){var t=n.result;if(t){var i=t.key;null!=i&&(r+=i),t.continue()}},i(e).then(function(){return r})},e}();t.IDBCache=a,t.whenTransaction=i,t.whenRequest=o}.apply(null,n))||(e.exports=i)},331:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(345),r(338),r(336),r(387),r(384),r(667),r(638),r(351),r(435),r(358),r(342),r(366),r(354),r(348),r(339),r(343),r(428),r(340),r(350),r(337),r(361),r(619),r(360),r(625),r(399),r(668),r(437),r(434),r(431),r(441),r(425),r(392),r(432),r(680),r(656),r(457),r(660),r(466),r(681),r(396),r(451),r(429),r(663),r(458),r(682),r(421),r(633),r(606),r(732),r(363),r(444),r(394),r(418),r(447)],void 0===(i=function(e,t,n,i,o,a,s,l,u,c,d,p,f,h,m,v,g,y,b,_,x,w,S,T,E,C,O,P,A,I,R,M,D,F,L,N,j,V,U,B,z,k,G,H,q,W,X,Q,Y,J,Z,K,$,ee,te,re){function ne(e){return e&&null!=e.applyEdits}function ie(e){return e&&oe(e)}function oe(e){return e&&e.isInstanceOf&&e.isInstanceOf(p)}function ae(e,t,r){return!!(e&&e.hasOwnProperty(t)?e[t]:r)}var se=v({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),le="FeatureLayer",ue=y.getLogger("esri.layers.FeatureLayer");return function(e){function t(t){var r=e.call(this)||this;return r._handles=new h,r.featureReduction=null,r.capabilities=null,r.copyright=null,r.displayField=null,r.definitionExpression=null,r.dynamicDataSource=null,r.editFieldsInfo=null,r.elevationInfo=null,r.fields=null,r.fullExtent=null,r.gdbVersion=null,r.geometryType=null,r.hasM=void 0,r.hasZ=void 0,r.heightModelInfo=null,r.historicMoment=null,r.isTable=!1,r.labelsVisible=!0,r.labelingInfo=null,r.layerId=void 0,r.legendEnabled=!0,r.maxRecordCount=void 0,r.tileMaxRecordCount=void 0,r.minScale=0,r.maxScale=0,r.objectIdField=null,r.operationalLayerType="ArcGISFeatureLayer",r.popupEnabled=!0,r.popupTemplate=null,r.relationships=null,r.returnM=void 0,r.returnZ=void 0,r.screenSizePerspectiveEnabled=!0,r.serviceDefinitionExpression=null,r.spatialReference=E.WGS84,r.templates=null,r.timeInfo=null,r.title=null,r.sublayerTitleMode="item-title",r.trackIdField=null,r.type="feature",r.typeIdField=null,r.types=null,r.indexes=new(p.ofType(N.FeatureIndex)),r.userIsAdmin=!1,r.version=void 0,r.visible=!0,r}return i(t,e),t.prototype.normalizeCtorArgs=function(e,t){return"string"==typeof e?n({url:e},t):e},t.prototype.load=function(){var e=this;if(!(this.portalItem&&this.portalItem.loaded&&this.source)){var t=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection"]}).always(function(){if(e.url&&null==e.layerId&&/FeatureServer|MapServer\/*$/i.test(e.url))return e._fetchFirstLayerId().then(function(t){null!=t&&(e.layerId=t)})}).then(function(){if(!e.url&&!e._hasMemorySource())throw new f("feature-layer:missing-url-or-source","Feature layer must be created with either a url or a source");return e.createGraphicsSource().then(function(t){return e._initLayerProperties(t)})});return this.addResolvingPromise(t),this.when()}this.addResolvingPromise(this.createGraphicsSource().then(function(t){return e._initLayerProperties(t)}))},Object.defineProperty(t.prototype,"allRenderers",{get:function(){return this._getAllRenderers(this.renderer)},enumerable:!0,configurable:!0}),t.prototype.readCapabilities=function(e,t){return t=t.layerDefinition||t,{data:this._readDataCapabilities(t),operations:this._readOperationsCapabilities(t.capabilities||e,t),query:this._readQueryCapabilities(t),queryRelated:this._readQueryRelatedCapabilities(t),editing:this._readEditingCapabilities(t)}},Object.defineProperty(t.prototype,"hasAttachments",{get:function(){return ue.warn("FeatureLayer.hasAttachments is deprecated. Use FeatureLayer.capabilities.data.supportsAttachment instead."),this.hasService&&this._get("hasAttachments")||!1},enumerable:!0,configurable:!0}),t.prototype.readIsTable=function(e,t){return"Table"===(t=t&&t.layerDefinition||t).type},Object.defineProperty(t.prototype,"hasService",{get:function(){return!this._hasMemorySource()},enumerable:!0,configurable:!0}),t.prototype.readMinScale=function(e,t){return t.effectiveMinScale||e||0},t.prototype.readMaxScale=function(e,t){return t.effectiveMaxScale||e||0},t.prototype.readObjectIdFieldFromService=function(e,t){if((t=t.layerDefinition||t).objectIdField)return t.objectIdField;if(t.fields)for(var r=0,n=t.fields;r<n.length;r++){var i=n[r];if("esriFieldTypeOID"===i.type)return i.name}},Object.defineProperty(t.prototype,"outFields",{get:function(){var e=this,t=this._userOutFields,r=this.requiredFields;return t=t&&t.slice(0),r=r&&r.slice(0),t?-1===t.indexOf("*")&&r.forEach(function(e){-1===t.indexOf(e)&&t.push(e)}):t=r,-1!==t.indexOf("*")?t=["*"]:this.loaded&&(t=(t=(t=t.filter(function(t){var r=!!e.getField(t);return t&&!r&&ue.error("[outFields] Invalid field: ",t),r},this)).map(function(t){return e.getField(t).name},this)).filter(function(e,t,r){return r.indexOf(e)===t})),t},set:function(e){var t=this,r=this.requiredFields&&this.requiredFields.slice(0);e?-1===e.indexOf("*")&&r.forEach(function(t){-1===e.indexOf(t)&&e.push(t)}):e=r,this.loaded&&(e=(e=e.filter(function(e){var r="*"===e||!!t.getField(e,t.fields);return e&&!r&&ue.error("[outFields] Invalid field: ",e),r},this)).map(function(e){return"*"===e?e:t.getField(e,t.fields).name},this)),this._userOutFields=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parsedUrl",{get:function(){var e=this.url?x.urlToObject(this.url):null;if(null!=e)if(null!=this.layerId)e.path=x.join(e.path,this.layerId.toString());else if(null!=this.dynamicDataSource){var t={source:W.sourceToJSON(this.dynamicDataSource)};e.query={layer:JSON.stringify(t)}}return e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderer",{set:function(e){var t=this._getAllRenderers(e);G.fixRendererFields(t,this.fields),this._set("renderer",e)},enumerable:!0,configurable:!0}),t.prototype.readRenderer=function(e,t,r){var n,i,o=(t=t.layerDefinition||t).drawingInfo&&t.drawingInfo.renderer||void 0;if(o)(n=Q.read(o,t,r)||void 0)||ue.error("Failed to create renderer",{rendererDefinition:t.drawingInfo.renderer,layer:this,context:r});else if(t.defaultSymbol)K.read(t.defaultSymbol,t,r),t.types&&t.types.length?(n=new u.UniqueValueRenderer({defaultSymbol:i,field:t.typeIdField}),t.types.forEach(function(e){o.addUniqueValueInfo(e.id,K.read(e.symbol,e,r))})):n=new u.SimpleRenderer({symbol:i});else if("Table"!==t.type){switch(t.geometryType){case"esriGeometryPoint":case"esriGeometryMultipoint":i=new d.SimpleMarkerSymbol;break;case"esriGeometryPolyline":i=new d.SimpleLineSymbol;break;case"esriGeometryPolygon":i=new d.SimpleFillSymbol}n=i&&new u.SimpleRenderer({symbol:i})}return n},t.prototype.writeRenderer=function(e,t,r,n){Q.writeTarget(e,t,r,n)},Object.defineProperty(t.prototype,"requiredFields",{get:function(){var e=this.timeInfo,t=[],r=[],n=[this.objectIdField,this.typeIdField,this.editFieldsInfo&&this.editFieldsInfo.creatorField,this.editFieldsInfo&&this.editFieldsInfo.creationDateField,this.editFieldsInfo&&this.editFieldsInfo.editorField,this.editFieldsInfo&&this.editFieldsInfo.editDateField,e&&e.startTimeField,e&&e.endTimeField,this.trackIdField];this.allRenderers.forEach(function(e){t=t.concat(e.requiredFields)}),this.labelingInfo&&this.labelingInfo.length&&this.labelingInfo.forEach(function(e){r=r.concat(e.requiredFields)}),r=r.map(function(e){return e.replace(/['"]+/g,"")}),n=(n=n.concat(t)).concat(r);var i=this.elevationInfo&&this.elevationInfo.featureExpressionInfo;return i&&(n=n.concat(i.requiredFields)),this.popupTemplate&&(n=n.concat(this.popupTemplate.requiredFields)),n.filter(function(e,t,r){return!!e&&r.indexOf(e)===t&&"function"!=typeof e})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"source",{set:function(e){var t=this._get("source");t!==e&&(ie(t)&&this._resetMemorySource(t),ie(e)&&this._initMemorySource(e),this._set("source",e))},enumerable:!0,configurable:!0}),t.prototype.castSource=function(e){return e?Array.isArray(e)||oe(e)?new P.default({layer:this,items:e}):e:null},t.prototype.readSource=function(e,t){var r=ee.fromJSON(t.featureSet);return new P.default({layer:this,items:r&&r.features||[]})},t.prototype.readTemplates=function(e,t){var r=t.editFieldsInfo,n=r&&r.creatorField,i=r&&r.editorField;return e=e&&e.map(function(e){return B.fromJSON(e)}),this._fixTemplates(e,n),this._fixTemplates(e,i),e},t.prototype.readTitle=function(e,t){var r=t.layerDefinition&&t.layerDefinition.name||t.name,n=t.title||t.layerDefinition&&t.layerDefinition.title;if(r){var i=this.portalItem&&this.portalItem.title;if("item-title"===this.sublayerTitleMode)return this.url?F.titleFromUrlAndName(this.url,r):r;var o=r||this.url&&F.parse(this.url).title;if(!o)return;return"item-title-and-service-name"===this.sublayerTitleMode&&i&&(o=i+" - "+o),F.cleanTitle(o)}if("item-title"===this.sublayerTitleMode&&n)return n},t.prototype.readTitleFromWebMap=function(e,t){return t.title||t.layerDefinition&&t.layerDefinition.name},t.prototype.readTypeIdField=function(e,t){if(e=(t=t.layerDefinition||t).typeIdField){var r=this.getField(e,t.fields);r&&(e=r.name)}return e},t.prototype.readTypes=function(e,t){var r=this;e=(t=t.layerDefinition||t).types;var n=t.editFieldsInfo,i=n&&n.creatorField,o=n&&n.editorField;return e&&e.map(function(e){return e=z.fromJSON(e),r._fixTemplates(e.templates,i),r._fixTemplates(e.templates,o),e})},Object.defineProperty(t.prototype,"url",{set:function(e){var t=F.sanitizeUrlWithLayerId(this,e,ue);this._set("url",t.url),null!=t.layerId&&this._set("layerId",t.layerId)},enumerable:!0,configurable:!0}),t.prototype.writeUrl=function(e,t,r,n){F.writeUrlWithLayerId(this,e,t)},t.prototype.readVersion=function(e,t){return(t=t.layerDefinition||t).currentVersion?t.currentVersion:t.hasOwnProperty("capabilities")||t.hasOwnProperty("drawingInfo")||t.hasOwnProperty("hasAttachments")||t.hasOwnProperty("htmlPopupType")||t.hasOwnProperty("relationships")||t.hasOwnProperty("timeInfo")||t.hasOwnProperty("typeIdField")||t.hasOwnProperty("types")?10:9.3},t.prototype.readVisible=function(e,t){return t.layerDefinition&&null!=t.layerDefinition.defaultVisibility?!!t.layerDefinition.defaultVisibility:null!=t.visibility?!!t.visibility:void 0},t.prototype.addAttachment=function(e,t){var r=this;return this.load().then(function(){return r._checkAttachmentSupport(e)}).then(function(){return"addAttachment"in r.source?r.source.addAttachment(e,t):_.reject(new f(le,"Layer source does not support addAttachment capability"))})},t.prototype.updateAttachment=function(e,t,r){var n=this;return this.load().then(function(){return n._checkAttachmentSupport(e)}).then(function(){return"updateAttachment"in n.source?n.source.updateAttachment(e,t,r):_.reject(new f(le,"Layer source does not support updateAttachment capability"))})},t.prototype.applyEdits=function(e){var t,r,n=this,i={edits:e,result:_.create(function(e,n){t=e,r=n})};return this.emit("apply-edits",i),this.load().then(function(){return ne(n.source)?n._processApplyEditsParams(e):_.reject(new f(le,"Layer source does not support applyEdits capability"))}).then(function(e){if(ne(n.source))return n.source.applyEdits(e).then(function(e){var r=function(e){return e.filter(function(e){return!e.error}).map(g.clone)},i={addedFeatures:r(e.addFeatureResults),updatedFeatures:r(e.updateFeatureResults),deletedFeatures:r(e.deleteFeatureResults)};return(i.addedFeatures.length||i.updatedFeatures.length||i.deletedFeatures.length)&&n.emit("edits",i),t(i),e})}).catch(function(e){throw r(e),e})},t.prototype.on=function(e,t){return this.inherited(arguments)},t.prototype.createGraphicsSource=function(){var e=this;return this._hasMemorySource()?(this.emit("graphics-source-create",{graphicsSource:this.source}),this.source.load()):_.create(function(e){return r.e(86).then(function(){var t=[r(816)];e.apply(null,t)}.bind(this)).catch(r.oe)}).then(function(t){return new t.default({layer:e}).load()}).then(function(t){return e.emit("graphics-source-create",{graphicsSource:t}),t})},t.prototype.createGraphicsController=function(e){var t=this,i=e.layerView,o=p.ofType(s),a=this.source,l=ie(a),u=n({},e.options,{layer:this,layerView:i,graphics:l?a:new o});return(l?_.create(function(e){return r.e(47).then(function(){var t=[r(805)];e.apply(null,t)}.bind(this)).catch(r.oe)}):"2d"===i.view.type?_.create(function(e){return r.e(85).then(function(){var t=[r(817)];e.apply(null,t)}.bind(this)).catch(r.oe)}):_.create(function(e){return r.e(18).then(function(){var t=[r(791)];e.apply(null,t)}.bind(this)).catch(r.oe)})).then(function(e){return new e(u)}).then(function(e){return t.emit("graphics-controller-create",{graphicsController:e}),e.when()})},t.prototype.createQuery=function(){var e=new te,t=this.get("capabilities.data");return e.gdbVersion=this.gdbVersion,e.historicMoment=this.historicMoment,e.returnGeometry=!0,t&&(t.supportsZ&&null!=this.returnZ&&(e.returnZ=this.returnZ),t.supportsM&&null!=this.returnM&&(e.returnM=this.returnM)),e.outFields=this.outFields,e.where=this.definitionExpression||"1=1",e.multipatchOption="multipatch"===this.geometryType?"xyFootprint":null,e},t.prototype.deleteAttachments=function(e,t){var r=this;return this.load().then(function(){return r._checkAttachmentSupport(e)}).then(function(){return"deleteAttachments"in r.source?r.source.deleteAttachments(e,t):_.reject(new f(le,"Layer source does not support deleteAttachments capability"))})},t.prototype.getFeatureType=function(e){var t=this.typeIdField,r=this.types;if(!t||!e)return null;var n=e.attributes?e.attributes[t]:void 0;if(null==n)return null;var i=null;return r.some(function(e){var t=e.id;return null!=t&&(t.toString()===n.toString()&&(i=e),!!i)}),i},t.prototype.getFieldDomain=function(e,t){var r,n=this,i=!1,o=t&&t.feature,a=o&&o.attributes,s=this.typeIdField&&a&&a[this.typeIdField];return null!=s&&this.types&&(i=this.types.some(function(t){return t.id==s&&((r=t.domains&&t.domains[e])&&"inherited"===r.type&&(r=n._getLayerDomain(e)),!0)})),i||r||(r=this._getLayerDomain(e)),r},t.prototype.getField=function(e,t){var r=this.processing?this.fields.concat(this.processing.fields):this.fields;return G.getField(e,t||r)},t.prototype.graphicChanged=function(e){this.emit("graphic-update",e)},t.prototype.queryAttachments=function(e){var t=this;return this.load().then(function(){if(!t.get("capabilities.data.supportsAttachment"))return _.reject(new f(le,"this layer doesn't support attachments"));var r=e.attachmentTypes,n=e.objectIds,i=e.globalIds,o=e.num,a=e.size,s=e.start,l=e.definitionExpression;if(!t.get("capabilities.query.supportsAttachments")){var u=n&&n.length>1,c=r&&r.length,d=i&&i.length,p=a&&a.length;if(u||c||d||p||o||s||l)return _.reject(new f(le,"when 'supportsQueryAttachments' is false, only objectIds of length 1 are supported",e))}return n&&n.length||l?"queryAttachments"in t.source?t.source.queryAttachments(e):_.reject(new f(le,"Layer source does not support queryAttachments capability",e)):_.reject(new f(le,"objectIds or definitionExpression are required to perform attachment query",e))})},t.prototype.queryFeatures=function(e,t){var r=this;return this.load().then(function(){return r.source.queryFeatures(e||r.createQuery(),t)}).then(function(e){if(e&&e.features)for(var t=0,n=e.features;t<n.length;t++){var i=n[t];i.layer=i.sourceLayer=r}return e})},t.prototype.queryFeaturesJSON=function(e,t){var r=this;return this.load().then(function(){if(!r.source.queryFeaturesJSON)return _.reject(new f(le,"Layer source does not support queryFeaturesJSON capability"))}).then(function(){return r.source.queryFeaturesJSON(e||r.createQuery(),t)})},t.prototype.queryObjectIds=function(e,t){var r=this;return this.load().then(function(){return r.source.queryObjectIds?r.source.queryObjectIds(e||r.createQuery(),t):_.reject(new f(le,"Layer source does not support queryObjectIds capability"))})},t.prototype.queryFeatureCount=function(e,t){var r=this;return this.load().then(function(){return r.source.queryFeatureCount?r.source.queryFeatureCount(e||r.createQuery(),t):_.reject(new f(le,"Layer source does not support queryFeatureCount capability"))})},t.prototype.queryExtent=function(e,t){var r=this;return this.load().then(function(){return r.source.queryExtent?r.source.queryExtent(e||r.createQuery(),t):_.reject(new f(le,"Layer source does not support queryExtent capability"))})},t.prototype.queryRelatedFeatures=function(e){var t=this;return this.load().then(function(){return"queryRelatedFeatures"in t.source?t.source.queryRelatedFeatures(e):_.reject(new f(le,"Layer source does not support queryRelatedFeatures capability"))})},t.prototype.read=function(e,t){var r=e.featureCollection;if(r){var n=r.layers;n&&1===n.length&&(this.inherited(arguments,[n[0],t]),null!=r.showLegend&&this.inherited(arguments,[{showLegend:r.showLegend},t]))}return this.inherited(arguments,[e,t]),this},t.prototype.write=function(e,t){if(t&&"web-scene"===t.origin&&t.messages){if(!this.url)return t.messages.push(new f("layer:unsupported","Layers ("+this.title+", "+this.id+") of type '"+this.declaredClass+"' require a url to a service to be written to web scenes",{layer:this})),null;if(this.isTable)return t.messages.push(new f("layer:unsupported","Layers ("+this.title+", "+this.id+") of type '"+this.declaredClass+"' using a Table source cannot written to web scenes",{layer:this})),null}return this.inherited(arguments)},t.prototype.importLayerViewModule=function(e){switch(e.type){case"2d":return m("esri-featurelayer-webgl")&&m("esri-webgl")?_.create(function(e){return r.e(32).then(function(){var t=[r(806)];e.apply(null,t)}.bind(this)).catch(r.oe)}):_.create(function(e){return Promise.all([r.e(9),r.e(15),r.e(38)]).then(function(){var t=[r(807)];e.apply(null,t)}.bind(this)).catch(r.oe)});case"3d":return _.create(function(e){return Promise.all([r.e(4),r.e(6),r.e(8),r.e(7),r.e(61)]).then(function(){var t=[r(818)];e.apply(null,t)}.bind(this)).catch(r.oe)})}},t.prototype._checkAttachmentSupport=function(e){var t=e.attributes,r=this.objectIdField;return this.get("capabilities.data.supportsAttachment")?e?t?t[r]?void 0:_.reject(new f(le,"feature is missing the identifying attribute "+r)):_.reject(new f(le,"'attributes' are required on a feature to query attachments")):_.reject(new f(le,"A feature is required to add/delete/update attachments")):_.reject(new f(le,"this layer doesn't support attachments"))},t.prototype._getLayerDomain=function(e){if(!this.fields)return null;var t=null;return this.fields.some(function(r){return r.name===e&&(t=r.domain),!!t}),t},t.prototype._fetchFirstLayerId=function(){return c(this.url,{query:{f:"json"},responseType:"json"}).then(function(e){var t=e.data;if(t&&Array.isArray(t.layers)&&t.layers.length>0)return t.layers[0].id})},t.prototype._initLayerProperties=function(e){return this._set("source",e),e.layerDefinition&&this.read(e.layerDefinition,{origin:"service",url:this.parsedUrl}),this._verifySource(),this._verifyFields(),G.fixRendererFields(this._getAllRenderers(this.renderer),this.fields),Y.loadStyleRenderer(this,{origin:"service"})},t.prototype._getAllRenderers=function(e){if(!e)return[];var t=[];return[e,e.trackRenderer,e.observationRenderer,e.latestObservationRenderer].forEach(function(e){e&&(t.push(e),e.rendererInfos&&e.rendererInfos.forEach(function(e){e.renderer&&t.push(e.renderer)}))}),t},t.prototype._verifyFields=function(){var e=this.parsedUrl&&this.parsedUrl.path||"undefined";this.objectIdField||console.log("FeatureLayer: 'objectIdField' property is not defined (url: "+e+")"),this.isTable||this._hasMemorySource()||-1!==e.search(/\/FeatureServer\//i)||this.fields&&this.fields.some(function(e){return"geometry"===e.type})||console.log("FeatureLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: "+e+")")},t.prototype._fixTemplates=function(e,t){e&&e.forEach(function(e){var r=e.prototype&&e.prototype.attributes;r&&t&&delete r[t]})},t.prototype._verifySource=function(){if(this._hasMemorySource()){if(this.url)throw new f("feature-layer:mixed-source-and-url","FeatureLayer cannot be created with both an in-memory source and a url")}else{if(this.isTable)throw new f("feature-layer:source-type-not-supported","The table feature service type is not yet supported",{sourceType:"Table"});if(!this.url)throw new f("feature-layer:source-or-url-required","FeatureLayer requires either a url, a valid portal item or a source")}},t.prototype._initMemorySource=function(e){var t=this;e.forEach(function(e){e.layer=t,e.sourceLayer=t}),this._handles.add([e.on("after-add",function(e){e.item.layer=t,e.item.sourceLayer=t}),e.on("after-remove",function(e){e.item.layer=null,e.item.sourceLayer=null})],"fl-source")},t.prototype._resetMemorySource=function(e){e.forEach(function(e){e.layer=null,e.sourceLayer=null}),this._handles.remove("fl-source")},t.prototype._hasMemorySource=function(){return!(this.url||!this.source)},t.prototype._readDataCapabilities=function(e){return{supportsAttachment:ae(e,"hasAttachments",!1),supportsM:ae(e,"hasM",!1),supportsZ:ae(e,"hasZ",!1)}},t.prototype._readOperationsCapabilities=function(e,t){var r=e?e.toLowerCase().split(",").map(function(e){return e.trim()}):[],n=-1!==r.indexOf("editing"),i=n&&-1!==r.indexOf("create"),o=n&&-1!==r.indexOf("delete"),a=n&&-1!==r.indexOf("update");return n&&!(i||o||a)&&(i=o=a=!0),{supportsCalculate:ae(t,"supportsCalculate",!1),supportsTruncate:ae(t,"supportsTruncate",!1),supportsValidateSql:ae(t,"supportsValidateSql",!1),supportsAdd:i,supportsDelete:o,supportsEditing:n,supportsQuery:-1!==r.indexOf("query"),supportsResizeAttachments:ae(t,"supportsAttachmentsResizing",!1),supportsUpdate:a}},t.prototype._readQueryCapabilities=function(e){var t=e.advancedQueryCapabilities,r=e.ownershipBasedAccessControlForFeatures,n=e.archivingInfo,i=(e.supportedQueryFormats||"").split(",").reduce(function(e,t){var r=t.toLowerCase().trim();return r&&e.add(r),e},new Set);return{supportsAttachments:ae(t,"supportsQueryAttachments",!1),supportsStatistics:ae(t,"supportsStatistics",e.supportsStatistics),supportsCentroid:ae(t,"supportsReturningGeometryCentroid",!1),supportsDistance:ae(t,"supportsQueryWithDistance",!1),supportsDistinct:ae(t,"supportsDistinct",e.supportsAdvancedQueries),supportsExtent:ae(t,"supportsReturningQueryExtent",!1),supportsGeometryProperties:ae(t,"supportsReturningGeometryProperties",!1),supportsHavingClause:ae(t,"supportsHavingClause",!1),supportsOrderBy:ae(t,"supportsOrderBy",e.supportsAdvancedQueries),supportsPagination:ae(t,"supportsPagination",!1),supportsQuantization:ae(e,"supportsCoordinatesQuantization",!1),supportsResultType:ae(t,"supportsQueryWithResultType",!1),supportsSqlExpression:ae(t,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:ae(e,"useStandardizedQueries",!1),supportsQueryByOthers:ae(r,"allowOthersToQuery",!0),supportsHistoricMoment:ae(n,"supportsQueryWithHistoricMoment",!1),supportsFormatPBF:i.has("pbf")}},t.prototype._readQueryRelatedCapabilities=function(e){var t=e.advancedQueryCapabilities,r=ae(t,"supportsAdvancedQueryRelated",!1);return{supportsPagination:ae(t,"supportsQueryRelatedPagination",!1),supportsCount:r,supportsOrderBy:r}},t.prototype._readEditingCapabilities=function(e){var t=e.ownershipBasedAccessControlForFeatures;return{supportsGeometryUpdate:ae(e,"allowGeometryUpdates",!0),supportsGlobalId:ae(e,"supportsApplyEditsWithGlobalIds",!1),supportsRollbackOnFailure:ae(e,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:ae(e,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:ae(e,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:ae(t,"allowAnonymousToDelete",!0),supportsDeleteByOthers:ae(t,"allowOthersToDelete",!0),supportsUpdateByAnonymous:ae(t,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:ae(t,"allowOthersToUpdate",!0)}},t.prototype._processApplyEditsParams=function(e){var t="'addFeatures', 'updateFeatures' or 'deleteFeatures' parameter is required",r="feature-layer:missing-parameters";if(!e)return _.reject(new f(r,t));if((e=n({},e)).addFeatures=e.addFeatures||[],e.updateFeatures=e.updateFeatures||[],e.deleteFeatures=e.deleteFeatures||[],e.addFeatures.length||e.updateFeatures.length||e.deleteFeatures.length){var i=function(e){var t=new s;return t.geometry=e.geometry,t.attributes=e.attributes,t};return e.addFeatures=e.addFeatures.map(i),e.updateFeatures=e.updateFeatures.map(i),this._normalizeGeometries(e)}return _.reject(new f(r,t))},t.prototype._normalizeGeometries=function(e){var t=e.addFeatures,r=e.updateFeatures,n=t.concat(r).map(function(e){return e.geometry});return C.normalizeCentralMeridian(n).then(function(n){var i=t.length,o=r.length;return n.slice(0,i).forEach(function(t,r){e.addFeatures[r].geometry=t}),n.slice(i,i+o).forEach(function(t,r){e.updateFeatures[r].geometry=t}),e})},o([w.property({types:{key:"type",base:V.default,typeMap:{selection:U.default}},json:{origins:{"web-scene":{read:{source:"layerDefinition.featureReduction"},write:{target:"layerDefinition.featureReduction"}}}}})],t.prototype,"featureReduction",void 0),o([w.property({readOnly:!0,dependsOn:["loaded","renderer","fields"]})],t.prototype,"allRenderers",null),o([w.property({readOnly:!0})],t.prototype,"capabilities",void 0),o([w.reader("service","capabilities",["advancedQueryCapabilities","archivingInfo","supportsStatistics","supportsAdvancedQueries","hasAttachments","hasM","hasZ","supportsAttachmentsResizing","supportsCalculate","supportsTruncate","supportsValidateSql","supportsCoordinatesQuantization","useStandardizedQueries","ownershipBasedAccessControlForFeatures","allowGeometryUpdates","supportsApplyEditsWithGlobalIds","supportsRollbackOnFailureParameter","allowUpdateWithoutMValues","supportsAttachmentsByUploadId","capabilities","supportedQueryFormats"])],t.prototype,"readCapabilities",null),o([w.property({type:String,json:{read:{source:"layerDefinition.copyrightText"},origins:{service:{read:{source:"copyrightText"}}}}})],t.prototype,"copyright",void 0),o([w.property({type:String,json:{read:{source:"layerDefinition.displayField"},origins:{service:{read:{source:"displayField"}}}}})],t.prototype,"displayField",void 0),o([w.property({type:String,json:{origins:{service:{read:!1,write:!1}},read:{source:"layerDefinition.definitionExpression"},write:{target:"layerDefinition.definitionExpression"}}})],t.prototype,"definitionExpression",void 0),o([w.property({readOnly:!0,json:{read:K.read}})],t.prototype,"defaultSymbol",void 0),o([w.property()],t.prototype,"dynamicDataSource",void 0),o([w.property({readOnly:!0})],t.prototype,"editFieldsInfo",void 0),o([w.property({type:Z,json:{origins:{service:{read:{source:"elevationInfo"},write:{target:"elevationInfo",enabled:!1}}},read:{source:"layerDefinition.elevationInfo"},write:{target:"layerDefinition.elevationInfo"}}})],t.prototype,"elevationInfo",void 0),o([w.property({type:[k],json:{origins:{service:{read:!0}},read:{source:"layerDefinition.fields"}}})],t.prototype,"fields",void 0),o([w.property({type:S,json:{origins:{service:{read:{source:"extent"}}},read:{source:"layerDefinition.extent"}}})],t.prototype,"fullExtent",void 0),o([w.property()],t.prototype,"gdbVersion",void 0),o([w.property({json:{origins:{service:{read:se.read}},read:{source:"layerDefinition.geometryType",reader:se.read}}})],t.prototype,"geometryType",void 0),o([w.property({readOnly:!0,dependsOn:["loaded"],json:{origins:{service:{read:!0}},read:{source:"layerDefinition.hasAttachments"}}})],t.prototype,"hasAttachments",null),o([w.property({type:Boolean,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.hasM"}}})],t.prototype,"hasM",void 0),o([w.property({type:Boolean,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.hasZ"}}})],t.prototype,"hasZ",void 0),o([w.property({readOnly:!0,type:T})],t.prototype,"heightModelInfo",void 0),o([w.property({type:Date})],t.prototype,"historicMoment",void 0),o([w.property({json:{origins:{service:{read:!1},"portal-item":{read:!1}}}})],t.prototype,"id",void 0),o([w.property({readOnly:!0})],t.prototype,"isTable",void 0),o([w.reader("service","isTable",["type"]),w.reader("isTable",["layerDefinition.type"])],t.prototype,"readIsTable",null),o([w.property({dependsOn:["loaded","url","source"],readOnly:!0})],t.prototype,"hasService",null),o([w.property(L.labelsVisible)],t.prototype,"labelsVisible",void 0),o([w.property({type:[H],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:q.reader},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:q.reader},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],t.prototype,"labelingInfo",void 0),o([w.property({type:Number,json:{origins:{service:{read:{source:"id"}}},read:!1}})],t.prototype,"layerId",void 0),o([w.property({type:Boolean,json:{read:{source:"showLegend"},write:{target:"showLegend"}}})],t.prototype,"legendEnabled",void 0),o([w.property({type:Number,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.maxRecordCount"}}})],t.prototype,"maxRecordCount",void 0),o([w.property({type:Number,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.tileMaxRecordCount"}}})],t.prototype,"tileMaxRecordCount",void 0),o([w.property({type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.minScale"},write:{target:"layerDefinition.minScale"}}})],t.prototype,"minScale",void 0),o([w.reader("service","minScale",["minScale","effectiveMinScale"])],t.prototype,"readMinScale",null),o([w.property({type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.maxScale"},write:{target:"layerDefinition.maxScale"}}})],t.prototype,"maxScale",void 0),o([w.reader("service","maxScale",["maxScale","effectiveMaxScale"])],t.prototype,"readMaxScale",null),o([w.property({type:String})],t.prototype,"objectIdField",void 0),o([w.reader("objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"]),w.reader("service","objectIdField",["objectIdField","fields"])],t.prototype,"readObjectIdFieldFromService",null),o([w.property()],t.prototype,"operationalLayerType",void 0),o([w.property({dependsOn:["requiredFields"]})],t.prototype,"outFields",null),o([w.property({readOnly:!0,dependsOn:["layerId"]})],t.prototype,"parsedUrl",null),o([w.property(L.popupEnabled)],t.prototype,"popupEnabled",void 0),o([w.property({type:l,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],t.prototype,"popupTemplate",void 0),o([w.property({type:j})],t.prototype,"processing",void 0),o([w.property({type:[X],readOnly:!0})],t.prototype,"relationships",void 0),o([w.property({types:J.types,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}}},write:{target:"layerDefinition.drawingInfo.renderer"}}})],t.prototype,"renderer",null),o([w.reader("service","renderer",["drawingInfo.renderer","defaultSymbol","type"]),w.reader("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol","layerDefinition.type"])],t.prototype,"readRenderer",null),o([w.writer("renderer")],t.prototype,"writeRenderer",null),o([w.property({readOnly:!0,dependsOn:["allRenderers","labelingInfo","elevationInfo.featureExpressionInfo","popupTemplate.requiredFields"]})],t.prototype,"requiredFields",null),o([w.property({type:Boolean})],t.prototype,"returnM",void 0),o([w.property({type:Boolean})],t.prototype,"returnZ",void 0),o([w.property(L.screenSizePerspectiveEnabled)],t.prototype,"screenSizePerspectiveEnabled",void 0),o([w.property()],t.prototype,"source",null),o([w.cast("source")],t.prototype,"castSource",null),o([w.reader("portal-item","source",["featureSet"]),w.reader("web-map","source",["featureSet"])],t.prototype,"readSource",null),o([w.property({readOnly:!0,json:{origins:{service:{read:{source:"definitionExpression"}}}}})],t.prototype,"serviceDefinitionExpression",void 0),o([w.property({type:E,json:{origins:{service:{read:{source:"extent.spatialReference"}}},read:{source:"layerDefinition.extent.spatialReference"}}})],t.prototype,"spatialReference",void 0),o([w.property({type:[B]})],t.prototype,"templates",void 0),o([w.reader("templates",["editFieldsInfo","creatorField","editorField","templates"])],t.prototype,"readTemplates",null),o([w.property()],t.prototype,"timeInfo",void 0),o([w.property()],t.prototype,"title",void 0),o([w.reader("service","title",["name"]),w.reader("portal-item","title",["layerDefinition.title","layerDefinition.name","title"])],t.prototype,"readTitle",null),o([w.reader("web-map","title",["layerDefinition.name","title"])],t.prototype,"readTitleFromWebMap",null),o([w.property({type:String})],t.prototype,"sublayerTitleMode",void 0),o([w.property({type:String,readOnly:!0,json:{read:{source:"timeInfo.trackIdField"}}})],t.prototype,"trackIdField",void 0),o([w.property({json:{read:!1}})],t.prototype,"type",void 0),o([w.property({type:String,readOnly:!0})],t.prototype,"typeIdField",void 0),o([w.reader("service","typeIdField"),w.reader("typeIdField",["layerDefinition.typeIdField"])],t.prototype,"readTypeIdField",null),o([w.property({type:[z]})],t.prototype,"types",void 0),o([w.reader("service","types",["types"]),w.reader("types",["layerDefinition.types"])],t.prototype,"readTypes",null),o([w.property({type:p.ofType(N.FeatureIndex),readOnly:!0})],t.prototype,"indexes",void 0),o([w.property({type:String})],t.prototype,"url",null),o([w.writer("url")],t.prototype,"writeUrl",null),o([w.property({readOnly:!0})],t.prototype,"userIsAdmin",void 0),o([w.property({json:{origins:{"portal-item":{read:!1}}}})],t.prototype,"version",void 0),o([w.reader("service","version",["currentVersion","capabilities","drawingInfo","hasAttachments","htmlPopupType","relationships","timeInfo","typeIdField","types"]),w.reader("version",["layerDefinition.currentVersion","layerDefinition.capabilities","layerDefinition.drawingInfo","layerDefinition.hasAttachments","layerDefinition.htmlPopupType","layerDefinition.typeIdField","layerDefinition.types"])],t.prototype,"readVersion",null),o([w.property({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility"}}}}})],t.prototype,"visible",void 0),o([w.reader("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],t.prototype,"readVisible",null),o([a(0,w.cast($))],t.prototype,"queryAttachments",null),o([a(0,w.cast(te))],t.prototype,"queryFeatures",null),o([a(0,w.cast(te))],t.prototype,"queryFeaturesJSON",null),o([a(0,w.cast(te))],t.prototype,"queryObjectIds",null),o([a(0,w.cast(te))],t.prototype,"queryFeatureCount",null),o([a(0,w.cast(te))],t.prototype,"queryExtent",null),o([a(0,w.cast(re))],t.prototype,"queryRelatedFeatures",null),o([w.subclass("esri.layers.FeatureLayer")],t)}(w.declared(O,I,R,D,M,A,b))}.apply(null,n))||(e.exports=i)},349:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(344),r(622),r(364)],void 0===(i=function(e,t,r,n,i){function o(e,t){if(!e){var r=new Error("dummy");throw r.stack&&console.log(r.stack),new A(t)}}function a(e,t,n){r.mat4d.multiply(t,e,p),r.mat4d.inverse(p);for(var i=0;i<8;++i)r.mat4d.multiplyVec4(p,f[i],h),r.vec3d.set3(h[0]/h[3],h[1]/h[3],h[2]/h[3],n[i])}function s(e,t){n.plane.fromPoints(e[4],e[0],e[3],t[0]),n.plane.fromPoints(e[1],e[5],e[6],t[1]),n.plane.fromPoints(e[4],e[5],e[1],t[2]),n.plane.fromPoints(e[3],e[2],e[6],t[3]),n.plane.fromPoints(e[0],e[1],e[2],t[4]),n.plane.fromPoints(e[5],e[4],e[7],t[5])}function l(e){for(var t in e)return t}function u(e,t){e[12]=t[0],e[13]=t[1],e[14]=t[2]}function c(e,t){void 0===t&&(t=0);for(var r=0,n=0;n<4;n++)r+=e[t+n]*R[n];return r}function d(e){return e-Math.floor(e)}Object.defineProperty(t,"__esModule",{value:!0});var p=r.mat4d.create(),f=[r.vec4d.createFrom(-1,-1,-1,1),r.vec4d.createFrom(1,-1,-1,1),r.vec4d.createFrom(1,1,-1,1),r.vec4d.createFrom(-1,1,-1,1),r.vec4d.createFrom(-1,-1,1,1),r.vec4d.createFrom(1,-1,1,1),r.vec4d.createFrom(1,1,1,1),r.vec4d.createFrom(-1,1,1,1)],h=r.vec4d.create(),m=[r.vec3d.create(),r.vec3d.create(),r.vec3d.create(),r.vec3d.create(),r.vec3d.create(),r.vec3d.create(),r.vec3d.create(),r.vec3d.create()],v=r.vec3d.create(),g=r.vec3d.create(),y=r.vec3d.create(),b=r.vec3d.create(),_=r.vec3d.create(),x=r.vec3d.create(),w=r.vec3d.create(),S=r.vec3d.create(),T=r.vec3d.create(),E=r.vec3d.create(),C=r.vec3d.create(),O=r.vec3d.create(),P=r.vec3d.createFrom(0,0,0),A=function(){function e(e){this.message=e}return e.prototype.toString=function(){return"AssertException: "+this.message},e}();t.AssertException=A,t.VertexAttrConstants={POSITION:"position",NORMAL:"normal",NORMALCOMPRESSED:"normalCompressed",UV0:"uv0",AUXPOS1:"auxpos1",AUXPOS2:"auxpos2",COLOR:"color",SYMBOLCOLOR:"symbolColor",SIZE:"size",REGION:"region",COMPONENTINDEX:"componentIndex"},t.assert=o,t.verify=function(e,t){e||(console.log("Verify failed: "+t),console.log(new Error("dummy").stack))},t.encodeInt16=function(e){return i.clamp(Math.round(32767*e),-32767,32767)},t.encodeNormal=function(e,t){var r=Math.abs(e[0]),n=Math.abs(e[1]),i=1/(r+n+Math.abs(e[2])),o=r*i,a=n*i,s=Math.min(e[2]*i,0);t[0]=(e[0]<0?-1:1)*(o-s),t[1]=(e[1]<0?-1:1)*(a-s)},t.fallbackIfUndefined=function(e,t){return void 0===e?t:e},t.hex2rgb=function(e){return[((e=Math.floor(e))>>16&255)/255,(e>>8&255)/255,(255&e)/255]},t.rgb2hex=function(e){return"0x"+((i.clamp(Math.round(255*e[0]),0,255)<<16)+(i.clamp(Math.round(255*e[1]),0,255)<<8)+i.clamp(Math.round(255*e[2]),0,255)).toString(16)},t.dec2hex=function(e){var t=e.toString(16);return"00000000".substr(0,8-t.length)+t},t.raySphere=function(e,t,n,i,o){n=n||P;var a=r.vec3d.subtract(e,n,v),s=r.vec3d.dot(t,t),l=2*r.vec3d.dot(t,a),u=l*l-4*s*(r.vec3d.dot(a,a)-i*i);if(u<0)return!1;var c=Math.sqrt(u),d=(-l-c)/(2*s),p=(-l+c)/(2*s);return(d<0||p<d&&p>0)&&(d=p),d>0&&(o&&r.vec3d.add(e,r.vec3d.scale(t,d,O),o),!0)},t.rayTriangle3D=function(e,t,n,i,o,a,s,l,u){void 0===u&&(u=r.vec3d.create());var c=i[s]-n[a],d=i[s+1]-n[a+1],p=i[s+2]-n[a+2],f=o[l]-n[a],h=o[l+1]-n[a+1],m=o[l+2]-n[a+2],v=t[1]*m-h*t[2],g=t[2]*f-m*t[0],y=t[0]*h-f*t[1],b=c*v+d*g+p*y;if(b>-1e-5&&b<1e-5)return!1;var _=1/b,x=e[0]-n[a],w=e[1]-n[a+1],S=e[2]-n[a+2];if(u[1]=_*(x*v+w*g+S*y),u[1]<0||u[1]>1)return!1;var T=w*p-d*S,E=S*c-p*x,C=x*d-c*w;return u[2]=_*(t[0]*T+t[1]*E+t[2]*C),!(u[2]<0||u[1]+u[2]>1||(u[0]=_*(f*T+h*E+m*C),0))},t.rayBoxTest=function(e,t,r,n){var i,o=(r[0]-e[0])/t[0],a=(n[0]-e[0])/t[0];o>a&&(i=o,o=a,a=i);var s=(r[1]-e[1])/t[1],l=(n[1]-e[1])/t[1];if(s>l&&(i=s,s=l,l=i),o>l||s>a)return!1;s>o&&(o=s),l<a&&(a=l);var u=(r[2]-e[2])/t[2],c=(n[2]-e[2])/t[2];return u>c&&(i=u,u=c,c=i),!(o>c||u>a||(c<a&&(a=c),a<0))},t.rayRay2D=function(e,t,n,i,o,a){void 0===a&&(a=r.vec2d.create());var s=(i[o]-n[o])*(t[0]-e[0])-(i[0]-n[0])*(t[o]-e[o]),l=(i[0]-n[0])*(e[o]-n[o])-(i[o]-n[o])*(e[0]-n[0]);if(0===s)return!1;var u=l/s;return a[0]=e[0]+u*(t[0]-e[0]),a[1]=e[o]+u*(t[o]-e[o]),!0},t.matrixToFrustumPoints=a,t.matrixToFrustumPlanes=function(e,t,r,n){void 0===n&&(n=r,r=m),a(e,t,r),s(r,n)},t.frustumPointsToPlanes=s,t.project=function(e,t,n,i,a){a||(a=e),h[0]=e[0],h[1]=e[1],h[2]=e[2],h[3]=1,r.mat4d.multiplyVec4(t,h),a.length>2&&(a[2]=-h[2]),r.mat4d.multiplyVec4(n,h),o(0!==h[3]),a[0]=h[0]/h[3],a[1]=h[1]/h[3],a[2]=h[2]/h[3],a[0]=(.5*a[0]+.5)*i[2]+i[0],a[1]=(.5*a[1]+.5)*i[3]+i[1]},t.getFirstObjectKey=l,t.getFirstObjectValue=function(e){return e[l(e)]},t.objectEmpty=function(e){for(var t in e)return!1;return!0},t.logWithBase=function(e,t){return Math.log(e)/Math.log(t)},t.setMatrixTranslation=u,t.setMatrixTranslation3=function(e,t,r,n){e[12]=t,e[13]=r,e[14]=n},t.getMatrixTranslation=function(e,t){return void 0===t&&(t=r.vec3d.create()),t[0]=e[12],t[1]=e[13],t[2]=e[14],t},t.createTranslationMatrix=function(e,t){return u(e=r.mat4d.identity(e),t),e},t.isTranslationMatrix=function(e){return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&1===e[15]},t.fovx2fovy=function(e,t,r){return 2*Math.atan(r*Math.tan(.5*e)/t)},t.fovy2fovx=function(e,t,r){return 2*Math.atan(t*Math.tan(.5*e)/r)},t.fovx2fovd=function(e,t,r){return 2*Math.atan(Math.sqrt(t*t+r*r)*Math.tan(.5*e)/t)},t.fovy2fovd=function(e,t,r){return 2*Math.atan(Math.sqrt(t*t+r*r)*Math.tan(.5*e)/r)},t.fovd2fovx=function(e,t,r){return 2*Math.atan(t*Math.tan(.5*e)/Math.sqrt(t*t+r*r))},t.fovd2fovy=function(e,t,r){return 2*Math.atan(r*Math.tan(.5*e)/Math.sqrt(t*t+r*r))},t.lineLineDistanceSquared3D=function(e,t,n,o,a){var s=g,l=y;if(s[0]=e[0]-n[0],s[1]=e[1]-n[1],s[2]=e[2]-n[2],l[0]=o[0]-n[0],l[1]=o[1]-n[1],l[2]=o[2]-n[2],Math.abs(l[0])<1e-4&&Math.abs(l[1])<1e-4&&Math.abs(l[2])<1e-4)return a.success=!1,a;var u=b;if(u[0]=t[0]-e[0],u[1]=t[1]-e[1],u[2]=t[2]-e[2],Math.abs(u[0])<1e-4&&Math.abs(u[1])<1e-4&&Math.abs(u[2])<1e-4)return a.success=!1,a;var c=s[0]*l[0]+s[1]*l[1]+s[2]*l[2],d=l[0]*u[0]+l[1]*u[1]+l[2]*u[2],p=s[0]*u[0]+s[1]*u[1]+s[2]*u[2],f=l[0]*l[0]+l[1]*l[1]+l[2]*l[2],h=(u[0]*u[0]+u[1]*u[1]+u[2]*u[2])*f-d*d;if(Math.abs(h)<1e-4)return a.success=!1,a;var m=c*d-p*f,v=i.clamp(m/h,0,1),w=i.clamp((c+d*v)/f,0,1),S=_,T=x;S[0]=e[0]+v*u[0],S[1]=e[1]+v*u[1],S[2]=e[2]+v*u[2],T[0]=n[0]+w*l[0],T[1]=n[1]+w*l[1],T[2]=n[2]+w*l[2];var E=r.vec3d.dist2(S,T);return a.success=!0,a.dist2=E,a.pa=S,a.pb=T,a},t.pointLineSegmentDistanceSquared2D=function(e,t,n){var o=E,a=C,s=O,l=T,u=w,c=S;o[0]=t[0]-e[0],o[1]=t[1]-e[1],o[2]=0,a[0]=n[0]-e[0],a[1]=n[1]-e[1],a[2]=0,s[0]=n[0],s[1]=n[1],s[2]=0;var d=r.vec2d.dot(a,o),p=r.vec2d.dot(o,o),f=i.clamp(d/p,0,1);l[0]=o[0]*f,l[1]=o[1]*f,u[0]=e[0]+l[0],u[1]=e[1]+l[1],r.vec2d.subtract(s,u,c);var h=r.vec2d.dot(c,c),m=r.vec2d.dot(a,a),v=r.vec2d.dot(o,o),g=r.vec2d.dot(l,l);return(g>m||g>v)&&(h=Number.MAX_VALUE),h},t.packFloatRGBA=function(e,t,r){void 0===r&&(r=0);for(var n=i.clamp(e,0,M),o=0;o<4;o++)t[r+o]=Math.floor(256*d(n*I[o]))},t.unpackFloatRGBA=c;var I=[1,256,65536,16777216],R=[1/256,1/65536,1/16777216,1/4294967296],M=c(new Uint8ClampedArray([255,255,255,255]));t.inverseProjectionInfo=function(e,t,n,i,o){var a=e;0===e[11]?(i[0]=2/(t*a[0]),i[1]=2/(n*a[5]),i[2]=(1+a[12])/a[0],i[3]=(1+a[13])/a[5],r.vec2d.set2(0,1,o)):(i[0]=-2/(t*a[0]),i[1]=-2/(n*a[5]),i[2]=(1-a[8])/a[0],i[3]=(1-a[9])/a[5],r.vec2d.set2(1,0,o))}}.apply(null,n))||(e.exports=i)},357:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(e){return e?72*e/t.DPI:0}Object.defineProperty(t,"__esModule",{value:!0});var n=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i,i="screenUtils.toPt: input not recognized!";t.DPI=96,t.pt2px=function(e){return e?e/72*t.DPI:0},t.px2pt=r,t.toPt=function(e){if("string"==typeof e){if(n.test(e)){var t=e.match(n),o=Number(t[1]),a=t[3]&&t[3].toLowerCase(),s="-"===e.charAt(0),l="px"===a?r(o):o;return s?-l:l}return console.warn(i),null}return e}}.apply(null,n))||(e.exports=i)},369:function(e,t,r){var n,i;n=[r(353),r(346),r(341),r(348),r(357),r(339),r(342),r(393),r(704),r(362),r(727),r(643)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,c,d){var p="size",f=n({sizeInfo:p,colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),h=n({widthAndDepth:"width-and-depth"}),m=n({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers","decimal-degree":"decimal-degrees"}),v=n({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap"},{ignoreUnknown:!0}),g=Math.PI,y=l.opacityToTransparency,b=l.transparencyToOpacity;return e([t,r],{declaredClass:"esri.renderers.Renderer",properties:{authoringInfo:{type:d,value:null,json:{write:!0}},requiredFields:{dependsOn:["visualVariables"],get:function(){var e=Object.create(null);return this.collectRequiredFields(e),Object.keys(e).sort()}},type:{type:v.apiValues,readOnly:!0,json:{type:v.jsonValues,read:!1,write:{writer:v.write,ignoreOrigin:!0}}},visualVariables:{json:{read:{source:["visualVariables","rotationType","rotationExpression"],reader:function(e,t){return this._readVariables(e,t)}},write:function(e,t,r,n){var i=[];e.forEach(function(e,t){e.type===p?i.push(this._writeSizeInfo(e,n,t)):"color"===e.type?i.push(this._writeColorInfo(e,n,t)):"opacity"===e.type?i.push(this._writeOpacityInfo(e,n,t)):"rotation"===e.type&&i.push(this._writeRotationInfo(e,n,t))},this),t.visualVariables=i}}}},constructor:function(){this._cache={}},_rotationRE:/^\[([^\]]+)\]$/i,_viewScaleRE:/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i,_visualVariablesSetter:function(e){var t=this._cache;this.visualVariables&&this.visualVariables.forEach(function(e,r){t.hasOwnProperty(r)&&(t[r]=null)},this),e&&e.some(function(e){return!!e.target})&&e.sort(function(e,t){return e.target===t.target?0:e.target?1:-1}),e&&e.forEach(function(e,r){"color"===e.type?t[r]=this._processColorInfo(e):"opacity"===e.type?t[r]=this._processOpacityInfo(e):e.type===p?t[r]=this._processSizeInfo(e):"rotation"===e.type&&(t[r]=this._processRotationInfo(e))},this),this._set("visualVariables",e)},getSymbol:function(e,t){},getVisualVariableValues:function(e,t){var r,n=this.visualVariables;return n&&(r=n.map(function(r){var n,i=r.type,a=i+"Info";switch((t=o.mixin({},t))[a]=r,i){case p:n=this.getSize(e,t);break;case"color":n=this.getColor(e,t);break;case"opacity":n=this.getOpacity(e,t);break;case"rotation":n=this.getRotationAngle(e,t)}return{variable:r,value:n}},this).filter(function(e){return null!=e.value},this)),r},hasVisualVariables:function(e,t){return e?!!this.getVisualVariablesForType(e,t):!!(this.getVisualVariablesForType(p,t)||this.getVisualVariablesForType("color",t)||this.getVisualVariablesForType("opacity",t)||this.getVisualVariablesForType("rotation",t))},getVisualVariablesForType:function(e,t){var r,n=this.visualVariables;return n&&(r=n.filter(function(r){return r.type===e&&("string"==typeof t?r.target===t:!1!==t||!r.target)}))&&0===r.length&&(r=void 0),r},getSize:function(e,t){var r=this._getVarInfo(t&&t.sizeInfo,p),n=r.variable,i=this._cache[r.cacheKey],o=null;if(n){var a=n.minSize,s=n.maxSize,l="object"==typeof a&&a?this._getSize(e,a,i&&i.minSize,t):a,u="object"==typeof s&&s?this._getSize(e,s,i&&i.maxSize,t):s;o=this._getSize(e,n,i&&i.root,t,[l,u])}return o},getSizeRangeAtScale:function(e,t){var r,n=this._getVarInfo(e,p),i=this._cache[n.cacheKey],o={scale:t};if((e=n.variable)&&t){var a=e.minSize,s=e.maxSize,l="object"==typeof a&&a?this._getSize({},a,i&&i.minSize,o):a,u="object"==typeof s&&s?this._getSize({},s,i&&i.maxSize,o):s;if(null!=l||null!=u){if(l>u){var c=u;u=l,l=c}r={minSize:l,maxSize:u}}}return r},getColor:function(e,t){var r=this._getVarInfo(t&&t.colorInfo,"color");return this._getColorComponent(e,r.variable,this._cache[r.cacheKey],t,!1)},getOpacity:function(e,t){var r=this._getVarInfo(t&&t.opacityInfo,"opacity");return this._getColorComponent(e,r.variable,this._cache[r.cacheKey],t,!0)},getRotationAngle:function(e,t){var r=this._getVarInfo(t&&t.rotationInfo,"rotation"),n=r.variable,i=this._cache[r.cacheKey],o=n.axis||"heading",a="heading"===o&&"arithmetic"===n.rotationType?90:0,l="heading"===o&&"arithmetic"===n.rotationType?-1:1,u=n.field,c=i&&i.compiledFunc,d=e.attributes,p=0;return(u||c)&&(c?p=s.executeFunction(c,s.createExecContext(e,s.getViewInfo(t))):"function"==typeof u?p=u.apply(this,arguments):d&&(p=d[u]||0),p="number"!=typeof p||isNaN(p)?null:a+l*p),p},collectRequiredFields:function(e){var t=[];this.visualVariables&&(t=t.concat(this.visualVariables)),t.forEach(function(t){t&&(t.field&&(e[t.field]=!0),t.normalizationField&&(e[t.normalizationField]=!0),t.valueExpression&&s.extractFieldNames(t.valueExpression).forEach(function(t){e[t]=!0}))})},_getVarInfo:function(e,t){var r;if(e&&e.type===t&&this.visualVariables)r=this.visualVariables.indexOf(e),e=this.visualVariables[r];else if(this.visualVariables){var n=this.getVisualVariablesForType(t);e=n&&n[0],r=this.visualVariables.indexOf(e)}return{variable:e,cacheKey:r}},_readSizeInfo:function(e){return e.axis&&(e.axis=h.fromJSON(e.axis)),e.valueUnit&&(e.valueUnit=m.fromJSON(e.valueUnit)),e},_readColorInfo:function(e){return e&&(e.colors&&e.colors.forEach(function(t,r){Array.isArray(t)?e.colors[r]=u.fromJSON(t):e.colors[r]=new u(t)}),e.stops&&e.stops.forEach(function(t,r){t.color&&Array.isArray(t.color)?e.stops[r].color=u.fromJSON(t.color):t.color&&(e.stops[r].color=new u(t.color))})),e},_readOpacityInfo:function(e){var t;return e&&((t=o.mixin({},e)).transparencyValues&&(t.opacityValues=t.transparencyValues.map(b),delete t.transparencyValues),t.stops&&(t.stops=t.stops.map(function(e){return(e=o.mixin({},e)).opacity=b(e.transparency),delete e.transparency,e}))),t},_readVariables:function(e,t){e&&(e=e.map(function(e){return(e=o.clone(e)).type=f.fromJSON(e.type),e.type===p?e=this._readSizeInfo(e):"color"===e.type?e=this._readColorInfo(e):"opacity"===e.type&&(e=this._readOpacityInfo(e)),e},this));var r=t.rotationType,n=t.rotationExpression;if(n){var i={type:"rotation",rotationType:r},a=n.match(this._rotationRE);a&&a[1]&&(i.field=a[1],e||(e=[]),e.push(i))}return e},_createCache:function(e){var t=e&&e.valueExpression,r=s.createSyntaxTree(t),n=s.createFunction(r),i=!(!e||!e.expression)||this._viewScaleRE.test(t);return{ipData:this._interpolateData(e),hasExpr:!!t,compiledFunc:n,isScaleDriven:i}},_processColorInfo:function(e){return e&&(e.colors&&e.colors.forEach(function(t,r){t instanceof u||(e.colors[r]=new u(t))}),e.stops&&e.stops.forEach(function(t,r){!t.color||t.color instanceof u||(e.stops[r].color=new u(t.color))}),this._sortStops(e.stops)),this._createCache(e)},_processOpacityInfo:function(e){return this._sortStops(e&&e.stops),this._createCache(e)},_processSizeInfo:function(e){return e.stops&&Array.isArray(e.stops)?e.stops=this._processSizeInfoStops(e.stops):(e.minSize=e.minSize&&this._processSizeInfoSize(e.minSize),e.maxSize=e.maxSize&&this._processSizeInfoSize(e.maxSize)),{root:this._createCache(e),minSize:this._createCache(e.minSize),maxSize:this._createCache(e.maxSize)}},_processSizeInfoSize:function(e){return"object"==typeof e?e.stops=this._processSizeInfoStops(e.stops):e=i.toPt(e),e},_processSizeInfoStops:function(e){return e&&Array.isArray(e)&&(e.forEach(function(e){e.size=i.toPt(e.size)}),this._sortStops(e)),e},_sortStops:function(e){e&&Array.isArray(e)&&e.sort(function(e,t){return e.value-t.value})},_processRotationInfo:function(e){return this._createCache(e)},_getSize:function(e,t,r,n,i){var o=e.attributes,a=t.field,l=t.stops,u=0,d=r&&r.hasExpr,p=r&&r.compiledFunc,f=r&&r.ipData,h=r&&r.isScaleDriven,m="number"==typeof e,v=m?e:null;if(a||h||d){var y,b=n&&n.scale,_=i?i[0]:t.minSize,x=i?i[1]:t.maxSize,w=t.minDataValue,S=t.maxDataValue,T=t.valueUnit||"unknown",E=t.valueRepresentation,C=t.scaleBy,O=t.normalizationField,P=o?parseFloat(o[O]):void 0,A=n&&n.shape;if(h?v=null==b?this._getAverageValue(t):b:"number"!=typeof v&&(d?v=s.executeFunction(p,s.createExecContext(e,s.getViewInfo(n))):"function"==typeof a?v=a.apply(this,arguments):o&&(v=o[a])),null==v||O&&!m&&(isNaN(P)||0===P))return null;if(isNaN(P)||m||(v/=P),l){var I,R=this._lookupData(v,f),M=R[0],D=R[1];M===D?u=l[M].size:u=(I=l[M].size)+(l[D].size-I)*R[2]}else if(null!=_&&null!=x&&null!=w&&null!=S)if(v<=w)u=_;else if(v>=S)u=x;else if(y=(v-w)/(S-w),"area"===C&&A){var F="circle"===A,L=F?g*Math.pow(_/2,2):_*_,N=L+y*((F?g*Math.pow(x/2,2):x*x)-L);u=F?2*Math.sqrt(N/g):Math.sqrt(N)}else u=_+y*(x-_);else if("unknown"===T)null!=_&&null!=w?(_&&w?(y=v/w,u="circle"===A?2*Math.sqrt(y*Math.pow(_/2,2)):"square"===A||"diamond"===A||"image"===A?Math.sqrt(y*Math.pow(_,2)):y*_):u=v+(_||w),u=u<_?_:u,null!=x&&u>x&&(u=x)):u=v;else{var j=(n&&n.resolution?n.resolution:1)*c.meterIn[T];"area"===E?(u=Math.sqrt(v/g)/j,u*=2):(u=v/j,"radius"!==E&&"distance"!==E||(u*=2)),null!=_&&u<_&&(u=_),null!=x&&u>x&&(u=x)}}else t&&null==(u=l&&l[0]&&l[0].size)&&(u=t.minSize);return isNaN(u)?0:u},_getAverageValue:function(e){var t,r,n=e.stops;return n?(t=n[0].value,r=n[n.length-1].value):(t=e.minDataValue||0,r=e.maxDataValue||0),(t+r)/2},_getColorComponent:function(e,t,r,n,i){var o,a=e.attributes,l=t&&t.field,u="number"==typeof e,c=u?e:null,d=r&&r.hasExpr,p=r&&r.compiledFunc,f=r&&r.ipData;if(l||d){var h=t.normalizationField,m=a&&h?parseFloat(a[h]):void 0;"number"!=typeof c&&(d?c=s.executeFunction(p,s.createExecContext(e,s.getViewInfo(n))):"function"==typeof l?c=l.apply(this,arguments):a&&(c=a[l])),null==c||h&&!u&&(isNaN(m)||0===m)||(isNaN(m)||u||(c/=m),o=i?this._getOpacity(c,t,f):this._getColor(c,t,f,n&&n.color))}else if(t){var v=t.stops;i?null==(o=v&&v[0]&&v[0].opacity)&&(o=t.opacityValues&&t.opacityValues[0]):o=v&&v[0]&&v[0].color||t.colors&&t.colors[0]}return o},_interpolateData:function(e){var t;if(e)if(e.colors||e.opacityValues){var r,n=(e.colors||e.opacityValues).length,i=e.minDataValue,o=(e.maxDataValue-i)/(n-1);for(t=[],r=0;r<n;r++)t[r]=i+r*o}else e.stops&&(t=e.stops.map(function(e){return e.value||0}));return t},_getOpacity:function(e,t,r){var n,i=this._lookupData(e,r);if(t=t||this.opacityInfo,i){var o,a=i[0],s=i[1];a===s?n=this._getOpacValue(t,a):n=(o=this._getOpacValue(t,a))+(this._getOpacValue(t,s)-o)*i[2]}return n},_getOpacValue:function(e,t){return e.opacityValues?e.opacityValues[t]:e.stops[t].opacity},_getColor:function(e,t,r,n){var i=this._lookupData(e,r);if(t=t||this.colorInfo,i){var o=i[0],a=i[1];return n=n||new u,o===a?n.setColor(this._getColorObj(t,o)):u.blendColors(this._getColorObj(t,o),this._getColorObj(t,a),i[2],n),n}},_getColorObj:function(e,t){return e.colors?e.colors[t]:e.stops[t].color},_lookupData:function(e,t){var r;if(t){var n=0,i=t.length-1;t.some(function(t,r){return e<t?(i=r,!0):(n=r,!1)}),r=[n,i,(e-t[n])/(t[i]-t[n])]}return r},_processForContext:function(e,t,r){if(t&&"web-scene"===t.origin){var n=null!=e.expression,i=null!=e.valueExpressionTitle&&"rotation"===e.type;t.messages&&(n&&t.messages.push(new a("property:unsupported",e.type+"VisualVariable.expression is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:r+".expression",context:t})),i&&t.messages.push(new a("property:unsupported",e.type+"VisualVariable.valueExpressionTitle is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:r+".valueExpressionTitle",context:t}))),n&&delete e.expression,i&&delete e.valueExpressionTitle}else e.type===p&&this._convertExpressionToArcade(e)},_writeRotationInfo:function(e,t,r){return e&&(e=o.mixin({},e),this._processForContext(e,t,"visualVariables["+r+"]"),e.type=f.toJSON(e.type),e=o.fixJson(e,!0)),e},_convertExpressionToArcade:function(e){e&&e.expression&&(e.valueExpression="$view.scale")},_writeSizeInfo:function(e,t,r){if(e){e=o.mixin({},e),this._processForContext(e,t,"string"==typeof r?r:"visualVariables["+r+"]");var n=e.minSize,i=e.maxSize;n&&(e.minSize="number"==typeof n?n:this._writeSizeInfo(n,t,"visualVariables["+r+"].minSize")),i&&(e.maxSize="number"==typeof i?i:this._writeSizeInfo(i,t,"visualVariables["+r+"].maxSize"));var a=e.legendOptions,s=e.type,l=e.axis;e.type=f.toJSON(s),l&&(e.axis=h.toJSON(l)),a&&(e.legendOptions=o.mixin({},a),(a=a.customValues)&&(e.legendOptions.customValues=a.slice(0))),e.stops&&(e.stops=e.stops.map(function(e){return null===(e=o.mixin({},e)).label&&delete e.label,e})),e=o.fixJson(e,!0)}return e},_writeColorInfo:function(e,t,r){return e&&(e=o.mixin({},e),this._processForContext(e,t,"visualVariables["+r+"]"),e.type=f.toJSON(e.type),e.colors&&(e.colors=e.colors.map(function(e){return u.toJSON(e)})),e.stops&&(e.stops=e.stops.map(function(e){return(e=o.mixin({},e)).color&&(e.color=u.toJSON(e.color)),null==e.value&&(e.value=0),null===e.label&&delete e.label,e})),e.legendOptions&&(e.legendOptions=o.mixin({},e.legendOptions)),e=o.fixJson(e,!0)),e},_writeOpacityInfo:function(e,t,r){var n;return e&&(n=o.mixin({},e),this._processForContext(n,t,"visualVariables["+r+"]"),n.type=f.toJSON(n.type),n.opacityValues&&(n.transparencyValues=n.opacityValues.map(y),delete n.opacityValues),n.stops&&(n.stops=n.stops.map(function(e){return(e=o.mixin({},e)).transparency=y(e.opacity),delete e.opacity,null===e.label&&delete e.label,e})),n.legendOptions&&(n.legendOptions=o.mixin({},n.legendOptions)),n=o.fixJson(n,!0)),n}})}.apply(null,n))||(e.exports=i)},371:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(354)],void 0===(i=function(e,t,r){return function(){function e(t,n,i){this._context=null,this._glName=null,this._id=-1,this._desc=void 0,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._boundToUnits=new Set,this._context=t,this._desc={pixelFormat:n.pixelFormat,internalFormat:n.internalFormat,dataType:n.dataType,target:n.target?n.target:3553,samplingMode:n.samplingMode?n.samplingMode:9729,wrapMode:n.wrapMode?n.wrapMode:10497,maxAnisotropy:n.maxAnisotropy,flipped:void 0!==n.flipped&&n.flipped,hasMipmap:void 0!==n.hasMipmap&&n.hasMipmap,unpackAlignment:n.unpackAlignment?n.unpackAlignment:4,width:n.width,height:n.height,preMultiplyAlpha:void 0!==n.preMultiplyAlpha&&n.preMultiplyAlpha},this._id=++e._nextId,r("esri-webgl-debug")&&t.instanceCounter.incrementCount(0),this.setData(i)}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){var e=this;if(this._context){if(this._glName){var t=this._context.gl;this._boundToUnits.forEach(function(t){e._context.bindTexture(null,t)}),t.deleteTexture(this._glName),this._glName=null}r("esri-webgl-debug")&&this._context.instanceCounter.decrementCount(0),this._context=null}},e.prototype.resize=function(e,t){var r=this._desc;r.width===e&&r.height===t||(r.width=e,r.height=t,this.setData(null))},e.prototype.setData=function(t){var r=this._context.gl;this._glName||(this._glName=r.createTexture()),void 0===t&&(t=null),null===t&&(this._desc.width=this._desc.width||4,this._desc.height=this._desc.height||4);var n=this._context.getBoundTexture(0);this._context.bindTexture(this,0);var i=this._desc;e._validateTexture(i),r.pixelStorei(r.UNPACK_ALIGNMENT,i.unpackAlignment),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,i.flipped?1:0),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.preMultiplyAlpha);var o=i.pixelFormat,a=i.internalFormat?i.internalFormat:o;if(t instanceof ImageData||t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement)i.width&&i.height&&console.assert(t.width===i.width&&t.height===i.height),r.texImage2D(r.TEXTURE_2D,0,a,o,i.dataType,t),i.hasMipmap&&this.generateMipmap(),void 0===this._desc.width&&(this._desc.width=t.width),void 0===this._desc.height&&(this._desc.height=t.height);else{null!=i.width&&null!=i.height||console.error("Width and height must be specified!"),r.DEPTH24_STENCIL8&&a===r.DEPTH_STENCIL&&(a=r.DEPTH24_STENCIL8);var s=i.width,l=i.height;if(function(e){return null!=e&&"type"in e&&"compressed"===e.type}(t))for(var u=0;;++u){var c=t.levels[Math.min(u,t.levels.length-1)];if(r.compressedTexImage2D(r.TEXTURE_2D,u,a,s,l,0,c),1===s&&1===l||!i.hasMipmap)break;s=Math.max(1,s>>1),l=Math.max(1,l>>1)}else if(t)r.texImage2D(r.TEXTURE_2D,0,a,s,l,0,o,i.dataType,t),i.hasMipmap&&this.generateMipmap();else for(u=0;r.texImage2D(r.TEXTURE_2D,u,a,s,l,0,o,i.dataType,null),(1!==s||1!==l)&&i.hasMipmap;++u)s=Math.max(1,s>>1),l=Math.max(1,l>>1)}e._applySamplingMode(r,this._desc),e._applyWrapMode(r,this._desc),e._applyAnisotropicFilteringParameters(this._context,this._desc),this._context.bindTexture(n,0)},e.prototype.updateData=function(e,t,r,n,i,o){o||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");var a=this._context.gl,s=this._desc,l=this._context.getBoundTexture(0);this._context.bindTexture(this,0),(t<0||r<0||n>s.width||i>s.height||t+n>s.width||r+i>s.height)&&console.error("An attempt to update out of bounds of the texture!"),o instanceof ImageData||o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement?(console.assert(o.width===n&&o.height===i),a.texSubImage2D(a.TEXTURE_2D,e,t,r,s.pixelFormat,s.dataType,o)):a.texSubImage2D(a.TEXTURE_2D,e,t,r,n,i,s.pixelFormat,s.dataType,o),this._context.bindTexture(l,0)},e.prototype.generateMipmap=function(){var t=this._desc;t.hasMipmap||(t.hasMipmap=!0,e._validateTexture(t)),9729===t.samplingMode?(this._samplingModeDirty=!0,t.samplingMode=9985):9728===t.samplingMode&&(this._samplingModeDirty=!0,t.samplingMode=9984);var r=this._context.getBoundTexture(0);this._context.bindTexture(this,0);var n=this._context.gl;n.generateMipmap(n.TEXTURE_2D),this._context.bindTexture(r,0)},e.prototype.setSamplingMode=function(t){t!==this._desc.samplingMode&&(this._desc.samplingMode=t,e._validateTexture(this._desc),this._samplingModeDirty=!0)},e.prototype.setWrapMode=function(t){t!==this._desc.wrapMode&&(this._desc.wrapMode=t,e._validateTexture(this._desc),this._wrapModeDirty=!0)},e.prototype.applyChanges=function(){var t=this._context.gl,r=this._desc;this._samplingModeDirty&&(e._applySamplingMode(t,r),this._samplingModeDirty=!1),this._wrapModeDirty&&(e._applyWrapMode(t,r),this._wrapModeDirty=!1)},e.prototype.setBoundToUnit=function(e,t){t?this._boundToUnits.add(e):this._boundToUnits.delete(e)},e._isPowerOfTwo=function(e){return 0==(e&e-1)},e._validateTexture=function(t){(t.width<0||t.height<0)&&console.error("Negative dimension parameters are not allowed!"),e._isPowerOfTwo(t.width)&&e._isPowerOfTwo(t.height)||(33071!==t.wrapMode&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),t.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))},e._applySamplingMode=function(e,t){var r=t.samplingMode;9985===r||9987===r?r=9729:9984!==r&&9986!==r||(r=9728),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t.samplingMode)},e._applyWrapMode=function(e,t){e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,t.wrapMode),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,t.wrapMode)},e._applyAnisotropicFilteringParameters=function(e,t){if(null!=t.maxAnisotropy){var r=e.capabilities.textureFilterAnisotropic;if(r){var n=e.gl;n.texParameterf(n.TEXTURE_2D,r.TEXTURE_MAX_ANISOTROPY,t.maxAnisotropy)}}},e._nextId=0,e}()}.apply(null,n))||(e.exports=i)},372:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Default3D={position:0,normal:1,normalCompressed:1,uv0:2,color:3,instanceColor:3,size:4,auxpos1:5,symbolColor:5,componentIndex:5,auxpos2:6,featureAttribute:6,instanceFeatureAttribute:6,region:7,model:8,modelNormal:12,modelOriginHi:11,modelOriginLo:15}}.apply(null,n))||(e.exports=i)},373:function(e,t,r){var n,i;n=[r(348),r(341),r(362)],void 0===(i=function(e,t,r){var n=e({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d"}),i=0;return t.createSubclass({declaredClass:"esri.symbols.Symbol",constructor:function(){this.id="sym"+i++},properties:{type:{type:String,value:null,json:{read:n.read,write:{ignoreOrigin:!0,writer:n.write}}},color:{type:r,value:new r([0,0,0,1]),json:{read:function(e){return e&&null!=e[0]?[e[0],e[1],e[2],e[3]/255]:e},write:{allowNull:!0}}}}})}.apply(null,n))||(e.exports=i)},374:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(380),r(599)],void 0===(i=function(e,t,r,n){function i(e,t,r,n,i){var o=e.watch(t,function(t,i,o,a){n&&!n(t)||r.call(e,t,i,o,a)},i);if(Array.isArray(t))for(var a=0,s=t;a<s.length;a++){var l=s[a],u=e.get(l);n&&n(u)&&r.call(e,u,u,t,e)}else{u=e.get(t);n&&n(u)&&r.call(e,u,u,t,e)}return o}function o(e,t,o,a,s){function l(){u&&(u.remove(),u=null)}var u,c=!1,d=new r(l),p=new n;return p.cancel=d.cancel,p.isCanceled=d.isCanceled,p.isFulfilled=d.isFulfilled,p.isRejected=d.isRejected,p.isResolved=d.isResolved,p.then=d.then,p.remove=l,Object.freeze(p),u=i(e,t,function(t,r,n,i){c=!0,l(),o&&o.call(e,t,r,n,i),d.resolve({value:t,oldValue:r,propertyName:n,target:i})},a,s),c&&l(),p}function a(e){return!!e}function s(e){return!e}function l(e){return!0===e}function u(e){return!1===e}function c(e){return void 0!==e}function d(e){return void 0===e}function p(e,t,r,n){for(var i=Array.isArray(t)?t:t.indexOf(",")>-1?t.split(","):[t],o=f(e,t,r,n),a=0,s=i;a<s.length;a++){var l=s[a].trim(),u=e.get(l);r.call(e,u,u,l,e)}return o}function f(e,t,r,n){return e.watch(t,r,n)}Object.defineProperty(t,"__esModule",{value:!0}),t.init=p,t.watch=f,t.once=function(e,t,r,n){return o(e,t,r,null,n)},t.when=function(e,t,r,n){return i(e,t,r,a,n)},t.whenOnce=function(e,t,r,n){return o(e,t,r,a,n)},t.whenNot=function(e,t,r,n){return i(e,t,r,s,n)},t.whenNotOnce=function(e,t,r,n){return o(e,t,r,s,n)},t.whenTrue=function(e,t,r,n){return i(e,t,r,l,n)},t.whenTrueOnce=function(e,t,r,n){return o(e,t,r,l,n)},t.whenFalse=function(e,t,r,n){return i(e,t,r,u,n)},t.whenFalseOnce=function(e,t,r,n){return o(e,t,r,u,n)},t.whenDefined=function(e,t,r,n){return i(e,t,r,c,n)},t.whenDefinedOnce=function(e,t,r,n){return o(e,t,r,c,n)},t.whenUndefined=function(e,t,r,n){return i(e,t,r,d,n)},t.whenUndefinedOnce=function(e,t,r,n){return o(e,t,r,d,n)},t.pausable=function(e,t,r,n){var i=!1,o=e.watch(t,function(t,n,o,a){i||r.call(e,t,n,o,a)},n);return{remove:function(){o.remove()},pause:function(){i=!0},resume:function(){i=!1}}},t.on=function(e,t,r,n,i,o,a){function s(t){var n=l[t];n&&(o&&o(n.target,t,e,r),n.handle.remove(),delete l[t])}var l={},u=p(e,t,function(t,o,a){s(a),t&&"function"==typeof t.on&&(l[a]={handle:t.on(r,n),target:t},i&&i(t,a,e,r))},a);return{remove:function(){for(var e in u.remove(),l)s(e)}}}}.apply(null,n))||(e.exports=i)},376:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(338),r(336),r(341),r(348),r(337)],void 0===(i=function(e,t,r,n,i,o,a){var s=o({inherited:"inherited",codedValue:"coded-value",range:"range"});return function(e){function t(t){var r=e.call(this,t)||this;return r.name=null,r.type=null,r}return r(t,e),n([a.property({json:{write:!0}})],t.prototype,"name",void 0),n([a.property({json:{read:s.read,write:s.write}})],t.prototype,"type",void 0),n([a.subclass("esri.layers.support.Domain")],t)}(a.declared(i))}.apply(null,n))||(e.exports=i)},377:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(354),r(964),r(371)],void 0===(i=function(e,t,r,n,i){return function(){function e(t,o,a,s){if(this._context=null,this._glName=null,this._depthAttachment=null,this._stencilAttachment=null,this._colorAttachment=null,this._initialized=!1,this._context=t,this._desc={colorTarget:o.colorTarget,depthStencilTarget:o.depthStencilTarget,width:o.width,height:o.height,multisampled:o.multisampled},this._id=e._nextId++,r("esri-webgl-debug")&&t.instanceCounter.incrementCount(4),a){var l=void 0;a instanceof i?(this._colorAttachment=a,l=a.descriptor):(l=a,this._colorAttachment=new i(this._context,l)),0!==this._desc.colorTarget&&console.error("Framebuffer is initialized with a texture however the descriptor indicates using a renderbuffer color attachment!"),e._validateTextureDimensions(l,this._desc)}if(s instanceof n)2===o.depthStencilTarget?this._stencilAttachment=s:1===o.depthStencilTarget||3===o.depthStencilTarget?this._depthAttachment=s:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER'),e._validateBufferDimensions(s.descriptor,this._desc);else if(s){this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!");var u=void 0;s instanceof i?(this._depthStencilTexture=s,u=this._depthStencilTexture.descriptor):(u=s,this._depthStencilTexture=new i(this._context,u)),e._validateTextureDimensions(u,this._desc)}}return e.create=function(t,r){return new e(t,r)},e.createWithAttachments=function(t,r,n,i){return new e(t,n,r,i)},Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"colorTexture",{get:function(){return this._colorAttachment instanceof i?this._colorAttachment:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthStencilTexture",{get:function(){return this._depthStencilTexture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._desc.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._desc.height},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this._context&&(this._disposeColorAttachment(),this._disposeDepthStencilAttachments(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),r("esri-webgl-debug")&&this._context.instanceCounter.decrementCount(4),this._context=null)},e.prototype.attachColorTexture=function(t){if(t){var r=t.descriptor;if(e._validateTextureDimensions(r,this._desc),this._disposeColorAttachment(),this._initialized){this._context.bindFramebuffer(this);var n=this._context.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t.glName,0)}this._colorAttachment=t}},e.prototype.detachColorTexture=function(){var e=void 0;if(this._colorAttachment instanceof i){if(e=this._colorAttachment,this._initialized){this._context.bindFramebuffer(this);var t=this._context.gl;this._context.gl.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0)}this._colorAttachment=null}return e},e.prototype.attachDepthStencilTexture=function(t){if(t){var r=t.descriptor;if(34041!==r.pixelFormat&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),34042!==r.dataType&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8_WEBGL!"),this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!"),e._validateTextureDimensions(r,this._desc),4!==this._desc.depthStencilTarget&&(this._desc.depthStencilTarget=4),this._disposeDepthStencilAttachments(),this._initialized){this._context.bindFramebuffer(this);var n=this._context.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,t.glName,0)}this._depthStencilTexture=t}},e.prototype.detachDepthStencilTexture=function(){var e=this._depthStencilTexture;if(e&&this._initialized){this._context.bindFramebuffer(this);var t=this._context.gl;this._context.gl.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,null,0)}return this._depthStencilTexture=null,e},e.prototype.attachDepthStencilBuffer=function(t){if(t){var r=t.descriptor;if(34041!==r.internalFormat&&33189!==r.internalFormat&&console.error("Depth/Stencil buffer must have correct internalFormat"),e._validateBufferDimensions(r,this._desc),this._disposeDepthStencilAttachments(),this._desc.depthStencilTarget=34041===r.internalFormat?3:1,this._initialized){this._context.bindFramebuffer(this);var n=this._context.gl,i=1===this._desc.depthStencilTarget?n.DEPTH_ATTACHMENT:n.DEPTH_STENCIL_ATTACHMENT;n.framebufferRenderbuffer(n.FRAMEBUFFER,i,n.RENDERBUFFER,t.glName)}this._depthAttachment=t}},e.prototype.detachDepthStencilBuffer=function(){var e=this._context.gl,t=this._depthAttachment;if(t&&this._initialized){this._context.bindFramebuffer(this);var r=1===this._desc.depthStencilTarget?e.DEPTH_ATTACHMENT:e.DEPTH_STENCIL_ATTACHMENT;e.framebufferRenderbuffer(e.FRAMEBUFFER,r,e.RENDERBUFFER,null)}return this._depthAttachment=null,t},e.prototype.copyToTexture=function(e,t,r,n,i,o,a){(e<0||t<0||i<0||o<0)&&console.error("Offsets cannot be negative!"),(r<=0||n<=0)&&console.error("Copy width and height must be greater than zero!");var s=this._desc,l=a.descriptor;3553!==a.descriptor.target&&console.error("Texture target must be TEXTURE_2D!"),(e+r>s.width||t+n>s.height||i+r>l.width||o+n>l.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");var u=this._context;u.bindTexture(a),u.bindFramebuffer(this),u.gl.copyTexSubImage2D(3553,0,i,o,e,t,r,n)},e.prototype.readPixels=function(e,t,r,n,i,o,a){(r<=0||n<=0)&&console.error("Copy width and height must be greater than zero!"),a||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(e,t,r,n,i,o,a)},e.prototype.resize=function(t,r){var n=this._desc;if(n.width!==t||n.height!==r){if(!this._initialized){if(n.width=t,n.height=r,this._colorAttachment instanceof i)(o=this._colorAttachment).resize(t,r);return void(this._depthStencilTexture&&this._depthStencilTexture.resize(t,r))}var o,a;if(n.width=t,n.height=r,this._colorAttachment instanceof i)(a=(o=this._colorAttachment).descriptor).width=t,a.height=r,this._colorAttachment.dispose(),this._colorAttachment=new i(this._context,a),e._validateTextureDimensions(o.descriptor,this._desc);else this._colorAttachment&&this._disposeColorAttachment();if(null!=this._depthStencilTexture)(a=this._depthStencilTexture.descriptor).width=t,a.height=r,this._depthStencilTexture.dispose(),this._depthStencilTexture=new i(this._context,a);else(this._depthAttachment||this._stencilAttachment)&&this._disposeDepthStencilAttachments();this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1}},e.prototype.initialize=function(){if(this._initialized)return!1;var e=this._context.gl;this._glName&&e.deleteFramebuffer(this._glName);var t=e.createFramebuffer(),r=this._desc;if(e.bindFramebuffer(e.FRAMEBUFFER,t),!this._colorAttachment)if(0===r.colorTarget){var o={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:r.width,height:r.height};this._colorAttachment=new i(this._context,o)}else{var a=new n(this._context,{internalFormat:32854,width:r.width,height:r.height});e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,a.glName),this._colorAttachment=a}if(this._colorAttachment instanceof i){var s=this._colorAttachment;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,s.glName,0)}switch(r.depthStencilTarget){case 1:case 3:this._depthAttachment||(this._depthAttachment=new n(this._context,{internalFormat:1===r.depthStencilTarget?33189:34041,width:r.width,height:r.height}));var l=1===r.depthStencilTarget?e.DEPTH_ATTACHMENT:e.DEPTH_STENCIL_ATTACHMENT;e.framebufferRenderbuffer(e.FRAMEBUFFER,l,e.RENDERBUFFER,this._depthAttachment.glName);break;case 2:this._stencilAttachment||(this._stencilAttachment=new n(this._context,{internalFormat:36168,width:r.width,height:r.height})),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.STENCIL_ATTACHMENT,e.RENDERBUFFER,this._stencilAttachment.glName);break;case 4:if(!this._depthStencilTexture){this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!");var u={target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:r.width,height:r.height};this._depthStencilTexture=new i(this._context,u)}e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,this._depthStencilTexture.glName,0)}return e.checkFramebufferStatus(e.FRAMEBUFFER)!==e.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=t,this._initialized=!0,!0},e.prototype._disposeColorAttachment=function(){if(this._colorAttachment instanceof i){var e=this._colorAttachment;if(this._initialized)this._context.bindFramebuffer(this),(r=this._context.gl).framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,null,0);e.dispose()}else if(this._colorAttachment instanceof WebGLRenderbuffer){var t=this._colorAttachment,r=this._context.gl;this._initialized&&(this._context.bindFramebuffer(this),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,null)),this._context.gl.deleteRenderbuffer(t)}this._colorAttachment=null},e.prototype._disposeDepthStencilAttachments=function(){var e=this._context.gl;if(this._depthAttachment){if(this._initialized){this._context.bindFramebuffer(this);var t=1===this._desc.depthStencilTarget?e.DEPTH_ATTACHMENT:e.DEPTH_STENCIL_ATTACHMENT;e.framebufferRenderbuffer(e.FRAMEBUFFER,t,e.RENDERBUFFER,null)}this._depthAttachment.dispose(),this._depthAttachment=null}this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.STENCIL_ATTACHMENT,e.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null),this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,null,0)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)},e._validateBufferDimensions=function(e,t){console.assert(e.width>=0&&e.height>=0),void 0!==t.width&&t.width>=0&&void 0!==t.height&&t.height>=0?t.width===e.width&&t.height===e.height||console.error("Renderbuffer dimensions must match the framebuffer's!"):(t.width=e.width,t.height=e.height)},e._validateTextureDimensions=function(e,t){console.assert(e.width>=0&&e.height>=0),3553!==e.target&&console.error("Texture type must be TEXTURE_2D!"),void 0!==t.width&&t.width>=0&&void 0!==t.height&&t.height>=0?t.width===e.width&&t.height===e.height||console.error("Color attachment texture must match the framebuffer's!"):(t.width=e.width,t.height=e.height)},e._nextId=0,e}()}.apply(null,n))||(e.exports=i)},379:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(356)],void 0===(i=function(e,t,r){function n(e){return e&&"object"==typeof e&&("result"in e||"transferList"in e)}function i(e){return e instanceof ArrayBuffer||e&&e.constructor&&"ArrayBuffer"===e.constructor.name}Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.HANDSHAKE=0]="HANDSHAKE",e[e.CONFIGURE=1]="CONFIGURE",e[e.CONFIGURED=2]="CONFIGURED",e[e.OPEN=3]="OPEN",e[e.OPENED=4]="OPENED",e[e.RESPONSE=5]="RESPONSE",e[e.INVOKE=6]="INVOKE",e[e.CANCEL=7]="CANCEL",e[e.CLOSE=8]="CLOSE",e[e.OPEN_PORT=9]="OPEN_PORT"}(t.MessageType||(t.MessageType={}));var o=0;t.newJobId=function(){return o++},t.isTranferableResult=n,t.toInvokeError=function(e){return e?e.toJSON?JSON.stringify(e):JSON.stringify({name:e.name,message:e.message,details:e.details,stack:e.stack}):null},t.postMessage=function(e,t,o,a){2===arguments.length||void 0===o&&void 0===a?e.postMessage(t):(r("esri-workers-arraybuffer-transfer")||(a?(a=a.filter(function(e){return!i(e)})).length||(a=null):n(o)&&o.transferList&&(o.transferList=o.transferList.filter(function(e){return!i(e)}),o.transferList.length||(o.transferList=null))),a?(t.data=o,e.postMessage(t,a)):n(o)?(t.data=o.result,o.transferList?e.postMessage(t,o.transferList):e.postMessage(t)):(t.data=o,e.postMessage(t)))},t.receiveMessage=function(e){if(!e)return null;var t=e.data;return t?"string"==typeof t?JSON.parse(t):t:null}}.apply(null,n))||(e.exports=i)},389:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(361),r(367)],void 0===(i=function(e,t,r,n){function i(e){return e}function o(e){return void 0===e&&(e=t.ZERO),i([e[0],e[1],e[2],e[3],e[4],e[5]])}function a(e){return e[0]>=e[3]?0:e[3]-e[0]}function s(e){return e[1]>=e[4]?0:e[4]-e[1]}function l(e){return e[2]>=e[5]?0:e[5]-e[2]}function u(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function c(e){return 6===e.length}Object.defineProperty(t,"__esModule",{value:!0}),t.create=o,t.fromValues=function(e,t,r,n,o,a){return i([e,t,r,n,o,a])},t.fromExtent=function(e,t){return void 0===t&&(t=o()),t[0]=e.xmin,t[1]=e.ymin,t[2]=e.zmin,t[3]=e.xmax,t[4]=e.ymax,t[5]=e.zmax,t},t.toExtent=function(e,t){var n=isFinite(e[2])||isFinite(e[5]);return new r(n?{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],zmin:e[2],zmax:e[5],spatialReference:t}:{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],spatialReference:t})},t.fromMinMax=function(e,t,r){return void 0===r&&(r=o()),r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=t[0],r[4]=t[1],r[5]=t[2],r},t.expandPointInPlace=function(e,t){t[0]<e[0]&&(e[0]=t[0]),t[0]>e[3]&&(e[3]=t[0]),t[1]<e[1]&&(e[1]=t[1]),t[1]>e[4]&&(e[4]=t[1]),t[2]<e[2]&&(e[2]=t[2]),t[2]>e[5]&&(e[5]=t[2])},t.expand=function(e,t,r){return void 0===r&&(r=e),c(t)?(r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[2]=Math.min(e[2],t[2]),r[3]=Math.max(e[3],t[3]),r[4]=Math.max(e[4],t[4]),r[5]=Math.max(e[5],t[5])):n.is(t)?(r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[3]=Math.max(e[3],t[2]),r[4]=Math.max(e[4],t[3])):2===t.length?(r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[3]=Math.max(e[3],t[0]),r[4]=Math.max(e[4],t[1])):3===t.length&&(r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[2]=Math.min(e[2],t[2]),r[3]=Math.max(e[3],t[0]),r[4]=Math.max(e[4],t[1]),r[5]=Math.max(e[5],t[2])),r},t.expandWithBuffer=function(e,t,r,n,i){void 0===i&&(i=e);for(var o=e[0],a=e[1],s=e[2],l=e[3],u=e[4],c=e[5],d=0;d<n;d++)o=Math.min(o,t[r+3*d]),a=Math.min(a,t[r+3*d+1]),s=Math.min(s,t[r+3*d+2]),l=Math.max(l,t[r+3*d]),u=Math.max(u,t[r+3*d+1]),c=Math.max(c,t[r+3*d+2]);return i[0]=o,i[1]=a,i[2]=s,i[3]=l,i[4]=u,i[5]=c,i},t.expandWithNestedArray=function(e,t,r,n){void 0===n&&(n=e);var i=t.length,o=e[0],a=e[1],s=e[2],l=e[3],u=e[4],c=e[5];if(r)for(var d=0;d<i;d++){var p=t[d];o=Math.min(o,p[0]),a=Math.min(a,p[1]),s=Math.min(s,p[2]),l=Math.max(l,p[0]),u=Math.max(u,p[1]),c=Math.max(c,p[2])}else for(d=0;d<i;d++)p=t[d],o=Math.min(o,p[0]),a=Math.min(a,p[1]),l=Math.max(l,p[0]),u=Math.max(u,p[1]);return n[0]=o,n[1]=a,n[2]=s,n[3]=l,n[4]=u,n[5]=c,n},t.allFinite=function(e){for(var t=0;t<6;t++)if(!isFinite(e[t]))return!1;return!0},t.width=a,t.depth=s,t.height=l,t.diameter=function(e){var t=a(e),r=l(e),n=s(e);return Math.sqrt(t*t+r*r+n*n)},t.center=function(e,t){return void 0===t&&(t=[0,0,0]),t[0]=e[0]+a(e)/2,t[1]=e[1]+s(e)/2,t[2]=e[2]+l(e)/2,t},t.size=function(e,t){return void 0===t&&(t=[0,0,0]),t[0]=a(e),t[1]=s(e),t[2]=l(e),t},t.maximumDimension=function(e){return Math.max(a(e),l(e),s(e))},t.containsPoint=function(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[0]<=e[3]&&t[1]<=e[4]&&t[2]<=e[5]},t.containsPointWithMargin=function(e,t,r){return t[0]>=e[0]-r&&t[1]>=e[1]-r&&t[2]>=e[2]-r&&t[0]<=e[3]+r&&t[1]<=e[4]+r&&t[2]<=e[5]+r},t.contains=function(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[3]<=e[3]&&t[4]<=e[4]&&t[5]<=e[5]},t.intersects=function(e,t){return Math.max(t[0],e[0])<=Math.min(t[3],e[3])&&Math.max(t[1],e[1])<=Math.min(t[4],e[4])&&Math.max(t[2],e[2])<=Math.min(t[5],e[5])},t.offset=function(e,t,r,n,i){return void 0===i&&(i=e),i[0]=e[0]+t,i[1]=e[1]+r,i[2]=e[2]+n,i[3]=e[3]+t,i[4]=e[4]+r,i[5]=e[5]+n,i},t.setMin=function(e,t,r){return void 0===r&&(r=e),r[0]=t[0],r[1]=t[1],r[2]=t[2],r!==e&&(r[3]=e[3],r[4]=e[4],r[5]=e[5]),r},t.setMax=function(e,t,r){return void 0===r&&(r=e),r[3]=t[0],r[4]=t[1],r[5]=t[2],r!==e&&(r[0]=e[0],r[1]=e[1],r[2]=e[2]),e},t.set=u,t.empty=function(e){return e?u(e,t.NEGATIVE_INFINITY):o(t.NEGATIVE_INFINITY)},t.toRect=function(e,t){return t||(t=n.create()),t[0]=e[0],t[1]=e[1],t[2]=e[3],t[3]=e[4],t},t.fromRect=function(e,t){return e[0]=t[0],e[1]=t[1],e[3]=t[2],e[4]=t[3],e},t.is=c,t.isPoint=function(e){return 0===a(e)&&0===s(e)&&0===l(e)},t.equals=function(e,t,r){if(null==e||null==t)return e===t;if(!c(e)||!c(t))return!1;if(r){for(var n=0;n<e.length;n++)if(!r(e[n],t[n]))return!1}else for(n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0},t.POSITIVE_INFINITY=i([-1/0,-1/0,-1/0,1/0,1/0,1/0]),t.NEGATIVE_INFINITY=i([1/0,1/0,1/0,-1/0,-1/0,-1/0]),t.ZERO=i([0,0,0,0,0,0])}.apply(null,n))||(e.exports=i)},391:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(342),r(340),r(379)],void 0===(i=function(e,t,r,n,i){function o(e,t){e.delete(t)}var a=i.MessageType.CLOSE,s=i.MessageType.CANCEL,l=i.MessageType.INVOKE,u=i.MessageType.RESPONSE,c=i.MessageType.OPEN_PORT,d=function(){function e(e){this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._invoke=e,this._timer=null,this._process=this._process.bind(this)}return e.prototype.push=function(e){e.type===i.MessageType.CANCEL?this._cancelledJobIds.add(e.jobId):(this._invokeMessages.push(e),null===this._timer&&(this._timer=setTimeout(this._process,0)))},e.prototype.clear=function(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null},e.prototype._process=function(){this._timer=null;for(var e=0,t=this._invokeMessages;e<t.length;e++){var r=t[e];this._cancelledJobIds.has(r.jobId)||this._invoke(r)}this._cancelledJobIds.clear(),this._invokeMessages.length=0},e}();return function(){function e(e,t,r){this._outJobs=new Map,this._inJobs=new Map,this._queue=new d(this._onInvoke.bind(this)),this._onMessage=this._onMessage.bind(this),this._client=t,this._port=e,this._port.addEventListener("message",this._onMessage),this._port.start(),this._channel=r}return e.connect=function(t){var r,n=new MessageChannel;return(r="function"==typeof t?new t:"default"in t&&"function"==typeof t.default?new t.default:t).remoteClient=new e(n.port1,r,n),n.port2},e.prototype.close=function(){this._post({type:a}),this._close()},e.prototype.isBusy=function(){return this._outJobs.size>0},e.prototype.invoke=function(e,t,a){var u=this;if(!this._port)return n.reject(new r("remote-client:port-closed","Can't invoke(), port is closed"));var c=i.newJobId(),d=function(){o(u._outJobs,c),u._post({type:s,jobId:c})};return n.create(function(r,n){var i={resolve:r,reject:n,cancel:d};u._outJobs.set(c,i),u._post({type:l,jobId:c,methodName:e},t,a)},d)},e.prototype.openPort=function(){var e=this,t=i.newJobId(),r=function(){o(e._outJobs,t),e._post({type:s,jobId:t})};return n.create(function(n,i){var o={resolve:n,reject:i,cancel:r};e._outJobs.set(t,o),e._post({type:c,jobId:t})},r)},e.prototype._close=function(){this._channel&&(this._channel=null),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach(function(e){e.cancel()}),this._inJobs.clear(),this._outJobs.clear(),this._queue.clear(),this._port=this._client=null},e.prototype._onMessage=function(e){var t=i.receiveMessage(e);if(t)switch(t.type){case u:this._onResponse(t);break;case l:this._queue.push(t);break;case s:this._onCancel(t);break;case a:this._close();break;case c:this._onOpenPort(t)}},e.prototype._onCancel=function(e){var t=this._inJobs,r=e.jobId,n=t.get(r);this._queue.push(e),n&&(o(t,r),n.cancel())},e.prototype._onInvoke=function(e){var t,r=this,a=e.methodName,s=e.jobId,l=e.data,c=this._inJobs,d=this._client,p=d[a];try{if(!p&&a&&-1!==a.indexOf("."))for(var f=a.split("."),h=0;h<f.length-1;h++)p=(d=d[f[h]])[f[h+1]];if("function"!=typeof p)throw new TypeError(a+" is not a function");t=p.call(d,l,this)}catch(e){return void this._post({type:u,jobId:s,error:i.toInvokeError(e)})}n.isThenable(t)?(c.set(s,t),t.then(function(e){c.has(s)&&(o(c,s),r._post({type:u,jobId:s},e))}).catch(function(e){c.has(s)&&(o(c,s),e&&"cancel"===e.dojoType||r._post({type:u,jobId:s,error:i.toInvokeError(e||{message:"Error encountered at method "+a})}))})):this._post({type:u,jobId:s},t)},e.prototype._onOpenPort=function(t){var r=new MessageChannel;new e(r.port1,this._client),this._post({type:u,jobId:t.jobId},r.port2,[r.port2])},e.prototype._onResponse=function(e){var t=e.jobId,n=e.error,i=e.data,a=this._outJobs;if(a.has(t)){var s=a.get(t);o(a,t),n?s.reject(r.fromJSON(JSON.parse(n))):s.resolve(i)}},e.prototype._post=function(e,t,r){return i.postMessage(this._port,e,t,r)},e}()}.apply(null,n))||(e.exports=i)},394:function(e,t,r){var n,i;n=[r(348),r(341),r(339),r(384),r(396),r(360),r(615),r(420)],void 0===(i=function(e,t,r,n,i,o,a,s){var l=e({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent"});return t.createSubclass({declaredClass:"esri.tasks.support.FeatureSet",getDefaults:function(){return r.mixin(this.inherited(arguments),{features:[]})},properties:{displayFieldName:null,exceededTransferLimit:null,features:{value:null,json:{read:function(e,t){for(var r=o.fromJSON(t.spatialReference),i=[],a=0;a<e.length;a++){var s=e[a],l=n.fromJSON(s),u=s.geometry&&s.geometry.spatialReference;l.geometry&&!u&&(l.geometry.spatialReference=r),i.push(l)}return t.transform&&this._hydrate(t.transform,t.geometryType,i),i}}},fields:{value:null,type:[i]},geometryType:{value:null,json:{read:l.read}},spatialReference:{type:o}},toJSON:function(e){var t={hasZ:this.hasZ,hasM:this.hasM};return this.displayFieldName&&(t.displayFieldName=this.displayFieldName),this.fields&&(t.fields=this.fields.map(function(e){return e.toJSON()})),this.spatialReference?t.spatialReference=this.spatialReference.toJSON():this.features[0]&&this.features[0].geometry&&(t.spatialReference=this.features[0].geometry.spatialReference.toJSON()),this.features[0]&&(this.features[0].geometry&&(t.geometryType=s.getJsonType(this.features[0].geometry)),t.features=a._encodeGraphics(this.features,e)),t.exceededTransferLimit=this.exceededTransferLimit,t.transform=this.transform,r.fixJson(t)},quantize:function(e){var t,r,n=e.translate[0],i=e.translate[1],o=e.scale[0],a=e.scale[1],s=this.features,l=function(e,t,r){var n,i,o,a,s,l,u,c=[];for(n=0,i=e.length;n<i;n++)o=e[n],n>0?(l=t(o[0]),u=r(o[1]),l===a&&u===s||(c.push([l-a,u-s]),a=l,s=u)):(a=t(o[0]),s=r(o[1]),c.push([a,s]));return c.length>0?c:null},u=function(e,t,r){return"point"===e?function(e){return e.x=t(e.x),e.y=r(e.y),e}:"polyline"===e||"polygon"===e?function(e){var n,i,o,a,s,u;for(u=[],n=0,i=(o=e.rings||e.paths).length;n<i;n++)a=o[n],(s=l(a,t,r))&&u.push(s);return u.length>0?(e.rings?e.rings=u:e.paths=u,e):null}:"multipoint"===e?function(e){var n;return(n=l(e.points,t,r)).length>0?(e.points=n,e):null}:"extent"===e?function(e){return e}:void 0}(this.geometryType,function(e){return Math.round((e-n)/o)},function(e){return Math.round((i-e)/a)});for(t=0,r=s.length;t<r;t++)u(s[t].geometry)||(s.splice(t,1),t--,r--);return this.transform=e,this},_hydrate:function(e,t,r){if(e){var n,i,o=e.translate[0],a=e.translate[1],s=e.scale[0],l=e.scale[1],u=function(e,t,r){return"esriGeometryPoint"===e?function(e){e.x=t(e.x),e.y=r(e.y)}:"esriGeometryPolyline"===e||"esriGeometryPolygon"===e?function(e){var n,i,o,a,s,l,u,c,d=e.rings||e.paths;for(n=0,i=d.length;n<i;n++)for(o=0,a=(s=d[n]).length;o<a;o++)l=s[o],o>0?(u+=l[0],c+=l[1]):(u=l[0],c=l[1]),l[0]=t(u),l[1]=r(c)}:"esriGeometryEnvelope"===e?function(e){e.xmin=t(e.xmin),e.ymin=r(e.ymin),e.xmax=t(e.xmax),e.ymax=r(e.ymax)}:"esriGeometryMultipoint"===e?function(e){var n,i,o,a,s,l=e.points;for(n=0,i=l.length;n<i;n++)o=l[n],n>0?(a+=o[0],s+=o[1]):(a=o[0],s=o[1]),o[0]=t(a),o[1]=r(s)}:void 0}(t,function(e){return e*s+o},function(e){return a-e*l});for(n=0,i=r.length;n<i;n++)r[n].geometry&&u(r[n].geometry)}}})}.apply(null,n))||(e.exports=i)},396:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(347),r(336),r(341),r(337),r(403),r(603)],void 0===(i=function(e,t,r,n,i,o,a,s){return function(e){function t(t){var r=e.call(this)||this;return r.alias=null,r.defaultValue=void 0,r.domain=null,r.editable=!0,r.length=-1,r.name=null,r.nullable=!0,r.type=null,r}var i;return r(t,e),i=t,t.prototype.clone=function(){return new i({alias:this.alias,defaultValue:this.defaultValue,domain:this.domain&&this.domain.clone()||null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type})},n([o.property({type:String,json:{write:!0}})],t.prototype,"alias",void 0),n([o.property({json:{write:{allowNull:!0}}})],t.prototype,"defaultValue",void 0),n([o.property({types:a.types,json:{read:{reader:a.fromJSON},write:!0}})],t.prototype,"domain",void 0),n([o.property({type:Boolean,json:{write:!0}})],t.prototype,"editable",void 0),n([o.property({type:Number,json:{write:!0}})],t.prototype,"length",void 0),n([o.property({type:String,json:{write:!0}})],t.prototype,"name",void 0),n([o.property({type:Boolean,json:{write:!0}})],t.prototype,"nullable",void 0),n([o.property({type:String,json:{read:s.kebabDict.read,write:s.kebabDict.write}})],t.prototype,"type",void 0),i=n([o.subclass("esri.layers.support.Field")],t)}(o.declared(i))}.apply(null,n))||(e.exports=i)},398:function(e,t,r){var n;void 0===(n=function(){return function(e,t){function r(e){return function(t){return n([e,t])}}function n(r){if(i)throw new TypeError("Generator is already executing.");for(;l;)try{if(i=1,o&&(a=2&r[0]?o.return:r[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,r[1])).done)return a;switch(o=0,a&&(r=[2&r[0],a.value]),r[0]){case 0:case 1:a=r;break;case 4:return l.label++,{value:r[1],done:!1};case 5:l.label++,o=r[1],r=[0];continue;case 7:r=l.ops.pop(),l.trys.pop();continue;default:if(!(a=(a=l.trys).length>0&&a[a.length-1])&&(6===r[0]||2===r[0])){l=0;continue}if(3===r[0]&&(!a||r[1]>a[0]&&r[1]<a[3])){l.label=r[1];break}if(6===r[0]&&l.label<a[1]){l.label=a[1],a=r;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(r);break}a[2]&&l.ops.pop(),l.trys.pop();continue}r=t.call(e,l)}catch(e){r=[6,e],o=0}finally{i=a=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var i,o,a,s,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s}}.apply(null,[]))||(e.exports=n)},401:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1509),r(1276)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=new n(function(e){var t=r;return e.split("/").forEach(function(e){t&&(t=t[e])}),t});t.resolveIncludes=function(e){return i.resolveIncludes(e)}}.apply(null,n))||(e.exports=i)},403:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(600),r(376),r(601),r(602)],void 0===(i=function(e,t,r,n,i,o){function a(e,t){switch(e.type){case"range":var r="range"in e?e.range[0]:e.minValue,n="range"in e?e.range[1]:e.maxValue;if(+t<r||+t>n)return s.VALUE_OUT_OF_RANGE;break;case"coded-value":case"codedValue":if(null==e.codedValues||e.codedValues.every(function(e){return null==e||e.code!==t}))return s.INVALID_CODED_VALUE}return null}var s;Object.defineProperty(t,"__esModule",{value:!0}),t.CodedValueDomain=r,t.DomainBase=n,t.InheritedDomain=i,t.RangeDomain=o,function(e){e.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",e.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"}(s=t.DomainValidationError||(t.DomainValidationError={})),t.isValidDomainValue=function(e,t){return null===a(e,t)},t.validateDomainValue=a,t.types={key:"type",base:t.DomainBase,typeMap:{range:t.RangeDomain,"coded-value":t.CodedValueDomain}},t.getDomainRange=function(e){if(e&&"range"===e.type)return{min:"range"in e?e.range[0]:e.minValue,max:"range"in e?e.range[1]:e.maxValue}},t.fromJSON=function(e){return e&&e.type?"range"===e.type?t.RangeDomain.fromJSON(e):"codedValue"===e.type?t.CodedValueDomain.fromJSON(e):null:null}}.apply(null,n))||(e.exports=i)},404:function(e,t,r){var n,i;n=[r(340)],void 0===(i=function(e){function t(t){return t&&"function"==typeof t.then?t:e.resolve(t)}return function(r,n,i,o){var a=null;return e.create(function(e,i){function s(e){try{u(o.next(e))}catch(e){i(e)}}function l(e){try{u(o.throw(e))}catch(e){i(e)}}function u(r){r.done?(a=t(r.value)).then(e,i):(a=t(r.value)).then(s,l)}u((o=o.apply(r,n||[])).next())},function(e){a&&a.cancel(e)})}}.apply(null,n))||(e.exports=i)},405:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.mapParameters=function e(t){var r={};for(var n in t)if("declaredClass"!==n){var i=t[n];if(null!=i&&"function"!=typeof i)if(Array.isArray(i)){r[n]=[];for(var o=0;o<i.length;o++)r[n][o]=e(i[o])}else"object"==typeof i?i.toJSON&&(r[n]=JSON.stringify(i)):r[n]=i}return r}}.apply(null,n))||(e.exports=i)},406:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(365),r(389),r(367),r(798),r(693),r(383),r(598),r(344),r(364)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,c){function d(e){var t=e.paths[0];if(!t||0===t.length)return null;var r=a.getPointOnPath(t,a.getPathLength(t)/2);return l.makeDehydratedPoint(r[0],r[1],r[2],e.spatialReference)}Object.defineProperty(t,"__esModule",{value:!0});var p=[1,1,1];t.computeCentroid=function(e){if("point"===e.type)return e;if(l.isHydratedGeometry(e))switch(e.type){case"extent":return e.center;case"polygon":return e.centroid;case"polyline":return d(e);case"mesh":return e.extent.center}else switch(e.type){case"extent":return function(e){var t=c.isFinite(e.zmin);return l.makeDehydratedPoint(.5*(e.xmax+e.xmin),.5*(e.ymax+e.ymin),t?.5*(e.zmax+e.zmin):void 0,e.spatialReference)}(e);case"polygon":return function(e){var t=e.rings[0];if(!t||0===t.length)return null;var r=o.ringsCentroid(e.rings,e.hasZ);return l.makeDehydratedPoint(r[0],r[1],r[2],e.spatialReference)}(e);case"polyline":return d(e)}},t.convertPointSR=function(e,t){var n=e.spatialReference;n.isWebMercator&&t.isWGS84?(s.xyToLngLat(e.x,e.y,f),e.x=f[0],e.y=f[1],e.spatialReference=r.SpatialReference.WGS84):t.isWebMercator&&n.isWGS84&&(s.lngLatToXY(e.x,e.y,f),e.x=f[0],e.y=f[1],e.spatialReference=r.SpatialReference.WebMercator)},t.enlargeExtent=function(e,t,r){if(e){t||(t=i.create());var n=e,o=.5*n.width*(r-1),a=.5*n.height*(r-1);return n.width<1e-7*n.height?o+=a/20:n.height<1e-7*n.width&&(a+=o/20),u.vec4d.set4(n.xmin-o,n.ymin-a,n.xmax+o,n.ymax+a,t),t}return null},t.updateVertexAttributeAuxpos1w=function(e,t){for(var r=0;r<e.geometries.length;++r){var n=e.geometries[r].data.vertexAttributes.auxpos1;n&&n.data[3]!==t&&(n.data[3]=t,e.geometryVertexAttrsUpdated(r))}},t.mixinColorAndOpacity=function(e,t){var r=[1,1,1,1];return null!=e&&(r[0]=e[0],r[1]=e[1],r[2]=e[2]),null!=t?r[3]=t:null!=e&&e.length>3&&(r[3]=e[3]),r},t.overrideColor=function(e,t,r,n,i,o){void 0===o&&(o=[0,0,0,0]);for(var a=0;a<3;++a)e&&null!=e[a]?o[a]=e[a]:r&&null!=r[a]?o[a]=r[a]:o[a]=i[a];return o[3]=null!=t?t:null!=n?n:i[3],o},t.computeObjectScale=function(e,t,r,n){void 0===e&&(e=p),void 0===n&&(n=1);var i=new Array(3);if(null==t||null==r)i[0]=1,i[1]=1,i[2]=1;else{for(var o=void 0,a=0,s=2;s>=0;s--){var l=e[s],u=void 0,c=null!=l,d=0===s&&!o&&!c,f=r[s];"symbolValue"===l||d?u=0!==f?t[s]/f:1:c&&"proportional"!==l&&isFinite(l)&&(u=0!==f?l/f:1),null!=u&&(i[s]=u,o=u,a=Math.max(a,Math.abs(u)))}for(s=2;s>=0;s--)null==i[s]?i[s]=o:0===i[s]&&(i[s]=.001*a)}for(s=2;s>=0;s--)i[s]/=n;return i},t.computeSizeWithResourceSize=function(e,t){var r=t.isPrimitive,n=t.width,i=t.depth,o=t.height,a=r?10:1;if(null==n&&null==o&&null==i)return[a*e[0],a*e[1],a*e[2]];for(var s,l=[n,i,o],u=0;u<3;u++){var c=l[u];if(null!=c){s=c/e[u];break}}for(u=0;u<3;u++)null==l[u]&&(l[u]=e[u]*s);return l},t.validateSymbolLayerSize=function(e){return function(e){return null!=e.isPrimitive}(e)&&(e=[e.width,e.depth,e.height]),function e(t){if(Array.isArray(t)){for(var r=0,n=t;r<n.length;r++)if(!e(n[r]))return!1;return!0}return null==t||t>=0}(e)?null:"Symbol sizes may not be negative values"},t.computeObjectRotation=function(e,t,r,n){void 0===n&&(n=u.mat4d.identity());var i=e||0,o=t||0,a=r||0;return 0!==i&&u.mat4d.rotateZ(n,-i/180*Math.PI,n),0!==o&&u.mat4d.rotateX(n,o/180*Math.PI,n),0!==a&&u.mat4d.rotateY(n,a/180*Math.PI,n),n},t.demResolutionForBoundingBox=function(e,t){return null!=t.minDemResolution?t.minDemResolution:n.isPoint(e)?t.minDemResolutionForPoints:.01*n.maximumDimension(e)};var f=[0,0]}.apply(null,n))||(e.exports=i)},407:function(e,t,r){var n,i;n=[r(353),r(339),r(357),r(593)],void 0===(i=function(e,t,r,n){var i={STYLE_SOLID:"solid",STYLE_DASH:"dash",STYLE_DOT:"dot",STYLE_DASHDOT:"dash-dot",STYLE_DASHDOTDOT:"long-dash-dot-dot",STYLE_NULL:"none",STYLE_SHORTDASH:"short-dash",STYLE_SHORTDOT:"short-dot",STYLE_SHORTDASHDOT:"short-dash-dot",STYLE_SHORTDASHDOTDOT:"short-dash-dot-dot",STYLE_LONGDASH:"long-dash",STYLE_LONGDASHDOT:"long-dash-dot",CAP_BUTT:"butt",CAP_ROUND:"round",CAP_SQUARE:"square",JOIN_MITER:"miter",JOIN_ROUND:"round",JOIN_BEVEL:"bevel"},o={color:[0,0,0,1],style:i.STYLE_SOLID,width:.75,cap:i.CAP_ROUND,join:i.JOIN_ROUND,miterLimit:7.5},a=e(n,{declaredClass:"esri.symbols.SimpleLineSymbol",properties:{type:"simple-line",style:{value:i.STYLE_SOLID,json:{read:function(e,r){return t.valueOf(this._jsonStyles,e)||void 0},write:function(e,t){t.style=this._jsonStyles[e]}}},cap:{value:i.CAP_ROUND,json:{write:{overridePolicy:function(e,t,r){return{enabled:"round"!==e&&(null==r||null==r.origin)}}}}},join:{value:i.JOIN_ROUND,json:{write:{overridePolicy:function(e,t,r){return{enabled:"round"!==e&&(null==r||null==r.origin)}}}}},miterLimit:{value:7.5,cast:r.toPt,json:{read:!1,write:!1}}},_jsonStyles:{solid:"esriSLSSolid",dash:"esriSLSDash",dot:"esriSLSDot","dash-dot":"esriSLSDashDot","long-dash-dot-dot":"esriSLSDashDotDot",none:"esriSLSNull","inside-frame":"esriSLSInsideFrame","short-dash":"esriSLSShortDash","short-dot":"esriSLSShortDot","short-dash-dot":"esriSLSShortDashDot","short-dash-dot-dot":"esriSLSShortDashDotDot","long-dash":"esriSLSLongDash","long-dash-dot":"esriSLSLongDashDot"},getDefaults:function(){return t.mixin(this.inherited(arguments),o)},normalizeCtorArgs:function(e,t,n,i,o,a){if(e&&"string"!=typeof e)return e;var s={};return null!=e&&(s.style=e),null!=t&&(s.color=t),null!=n&&(s.width=r.toPt(n)),null!=i&&(s.cap=i),null!=o&&(s.join=o),null!=a&&(s.miterLimit=r.toPt(a)),s},clone:function(){return new a({color:t.clone(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit})}});return t.mixin(a,i),a.defaultProps=o,a}.apply(null,n))||(e.exports=i)},411:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(382),r(657)],void 0===(i=function(e,t,r,n){var i=2;return function(){function e(e){var t=this;if(this.data=[],this._length=0,this._allocator=null,this._deallocator=function(e,r){return t.data[r]=void 0},this._shrink=function(){},this._hint=new r.RemoveHint,e){if(e.initialSize&&(this.data=new Array(e.initialSize)),e.allocator&&(this._allocator=e.allocator,this._deallocator=e.deallocator,e.initialSize))for(var n=0;n<e.initialSize;++n)this.data[n]=this._allocator(n);e.shrink&&(this._shrink=function(){t.data.length>i*t.length&&(t.data.length=t.length)})}}return e.prototype.toArray=function(){return this.data.slice(0,this.length)},Object.defineProperty(e.prototype,"length",{get:function(){return this._length},set:function(e){if(this._allocator)for(;this.data.length<e;)this.data.push(this._allocator(this.data.length));if(this._deallocator)for(var t=e;t<this._length;++t)this._deallocator(this.data[t],t);this._length=e,this._shrink()},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this.length=0},e.prototype.equal=function(e){return r.equals(this.data,e.data)},e.prototype.push=function(e){return this.data.length===this.length&&this._grow((this.length+1)*i),this.data[this.length++]=e,e},e.prototype.pushArray=function(e){var t=this.length+e.length;t>=this.data.length&&this._grow(Math.max(this.length*i,t));for(var r=0;r<e.length;r++)this.data[this._length++]=e[r];return this.back()},e.prototype.pushNew=function(){return this.data.length===this.length&&this._grow((this.length+1)*i),++this._length,this.back()},e.prototype.pop=function(){if(0!==this.length){var e=this.data[this.length-1];return this.length=this.length-1,this._shrink(),e}},e.prototype.removeMany=function(e){var t=this,r=[];return this.data=this.data.filter(function(n,i){return!(i>=t.length)&&(e.indexOf(n)<0||(r.push(n),!1))}),this._length=this.data.length,r},e.prototype.removeUnordered=function(e){var t=r.removeUnordered(this.data,e,this.length,this._hint);return void 0!==t&&(this.length=this.length-1),t},e.prototype.removeUnorderedMany=function(e){var t=r.removeUnorderedMany(this.data,e,this.length,this._hint);return this.length=this.length-t.length,t},e.prototype.front=function(){if(0!==this.length)return this.data[0]},e.prototype.back=function(){if(0!==this.length)return this.data[this.length-1]},e.prototype.swapElements=function(e,t){var r;e>=this.length||t>=this.length||(r=[this.data[t],this.data[e]],this.data[e]=r[0],this.data[t]=r[1])},e.prototype.sort=function(e){n.sort(this.data,0,this.length,e)},e.prototype.some=function(e,t){for(var r=0;r<this.length;++r)if(e.call(t,this.data[r],r,this.data))return!0;return!1},e.prototype.find=function(e,t){for(var r=0;r<this.length;++r){var n=this.data[r];if(e.call(t,n,r,this.data))return n}},e.prototype.filter=function(t,r,n){n=n||new e;for(var i=0;i<this.length;++i)t.call(r,this.data[i],i,this.data)&&n.push(this.data[i]);return n},e.prototype.forEach=function(e,t){for(var r=0;r<this.length;++r)e.call(t,this.data[r],r,this.data)},e.prototype.map=function(e,t){for(var r=new Array(this.length),n=0;n<this.length;++n)r[n]=e.call(t,this.data[n],n,this.data);return r},e.prototype._grow=function(e){if(this._allocator)for(;this.data.length<e;)this.data.push(this._allocator(this.data.length))},e}()}.apply(null,n))||(e.exports=i)},413:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(338),r(336),r(339),r(337),r(369),r(363),r(375)],void 0===(i=function(e,t,r,n,i,o,a,s,l){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.description=null,t.label=null,t.symbol=null,t.type="simple",t}var a;return r(t,e),a=t,t.prototype.writeSymbolWebScene=function(e,t,r,n){s.writeTarget(e,t,r,n)},t.prototype.writeSymbol=function(e,t,r,n){s.writeTarget(e,t,r,n)},t.prototype.readSymbol=function(e,t,r){return s.read(e,t,r)},t.prototype.getSymbol=function(e,t){return this.symbol},t.prototype.getSymbols=function(){return this.symbol?[this.symbol]:[]},t.prototype.clone=function(){return new a({description:this.description,label:this.label,symbol:this.symbol&&this.symbol.clone(),visualVariables:i.clone(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})},n([o.property({type:String,json:{write:!0}})],t.prototype,"description",void 0),n([o.property({type:String,json:{write:!0}})],t.prototype,"label",void 0),n([o.property({types:l.rendererTypes})],t.prototype,"symbol",void 0),n([o.writer("web-scene","symbol",{symbol:{types:l.rendererTypes3D}})],t.prototype,"writeSymbolWebScene",null),n([o.writer("symbol")],t.prototype,"writeSymbol",null),n([o.reader("symbol")],t.prototype,"readSymbol",null),n([o.enumeration.serializable()({simple:"simple"})],t.prototype,"type",void 0),a=n([o.subclass("esri.renderers.SimpleRenderer")],t)}(o.declared(a))}.apply(null,n))||(e.exports=i)},414:function(e,t,r){var n,i;n=[r(353),r(339),r(348),r(342),r(343),r(359),r(393),r(373),r(742),r(363),r(375),r(369),r(426),r(645)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,c,d,p,f){var h=i.getLogger("esri.renderers.ClassBreaksRenderer");p=p.LegendOptions,f=f.ClassBreakInfo;var m=r({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:"percent-of-total",esriNormalizeByField:"field"}),v=o.ensureType(f),g=e(d,{declaredClass:"esri.renderers.ClassBreaksRenderer",properties:{backgroundFillSymbol:{types:{base:s,key:"type",typeMap:{"simple-fill":c.types.typeMap["simple-fill"],"picture-fill":c.types.typeMap["picture-fill"],"polygon-3d":c.types.typeMap["polygon-3d"]}},value:null,json:{origins:{"web-scene":{read:u.read,write:{target:{backgroundFillSymbol:{type:l}},writer:u.writeTarget}}},read:u.read,write:u.writeTarget}},classBreakInfos:{type:[f],json:{read:function(e,t,r){if(Array.isArray(e)){var n=t.minValue;return e.map(function(e){var t=new f;return t.read(e,r),null==t.minValue&&(t.minValue=n),null==t.maxValue&&(t.maxValue=t.minValue),n=t.maxValue,t})}},write:function(e,t,r,n){e=e.map(function(e){return e.write({},n)}),this._areClassBreaksConsecutive()&&e.forEach(function(e){delete e.classMinValue}),t[r]=e}}},minValue:{type:Number,readOnly:!0,dependsOn:["classBreakInfos"],get:function(){return this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0},json:{read:!1,write:{overridePolicy:function(){return 0!==this.classBreakInfos.length&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}},defaultLabel:{type:String,value:null,json:{write:!0}},defaultSymbol:{types:c.rendererTypes,value:null,json:{origins:{"web-scene":{read:u.read,write:{target:{defaultSymbol:{types:c.rendererTypes3D}},writer:u.writeTarget}}},read:u.read,write:u.writeTarget}},valueExpression:{type:String,value:null,json:{write:!0}},valueExpressionTitle:{type:String,value:null,json:{write:!0}},compiledFunc:{dependsOn:["valueExpression"],get:function(){return a.createFunction(this.valueExpression)}},legendOptions:{type:p,value:null,json:{write:!0}},field:{value:null,cast:function(e){return null==e?e:"function"==typeof e?e:o.ensureString(e)},json:{type:String,write:function(e,t,r,i){"string"==typeof e?t[r]=e:i&&i.messages?i.messages.push(new n("property:unsupported","ClassBreaksRenderer.field set to a function cannot be written to JSON")):h.error(".field: cannot write field to JSON since it's not a string value")}}},isMaxInclusive:!0,normalizationField:{type:String,value:null,json:{write:!0}},normalizationTotal:{type:Number,value:null,json:{write:!0}},normalizationType:{type:m.apiValues,value:null,dependsOn:["normalizationField","normalizationTotal"],get:function(){var e=this._get("normalizationType"),t=!!this.normalizationField,r=null!=this.normalizationTotal;return t||r?(e=t?"field":r&&"percent-of-total",t&&r&&console.warn("warning: both normalizationField and normalizationTotal are set!")):"field"!==e&&"percent-of-total"!==e||(e=null),e},json:{type:m.jsonValues,read:m.read,write:m.write}},requiredFields:{dependsOn:["field","normalizationField","valueExpression"]},type:{type:["class-breaks"],value:"class-breaks",json:{type:["classBreaks"]}}},constructor:function(){this.classBreakInfos=[]},addClassBreakInfo:function(e,r,n){var i;i="number"==typeof e?new f({minValue:e,maxValue:r,symbol:n}):v(t.clone(e)),this.classBreakInfos.push(i),1===this.classBreakInfos.length&&this.notifyChange("minValue")},removeClassBreakInfo:function(e,t){var r,n,i=this.classBreakInfos.length;for(n=0;n<i;n++)if((r=[this.classBreakInfos[n].minValue,this.classBreakInfos[n].maxValue])[0]==e&&r[1]==t){this.classBreakInfos.splice(n,1);break}},getBreakIndex:function(e,t){var r,n,i,o=this.field,s=this.classBreakInfos,l=e.attributes,u=s.length,c=this.isMaxInclusive;if(this.valueExpression)r=a.executeFunction(this.compiledFunc,a.createExecContext(e,a.getViewInfo(t)));else if("function"==typeof o)r=o(e);else{r=parseFloat(l[o]);var d,p,f=this.normalizationType;if(f)if(d=parseFloat(this.normalizationTotal),p=parseFloat(l[this.normalizationField]),"log"===f)r=Math.log(r)*Math.LOG10E;else if("percent-of-total"!==f||isNaN(d)){if("field"===f&&!isNaN(p)){if(isNaN(r)||isNaN(p))return-1;r/=p}}else r=r/d*100}if(null!=r&&!isNaN(r)&&"number"==typeof r)for(n=0;n<u;n++)if((i=[s[n].minValue,s[n].maxValue])[0]<=r&&(c?r<=i[1]:r<i[1]))return n;return-1},getClassBreakInfo:function(e,t){var r=this.getBreakIndex(e,t);return-1!==r?this.classBreakInfos[r]:null},getSymbol:function(e,t){var r=this.getBreakIndex(e,t);return r>-1?this.classBreakInfos[r].symbol:this.defaultSymbol},getSymbols:function(){var e=[];return this.classBreakInfos.forEach(function(t){t.symbol&&e.push(t.symbol)}),this.defaultSymbol&&e.push(this.defaultSymbol),e},clone:function(){return new g({field:this.field,backgroundFillSymbol:this.backgroundFillSymbol&&this.backgroundFillSymbol.clone(),defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol&&this.defaultSymbol.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:t.clone(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:t.clone(this.visualVariables),legendOptions:t.clone(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})},collectRequiredFields:function(e){this.inherited(arguments),[this.field,this.normalizationField].forEach(function(t){t&&(e[t]=!0)}),this.valueExpression&&a.extractFieldNames(this.valueExpression).forEach(function(t){e[t]=!0})},_areClassBreaksConsecutive:function(){for(var e=this.classBreakInfos,t=1;t<e.length;t++)if(e[t-1].maxValue!==e[t].minValue)return!1;return!0}});return g}.apply(null,n))||(e.exports=i)},415:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(338),r(336),r(362),r(339),r(337),r(369),r(646)],void 0===(i=function(e,t,r,n,i,o,a,s,l){return function(e){function t(t){var r=e.call(this)||this;return r.blurRadius=10,r.colorStops=[new l.HeatmapColorStop({ratio:0,color:new i("rgba(255, 140, 0, 0)")}),new l.HeatmapColorStop({ratio:.75,color:new i("rgba(255, 140, 0, 1)")}),new l.HeatmapColorStop({ratio:.9,color:new i("rgba(255, 0,   0, 1)")})],r.field=null,r.fieldOffset=0,r.maxPixelIntensity=100,r.minPixelIntensity=0,r.type="heatmap",r}var s;return r(t,e),s=t,t.prototype.clone=function(){return new s({blurRadius:this.blurRadius,colorStops:o.clone(this.colorStops),field:this.field,maxPixelIntensity:this.maxPixelIntensity,minPixelIntensity:this.minPixelIntensity})},n([a.property({type:Number,json:{write:!0}})],t.prototype,"blurRadius",void 0),n([a.property({type:[l.HeatmapColorStop],json:{write:!0}})],t.prototype,"colorStops",void 0),n([a.property({type:String,json:{write:!0}})],t.prototype,"field",void 0),n([a.property({type:Number,json:{write:{overridePolicy:function(e,t,r){return{enabled:null==r}}}}})],t.prototype,"fieldOffset",void 0),n([a.property({type:Number,json:{write:!0}})],t.prototype,"maxPixelIntensity",void 0),n([a.property({type:Number,json:{write:!0}})],t.prototype,"minPixelIntensity",void 0),n([a.property({dependsOn:["field"],readOnly:!0})],t.prototype,"requiredFields",void 0),n([a.enumeration.serializable()({heatmap:"heatmap"})],t.prototype,"type",void 0),s=n([a.subclass("esri.renderers.HeatmapRenderer")],t)}(a.declared(s))}.apply(null,n))||(e.exports=i)},416:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(338),r(336),r(387),r(435),r(382),r(342),r(339),r(343),r(350),r(337),r(359),r(408),r(369),r(620),r(426),r(647),r(393),r(363),r(632),r(375)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,c,d,p,f,h,m,v,g,y,b,_,x){var w=u.getLogger("esri.renderers.UniqueValueRenderer"),S=p.ensureType(g.default);return function(e){function t(t){var r=e.call(this)||this;return r._valueInfoMap={},r._isDefaultSymbolDerived=!1,r.type="unique-value",r.backgroundFillSymbol=null,r.field=null,r.field2=null,r.field3=null,r.valueExpression=null,r.valueExpressionTitle=null,r.legendOptions=null,r.defaultLabel=null,r.fieldDelimiter=null,r.portal=null,r.styleOrigin=null,r.diff={uniqueValueInfos:function(e,t){if(e||t){if(!e||!t)return{type:"complete",oldValue:e,newValue:t};for(var r=!1,n={type:"collection",added:[],removed:[],changed:[],unchanged:[]},i=0;i<t.length;i++)!function(i){var o=a.find(e,function(e){return e.value===t[i].value});o?m.diff(o,t[i])?(n.changed.push({type:"complete",oldValue:o,newValue:t[i]}),r=!0):(n.unchanged.push({oldValue:o,newValue:t[i]}),r=!0):(n.added.push(t[i]),r=!0)}(i);for(i=0;i<e.length;i++)!function(i){a.find(t,function(t){return t.value===e[i].value})||(n.removed.push(e[i]),r=!0)}(i);return r?n:void 0}}},r._set("uniqueValueInfos",[]),r}var u;return r(t,e),u=t,t.prototype.writeBackgroundFillSymbolWebScene=function(e,t,r,n){b.writeTarget(e,t,r,n)},t.prototype.castField=function(e){return null==e?e:"function"==typeof e?e:p.ensureString(e)},t.prototype.writeField=function(e,t,r,n){"string"==typeof e?t[r]=e:n&&n.messages?n.messages.push(new s("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):w.error(".field: cannot write field to JSON since it's not a string value")},Object.defineProperty(t.prototype,"compiledFunc",{get:function(){return y.createFunction(this.valueExpression)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"defaultSymbol",{set:function(e){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",e)},enumerable:!0,configurable:!0}),t.prototype.readDefaultSymbol=function(e,t,r){return b.read(e,t,r)},t.prototype.writeDefaultSymbolWebScene=function(e,t,r,n){this._isDefaultSymbolDerived||b.writeTarget(e,t,r,n)},t.prototype.writeDefaultSymbol=function(e,t,r,n){this._isDefaultSymbolDerived||b.writeTarget(e,t,r,n)},t.prototype.readPortal=function(e,t,r){return r.portal||f.getDefault()},t.prototype.readStyleOrigin=function(e,t,r){if(t.styleName)return Object.freeze({styleName:t.styleName});if(t.styleUrl){var n=c.read(t.styleUrl,r);return Object.freeze({styleUrl:n})}},t.prototype.writeStyleOrigin=function(e,t,r,n){e.styleName?t.styleName=e.styleName:e.styleUrl&&(t.styleUrl=c.write(e.styleUrl,n),c.isAbsolute(t.styleUrl)&&(t.styleUrl=c.normalize(t.styleUrl)))},Object.defineProperty(t.prototype,"uniqueValueInfos",{set:function(e){this.styleOrigin?w.error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",e),this._updateValueInfoMap())},enumerable:!0,configurable:!0}),t.prototype.addUniqueValueInfo=function(e,t){var r;this.styleOrigin?w.error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(r="object"==typeof e?S(e):new g.default({value:e,symbol:t}),this.uniqueValueInfos.push(r),this._valueInfoMap[r.value]=r)},t.prototype.removeUniqueValueInfo=function(e){if(this.styleOrigin)w.error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");else for(var t=0;t<this.uniqueValueInfos.length;t++)if(this.uniqueValueInfos[t].value===e+""){delete this._valueInfoMap[e],this.uniqueValueInfos.splice(t,1);break}},t.prototype.getUniqueValueInfo=function(e,t){var r,n=this.field,i=e.attributes;if(this.valueExpression)r=y.executeFunction(this.compiledFunc,y.createExecContext(e,y.getViewInfo(t)));else if("function"!=typeof n&&this.field2){var o=this.field2,a=this.field3,s=[];n&&s.push(i[n]),o&&s.push(i[o]),a&&s.push(i[a]),r=s.join(this.fieldDelimiter||"")}else"function"==typeof n?r=n(e):n&&(r=i[n]);return this._valueInfoMap[r+""]},t.prototype.getSymbol=function(e,t){var r=this.getUniqueValueInfo(e,t);return r&&r.symbol||this.defaultSymbol},t.prototype.getSymbols=function(){for(var e=[],t=0,r=this.uniqueValueInfos;t<r.length;t++){var n=r[t];n.symbol&&e.push(n.symbol)}return this.defaultSymbol&&e.push(this.defaultSymbol),e},t.prototype.clone=function(){var e=new u({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:l.clone(this.defaultSymbol),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:l.clone(this.visualVariables),legendOptions:l.clone(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),backgroundFillSymbol:l.clone(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(e._isDefaultSymbolDerived=!0),e._set("portal",this.portal);var t=l.clone(this.uniqueValueInfos);return this.styleOrigin&&(e._set("styleOrigin",Object.freeze(l.clone(this.styleOrigin))),Object.freeze(t)),e._set("uniqueValueInfos",t),e._updateValueInfoMap(),e},t.prototype.collectRequiredFields=function(e){this.inherited(arguments),[this.field,this.field2,this.field3].forEach(function(t){t&&"string"==typeof t&&(e[t]=!0)}),this.valueExpression&&y.extractFieldNames(this.valueExpression).forEach(function(t){e[t]=!0})},t.prototype.populateFromStyle=function(){var e=this;return _.fetchStyle(this.styleOrigin,{portal:this.portal}).then(function(t){var r=[];return e._valueInfoMap={},t&&t.data&&Array.isArray(t.data.items)&&t.data.items.forEach(function(n){var i=new o.WebStyleSymbol({styleUrl:t.styleUrl,styleName:t.styleName,portal:e.portal,name:n.name});e.defaultSymbol||n.name!==t.data.defaultItem||(e.defaultSymbol=i,e._isDefaultSymbolDerived=!0);var a=new g.default({value:n.name,symbol:i});r.push(a),e._valueInfoMap[n.name]=a}),e._set("uniqueValueInfos",Object.freeze(r)),!e.defaultSymbol&&e.uniqueValueInfos.length&&(e.defaultSymbol=e.uniqueValueInfos[0].symbol,e._isDefaultSymbolDerived=!0),e})},t.prototype._updateValueInfoMap=function(){var e=this;this._valueInfoMap={},this.uniqueValueInfos.forEach(function(t){return e._valueInfoMap[t.value+""]=t})},t.fromPortalStyle=function(e,t){var r=new u(t&&t.properties);r._set("styleOrigin",Object.freeze({styleName:e})),r._set("portal",t&&t.portal||f.getDefault());var n=r.populateFromStyle();return n.catch(function(t){w.error("#fromPortalStyle('"+e+"'[, ...])","Failed to create unique value renderer from style name",t)}),n},t.fromStyleUrl=function(e,t){var r=new u(t&&t.properties);r._set("styleOrigin",Object.freeze({styleUrl:e}));var n=r.populateFromStyle();return n.catch(function(t){w.error("#fromStyleUrl('"+e+"'[, ...])","Failed to create unique value renderer from style URL",t)}),n},n([d.enumeration.serializable()({uniqueValue:"unique-value"})],t.prototype,"type",void 0),n([d.property({types:{base:o.BaseSymbol,key:"type",typeMap:{"simple-fill":x.rendererTypes.typeMap["simple-fill"],"picture-fill":x.rendererTypes.typeMap["picture-fill"],"polygon-3d":x.rendererTypes.typeMap["polygon-3d"]}},json:{read:b.read,write:b.writeTarget}})],t.prototype,"backgroundFillSymbol",void 0),n([d.writer("web-scene","backgroundFillSymbol",{backgroundFillSymbol:{type:o.PolygonSymbol3D}})],t.prototype,"writeBackgroundFillSymbolWebScene",null),n([d.property({json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],t.prototype,"field",void 0),n([d.cast("field")],t.prototype,"castField",null),n([d.writer("field")],t.prototype,"writeField",null),n([d.property({type:String,json:{write:!0}})],t.prototype,"field2",void 0),n([d.property({type:String,json:{write:!0}})],t.prototype,"field3",void 0),n([d.property({type:String,json:{write:!0}})],t.prototype,"valueExpression",void 0),n([d.property({type:String,json:{write:!0}})],t.prototype,"valueExpressionTitle",void 0),n([d.property({dependsOn:["valueExpression"]})],t.prototype,"compiledFunc",null),n([d.property({type:v.default,json:{write:!0}})],t.prototype,"legendOptions",void 0),n([d.property({type:String,json:{write:!0}})],t.prototype,"defaultLabel",void 0),n([d.property({types:x.rendererTypes})],t.prototype,"defaultSymbol",null),n([d.reader("defaultSymbol")],t.prototype,"readDefaultSymbol",null),n([d.writer("web-scene","defaultSymbol",{defaultSymbol:{types:x.rendererTypes3D}})],t.prototype,"writeDefaultSymbolWebScene",null),n([d.writer("defaultSymbol")],t.prototype,"writeDefaultSymbol",null),n([d.property({type:String,json:{write:!0}})],t.prototype,"fieldDelimiter",void 0),n([d.property({type:f,readOnly:!0})],t.prototype,"portal",void 0),n([d.reader("portal",["styleName"])],t.prototype,"readPortal",null),n([d.property({readOnly:!0})],t.prototype,"styleOrigin",void 0),n([d.reader("styleOrigin",["styleName","styleUrl"])],t.prototype,"readStyleOrigin",null),n([d.writer("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],t.prototype,"writeStyleOrigin",null),n([d.property({type:[g.default],json:{write:{overridePolicy:function(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],t.prototype,"uniqueValueInfos",null),n([d.property({dependsOn:["field","field2","field3","valueExpression"],readOnly:!0})],t.prototype,"requiredFields",void 0),n([i(1,d.cast(x.ensureType))],t.prototype,"addUniqueValueInfo",null),u=n([d.subclass("esri.renderers.UniqueValueRenderer")],t)}(d.declared(h))}.apply(null,n))||(e.exports=i)},419:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){var r;return function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.INTERNAL_MATERIAL=1]="INTERNAL_MATERIAL",e[e.STENCIL_MATERIAL=2]="STENCIL_MATERIAL",e[e.OPAQUE_TERRAIN=3]="OPAQUE_TERRAIN",e[e.OPAQUE_MATERIAL=4]="OPAQUE_MATERIAL",e[e.OPAQUE_EXTERNAL=5]="OPAQUE_EXTERNAL",e[e.TRANSPARENT_MATERIAL=6]="TRANSPARENT_MATERIAL",e[e.TRANSPARENT_EXTERNAL=7]="TRANSPARENT_EXTERNAL",e[e.TRANSPARENT_TERRAIN=8]="TRANSPARENT_TERRAIN",e[e.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS",e[e.POSTPROCESSING_HIGHLIGHT=10]="POSTPROCESSING_HIGHLIGHT",e[e.POSTPROCESSING_ATMOSPHERE_OPAQUE=11]="POSTPROCESSING_ATMOSPHERE_OPAQUE",e[e.POSTPROCESSING_ATMOSPHERE_TRANSPARENT=12]="POSTPROCESSING_ATMOSPHERE_TRANSPARENT",e[e.POSTPROCESSING_EXTERNAL=13]="POSTPROCESSING_EXTERNAL",e[e.HUDMATERIAL1=14]="HUDMATERIAL1",e[e.HUDMATERIAL2=15]="HUDMATERIAL2",e[e.LINE_CALLOUTS=16]="LINE_CALLOUTS",e[e.LINE_CALLOUTS_HUD_DEPTH=17]="LINE_CALLOUTS_HUD_DEPTH",e[e.MAX_SLOTS=18]="MAX_SLOTS"}(r||(r={})),r}.apply(null,n))||(e.exports=i)},421:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(342),r(402),r(440),r(414),r(415),r(413),r(416)],void 0===(i=function(e,t,r,n,i,o,a,s,l){function u(e,t,r){if(!e)return null;if(e&&(e.styleName||e.styleUrl)&&"uniqueValue"!==e.type)return r&&r.messages&&r.messages.push(new i("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+e.type+"'",{definition:e,context:r})),null;var n=function(e){return e&&d[e.type]||null}(e);if(n){var o=new n;return o.read(e,r),o}return r&&r.messages&&e&&r.messages.push(new i("renderer:unsupported","Renderers of type '"+(e.type||"unknown")+"' are not supported",{definition:e,context:r})),null}function c(e,t,n){return e?n&&"web-scene"===n.origin&&"heatmap"===e.type?(n.messages&&n.messages.push(new r("renderer:unsupported","Renderer of type '"+e.declaredClass+"' are not supported in scenes.",{renderer:e,context:n})),null):e.write(t,n):null}Object.defineProperty(t,"__esModule",{value:!0});var d={simple:s,uniqueValue:l,classBreaks:o,heatmap:a};t.read=u,t.writeTarget=function(e,t,r,i){var o=c(e,{},i);o&&n.setDeepValue(r,o,t)},t.write=c,t.fromJSON=function(e,t){return u(e,0,t)}}.apply(null,n))||(e.exports=i)},422:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(372),r(439),r(385),r(371),r(381)],void 0===(i=function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0}),t.createQuadVAO=function(e,t){void 0===t&&(t=n.Pos2);var o=null;switch(t){case n.Pos3Tex:o=new Float32Array([-1,-1,0,0,0,1,-1,0,1,0,-1,1,0,0,1,1,1,0,1,1]);break;case n.Pos3:o=new Float32Array([-1,-1,0,1,-1,0,-1,1,0,1,1,0]);break;case n.Pos2Tex:o=new Float32Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]);break;case n.Pos2:default:o=new Float32Array([-1,-1,1,-1,-1,1,1,1])}return new a(e,r.Default3D,{geometry:t},{geometry:i.createVertex(e,35044,o)})};var s=4;t.createEmptyTexture=function(e,t){return void 0===t&&(t=s),new o(e,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:t,height:t})},t.createColorTexture=function(e,t,r){void 0===r&&(r=s);for(var n=new Uint8Array(r*r*4),i=0;i<n.length;i+=4)n[i+0]=255*t[0],n[i+1]=255*t[1],n[i+2]=255*t[2],n[i+3]=255*t[3];return new o(e,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:r,height:r},n)}}.apply(null,n))||(e.exports=i)},424:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(389),r(344),r(364),r(430),r(1288),r(1009),r(349)],void 0===(i=function(e,t,r,n,i,o,a,s,l){function u(e,t,n,i,o){var a=f(t,n,_);if(r.setMin(y,e.getBBMin()),r.setMax(y,e.getBBMax()),h(y,t,a,i)){var s=e.getPrimitiveIndices(),l=e.getIndices(),c=e.getPosition(),p=s?s.length:l.length/3;if(p>A){var m=e.getChildren();if(void 0!==m){for(var v=0;v<8;++v)void 0!==m[v]&&u(m[v],t,n,i,o);return}}d(t,n,0,p,l,c,s,o)}}function c(e,t,n,i,a,s){var l=f(n,i,_),u=e.boundingInfo;if(r.setMin(y,u.getBBMin()),r.setMax(y,u.getBBMax()),h(y,n,l,a))for(var c=e.data,p=e.componentCount,m=c.getIndices(b.POSITION),v=c.getAttribute(b.POSITION),g=c.componentOffsets,x=0;x<p;x++)if(!t||o.getVisibility(t,x)){if(h(e.getComponentAABB(x,y),n,l,a))d(n,i,g[x]/3,g[x+1]/3,m,v,void 0,s)}}function d(e,t,r,n,i,o,a,s){for(var l=o.data,u=o.offsetIdx,c=o.strideIdx,d=e[0],f=e[1],h=e[2],m=t[0]-d,v=t[1]-f,g=t[2]-h,y=r;y<n;y++){var b=a?a[y]:y,_=u+c*i[3*b],S=u+c*i[3*b+1],T=u+c*i[3*b+2],E=l[_],C=l[_+1],O=l[_+2],P=l[S]-E,A=l[S+1]-C,I=l[S+2]-O,R=l[T]-E,M=l[T+1]-C,D=l[T+2]-O,F=v*D-M*g,L=g*R-D*m,N=m*M-R*v,j=P*F+A*L+I*N,V=d-E,U=f-C,B=h-O,z=U*I-A*B,k=B*P-I*V,G=V*A-P*U;if(j>x){if((H=V*F+U*L+B*N)<0||H>j)continue;if((q=m*z+v*k+g*G)<0||H+q>j)continue}else{if(!(j<-x))continue;var H,q;if((H=V*F+U*L+B*N)>0||H<j)continue;if((q=m*z+v*k+g*G)>0||H+q<j)continue}var W=(R*z+M*k+D*G)/j;W>=0&&s(W,p(P,A,I,R,M,D,w),b)}}function p(e,t,r,i,o,a,s){return n.vec3d.set3(e,t,r,S),n.vec3d.set3(i,o,a,T),n.vec3d.normalize(n.vec3d.cross(S,T,s))}function f(e,t,r){return n.vec3d.set3(1/(t[0]-e[0]),1/(t[1]-e[1]),1/(t[2]-e[2]),r)}function h(e,t,r,n){var i=(e[0]-n-t[0])*r[0],o=(e[3]+n-t[0])*r[0],a=Math.min(i,o),s=Math.max(i,o),l=(e[1]-n-t[1])*r[1],u=(e[4]+n-t[1])*r[1];if((a=Math.max(a,Math.min(l,u)))>(s=Math.min(s,Math.max(l,u))))return!1;var c=(e[2]-n-t[2])*r[2],d=(e[5]+n-t[2])*r[2];return(a=Math.max(a,Math.min(c,d)))<=(s=Math.min(s,Math.max(c,d)))}function m(e,t,r,n,i){return s.scale(e,n,r,i)}function v(e){var t=[];return e.forEach(function(e){return t.push(e)}),t}Object.defineProperty(t,"__esModule",{value:!0});var g=n.mat4d.create(),y=r.create(),b=l.VertexAttrConstants;t.IDENTITY=n.mat4d.identity(),t.intersectTriangleGeometry=function(e,t,r,n,i,a,s){l.assert("triangle"===e.data.primitiveType);var d=t&&t.componentVisibilities,p=n.tolerance;e.componentCount>1?c(e,d,i,a,p,s):d&&!o.getVisibility(d,0)||u(e.boundingInfo,i,a,p,s)};var _=n.vec3d.create(),x=Math.pow(2,-52),w=n.vec3d.create();t.intersectTriangles=d;var S=n.vec3d.create(),T=n.vec3d.create();t.computeNormal=p,t.intersectAabbInvDir=h,t.transformToWorld=function(e,t,r){return n.vec4d.set4(e[0]-t[0],e[1]-t[1],e[2]-t[2],1,r)},t.transformToView=function(e,t,r,i){return n.mat4d.translate(r,t,g),r=g,n.mat4d.multiplyVec4(r,e,i)},t.transformToProjection=function(e,t,r,i){return i[0]=e[0]+r[0],i[1]=e[1]+r[1],i[2]=e[2]+r[2],i[3]=e[3],n.mat4d.multiplyVec4(t,i)},t.transformToNDC=function(e,t){return n.vec4d.scale(e,1/Math.abs(e[3]),t)},t.applyScreenSizePerspectiveScale=m,t.verticalOffsetAtDistance=function(e,t,r,n,o){var a=r.screenLength||0;o&&(a=m(a,0,t,n,o));var s=a*Math.tan(.5*e.fovY)/(.5*e.fullHeight);return i.clamp(s*t,r.minWorldLength||0,null!=r.maxWorldLength?r.maxWorldLength:1/0)},t.aquireIfNotUndefined=function(e,t,r){if(void 0!==e)return t.aquire(e,r)},t.releaseIfNotUndefined=function(e,t){void 0!==e&&t.release(e)};var E=n.mat4.create();t.bindView=function(e,t,r){n.mat4d.translate(t,e,E),r.setUniform3fv("localOrigin",e),r.setUniformMatrix4fv("view",E)},t.bindCamPos=function(e,t,r){r.setUniform3f("camPos",t[3]-e[0],t[7]-e[1],t[11]-e[2])};var C=n.vec3d.create(),O=n.vec3d.create();t.bindViewOriginDouble=function(e,t){a.encodeDoubleArraySplit(e,C,O,3),t.setUniform3fv("viewOriginHi",C),t.setUniform3fv("viewOriginLo",O)};var P=n.vec3d.create();t.bindSlicePlane=function(e,t,r){n.vec3d.subtract(t.origin,e,P),r.setUniform3fv("slicePlaneOrigin",P),r.setUniform3fv("slicePlaneBasis1",t.basis1),r.setUniform3fv("slicePlaneBasis2",t.basis2)},t.bindVerticalOffset=function(e,t,r){if(e){var n=function(e,t,r,n){return void 0===n&&(n=I),n.screenLength=e.screenLength,n.perDistance=Math.tan(.5*t)/(.5*r),n.minWorldLength=e.minWorldLength,n.maxWorldLength=e.maxWorldLength,n}(e,t.fovY,t.viewport[3]),i=t.pixelRatio||1;r.setUniform4f("verticalOffset",n.screenLength*i,n.perDistance,n.minWorldLength,n.maxWorldLength)}},t.bindScreenSizePerspective=function(e,t,r,n){if(void 0===n&&(n="screenSizePerspectiveAlignment"),e){var i=e.parameters,o=t.pixelRatio||1,a=e.paddingPixelsOverride;r.setUniform4f(n,i.divisor,i.offset,i.minPixelSize*o,a)}},t.copyParameters=function e(t,r){var n=r?e(r):{};for(var i in t){var o=t[i];o&&o.forEach&&(o=v(o)),null==o&&i in n||(n[i]=o)}return n},t.updateParameters=function(e,t){var r=!1;for(var n in t){var i=t[n];void 0!==i&&(r=!0,Array.isArray(i)?e[n]=i.slice():e[n]=i)}return r},function(e){function t(e){return(e.shadowMappingEnabled?1:0)|(e.ssaoEnabled?2:0)}e.create=function(e,r){for(var n=[],i=0;i<2;i++)for(var o=0;o<2;o++){var a=t({shadowMappingEnabled:1===i,ssaoEnabled:1===o}),s=t({shadowMappingEnabled:1===i,ssaoEnabled:1===o&&e.receiveSSAO});n[a]=n[s]||r({receiveShadows:1===i,receiveSSAO:1===o&&e.receiveSSAO})}return{programs:n.filter(function(e){return null!=e}),byParameter:n}},e.lookup=function(e,r){return e.byParameter[t(r)]},e.programs=function(e){return e.programs}}(t.BindParametersMap||(t.BindParametersMap={})),t.colorMixModes={multiply:1,ignore:2,replace:3,tint:4};var A=1e3,I={screenLength:0,perDistance:0,minWorldLength:0,maxWorldLength:0}}.apply(null,n))||(e.exports=i)},425:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(338),r(336),r(346),r(337)],void 0===(i=function(e,t,r,n,i,o){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.minScale=0,t.maxScale=0,t}return r(t,e),n([o.property({type:Number,json:{write:!0}})],t.prototype,"minScale",void 0),n([o.property({type:Number,json:{write:!0}})],t.prototype,"maxScale",void 0),n([o.subclass("esri.layers.mixins.ScaleRangeLayer")],t)}(o.declared(i))}.apply(null,n))||(e.exports=i)},426:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(338),r(336),r(341),r(337)],void 0===(i=function(e,t,r,n,i,o){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.title=null,t}var i;return r(t,e),i=t,t.prototype.clone=function(){return new i({title:this.title})},n([o.property({type:String,json:{write:!0}})],t.prototype,"title",void 0),i=n([o.subclass("esri.renderers.support.LegendOptions")],t)}(o.declared(i));t.LegendOptions=a,t.default=a}.apply(null,n))||(e.exports=i)},427:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1}}();t.default=r}.apply(null,n))||(e.exports=i)},429:function(e,t,r){var n,i;n=[r(772),r(341),r(339),r(348),r(687),r(661),r(455),r(648),r(393),r(723),r(363),r(375)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,c,d){function p(e){var t=l.createSyntaxTree(e),r=t&&t.body&&t.body[0]&&t.body[0].body&&t.body[0].body.body;if(!r||1!==r.length)return null;var n="ExpressionStatement"===r[0].type&&r[0].expression;if(!n||"MemberExpression"!==n.type)return null;var i=n.object;if(!i||"Identifier"!==i.type||"$feature"!==i.name)return null;var o=n.property;if(!o)return null;switch(o.type){case"Literal":return o.value;case"Identifier":return o.name}return null}function f(e){return!e||"service"!==e.origin&&(!e.layer||!s.isOfType(e.layer,"map-image"))}var h=n({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0}),m=new u,v=t.createSubclass({declaredClass:"esri.layers.support.LabelClass",properties:{name:{type:String,value:null,json:{write:!0}},labelExpression:{type:String,value:null,json:{read:function(e,t,r,n){var i=t.labelExpressionInfo;if(!i||!i.value&&!i.expression)return e},write:{allowNull:!0,writer:function(e,t,r,n){if(this.labelExpressionInfo&&f(n))if(null!=this.labelExpressionInfo.value)e=this._templateStringToSql(this.labelExpressionInfo.value);else if(null!=this.labelExpressionInfo.expression){var i=p(this.labelExpressionInfo.expression);i&&(e="["+i+"]")}null!=e&&(t[r]=e)}}}},labelExpressionInfo:{value:null,type:o,json:{write:{overridePolicy:function(e,t,r){return f(r)?{allowNull:!0}:{enabled:!1}},writer:function(e,t,r,n){if(null==e&&null!=this.labelExpression&&f(n))e=new o({expression:this.getLabelExpressionArcade()});else if(!e)return;var i=e.toJSON(n);i.expression&&(t[r]=i)}}}},labelPlacement:{type:h.apiValues,value:null,json:{type:h.jsonValues,read:h.read,write:h.write}},maxScale:{type:Number,value:0,json:{write:function(e,t){(e||this.minScale)&&(t.maxScale=e)}}},minScale:{type:Number,value:0,json:{write:function(e,t){(e||this.maxScale)&&(t.minScale=e)}}},requiredFields:{readOnly:!0,dependsOn:["labelExpression","labelExpressionInfo","where"],get:function(){var e=Object.create(null);return this._collectRequiredFields(e),Object.keys(e)}},symbol:{value:null,types:d.labelTypes,json:{origins:{"web-scene":{read:c.read,write:{target:{symbol:{types:d.labelTypes3D}},writer:c.writeTarget}}},read:c.read,write:c.writeTarget}},useCodedValues:{type:Boolean,value:null,json:{write:!0}},where:{type:String,value:null,json:{write:!0}}},getLabelExpression:function(){var e={expression:"",type:"none"};return this.labelExpressionInfo?this.labelExpressionInfo.value?(e.expression=this.labelExpressionInfo.value,e.type="conventional"):this.labelExpressionInfo.expression&&(e.expression=this.labelExpressionInfo.expression,e.type="arcade"):null!=this.labelExpression&&(e.expression=this._sqlToTemplateString(this.labelExpression),e.type="conventional"),e},getLabelExpressionArcade:function(){var e=this.getLabelExpression();if(!e)return null;switch(e.type){case"conventional":return a.convertTemplatedStringToArcade(e.expression);case"arcade":return e.expression}return null},getOptions:function(e){var t={spatialReference:e},r=this.labelExpressionInfo;if(r){var n=r.expression;n&&!r.value&&(t.hasArcadeExpression=!0,t.compiledArcadeFunc=l.createFunction(n))}return t},getLabelExpressionSingleField:function(){var e=this.getLabelExpression();if(!e)return null;switch(e.type){case"conventional":return function(e){var t=e.match(g);return t&&t[1].trim()||null}(e.expression);case"arcade":return p(e.expression)}return null},clone:function(){return new v({labelExpression:this.labelExpression,labelExpressionInfo:r.clone(this.labelExpressionInfo),labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,symbol:this.symbol.clone(),where:this.where,useCodedValues:this.useCodedValues})},_collectRequiredFields:function(e){this._collectLabelExpressionRequiredFields(this.getLabelExpression(),e),this._collectWhereRequiredFields(this.where,e)},_sqlToTemplateString:function(e){return e.replace(new RegExp("\\[","g"),"{").replace(new RegExp("\\]","g"),"}")},_templateStringToSql:function(e){return e.replace(new RegExp("\\{","g"),"[").replace(new RegExp("\\}","g"),"]")},_collectWhereRequiredFields:function(e,t){if(null!=e){var r=e.split(" ");3===r.length&&(t[r[0]]=!0),7===r.length&&(t[r[0]]=!0,t[r[4]]=!0)}},_collectLabelExpressionRequiredFields:function(e,t){if("arcade"===e.type)l.extractFieldNames(e.expression).forEach(function(e){t[e]=!0});else{var r=e.expression.match(/{[^}]*}/g);r&&r.forEach(function(e){t[e.slice(1,-1)]=!0})}}});v.evaluateWhere=function(e,t){var r=function(e,t,r){switch(t){case"=":return e==r;case"<>":return e!=r;case">":return e>r;case">=":return e>=r;case"<":return e<r;case"<=":return e<=r}return!1};try{if(null==e)return!0;var n=e.split(" ");if(3===n.length)return r(t[n[0]],n[1],n[2]);if(7===n.length){var i=r(t[n[0]],n[1],n[2]),o=n[3],a=r(t[n[4]],n[5],n[6]);switch(o){case"AND":return i&&a;case"OR":return i||a}}return!1}catch(t){console.log("Error.: can't parse = "+e)}},v.buildLabelText=function(e,t,r,n){var i="";if(n&&n.hasArcadeExpression){if(n.compiledArcadeFunc){m.repurposeFromGraphicLikeObject(t.geometry,t.attributes,{fields:r});var o={vars:{$feature:m},spatialReference:n.spatialReference},a=l.executeFunction(n.compiledArcadeFunc,o);null!=a&&(i=a.toString())}}else{var s=t&&t.attributes||{};i=e.replace(/{[^}]*}/g,function(e){return v.formatField(e.slice(1,-1),e,s,r,n)})}return i},v.formatField=function(t,n,o,a,s){var l,u,c=n,d=t.toLowerCase();for(l=0;l<a.length;l++)if(a[l].name.toLowerCase()===d){c=o[a[l].name];var p=a[l].domain;if(p&&"object"==typeof p){if("codedValue"==p.type)for(u=0;u<p.codedValues.length;u++)p.codedValues[u].code==c&&(c=p.codedValues[u].name);else"range"==p.type&&p.minValue<=c&&c<=p.maxValue&&(c=p.name);return null==c?"":c}var f=a[l].type;if("date"==f){var h=e.fromJSON(s&&s.dateFormat||"shortDate"),m="DateFormat"+e.getFormat(h);m&&(c=r.substitute({myKey:c},"{myKey:"+m+"}"))}else"integer"!=f&&"small-integer"!=f&&"long"!=f&&"double"!=f||s&&s.numberFormat&&s.numberFormat.digitSeparator&&s.numberFormat.places&&(c=i.format(c,{places:s.numberFormat.places}))}return null==c?"":c};var g=/^\s*\{([^}]+)\}\s*$/i;return v}.apply(null,n))||(e.exports=i)},430:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(382)],void 0===(i=function(e,t,r){function n(e,t){if(null!=e){var r=e.isVisibleBit,n=e.data,i=v(n);return t<n.length*i?m(r,n,t,i):h(e)}return!0}function i(e){return null===e.component?-1:e.component}function o(e,t,r,i,o){n(t,i)&&a(e,t,r,r[i],y(r[i+1]),o)}function a(e,t,r,n,i,o){var a=e.length>0?e[e.length-1]:null,s=a?a.range[1]:-1,l=a?a.options:null;if(!(s>=n))if(s+1===n&&l===o)a.range[1]=i;else{var u={range:[n,i],options:o};e.push(u)}}function s(e){return void 0===e&&(e=!0),{isVisibleBit:!e,data:new Uint32Array(0)}}function l(e,t){return!c(e,t)}function u(e,t){return d(e,t,!0)}function c(e,t){return d(e,t,!1)}function d(e,t,r){var n=!1,i=(e=e||_).isVisibleBit,o=e.data,a=b(t),s=v(o),l=o.length*s,u=r===i;if(0===o.length||0===a)n=!u;else if(l<a&&!u)n=!0;else{for(var c=g(s),d=g(0),p=0;p<o.length-1;p++)if(n=!u&&o[p]!==c||u&&o[p]!==d)return n;var f=o.length-1,h=g((a-1)%s+1);n=!u&&(o[f]&h)!==h||u&&(o[f]&h)!==d}return n}function p(e,t){return t<b(e)}function f(e){return e.length>0}function h(e){return!e.isVisibleBit}function m(e,t,r,n){var i=r/n|0,o=r-i*n;return function(e,t){return 0!=(e&1<<t)}(t[i],o)===e}function v(e){return 8*e.BYTES_PER_ELEMENT}function g(e){return x[e]}function y(e){return e-1}function b(e){return Math.max(0,e.length-1)}Object.defineProperty(t,"__esModule",{value:!0}),t.updateVisibility=function(e,t,r,n){if(p(t,r)){null==e&&(e=s());var i=e.isVisibleBit,o=e.data,a=v(o),l=r/a|0,u=r-a*l,c=(b(t)-1)/a|0,d=o,f=n===i;if(!(r<d.length*a)&&f){var h=l+1,m=Math.ceil(1.5*d.length),g=c+1,y=Math.max(h,m);y=Math.min(y,g),(o=new Uint32Array(y)).set(d)}l<o.length&&(o[l]=function(e,t,r){return e&~(1<<t)|(r?1:0)<<t}(o[l],u,f)),e.data=o}return e},t.getVisibility=n,t.hideAllComponents=function(e){var t;if(null==e)t=s(!1);else{(t=e).isVisibleBit=!0;for(var r=0;r<t.data.length;r++)t.data[r]=0}return t},t.unhideAllComponents=function(e){var t;if(null==e);else{(t=e).isVisibleBit=!1;for(var r=0;r<t.data.length;r++)t.data[r]=0}return t},t.generateVisibleIndexRanges=function(e,t){var r;if(e)if(f(t))if(0===e.data.length){var n=[],i=[[t[0],y(t[t.length-1])]];r=h(e)?i:n}else{r=[];for(var o=e.isVisibleBit,a=e.data,s=v(a),l=a.length*s,u=b(t),c=!1,d=0;d<l&&d<u;d++){var p=m(o,a,d,s);if(p!==c){var g=t[d];p?r.push([g,0]):(x=r[r.length-1])[1]=y(g),c=p}}var _=h(e);if(u>l&&_&&!c)r.push([t[l],y(t[u])]);else if(c){var x=r[r.length-1],w=_?u:Math.min(u,l);x[1]=y(t[w])}}else n=[],i=null,r=h(e)?i:n;else r=null;return r},t.addHighlight=function(e,t,r,n){var o,a={component:t,options:r,id:n};(e=e||[]).push(a);for(var s=i(a),l=e.length-1;l>0&&s<i(e[l-1]);)o=[e[l],e[l-1]],e[l-1]=o[0],e[l]=o[1],--l;return e},t.removeHighlight=function(e,t){if(e){var r=e.filter(function(e){return e.id!==t});return 0===r.length?null:r}return e},t.generateHighlightedIndexRanges=function(e,t,r){if(!t)return null;if(!f(r))return!e||h(e)?t.map(function(e){return{range:null,options:e.options}}):null;for(var n=r[0],i=y(r[r.length-1]),s=[],u=l(e,r),c=0;c<t.length;++c){var d=t[c].options,p=t[c].component;if(null!==p)o(s,e,r,p,d);else if(u)a(s,0,0,n,i,d);else for(var m=0;m<b(r);++m)o(s,e,r,m,d)}return s.length>0?s:null},t.defaultVisibilities=s,t.isAllVisible=l,t.isAllHidden=function(e,t){return!u(e,t)},t.hasVisible=u,t.hasHidden=c;var _=s();t.createOffsets=function(e){return Array.isArray(e)?new Uint32Array(e):e},t.hasComponent=p,t.hasComponents=f;for(var x=[],w=0;w<65;w++)x.push(Math.pow(2,w)-1);t.componentCount=b,t.componentFind=function(e,t){var n=r.binaryIndexOf(e,t,!0);return n>=0?n:null}}.apply(null,n))||(e.exports=i)},432:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(445),r(395),r(596)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0}),t.screenSizePerspectiveEnabled={type:Boolean,value:!0,json:{origins:{"web-scene":{read:{source:["id","url","layerType"],reader:function(e,t){return null==t.screenSizePerspective&&"defaults"===this.originOf("screenSizePerspectiveEnabled")?void n.getProperties(this).store.set("screenSizePerspectiveEnabled",!1,r.OriginId.DEFAULTS):t.screenSizePerspective}},write:{ignoreOrigin:!0,target:"screenSizePerspective",writer:function(e,t,r,n){"defaults"===this.originOf("screenSizePerspectiveEnabled")&&e?t[r]=e:i.willPropertyWrite(this,"screenSizePerspectiveEnabled",{},n)&&(t[r]=e)}}}}}},t.popupEnabled={type:Boolean,value:!0,json:{read:{source:"disablePopup",reader:function(e,t){return!t.disablePopup}},write:{target:"disablePopup",writer:function(e,t,r){t[r]=!e}}}},t.labelsVisible={type:Boolean,json:{read:{source:"showLabels"},write:{target:"showLabels"}}}}.apply(null,n))||(e.exports=i)},439:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Pos3=[{name:"position",count:3,type:5126,offset:0,stride:12,normalized:!1}],t.Pos3Tex=[{name:"position",count:3,type:5126,offset:0,stride:20,normalized:!1},{name:"uv0",count:2,type:5126,offset:12,stride:20,normalized:!1}],t.Pos3Col=[{name:"position",count:3,type:5126,offset:0,stride:16,normalized:!1},{name:"color",count:4,type:5121,offset:12,stride:16,normalized:!1}],t.Pos2=[{name:"position",count:2,type:5126,offset:0,stride:8,normalized:!1}],t.Pos2Tex=[{name:"position",count:2,type:5126,offset:0,stride:16,normalized:!1},{name:"uv0",count:2,type:5126,offset:8,stride:16,normalized:!1}]}.apply(null,n))||(e.exports=i)},441:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(338),r(336),r(346),r(337)],void 0===(i=function(e,t,r,n,i,o){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.refreshInterval=0,t}return r(t,e),t.prototype.refresh=function(){this.emit("refresh")},n([o.property({type:Number,cast:function(e){return e>=.1?e:e<=0?0:.1},json:{write:!0}})],t.prototype,"refreshInterval",void 0),n([o.subclass("esri.layers.mixins.RefreshableLayer")],t)}(o.declared(i))}.apply(null,n))||(e.exports=i)},443:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(609)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}(r)}.apply(null,n))||(e.exports=i)},444:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(338),r(336),r(341),r(339),r(337)],void 0===(i=function(e,t,r,n,i,o,a){return function(e){function t(t){var r=e.call(this,t)||this;return r.attachmentTypes=null,r.definitionExpression=null,r.globalIds=null,r.num=null,r.objectIds=null,r.size=null,r.start=null,r}var i;return r(t,e),i=t,t.prototype.writeStart=function(e,t,r){t.resultOffset=this.start,t.resultRecordCount=this.num||10},t.prototype.clone=function(){return new i(o.clone({attachmentTypes:this.attachmentTypes,definitionExpression:this.definitionExpression,globalIds:this.globalIds,num:this.num,objectIds:this.objectIds,size:this.size,start:this.start}))},n([a.property({type:[String],json:{write:!0}})],t.prototype,"attachmentTypes",void 0),n([a.property({type:String,json:{write:!0}})],t.prototype,"definitionExpression",void 0),n([a.property({type:[Number],json:{write:!0}})],t.prototype,"globalIds",void 0),n([a.property({type:Number,json:{read:{source:"resultRecordCount"}}})],t.prototype,"num",void 0),n([a.property({type:[Number],json:{write:!0}})],t.prototype,"objectIds",void 0),n([a.property({type:[Number],json:{write:!0}})],t.prototype,"size",void 0),n([a.property({type:Number,json:{read:{source:"resultOffset"}}})],t.prototype,"start",void 0),n([a.writer("start"),a.writer("num")],t.prototype,"writeStart",null),i=n([a.subclass("esri.tasks.support.AttachmentQuery")],t)}(a.declared(i))}.apply(null,n))||(e.exports=i)},447:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(338),r(336),r(365),r(341),r(339),r(337)],void 0===(i=function(e,t,r,n,i,o,a,s){return function(e){function t(t){var r=e.call(this,t)||this;return r.definitionExpression=null,r.gdbVersion=null,r.geometryPrecision=void 0,r.historicMoment=null,r.maxAllowableOffset=void 0,r.objectIds=null,r.outFields=null,r.outSpatialReference=null,r.relationshipId=void 0,r.returnGeometry=!1,r.source=null,r}var o;return r(t,e),o=t,t.prototype._writeHistoricMoment=function(e,t){t.historicMoment=e&&e.getTime()},t.prototype.clone=function(){return new o(a.clone({definitionExpression:this.definitionExpression,gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&this.historicMoment.getTime(),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,returnGeometry:this.returnGeometry,source:this.source}))},n([s.property({type:String,json:{write:!0}})],t.prototype,"definitionExpression",void 0),n([s.property({type:String,json:{write:!0}})],t.prototype,"gdbVersion",void 0),n([s.property({type:Number,json:{write:!0}})],t.prototype,"geometryPrecision",void 0),n([s.property({type:Date})],t.prototype,"historicMoment",void 0),n([s.writer("historicMoment")],t.prototype,"_writeHistoricMoment",null),n([s.property({type:Number,json:{write:!0}})],t.prototype,"maxAllowableOffset",void 0),n([s.property({type:[Number],json:{write:!0}})],t.prototype,"objectIds",void 0),n([s.property({type:[String],json:{write:!0}})],t.prototype,"outFields",void 0),n([s.property({type:i.SpatialReference,json:{read:{source:"outSR"},write:{target:"outSR"}}})],t.prototype,"outSpatialReference",void 0),n([s.property({json:{write:!0}})],t.prototype,"relationshipId",void 0),n([s.property({json:{write:!0}})],t.prototype,"returnGeometry",void 0),n([s.property({json:{write:!0}})],t.prototype,"source",void 0),o=n([s.subclass("esri.tasks.support.RelationshipQuery")],t)}(s.declared(o))}.apply(null,n))||(e.exports=i)},451:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(592),r(402),r(403)],void 0===(i=function(e,t,r,n,i){function o(e,t,r){if(e)for(var i=0,o=e;i<o.length;i++){var s=o[i],l=n.getDeepValue(s,t),u=l&&"function"!=typeof l&&a(l,r);u&&n.setDeepValue(s,u.name,t)}}function a(e,t){if("string"!=typeof e)return null;if(null!=t){e=e.toLowerCase();for(var r=0,n=t;r<n.length;r++){var i=n[r];if(i&&i.name.toLowerCase()===e)return i}}return null}function s(e){return"number"==typeof e&&!isNaN(e)&&isFinite(e)}function l(e){return null===e||s(e)}function u(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}function c(e){return null===e||u(e)}function d(e){return null!=e&&"string"==typeof e}function p(e){return null===e||d(e)}function f(e){return!0}function h(e,t){var r;switch(e.type){case"date":case"integer":case"long":case"small-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":r=e.nullable?c:u;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":r=e.nullable?l:s;break;case"string":case"esriFieldTypeString":r=e.nullable?p:d;break;default:r=f}return 1===arguments.length?r:r(t)}function m(e){return null!=e&&x.has(e.type)}function v(e,t){return e.nullable&&null===t?null:m(e)&&!g(e.type,t)?b.OUT_OF_RANGE:h(e,t)?e.domain?i.validateDomainValue(e.domain,t):null:_.INVALID_TYPE}function g(e,t){var r=y(e);return!!r&&t>=r.min&&t<=r.max}function y(e){switch(e){case"esriFieldTypeSmallInteger":case"small-integer":return{min:-32768,max:32767};case"esriFieldTypeInteger":case"integer":return{min:-2147483648,max:2147483647};case"esriFieldTypeSingle":case"single":return{min:-3.4e38,max:1.2e38};case"esriFieldTypeDouble":case"double":var t=Number.MAX_VALUE;return{min:-Number.MAX_VALUE,max:t}}}Object.defineProperty(t,"__esModule",{value:!0}),t.fixRendererFields=function(e,r){if(null!=e&&null!=r)for(var n=0,i=Array.isArray(e)?e:[e];n<i.length;n++){var a=i[n];if(o(t.rendererFields,a,r),a.visualVariables)for(var s=0,l=a.visualVariables;s<l.length;s++){var u=l[s];o(t.visualVariableFields,u,r)}}},t.getField=a,t.getFieldDefaultValue=function(e){var t=e.defaultValue;return void 0!==t&&h(e,t)?t:e.nullable?null:void 0},t.isValueMatchingFieldType=h,t.rendererFields=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],t.visualVariableFields=["field","normalizationField"],t.numericTypes=["integer","small-integer","single","double"];var b,_,x=new r.default(t.numericTypes.concat(["esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]));t.isNumericField=m,t.isStringField=function(e){return null!=e&&("string"===e.type||"esriFieldTypeString"===e.type)},t.isDateField=function(e){return null!=e&&("date"===e.type||"esriFieldTypeDate"===e.type)},t.isValidFieldValue=function(e,t){return null===v(e,t)},(b=t.NumericRangeValidationError||(t.NumericRangeValidationError={})).OUT_OF_RANGE="numeric-range-validation-error::out-of-range",(_=t.TypeValidationError||(t.TypeValidationError={})).INVALID_TYPE="type-validation-error::invalid-type",t.validateFieldValue=v,t.isNumberInRange=g,t.getFieldRange=function(e){var t=i.getDomainRange(e.domain);return t||(m(e)?y(e.type):void 0)},t.validationErrorToString=function(e,t,r){switch(e){case i.DomainValidationError.INVALID_CODED_VALUE:return"Value "+r+" is not in the coded domain - field: "+t.name+", domain: "+JSON.stringify(t.domain);case i.DomainValidationError.VALUE_OUT_OF_RANGE:return"Value "+r+" is out of the range of valid values - field: "+t.name+", domain: "+JSON.stringify(t.domain);case _.INVALID_TYPE:return"Value "+r+" is not a valid value for the field type - field: "+t.name+", type: "+t.type+", nullable: "+t.nullable;case b.OUT_OF_RANGE:var n=y(t.type),o=n.min,a=n.max;return"Value "+r+" is out of range for the number type - field: "+t.name+", type: "+t.type+", value range is "+o+" to "+a}}}.apply(null,n))||(e.exports=i)},452:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){return function(){function e(){this._count=0}return e.prototype.gen=function(e){return null==e&&(e="a"),e+"_"+this._count++},e}()}.apply(null,n))||(e.exports=i)},454:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(340)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.when=function e(t,n){return Array.isArray(n)?r.create(function(e){t(n,function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];e(t)})}):e(t,[n]).then(function(e){return e[0]})},t.getAbsMid=function(e,t,r){return t.toAbsMid?t.toAbsMid(e):r.id.replace(/\/[^\/]*$/gi,"/")+e}}.apply(null,n))||(e.exports=i)},455:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(662)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n="__begin__",i="__end__",o=new RegExp(n,"ig"),a=new RegExp(i,"ig"),s=new RegExp("^"+n,"i"),l=new RegExp(i+"$","i"),u='"',c=u+" + ",d=" + "+u;t.convertTemplatedStringToArcade=function(e){var t;return e?(t=r.replace(e,function(e,t){return n+'$feature["'+t+'"]'+i}),t=s.test(t)?t.replace(s,""):u+t,t=(t=l.test(t)?t.replace(l,""):t+u).replace(o,c).replace(a,d)):t='""',t}}.apply(null,n))||(e.exports=i)},457:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(338),r(336),r(341),r(337)],void 0===(i=function(e,t,r,n,i,o){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=null,t}return r(t,e),n([o.property({type:String,readOnly:!0,json:{read:!1,write:!0}})],t.prototype,"type",void 0),n([o.subclass("esri.layers.support.FeatureReduction")],t)}(o.declared(i));t.FeatureReduction=a,t.default=a}.apply(null,n))||(e.exports=i)},458:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(348),r(339)],void 0===(i=function(e,t,r,n){function i(e){return null!=e&&e.hasOwnProperty("mapLayerId")}function o(e){return null!=e&&e.hasOwnProperty("dataSource")}function a(e){return e?(i(e)&&(e.type=t.MAPLAYER),o(e)&&(e.type=t.DATALAYER,e.dataSource.type||function(e){e.workspaceId?e.gdbVersion?e.type="table":e.query||e.oidFields?e.type="query-table":e.type="raster":e.leftTableKey&&e.rightTableKey&&e.leftTableSource&&e.rightTableSource&&(e.type="join-table",e.leftTableSource=a(e.leftTableSource),e.rightTableSource=a(e.rightTableSource))}(e.dataSource)),e):e}function s(e){var r={};return e.type===t.MAPLAYER?(r.mapLayerId=e.mapLayerId,e.gdbVersion&&(r.gdbVersion=e.gdbVersion)):e.type===t.DATALAYER&&(e.fields&&(r.fields=e.fields),r.dataSource=function(e){var t;switch(e.type){case"table":t={dataSourceName:e.dataSourceName,workspaceId:e.workspaceId,gdbVersion:e.gdbVersion};break;case"query-table":t={geometryType:u.toJSON(e.geometryType),workspaceId:e.workspaceId,query:e.query,oidFields:e.oidFields,spatialReference:e.spatialReference};break;case"join-table":t={leftTableSource:s(e.leftTableSource),rightTableSource:s(e.rightTableSource),leftTableKey:e.leftTableKey,rightTableKey:e.rightTableKey,joinType:p.toJSON(e.joinType)};break;case"raster":t={workspaceId:e.workspaceId,dataSourceName:e.dataSourceName}}return t.type=d.toJSON(e.type),n.fixJson(t)}(e.dataSource)),r.type=c.toJSON(e.type),n.fixJson(r)}function l(e){var r={};return c.fromJSON(e.type)===t.MAPLAYER?(r.mapLayerId=e.mapLayerId,e.gdbVersion&&(r.gdbVersion=e.gdbVersion)):c.fromJSON(e.type)===t.DATALAYER&&(e.fields&&(r.fields=e.fields),r.dataSource=function(e){var t;switch(e.type){case"table":t={dataSourceName:e.dataSourceName,workspaceId:e.workspaceId,gdbVersion:e.gdbVersion};break;case"queryTable":t={geometryType:u.fromJSON(e.geometryType),workspaceId:e.workspaceId,query:e.query,oidFields:e.oidFields,spatialReference:e.spatialReference};break;case"joinTable":t={leftTableSource:l(e.leftTableSource),rightTableSource:l(e.rightTableSource),leftTableKey:e.leftTableKey,rightTableKey:e.rightTableKey,joinType:p.fromJSON(e.joinType)};break;case"raster":t={workspaceId:e.workspaceId,dataSourceName:e.dataSourceName}}return t.type=d.fromJSON(e.type),n.fixJson(t)}(e.dataSource)),r.type=c.fromJSON(e.type),n.fixJson(r)}Object.defineProperty(t,"__esModule",{value:!0}),t.MAPLAYER="map-layer",t.DATALAYER="data-layer";var u=r({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),c=r({mapLayer:t.MAPLAYER,dataLayer:t.DATALAYER}),d=r({joinTable:"join-table",queryTable:"query-table"}),p=r({esriLeftOuterJoin:"left-outer-join",esriLeftInnerJoin:"left-inner-join"});t.isMapLayerSource=i,t.isDataLayerSource=o,t.castSource=a,t.sourceToJSON=s,t.sourceFromJSON=l}.apply(null,n))||(e.exports=i)},459:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){return function(){function e(){}return e.LAYER="layers",e.OBJECT="objects",e.GEOMETRY="geometries",e.MATERIAL="materials",e.TEXTURE="textures",e}()}.apply(null,n))||(e.exports=i)},462:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(344),r(459),r(629),r(735),r(841)],void 0===(i=function(e,t,r,n,i,o,a){return function(){function e(e,t,n,s){this.sceneIntersectionHelper=s,this._viewContent=[],this.container=t,this.viewingMode=e,this.model=new o,this.view=new a(t,this,this.model.getDirtySet(),n),this.view.setLighting({lights:[new i.MainLight(r.vec3d.createFrom(.7,.7,.7)),new i.AmbientLight(r.vec3d.createFrom(.3,.3,.3))],groundLightingFactor:.5,globalFactor:.5})}return e.prototype.setNeedsRender=function(){this.view.setNeedsRender()},e.prototype.dispose=function(){this.view.dispose(),this.view=null,this.model=null},e.prototype.add=function(e,t){this.model.add(e,t),"function"==typeof t.addParentStage&&t.addParentStage(this)},e.prototype.remove=function(e,t){var r=this.model.remove(e,t);return"function"==typeof r.removeParentStage&&r.removeParentStage(this),r},e.prototype.notifyDirty=function(e,t,r,n){this.model.notifyDirty(e,t,r,n)},e.prototype.processDirty=function(){var t=this.model.getDirtySet(),r=t.getDirtyMaterials();if(t.hasDirtyGeometryRecords()||r){e.DebugSettings.endFrameContentValidation&&this.model.validateContent(),e.DebugSettings.logDirtySet&&console.log("Dirty set: "+this.model.getDirtySet().formatDebugInfo(!1));var n=t.commitLayers(this._viewContent);(n[0].length+n[1].length+n[2].length>0||r)&&this.view.modify(n[0],n[1],n[2],r),e.DebugSettings.logDirtySet&&(console.log("RGs add: "+n[0].map(function(e){return e.uniqueName})),console.log("RGs remove: "+n[1].map(function(e){return e.uniqueName}))),t.commit(),t.clearDirtyMaterials(),this.view.setNeedsRender()}},e.prototype.processDirtyLayer=function(e){var t=this.model.getDirtySet(),r=t.getDirtyMaterials(),n=t.commitLayers([e]);(n[0].length+n[1].length+n[2].length>0||r)&&this.view.modify(n[0],n[1],n[2],r),t.clearDirtyMaterials(),this.view.setNeedsRender()},e.prototype.get=function(e,t){return this.model.get(e,t)},e.prototype.getAll=function(e){return this.model.getAll(e)},e.prototype.getCamera=function(){return this.view.getCamera()},e.prototype.setCamera=function(e){this.view.setCamera(e)},e.prototype.getViewParams=function(e){return this.view.getViewParams(e)},e.prototype.setViewParams=function(e){this.view.setViewParams(e)},e.prototype.getLayers=function(){return this.model.getAll(n.LAYER)},e.prototype.setLighting=function(e){this.view.setLighting(e)},e.prototype.getCanvas=function(){return this.view.getCanvas()},e.prototype.setRenderParams=function(e){this.view.setRenderParams(e)},e.prototype.getRenderParams=function(){return this.view.getRenderParams()},e.prototype.getIdleSuspend=function(){return this.view.getIdleSuspend()},e.prototype.has=function(e){return this.view.has(e)},e.prototype.getViewContent=function(){return this._viewContent.slice(0)},e.prototype.addToViewContent=function(e){for(var t=[],r=0;r<e.length;r++)-1===this._viewContent.indexOf(e[r])&&t.push(e[r]);if(e.length>0){this.processDirty();var n=this.model.getDirtySet().getResidentRenderGeometriesFilteredByLayers(t);this.view.modify(n,[],[]),this._viewContent.push.apply(this._viewContent,t)}},e.prototype.removeFromViewContent=function(e){this.processDirty();for(var t=this.model.getDirtySet(),r=this._viewContent,n=[],i=0;i<e.length;i++){var o=r.indexOf(e[i]);o>-1&&(r[o]=r[r.length-1],r.pop(),n.push(e[i]))}var a=t.getResidentRenderGeometriesFilteredByLayers(n);this.view.modify([],a,[])},e.prototype.getFrameTask=function(){return this.view.getFrameTask()},e.prototype.takeScreenshot=function(e){return this.view.takeScreenshot(e)},e.prototype.addRenderPlugin=function(e,t){return"function"==typeof t.intersect&&this.sceneIntersectionHelper.addIntersectionHandler(t),this.view.renderPlugins.add(e,t)},e.prototype.removeRenderPlugin=function(e){return this.sceneIntersectionHelper.removeIntersectionHandler(e),this.view.renderPlugins.remove(e)},e.prototype.getContentDebugStrings=function(e){return this.model.formatDebugInfo(e)},e.prototype.getRenderStats=function(){return this.view.getCombinedStats()},e.prototype.getRenderStatString=function(e){var t=this.getRenderStats(),r="";if(e){for(var n in r+="<table>",t)r+="<tr><td>"+n+'</td><td style="text-align: right">'+Math.round(t[n])+"</td></tr>";r+="</table>"}else for(var n in t)r+=n+": "+t[n]+"\n";return r},e.prototype.getFramebufferTexture=function(e){return void 0===e&&(e="color"),this.view.getFramebufferTexture(e)},e.prototype.getDrapedTextureRenderer=function(){return this.view.getDrapedTextureRenderer()},e.DebugSettings={endFrameContentValidation:!1,logDirtySet:!1},e.ModelContentType=n,e}()}.apply(null,n))||(e.exports=i)},464:function(e,t,r){var n,i;n=[r(373),r(407)],void 0===(i=function(e,t){return e.createSubclass({declaredClass:"esri.symbols.FillSymbol",properties:{outline:{type:t,json:{read:{default:null},write:!0}},type:null}})}.apply(null,n))||(e.exports=i)},465:function(e,t,r){var n,i;n=[r(353),r(357),r(373)],void 0===(i=function(e,t,r){return e(r,{declaredClass:"esri.symbols.MarkerSymbol",properties:{angle:{value:0,json:{read:function(e){return e&&-1*e},write:function(e,t){t.angle=e&&-1*e}}},type:{},xoffset:{value:0,cast:t.toPt,json:{write:!0}},yoffset:{value:0,cast:t.toPt,json:{write:!0}},size:{value:9,cast:function(e){return"auto"===e?e:t.toPt(e)},json:{write:!0}}}})}.apply(null,n))||(e.exports=i)},466:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(338),r(336),r(341),r(348),r(339),r(337)],void 0===(i=function(e,t,r,n,i,o,a,s){var l=o({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"});return function(e){function t(t){var r=e.call(this,t)||this;return r.name=null,r.description=null,r.drawingTool=null,r.prototype=null,r.thumbnail=null,r}return r(t,e),t.prototype.writeDrawingTool=function(e,t){t.drawingTool=l.toJSON(e)},t.prototype.writePrototype=function(e,t){t.prototype=a.fixJson(a.clone(e),!0)},t.prototype.writeThumbnail=function(e,t){t.thumbnail=a.fixJson(a.clone(e))},n([s.property({json:{write:!0}})],t.prototype,"name",void 0),n([s.property({json:{write:!0}})],t.prototype,"description",void 0),n([s.property({json:{read:l.read,write:l.write}})],t.prototype,"drawingTool",void 0),n([s.writer("drawingTool")],t.prototype,"writeDrawingTool",null),n([s.property({json:{write:!0}})],t.prototype,"prototype",void 0),n([s.writer("prototype")],t.prototype,"writePrototype",null),n([s.property({json:{write:!0}})],t.prototype,"thumbnail",void 0),n([s.writer("thumbnail")],t.prototype,"writeThumbnail",null),n([s.subclass("esri.layers.support.FeatureTemplate")],t)}(s.declared(i))}.apply(null,n))||(e.exports=i)},591:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(350)],void 0===(i=function(e,t,r){function n(e,t,n){return t.imageData?r.makeData({mediaType:t.contentType||"image/png",isBase64:!0,data:t.imageData}):i(t.url,n)}function i(e,t){return function(e){return e&&("service"===e.origin||"portal-item"===e.origin)&&e.layer&&("feature"===e.layer.type||"stream"===e.layer.type)}(t)&&!r.isAbsolute(e)&&t.layer.parsedUrl?r.join(t.layer.parsedUrl.path,"images",e):r.read(e,t)}function o(e,t,n,i){if(r.isDataProtocol(e)){var o=r.dataComponents(e);t.contentType=o.mediaType,t.imageData=o.data,n&&n.imageData===t.imageData&&n.url&&(t.url=a(n.url,i))}else t.url=a(e,i)}function a(e,t){return r.write(e,t)}Object.defineProperty(t,"__esModule",{value:!0}),t.readImageDataOrUrl=n,t.read=i,t.writeImageDataAndUrl=o,t.write=a,t.urlPropertyDefinition={json:{read:{source:["imageData","url"],reader:n},write:{writer:function(e,t,r,n){o(e,t,this.source,n)}}}},t.sourcePropertyDefinition={readOnly:!0,json:{read:{source:["imageData","url"],reader:function(e,t,r){var n={};return t.imageData&&(n.imageData=t.imageData),t.contentType&&(n.contentType=t.contentType),t.url&&(n.url=i(t.url,r)),n}}}}}.apply(null,n))||(e.exports=i)},592:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=r(658),o=r(461),a=r(659),s=r(621);r(669),t.Set=o.default.Set,s.default("es6-set")||(t.Set=((n=function(){function e(e){if(this._setData=[],this[Symbol.toStringTag]="Set",e)if(a.isArrayLike(e))for(var t=0;t<e.length;t++)this.add(e[t]);else try{for(var r=i.__values(e),n=r.next();!n.done;n=r.next()){var o=n.value;this.add(o)}}catch(e){s={error:e}}finally{try{n&&!n.done&&(l=r.return)&&l.call(r)}finally{if(s)throw s.error}}var s,l}return e.prototype.add=function(e){return this.has(e)?this:(this._setData.push(e),this)},e.prototype.clear=function(){this._setData.length=0},e.prototype.delete=function(e){var t=this._setData.indexOf(e);return-1!==t&&(this._setData.splice(t,1),!0)},e.prototype.entries=function(){return new a.ShimIterator(this._setData.map(function(e){return[e,e]}))},e.prototype.forEach=function(e,t){for(var r=this.values(),n=r.next();!n.done;)e.call(t,n.value,n.value,this),n=r.next()},e.prototype.has=function(e){return this._setData.indexOf(e)>-1},e.prototype.keys=function(){return new a.ShimIterator(this._setData)},Object.defineProperty(e.prototype,"size",{get:function(){return this._setData.length},enumerable:!0,configurable:!0}),e.prototype.values=function(){return new a.ShimIterator(this._setData)},e.prototype[Symbol.iterator]=function(){return new a.ShimIterator(this._setData)},e}())[Symbol.species]=n,n)),t.default=t.Set},593:function(e,t,r){var n,i;n=[r(353),r(357),r(373)],void 0===(i=function(e,t,r){return e(r,{declaredClass:"esri.symbols.LineSymbol",properties:{color:{},type:"simple-line",width:{value:.75,cast:t.toPt,json:{write:!0}}}})}.apply(null,n))||(e.exports=i)},594:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){return function(){function e(e,t,r,n){this._tag=0,this._dataType=99,this._data=e,this._dataView=t,this._pos=r||0,this._end=n||e.byteLength}return e.prototype.clone=function(){return new e(this._data,this._dataView,this._pos,this._end)},e.prototype.pos=function(){return this._pos},e.prototype.next=function(e){for(;;){if(this._pos===this._end)return!1;var t=this._decodeVarint();if(this._tag=t>>3,this._dataType=7&t,!e||e===this._tag)break;this.skip()}return!0},e.prototype.empty=function(){return this._pos>=this._end},e.prototype.tag=function(){return this._tag},e.prototype.getInt32=function(){return this._decodeVarint()},e.prototype.getInt64=function(){return this._decodeVarint()},e.prototype.getUInt32=function(){var e=4294967295;return e=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128?e:(e=(e|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128?e:void 0))))},e.prototype.getUInt64=function(){return this._decodeVarint()},e.prototype.getSInt32=function(){var e=this.getUInt32();return e>>>1^-(1&e)|0},e.prototype.getSInt64=function(){return this._decodeSVarint()},e.prototype.getBool=function(){var e=0!==this._data[this._pos];return this._skip(1),e},e.prototype.getEnum=function(){return this._decodeVarint()},e.prototype.getFixed64=function(){var e=this._dataView,t=this._pos,r=e.getUint32(t,!0)+4294967296*e.getUint32(t+4,!0);return this._skip(8),r},e.prototype.getSFixed64=function(){var e=this._dataView,t=this._pos,r=e.getUint32(t,!0)+4294967296*e.getInt32(t+4,!0);return this._skip(8),r},e.prototype.getDouble=function(){var e=this._dataView.getFloat64(this._pos,!0);return this._skip(8),e},e.prototype.getFixed32=function(){var e=this._dataView.getUint32(this._pos,!0);return this._skip(4),e},e.prototype.getSFixed32=function(){var e=this._dataView.getInt32(this._pos,!0);return this._skip(4),e},e.prototype.getFloat=function(){var e=this._dataView.getFloat32(this._pos,!0);return this._skip(4),e},e.prototype.getString=function(){var e=this._getLength(),t=this._pos,r=this._toString(this._data,t,t+e);return this._skip(e),r},e.prototype.getBytes=function(){var e=this._getLength(),t=this._pos,r=this._toBytes(this._data,t,t+e);return this._skip(e),r},e.prototype.getMessage=function(){var t=this._getLength(),r=this._pos,n=new e(this._data,this._dataView,r,r+t);return this._skip(t),n},e.prototype.skip=function(){switch(this._dataType){case 0:this._decodeVarint();break;case 1:this._skip(8);break;case 2:this._skip(this._getLength());break;case 5:this._skip(4);break;default:throw new Error("Invalid data type!")}},e.prototype._skip=function(e){if(this._pos+e>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=e},e.prototype._decodeVarint=function(){var e,t=this._data,r=this._pos,n=0;if(this._end-r>=10)do{if(n|=127&(e=t[r++]),0==(128&e))break;if(n|=(127&(e=t[r++]))<<7,0==(128&e))break;if(n|=(127&(e=t[r++]))<<14,0==(128&e))break;if(n|=(127&(e=t[r++]))<<21,0==(128&e))break;if(n+=268435456*(127&(e=t[r++])),0==(128&e))break;if(n+=34359738368*(127&(e=t[r++])),0==(128&e))break;if(n+=4398046511104*(127&(e=t[r++])),0==(128&e))break;if(n+=562949953421312*(127&(e=t[r++])),0==(128&e))break;if(n+=72057594037927940*(127&(e=t[r++])),0==(128&e))break;if(n+=0x8000000000000000*(127&(e=t[r++])),0==(128&e))break;throw new Error("Varint too long!")}while(0);else{for(var i=1;r!==this._end&&0!=(128&(e=t[r]));)++r,n+=(127&e)*i,i*=128;if(r===this._end)throw new Error("Varint overrun!");++r,n+=e*i}return this._pos=r,n},e.prototype._decodeSVarint=function(){var e=this._decodeVarint();return e%2?-(e+1)/2:e/2},e.prototype._getLength=function(){if(2!==this._dataType)throw new Error("Not a delimited data type!");return this._decodeVarint()},e.prototype._toString=function(e,t,r){var n="",i="";r=Math.min(this._end,r);for(var o=t;o<r;++o){var a=e[o];128&a?i+="%"+a.toString(16):(n+=decodeURIComponent(i)+String.fromCharCode(a),i="")}return i.length&&(n+=decodeURIComponent(i)),n},e.prototype._toBytes=function(e,t,r){return r=Math.min(this._end,r),new Uint8Array(e.buffer,t,r-t)},e}()}.apply(null,n))||(e.exports=i)},595:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){var r;return function(e){e[e.MATERIAL=0]="MATERIAL",e[e.MATERIAL_DEPTH=1]="MATERIAL_DEPTH",e[e.MATERIAL_NORMAL=2]="MATERIAL_NORMAL",e[e.MATERIAL_DEPTH_SHADOWMAP=3]="MATERIAL_DEPTH_SHADOWMAP",e[e.MATERIAL_HIGHLIGHT=4]="MATERIAL_HIGHLIGHT",e[e.MAX_PASS=5]="MAX_PASS"}(r||(r={})),r}.apply(null,n))||(e.exports=i)},597:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(e,t){void 0===e&&(e=[]),void 0===t&&(t=[]),this.lengths=e,this.coords=t}}();t.default=r}.apply(null,n))||(e.exports=i)},598:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(384),r(339),r(360),r(389),r(367),r(773),r(751)],void 0===(i=function(e,t,r,n,i,o,a,s,l){function u(e){switch(e){case"esriGeometryPoint":return"point";case"esriGeometryMultipoint":return"multipoint";case"esriGeometryPolyline":return"polyline";case"esriGeometryPolygon":return"polygon";case"esriGeometryEnvelope":return"extent"}}function c(e,t,n,i){return{uid:r.generateUID(),objectId:i&&e.attributes?e.attributes[i]:null,attributes:e.attributes,geometry:d(e.geometry,t,n),visible:!0}}function d(e,t,r){if(!e)return null;switch(t){case"point":var n=e;return{x:n.x,y:n.y,z:n.z,m:n.m,hasZ:null!=n.z,hasM:null!=n.m,type:t,spatialReference:r};case"polyline":var i=e;return{paths:i.paths,hasZ:!!i.hasZ,hasM:!!i.hasM,type:t,spatialReference:r};case"polygon":var o=e;return{rings:o.rings,hasZ:!!o.hasZ,hasM:!!o.hasM,type:t,spatialReference:r};case"multipoint":var a=e;return{points:a.points,hasZ:!!a.hasZ,hasM:!!a.hasM,type:t,spatialReference:r};case"extent":var s=e;return{xmin:s.xmin,ymin:s.ymin,zmin:s.zmin,mmin:s.mmin,xmax:s.xmax,ymax:s.ymax,zmax:s.zmax,mmax:s.mmax,hasZ:!!s.hasZ,hasM:!!s.hasM,type:t,spatialReference:r}}}function p(e){return"declaredClass"in e}function f(e,t){switch(o.empty(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[3]=e.x,t[1]=t[4]=e.y,e.hasZ&&(t[2]=t[5]=e.z);break;case"polyline":for(var r=0;r<e.paths.length;r++)o.expandWithNestedArray(t,e.paths[r],e.hasZ);break;case"polygon":for(r=0;r<e.rings.length;r++)o.expandWithNestedArray(t,e.rings[r],e.hasZ);break;case"multipoint":o.expandWithNestedArray(t,e.points,e.hasZ);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[3]=e.xmax,t[4]=e.ymax,null!=e.zmin&&(t[2]=e.zmin),null!=e.zmax&&(t[5]=e.zmax)}}function h(e,t){switch(a.empty(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[2]=e.x,t[1]=t[3]=e.y;break;case"polyline":for(var r=0;r<e.paths.length;r++)a.expandWithNestedArray(t,e.paths[r]);break;case"polygon":for(r=0;r<e.rings.length;r++)a.expandWithNestedArray(t,e.rings[r]);break;case"multipoint":a.expandWithNestedArray(t,e.points);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax}}Object.defineProperty(t,"__esModule",{value:!0}),t.equals=l.equals,t.isPoint=function(e){return"point"===e.type},t.mapJSONGeometryType=u,t.fromFeatureSetJSON=function(e){var t=u(e.geometryType),r=i.fromJSON(e.spatialReference),n=e.transform;return e.features.map(function(i){var o=c(i,t,r,e.objectIdFieldName),a=o.geometry;if(a&&n)switch(a.type){case"point":o.geometry=s.hydratePoint(n,a,a,a.hasZ,a.hasM);break;case"multipoint":o.geometry=s.hydrateMultipoint(n,a,a,a.hasZ,a.hasM);break;case"polygon":o.geometry=s.hydratePolygon(n,a,a,a.hasZ,a.hasM);break;case"polyline":o.geometry=s.hydratePolyline(n,a,a,a.hasZ,a.hasM)}return o})},t.fromJSON=c,t.fromJSONGeometry=d,t.makeDehydratedPoint=function(e,t,r,n){return{x:e,y:t,z:r,hasZ:null!=r,hasM:!1,spatialReference:n,type:"point"}},t.isHydratedGeometry=function(e){return"declaredClass"in e},t.isHydratedGraphic=p,t.hydrateGraphic=function(e,t){if(!e||p(e))return e;var i=new r({layer:t,sourceLayer:t});return i.visible=e.visible,i.symbol=n.clone(e.symbol),i.attributes=n.clone(e.attributes),e.geometry&&("mesh"===e.geometry.type?i.geometry=e.geometry:i.read({geometry:function(e){var t=e.spatialReference.toJSON();switch(e.type){case"point":return{x:e.x,y:e.y,z:e.z,m:e.m,spatialReference:t};case"polygon":var r=e.rings,n=e.hasZ,i=e.hasM;return{rings:r,hasZ:n,hasM:i,spatialReference:t};case"polyline":var o=e.paths,n=e.hasZ,i=e.hasM;return{paths:o,hasZ:n,hasM:i,spatialReference:t};case"extent":var a=e.xmin,s=e.xmax,l=e.ymin,u=e.ymax,c=e.zmin,d=e.zmax,p=e.mmin,f=e.mmax,n=e.hasZ,i=e.hasM;return{xmin:a,xmax:s,ymin:l,ymax:u,zmin:c,zmax:d,mmin:p,mmax:f,hasZ:n,hasM:i,spatialReference:t};case"multipoint":var h=e.points,n=e.hasZ,i=e.hasM;return{points:h,hasZ:n,hasM:i,spatialReference:t}}}(e.geometry)})),i},t.computeAABB=f,t.expandAABB=function(e,t){f(e,m),o.expand(t,m)},t.computeAABR=h,t.expandAABR=function(e,t){h(e,v),a.expand(t,v)};var m=o.create(),v=a.create()}.apply(null,n))||(e.exports=i)},600:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(338),r(336),r(339),r(337),r(376)],void 0===(i=function(e,t,r,n,i,o,a){return function(e){function t(t){var r=e.call(this,t)||this;return r.codedValues=null,r.type="coded-value",r}var a;return r(t,e),a=t,t.prototype.writeCodedValues=function(e,t){var r=null;e&&(r=e.map(function(e){return i.fixJson(i.clone(e))})),t.codedValues=r},t.prototype.getName=function(e){var t=null;if(this.codedValues){var r=String(e);this.codedValues.some(function(e){return String(e.code)===r&&(t=e.name),!!t})}return t},t.prototype.clone=function(){return new a({codedValues:i.clone(this.codedValues),name:this.name})},n([o.property({json:{write:!0}})],t.prototype,"codedValues",void 0),n([o.writer("codedValues")],t.prototype,"writeCodedValues",null),n([o.enumeration.serializable()({codedValue:"coded-value"})],t.prototype,"type",void 0),a=n([o.subclass("esri.layers.support.CodedValueDomain")],t)}(o.declared(a))}.apply(null,n))||(e.exports=i)},601:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(338),r(336),r(337),r(376)],void 0===(i=function(e,t,r,n,i,o){return function(e){function t(t){var r=e.call(this,t)||this;return r.type="inherited",r}var o;return r(t,e),o=t,t.prototype.clone=function(){return new o},n([i.enumeration.serializable()({inherited:"inherited"})],t.prototype,"type",void 0),o=n([i.subclass("esri.layers.support.InheritedDomain")],t)}(i.declared(o))}.apply(null,n))||(e.exports=i)},602:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(338),r(336),r(337),r(376)],void 0===(i=function(e,t,r,n,i,o){return function(e){function t(t){var r=e.call(this,t)||this;return r.maxValue=null,r.minValue=null,r.type="range",r}var o;return r(t,e),o=t,t.prototype.clone=function(){return new o({maxValue:this.maxValue,minValue:this.minValue,name:this.name})},n([i.property({json:{read:{source:"range",reader:function(e,t){return t.range&&t.range[1]}},write:{target:"range",writer:function(e,t,r){t[r]=[this.minValue,e]}}}})],t.prototype,"maxValue",void 0),n([i.property({json:{read:{source:"range",reader:function(e,t){return t.range&&t.range[0]}},write:{target:"range",writer:function(e,t,r){t[r]=[e,this.maxValue]}}}})],t.prototype,"minValue",void 0),n([i.enumeration.serializable()({range:"range"})],t.prototype,"type",void 0),o=n([i.subclass("esri.layers.support.RangeDomain")],t)}(i.declared(o))}.apply(null,n))||(e.exports=i)},603:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(348)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.kebabDict=r({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml"})}.apply(null,n))||(e.exports=i)},604:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(693),r(977),r(598),r(951),r(406),r(344),r(388),r(699)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u){function c(e,t,r,n,i){var o=t.z||0,a=r.featureExpressionInfoContext;switch(r.mode){case"on-the-ground":var s=e.getElevation(t,"ground")||0;return i&&(i.verticalDistanceToGround=0,i.terrainElevation=s),s;case"relative-to-ground":var l=e.getElevation(t,"ground")||0;s=r.calculateOffsetRenderUnits(n);return null==a&&(s+=o),i&&(i.verticalDistanceToGround=s,i.terrainElevation=l),s+l;case"relative-to-scene":l=e.getElevation(t,"scene")||0,s=r.calculateOffsetRenderUnits(n);return i&&(i.verticalDistanceToGround=s,i.terrainElevation=l),s+l;case"absolute-height":s=r.calculateOffsetRenderUnits(n);if(null==a&&(s+=o),i){l=e.getElevation(t,"ground")||0;i.verticalDistanceToGround=s-l,i.terrainElevation=l}return s;default:r.mode}return 0}function d(e,t,r,n,i,o){var s,u=0;if(e.metadata.usesVerticalDistanceToGround)u=c(i,t,r,o,x),a.updateVertexAttributeAuxpos1w(e,x.verticalDistanceToGround),s=x.terrainElevation;else{var d="absolute-height"!==r.mode;u=c(i,t,r,o,d?x:null),d&&(s=x.terrainElevation)}var p=e.getObjectTransformation();return y[0]=t.x,y[1]=t.y,y[2]=u,l.computeLinearTransformation(t.spatialReference,y,p,n)?e.setObjectTransformation(p):console.warn("Could not locate symbol object properly, it might be misplaced"),{terrainElevation:s}}function p(e,t){var r=n.pathsToTriangulationInfo(e,t);return{vertexData:r.position,polygons:r.polygons,outlines:r.outlines}}function f(e,t,r,n,i){t*=3,n*=3;for(var o=0;o<i;++o)r[n++]=e[t++],r[n++]=e[t++],r[n++]=e[t++]}function h(e,t,r,n,i,o,a){return l.bufferToBuffer(e,r,t,n,o,i,a)}function m(e,t,r){l.pointToVector(e,t,r)}function v(e,t){return!(e[0]>t[3]||e[0]<t[0]||e[1]>t[4]||e[1]<t[1])}function g(e,t){return!(t[0]>e[3]||t[3]<e[0]||t[1]>e[4]||t[4]<e[1])}Object.defineProperty(t,"__esModule",{value:!0});var y=s.vec3d.create(),b=s.mat4d.identity(),_=i.makeDehydratedPoint(0,0,0,null);t.createStageObjectForPoint=function(e,t,r,n,i,o,a,s,l,c,p){var f=t?t.length:0,h=this._context.clippingExtent;if(m(e,y,this._context.elevationProvider.spatialReference),h&&!v(y,h))return null;m(e,y,this._context.renderSpatialReference);for(var g=this._context.localOriginFactory.getOrigin(y),_=new u({castShadow:!1,metadata:{layerUid:s,graphicUid:l,usesVerticalDistanceToGround:!!c},idHint:a}),x=0;x<f;x++){var w=n?n[x]:b;_.addGeometry(t[x],r[x],w,i,g,p)}return{object:_,terrainElevation:d(_,e,o,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper).terrainElevation}},t.extendPointGraphicElevationContext=function(e,t,r){var n=e.elevationContext,o=r.spatialReference;m(t,y,o),n.centerPointInElevationSR=i.makeDehydratedPoint(y[0],y[1],t.hasZ?y[2]:0,o)},t.placePointOnGeometry=function(e){switch(e.type){case"point":return e;case"polygon":case"extent":return a.computeCentroid(e);case"polyline":var t=e.paths[0];if(!t||0===t.length)return null;var n=r.getPointOnPath(t,r.getPathLength(t)/2);return i.makeDehydratedPoint(n[0],n[1],n[2],e.spatialReference);case"mesh":return e.extent.center}return null},t.computeElevation=c,t.getSingleSizeDriver=function(e,t){return void 0===t&&(t=0),isFinite(e[t])?e[t]:null},t.copyPathData=p,t.copyVertices=f,t.chooseOrigin=function(e,t,r,n){var i=Math.floor(t+(r-1)/2);n[0]=e[3*i+0],n[1]=e[3*i+1],n[2]=e[3*i+2]},t.subtractCoordinates=function(e,t,r,n){t*=3;for(var i=0;i<r;++i)e[t++]-=n[0],e[t++]-=n[1],e[t++]-=n[2]},t.setZ=function(e,t,r,n){t*=3;for(var i=0;i<r;++i)e[t+2]=n,t+=3},t.offsetZ=function(e,t,r,n){t*=3;for(var i=0;i<r;++i)e[t+2]+=n,t+=3},t.scaleZ=function(e,t,r,n){t*=3;for(var i=0;i<r;++i)e[t+2]*=n,t+=3},t.flatArrayToArrayOfArrays=function(e,t,r){var n=[];t*=3;for(var i=0;i<r;++i)n.push([e[t++],e[t++],e[t++]]);return n},t.reproject=h,t.reprojectPoint=m,t.getGeometryVertexData3D=function(e,t,r,n,i,o,a){var s=i.spatialReference,l=p(e,t),u=l.vertexData,c=u.length/3,d=new Float64Array(u.length),m=!0;r.equals(s)?f(u,0,d,0,u.length):m=h(u,0,r,d,0,s,c);var v=function(e,t,r,n,i,o,a,s){var l=s.mode,u=0,c=0,d=0,p=s.calculateOffsetRenderUnits(a),f=s.featureExpressionInfoContext;_.spatialReference=e.spatialReference,r*=3,i*=3;for(var h=0;h<o;++h){switch(_.x=t[r+0],_.y=t[r+1],_.z=t[r+2],l){case"on-the-ground":c=u=e.getElevation(_)||0,d+=u;break;case"relative-to-ground":c=(u=e.getElevation(_)||0)+p,null==f&&(c+=_.z),d+=u;break;case"relative-to-scene":c=(u=e.getElevation(_,"scene")||0)+p,d+=u;break;case"absolute-height":c=p,null==f&&(c+=_.z)}n[i+0]=t[r+0],n[i+1]=t[r+1],n[i+2]=c,r+=3,i+=3}return{terrainElevation:d/=o}}(i,d,0,u,0,c,o,a);return s.equals(n)||h(u,0,s,u,0,n,c),{geometryData:l,vertexData:u,eleVertexData:d,terrainElevation:v.terrainElevation,projectionSuccess:m}},t.getGeometryVertexDataDraped=function(e,t,r){var n=p(e,!1),i=n.vertexData,o=i.length/3,a=!0;return t.equals(r)||(a=l.bufferToBuffer(i,t,0,i,r,0,o)),{geometryData:n,vertexData:i,projectionSuccess:a}},t.computeBoundingBox=function(e,t,r,n){n[0]=Number.MAX_VALUE,n[1]=Number.MAX_VALUE,n[2]=Number.MAX_VALUE,n[3]=-Number.MAX_VALUE,n[4]=-Number.MAX_VALUE,n[5]=-Number.MAX_VALUE,t*=3;for(var i=0;i<r;++i){var o=e[t++],a=e[t++],s=e[t++];o<n[0]&&(n[0]=o),a<n[1]&&(n[1]=a),s<n[2]&&(n[2]=s),o>n[3]&&(n[3]=o),a>n[4]&&(n[4]=a),s>n[5]&&(n[5]=s)}return n},t.pointInBox2D=v,t.boxesIntersect2D=g,t.boundingBoxClipped=function(e,t){return!!t&&!g(e,t)},t.needsElevationUpdates2D=function(e){return"relative-to-ground"===e||"relative-to-scene"===e},t.needsElevationUpdates3D=function(e){return"absolute-height"!==e},t.needsOffsetAdjustment=function(e,t,r,n){if(!1===t.needsOffsetAdjustment||!1===t.supportsOffsetAdjustment)return!1;if("on-the-ground"===e.mode)return!1;if(0===e.meterUnitOffset){if(!0===t.needsOffsetAdjustment)return!0;if(o.isCalloutSupport(n)&&n.hasVisibleVerticalOffset())return!1;if("relative-to-ground"===e.mode&&(!r.hasZ||e.featureExpressionInfoContext))return!0;if("relative-to-scene"===e.mode)return!0}return!1};var x={verticalDistanceToGround:0,terrainElevation:0}}.apply(null,n))||(e.exports=i)},606:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(414),r(415),r(369),r(413),r(416)],void 0===(i=function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0}),t.types={key:"type",base:i,typeMap:{heatmap:n,simple:o,"unique-value":a,"class-breaks":r}}}.apply(null,n))||(e.exports=i)},607:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(e,t,r,n){void 0===e&&(e=null),void 0===t&&(t={}),this.geometry=e,this.attributes=t,r&&(this.centroid=r),null!=n&&(this.objectId=n)}}();t.default=r}.apply(null,n))||(e.exports=i)},608:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1045),r(430),r(902),r(452),r(349),r(349)],void 0===(i=function(e,t,r,n,i,o,a,s){return function(){function e(t,r,n){this.singleUse=!1,this._boundingInfo=null,this._componentAABB=null,this.id=e.__idGen.gen(r),this._data=t,this._boundingInfo=n}return Object.defineProperty(e.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"componentCount",{get:function(){return n.componentCount(this.data.componentOffsets)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boundingInfo",{get:function(){return null==this._boundingInfo&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo},enumerable:!0,configurable:!0}),e.prototype.invalidateBoundingInfo=function(){this._boundingInfo=null},e.prototype.getComponentAABB=function(e,t){null==this._componentAABB&&(this._componentAABB=this._computeComponentAABB());for(var r=0;r<6;r++)t[r]=this._componentAABB[6*e+r];return t},e.prototype._computeComponentAABB=function(){for(var e=this.componentCount,t=new Float32Array(6*e),r=0;r<e;r++)this._calculateAABB(r,t,6*r);return t},e.prototype._calculateAABB=function(e,t,r){void 0===r&&(r=0);for(var n=this.data.getIndices(s.VertexAttrConstants.POSITION),i=this.data.getAttribute(s.VertexAttrConstants.POSITION),o=this.data.componentOffsets,a=o.length?o[e]:0,l=o.length?o[e+1]:n.length,u=1/0,c=1/0,d=1/0,p=-1/0,f=-1/0,h=-1/0,m=i.offsetIdx,v=i.strideIdx,g=a;g<l;g++){var y=m+v*n[g],b=i.data[y],_=i.data[y+1],x=i.data[y+2];u=Math.min(u,b),c=Math.min(c,_),d=Math.min(d,x),p=Math.max(p,b),f=Math.max(f,_),h=Math.max(h,x)}return t?(t[r]=u,t[r+1]=c,t[r+2]=d,t[r+3]=p,t[r+4]=f,t[r+5]=h):t=[u,c,d,p,f,h],t},e.prototype._calculateBoundingInfo=function(){var e=this.data.getIndices(s.VertexAttrConstants.POSITION),t=this.data.getAttribute(s.VertexAttrConstants.POSITION),n="triangle"===this.data.primitiveType?3:1;if(0===e.length){e=new Uint32Array(n);for(var o=0;o<n;++o)e[o]=o}var l=e.length;a.assert(l%n==0);var u=i.generateDefaultIndexArray(l/n);return new r(u,n,e,t)},e.__idGen=new o,e}()}.apply(null,n))||(e.exports=i)},609:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(378),r(433),r(343),r(340),r(610),r(391),r(611)],void 0===(i=function(e,t,n,i,o,a,s,l,u){function c(){if(g)return g;for(var e=p+f,t=[],r=0;r<e;r++)!function(e){var r=u.create(e).then(function(t){return v[e]=t,t});t.push(r)}(r);return g=i(t).then(function(){})}Object.defineProperty(t,"__esModule",{value:!0}),t.Connection=s,t.RemoteClient=l;var d=n("host-browser")?navigator.hardwareConcurrency:0;d||(d=n("safari")&&n("mac")||n("trident")?8:2);var p=n("esri-workers-debug")?1:Math.max(1,Math.ceil(d/2)),f=n("esri-workers-debug")?1:Math.max(1,Math.floor(d/2)),h=o.getLogger("esri.core.workers"),m=0,v=[];t.initialize=function(){c()},t.open=function(n,i,o){if(void 0===i&&(i={}),Array.isArray(n))return new t.Connection(n.map(function(e){return new t.RemoteClient(e,i.client)}));if("string"!=typeof n){h.warn("workers-open:signature-deprecated","DEPRECATED: workers.open() changed signature.");var s=n;n=i,i={client:s,strategy:o?"dedicated":"distributed"}}var l=i.strategy||"distributed";return"local"===l?a.create(function(i){Promise.resolve().then(function(){var r=[e(n,null,!1)];(function(e){i(t.RemoteClient.connect(e))}).apply(null,r)}).catch(r.oe)}).then(function(e){return new t.Connection([new t.RemoteClient(e,i.client)])}):c().then(function(){if("dedicated"===l){var e=p+m++;return m%=f,v[e].open(n).then(function(e){return new t.Connection([new t.RemoteClient(e,i.client)])})}return a.all(v.map(function(e){return e.open(n)})).then(function(e){return new t.Connection(e.map(function(e){return new t.RemoteClient(e,i.client)}))})})},t.terminate=function(){g&&(g.cancel(),g=null);for(var e=0;e<v.length;e++)v[e]&&v[e].terminate();v.length=0};var g=null}.apply(null,n))||(e.exports=i)},610:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(340)],void 0===(i=function(e,t,r){return function(){function e(e){this._clientIdx=0,this._clients=e}return e.prototype.broadcast=function(e,t){for(var r=[],n=0,i=this._clients;n<i.length;n++){var o=i[n];r.push(o.invoke(e,t))}return r},e.prototype.close=function(){for(var e=0,t=this._clients;e<t.length;e++)t[e].close();this._clients=[]},e.prototype.invoke=function(e,t,n,i){var o=i&&i.client;if(!this._clients||!this._clients.length)return r.reject(new Error("Connection closed"));null!=o&&-1!==this._clients.indexOf(o)||this._clients.some(function(e){return!e.isBusy()&&(o=e,!0)})||(this._clientIdx=(this._clientIdx+1)%this._clients.length,o=this._clients[this._clientIdx]);var a=o.invoke(e,t,n);return i&&(i.client=o),a},e.prototype.openPorts=function(){return r.all(this._clients.map(function(e){return e.openPort()}))},e}()}.apply(null,n))||(e.exports=i)},611:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(605),r(342),r(343),r(340),r(379),r(612)],void 0===(i=function(e,t,r,n,i,o,a,s){function l(e,t){e.delete(t)}var u=i.getLogger("esri.core.workers"),c=a.MessageType.CANCEL,d=a.MessageType.INVOKE,p=a.MessageType.OPEN,f=a.MessageType.OPENED,h=a.MessageType.RESPONSE;return function(){function e(e,t){this._outJobs=new Map,this._inJobs=new Map,this.worker=e,this.id=t,e.addEventListener("message",this._onMessage.bind(this)),e.addEventListener("error",function(e){e.preventDefault(),u.error(e)})}return e.create=function(t){return s.createWorker().then(function(r){return new e(r,t)})},e.prototype.terminate=function(){this.worker.terminate()},e.prototype.open=function(e){var t=this,r=a.newJobId(),n=function(){l(t._outJobs,r),t._post({type:c,jobId:r})};return o.create(function(i,o){var a={resolve:i,reject:o,cancel:n};t._outJobs.set(r,a),t._post({type:p,jobId:r,modulePath:e})},n)},e.prototype._onMessage=function(e){var t=a.receiveMessage(e);if(t)switch(t.type){case f:case h:this._onResponse(t);break;case c:this._onCancel(t);break;case d:this._onInvoke(t)}},e.prototype._onCancel=function(e){var t=this._inJobs.get(e.jobId);t&&t.cancel()},e.prototype._onInvoke=function(e){var t,n=this,i=e.methodName,s=e.jobId,u=e.data,c=this._inJobs,d=r.workerMessages[i];try{if("function"!=typeof d)throw new TypeError(i+" is not a function");t=d.call(null,u)}catch(e){return void this._post({type:h,jobId:s,error:a.toInvokeError(e)})}o.isThenable(t)?(c.set(s,t),t.then(function(e){l(c,s),n._post({type:h,jobId:s},e)}).catch(function(e){l(c,s),e||(e={message:"Error encountered at method"+i}),e.dojoType&&"cancel"===e.dojoType||n._post({type:h,jobId:s,error:a.toInvokeError(e)})})):this._post({type:h,jobId:s},t)},e.prototype._onResponse=function(e){var t=e.jobId,r=e.error,i=e.data,o=this._outJobs.get(t);o&&(l(this._outJobs,t),r?o.reject(n.fromJSON(JSON.parse(r))):o.resolve(i))},e.prototype._post=function(e,t,r){return a.postMessage(this.worker,e,t,r)},e}()}.apply(null,n))||(e.exports=i)},612:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(345),r(355),r(124),r(351),r(354),r(343),r(340),r(350),r(613),r(379),r(614)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,c,d,p){function f(e){return l.create(function(t){function r(i){var o=d.receiveMessage(i);if(o)switch(o.type){case x:h(e);break;case b:e.removeEventListener("message",r),e.removeEventListener("error",n),t(e)}}function n(t){t.preventDefault(),e.removeEventListener("message",r),e.removeEventListener("error",n),g.warn("Failed to create Worker. Fallback to execute module in main thread",t),(e=new p).addEventListener("message",r),e.addEventListener("error",n)}e.addEventListener("message",r),e.addEventListener("error",n)})}function h(e){var t,o=i.workers.loaderUrl||c.DEFAULT_LOADER_URL;if(null!=i.default){var s=r({},i);delete s.default,t=JSON.parse(JSON.stringify(s))}else t=JSON.parse(JSON.stringify(i));var l=i.workers.loaderConfig,u=c.default({baseUrl:l.baseUrl,locale:n.locale,has:r({"config-deferredInstrumentation":0,"dojo-test-sniff":0,"esri-secure-context":a("esri-secure-context"),"esri-workers-arraybuffer-transfer":a("esri-workers-arraybuffer-transfer"),"events-keypress-typed":0,"host-webworker":1},l.has),map:r({},l.map),paths:r({},l.paths),packages:l.packages||[]});e.postMessage({type:_,configure:{esriConfig:t,loaderUrl:o,loaderConfig:u}})}Object.defineProperty(t,"__esModule",{value:!0});var m=u.normalize(e.toUrl("./worker.js")),v=!u.hasSameOrigin(m,location.href),g=s.getLogger("esri.core.workers"),y=null;a.add("esri-workers-arraybuffer-transfer",!a("safari")||a("safari")>=12);var b=d.MessageType.CONFIGURED,_=d.MessageType.CONFIGURE,x=d.MessageType.HANDSHAKE;t.createWorker=function(){if(!a("esri-workers"))return f(new p);if(!v){var e=void 0;try{e=new Worker(m)}catch(t){g.warn("Failed to create Worker. Fallback to execute module in main thread",event),e=new p}return f(e)}return y||(y=o(m,{responseType:"text"})),y.then(function(e){return new Worker(URL.createObjectURL(new Blob([e.data],{type:"text/javascript"})))}).catch(function(e){return g.warn("Failed to create Worker. Fallback to execute module in main thread",e),new p}).then(function(e){return f(e)})}}.apply(null,n))||(e.exports=i)},613:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(345),r(356),r(350)],void 0===(i=function(e,t,r,n,i){function o(t){return i.removeQueryParameters(e.toUrl(t))}function a(e,t){for(var n=0,a=e;n<a.length;n++)if(a[n].name===t.name)return;var s=r({},t),l=o(s.name+"/x.js"),u=l.slice(0,l.length-5);s.location=i.makeAbsolute(u),e.push(s)}Object.defineProperty(t,"__esModule",{value:!0});var s=n("esri-built")?"dojo/dojo-lite.js":"dojo/dojo.js";t.DEFAULT_LOADER_URL=i.makeAbsolute(o(s)),t.DEFAULT_CONFIG={baseUrl:function(){var e=o("dojo/x.js");return i.makeAbsolute(e.slice(0,e.length-5))}(),packages:[{name:"esri"},{name:"dojo"},{name:"dojox"},{name:"dstore"},{name:"moment",main:"moment"},{name:"@dojo"},{name:"cldrjs",main:"dist/cldr"},{name:"globalize",main:"dist/globalize"},{name:"maquette",main:"dist/maquette.umd"},{name:"maquette-css-transitions",main:"dist/maquette-css-transitions.umd"},{name:"maquette-jsx",main:"dist/maquette-jsx.umd"},{name:"tslib",main:"tslib"}],map:{globalize:{cldr:"cldrjs/dist/cldr","cldr/event":"cldrjs/dist/cldr/event","cldr/supplemental":"cldrjs/dist/cldr/supplemental","cldr/unresolved":"cldrjs/dist/cldr/unresolved"}}},t.default=function(e){var n={async:e.async,isDebug:e.isDebug,locale:e.locale,baseUrl:e.baseUrl,has:r({},e.has),map:r({},e.map),packages:e.packages&&e.packages.concat()||[],paths:r({},e.paths)};e.hasOwnProperty("async")||(n.async=!0),e.hasOwnProperty("isDebug")||(n.isDebug=!1),e.baseUrl||(n.baseUrl=t.DEFAULT_CONFIG.baseUrl),t.DEFAULT_CONFIG.packages.forEach(function(e){a(n.packages,e)});for(var i=n.map=n.map||{},o=0,s=Object.keys(t.DEFAULT_CONFIG.map);o<s.length;o++){var l=s[o];i[l]||(i[l]=t.DEFAULT_CONFIG.map[l])}return n}}.apply(null,n))||(e.exports=i)},614:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(356),r(438),r(379)],void 0===(i=function(e,t,n,i,o){var a=function(){return function(){var e=this,t=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(function(r){e[r]=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t[r].apply(t,e)}})}}(),s=i.MutationObserver||i.WebKitMutationObserver,l=function(){var e;if(i.process&&i.process.nextTick)e=function(e){i.process.nextTick(e)};else if(i.Promise)e=function(e){i.Promise.resolve().then(e)};else if(s){var t=[],r=document.createElement("div");new s(function(){for(;t.length>0;)t.shift()()}).observe(r,{attributes:!0}),e=function(e){t.push(e),r.setAttribute("queueStatus","1")}}return e}();return function(){function t(){this._dispatcher=new a,this._isInitialized=!1,this._workerPostMessage({type:o.MessageType.HANDSHAKE})}return t.prototype.terminate=function(){},Object.defineProperty(t.prototype,"onmessage",{get:function(){return this._onmessageHandler},set:function(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onerror",{get:function(){return this._onerrorHandler},set:function(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)},enumerable:!0,configurable:!0}),t.prototype.postMessage=function(e,t){var r=this;l(function(){r._workerMessageHandler(new MessageEvent("message",{data:e}))})},t.prototype.dispatchEvent=function(e){return this._dispatcher.dispatchEvent(e)},t.prototype.addEventListener=function(e,t,r){this._dispatcher.addEventListener(e,t,r)},t.prototype.removeEventListener=function(e,t,r){this._dispatcher.removeEventListener(e,t,r)},t.prototype._workerPostMessage=function(e,t){var r=this;l(function(){r.dispatchEvent(new MessageEvent("message",{data:e}))})},t.prototype._workerMessageHandler=function(t){var i=this,a=o.receiveMessage(t);if(a){var s=a.jobId;switch(a.type){case o.MessageType.CONFIGURE:this._isInitialized||this._workerPostMessage({type:o.MessageType.CONFIGURED});break;case o.MessageType.OPEN:var l=a.modulePath;n("esri-webpack")?Promise.all([r.e(3),r.e(2),r.e(5),r.e(7),r.e(68)]).then(function(){var t=[r(391),r(756),r(757),r(740),r(726),r(758),r(686),e(l,null,!1)];(function(e,t,r,n,a,l,u,c){var d;switch(c){case"esri/views/vectorTiles/WorkerTileHandler":d=t;break;case"esri/views/2d/layers/features/Pipeline":d=r;break;case"esri/views/3d/layers/PointCloudWorker":d=n;break;case"esri/views/3d/layers/SceneLayerWorker":d=a;break;case"esri/layers/graphics/sources/support/CSVSourceWorker":d=l;break;case"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeProcessingWorker":d=u;break;default:d=c}var p=e.connect(d);i._workerPostMessage({type:o.MessageType.OPENED,jobId:s,data:p})}).apply(null,t)}).catch(r.oe):Promise.resolve().then(function(){var t=[r(391),e(l,null,!1)];(function(e,t){var r=e.connect(t);i._workerPostMessage({type:o.MessageType.OPENED,jobId:s,data:r})}).apply(null,t)}).catch(r.oe)}}},t}()}.apply(null,n))||(e.exports=i)},615:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(358),r(361)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0}),t.graphicsExtent=function(e){if(!e||!e.length)return null;var t=r.isCollection(e)?e.getItemAt(0).geometry:e[0].geometry,i=t.extent,o=t;null===i&&(i=new n(o.x,o.y,o.x,o.y,t.spatialReference));for(var a=1;a<e.length;a++){o=t=r.isCollection(e)?e.getItemAt(a).geometry:e[a].geometry;var s=t.extent;null===s&&(s=new n(o.x,o.y,o.x,o.y,t.spatialReference)),i=i.clone().union(s)}return i.width<0&&i.height<0?null:i},t.getGeometries=function(e){return e.map(function(e){return e.geometry})},t._encodeGraphics=function(e,t){var r=[];return e.forEach(function(e,n){var i=e.toJSON(),o={};if(i.geometry){var a=t&&t[n];o.geometry=a&&a.toJSON()||i.geometry}i.attributes&&(o.attributes=i.attributes),r[n]=o}),r}}.apply(null,n))||(e.exports=i)},617:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(347),r(336),r(346),r(337)],void 0===(i=function(e,t,r,n,i,o){return new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.SCENEVIEW_HITTEST_RETURN_SELECTOR=!1,t.SCENEVIEW_LOCKING_LOG=!1,t.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED=!1,t.HIGHLIGHTS_VISUALIZE_BLOCKS=!1,t.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1,t.DECONFLICTOR_SHOW_OUTLINES=!1,t.DECONFLICTOR_SHOW_GRID=!1,t.LABELS_SHOW_BORDER=!1,t.OVERLAY_DRAW_TEST_TEXTURE=!1,t.OVERLAY_SHOW_CENTER=!1,t.TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS=!1,t.DISABLE_POI_UPDATE_ON_SURFACE_GEOMETRY_CHANGES=!1,t.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES=!1,t.DRAW_MESH_GEOMETRY_NORMALS=!1,t.FEATURE_TILE_FETCH_SHOW_TILES=!1,t.FEATURE_TILE_TREE_SHOW_TILES=!1,t.ENABLE_PROFILE_DEPTH_RANGE=!1,t}return r(t,e),n([o.property()],t.prototype,"SCENEVIEW_HITTEST_RETURN_SELECTOR",void 0),n([o.property()],t.prototype,"SCENEVIEW_LOCKING_LOG",void 0),n([o.property()],t.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED",void 0),n([o.property()],t.prototype,"HIGHLIGHTS_VISUALIZE_BLOCKS",void 0),n([o.property()],t.prototype,"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0),n([o.property()],t.prototype,"DECONFLICTOR_SHOW_OUTLINES",void 0),n([o.property()],t.prototype,"DECONFLICTOR_SHOW_GRID",void 0),n([o.property()],t.prototype,"LABELS_SHOW_BORDER",void 0),n([o.property()],t.prototype,"OVERLAY_DRAW_TEST_TEXTURE",void 0),n([o.property()],t.prototype,"OVERLAY_SHOW_CENTER",void 0),n([o.property()],t.prototype,"TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS",void 0),n([o.property()],t.prototype,"DISABLE_POI_UPDATE_ON_SURFACE_GEOMETRY_CHANGES",void 0),n([o.property()],t.prototype,"DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES",void 0),n([o.property()],t.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),n([o.property()],t.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),n([o.property()],t.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),n([o.property()],t.prototype,"ENABLE_PROFILE_DEPTH_RANGE",void 0),n([o.subclass()],t)}(o.declared(i)))}.apply(null,n))||(e.exports=i)},618:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(347),r(1501),r(1502),r(1503),r(1504),r(1505),r(1506)],void 0===(i=function(e,t,r,n,i,o,a,s,l){Object.defineProperty(t,"__esModule",{value:!0});var u=function(e){function t(t,r,n){void 0===r&&(r=0);var i=e.call(this,Float32Array,t,r,n)||this;return i.elementType="f32",i}return r(t,e),t.ElementType="f32",t}(o.BufferViewSingle);t.BufferViewFloat=u;var c=function(e){function t(t,r,n,i){void 0===r&&(r=0);var o=e.call(this,Float32Array,t,r,n,i)||this;return o.elementType="f32",o}return r(t,e),t.ElementType="f32",t}(a.BufferViewVec2Impl);t.BufferViewVec2f=c;var d=function(e){function t(t,r,n,i){void 0===r&&(r=0);var o=e.call(this,Float32Array,t,r,n,i)||this;return o.elementType="f32",o}return r(t,e),t.ElementType="f32",t}(s.BufferViewVec3Impl);t.BufferViewVec3f=d;var p=function(e){function t(t,r,n,i){void 0===r&&(r=0);var o=e.call(this,Float32Array,t,r,n,i)||this;return o.elementType="f32",o}return r(t,e),t.ElementType="f32",t}(l.BufferViewVec4Impl);t.BufferViewVec4f=p;var f=function(e){function t(t,r,n){void 0===r&&(r=0);var i=e.call(this,Float32Array,t,r,n)||this;return i.elementType="f32",i}return r(t,e),t.ElementType="f32",t}(n.BufferViewMat3);t.BufferViewMat3f=f;var h=function(e){function t(t,r,n){void 0===r&&(r=0);var i=e.call(this,Float32Array,t,r,n)||this;return i.elementType="f32",i}return r(t,e),t.ElementType="f32",t}(i.BufferViewMat4);t.BufferViewMat4f=h;var m=function(e){function t(t,r,n){void 0===r&&(r=0);var i=e.call(this,Float64Array,t,r,n)||this;return i.elementType="f64",i}return r(t,e),t.ElementType="f64",t}(o.BufferViewSingle);t.BufferViewFloat64=m;var v=function(e){function t(t,r,n){void 0===r&&(r=0);var i=e.call(this,Float64Array,t,r,n)||this;return i.elementType="f64",i}return r(t,e),t.ElementType="f64",t}(a.BufferViewVec2Impl);t.BufferViewVec2f64=v;var g=function(e){function t(t,r,n){void 0===r&&(r=0);var i=e.call(this,Float64Array,t,r,n)||this;return i.elementType="f64",i}return r(t,e),t.ElementType="f64",t}(s.BufferViewVec3Impl);t.BufferViewVec3f64=g;var y=function(e){function t(t,r,n){void 0===r&&(r=0);var i=e.call(this,Float64Array,t,r,n)||this;return i.elementType="f64",i}return r(t,e),t.ElementType="f64",t}(l.BufferViewVec4Impl);t.BufferViewVec4f64=y;var b=function(e){function t(t,r,n,i){void 0===r&&(r=0);var o=e.call(this,Uint8Array,t,r,n,i)||this;return o.elementType="u8",o}return r(t,e),t.ElementType="u8",t}(o.BufferViewSingle);t.BufferViewUint8=b;var _=function(e){function t(t,r,n){void 0===r&&(r=0);var i=e.call(this,Uint8Array,t,r,n)||this;return i.elementType="u8",i}return r(t,e),t.ElementType="u8",t}(a.BufferViewVec2Impl);t.BufferViewVec2u8=_;var x=function(e){function t(t,r,n){void 0===r&&(r=0);var i=e.call(this,Uint8Array,t,r,n)||this;return i.elementType="u8",i}return r(t,e),t.ElementType="u8",t}(s.BufferViewVec3Impl);t.BufferViewVec3u8=x;var w=function(e){function t(t,r,n,i){void 0===r&&(r=0);var o=e.call(this,Uint8Array,t,r,n,i)||this;return o.elementType="u8",o}return r(t,e),t.ElementType="u8",t}(l.BufferViewVec4Impl);t.BufferViewVec4u8=w;var S=function(e){function t(t,r,n,i){void 0===r&&(r=0);var o=e.call(this,Uint16Array,t,r,n,i)||this;return o.elementType="u16",o}return r(t,e),t.ElementType="u16",t}(o.BufferViewSingle);t.BufferViewUint16=S;var T=function(e){function t(t,r,n){void 0===r&&(r=0);var i=e.call(this,Uint16Array,t,r,n)||this;return i.elementType="u16",i}return r(t,e),t.ElementType="u16",t}(a.BufferViewVec2Impl);t.BufferViewVec2u16=T;var E=function(e){function t(t,r,n){void 0===r&&(r=0);var i=e.call(this,Uint16Array,t,r,n)||this;return i.elementType="u16",i}return r(t,e),t.ElementType="u16",t}(s.BufferViewVec3Impl);t.BufferViewVec3u16=E;var C=function(e){function t(t,r,n){void 0===r&&(r=0);var i=e.call(this,Uint16Array,t,r,n)||this;return i.elementType="u16",i}return r(t,e),t.ElementType="u16",t}(l.BufferViewVec4Impl);t.BufferViewVec4u16=C;var O=function(e){function t(t,r,n,i){void 0===r&&(r=0);var o=e.call(this,Uint32Array,t,r,n,i)||this;return o.elementType="u32",o}return r(t,e),t.ElementType="u32",t}(o.BufferViewSingle);t.BufferViewUint32=O;var P=function(e){function t(t,r,n){void 0===r&&(r=0);var i=e.call(this,Uint32Array,t,r,n)||this;return i.elementType="u32",i}return r(t,e),t.ElementType="u32",t}(a.BufferViewVec2Impl);t.BufferViewVec2u32=P;var A=function(e){function t(t,r,n){void 0===r&&(r=0);var i=e.call(this,Uint32Array,t,r,n)||this;return i.elementType="u32",i}return r(t,e),t.ElementType="u32",t}(s.BufferViewVec3Impl);t.BufferViewVec3u32=A;var I=function(e){function t(t,r,n){void 0===r&&(r=0);var i=e.call(this,Uint32Array,t,r,n)||this;return i.elementType="u32",i}return r(t,e),t.ElementType="u32",t}(l.BufferViewVec4Impl);t.BufferViewVec4u32=I;var R=function(e){function t(t,r,n){void 0===r&&(r=0);var i=e.call(this,Int8Array,t,r,n)||this;return i.elementType="i8",i}return r(t,e),t.ElementType="i8",t}(o.BufferViewSingle);t.BufferViewInt8=R;var M=function(e){function t(t,r,n){void 0===r&&(r=0);var i=e.call(this,Int8Array,t,r,n)||this;return i.elementType="i8",i}return r(t,e),t.ElementType="i8",t}(a.BufferViewVec2Impl);t.BufferViewVec2i8=M;var D=function(e){function t(t,r,n){void 0===r&&(r=0);var i=e.call(this,Int8Array,t,r,n)||this;return i.elementType="i8",i}return r(t,e),t.ElementType="i8",t}(s.BufferViewVec3Impl);t.BufferViewVec3i8=D;var F=function(e){function t(t,r,n){void 0===r&&(r=0);var i=e.call(this,Int8Array,t,r,n)||this;return i.elementType="i8",i}return r(t,e),t.ElementType="i8",t}(l.BufferViewVec4Impl);t.BufferViewVec4i8=F;var L=function(e){function t(t,r,n){void 0===r&&(r=0);var i=e.call(this,Int16Array,t,r,n)||this;return i.elementType="i16",i}return r(t,e),t.ElementType="i16",t}(o.BufferViewSingle);t.BufferViewInt16=L;var N=function(e){function t(t,r,n){void 0===r&&(r=0);var i=e.call(this,Int16Array,t,r,n)||this;return i.elementType="i16",i}return r(t,e),t.ElementType="i16",t}(a.BufferViewVec2Impl);t.BufferViewVec2i16=N;var j=function(e){function t(t,r,n){void 0===r&&(r=0);var i=e.call(this,Int16Array,t,r,n)||this;return i.elementType="i16",i}return r(t,e),t.ElementType="i16",t}(s.BufferViewVec3Impl);t.BufferViewVec3i16=j;var V=function(e){function t(t,r,n){void 0===r&&(r=0);var i=e.call(this,Int16Array,t,r,n)||this;return i.elementType="i16",i}return r(t,e),t.ElementType="i16",t}(l.BufferViewVec4Impl);t.BufferViewVec4i16=V;var U=function(e){function t(t,r,n){void 0===r&&(r=0);var i=e.call(this,Int32Array,t,r,n)||this;return i.elementType="i32",i}return r(t,e),t.ElementType="i32",t}(o.BufferViewSingle);t.BufferViewInt32=U;var B=function(e){function t(t,r,n){void 0===r&&(r=0);var i=e.call(this,Int32Array,t,r,n)||this;return i.elementType="i32",i}return r(t,e),t.ElementType="i32",t}(a.BufferViewVec2Impl);t.BufferViewVec2i32=B;var z=function(e){function t(t,r,n){void 0===r&&(r=0);var i=e.call(this,Int32Array,t,r,n)||this;return i.elementType="i32",i}return r(t,e),t.ElementType="i32",t}(s.BufferViewVec3Impl);t.BufferViewVec3i32=z;var k=function(e){function t(t,r,n){void 0===r&&(r=0);var i=e.call(this,Int32Array,t,r,n)||this;return i.elementType="i32",i}return r(t,e),t.ElementType="i32",t}(l.BufferViewVec4Impl);t.BufferViewVec4i32=k}.apply(null,n))||(e.exports=i)},620:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(346),r(358),r(395)],void 0===(i=function(e,t,r,n,i){function o(e){return e instanceof r}function a(e){return e instanceof n?Object.keys(e.items):o(e)?i.getProperties(e).keys():e?Object.keys(e):[]}function s(e,t){return e instanceof n?e.items[t]:e[t]}function l(e){return e?e.declaredClass:null}function u(e,t){var r=e.diff;if(r&&"function"==typeof r)return r(e,t);var n=a(e),i=a(t);if(0!==n.length||0!==i.length){if(!n.length||!i.length||function(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&e.length!==t.length}(e,t))return{type:"complete",oldValue:e,newValue:t};var d=i.filter(function(e){return-1===n.indexOf(e)}),p=n.filter(function(e){return-1===i.indexOf(e)}),f=n.filter(function(r){return i.indexOf(r)>-1&&s(e,r)!==s(t,r)}).concat(d,p).sort(),h=l(e);if(h&&c.indexOf(h)>-1&&f.length)return{type:"complete",oldValue:e,newValue:t};var m,v=o(e)&&o(t);for(var g in f){var y=f[g],b=s(e,y),_=s(t,y),x=void 0;(v||"function"!=typeof b&&"function"!=typeof _)&&b!==_&&(null==b&&null==_||(x=r&&r[y]&&"function"==typeof r[y]?r[y](b,_):"object"==typeof b&&"object"==typeof _&&l(b)===l(_)?u(b,_):{type:"complete",oldValue:b,newValue:_})&&((m=m||{type:"partial",diff:{}}).diff[y]=x))}return m}}Object.defineProperty(t,"__esModule",{value:!0});var c=["esri.Color","esri.portal.Portal"];t.diff=function(e,t){if("function"!=typeof e&&"function"!=typeof t&&(e||t))return!e||!t||"object"==typeof e&&"object"==typeof t&&l(e)!==l(t)?{type:"complete",oldValue:e,newValue:t}:u(e,t)}}.apply(null,n))||(e.exports=i)},622:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1007),r(1274),r(1275)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0}),t.plane=n,t.triangle=i,t.lineSegment=r}.apply(null,n))||(e.exports=i)},626:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(345),r(351),r(350),r(420),r(625),r(627),r(405)],void 0===(i=function(e,t,r,n,i,o,a,s,l){function u(e,t){var r=e.geometry,n=e.toJSON(),i=n;if(r&&(i.geometry=JSON.stringify(r),i.geometryType=o.getJsonType(r),i.inSR=r.spatialReference.wkid||JSON.stringify(r.spatialReference)),n.groupByFieldsForStatistics&&(i.groupByFieldsForStatistics=n.groupByFieldsForStatistics.join(",")),n.objectIds&&(i.objectIds=n.objectIds.join(",")),n.orderByFields&&(i.orderByFields=n.orderByFields.join(",")),!n.outFields||t&&(t.returnCountOnly||t.returnExtentOnly||t.returnIdsOnly)?delete i.outFields:-1!==n.outFields.indexOf("*")?i.outFields="*":i.outFields=n.outFields.join(","),n.outSR?i.outSR=n.outSR.wkid||JSON.stringify(n.outSR):r&&(n.returnGeometry||n.returnCentroid)&&(i.outSR=i.inSR),n.returnGeometry&&delete n.returnGeometry,n.outStatistics&&(i.outStatistics=JSON.stringify(n.outStatistics)),n.pixelSize&&(i.pixelSize=JSON.stringify(n.pixelSize)),n.quantizationParameters&&(i.quantizationParameters=JSON.stringify(n.quantizationParameters)),n.source&&(i.layer=JSON.stringify({source:n.source}),delete n.source),n.timeExtent){var a=n.timeExtent;i.time=[null!=a.startTime?a.startTime:"null",null!=a.endTime?a.endTime:"null"],delete n.timeExtent}return i}function c(e,t,o,s,c){void 0===s&&(s={});var d="string"==typeof e?i.urlToObject(e):e,p=t.geometry?[t.geometry]:[];return s.responseType="pbf"===o?"array-buffer":"json",a.normalizeCentralMeridian(p,null,s).then(function(e){var i=e&&e[0];i&&((t=t.clone()).geometry=i);var a=l.mapParameters(r({},d.query,{f:o},c,u(t,c)));return n(d.path+"/query",r({},s,{query:a}))})}Object.defineProperty(t,"__esModule",{value:!0});var d="Layer does not support extent calculation.";t.queryToQueryStringParameters=u,t.executeQuery=function(e,t,r){return c(e,t,"json",r)},t.executeQueryPBF=function(e,t,r){return c(e,t,"pbf",r).then(function(e){var t=s.parsePBFFeatureQuery(e.data),r=e;return r.data=t,r})},t.executeQueryForIds=function(e,t,r){return c(e,t,"json",r,{returnIdsOnly:!0})},t.executeQueryForCount=function(e,t,r){return c(e,t,"json",r,{returnIdsOnly:!0,returnCountOnly:!0})},t.executeQueryForExtent=function(e,t,r){return c(e,t,"json",r,{returnExtentOnly:!0,returnCountOnly:!0}).then(function(e){var t=e.data;if(t.hasOwnProperty("extent"))return e;if(t.features)throw new Error(d);if(t.hasOwnProperty("count"))throw new Error(d);return e})}}.apply(null,n))||(e.exports=i)},627:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(342),r(343),r(427),r(628)],void 0===(i=function(e,t,r,n,i,o){Object.defineProperty(t,"__esModule",{value:!0});var a=n.getLogger("esri.tasks.operations.pbfQueryUtils");t.parsePBFFeatureQuery=function(e){try{var t=o.parseFeatureQuery(e).queryResult.featureResult;if(t&&t.features&&t.features.length&&t.objectIdFieldName)for(var n=t.objectIdFieldName,s=0,l=t.features;s<l.length;s++){var u=l[s];u.attributes&&(u.objectId=u.attributes[n])}return t}catch(e){var c=new r("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:e});return a.error(c),new i.default}}}.apply(null,n))||(e.exports=i)},628:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(594),r(607),r(427),r(597)],void 0===(i=function(e,t,r,n,i,o){function a(e){return e>=w.length?null:w[e]}function s(e){return e>=S.length?null:S[e]}function l(e){return e>=E.length?null:E[e]}function u(e){return e>=T.length?null:T[e]}function c(e){for(var t=new o.default,r=t.coords;e.next();)switch(e.tag()){case 3:for(var n=e.getUInt32(),i=e.pos()+n,a=0;e.pos()<i;)r[a++]=e.getSInt64();break;case 1:case 2:default:e.skip()}return t}function d(e){for(var t=new o.default,r=t.coords,n=t.lengths;e.next();)switch(e.tag()){case 2:for(var i=e.getUInt32(),a=e.pos()+i;e.pos()<a;)n.push(e.getUInt32());break;case 3:for(var s=e.getUInt32(),l=(a=e.pos()+s,0);e.pos()<a;)r[l++]=e.getSInt64();break;case 1:default:e.skip()}return t}function p(e){for(;e.next();)switch(e.tag()){case 1:return e.getString();case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getSInt32();case 5:return e.getUInt32();case 6:return e.getInt64();case 7:return e.getUInt64();case 8:return e.getSInt64();case 9:return e.getBool();default:return e.skip(),null}return null}function f(e){for(var t={type:a(0)};e.next();)switch(e.tag()){case 1:t.name=e.getString();break;case 2:t.type=a(e.getEnum());break;case 3:t.alias=e.getString();break;case 4:t.sqlType=s(e.getEnum());break;case 5:case 6:default:e.skip()}return t}function h(e,t){for(var r=new n.default,i=0;e.next();)switch(e.tag()){case 1:var o=e.getMessage(),a=t[i++].name;r.attributes[a]=p(o);break;case 2:r.geometry=d(e.getMessage());break;case 4:r.centroid=c(e.getMessage());break;default:e.skip()}return r}function m(e){for(var t=[0,0];e.next();)switch(e.tag()){case 1:t[0]=e.getDouble();break;case 2:t[1]=e.getDouble();break;case 3:case 4:t.push(e.getDouble());break;default:e.skip()}return t}function v(e){for(var t=[0,0];e.next();)switch(e.tag()){case 1:t[0]=e.getDouble();break;case 2:t[1]=e.getDouble();break;case 3:case 4:t.push(e.getDouble());break;default:e.skip()}return t}function g(e){for(var t={originPosition:l(0)};e.next();)switch(e.tag()){case 1:t.originPosition=l(e.getEnum());break;case 2:t.scale=m(e.getMessage());break;case 3:t.translate=v(e.getMessage());break;default:e.skip()}return t}function y(e){for(var t={};e.next();)switch(e.tag()){case 1:t.shapeAreaFieldName=e.getString();break;case 2:t.shapeLengthFieldName=e.getString();break;case 3:t.units=e.getString();break;default:e.skip()}return t}function b(e){for(var t={};e.next();)switch(e.tag()){case 1:t.wkid=e.getUInt32();break;case 5:t.wkt=e.getString();break;case 2:case 3:case 4:default:e.skip()}return t}function _(e){var t=new i.default;for(t.geometryType=u(0);e.next();)switch(e.tag()){case 1:t.objectIdFieldName=e.getString();break;case 3:t.globalIdFieldName=e.getString();break;case 4:t.geohashFieldName=e.getString();break;case 5:t.geometryProperties=y(e.getMessage());break;case 7:t.geometryType=u(e.getEnum());break;case 8:t.spatialReference=b(e.getMessage());break;case 10:t.hasZ=e.getBool();break;case 11:t.hasM=e.getBool();break;case 12:var r=e.getMessage();t.transform=g(r);break;case 9:var n=e.getBool();t.exceededTransferLimit=n;break;case 13:var o=e.getMessage();t.fields.push(f(o));break;case 15:var a=e.getMessage();t.features.push(h(a,t.fields));break;case 2:case 6:default:e.skip()}return t}function x(e){for(var t={};e.next();)switch(e.tag()){case 1:t.featureResult=_(e.getMessage());break;default:e.skip()}return t}Object.defineProperty(t,"__esModule",{value:!0});var w=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML"],S=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],T=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"],E=["upperLeft","lowerLeft"];t.parseFeatureQuery=function(e){for(var t=new r(new Uint8Array(e),new DataView(e)),n={};t.next();)switch(t.tag()){case 2:n.queryResult=x(t.getMessage());break;default:t.skip()}return n}}.apply(null,n))||(e.exports=i)},629:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(344)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){return function(e,t,n){void 0===e&&(e=r.vec3d.create()),void 0===t&&(t=r.vec3d.createFrom(.57735,.57735,.57735)),void 0===n&&(n=!0),this.intensity=e,this.direction=t,this.castShadows=n}}();t.MainLight=n;var i=function(){return function(e,t){void 0===e&&(e=r.vec3d.create()),void 0===t&&(t=r.vec3d.createFrom(.57735,.57735,.57735)),this.intensity=r.vec3d.create(),this.direction=r.vec3d.create(),this.intensity=e,this.direction=t}}();t.FillLight=i;var o=function(){return function(e){void 0===e&&(e=r.vec3d.create()),this.intensity=e}}();t.AmbientLight=o;var a=function(){return function(){this.sh={r:[0],g:[0],b:[0]}}}();t.SphericalHarmonicsLight=a}.apply(null,n))||(e.exports=i)},630:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(372),r(401)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0}),t.blendLayers={name:"blend-layers",shaders:{vertexShader:n.resolveIncludes("misc/blendLayers.vert"),fragmentShader:n.resolveIncludes("misc/blendLayers.frag")},attributes:r.Default3D},t.simple={name:"simple",shaders:{vertexShader:n.resolveIncludes("misc/simple.vert"),fragmentShader:n.resolveIncludes("misc/simple.frag")},attributes:r.Default3D},t.texOnly={name:"tex-only",shaders:{vertexShader:n.resolveIncludes("misc/texOnly.vert"),fragmentShader:n.resolveIncludes("misc/texOnly.frag")},attributes:r.Default3D},t.showDepth={name:"show-depth",shaders:{vertexShader:n.resolveIncludes("misc/showDepth.vert"),fragmentShader:n.resolveIncludes("misc/showDepth.frag")},attributes:r.Default3D}}.apply(null,n))||(e.exports=i)},632:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(351),r(435),r(342),r(340),r(350),r(408),r(655),r(363),r(763),r(750)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,c,d){function p(e,t){return t.load().then(function(){var r=new l({disableExtraQuery:!0,query:"owner:"+g+" AND type:"+y+' AND typekeywords:"'+e+'"'});return t.queryItems(r)}).then(function(t){var r=t.results,n=null,o=e.toLowerCase();if(r&&Array.isArray(r))for(var a=0,s=r;a<s.length;a++){var l=s[a];if(l.typeKeywords.some(function(e){return e.toLowerCase()===o})&&l.type===y&&l.owner===g){n=l;break}}if(n)return n.load();throw new i("symbolstyleutils:style-not-found","The style '"+e+"' could not be found",{styleName:e})})}function f(e,t){return e.styleUrl?function(e,t){return m(e).then(function(t){return{data:t.data,baseUrl:a.removeFile(e),styleUrl:e}})}(e.styleUrl):e.styleName?function(e,t){var r,n=t.portal||s.getDefault(),i=n.url+" - "+(n.user&&n.user.username)+" - "+e;return v[i]||(v[i]=p(e,n).then(function(e){return r=e,e.fetchData()}).then(function(t){return{data:t,baseUrl:r.itemUrl,styleName:e}})),v[i]}(e.styleName,t):o.reject(new i("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function h(e,t,r){for(var s=e.data,l={portal:r.portal,url:a.urlToObject(e.baseUrl),origin:"portal-item"},p=0,f=s.items;p<f.length;p++){var h=function(i){if(i.name!==t)return"continue";var o=a.read(i.webRef,l),s={portal:r.portal,url:a.urlToObject(a.removeFile(o)),origin:"portal-item"};return{value:m(o).then(function(o){var p=u.fromJSON(o.data,s);if(p&&p.isInstanceOf(n.BaseSymbol3D)){if(i.thumbnail)if(i.thumbnail.href){var f=a.read(i.thumbnail.href,l);p.thumbnail=new d.default({url:f})}else i.thumbnail.imageData&&(p.thumbnail=new d.default({url:"data:image/png;base64,"+i.thumbnail.imageData}));e.styleUrl?p.styleOrigin=new c({portal:r.portal,styleUrl:e.styleUrl,name:t}):e.styleName&&(p.styleOrigin=new c({portal:r.portal,styleName:e.styleName,name:t}))}return p})}}(f[p]);if("object"==typeof h)return h.value}return o.reject(new i("symbolstyleutils:symbol-name-not-found","The symbol name '"+t+"' could not be found",{symbolName:t}))}function m(e){var t={responseType:"json",query:{f:"json"}};return r(a.normalize(e),t)}Object.defineProperty(t,"__esModule",{value:!0});var v={};t.fetchStyle=f,t.resolveWebStyleSymbol=function(e,t){return e.name?f(e,t).then(function(r){return h(r,e.name,t)}):o.reject(new i("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference"))},t.fetchSymbolFromStyle=h,t.styleNameFromItem=function(e){for(var t=0,r=e.typeKeywords;t<r.length;t++){var n=r[t];if(/^Esri.*Style$/.test(n)&&"Esri Style"!==n)return n}};var g="esri_en",y="Style"}.apply(null,n))||(e.exports=i)},633:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(340),r(440)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0}),t.loadStyleRenderer=function(e,t){var i=e&&e.getAtOrigin&&e.getAtOrigin("renderer",t.origin);return i&&"unique-value"===i.type&&i.styleOrigin?i.populateFromStyle().catch(function(r){t&&t.messages&&t.messages.push(new n("renderer:style-reference","Failed to create unique value renderer from style reference: "+r.message,{error:r,context:t})),e.clear("renderer",t.origin)}).then(function(){return null}):r.resolve(null)}}.apply(null,n))||(e.exports=i)},634:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(344),r(622),r(364),r(349)],void 0===(i=function(e,t,r,n,i,o){function a(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2],o=t[3]-e[3];return r*r+n*n+i*i+o*o}function s(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function l(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}var u=function(){function e(e,t,i){this._viewUp=r.vec3d.create(),this._viewForward=r.vec3d.create(),this._viewRight=r.vec3d.create(),this._viewport=r.vec4d.create(),this._padding=r.vec4d.create(),this._fov=55/180*Math.PI,this._near=0,this._far=1e3,this._viewDirty=!0,this._viewMatrix=r.mat4d.create(),this._projectionDirty=!0,this._projectionMatrix=r.mat4d.create(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=r.mat4d.create(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=r.mat4d.create(),this._frustumPlanesDirty=!0,this._frustumPlanes=[n.plane.create(),n.plane.create(),n.plane.create(),n.plane.create(),n.plane.create(),n.plane.create()],this._fullViewport=null,this.relativeElevation=0,this._eye=r.vec3d.create(e),this._center=r.vec3d.create(t),this._up=void 0!==i?r.vec3d.create(i):r.vec3d.create([0,0,1]),this._padding=r.vec4d.create()}return Object.defineProperty(e.prototype,"eye",{get:function(){return this._eye},set:function(e){this._compareAndSetView(e,this._eye)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"center",{get:function(){return this._center},set:function(e){this._compareAndSetView(e,this._center)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"up",{get:function(){return this._up},set:function(e){this._compareAndSetView(e,this._up)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewMatrix",{get:function(){return this._ensureViewClean(),this._viewMatrix},set:function(e){r.mat4d.set(e,this._viewMatrix),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumPlanesDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewForward",{get:function(){return this._ensureViewClean(),this._viewForward},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewUp",{get:function(){return this._ensureViewClean(),this._viewUp},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewRight",{get:function(){return this._ensureViewClean(),this._viewRight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"near",{get:function(){return this._near},set:function(e){this._near!==e&&(this._near=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumPlanesDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"far",{get:function(){return this._far},set:function(e){this._far!==e&&(this._far=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumPlanesDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewport",{get:function(){return this._viewport},set:function(e){this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this._viewport[0]},set:function(e){e+=this._padding[3],this._viewport[0]!==e&&(this._viewport[0]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumPlanesDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._viewport[1]},set:function(e){e+=this._padding[2],this._viewport[1]!==e&&(this._viewport[1]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumPlanesDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._viewport[2]},set:function(e){this._viewport[2]!==e&&(this._viewport[2]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumPlanesDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._viewport[3]},set:function(e){this._viewport[3]!==e&&(this._viewport[3]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumPlanesDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullWidth",{get:function(){return this._viewport[2]+this._padding[1]+this._padding[3]},set:function(e){this.width=e-(this._padding[1]+this._padding[3])},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullHeight",{get:function(){return this._viewport[3]+this._padding[0]+this._padding[2]},set:function(e){this.height=e-(this._padding[0]+this._padding[2])},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullViewport",{get:function(){return this._fullViewport||(this._fullViewport=r.vec4d.create()),this._fullViewport[0]=this._viewport[0]-this._padding[3],this._fullViewport[1]=this._viewport[1]-this._padding[2],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"aspect",{get:function(){return this.width/this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"padding",{get:function(){return this._padding},set:function(e){this._padding[0]===e[0]&&this._padding[1]===e[1]&&this._padding[2]===e[2]&&this._padding[3]===e[3]||(this._viewport[0]+=e[3]-this._padding[3],this._viewport[1]+=e[2]-this._padding[2],this._viewport[2]-=e[1]+e[3]-(this._padding[1]+this._padding[3]),this._viewport[3]-=e[0]+e[2]-(this._padding[0]+this._padding[2]),r.vec4d.set(e,this._padding),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumPlanesDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewProjectionMatrix",{get:function(){return this._viewProjectionDirty&&(r.mat4d.multiply(this.projectionMatrix,this.viewMatrix,this._viewProjectionMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"projectionMatrix",{get:function(){if(this._projectionDirty){var e=this.width,t=this.height,n=this.near*Math.tan(this.fovY/2),i=n*this.aspect;r.mat4d.frustum(-i*(1+2*this._padding[3]/e),i*(1+2*this._padding[1]/e),-n*(1+2*this._padding[2]/t),n*(1+2*this._padding[0]/t),this.near,this.far,this._projectionMatrix),this._projectionDirty=!1}return this._projectionMatrix},set:function(e){r.mat4d.set(e,this._projectionMatrix),this._projectionDirty=!1,this._viewProjectionDirty=!0,this._frustumPlanesDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fov",{get:function(){return this._fov},set:function(e){this._fov=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumPlanesDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fovX",{get:function(){return o.fovd2fovx(this._fov,this.width,this.height)},set:function(e){this._fov=o.fovx2fovd(e,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumPlanesDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fovY",{get:function(){return o.fovd2fovy(this._fov,this.width,this.height)},set:function(e){this._fov=o.fovy2fovd(e,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumPlanesDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distance",{get:function(){return r.vec3d.dist(this._center,this._eye)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frustumPoints",{get:function(){return this.computeFrustumPoints()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frustumPlanes",{get:function(){return this._frustumPlanesDirty&&(this._frustumPlanes=this._computeFrustumPlanes(this._frustumPlanes),this._frustumPlanesDirty=!1),this._frustumPlanes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewInverseTransposeMatrix",{get:function(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(this._viewInverseTransposeMatrix||(this._viewInverseTransposeMatrix=r.mat4d.create()),r.mat4d.inverse(this.viewMatrix,this._viewInverseTransposeMatrix),r.mat4d.transpose(this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"perPixelRatio",{get:function(){return Math.tan(this.fovX/2)/this.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"aboveGround",{get:function(){return this.relativeElevation>=0},enumerable:!0,configurable:!0}),e.prototype.copyFrom=function(e){return r.vec3d.set(e._eye,this._eye),r.vec3d.set(e._center,this._center),r.vec3d.set(e._up,this._up),r.vec4d.set(e._viewport,this._viewport),r.vec4d.set(e._padding,this._padding),this._near=e._near,this._far=e._far,this._fov=e._fov,this.relativeElevation=e.relativeElevation,e._viewDirty?this._viewDirty=!0:(r.mat4d.set(e._viewMatrix,this._viewMatrix),r.vec3d.set(e._viewRight,this._viewRight),r.vec3d.set(e._viewUp,this._viewUp),r.vec3d.set(e._viewForward,this._viewForward),this._viewDirty=!1),e._projectionDirty?this._projectionDirty=!0:(r.mat4d.set(e._projectionMatrix,this._projectionMatrix),this._projectionDirty=!1),this._viewProjectionDirty=!0,e._frustumPlanesDirty?this._frustumPlanesDirty=!0:(e.copyFrustumPlanes(this._frustumPlanes),this._frustumPlanesDirty=!1),e._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(this._viewInverseTransposeMatrix?r.mat4d.set(e._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix):this._viewInverseTransposeMatrix=r.mat4d.create(e._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),e._fullViewport?this._fullViewport?r.vec4d.set(e._fullViewport,this._fullViewport):this._fullViewport=r.vec4d.create(e._fullViewport):this._fullViewport=null,this},e.prototype.copyViewFrom=function(e){this.eye=e.eye,this.center=e.center,this.up=e.up},e.prototype.copy=function(){var t=new e;return t.copyFrom(this),t},e.prototype.equivalent=function(e){return s(this._eye,e._eye)&&s(this._center,e._center)&&s(this._up,e._up)&&l(this._viewport,e._viewport)&&l(this._padding,e._padding)&&this._near===e._near&&this._far===e._far&&this._fov===e._fov},e.prototype.almostEquals=function(e,t,n){void 0===n&&(n=!1);var i,o=r.vec3d.dist(this._eye,this._center)*(t||5e-4),s=o*o;return n?(r.vec3d.direction(e._center,e._eye,p),r.vec3d.direction(this._center,this._eye,f),i=1e-10):(r.vec3d.set(e._center,p),r.vec3d.set(this._center,f),i=s),r.vec3d.dist2(e._eye,this._eye)<s&&r.vec3d.dist2(p,f)<i&&Math.abs(e._fov-this._fov)<.001&&a(e._padding,this._padding)<.5&&a(e._viewport,this._viewport)<.5},e.prototype.markViewDirty=function(){this._viewDirty=!0,this._frustumPlanesDirty=!0,this._viewProjectionDirty=!0},e.prototype.computePixelSizeAt=function(e){return this.computePixelSizeAtDist(r.vec3d.dist(e,this._eye))},e.prototype.computePixelSizeAtDist=function(e){return 2*e*Math.tan(this.fovX/2)/this.width},e.prototype.computeDistanceFromRadius=function(e,t){return e/Math.tan(Math.min(this.fovX,this.fovY)/(2*(t||1)))},e.prototype.copyFrustumPlanes=function(e){if(!e){e=new Array(6);for(var t=0;t<6;++t)e[t]=r.vec4d.create()}var n=this.frustumPlanes;for(t=0;t<6;t++)r.vec4d.set(n[t],e[t]);return e},e.prototype.computeFrustumPoints=function(e){if(!e){e=new Array(8);for(var t=0;t<8;++t)e[t]=r.vec3d.create()}return o.matrixToFrustumPoints(this.viewMatrix,this.projectionMatrix,e),e},e.prototype.setGLViewport=function(e){var t=this.viewport,r=this.padding;e.setViewport(t[0]-r[3],t[1]-r[2],t[2]+r[1]+r[3],t[3]+r[0]+r[2])},e.prototype.applyProjection=function(e,t,n){void 0===n&&(n=!1),e!==c&&r.vec3d.set(e,c),c[3]=1,n&&(t[2]=-c[2]),r.mat4d.multiplyVec4(this.projectionMatrix,c),r.vec3d.scale(c,1/Math.abs(c[3]));var o=this.fullViewport;return t[0]=i.lerp(0,o[0]+o[2],.5+.5*c[0]),t[1]=i.lerp(0,o[1]+o[3],.5+.5*c[1]),n||(t[2]=.5*(c[2]+1)),t},e.prototype.projectPoint=function(e,t){c[0]=e[0],c[1]=e[1],c[2]=e[2],c[3]=1,r.mat4d.multiplyVec4(this.viewProjectionMatrix,c),r.vec3d.scale(c,1/Math.abs(c[3]));var n=this.fullViewport;return t[0]=i.lerp(0,n[0]+n[2],.5+.5*c[0]),t[1]=i.lerp(0,n[1]+n[3],.5+.5*c[1]),t[2]=.5*(c[2]+1),t},e.prototype.unprojectPoint=function(e,t,n){if(void 0===n&&(n=!1),n)return console.error("Camera.unprojectPoint() not yet implemented for linear Z"),null;if(r.mat4d.multiply(this.projectionMatrix,this.viewMatrix,d),!r.mat4d.inverse(d))return null;var i=this.fullViewport;return c[0]=2*(e[0]-i[0])/i[2]-1,c[1]=2*(e[1]-i[1])/i[3]-1,c[2]=2*e[2]-1,c[3]=1,r.mat4d.multiplyVec4(d,c),0===c[3]?null:(t[0]=c[0]/c[3],t[1]=c[1]/c[3],t[2]=c[2]/c[3],t)},e.prototype.computeUp=function(e){"global"===e?this.computeUpGlobal():this.computeUpLocal()},e.prototype.computeUpGlobal=function(){r.vec3d.subtract(this.center,this.eye,p);var e=r.vec3d.length(this.center);e<1?(r.vec3d.set3(0,0,1,this.up),this.markViewDirty()):Math.abs(r.vec3d.dot(p,this.center))>.9999*r.vec3d.length(p)*e||(r.vec3d.cross(p,this.center,this.up),r.vec3d.cross(this.up,p,this.up),r.vec3d.normalize(this.up),this.markViewDirty())},e.prototype.computeUpLocal=function(){r.vec3d.direction(this.center,this.eye,p),Math.abs(p[2])<=.9999&&(r.vec3d.scale(p,p[2]),r.vec3d.set3(-p[0],-p[1],1-p[2],this.up),r.vec3d.normalize(this.up),this.markViewDirty())},e.prototype._compareAndSetView=function(e,t){s(e,t)||(r.vec3d.set(e,t),this._viewDirty=!0,this._frustumPlanesDirty=!0,this._viewProjectionDirty=!0)},e.prototype._computeFrustumPlanes=function(e){if(!e){e=new Array(6);for(var t=0;t<6;++t)e[t]=n.plane.create()}return o.matrixToFrustumPlanes(this.viewMatrix,this.projectionMatrix,e),e},e.prototype._ensureViewClean=function(){this._viewDirty&&(r.mat4d.lookAt(this._eye,this._center,this._up,this._viewMatrix),r.vec3d.set3(-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10],this._viewForward),r.vec3d.set3(this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9],this._viewUp),r.vec3d.set3(this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8],this._viewRight),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)},e}(),c=r.vec4d.create(),d=r.mat4d.create(),p=r.vec3d.create(),f=r.vec3d.create();return u}.apply(null,n))||(e.exports=i)},638:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(414),r(415),r(369),r(413),r(416),r(421)],void 0===(i=function(e,t,r,n,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0}),t.ClassBreaksRenderer=r,t.HeatmapRenderer=n,t.BaseRenderer=i,t.SimpleRenderer=o,t.UniqueValueRenderer=a,t.isRenderer=function(e){return e instanceof t.BaseRenderer},t.fromJSON=s.fromJSON}.apply(null,n))||(e.exports=i)},639:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(345),r(351),r(350),r(405)],void 0===(i=function(e,t,r,n,i,o){Object.defineProperty(t,"__esModule",{value:!0}),t.processAttachmentQueryResult=function(e,t,n){for(var o={},a=0,s=e;a<s.length;a++)for(var l=s[a],u=l.parentObjectId,c=0,d=l.attachmentInfos;c<d.length;c++){var p=d[c],f=p.id,h=i.addProxy(t+"/"+u+"/attachments/"+f+(n?"?token="+n:"")),m=r({},p,{parentObjectId:u,url:h});o[u]?o[u].push(m):o[u]=[m]}return o},t.executeAttachmentQuery=function(e,t,i){var a={query:o.mapParameters(r({},e.query,{f:"json"},function(e){var t=e.toJSON();return t.attachmentTypes&&(t.attachmentTypes=t.attachmentTypes.join(",")),t.globalIds&&(t.globalIds=t.globalIds.join(",")),t.objectIds&&(t.objectIds=t.objectIds.join(",")),t.size&&(t.size=t.size.join(",")),t}(t)))};return i&&(a=r({},i,a)),n(e.path+"/queryAttachments",a)}}.apply(null,n))||(e.exports=i)},640:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(351)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.dataURItoBlob=function(e){for(var t=atob(e.split(",")[1]),r=e.split(",")[0].split(":")[1].split(";")[0],n=new ArrayBuffer(t.length),i=new Uint8Array(n),o=0;o<t.length;o++)i[o]=t.charCodeAt(o);return new Blob([n],{type:r})},t.requestImage=function(e){return r(e,{responseType:"image"}).then(function(e){return e.data})}}.apply(null,n))||(e.exports=i)},641:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(347),r(354),r(406),r(344),r(665),r(738),r(651),r(419),r(349),r(672),r(424),r(424),r(888)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,c,d,p,f,h){function m(e,t,r){!function(e,t){return!e.slicePlaneEnabled&&(e.cullFace?"none"!==e.cullFace:!e.transparent&&!e.doubleSided)}(t)?e.setFaceCullingEnabled(!1):(e.setFaceCullingEnabled(!0),"front"===t.cullFace?e.setCullFace(1028):e.setCullFace(1029))}function v(e){e.setFaceCullingEnabled(!1)}function g(e,t){return e?u.TRANSPARENT_MATERIAL:t?u.STENCIL_MATERIAL:u.OPAQUE_MATERIAL}function y(e,t){var r=t.vvSizeEnabled;t.vvSizeEnabled?(e.setUniform3fv("vvSizeMinSize",t.vvSizeMinSize),e.setUniform3fv("vvSizeMaxSize",t.vvSizeMaxSize),e.setUniform3fv("vvSizeOffset",t.vvSizeOffset),e.setUniform3fv("vvSizeFactor",t.vvSizeFactor)):r&&e.setUniform3fv("vvSizeValue",t.vvSizeValue),r&&(e.setUniform3fv("vvSymbolAnchor",t.vvSymbolAnchor),i.computeObjectRotation(t.vvSymbolRotation[2],t.vvSymbolRotation[0],t.vvSymbolRotation[1],o.mat4d.identity(R)),e.setUniformMatrix3fv("vvSymbolRotation",o.mat4d.toMat3(R,I))),t.vvColorEnabled&&(e.setUniform1fv("vvColorValues",t.vvColorValues),e.setUniform4fv("vvColorColors",t.vvColorColors))}var b=c.assert,_=1,x=function(e){function t(r,n){var i=e.call(this,n)||this;return i.supportsEdges=!0,i.params=f.copyParameters(r,O),i.instanced=!!r.instanced,i.vertexBufferLayout=t.getVertexBufferLayout(i.params),i.instanceBufferLayout=i.instanced?t.getInstanceBufferLayout(i.params):null,i.bufferWriter=new P(i.vertexBufferLayout,i.instanceBufferLayout),i}return r(t,e),t.prototype.isVisible=function(){var t=this.params;if(!e.prototype.isVisible.call(this)||0===t.layerOpacity)return!1;var r=t.instanced,n=t.vertexColors,i=t.symbolColors,o=!!r&&r.indexOf("color")>-1,a=t.vvColorEnabled,s="replace"===t.colorMixMode,l=t.opacity>0,u=t.externalColor&&t.externalColor[3]>0;return n&&(o||a||i)?!!s||l:n?s?u:l:o||a||i?!!s||l:s?u:l},t.prototype.getParams=function(){return this.params},t.prototype.getParameterValues=function(){return f.copyParameters(this.params)},t.prototype.setParameterValues=function(e){var t=this.params;for(var r in e)"textureId"===r&&b(t.textureId,"Can only change texture of material that already has a texture"),"castShadows"===r&&b(e.castShadows===t.castShadows,"Can not change shadow casting behavior."),t[r]=e[r];this.notifyDirty("matChanged")},t.prototype.intersect=function(e,t,r,n,i,a,s,l){if(null!==this.params.verticalOffset){var u=n.camera;o.vec3d.set3(r[12],r[13],r[14],j);var c=o.vec3d.subtract(j,u.eye,V),d=o.vec3d.length(c),p=o.vec3d.scale(c,1/d),h=null,m=null;switch(n.viewingMode){case"global":m=o.vec3d.normalize(j,L);break;case"local":m=o.vec3d.set(F,L)}this.params.screenSizePerspective&&(h=o.vec3d.dot(m,p));var v=f.verticalOffsetAtDistance(u,d,this.params.verticalOffset,h,this.params.screenSizePerspective);o.vec3d.scale(m,v),o.mat3d.multiplyVec3(n.transformInverseRotation,m,N),i=o.vec3d.subtract(i,N,M),a=o.vec3d.subtract(a,N,D)}f.intersectTriangleGeometry(e,t,r,n,i,a,s)},t.prototype.getGLMaterials=function(){return{color:w,depthShadowMap:this.params.castShadows?T:null,normal:E,depth:S,highlight:C}},t.prototype.getAllTextureIds=function(){return this.params.textureId?[this.params.textureId]:[]},t.getVertexBufferLayout=function(e){var t=a.newLayout().vec3f("position");return e.groundNormalShading||(t=e.compressedNormals?t.vec2i16("normalCompressed",{glNormalized:!0}):t.vec3f("normal")),e.textureId&&(t=t.vec2f("uv0"),e.atlasRegions&&(t=t.vec4u16("region",{glNormalized:!0}))),e.vertexColors&&(t=t.vec4u8("color")),e.symbolColors&&(t=t.vec4u8("symbolColor")),e.componentIndices&&(t=t.u16("componentIndex").u16("_padding",{glPadding:!0})),t},t.getInstanceBufferLayout=function(e){var t=a.newLayout();return t=e.instancedDoublePrecision?t.vec3f("modelOriginHi").vec3f("modelOriginLo").mat3f("model").mat3f("modelNormal"):t.mat4f("model").mat4f("modelNormal"),e.instanced&&e.instanced.indexOf("color")>-1&&(t=t.vec4f("instanceColor")),e.instanced&&e.instanced.indexOf("featureAttribute")>-1&&(t=t.vec4f("instanceFeatureAttribute")),t},t}(l),w=function(e){function t(t,r,n){var i=this,o=t.getParams();(i=e.call(this,t,r,n,o.textureId,o.textureInitTransparent)||this).params=f.copyParameters(o);var a=i.params;i.slot=g(a.transparent,a.writeStencil),i.texturing=a.textureId?a.atlasRegions?"AtlasTextured":"Textured":"none";var s=a.instanced;return i.instanced=!!s,i.instancedColor=!!s&&s.indexOf("color")>-1,i._createPrograms(),i}return r(t,e),t.prototype._createPrograms=function(){var e=this;this.programs=p.BindParametersMap.create(this.params,function(t){return e._createProgram(t)})},t.prototype._createProgram=function(e){var t=this.params;return this.programRep.getProgram(h.colorPass,{viewingMode:this.programRep.globalOptions.viewingMode,textureMode:this.texturing,vertexColors:t.vertexColors,symbolColors:t.symbolColors,flipV:t.flipV,doubleSided:t.doubleSided&&"normal"===t.doubleSidedType,windowOrderDoubleSided:t.doubleSided&&"winding-order"===t.doubleSidedType,instanced:!!this.instanced,instancedDoublePrecision:t.instancedDoublePrecision,instancedColor:this.instancedColor,receiveShadows:e.receiveShadows,receiveSSAO:e.receiveSSAO,vvSize:t.vvSizeEnabled,vvColor:t.vvColorEnabled,verticalOffset:null!==t.verticalOffset,screenSizePerspective:null!==t.screenSizePerspective,slice:t.slicePlaneEnabled,groundNormalShading:t.groundNormalShading,compressedNormals:t.compressedNormals,componentColor:null!=t.componentColorBuffer,transparencyDiscard:t.transparent,alphaCoverageCorrection:A})},t.prototype.beginSlot=function(e){return e===this.slot},t.prototype.getProgram=function(){return this.program||this.getPrograms()[0]},t.prototype.getPrograms=function(){return p.BindParametersMap.programs(this.programs)},t.prototype.updateParameters=function(){this.params=this.material.getParameterValues(),this.slot=g(this.params.transparent,this.params.writeStencil),this.updateTexture(this.params.textureId),this._createPrograms()},t.prototype.bind=function(e,t){var r=this.params,n=this.program=p.BindParametersMap.lookup(this.programs,t);e.bindProgram(n),n.setUniform3fv("ambient",r.ambient),n.setUniform3fv("diffuse",r.diffuse),n.setUniform3fv("specular",r.specular),n.setUniform4fv("externalColor",r.externalColor),n.setUniform1i("colorMixMode",f.colorMixModes[r.colorMixMode]),n.setUniform1f("opacity",r.opacity),n.setUniform1f("layerOpacity",r.layerOpacity),f.bindVerticalOffset(r.verticalOffset,t,n),f.bindScreenSizePerspective(r.screenSizePerspective,t,n),y(n,r),this.bindTexture(e,n),"none"!==this.texturing&&this.bindTextureSize(e,n),e.setBlendFunctionSeparate(770,771,1,771),r.inverseWindingOrder&&e.setFrontFace(2304),r.transparent?(e.setBlendingEnabled(!0),r.blendModeOneOne?(e.setBlendFunction(1,1),e.setDepthWriteEnabled(!1)):e.setBlendFunctionSeparate(770,771,1,771)):e.setBlendingEnabled(!1),r.polygonOffset&&(e.setPolygonOffsetFillEnabled(!0),e.setPolygonOffset(2,2)),m(e,r),e.setDepthTestEnabled(!0),r.componentIndices&&r.componentColorBuffer&&(r.componentColorBuffer.updateTexture(),r.componentColorBuffer.bind(n,{texName:"uComponentColorTex",invDimName:"uComponentColorTexInvDim",unit:_}))},t.prototype.release=function(e,t){e.setPolygonOffsetFillEnabled(!1),v(e),e.setBlendingEnabled(!1),e.setBlendFunctionSeparate(770,771,1,771),e.setDepthWriteEnabled(!0),e.setFrontFace(2305)},t.prototype.bindView=function(e,t){var r=this.program=p.BindParametersMap.lookup(this.programs,t),n=this.params,i=n.instancedDoublePrecision?[t.viewInvTransp[3],t.viewInvTransp[7],t.viewInvTransp[11]]:t.origin;f.bindView(i,t.view,r),f.bindCamPos(i,t.viewInvTransp,r),n.instancedDoublePrecision&&f.bindViewOriginDouble(i,r),n.slicePlaneEnabled&&f.bindSlicePlane(i,t.slicePlane,r),t.shadowMappingEnabled&&t.shadowMap.bindView(r,i)},t.prototype.bindInstance=function(e,t){var r=this.program;r.setUniformMatrix4fv("model",t.transformation),r.setUniformMatrix4fv("modelNormal",t.transformationNormal)},t.prototype.getDrawMode=function(e){return 4},t}(s),S=function(e){function t(t,r,n,i){void 0===i&&(i=!1);var o=e.call(this,t,r,n,t.getParams().textureId)||this;return o.params=f.copyParameters(t.getParams()),o.instanced=!!o.params.instanced,o.texturing=t.bufferWriter.vertexBufferLayout.hasField("uv0")?o.params.atlasRegions?"AtlasTextured":"Textured":"none",o.biased=i,o.selectProgram(),o.selectSlot(),o}return r(t,e),t.prototype.beginSlot=function(e){return e===this.slot},t.prototype.getProgram=function(){return this.program},t.prototype.selectProgram=function(){this.program=this.programRep.getProgram(h.depthPass,{viewingMode:this.programRep.globalOptions.viewingMode,textureMode:this.texturing,flipV:this.params.flipV,instanced:this.instanced,instancedDoublePrecision:this.params.instancedDoublePrecision,shadowMap:this.biased,vvSize:this.params.vvSizeEnabled,verticalOffset:null!==this.params.verticalOffset,screenSizePerspective:null!==this.params.screenSizePerspective,slice:this.params.slicePlaneEnabled,transparencyDiscard:this.params.transparent,alphaCoverageCorrection:A})},t.prototype.selectSlot=function(){this.slot=g(this.params.transparent,this.params.writeStencil)},t.prototype.updateParameters=function(){this.params=this.material.getParameterValues(),this.selectProgram(),this.selectSlot(),this.updateTexture(this.params.textureId)},t.prototype.bind=function(e,t){var r=this.program,n=this.params;e.bindProgram(r),r.setUniform2fv("nearFar",t.nearFar),n.inverseWindingOrder&&e.setFrontFace(2304),f.bindVerticalOffset(n.verticalOffset,t,r),f.bindScreenSizePerspective(n.screenSizePerspective,t,r),y(r,n),this.bindTexture(e,r),m(e,n),e.setDepthTestEnabled(!0)},t.prototype.release=function(e){var t=this.params;v(e),t.inverseWindingOrder&&e.setFrontFace(2305)},t.prototype.bindView=function(e,t){var r=this.program,n=this.params,i=n.instancedDoublePrecision?[t.viewInvTransp[3],t.viewInvTransp[7],t.viewInvTransp[11]]:t.origin;f.bindView(i,t.view,r),n.slicePlaneEnabled&&f.bindSlicePlane(t.origin,t.slicePlane,r),n.screenSizePerspective&&f.bindCamPos(i,t.viewInvTransp,r),n.instancedDoublePrecision&&f.bindViewOriginDouble(i,r)},t.prototype.bindInstance=function(e,t){this.program.setUniformMatrix4fv("model",t.transformation)},t.prototype.getDrawMode=function(e){return 4},t}(s),T=function(e){function t(t,r,n){return e.call(this,t,r,n,!0)||this}return r(t,e),t}(S),E=function(e){function t(t,r,n,i){void 0===i&&(i=!1);var o=e.call(this,t,r,n,t.getParams().textureId)||this;return o.params=f.copyParameters(t.getParams()),o.instanced=!!o.params.instanced,o.texturing=t.bufferWriter.vertexBufferLayout.hasField("uv0")?o.params.atlasRegions?"AtlasTextured":"Textured":"none",o.selectProgram(),o.selectSlot(),o}return r(t,e),t.prototype.beginSlot=function(e){return e===this.slot},t.prototype.getProgram=function(){return this.program},t.prototype.selectProgram=function(){this.program=this.programRep.getProgram(h.normalPass,{viewingMode:this.programRep.globalOptions.viewingMode,textureMode:this.texturing,flipV:this.params.flipV,instanced:this.instanced,instancedDoublePrecision:this.params.instancedDoublePrecision,vvSize:this.params.vvSizeEnabled,verticalOffset:null!==this.params.verticalOffset,screenSizePerspective:null!==this.params.screenSizePerspective,slice:this.params.slicePlaneEnabled,compressedNormals:this.params.compressedNormals,transparencyDiscard:this.params.transparent,alphaCoverageCorrection:A})},t.prototype.selectSlot=function(){this.slot=g(this.params.transparent,this.params.writeStencil)},t.prototype.updateParameters=function(){this.params=this.material.getParameterValues(),this.selectProgram(),this.selectSlot(),this.updateTexture(this.params.textureId)},t.prototype.bind=function(e,t){var r=this.program,n=this.params;e.bindProgram(r),this.bindTexture(e,r),f.bindVerticalOffset(n.verticalOffset,t,r),f.bindScreenSizePerspective(n.screenSizePerspective,t,r),y(r,n),m(e,n),n.inverseWindingOrder&&e.setFrontFace(2304),e.setDepthTestEnabled(!0)},t.prototype.release=function(e){var t=this.params;v(e),t.inverseWindingOrder&&e.setFrontFace(2305)},t.prototype.bindView=function(e,t){var r=this.program,n=this.params,i=n.instancedDoublePrecision?[t.viewInvTransp[3],t.viewInvTransp[7],t.viewInvTransp[11]]:t.origin;f.bindView(i,t.view,r),r.setUniformMatrix4fv("viewNormal",t.viewInvTransp),n.slicePlaneEnabled&&f.bindSlicePlane(t.origin,t.slicePlane,r),n.screenSizePerspective&&f.bindCamPos(i,t.viewInvTransp,r),n.instancedDoublePrecision&&f.bindViewOriginDouble(i,r)},t.prototype.bindInstance=function(e,t){var r=this.program;r.setUniformMatrix4fv("model",t.transformation),r.setUniformMatrix4fv("modelNormal",t.transformationNormal)},t.prototype.getDrawMode=function(e){return 4},t}(s),C=function(e){function t(t,r,n,i){void 0===i&&(i=!1);var o=e.call(this,t,r,n,t.getParams().textureId)||this;return o.params=f.copyParameters(t.getParams()),o.instanced=!!o.params.instanced,o.texturing=t.bufferWriter.vertexBufferLayout.hasField("uv0")?o.params.atlasRegions?"AtlasTextured":"Textured":"none",o.selectProgram(),o.selectSlot(),o}return r(t,e),t.prototype.beginSlot=function(e){return e===this.slot},t.prototype.getProgram=function(){return this.program},t.prototype.selectProgram=function(){this.program=this.programRep.getProgram(h.highlightPass,{viewingMode:this.programRep.globalOptions.viewingMode,textureMode:this.texturing,flipV:this.params.flipV,instanced:this.instanced,instancedDoublePrecision:this.params.instancedDoublePrecision,vvSize:this.params.vvSizeEnabled,verticalOffset:null!==this.params.verticalOffset,screenSizePerspective:null!==this.params.screenSizePerspective,slice:this.params.slicePlaneEnabled,transparencyDiscard:this.params.transparent,alphaCoverageCorrection:A})},t.prototype.selectSlot=function(){this.slot=g(this.params.transparent,this.params.writeStencil)},t.prototype.updateParameters=function(){this.params=this.material.getParameterValues(),this.selectProgram(),this.selectSlot(),this.updateTexture(this.params.textureId)},t.prototype.bind=function(e,t){var r=this.program,n=this.params;e.bindProgram(r),this.bindTexture(e,r),f.bindVerticalOffset(n.verticalOffset,t,r),f.bindScreenSizePerspective(n.screenSizePerspective,t,r),y(r,n),m(e,n),n.inverseWindingOrder&&e.setFrontFace(2304),e.setDepthTestEnabled(!0)},t.prototype.release=function(e){var t=this.params;v(e),t.inverseWindingOrder&&e.setFrontFace(2304)},t.prototype.bindView=function(e,t){var r=this.program,n=this.params,i=n.instancedDoublePrecision?[t.viewInvTransp[3],t.viewInvTransp[7],t.viewInvTransp[11]]:t.origin;f.bindView(i,t.view,r),n.slicePlaneEnabled&&f.bindSlicePlane(t.origin,t.slicePlane,r),n.screenSizePerspective&&f.bindCamPos(i,t.viewInvTransp,r),n.instancedDoublePrecision&&f.bindViewOriginDouble(i,r)},t.prototype.bindInstance=function(e,t){var r=this.program;r.setUniformMatrix4fv("model",t.transformation),r.setUniformMatrix4fv("modelNormal",t.transformationNormal)},t.prototype.getDrawMode=function(e){return 4},t}(s),O={textureId:void 0,textureInitTransparent:!1,ambient:[.2,.2,.2],diffuse:[.8,.8,.8],specular:[0,0,0],externalColor:[1,1,1,1],colorMixMode:"multiply",opacity:1,layerOpacity:1,blendModeOneOne:!1,inverseWindingOrder:!1,vertexColors:!1,symbolColors:!1,componentIndices:!1,componentColorBuffer:null,flipV:!1,doubleSided:!1,doubleSidedType:"normal",cullFace:void 0,instanced:void 0,instancedDoublePrecision:!1,compressedNormals:!1,groundNormalShading:!1,writeStencil:!1,receiveSSAO:!0,castShadows:!0,verticalOffset:null,screenSizePerspective:null,slicePlaneEnabled:!1,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvSizeValue:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvSymbolAnchor:[0,0,0],vvSymbolRotation:[0,0,0],transparent:!1,polygonOffset:!1,atlasRegions:!1},P=function(){function e(e,t){this.vertexBufferLayout=e,this.instanceBufferLayout=t}return e.prototype.allocate=function(e){return this.vertexBufferLayout.createBuffer(e)},e.prototype.elementCount=function(e){return e.indices.position.length},e.prototype.write=function(e,t,r,n,i){d.writeDefaultAttributes(t,r,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,n,i)},e}(),A=!!n("enable-feature:skallweit/lod-rendering"),I=o.mat3d.create(),R=o.mat4d.create(),M=o.vec3d.create(),D=o.vec3d.create(),F=o.vec3d.createFrom(0,0,1),L=o.vec3d.create(),N=o.vec3d.create(),j=o.vec3d.create(),V=o.vec3d.create();return x}.apply(null,n))||(e.exports=i)},643:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(338),r(336),r(341),r(348),r(339),r(337),r(644)],void 0===(i=function(e,t,r,n,i,o,a,s,l){var u=o({esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),c=o({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance"}),d=["inches","feet","yards","miles","nautical-miles","millimeters","centimeters","decimeters","meters","kilometers","decimal-degrees"];return function(e){function t(t){var r=e.call(this)||this;return r.lengthUnit=null,r.visualVariables=null,r}var i;return r(t,e),i=t,Object.defineProperty(t.prototype,"classificationMethod",{get:function(){var e=this._get("classificationMethod"),t=this.type;return t&&"relationship"!==t?"class-breaks-size"===t||"class-breaks-color"===t?e||"manual":null:e},set:function(e){this._set("classificationMethod",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fields",{get:function(){return this.type&&"predominance"!==this.type?null:this._get("fields")},set:function(e){this._set("fields",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"field1",{get:function(){return this.type&&"relationship"!==this.type?null:this._get("field1")},set:function(e){this._set("field1",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"field2",{get:function(){return this.type&&"relationship"!==this.type?null:this._get("field2")},set:function(e){this._set("field2",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"focus",{get:function(){return this.type&&"relationship"!==this.type?null:this._get("focus")},set:function(e){this._set("focus",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numClasses",{get:function(){return this.type&&"relationship"!==this.type?null:this._get("numClasses")},set:function(e){this._set("numClasses",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"standardDeviationInterval",{get:function(){var e=this.type;return e&&"relationship"!==e&&"class-breaks-size"!==e&&"class-breaks-color"!==e?null:this.classificationMethod&&"standard-deviation"!==this.classificationMethod?null:this._get("standardDeviationInterval")},set:function(e){this._set("standardDeviationInterval",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return this._get("type")},set:function(e){var t=e;"classed-size"===e?t="class-breaks-size":"classed-color"===e&&(t="class-breaks-color"),this._set("type",t)},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new i({classificationMethod:this.classificationMethod,fields:this.fields&&this.fields.slice(0),field1:a.clone(this.field1),field2:a.clone(this.field2),focus:this.focus,numClasses:this.numClasses,lengthUnit:this.lengthUnit,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map(function(e){return e.clone()})})},n([s.property({type:u.apiValues,value:null,dependsOn:["type"],json:{type:u.jsonValues,read:u.read,write:u.write}})],t.prototype,"classificationMethod",null),n([s.property({type:[String],value:null,dependsOn:["type"],json:{write:!0}})],t.prototype,"fields",null),n([s.property({value:null,dependsOn:["type"],json:{write:!0}})],t.prototype,"field1",null),n([s.property({value:null,dependsOn:["type"],json:{write:!0}})],t.prototype,"field2",null),n([s.property({type:String,value:null,dependsOn:["type"],json:{write:!0}})],t.prototype,"focus",null),n([s.property({type:Number,value:null,dependsOn:["type"],json:{write:!0}})],t.prototype,"numClasses",null),n([s.property({type:d,json:{type:d,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],t.prototype,"lengthUnit",void 0),n([s.property({type:[.25,.33,.5,1],value:null,dependsOn:["classificationMethod","type"],json:{type:[.25,.33,.5,1],write:!0}})],t.prototype,"standardDeviationInterval",null),n([s.property({type:String,value:null,json:{type:c.jsonValues,read:c.read,write:c.write}})],t.prototype,"type",null),n([s.property({type:[l],json:{write:!0}})],t.prototype,"visualVariables",void 0),i=n([s.subclass("esri.renderers.support.AuthoringInfo")],t)}(s.declared(i))}.apply(null,n))||(e.exports=i)},644:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(338),r(336),r(341),r(348),r(337),r(688)],void 0===(i=function(e,t,r,n,i,o,a,s){var l=o({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),u=o({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity"}),c={key:function(e){return"number"==typeof e?"number":"string"},typeMap:{number:Number,string:String},base:null},d=["high-to-low","above-and-below","centered-on","extremes"],p=["seconds","minutes","hours","days","months","years"];return function(e){function t(t){var r=e.call(this)||this;return r.endTime=null,r.field=null,r.maxSliderValue=null,r.minSliderValue=null,r.startTime=null,r.type=null,r.units=null,r}var i;return r(t,e),i=t,t.prototype.castEndTime=function(e){return"string"==typeof e||"number"==typeof e?e:null},t.prototype.castStartTime=function(e){return"string"==typeof e||"number"==typeof e?e:null},Object.defineProperty(t.prototype,"style",{get:function(){return"color"===this.type?this._get("style"):null},set:function(e){this._set("style",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"theme",{get:function(){return"color"===this.type?this._get("theme")||"high-to-low":null},set:function(e){this._set("theme",e)},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new i({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})},n([a.property({types:c,json:{write:!0}})],t.prototype,"endTime",void 0),n([s.cast("endTime")],t.prototype,"castEndTime",null),n([a.property({type:String,json:{write:!0}})],t.prototype,"field",void 0),n([a.property({type:Number,json:{write:!0}})],t.prototype,"maxSliderValue",void 0),n([a.property({type:Number,json:{write:!0}})],t.prototype,"minSliderValue",void 0),n([a.property({types:c,json:{write:!0}})],t.prototype,"startTime",void 0),n([s.cast("startTime")],t.prototype,"castStartTime",null),n([a.property({type:l.apiValues,value:null,dependsOn:["type"],json:{type:l.jsonValues,read:l.read,write:l.write}})],t.prototype,"style",null),n([a.property({type:d,value:null,dependsOn:["type"],json:{type:d,write:!0}})],t.prototype,"theme",null),n([a.property({type:u.apiValues,json:{type:u.jsonValues,read:u.read,write:u.write}})],t.prototype,"type",void 0),n([a.property({type:p,json:{type:p,write:!0}})],t.prototype,"units",void 0),i=n([a.subclass("esri.renderers.support.AuthoringInfoVisualVariable")],t)}(a.declared(i))}.apply(null,n))||(e.exports=i)},645:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(338),r(336),r(341),r(337),r(363),r(375)],void 0===(i=function(e,t,r,n,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0});var l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.description=null,t.label=null,t.minValue=null,t.maxValue=0,t.symbol=null,t}var i;return r(t,e),i=t,t.prototype.clone=function(){return new i({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:this.symbol?this.symbol.clone():null})},n([o.property({type:String,json:{write:!0}})],t.prototype,"description",void 0),n([o.property({type:String,json:{write:!0}})],t.prototype,"label",void 0),n([o.property({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],t.prototype,"minValue",void 0),n([o.property({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],t.prototype,"maxValue",void 0),n([o.property({types:s.rendererTypes,json:{origins:{"web-scene":{read:a.read,write:{target:{symbol:{types:s.rendererTypes3D}},writer:a.writeTarget}}},read:a.read,write:a.writeTarget}})],t.prototype,"symbol",void 0),i=n([o.subclass("esri.renderers.support.ClassBreakInfo")],t)}(o.declared(i));t.ClassBreakInfo=l,t.default=l}.apply(null,n))||(e.exports=i)},646:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(338),r(336),r(362),r(341),r(337)],void 0===(i=function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(t){var r=e.call(this)||this;return r.color=null,r.ratio=null,r}var o;return r(t,e),o=t,t.prototype.clone=function(){return new o({color:this.color,ratio:this.ratio})},n([a.property({type:i,json:{write:!0}})],t.prototype,"color",void 0),n([a.property({type:Number,json:{write:!0}})],t.prototype,"ratio",void 0),o=n([a.subclass("esri.renderers.support.HeatmapColorStop")],t)}(a.declared(o));t.HeatmapColorStop=s,t.default=s}.apply(null,n))||(e.exports=i)},647:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(338),r(336),r(341),r(337),r(363),r(375)],void 0===(i=function(e,t,r,n,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0});var l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.description=null,t.label=null,t.symbol=null,t.value=null,t}var i;return r(t,e),i=t,t.prototype.clone=function(){return new i({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})},n([o.property({type:String,json:{write:!0}})],t.prototype,"description",void 0),n([o.property({type:String,json:{write:!0}})],t.prototype,"label",void 0),n([o.property({types:s.rendererTypes,json:{origins:{"web-scene":{read:a.read,write:{target:{symbol:{types:s.rendererTypes3D}},writer:a.writeTarget}}},read:a.read,write:a.writeTarget}})],t.prototype,"symbol",void 0),n([o.property({type:String,json:{write:!0}})],t.prototype,"value",void 0),i=n([o.subclass("esri.renderers.support.UniqueValueInfo")],t)}(o.declared(i));t.UniqueValueInfo=l,t.default=l}.apply(null,n))||(e.exports=i)},648:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.isOfType=function(e,t){var r=e.constructor._meta;if(!r||!r.bases)return!1;var n=r.bases,i=Array.isArray(t);return n.some(function(e){var r=e.__accessorMetadata__;if(!r)return!1;var n=r.properties;if(!n||!n.type||!n.type.value)return!1;var o=n.type.value;return i?-1!==t.indexOf(o):o===t})}}.apply(null,n))||(e.exports=i)},649:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(338),r(336),r(387),r(345),r(365),r(337),r(743),r(626),r(639),r(650),r(444),r(394),r(418),r(447)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,c,d,p,f,h,m){return function(e){function t(t){var r=e.call(this,t)||this;return r.gdbVersion=null,r.source=null,r}return r(t,e),t.prototype.execute=function(e,t){return this.executeJSON(e,t).then(function(e){return f.fromJSON(e)})},t.prototype.executeJSON=function(e,t){return u.executeQuery(this.parsedUrl,this._normalizeQuery(e),o({},this.requestOptions,t)).then(function(e){return e.data})},t.prototype.executeForCount=function(e,t){return u.executeQueryForCount(this.parsedUrl,this._normalizeQuery(e),o({},this.requestOptions,t)).then(function(e){return e.data.count})},t.prototype.executeForExtent=function(e,t){return u.executeQueryForExtent(this.parsedUrl,this._normalizeQuery(e),o({},this.requestOptions,t)).then(function(e){return{count:e.data.count,extent:a.Extent.fromJSON(e.data.extent)}})},t.prototype.executeForIds=function(e,t){return u.executeQueryForIds(this.parsedUrl,this._normalizeQuery(e),o({},this.requestOptions,t)).then(function(e){return e.data.objectIds})},t.prototype.executeRelationshipQuery=function(e,t){return(this.gdbVersion||this.source)&&(e=e.clone().set({gdbVersion:this.gdbVersion||e.gdbVersion,source:this.source||e.source})),d.executeRelationshipQuery(this.parsedUrl,e,o({},this.requestOptions,t)).then(function(e){var t=e.data,r={};return Object.keys(t).forEach(function(e){return r[e]=f.fromJSON(t[e])}),r})},t.prototype.executeAttachmentQuery=function(e,t){var r=this,n=t&&t.query&&t.query.token;return c.executeAttachmentQuery(this.parsedUrl,e,o({},this.requestOptions,t)).then(function(e){return c.processAttachmentQueryResult(e.data.attachmentGroups,r.parsedUrl.path,n)})},t.prototype._normalizeQuery=function(e){return this.gdbVersion||this.source?e.clone().set({gdbVersion:this.gdbVersion||e.gdbVersion,source:this.source||e.source}):e},n([s.property()],t.prototype,"gdbVersion",void 0),n([s.property()],t.prototype,"source",void 0),n([i(0,s.cast(h))],t.prototype,"execute",null),n([i(0,s.cast(h))],t.prototype,"executeJSON",null),n([i(0,s.cast(h))],t.prototype,"executeForCount",null),n([i(0,s.cast(h))],t.prototype,"executeForExtent",null),n([i(0,s.cast(h))],t.prototype,"executeForIds",null),n([i(0,s.cast(m))],t.prototype,"executeRelationshipQuery",null),n([i(0,s.cast(p))],t.prototype,"executeAttachmentQuery",null),n([s.subclass("esri.tasks.QueryTask")],t)}(s.declared(l))}.apply(null,n))||(e.exports=i)},650:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(345),r(351),r(405)],void 0===(i=function(e,t,r,n,i){function o(e){var t=e.toJSON();return t.objectIds&&(t.objectIds=t.objectIds.join(",")),t.outFields&&(t.outFields=t.outFields.join(",")),t.outSpatialReference&&(t.outSR=t.outSR.wkid||JSON.stringify(t.outSR.toJSON()),delete t.outSpatialReference),t.source&&(t.layer=JSON.stringify({source:t.source}),delete t.source),t}Object.defineProperty(t,"__esModule",{value:!0}),t.toQueryStringParameters=o,t.executeRelationshipQuery=function(e,t,a){var s={query:i.mapParameters(r({},e.query,{f:"json"},o(t)))};return a&&(s=r({},a,s)),n(e.path+"/queryRelatedRecords",s).then(function(e){for(var t=e.data,r=t.geometryType,n=t.spatialReference,i={},o=0,a=t.relatedRecordGroups;o<a.length;o++){var s=a[o],l={fields:void 0,objectIdFieldName:void 0,geometryType:r,spatialReference:n,features:s.relatedRecords};if(null!=s.objectId)i[s.objectId]=l;else for(var u in s)s.hasOwnProperty(u)&&"relatedRecords"!==u&&(i[s[u]]=l)}return e.data=i,e})}}.apply(null,n))||(e.exports=i)},651:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(452),r(459)],void 0===(i=function(e,t,r,n){return function(){function e(t){this.supportsEdges=!1,this._parentStage=null,this._visible=!0,this._renderOccluded=!1,this._renderPriority=0,this.id=e._idGen.gen(t)}return Object.defineProperty(e.prototype,"parentStage",{get:function(){return this._parentStage},enumerable:!0,configurable:!0}),e.prototype.addParentStage=function(e){this._parentStage=e},e.prototype.removeParentStage=function(e){this._parentStage=null},Object.defineProperty(e.prototype,"visible",{get:function(){return this._visible},set:function(e){e!==this._visible&&(this._visible=e,this.notifyDirty("matChanged"))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderOccluded",{get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.notifyDirty("matChanged"))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderPriority",{get:function(){return this._renderPriority},set:function(e){e!==this._renderPriority&&(this._renderPriority=e,this.notifyDirty("matChanged"))},enumerable:!0,configurable:!0}),e.prototype.isVisible=function(){return this._visible},e.prototype.notifyDirty=function(e){this.parentStage&&this.parentStage.notifyDirty(n.MATERIAL,this,e)},e._idGen=new r,e}()}.apply(null,n))||(e.exports=i)},656:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(338),r(336),r(346),r(339),r(337),r(396),r(451)],void 0===(i=function(e,t,r,n,i,o,a,s,l){return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}var i;return r(t,e),i=t,t.fromWorker=function(e){if(!e)return null;var t=JSON.parse(e),r=new i;return r.fields=t.fields&&t.fields.map(function(e){return s.fromJSON(e)}),r.options=t.options,r.process=new(Function.bind.apply(Function,[void 0].concat(t.process.args,[t.process.body]))),r},Object.defineProperty(t.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new i(o.clone({fields:this.fields,options:this.options,process:this.process}))},t.prototype.getField=function(e){return l.getField(e,this.fields)},t.prototype.refresh=function(){this.notifyChange("version")},t.prototype.toWorker=function(){var e=this.process.toString();return JSON.stringify({fields:this.fields,options:this.options,process:{body:e.substring(e.indexOf("{")+1,e.lastIndexOf("}")),args:e.slice(e.indexOf("(")+1,e.indexOf(")")).match(/([^\s,]+)/g)}})},n([a.property({type:[s]})],t.prototype,"fields",void 0),n([a.property()],t.prototype,"options",void 0),n([a.property()],t.prototype,"process",void 0),n([a.property({readOnly:!0,dependsOn:["process","options","fields"]})],t.prototype,"version",null),i=n([a.subclass("esri.layers.support.FeatureProcessing")],t)}(a.declared(i))}.apply(null,n))||(e.exports=i)},657:function(e,t,r){var n;void 0===(n=function(){function e(e,t,r,n){for(var i=t,o=t,a=r>>>1,s=e[i-1];o<=a;){(o=i<<1)<r&&n(e[o-1],e[o])<0&&++o;var l=e[o-1];if(n(l,s)<=0)break;e[i-1]=l,i=o}e[i-1]=s}function t(e,t){return e<t?-1:e>t?1:0}return{sort:function(r,n,i,o){void 0===n&&(n=0),void 0===i&&(i=r.length),void 0===o&&(o=t);for(var a=i>>>1;a>n;a--)e(r,a,i,o);var s=n+1;for(a=i-1;a>n;a--){var l=r[n];r[n]=r[a],r[a]=l,e(r,s,a,o)}return r}}}.apply(null,[]))||(e.exports=n)},660:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(338),r(336),r(337),r(457)],void 0===(i=function(e,t,r,n,i,o){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="selection",t}return r(t,e),n([i.property()],t.prototype,"type",void 0),n([i.subclass("esri.layers.support.FeatureReductionSelection")],t)}(i.declared(o.default));t.FeatureReductionSelection=a,t.default=a}.apply(null,n))||(e.exports=i)},661:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(338),r(336),r(341),r(337),r(455)],void 0===(i=function(e,t,r,n,i,o,a){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.value=null,t.expression=null,t}var i;return r(t,e),i=t,t.prototype.readExpression=function(e,t){return t.value?a.convertTemplatedStringToArcade(t.value):e},t.prototype.writeExpression=function(e,t,r){null!=this.value&&(e=a.convertTemplatedStringToArcade(this.value)),t[r]=e},t.prototype.clone=function(){return new i({value:this.value,expression:this.expression})},n([o.property({json:{read:!1,write:!1}})],t.prototype,"value",void 0),n([o.property({json:{write:{allowNull:!0}}})],t.prototype,"expression",void 0),n([o.reader("expression",["expression","value"])],t.prototype,"readExpression",null),n([o.writer("expression")],t.prototype,"writeExpression",null),i=n([o.subclass("esri.layers.support.LabelExpressionInfo")],t)}(o.declared(i))}.apply(null,n))||(e.exports=i)},662:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(402)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.replace=function(e,t,n){return void 0===n&&(n=/\{([^\}]+)\}/g),e.replace(n,"function"==typeof t?t:function(e,n){return r.getDeepValue(n,t)})}}.apply(null,n))||(e.exports=i)},663:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(429)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=/\[([^\[\]]+)\]/gi;t.reader=function(e,t,i){var o=this;return e?e.map(function(e){var a=new r;if(a.read(e,i),a.labelExpression){var s=t.fields||t.layerDefinition&&t.layerDefinition.fields||o.fields;a.labelExpression=a.labelExpression.replace(n,function(e,t){return"["+function(e,t){if(!t)return e;for(var r=e.toLowerCase(),n=0;n<t.length;n++){var i=t[n].name;if(i.toLowerCase()===r)return i}return e}(t,s)+"]"})}return a}):null}}.apply(null,n))||(e.exports=i)},664:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(338),r(336),r(346),r(446),r(366),r(689),r(343),r(624),r(340),r(337)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,c,d){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handles=new a,t.layer=null,t.parent=null,t.view=null,t}return r(t,e),t.prototype.initialize=function(){var e=this;this.addResolvingPromise(this.layer),this.when().catch(function(t){if("layerview:create-error"!==t.name){var r=e.layer&&e.layer.id||"no id",n=e.layer&&e.layer.title||"no title";return l.getLogger(e.declaredClass).error("#resolve()","Failed to resolve layer view (layer title: '"+n+"', id: '"+r+"')",t),c.reject(t)}})},t.prototype.destroy=function(){this.layer=this.view=this.parent=null},Object.defineProperty(t.prototype,"suspended",{get:function(){return!this.canResume()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!this.suspended&&this.isUpdating()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visible",{get:function(){return!0===this.get("layer.visible")},set:function(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fullOpacity",{get:function(){var e=function(e){return null!=e?e:1};return e(this.get("layer.opacity"))*e(this.get("parent.fullOpacity"))},enumerable:!0,configurable:!0}),t.prototype.canResume=function(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.get("layer.loaded")&&this.visible||!1},t.prototype.isUpdating=function(){return!1},n([d.property()],t.prototype,"layer",void 0),n([d.property()],t.prototype,"parent",void 0),n([d.property({readOnly:!0,dependsOn:["view","visible","layer.loaded","parent.suspended"]})],t.prototype,"suspended",null),n([d.property({type:Boolean,dependsOn:["suspended"],readOnly:!0})],t.prototype,"updating",null),n([d.property()],t.prototype,"view",void 0),n([d.property({dependsOn:["layer.visible"]})],t.prototype,"visible",null),n([d.property({dependsOn:["layer.opacity","parent.fullOpacity"]})],t.prototype,"fullOpacity",null),n([d.subclass("esri.views.layers.LayerView")],t)}(d.declared(i,o,s,u))}.apply(null,n))||(e.exports=i)},665:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(618)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){this.layout=e,this.buffer="number"==typeof t?new ArrayBuffer(t*e.stride):t;for(var r=0,n=e.fieldNames;r<n.length;r++){var i=n[r],o=e.fields.get(i);this[i]=new o.constructor(this.buffer,o.offset,this.stride)}}return Object.defineProperty(e.prototype,"stride",{get:function(){return this.layout.stride},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"count",{get:function(){return this.buffer.byteLength/this.stride},enumerable:!0,configurable:!0}),e.prototype.getField=function(e,t){var r=this[e];return r&&r.elementCount===t.ElementCount&&r.elementType===t.ElementType?r:null},e.prototype.slice=function(t,r){return new e(this.layout,this.buffer.slice(t*this.stride,r*this.stride))},e}(),i=function(){function e(){this.stride=0,this.fields=new Map,this.fieldNames=[]}return e.prototype.vec2f=function(e,t){return this.fields.set(e,{size:8,constructor:r.BufferViewVec2f,offset:this.stride,optional:t}),this.stride+=8,this.fieldNames.push(e),this},e.prototype.vec2f64=function(e,t){return this.fields.set(e,{size:16,constructor:r.BufferViewVec2f64,offset:this.stride,optional:t}),this.stride+=16,this.fieldNames.push(e),this},e.prototype.vec3f=function(e,t){return this.fields.set(e,{size:12,constructor:r.BufferViewVec3f,offset:this.stride,optional:t}),this.stride+=12,this.fieldNames.push(e),this},e.prototype.vec3f64=function(e,t){return this.fields.set(e,{size:24,constructor:r.BufferViewVec3f64,offset:this.stride,optional:t}),this.stride+=24,this.fieldNames.push(e),this},e.prototype.vec4f=function(e,t){return this.fields.set(e,{size:16,constructor:r.BufferViewVec4f,offset:this.stride,optional:t}),this.stride+=16,this.fieldNames.push(e),this},e.prototype.vec4f64=function(e,t){return this.fields.set(e,{size:32,constructor:r.BufferViewVec4f64,offset:this.stride,optional:t}),this.stride+=32,this.fieldNames.push(e),this},e.prototype.mat3f=function(e,t){return this.fields.set(e,{size:36,constructor:r.BufferViewMat3f,offset:this.stride,optional:t}),this.stride+=36,this.fieldNames.push(e),this},e.prototype.mat4f=function(e,t){return this.fields.set(e,{size:64,constructor:r.BufferViewMat4f,offset:this.stride,optional:t}),this.stride+=64,this.fieldNames.push(e),this},e.prototype.vec4u8=function(e,t){return this.fields.set(e,{offset:this.stride,size:4,optional:t,constructor:r.BufferViewVec4u8}),this.stride+=4,this.fieldNames.push(e),this},e.prototype.f32=function(e,t){return this.fields.set(e,{offset:this.stride,size:4,optional:t,constructor:r.BufferViewFloat}),this.stride+=4,this.fieldNames.push(e),this},e.prototype.f64=function(e,t){return this.fields.set(e,{offset:this.stride,size:8,optional:t,constructor:r.BufferViewFloat64}),this.stride+=8,this.fieldNames.push(e),this},e.prototype.u8=function(e,t){return this.fields.set(e,{offset:this.stride,size:1,optional:t,constructor:r.BufferViewUint8}),this.stride+=1,this.fieldNames.push(e),this},e.prototype.u16=function(e,t){return this.fields.set(e,{offset:this.stride,size:2,optional:t,constructor:r.BufferViewUint16}),this.stride+=2,this.fieldNames.push(e),this},e.prototype.i8=function(e,t){return this.fields.set(e,{offset:this.stride,size:1,optional:t,constructor:r.BufferViewInt8}),this.stride+=1,this.fieldNames.push(e),this},e.prototype.vec2i8=function(e,t){return this.fields.set(e,{offset:this.stride,size:2,optional:t,constructor:r.BufferViewVec2i8}),this.stride+=2,this.fieldNames.push(e),this},e.prototype.vec2i16=function(e,t){return this.fields.set(e,{offset:this.stride,size:4,optional:t,constructor:r.BufferViewVec2i16}),this.stride+=4,this.fieldNames.push(e),this},e.prototype.vec2u8=function(e,t){return this.fields.set(e,{offset:this.stride,size:2,optional:t,constructor:r.BufferViewVec2u8}),this.stride+=2,this.fieldNames.push(e),this},e.prototype.vec4u16=function(e,t){return this.fields.set(e,{offset:this.stride,size:8,optional:t,constructor:r.BufferViewVec4u16}),this.stride+=8,this.fieldNames.push(e),this},e.prototype.u32=function(e,t){return this.fields.set(e,{offset:this.stride,size:4,optional:t,constructor:r.BufferViewUint32}),this.stride+=4,this.fieldNames.push(e),this},e.prototype.hasField=function(e){return this.fieldNames.indexOf(e)>=0},e.prototype.createBuffer=function(e){return new n(this,e)},e.prototype.createView=function(e){return new n(this,e)},e.prototype.clone=function(){var t=new e;return t.stride=this.stride,t.fields=new Map,this.fields.forEach(function(e,r){return t.fields.set(r,e)}),t.fieldNames=this.fieldNames.slice(),t.BufferType=this.BufferType,t},e}();t.InterleavedLayout=i,t.newLayout=function(){return new i}}.apply(null,n))||(e.exports=i)},668:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(338),r(336),r(365),r(384),r(346),r(358),r(342),r(354),r(348),r(467),r(343),r(454),r(443),r(337),r(359),r(678),r(394),r.dj.m(e)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,c,d,p,f,h,m,v,g,y,b){function _(e){var t=e.geometry,r=e.attributes;return{geometry:t&&"mesh"!==t.type?t&&t.toJSON():null,attributes:r}}Object.defineProperty(t,"__esModule",{value:!0});var x=c({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),w=p.getLogger("esri.layers.graphics.sources.MemorySource"),S=function(t){function a(){return null!==t&&t.apply(this,arguments)||this}return r(a,t),a.prototype.load=function(){var t=this;return this.addResolvingPromise(h.open(f.getAbsMid("./support/MemorySourceWorker",e,b),{client:this,strategy:u("esri-workers-for-memory-layers")?"dedicated":"local"}).then(function(e){t._connection=e;var r=t.layer,n=r.fields,i=r.spatialReference,o=r.geometryType,a=r.objectIdField,s=r.hasM,l=r.hasZ;return e.invoke("load",{features:t.items.map(_),fields:n&&n.map(function(e){return e.toJSON()}),geometryType:x.toJSON(o),hasM:s,hasZ:l,objectIdField:a,spatialReference:i&&i.toJSON()}).then(function(e){e.featureErrors.length&&w.warn("Encountered "+e.featureErrors.length+" validation errors while loading features",e.featureErrors),t.layerDefinition=e.layerDefinition})})),this.when()},a.prototype.applyEdits=function(e){var t=this;return this.load().then(function(){return t._applyEdits(e)})},a.prototype.openPorts=function(){var e=this;return this.load().then(function(){return e._connection.openPorts()})},a.prototype.queryFeatures=function(e){return this.queryFeaturesJSON(e).then(function(e){return y.fromJSON(e)})},a.prototype.queryFeaturesJSON=function(e){var t=this;return this.load().then(function(){return t._connection.invoke("queryFeatures",e?e.toJSON():null)})},a.prototype.queryFeatureCount=function(e){var t=this;return this.load().then(function(){return t._connection.invoke("queryFeatureCount",e?e.toJSON():null)})},a.prototype.queryObjectIds=function(e){var t=this;return this.load().then(function(){return t._connection.invoke("queryObjectIds",e?e.toJSON():null)})},a.prototype.queryExtent=function(e){var t=this;return this.load().then(function(){return t._connection.invoke("queryExtent",e?e.toJSON():null)}).then(function(e){return{count:e.count,extent:i.Extent.fromJSON(e.extent)}})},a.prototype._applyEdits=function(e){var t=this;if(!this._connection)throw new l("feature-layer-source:edit-failure","Memory source not loaded");var r=this.layer.objectIdField,n=[],i=[],o=[];if(e.addFeatures)for(var a=0,s=e.addFeatures;a<s.length;a++){var u=s[a];n.push(_(u))}if(e.deleteFeatures)for(var c=0,d=e.deleteFeatures;c<d.length;c++){var p=d[c];"objectId"in p&&null!=p.objectId?i.push(p.objectId):"attributes"in p&&null!=p.attributes[r]&&i.push(p.attributes[r])}if(e.updateFeatures)for(var f=0,h=e.updateFeatures;f<h.length;f++){u=h[f];o.push(_(u))}return this._connection.invoke("applyEdits",{adds:n,updates:o,deletes:i}).then(function(e){var r=e.fullExtent,n=e.featureEditResults;return t.fullExtent=r,t._createEditsResult(n)})},a.prototype._createEditsResult=function(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[]}},a.prototype._createFeatureEditResult=function(e){var t=!0===e.success?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:t?new l("feature-layer-source:edit-failure",t.description,{code:t.code}):null}},n([g.shared({Type:o,ensureType:v.ensureType(o)})],a.prototype,"itemType",void 0),n([m.property({constructOnly:!0})],a.prototype,"layer",void 0),n([m.property()],a.prototype,"layerDefinition",void 0),n([m.subclass("esri.layers.graphics.sources.MemorySource")],a)}(m.declared(a,s,d));t.MemorySource=S,t.default=S}.apply(null,n))||(e.exports=i)},672:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(618),r(349)],void 0===(i=function(e,t,r,n){function i(e,t,r,n,i){var o=r.typedBuffer,a=r.typedBufferStride,s=e.length;if(n*=a,null==i||1===i)for(var l=0;l<s;++l){var u=2*e[l];o[n]=t[u],o[n+1]=t[u+1],n+=a}else for(l=0;l<s;++l){u=2*e[l];for(var c=0;c<i;++c)o[n]=t[u],o[n+1]=t[u+1],n+=a}}function o(e,t,r,n,i){var o=r.typedBuffer,a=r.typedBufferStride,s=e.length;if(n*=a,null==i||1===i)for(var l=0;l<s;++l){var u=3*e[l];o[n]=t[u],o[n+1]=t[u+1],o[n+2]=t[u+2],n+=a}else for(l=0;l<s;++l){u=3*e[l];for(var c=0;c<i;++c)o[n]=t[u],o[n+1]=t[u+1],o[n+2]=t[u+2],n+=a}}function a(e,t,r,n,i){var o=r.typedBuffer,a=r.typedBufferStride,s=e.length;if(n*=a,null==i||1===i)for(var l=0;l<s;++l){var u=4*e[l];o[n]=t[u],o[n+1]=t[u+1],o[n+2]=t[u+2],o[n+3]=t[u+3],n+=a}else for(l=0;l<s;++l){u=4*e[l];for(var c=0;c<i;++c)o[n]=t[u],o[n+1]=t[u+1],o[n+2]=t[u+2],o[n+3]=t[u+3],n+=a}}function s(e,t,r,n,i,a){if(r){var s=r,l=n.typedBuffer,u=n.typedBufferStride,c=e.length;if(i*=u,null==a||1===a)for(var d=0;d<c;++d){var p=t[m=3*e[d]],f=t[m+1],h=t[m+2];l[i]=s[0]*p+s[4]*f+s[8]*h+s[12],l[i+1]=s[1]*p+s[5]*f+s[9]*h+s[13],l[i+2]=s[2]*p+s[6]*f+s[10]*h+s[14],i+=u}else for(d=0;d<c;++d){p=t[m=3*e[d]],f=t[m+1],h=t[m+2];for(var m,v=s[0]*p+s[4]*f+s[8]*h+s[12],g=s[1]*p+s[5]*f+s[9]*h+s[13],y=s[2]*p+s[6]*f+s[10]*h+s[14],b=0;b<a;++b)l[i]=v,l[i+1]=g,l[i+2]=y,i+=u}}else o(e,t,n,i,a)}function l(e,t,r,n,i,a){if(r){var s=r,l=n.typedBuffer,u=n.typedBufferStride,c=e.length;if(i*=u,null==a||1===a)for(var d=0;d<c;++d){var p=t[m=3*e[d]],f=t[m+1],h=t[m+2];l[i]=s[0]*p+s[4]*f+s[8]*h,l[i+1]=s[1]*p+s[5]*f+s[9]*h,l[i+2]=s[2]*p+s[6]*f+s[10]*h,i+=u}else for(d=0;d<c;++d){p=t[m=3*e[d]],f=t[m+1],h=t[m+2];for(var m,v=s[0]*p+s[4]*f+s[8]*h,g=s[1]*p+s[5]*f+s[9]*h,y=s[2]*p+s[6]*f+s[10]*h,b=0;b<a;++b)l[i]=v,l[i+1]=g,l[i+2]=y,i+=u}}else o(e,t,n,i,a)}function u(e,t,r,n,i,o){var a=n.typedBuffer,s=n.typedBufferStride,l=e.length;if(i*=s,null==o||1===o){if(4===r)for(var u=0;u<l;++u){var c=4*e[u];a[i]=t[c],a[i+1]=t[c+1],a[i+2]=t[c+2],a[i+3]=t[c+3],i+=s}else if(3===r)for(u=0;u<l;++u){c=3*e[u];a[i]=t[c],a[i+1]=t[c+1],a[i+2]=t[c+2],a[i+3]=255,i+=s}}else if(4===r)for(u=0;u<l;++u){c=4*e[u];for(var d=0;d<o;++d)a[i]=t[c],a[i+1]=t[c+1],a[i+2]=t[c+2],a[i+3]=t[c+3],i+=s}else if(3===r)for(u=0;u<l;++u)for(c=3*e[u],d=0;d<o;++d)a[i]=t[c],a[i+1]=t[c+1],a[i+2]=t[c+2],a[i+3]=255,i+=s}function c(e,t,r,n,i,o,a){var s=i.typedBuffer,l=i.typedBufferStride,u=e.length;if(o*=l,null==a||1===a){if(4===r)for(var c=0;c<u;++c){var d=4*e[c];s[o]=t[d]*n[0],s[o+1]=t[d+1]*n[1],s[o+2]=t[d+2]*n[2],s[o+3]=t[d+3]*n[3],o+=l}else if(3===r){var p=255*n[3];for(c=0;c<u;++c){d=3*e[c];s[o]=t[d]*n[0],s[o+1]=t[d+1]*n[1],s[o+2]=t[d+2]*n[2],s[o+3]=p,o+=l}}}else if(4===r)for(c=0;c<u;++c){d=4*e[c];for(var f=0;f<a;++f)s[o]=t[d]*n[0],s[o+1]=t[d+1]*n[1],s[o+2]=t[d+2]*n[2],s[o+3]=t[d+3]*n[3],o+=l}else if(3===r)for(p=255*n[3],c=0;c<u;++c)for(d=3*e[c],f=0;f<a;++f)s[o]=t[d]*n[0],s[o+1]=t[d+1]*n[1],s[o+2]=t[d+2]*n[2],s[o+3]=p,o+=l}Object.defineProperty(t,"__esModule",{value:!0}),t.writeBufferVec2=i,t.writeBufferVec3=o,t.writeBufferVec4=a,t.writePosition=s,t.writeNormal=l,t.writeColor=u,t.writeMultipliedColor=c,t.writeDefaultAttributes=function(e,t,o,d,p,f,h){for(var m=0,v=o.fieldNames;m<v.length;m++){var g=v[m],y=e.vertexAttr[g],b=e.indices[g];if(y&&b)switch(g){case n.VertexAttrConstants.POSITION:n.assert(3===y.size);var _=f.getField(g,r.BufferViewVec3f);_&&s(b,y.data,d,_,h);break;case n.VertexAttrConstants.NORMAL:n.assert(3===y.size);var x=f.getField(g,r.BufferViewVec3f);x&&l(b,y.data,p,x,h);break;case n.VertexAttrConstants.UV0:n.assert(2===y.size);var w=f.getField(g,r.BufferViewVec2f);w&&i(b,y.data,w,h);break;case n.VertexAttrConstants.REGION:n.assert(4===y.size);var S=f.getField(g,r.BufferViewVec4u16);S&&a(b,y.data,S,h);break;case n.VertexAttrConstants.COLOR:n.assert(3===y.size||4===y.size);var T=f.getField(g,r.BufferViewVec4u8);T&&(t&&t.color?c(b,y.data,y.size,t.color,T,h):u(b,y.data,y.size,T,h));break;case n.VertexAttrConstants.SYMBOLCOLOR:n.assert(3===y.size||4===y.size);var E=f.getField(g,r.BufferViewVec4u8);E&&u(b,y.data,y.size,E,h)}}}}.apply(null,n))||(e.exports=i)},678:function(e,t,r){var n,i;n=[r(353),r(679),r(341),r(339)],void 0===(i=function(e,t,r,n){return{subclass:function(i,o){return function(o){var a=t.declareDefinition(o,i);s&&(a.instanceMembers.properties=function e(t,r){if(!t)return r;if(!r)return t;for(var n in r){var i=t[n],o=r[n];Array.isArray(o)&&Array.isArray(i)?t[n]=i.concat(o):t[n]="object"==typeof o&&"object"==typeof i?e(i,o):o}return t}(s,a.instanceMembers.properties));var s=a.instanceMembers.properties;if(s)for(var l in s){var u=s[l];u&&!u.reader&&u.type&&(u.type===Date?u.reader=function(e){return null!=e?new Date(e):null}:-1!==u.type._meta.bases.indexOf(r)&&(u.reader=function(e){return function(t){return e.fromJSON(t)}}(u.type)))}return n.mixin(e(a.bases,a.instanceMembers),a.classMembers)}},shared:t.shared,property:function(e){return function(t,r){var n=Object.getPrototypeOf(t),i=n&&n.properties;t.properties&&t.properties!==i||(t.properties={}),t.properties=t.properties||{},t.properties[r]=e||{}}}}}.apply(null,n))||(e.exports=i)},679:function(e,t,r){var n,i;n=[r(353),r(339)],void 0===(i=function(e,t){var r={declareDefinition:function(e,t){var r,n=[],i=Object.getPrototypeOf(e.prototype);if(i!==Object.prototype){var o=i.constructor;r=o.prototype,n.push(o)}t&&(n=n.concat(t));for(var a={},s=Object.getOwnPropertyNames(e.prototype),l=0;l<s.length;l++){var u=s[l];if("constructor"!==u){var c=u;"dojoConstructor"===u&&(c="constructor"),r&&e.prototype[u]===r[u]||(a[c]=e.prototype[u])}}s=Object.getOwnPropertyNames(e);var d=Object.getOwnPropertyNames(i.constructor),p={};for(l=0;l<s.length;l++)u=s[l],-1===d.indexOf(u)&&(p[u]=e[u]);return{bases:n,instanceMembers:a,classMembers:p}},subclass:function(n){return function(i){var o=r.declareDefinition(i,n);return t.mixin(e(o.bases,o.instanceMembers),o.classMembers)}},shared:function(e){return function(t,r){t[r]=e}}};return r}.apply(null,n))||(e.exports=i)},680:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(338),r(336),r(341),r(337)],void 0===(i=function(e,t,r,n,i,o){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(t){return e.call(this,t)||this}var i;return r(t,e),i=t,t.prototype.clone=function(){var e=this,t=e.name,r=e.fields,n=e.isAscending,o=e.isUnique,a=e.description;return new i({name:t,fields:r,isAscending:n,isUnique:o,description:a})},n([o.property({constructOnly:!0})],t.prototype,"name",void 0),n([o.property({constructOnly:!0})],t.prototype,"fields",void 0),n([o.property({constructOnly:!0})],t.prototype,"isAscending",void 0),n([o.property({constructOnly:!0})],t.prototype,"isUnique",void 0),n([o.property({constructOnly:!0})],t.prototype,"description",void 0),i=n([o.subclass("esri.layers.support.FeatureIndex")],t)}(o.declared(i));t.FeatureIndex=a,t.default=a}.apply(null,n))||(e.exports=i)},681:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(338),r(336),r(341),r(339),r(337),r(403),r(466)],void 0===(i=function(e,t,r,n,i,o,a,s,l){return function(e){function t(t){var r=e.call(this,t)||this;return r.id=null,r.name=null,r.domains=null,r.templates=null,r}return r(t,e),t.prototype.readDomains=function(e){var t={};for(var r in e)if(e.hasOwnProperty(r)){var n=e[r];switch(n.type){case"range":t[r]=s.RangeDomain.fromJSON(n);break;case"codedValue":t[r]=s.CodedValueDomain.fromJSON(n);break;case"inherited":t[r]=s.InheritedDomain.fromJSON(n)}}return t},t.prototype.writeDomains=function(e,t){var r={};for(var n in e)e.hasOwnProperty(n)&&(r[n]=e[n]&&e[n].toJSON());o.fixJson(r),t.domains=r},t.prototype.readTemplates=function(e){return e&&e.map(function(e){return new l(e)})},t.prototype.writeTemplates=function(e,t){t.templates=e&&e.map(function(e){return e.toJSON()})},n([a.property({json:{write:!0}})],t.prototype,"id",void 0),n([a.property({json:{write:!0}})],t.prototype,"name",void 0),n([a.property({json:{write:!0}})],t.prototype,"domains",void 0),n([a.reader("domains")],t.prototype,"readDomains",null),n([a.writer("domains")],t.prototype,"writeDomains",null),n([a.property({json:{write:!0}})],t.prototype,"templates",void 0),n([a.reader("templates")],t.prototype,"readTemplates",null),n([a.writer("templates")],t.prototype,"writeTemplates",null),n([a.subclass("esri.layers.support.FeatureType")],t)}(a.declared(i))}.apply(null,n))||(e.exports=i)},682:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(338),r(336),r(341),r(348),r(337)],void 0===(i=function(e,t,r,n,i,o,a){var s=o({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"});return function(e){function t(t){var r=e.call(this,t)||this;return r.cardinality=null,r.id=null,r.keyField=null,r.name=null,r.relatedTableId=null,r}return r(t,e),n([a.property({json:{read:s.read,write:s.write}})],t.prototype,"cardinality",void 0),n([a.property({json:{read:!0,write:!0}})],t.prototype,"id",void 0),n([a.property({json:{read:!0,write:!0}})],t.prototype,"keyField",void 0),n([a.property({json:{read:!0,write:!0}})],t.prototype,"name",void 0),n([a.property({json:{read:!0,write:!0}})],t.prototype,"relatedTableId",void 0),n([a.subclass("esri.layers.support.Relationship")],t)}(a.declared(i))}.apply(null,n))||(e.exports=i)},684:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(e,t){return{near:e,far:t}}function n(e,t,r){return e.near=t,e.far=r,e}Object.defineProperty(t,"__esModule",{value:!0}),t.create=r,t.empty=function(e){return e?n(e,1/0,-1/0):r(1/0,-1/0)},t.set=n,t.union=function(e,t,r){return void 0===r&&(r=e),r.near=Math.min(e.near,t.near),r.far=Math.max(e.far,t.far),r}}.apply(null,n))||(e.exports=i)},686:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(404),r(398),r(1044),r(631),r(1507),r(965),r(1008),r(1508)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u){return function(){function e(){this.regularWriter=new l.RegularEdgeBufferWriter,this.silhouetteWriter=new l.SilhouetteEdgeBufferWriter}return e.prototype.process=function(e,t){return r(this,void 0,void 0,function(){var r,i,o;return n(this,function(n){switch(n.label){case 0:return t?(r=new Array,i=this.packInput(e,r),this.wrappedWork,[4,t.invoke("wrappedWork",i,r)]):[3,2];case 1:return o=n.sent(),[2,this.unpackOutput(o)];case 2:return[2,this.work(e)]}})})},e.prototype.wrappedWork=function(e){return r(this,void 0,void 0,function(){var t,r,i;return n(this,function(n){return t=this.unpackInput(e),r=this.work(t),i=new Array,this.packInputTransferables(t,i),[2,{result:this.packOutput(r,i),transferList:i}]})})},e.prototype.work=function(e){var t=this.extractEdgeInformation(e.data,e.skipDeduplicate,e.originalIndices);return this.regularWriter.updateSettings(e.writerSettings),this.silhouetteWriter.updateSettings(e.writerSettings),u.extractEdges(t,this.regularWriter,this.silhouetteWriter)},e.prototype.packInputTransferables=function(e,t){t.push(e.data.buffer)},e.prototype.packInput=function(e,t){this.packInputTransferables(e,t);var r={dataBuffer:e.data.buffer,writerSettings:e.writerSettings,skipDeduplicate:e.skipDeduplicate};return e.originalIndices&&(r.originalIndicesBuffer=e.originalIndices.buffer,r.originalIndicesType=o.isUint32Array(e.originalIndices)?"Uint32Array":"Uint16Array"),r},e.prototype.unpackInput=function(e){return{data:s.EdgeInputBufferLayout.createView(e.dataBuffer),originalIndices:"Uint32Array"===e.originalIndicesType?new Uint32Array(e.originalIndicesBuffer):"Uint16Array"===e.originalIndicesType?new Uint16Array(e.originalIndicesBuffer):void 0,writerSettings:e.writerSettings,skipDeduplicate:e.skipDeduplicate}},e.prototype.packOutput=function(e,t){return t.push(e.regular.lodInfo.lengths.buffer),t.push(e.silhouette.lodInfo.lengths.buffer),{regular:{instancesData:a.packInterleavedBuffer(e.regular.instancesData,t),lodInfo:{lengths:e.regular.lodInfo.lengths.buffer}},silhouette:{instancesData:a.packInterleavedBuffer(e.silhouette.instancesData,t),lodInfo:{lengths:e.silhouette.lodInfo.lengths.buffer}},averageEdgeLength:e.averageEdgeLength}},e.prototype.unpackOutput=function(e){return{regular:{instancesData:a.unpackInterleavedBuffer(e.regular.instancesData),lodInfo:{lengths:new Float32Array(e.regular.lodInfo.lengths)}},silhouette:{instancesData:a.unpackInterleavedBuffer(e.silhouette.instancesData),lodInfo:{lengths:new Float32Array(e.silhouette.lodInfo.lengths)}},averageEdgeLength:e.averageEdgeLength}},e.prototype.extractEdgeInformation=function(e,t,r){if(t&&r)return{faces:r,neighbors:i.computeNeighbors(r,e.count),vertices:e};var n=i.deduplicate(e.buffer,e.stride/4),o=this.selectIndexData(n.indices,r);return{faces:o,neighbors:i.computeNeighbors(o,n.uniqueCount),vertices:s.EdgeInputBufferLayout.createView(n.buffer)}},e.prototype.selectIndexData=function(e,t){if(t){for(var r=o.slice(t),n=0;n<r.length;n++)r[n]=e[r[n]];return r}return e},e}()}.apply(null,n))||(e.exports=i)},695:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=!!Map.prototype.entries;t.everyMap=r?function(e,t){for(var r=e.entries();;){var n=r.next();if(n.done)break;if(!1===t(n.value[1],n.value[0]))return!1}return!0}:function(e,t){var r=!0;return e.forEach(function(e,n){r&&(r=!1!==t(e,n))}),r}}.apply(null,n))||(e.exports=i)},699:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(344),r(430),r(1043),r(734),r(452),r(459),r(349)],void 0===(i=function(e,t,r,n,i,o,a,s,l){var u=l.assert,c=r.mat4d.identity(),d=function(){function e(t){void 0===t&&(t={}),this._bvObjectSpace=new p,this._bvWorldSpace=new p,this._bvDirty=!0,this._hasVolatileTransformation=!1,this._allComponentsHiddenDirty=!0,this.id=e._idGen.gen(t.idHint),this.name=t.name,this.castShadow=null==t.castShadow||t.castShadow,this.metadata=t.metadata,this.objectTransformation=r.mat4d.identity(),this._initializeGeometryRecords(t.geometries,t.materials,t.transformations,t.origins)}return e.prototype._initializeGeometryRecords=function(e,t,n,o){if(!Array.isArray(e))return this.geometryRecords=[],void(this.geometries=[]);u(t.length===e.length,"Object3D: materials don't match geometries"),u(n.length===e.length,"Object3D: transformations don't match geometries"),this.geometryRecords=new Array(e.length),this.geometries=e.slice();for(var a=0;a<e.length;a++){u(Array.isArray(t[a]),"Object3D: materials parameter must be array of array");this.geometryRecords[a]=new i(e[a],t[a].slice(),r.mat4d.create(n[a]),{},o&&o[a])}this._hasVolatileTransformation=!1},Object.defineProperty(e.prototype,"parentLayer",{get:function(){return this._parentLayer},set:function(e){u(null==this._parentLayer||null==e,"Object3D can only be added to a single Layer"),this._parentLayer=e},enumerable:!0,configurable:!0}),e.prototype.getParentLayer=function(){return this.parentLayer},e.prototype.addParentLayer=function(e){this.parentLayer=e},e.prototype.removeParentLayer=function(e){this.parentLayer=null},e.prototype.getNumGeometryRecords=function(){return this.geometryRecords.length},e.prototype.getFirstGeometryIndex=function(e){var t=this.geometries.indexOf(e);return u(t>-1,"Object3D.getFirstGeometryIndex: geometry not found"),t},e.prototype.findGeometryRecords=function(e){for(var t=[],r=0;r<this.geometries.length;r++)this.geometries[r]===e&&t.push(this.geometryRecords[r]);return t},e.prototype.getGeometryRecord=function(e){return u(e>=0&&e<this.geometryRecords.length,"Object3d.getGeometryDataByIndex: index out of range"),this.geometryRecords[e]},e.prototype.getGeometryRecords=function(){return this.geometryRecords},e.prototype.addGeometry=function(e,t,n,o,a,s){void 0===n&&(n=c),u(Array.isArray(t),"Object3D.addGeometry: materials must be array"),this.geometries.push(e);var l=new i(e,t.slice(),r.mat4d.create(n),o||{},a,s);return this.geometryRecords.push(l),this._hasVolatileTransformation=this.geometryRecords.some(function(e){return!!e.customTransformation}),this._notifyDirty("objGeometryAdded",l),this._invalidateBoundingVolume(),this._allComponentsHiddenDirty=!0,l},e.prototype.hasGeometry=function(e){return this.geometries.indexOf(e)>-1},e.prototype.removeGeometry=function(e){var t=this.geometryRecords.splice(e,1)[0];return this._hasVolatileTransformation=this.geometryRecords.some(function(e){return!!e.customTransformation}),this.geometries.splice(e,1),this._notifyDirty("objGeometryRemoved",t),this._invalidateBoundingVolume(),this._allComponentsHiddenDirty=!0,t},e.prototype.removeAllGeometries=function(){for(;this.getNumGeometryRecords()>0;)this.removeGeometry(0)},e.prototype.geometryVertexAttrsUpdated=function(e){this._notifyDirty("vertexAttrsUpdated",this.geometryRecords[e]),this._invalidateBoundingVolume()},e.prototype.areAllComponentsHidden=function(){if(this._allComponentsHiddenDirty){this._allComponentsHiddenDirty=!1,this._allComponentsHidden=!0;for(var e=0,t=this.geometryRecords;e<t.length;e++){var r=t[e],i=r.instanceParameters.componentVisibilities,o=r.geometry.data.componentOffsets;if(!n.isAllHidden(i,o)){this._allComponentsHidden=!1;break}}}return this._allComponentsHidden},e.prototype.areAllComponentsVisible=function(){for(var e=0,t=this.geometryRecords;e<t.length;e++){var r=t[e],i=r.instanceParameters.componentVisibilities,o=r.geometry.data.componentOffsets;if(!n.isAllVisible(i,o))return!1}return!0},e.prototype.hasComponents=function(){for(var e=!1,t=0;t<this.geometries.length;t++){var r=this.geometries[t];if(e=n.hasComponents(r.data.componentOffsets))break}return e},e.prototype.setComponentVisibility=function(e,t,r){var i=e.geometry,o=e.instanceParameters.componentVisibilities,a=i.data.componentOffsets,s=n.updateVisibility(o,a,t,r);e.instanceParameters.componentVisibilities=s,this._notifyDirty("visibilityChanged",e),this._allComponentsHiddenDirty=!0},e.prototype.setHidden=function(e,t){e.instanceParameters.hidden=!!t,this._notifyDirty("visibilityChanged",e)},e.prototype.isHidden=function(e){return!!e.instanceParameters.hidden},e.prototype.getComponentVisibility=function(e,t){var r=e.instanceParameters.componentVisibilities;return n.getVisibility(r,t)},e.prototype.hideAllComponents=function(){for(var e=0,t=this.geometryRecords;e<t.length;e++){var r=t[e],i=r.instanceParameters.componentVisibilities,o=n.hideAllComponents(i);r.instanceParameters.componentVisibilities=o}this._notifyDirty("visibilityChanged"),this._allComponentsHiddenDirty=!0},e.prototype.unhideAllComponents=function(){for(var e=0,t=this.geometryRecords;e<t.length;e++){var r=t[e],i=r.instanceParameters.componentVisibilities,o=n.unhideAllComponents(i);r.instanceParameters.componentVisibilities=o}this._notifyDirty("visibilityChanged"),this._allComponentsHiddenDirty=!0},e.prototype._setComponentHighlight=function(e,t,r,i){var o=e.instanceParameters.componentHighlights,a=n.addHighlight(o,t,r,i);e.instanceParameters.componentHighlights=a},e.prototype.setComponentHighlight=function(e,t,r){var n=o.generateHighlightId();return this._setComponentHighlight(e,t,r,n),this._notifyDirty("componentHighlightChanged"),n},e.prototype.highlightAllComponents=function(e){for(var t=o.generateHighlightId(),r=0,n=this.geometryRecords;r<n.length;r++){var i=n[r];this._setComponentHighlight(i,null,e,t)}return this._notifyDirty("componentHighlightChanged"),t},e.prototype.removeHighlights=function(e){for(var t=0,r=this.geometryRecords;t<r.length;t++){var i=r[t].instanceParameters,o=i.componentHighlights,a=n.removeHighlight(o,e);i.componentHighlights=a}this._notifyDirty("componentHighlightChanged")},e.prototype.getComponentFromTriangleNr=function(e,t){u(e>=0&&e<this.geometryRecords.length,"Object3d.getComponentFromTriangleNr: index out of range");var r=this.geometryRecords[e].geometry.data.componentOffsets;return n.componentFind(r,3*t)},e.prototype.setGeometryTransformation=function(e,t){u(e>=0&&e<this.geometryRecords.length,"Object3d.setGeometryTransformation: index out of range");var n=this.geometryRecords[e],o=new i(n.geometry,n.materials,r.mat4d.create(t),n.instanceParameters);this.geometryRecords[e]=o,this._notifyDirty("objGeometryReplaced",[n,o]),this._invalidateBoundingVolume()},e.prototype.getObjectTransformation=function(){return r.mat4d.create(this.objectTransformation)},e.prototype.setObjectTransformation=function(e){r.mat4d.set(e,this.objectTransformation),this._invalidateBoundingVolume(),this._notifyDirty("objTransformation")},e.prototype.getCombinedStaticTransformation=function(e,t){return t=t||r.mat4d.create(),r.mat4d.multiply(this.objectTransformation,e.getStaticTransformation(),t),t},e.prototype.getCombinedShaderTransformation=function(e,t){return t=t||r.mat4d.create(),r.mat4d.multiply(this.objectTransformation,e.getShaderTransformation(),t),t},e.prototype.hasVolativeTransformation=function(){return this._hasVolatileTransformation},e.prototype.getCastShadow=function(){return this.castShadow},e.prototype.setCastShadow=function(e){this.castShadow=e},e.prototype.getMetadata=function(){return this.metadata},e.prototype.getName=function(){return this.name},e.prototype.getBBMin=function(e){return this._validateBoundingVolume(),e?this._bvObjectSpace.bbMin:this._bvWorldSpace.bbMin},e.prototype.getBBMax=function(e){return this._validateBoundingVolume(),e?this._bvObjectSpace.bbMax:this._bvWorldSpace.bbMax},e.prototype.getCenter=function(e){return this._validateBoundingVolume(),e?this._bvObjectSpace.center:this._bvWorldSpace.center},e.prototype.getBSRadius=function(e){return this._validateBoundingVolume(),e?this._bvObjectSpace.bsRadius:this._bvWorldSpace.bsRadius},e.prototype._validateBoundingVolume=function(){if(this._bvDirty||this._hasVolatileTransformation){this._bvObjectSpace.init(),this._bvWorldSpace.init();for(var e=0;e<this.geometryRecords.length;++e){var t=this.geometries[e],n=this.geometryRecords[e],i=t.boundingInfo;this._calculateTransformedBoundingVolume(i,this._bvObjectSpace,n.getShaderTransformation()),this._calculateTransformedBoundingVolume(i,this._bvWorldSpace,this.getCombinedShaderTransformation(n))}r.vec3d.lerp(this._bvObjectSpace.bbMin,this._bvObjectSpace.bbMax,.5,this._bvObjectSpace.center),r.vec3d.lerp(this._bvWorldSpace.bbMin,this._bvWorldSpace.bbMax,.5,this._bvWorldSpace.center);var o=r.vec3d.create(),a=r.vec3d.create(),s=r.mat4d.maxScale(this.objectTransformation);for(e=0;e<this.geometryRecords.length;++e){t=this.geometries[e];var l=this.geometryRecords[e].getShaderTransformation(),u=r.mat4d.maxScale(l);i=t.boundingInfo;r.mat4d.multiplyVec3(l,i.getCenter(),o);var c=r.vec3d.dist(o,this._bvObjectSpace.center),d=i.getBSRadius()*u;this._bvObjectSpace.bsRadius=Math.max(this._bvObjectSpace.bsRadius,c+d),r.mat4d.multiplyVec3(this.objectTransformation,o,a);var p=r.vec3d.dist(a,this._bvWorldSpace.center),f=d*s;this._bvWorldSpace.bsRadius=Math.max(this._bvWorldSpace.bsRadius,p+f)}this._bvDirty=!1}},e.prototype._calculateTransformedBoundingVolume=function(e,t,n){var i=e.getBBMin(),o=e.getBBMax(),a=r.vec3d.create(i),s=r.vec3d.create(o);r.mat4d.multiplyVec3(n,a),r.mat4d.multiplyVec3(n,s);for(var l=0;l<3;++l)t.bbMin[l]=Math.min(t.bbMin[l],a[l],s[l]),t.bbMax[l]=Math.max(t.bbMax[l],a[l],s[l]);for(l=0;l<3;++l){r.vec3d.set(i,a),r.vec3d.set(o,s),a[l]=o[l],s[l]=i[l],r.mat4d.multiplyVec3(n,a),r.mat4d.multiplyVec3(n,s);for(var u=0;u<3;++u)t.bbMin[u]=Math.min(t.bbMin[u],a[u],s[u]),t.bbMax[u]=Math.max(t.bbMax[u],a[u],s[u])}},e.prototype._invalidateBoundingVolume=function(){this._bvDirty=!0,this._parentLayer&&this._parentLayer.notifyObjectBBChanged(this,{center:this._bvWorldSpace.center,radius:this._bvWorldSpace.bsRadius})},e.prototype._notifyDirty=function(e,t,r,n){if(this._parentLayer){r=r||s.OBJECT;var i=n||this;this._parentLayer.notifyDirty(e,t,r,i)}},e._idGen=new a,e}(),p=function(){function e(){this.bbMin=r.vec3d.create(),this.bbMax=r.vec3d.create(),this.center=r.vec3d.create(),this.bsRadius=0}return e.prototype.init=function(){r.vec3d.set3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,this.bbMin),r.vec3d.set3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,this.bbMax),r.vec3d.set3(0,0,0,this.center),this.bsRadius=0},e.prototype.getCenter=function(){return this.center},e.prototype.getBSRadius=function(){return this.bsRadius},e}();return d}.apply(null,n))||(e.exports=i)},706:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(393)],void 0===(i=function(e,t,r){function n(e){return null!=e.cachedResult}Object.defineProperty(t,"__esModule",{value:!0}),t.createContext=function(e,t,n){var i=null,o=e&&e.expression;if("string"==typeof o){var a=function(e){return"0"===e?0:null}(o);if(null!=a)i={cachedResult:a};else{var s=r.createSyntaxTree(o);r.dependsOnView(s)?(null!=n&&n.error("Expressions containing '$view' are not supported on ElevationInfo"),i={cachedResult:0}):i={arcade:{func:r.createFunction(s),context:r.createExecContext(null,{sr:t})}}}}return i},t.createFeature=function(e,t){return r.createFeature(e.attributes,e.geometry,t)},t.setContextFeature=function(e,t){null==e||n(e)||r.updateExecContext(e.arcade.context,t)},t.execute=function(e){if(null!=e){if(n(e))return e.cachedResult;var t=e.arcade,i=r.executeFunction(t.func,t.context);return"number"!=typeof i&&(e.cachedResult=0,i=0),i}return 0},t.extractExpressionInfo=function(e,t){void 0===t&&(t=!1);var r=e&&e.featureExpressionInfo,n=r&&r.expression;return t||"0"===n||(r=null),r},t.zeroContext={cachedResult:0}}.apply(null,n))||(e.exports=i)},707:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(344)],void 0===(i=function(e,t,r){return function(){function e(e,t,n,i,o,a,s,l,u,c,d){this.shaderTransformationDirty=!0,this.data=e.toRenderData(),this.componentOffsets=e.componentOffsets,this.boundingInfo=t,this.material=n,this.origin=null,this.center=r.vec3d.create(),this.bsRadius=0,this.transformation=null,this.calculateShaderTransformation=o,i&&this.updateTransformation(i,a),this.castShadow=s,this.singleUse=l,this.name=u,this.uniqueName=c,this.idx=d,this.canBeMerged=!0,this.instanceParameters={}}return e.prototype.updateTransformation=function(e,t){this.transformation=e,this.shaderTransformationDirty=!0,this.bsRadius=this.getBoundingSphere(e,t,this.center)},e.prototype.shaderTransformationChanged=function(){this.shaderTransformationDirty=!0},e.prototype.getBoundingSphere=function(e,t,n){return t=t||r.mat4d.maxScale(e),r.mat4d.multiplyVec3(e,this.boundingInfo.getCenter(),n),this.boundingInfo.getBSRadius()*t},Object.defineProperty(e.prototype,"hasShaderTransformation",{get:function(){return!!this.calculateShaderTransformation},enumerable:!0,configurable:!0}),e.prototype.getShaderTransformation=function(){return this.calculateShaderTransformation?(this.shaderTransformationDirty&&(this.shaderTransformation||(this.shaderTransformation=r.mat4d.create()),r.mat4d.set(this.calculateShaderTransformation(this.transformation),this.shaderTransformation),this.shaderTransformationDirty=!1),this.shaderTransformation):this.transformation},e}()}.apply(null,n))||(e.exports=i)},708:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){return function(){function e(e,t){this.material=e,this.programRep=t}return e.prototype.dispose=function(){},Object.defineProperty(e.prototype,"materialId",{get:function(){return this.material.id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderOccluded",{get:function(){return this.material.renderOccluded},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderPriority",{get:function(){return this.material.renderPriority},enumerable:!0,configurable:!0}),e.prototype.isVisible=function(){return this.material.isVisible()},e.prototype.getPrograms=function(){return[this.getProgram()]},e}()}.apply(null,n))||(e.exports=i)},709:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(343),r(344),r(640),r(364),r(631),r(889),r(439),r(422),r(452),r(349),r(630),r(377),r(371),r(397)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,c,d,p,f,h,m){function v(e,t,r,n,a,s,l){l=!1!==l,i.requestImage(t).then(function(t){if(d.assert(t.width>=1&&t.height>=1),r.samplingMode=l?9987:9729,r.hasMipmap=l,!l&&33071===r.wrapMode||o.isPowerOfTwo(t.width)&&o.isPowerOfTwo(t.height)){r.width=t.width,r.height=t.height;var i=new h(e,r,t);e.bindTexture(i),s(i)}else{i=g(e,t,r,n,a);e.bindTexture(i),s(i)}}).catch(function(e){var r=t.length>200?t.slice(0,100)+"..."+t.slice(t.length-100):t;y.error("Failed to load image from uri",r,e),s(null)})}function g(e,t,r,i,a){var s=o.nextHighestPowerOfTwo(t.width),c=o.nextHighestPowerOfTwo(t.height);d.assert(s!==t.width||c!==t.height),r.width=s,r.height=c;var v=new h(e,r),g=f.createWithAttachments(e,v,{colorTarget:0,depthStencilTarget:0}),y=new h(e,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!!r.flipped,maxAnisotropy:8,preMultiplyAlpha:r.preMultiplyAlpha},t);if(e.bindFramebuffer(g),void 0===a){var b=e.getViewport();a=[b.x,b.y,b.width,b.height]}e.setViewport(0,0,s,c);var _=i.getProgram(p.texOnly),x=n.mat4d.identity();e.bindProgram(_),_.setUniformMatrix4fv("model",x),_.setUniformMatrix4fv("view",x),_.setUniformMatrix4fv("proj",x),_.setUniform4f("color",1,1,1,1),_.setUniform1i("tex",0);var w=u.createQuadVAO(e,l.Pos3Tex);return e.bindTexture(y,0),e.bindVAO(w),e.setDepthTestEnabled(!1),e.setBlendingEnabled(!1),e.drawArrays(5,0,m.vertexCount(w,"geometry")),e.setDepthTestEnabled(!0),e.bindFramebuffer(null),e.setViewport(a[0],a[1],a[2],a[3]),w.dispose(!0),y.dispose(),e.bindFramebuffer(null),g.detachColorTexture(),g.dispose(),r.hasMipmap&&v.generateMipmap(),v}var y=r.getLogger("esri.views.3d.webgl-engine.lib.Texture");return function(){function e(t,r,n){this.data=t,this.id=e.idGen.gen(r),this.unloadFunc=void 0,this.params=n||{},this.params.wrapClamp=this.params.wrapClamp||!1,this.params.mipmap=!1!==this.params.mipmap,this.params.noUnpackFlip=this.params.noUnpackFlip||!1,this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1,this.estimatedTexMemRequired=e.estimateTexMemRequired(this.data,this.params)}return e.estimateTexMemRequired=function(e,t){return null==e?0:a.isArrayBuffer(e)||a.isUint8Array(e)?e.byteLength:e instanceof Image||e instanceof ImageData||e instanceof HTMLCanvasElement?(t.mipmap?4/3:1)*e.width*e.height*4:(t.mipmap?4/3:1)*t.width*t.height*4||0},e.prototype.getEstimatedTexMemRequired=function(){return this.estimatedTexMemRequired},e.prototype.dispose=function(){this.data=void 0},e.prototype.deferredLoading=function(){return"string"==typeof this.data},e.prototype.getWidth=function(){return this.params.width},e.prototype.getHeight=function(){return this.params.height},e.prototype.initializeThroughUpload=function(t,r,n,i,l){var u=this.data;if(r.flipped=!this.params.noUnpackFlip,r.samplingMode=this.params.mipmap?9987:9729,r.hasMipmap=this.params.mipmap,r.wrapMode=this.params.wrapClamp?33071:10497,r.preMultiplyAlpha=this.params.preMultiplyAlpha,"string"==typeof u)v(t,u,r,n,i,l,this.params.mipmap);else if(u instanceof Image||u instanceof ImageData||u instanceof HTMLCanvasElement){if(this.params.width=u.width,this.params.height=u.height,!(this.params.mipmap||!this.params.wrapClamp)||o.isPowerOfTwo(u.width)&&o.isPowerOfTwo(u.height)){r.width=u.width,r.height=u.height;var c=new h(t,r,u);t.bindTexture(c),l(c)}else{c=g(t,u,r,n,i);t.bindTexture(c),l(c)}}else if(a.isArrayBuffer(u)&&this.params.encoding===e.DDS_ENCODING){c=s.createDDSTexture(t,r,u,this.params.mipmap);t.bindTexture(c),l(c)}else if(a.isUint8Array(u)&&this.params.encoding===e.DDS_ENCODING){c=s.createDDSTexture(t,r,u.buffer,this.params.mipmap);t.bindTexture(c),l(c)}else if(a.isUint8Array(u)){d.assert(this.params.width>0&&this.params.height>0),r.pixelFormat=1===this.params.components?6409:6408,r.width=this.params.width,r.height=this.params.height;c=new h(t,r,u);t.bindTexture(c),l(c)}else{if(null!==u)throw console.warn("Unsupported image data"),new Error("Unsupported image data");c=new h(t,r,null);t.bindTexture(c),l(c)}this.data=void 0},e.prototype.setUnloadFunc=function(e){this.unloadFunc=e},e.prototype.unload=function(){void 0!==this.unloadFunc&&(this.unloadFunc(this.id),this.unloadFunc=void 0)},e.createEmpty=function(t){return void 0===t&&(t="emptyTexture"),new e(new Uint8Array([0,0,0,0]),t,{width:1,height:1,wrapClamp:!0})},e.idGen=new c,e.DDS_ENCODING="image/vnd-ms.dds",e}()}.apply(null,n))||(e.exports=i)},713:function(e,t,r){var n,i;n=[r(353),r(339),r(357),r(465),r(591)],void 0===(i=function(e,t,r,n,i){var o={width:12,height:12,angle:0,xoffset:0,yoffset:0},a=e(n,{declaredClass:"esri.symbols.PictureMarkerSymbol",properties:{color:{json:{write:!1}},type:"picture-marker",url:i.urlPropertyDefinition,source:i.sourcePropertyDefinition,height:{json:{read:{source:["height","size"],reader:function(e,t){return t.size||e}},write:!0},cast:r.toPt},width:{json:{read:{source:["width","size"],reader:function(e,t){return t.size||e}},write:!0},cast:r.toPt},size:{json:{write:!1}}},getDefaults:function(){return t.mixin(this.inherited(arguments),o)},normalizeCtorArgs:function(e,t,n){if(e&&"string"!=typeof e&&null==e.imageData)return e;var i={};return e&&(i.url=e),null!=t&&(i.width=r.toPt(t)),null!=n&&(i.height=r.toPt(n)),i},clone:function(){var e=new a({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return e._set("source",t.clone(this.source)),e}});return a.defaultProps=o,a}.apply(null,n))||(e.exports=i)},714:function(e,t,r){var n,i;n=[r(353),r(339),r(464),r(407)],void 0===(i=function(e,t,r,n){var i={style:"solid",outline:new n,color:[0,0,0,.25]},o=e(r,{declaredClass:"esri.symbols.SimpleFillSymbol",properties:{color:{},type:"simple-fill",style:{value:"solid",type:String,json:{read:function(e){return t.valueOf(this._styles,e)||void 0},write:function(e,t){t.style=this._styles[e]}}}},_styles:{solid:"esriSFSSolid",none:"esriSFSNull",horizontal:"esriSFSHorizontal",vertical:"esriSFSVertical","forward-diagonal":"esriSFSForwardDiagonal","backward-diagonal":"esriSFSBackwardDiagonal",cross:"esriSFSCross","diagonal-cross":"esriSFSDiagonalCross"},getDefaults:function(){return t.mixin(this.inherited(arguments),i)},normalizeCtorArgs:function(e,t,r){if(e&&"string"!=typeof e)return e;var n={};return e&&(n.style=e),t&&(n.outline=t),r&&(n.color=r),n},clone:function(){return new o({color:t.clone(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}});return t.mixin(o,{STYLE_SOLID:"solid",STYLE_NULL:"none",STYLE_HORIZONTAL:"horizontal",STYLE_VERTICAL:"vertical",STYLE_FORWARD_DIAGONAL:"forward-diagonal",STYLE_BACKWARD_DIAGONAL:"backward-diagonal",STYLE_CROSS:"cross",STYLE_DIAGONAL_CROSS:"diagonal-cross"}),o.defaultProps=i,o}.apply(null,n))||(e.exports=i)},724:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=r(658),o=r(659),a=r(461),s=r(960),l=r(621);r(669),t.Map=a.default.Map,l.default("es6-map")||(t.Map=((n=function(){function e(e){if(this._keys=[],this._values=[],this[Symbol.toStringTag]="Map",e)if(o.isArrayLike(e))for(var t=0;t<e.length;t++){var r=e[t];this.set(r[0],r[1])}else try{for(var n=i.__values(e),a=n.next();!a.done;a=n.next()){r=a.value;this.set(r[0],r[1])}}catch(e){s={error:e}}finally{try{a&&!a.done&&(l=n.return)&&l.call(n)}finally{if(s)throw s.error}}var s,l}return e.prototype._indexOfKey=function(e,t){for(var r=0,n=e.length;r<n;r++)if(s.is(e[r],t))return r;return-1},Object.defineProperty(e.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this._keys.length=this._values.length=0},e.prototype.delete=function(e){var t=this._indexOfKey(this._keys,e);return!(t<0)&&(this._keys.splice(t,1),this._values.splice(t,1),!0)},e.prototype.entries=function(){var e=this,t=this._keys.map(function(t,r){return[t,e._values[r]]});return new o.ShimIterator(t)},e.prototype.forEach=function(e,t){for(var r=this._keys,n=this._values,i=0,o=r.length;i<o;i++)e.call(t,n[i],r[i],this)},e.prototype.get=function(e){var t=this._indexOfKey(this._keys,e);return t<0?void 0:this._values[t]},e.prototype.has=function(e){return this._indexOfKey(this._keys,e)>-1},e.prototype.keys=function(){return new o.ShimIterator(this._keys)},e.prototype.set=function(e,t){var r=this._indexOfKey(this._keys,e);return r=r<0?this._keys.length:r,this._keys[r]=e,this._values[r]=t,this},e.prototype.values=function(){return new o.ShimIterator(this._values)},e.prototype[Symbol.iterator]=function(){return this.entries()},e}())[Symbol.species]=n,n)),t.default=t.Map},726:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(340),r(360),r(1382),r(1278),r(344),r(1044),r(779),r(388),r(808),r(349)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,c,d){var p=function(){function e(){}return e.prototype.process=function(e){var t=[e.geometryBuffer];return r.resolve({result:this.transform(e,t),transferList:t})},e.prototype.transform=function(e,t){var r=n.fromJSON(e.indexSR),p=n.fromJSON(e.vertexSR),m=n.fromJSON(e.renderSR),v=!1,g=0,y=[],b=o.computeGlobalTransformation(e.mbs,e.elevationOffset,r,m),_=e.obb?null:l.create([0,0,0],[-1,-1,-1],[0,0,0,1]);a.vec3d.set(e.mbs,f),f[2]+=e.elevationOffset,a.vec3d.set(f,h);for(var x=0,w=e.geometryData;x<w.length;x++)for(var S=w[x],T=S.geometries,E=S.componentOffsets,C=0,O=T;C<O.length;C++){var P=O[C],A=e.layouts[g];++g;var I=[{name:d.VertexAttrConstants.COLOR,byteValue:255}],R=[d.VertexAttrConstants.NORMAL,d.VertexAttrConstants.NORMALCOMPRESSED,d.VertexAttrConstants.SYMBOLCOLOR,d.VertexAttrConstants.COMPONENTINDEX],M=i.interleaveGeometryBuffer(P,e.geometryBuffer,A,I,R),D=new c(new Float32Array(M),A,void 0,void 0,void 0,!0),F=D.getAttribute(d.VertexAttrConstants.POSITION);if(o.reprojectPoints(F,e.mbs,b,e.elevationOffset,r,p,m),_&&this._updateObb(_,F,b),e.needNormals){var L={normals:D.getAttribute(d.VertexAttrConstants.NORMALCOMPRESSED),positions:F,normalInd:D.getIndices(d.VertexAttrConstants.NORMALCOMPRESSED),positionInd:D.getIndices(d.VertexAttrConstants.POSITION)};i.processAndInterleaveNormals(e.normalReferenceFrame,P,e.geometryBuffer,b,L)}var N=D.getAttribute(d.VertexAttrConstants.COMPONENTINDEX);N&&this._createComponentNumbers(N,E);var j=D.getAttribute(d.VertexAttrConstants.COLOR);j&&!v&&(v=this._hasColors(j));var V={globalTrafo:b},U=A[0].stride,B=1-.8*U/(U+4),z=s.deduplicate(M,U/4,B);if(null!=z){var k=z.uniqueCount<65536?new Uint16Array(z.indices):z.indices,G=i.extractPositionData(z.buffer,A,k);y.push({layout:A,interleavedVertexData:z.buffer,indices:k,corMatrices:V,hasColors:v,positionData:G}),t&&(t.push(z.buffer),t.push(k.buffer),t.push(G.data.buffer),t.push(G.indices.buffer))}else{G=i.extractPositionData(M,A);y.push({layout:A,interleavedVertexData:M,corMatrices:V,hasColors:v,positionData:G}),t&&(t.push(M),t.push(G.data.buffer),t.push(G.indices.buffer))}}return _&&(a.mat4d.multiplyVec3(b,_.center,_.center),u.vectorToVector(_.center,m,_.center,r),_.center[2]-=e.elevationOffset),{geometryBuffer:e.geometryBuffer,transformedGeometries:y,obb:_}},e.prototype._hasColors=function(e){for(var t=e.data,r=e.size,n=e.offsetIdx,i=e.strideIdx,o=n;o<t.length;o+=i)for(var a=0;a<r;a++)if(255!==t[o+a])return!0;return!1},e.prototype._createComponentNumbers=function(e,t){for(var r=e.data,n=e.offsetIdx,i=e.strideIdx,o=r.length/i,a=0,s=n,l=0;l<o;l++)l>=t[a+1]&&a++,r[s]=a,s+=i},e.prototype._updateObb=function(e,t,r){if(e.halfSize[0]>0){a.vec3d.subtract(e.center,e.halfSize,f),a.vec3d.add(e.center,e.halfSize,h);for(var n=t.offsetIdx;n<t.data.length;n+=t.strideIdx)f[0]=Math.min(f[0],t.data[n]),f[1]=Math.min(f[1],t.data[n+1]),f[2]=Math.min(f[2],t.data[n+2]),h[0]=Math.max(h[0],t.data[n]),h[1]=Math.max(h[1],t.data[n+1]),h[2]=Math.max(h[2],t.data[n+2]);a.vec3d.subtract(h,f,e.halfSize),a.vec3d.scale(e.halfSize,.5),a.vec3d.add(f,h,e.center),a.vec3d.scale(e.center,.5)}else{l.compute(t,e);var i=2*Math.sqrt(1+r[0]+r[5]+r[10]);m[0]=(r[9]-r[6])/i,m[1]=(r[2]-r[8])/i,m[2]=(r[4]-r[1])/i,m[3]=.25*i,a.quat4.conjugate(m),a.quat4.multiply(m,e.quaternion,e.quaternion)}},e}(),f=a.vec3d.create(),h=a.vec3d.create(),m=a.quat4.create();return p}.apply(null,n))||(e.exports=i)},734:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(452)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=new r;t.generateHighlightId=function(){return n.gen("highlight")}}.apply(null,n))||(e.exports=i)},735:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(697),r(344),r(459),r(840),r(707),r(349)],void 0===(i=function(e,t,r,n,i,o,a,s){var l=s.assert,u=s.logWithBase;return function(){function e(){for(var e in this.dirtySet=new o(this),this._uniqueIdx=0,this._id2origin={},this.content={},i)this.content[i[e]]={}}return e.prototype.getAll=function(e){var t=this.content[e];return l(void 0!==t),t},e.prototype.get=function(e,t){return this.getAll(e)[t]},e.prototype.add=function(e,t){var r=this.content[e];l(void 0!==r);var n=t.id;l(null==r[n],"Model/Stage already contains object to be added"),r[n]=t,e===i.LAYER&&this.notifyDirty(e,t,"layerAdded")},e.prototype.remove=function(e,t){var r=this.content[e];l(void 0!==r);var n=r[t];return l(void 0!==n,"Model/Stage doesn't contain object to be removed"),delete r[t],e===i.TEXTURE&&n.unload(),e===i.LAYER&&this.notifyDirty(e,n,"layerRemoved"),n},e.prototype.getDirtySet=function(){return this.dirtySet},e.prototype.notifyDirty=function(e,t,r,n){this.dirtySet.handleUpdate(t,r,n)},e.prototype.getOrigin=function(e,t,r){void 0===r&&(r=10);var i=0,o=t*r/1e4;o>1&&(i=Math.ceil(u(o,2)));var a=1e4*Math.pow(2,i),s=Math.round(e[0]/a),l=Math.round(e[1]/a),c=Math.round(e[2]/a),d=i+"_"+s+"_"+l+"_"+c,p=this._id2origin[d];return null==p&&(p={vec3:n.vec3d.createFrom(s*a,l*a,c*a),id:d},this._id2origin[d]=p),p},e.prototype.getGeometryRenderGeometries=function(e,t,r){var i=e.id,o=t.geometry,s=e.getCombinedStaticTransformation(t),l=n.mat4d.maxScale(s),u=t.origin,c=t.id,d=this._uniqueIdx++,p=new a(o.data,o.boundingInfo,t.materials[0],s,t.customTransformation,l,e.getCastShadow(),!!o.singleUse,i,c,d);p.origin=u||this.getOrigin(p.center,p.bsRadius),p.instanceParameters=t.instanceParameters,r.push(p)},e.prototype.updateRenderGeometryTransformation=function(e,t,r){e.getCombinedStaticTransformation(t,r.transformation),r.updateTransformation(r.transformation)},e.prototype.formatDebugInfo=function(e){var t=[];if(e){for(var n in t[0]="<table>",i){var o=i[n];t[0]+="<tr><td>"+o+'</td><td style="text-align: right">'+Object.keys(this.getAll(o)).length+"</td></tr>"}t[0]+="</table>",t[1]=this.dirtySet.formatDebugInfo(!0)}else{for(var n in t[0]="",i){o=i[n];t[0]+=r.pad(String(Object.keys(this.getAll(o)).length),6," ")+" "+o+", "}t[1]=this.dirtySet.formatDebugInfo(!1)}return t},e.prototype.validateContent=function(){var e=this.getAll(i.OBJECT);for(var t in e)this.validateObject(e[t]);var r=this.getAll(i.LAYER);for(var n in r)this.validateLayer(r[n]);var o=this.getAll(i.MATERIAL);for(var a in o)this.validateMaterial(o[a])},e.prototype.validateObject=function(e){for(var t=e.geometryRecords,r=0;r<t.length;++r){var n=t[r];l(null!=this.get(i.GEOMETRY,n.geometry.id)),l(1===n.materials.length,"object materials do not match geometry groups"),l(null!=this.get(i.MATERIAL,n.materials[0].id))}},e.prototype.validateLayer=function(e){for(var t=e.getObjects(),r=0;r<t.length;++r){var n=this.get(i.OBJECT,t[r].id);l(null!=n)}},e.prototype.validateMaterial=function(e){for(var t=e.getAllTextureIds(),r=0;r<t.length;++r){var n=this.get(i.TEXTURE,t[r]);l(null!=n)}},e.ContentType=i,e}()}.apply(null,n))||(e.exports=i)},736:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(695),r(344),r(753),r(430),r(372),r(843),r(844),r(845),r(846),r(847),r(848),r(849),r(850),r(595),r(851),r(419),r(852),r(853),r(349),r(854),r(864),r(755),r(385),r(868),r(371),r(397),r(381)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,c,d,p,f,h,m,v,g,y,b,_,x,w,S,T,E,C,O,P){function A(e){if(e.instanceParameters.hidden)return[];var t=e.instanceParameters.componentVisibilities,r=e.componentOffsets;return o.generateVisibleIndexRanges(t,r)}function I(e,t,r){var i=e.origin.vec3;_.setMatrixTranslation3(k,-i[0],-i[1],-i[2]),n.mat4d.multiply(k,e.transformation,t),n.mat4d.inverse(t,r),n.mat4d.transpose(r)}function R(e,t,r){for(var n in e){var i=e[n];t(n,i),i.origin2data.forEach(function(e,t){r(t,e)})}}function M(e){return D(e.data)>=1}function D(e){return!1===e.preinterleaved?_.getFirstObjectValue(e.indices).length:e.indexCount}var F,L=n.mat4d.identity(),N=1535,j=function(){function e(e,t,r,n,i){this._lighting=new w.SceneLighting,this._mat2DataMerged={},this._mat2DataInstanced={},this._mat2DataPreinterleaved={},this._renderOrder=[],this._renderContext=new h,this._isRendering=!1,this._highlights=[],this._threshold=N,this._needsRender=!0,this._fallbackDepthStencilTexture=null,this._stats=new V,this._edgeView=null,this._edgeViewLoaded=!1,this.ssaoEnabled=!1,this.renderOptions={antialiasing:"smaa",earlyOcclusionPixelDraw:!1},this._programRep=e,this._materialRep=t,this._orderedRendering=i,this._rctx=n,this._fxaaPass=new l(n),this._smaaPass=new y(n),this._renderContext.rctx=n,this._renderContext.lightingData=this._lighting.getOld(),n.setDepthTestEnabled(!0),n.setFaceCullingEnabled(!0),n.setBlendingEnabled(!1),n.setBlendFunctionSeparate(770,771,1,771),this._bindParameters={view:null,proj:null,viewInvTransp:null,fovY:0,nearFar:null,lightingData:null,viewport:null,framebufferTex:null,shadowMappingEnabled:!1,ssaoEnabled:!1,origin:null,pixelRatio:null,slicePlane:null},this._linearDepthTextureHelper=new p(n),this._normalTextureHelper=new f(n),this._highlightTextureHelper=new u(n),this._stencilRenderingHelper=new b(n),this._renderPlugins=new v.RenderPluginManager({rctx:n,gl:n.gl,programRep:e,textureRep:r,materialRep:t}),this._initializeFramebufferTexture()}return e.prototype._initializeFramebufferTexture=function(){var e=this._rctx.gl,t=this._rctx.contextAttributes.alpha?e.RGBA:e.RGB,r=new C(this._rctx,{target:3553,pixelFormat:t,dataType:5121,samplingMode:9728,wrapMode:33071,width:4,height:4});this._framebuffer={format:t,texture:r}},e.prototype.dispose=function(){var e=this,t=function(t){e._releaseMaterials(t)},r=function(e,t){if(t.type===F.Preinterleaved)for(var r in t.instances)t.instances[r].vao.dispose(!0);else t.vao.dispose(!0)};R(this._mat2DataMerged,t,r),R(this._mat2DataInstanced,t,r),R(this._mat2DataPreinterleaved,t,r),this._mat2DataMerged=null,this._mat2DataInstanced=null,this._mat2DataPreinterleaved=null,this._framebuffer.texture.dispose(),this._framebuffer.texture=null,this._linearDepthTextureHelper.enabled=!1,this._normalTextureHelper.enabled=!1,this._stencilRenderingHelper.enabled=!1,this._fallbackDepthStencilTexture&&(this._fallbackDepthStencilTexture.dispose(),this._fallbackDepthStencilTexture=null),this._highlightTextureHelper&&(this._highlightTextureHelper.dispose(),this._highlightTextureHelper=null)},Object.defineProperty(e.prototype,"isLoadingResources",{get:function(){return"smaa"===this.renderOptions.antialiasing&&this._smaaPass.isLoadingResources},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"edgeView",{get:function(){var e=this;return this._edgeViewLoaded||(this._edgeViewLoaded=!0,this._edgeView=new x.EdgeView(this._rctx,this._programRep,{setNeedsRender:function(){e._needsRender=!0}}),this._edgeView.initialize()),this._edgeView},enumerable:!0,configurable:!0}),e.prototype.setLighting=function(e){this._lighting.set(e)},Object.defineProperty(e.prototype,"renderPlugins",{get:function(){return this._renderPlugins},enumerable:!0,configurable:!0}),e.prototype.resetNeedsRender=function(){this._needsRender=!1,this._renderPlugins.resetNeedsRender()},e.prototype.needsRender=function(){return this._needsRender||this._renderPlugins.needsRender()},e.prototype.getCombinedStats=function(){var e=this;this._stats.VBOallocatedSize=0,this._stats.VBOoptimalSize=0,this._stats.VBOusedSize=0;var t=function(){},r=function(t,r){if(r.type===F.Preinterleaved)for(var n in r.instances){var i=r.instances[n].vao.size;e._stats.VBOallocatedSize+=i/4,e._stats.VBOusedSize+=i/4,e._stats.VBOoptimalSize+=i/4}else e._stats.VBOallocatedSize+=r.buffer.getArray().length,e._stats.VBOusedSize+=r.buffer.getSize(),e._stats.VBOoptimalSize+=r.optimalCount};return R(this._mat2DataMerged,t,r),R(this._mat2DataInstanced,t,r),R(this._mat2DataPreinterleaved,t,r),this._stats.VBOallocatedSize*=4/1024,this._stats.VBOusedSize*=4/1024,this._stats.VBOoptimalSize*=4/1024,this._stats},e.prototype.getFramebufferTexture=function(e){switch(e){case"linearDepth":return this._linearDepthTextureHelper.framebuffer.colorTexture;case"normals":return this._normalTextureHelper.framebuffer.colorTexture}return null},e.prototype._addHighlight=function(e){var t=this._getInstance(e);null!==t?(this._highlights.push(t),this._orderedRendering&&this._sortHighlightsByRenderOrder(),this._needsRender=!0,this.onHasHighlightsChanged&&this.onHasHighlightsChanged(this.hasHighlights)):console.error("No instance found for RenderGeometry {name: '"+e.name+"', uniqueName: '"+e.uniqueName+"'}")},e.prototype._removeHighlight=function(e){var t=this._highlights.length;this._highlights=this._highlights.filter(function(t){return t.uniqueName!==e.uniqueName}),t!==this._highlights.length&&(this.onHasHighlightsChanged&&this.onHasHighlightsChanged(this.hasHighlights),this._needsRender=!0)},Object.defineProperty(e.prototype,"hasHighlights",{get:function(){return this._highlights.length>0},enumerable:!0,configurable:!0}),e.prototype._renderHUDVisibility=function(e){var t=this,r=S.shouldRenderVisibilityDuringRenderPass(e.pass),n=e.offscreenRenderingHelper&&e.offscreenRenderingHelper.enabled,i=!1;return r&&n&&e.offscreenRenderingHelper.renderHUDVisibility(function(){i=t._renderInternalSlot(g.OCCLUSION_PIXELS,e)}),i},e.prototype.renderGeometrySlotsPt1=function(e){this._renderPlugins.render(g.INTERNAL_MATERIAL,e),this._renderInternalSlot(g.STENCIL_MATERIAL,e),this._renderPlugins.render(g.OPAQUE_TERRAIN,e),this._renderInternalSlot(g.OPAQUE_MATERIAL,e),this._renderPlugins.render(g.OPAQUE_EXTERNAL,e),e.ssaoHelper&&e.ssaoHelper.bindAll(this._programRep),this._renderPlugins.render(g.POSTPROCESSING_ATMOSPHERE_OPAQUE,this._renderContext),this._renderInternalSlot(g.TRANSPARENT_MATERIAL,e),this.renderOptions.earlyOcclusionPixelDraw&&(this._renderHUDVisibility(e),this._renderInternalSlot(g.LINE_CALLOUTS,this._renderContext)),this._renderPlugins.render(g.TRANSPARENT_EXTERNAL,e),e.ssaoHelper&&e.ssaoHelper.bindAll(this._programRep)},e.prototype.renderTransparentTerrain=function(e){return this._renderPlugins.render(g.TRANSPARENT_TERRAIN,e)},e.prototype.renderGeometrySlots=function(e){this.renderGeometrySlotsPt1(e),this.renderTransparentTerrain(e)},e.prototype.renderHUD=function(e){this._bindParameters.renderTransparentlyOccludedHUD=e,this._renderInternalSlot(g.LINE_CALLOUTS_HUD_DEPTH,this._renderContext),this._renderInternalSlot(g.HUDMATERIAL1,this._renderContext),this._renderInternalSlot(g.HUDMATERIAL2,this._renderContext)},e.prototype._renderHighlights=function(e,t){if(t&&t.enabled&&(this.hasHighlights||this._renderPlugins.needsHighlight())){var r=null;t.profilingCallback&&(r=E.startMeasurement(this._renderContext.rctx));var n=e.camera,i=e.fbo;this._highlightTextureHelper.prepareHighlightPass(n),this.renderGeometryPass(m.MATERIAL_HIGHLIGHT,e,null,null,this._renderContext.sliceHelper);var o=this._rctx.gl;this._rctx.clear(o.DEPTH_BUFFER_BIT),this.renderHUD("both"),this._highlightTextureHelper.finish(i);var a=this._highlightTextureHelper.framebuffer;t.render(e,a),null!==r&&t.profilingCallback&&r.stop(function(e){t.profilingCallback&&t.profilingCallback(e)})}},e.prototype._needsRenderOccluded=function(e){for(var t in this._mat2DataInstanced){var r=this._mat2DataInstanced[t][0];if(r&&r.renderOccluded&&r.beginSlot(e)&&r.isVisible())return!0}return!1},e.prototype._renderOccluded=function(e,t,r){if(t&&r&&r.enabled){var n=this._needsRenderOccluded(g.OPAQUE_MATERIAL)||this._needsRenderOccluded(g.TRANSPARENT_MATERIAL);if(t.enabled=n,n){var i=this._renderContext;t.setupFBOs(e),t.prepareColorPass(),i.pass=m.MATERIAL,i.renderOccludedOnly=!0,this._renderInternalSlot(g.OPAQUE_MATERIAL,i),this._renderInternalSlot(g.TRANSPARENT_MATERIAL,i),i.renderOccludedOnly=!1,t.finish(r.framebuffer),t.apply()}}},e.prototype._renderUnordered=function(e,t,r){var n=this,i=this._rctx;this._isRendering=!0,this._stats.reset();var o=e.camera,a=e.fbo,s=e.pixelRatio;this._updateGlobalUniforms(o.projectionMatrix),this._renderContext.pass=m.MATERIAL,this._renderContext.camera=o,this._renderContext.pixelRatio=s,this._renderContext.shadowMap=t,this._renderContext.sliceHelper=r.slice,this._renderContext.ssaoHelper=r.ssao,this._renderContext.offscreenRenderingHelper=r.offscreenRendering,this._renderContext.stencilRenderingHelper=this._stencilRenderingHelper,this._renderContext.depth=this._linearDepthTextureHelper.framebuffer,this._renderContext.normals=this._normalTextureHelper.framebuffer,this._renderContext.highlight=this._highlightTextureHelper.framebuffer,this._renderContext.options=this.renderOptions,r.offscreenRendering.enabled=!0,r.offscreenRendering.initializeFrame(o,a),this._renderPlugins.render(g.BACKGROUND,this._renderContext),this.renderGeometrySlotsPt1(this._renderContext),this._edgeView&&this.edgeView.shouldRender()&&r.offscreenRendering.renderSeparateAndComposite(function(){n._edgeView.render(n._bindParameters)},void 0,"alpha");var l={hudVisibility:!1,transparentTerrain:!1};this.renderOptions.earlyOcclusionPixelDraw||(l.hudVisibility=this._renderHUDVisibility(this._renderContext),this._renderInternalSlot(g.LINE_CALLOUTS,this._renderContext)),l.transparentTerrain=this.renderTransparentTerrain(this._renderContext),l.transparentTerrain&&l.hudVisibility&&(r.offscreenRendering.compositeTransparentTerrainOntoHUDVisibility(),r.offscreenRendering.renderToTargets(function(){return n.renderHUD("occluded")},r.offscreenRendering.mainColor,r.offscreenRendering.tmpDepth,void 0,!0)),l.transparentTerrain&&r.offscreenRendering.compositeTransparentTerrainOntoMain(),r.offscreenRendering.renderToTargets(function(){n._renderPlugins.render(g.POSTPROCESSING_ATMOSPHERE_TRANSPARENT,n._renderContext),n._renderPlugins.render(g.POSTPROCESSING_EXTERNAL,n._renderContext),n._renderOccluded(o,r.renderOccluded,r.offscreenRendering)},r.offscreenRendering.mainColor,r.offscreenRendering.mainDepth);var u=this.renderOptions.antialiasing;"smaa"===u&&this._smaaPass.loadResources(function(){n._needsRender=!0}),"smaa"===u&&this._smaaPass.enable()?(this._fxaaPass.disable(),this._smaaPass.render({colorTexture:r.offscreenRendering.colorTexture},a)):"fxaa"===u&&this._fxaaPass.enable()?(this._smaaPass.disable(),this._fxaaPass.render({colorTexture:r.offscreenRendering.colorTexture},a)):(r.offscreenRendering.composite(),this._fxaaPass.disable(),this._smaaPass.disable()),i.bindFramebuffer(a),this._renderContext.framebufferTex=r.offscreenRendering.colorTexture,this.renderHUD("notOccluded"),this._renderHighlights(e,r.highlight),this._isRendering=!1},e.prototype._renderGeometryPassOrderedHighlight=function(e){this._renderInternalHighlights()},e.prototype._renderGeometryPassOrderedMaterial=function(e){for(var t=null,r=0;r<this._renderOrder.length;r++){var n,i,o=this._renderOrder[r][1];if(o.instanced)(i=(n=o.instanced||o.merged)[e.pass])&&i.isVisible()&&(this._renderInternalInstanced(n,i,this._bindParameters,1/0),t=null);if(o.merged)if((i=(n=o.merged)[e.pass])&&i.isVisible()){var a=i.getProgram();a!==t&&(a.setUniformMatrix4fv("model",L),a.hasUniform("modelNormal")&&a.setUniformMatrix4fv("modelNormal",L)),t=a,this._renderInternalMerged(n,i,this._bindParameters,1/0)}}},e.prototype._renderGeometryPassOrdered=function(e){var t=e.camera;this._bindParameters.view=t.viewMatrix,this._bindParameters.proj=t.projectionMatrix,this._bindParameters.viewInvTransp=t.viewInverseTransposeMatrix,z[0]=t.near,z[1]=t.far,this._bindParameters.nearFar=z,this._bindParameters.lightingData=e.lightingData,this._bindParameters.viewport=t.fullViewport,this._bindParameters.framebufferTex=this._framebuffer.texture,this._bindParameters.pixelRatio=e.pixelRatio,this._bindParameters.slicePlane=e.sliceHelper&&e.sliceHelper.plane,e.isHighlightPass?this._renderGeometryPassOrderedHighlight(e):this._renderGeometryPassOrderedMaterial(e)},e.prototype._renderOrdered=function(e,t){this._stats.reset(),this.renderGeometryPass(e,t)},e.prototype.prepareRender=function(e){this._renderPlugins.prepareRender(e),this._renderContext.rctx.setDepthFunction(513)},e.prototype.render=function(e,t){this._orderedRendering?this._renderOrdered(m.MATERIAL,e):this._renderUnordered(e,t.shadowMap,t)},e.prototype.renderAuxiliaryBuffers=function(e,t){var r=t.ssao,n=t.slice,i=t.shadowMap,o=this.ssaoEnabled||this._renderPlugins.needsLinearDepth(),a=e.camera,s=e.fbo;this._linearDepthTextureHelper.enabled=o,o&&(this._linearDepthTextureHelper.setupFBOs(a),this._linearDepthTextureHelper.prepareDepthPass(),this.renderGeometryPass(m.MATERIAL_DEPTH,e,i,r,n),this._linearDepthTextureHelper.finish(s)),this._normalTextureHelper.enabled=this.ssaoEnabled,this.ssaoEnabled&&(this._normalTextureHelper.setupFBOs(a),this._normalTextureHelper.prepareNormalPass(),this.renderGeometryPass(m.MATERIAL_NORMAL,e,i,r,n),this._normalTextureHelper.finish(s),r.computeSSAO(a,s,this._linearDepthTextureHelper.framebuffer,this._normalTextureHelper.framebuffer)),r.bindAll(this._programRep)},e.prototype.renderGeometryPass=function(e,t,r,n,i){this._isRendering=!0;var o=t.camera,a=t.pixelRatio;this._updateGlobalUniforms(o.projectionMatrix),this._renderContext.pass=e,this._renderContext.camera=o,this._renderContext.pixelRatio=a,this._renderContext.shadowMap=r,this._renderContext.ssaoHelper=n,this._renderContext.depth=this._linearDepthTextureHelper.framebuffer,this._renderContext.normals=this._normalTextureHelper.framebuffer,this._renderContext.sliceHelper=i,this._orderedRendering?this._renderGeometryPassOrdered(this._renderContext):this._renderGeometryPassUnordered(this._renderContext),this._isRendering=!1},e.prototype._renderGeometryPassUnordered=function(e){this.renderGeometrySlots(e)},e.prototype._renderInternalHighlights=function(e){void 0===e&&(e=null);for(var t=!1,r=0;r<this._highlights.length;++r){var n=this._highlights[r],i=n.matData[m.MATERIAL_HIGHLIGHT];i&&(null===e||i.beginSlot(e))&&i.isVisible()&&(t=this._renderInternalHighlight(n,this._bindParameters,m.MATERIAL_HIGHLIGHT)||t)}return t},e.prototype._renderInternalSlotOccluded=function(e,t){var r=!1;for(var n in this._mat2DataInstanced){var i=this._mat2DataInstanced[n],o=i[t.pass];o&&o.renderOccluded&&o.beginSlot(e)&&o.isVisible()&&(r=this._renderInternalInstanced(i,o,this._bindParameters,e)||r)}return r},e.prototype._renderInternalSlotMaterial=function(e,t){var r=!1;for(var n in this._mat2DataInstanced){(u=(l=this._mat2DataInstanced[n])[t.pass])&&u.beginSlot(e)&&u.isVisible()&&(r=this._renderInternalInstanced(l,u,this._bindParameters,e)||r)}for(var i=this._programRep.getProgramsUsingUniform("model"),o=this._programRep.getProgramsUsingUniform("modelNormal"),a=0;a<i.length;a++){var s=i[a];s.setUniformMatrix4fv("model",L),o.indexOf(s)>-1&&s.setUniformMatrix4fv("modelNormal",L)}for(var n in this._mat2DataMerged){(u=(l=this._mat2DataMerged[n])[t.pass])&&u.beginSlot(e)&&u.isVisible()&&(r=this._renderInternalMerged(l,u,this._bindParameters,e)||r)}for(var n in this._mat2DataPreinterleaved){var l,u;(u=(l=this._mat2DataPreinterleaved[n])[t.pass])&&u.beginSlot(e)&&u.isVisible()&&(r=this._renderInternalPreinterleaved(l,u,this._bindParameters,e)||r)}return e===g.STENCIL_MATERIAL&&this._stencilRenderingHelper.finish(),r},e.prototype._renderInternalSlotHighlights=function(e,t){return this._renderInternalHighlights(e)},e.prototype._renderInternalSlot=function(e,t){this._bindParameters.view=t.camera.viewMatrix,this._bindParameters.proj=t.camera.projectionMatrix,this._bindParameters.viewInvTransp=t.camera.viewInverseTransposeMatrix,this._bindParameters.cameraAboveGround=t.camera.aboveGround,this._bindParameters.fovY=t.camera.fovY,z[0]=t.camera.near,z[1]=t.camera.far;var r=this._renderContext.offscreenRenderingHelper;return this._bindParameters.nearFar=z,this._bindParameters.lightingData=t.lightingData,this._bindParameters.viewport=t.camera.fullViewport,this._bindParameters.framebufferTex=r?r.colorTexture:null,this._bindParameters.shadowMap=t.shadowMap,this._bindParameters.shadowMappingEnabled=!!t.shadowMap&&t.shadowMap.enabled,this._bindParameters.ssaoEnabled=!!t.ssaoHelper&&t.ssaoHelper.enabled,this._bindParameters.pixelRatio=t.pixelRatio,this._bindParameters.slicePlane=t.sliceHelper&&t.sliceHelper.plane,this._bindParameters.hudVisibilityTexture=r?r.hudVisibilityTexture:null,t.isHighlightPass?this._renderInternalSlotHighlights(e,t):t.renderOccludedOnly?this._renderInternalSlotOccluded(e,t):this._renderInternalSlotMaterial(e,t)},e.prototype._renderInternalInstanced=function(e,t,r,n){var i=this,o=this._rctx,a=o.gl,s=!1,l=t.getDrawMode(o),u=o.capabilities.instancing,c=!1;return e.origin2data.forEach(function(e){r.origin=e.origin,n===g.STENCIL_MATERIAL&&(i._stencilRenderingHelper.enabled=!0,i._stencilRenderingHelper.prepareStencilWritePass());var d=!1;if(t.instanced)for(var p in e.perGeometryDataInfo){var f=e.perGeometryDataInfo[p];s||(t.bind(o,r),s=!0),o.bindVAO(f.vao);var h=t.getProgram();O.assertCompatibleVertexAttributeLocations(f.vao,h),d||(t.bindView(o,r),d=!0);var m=f.to-f.from,v=f.refCount;l===a.TRIANGLES&&(i._stats.trianglesRendered+=v*m/3),u.drawArraysInstanced(l,f.from,m,v),c=!0,i._stats.drawCallsAngleInstanced++,i._stats.instancesDrawnAngle+=v}else{var y=e.instances;for(var b in y){var _=y[b],x=_.displayedIndexRange;x&&0===x.length||(s||(t.bind(o,r),s=!0),d||(o.bindVAO(e.vao),t.bindView(o,r),d=!0),t.bindInstance(o,_),i._stats.drawCallsInstanced++,l===a.TRIANGLES&&(i._stats.trianglesRendered+=(_.to-_.from)/3),x?i._drawArraysFaceRange(x,_.from,l):o.drawArrays(l,_.from,_.to-_.from),c=!0)}}}),o.bindVAO(null),s&&t.release(o,r),c},e.prototype._renderInternalHighlight=function(e,t,r){var n=this._rctx,i=n.gl,o=e.matData[r],a=o.getDrawMode(n),s=e.instance,l=s.highlightedIndexRange,u=this._renderContext.offscreenRenderingHelper,c=(u?u.depthTexture:null)||this._getFallbackDepthTexture(),d=o.getProgram(),p=n.capabilities.instancing;t.origin=e.originData.origin;var f=!1;if(o.instanced&&e.type===F.Instanced){var h=e.instancedVAO;o.bind(n,t),n.bindVAO(h),O.assertCompatibleVertexAttributeLocations(h,d),o.bindView(n,t);for(var m=0;m<l.length;m++){var v=(_=l[m]).range?_.range[0]+s.from:s.from,g=_.range?_.range[1]-_.range[0]+1:s.to-s.from;n.bindTexture(c,5),d.setUniform1i("depthTex",5),d.setUniform4f("highlightViewportPixelSz",0,0,1/this._bindParameters.viewport[2],1/this._bindParameters.viewport[3]),p.drawArraysInstanced(a,v,g,1),a===i.TRIANGLES&&(this._stats.trianglesRendered+=1*g/3),this._stats.drawCallsHighlight++,f=!0}}else if(e.type===F.Instanced&&o.instanced)console.error("_renderInternalHighlight: incompatible instance type");else{o.bind(n,t),o.bindView(n,t);var y=null;switch(e.type){case F.Merged:var b=e.originData;n.bindVAO(b.vao),d.setUniformMatrix4fv("model",L);break;case F.Instanced:b=e.originData;n.bindVAO(b.vao),o.bindInstance(n,s);break;case F.Preinterleaved:h=(b=e.originData).instances[e.uniqueName].vao;n.bindVAO(h),o.bindInstance(n,s),y=h.indexBuffer&&h.indexBuffer.indexType}for(m=0;m<l.length;m++){var _;v=(_=l[m]).range?_.range[0]+s.from:s.from,g=_.range?_.range[1]-_.range[0]+1:s.to-s.from;if(n.bindTexture(c,5),o.getProgram().setUniform1i("depthTex",5),d.setUniform4f("highlightViewportPixelSz",0,0,1/this._bindParameters.viewport[2],1/this._bindParameters.viewport[3]),y){var x=O.getBytesPerElement(y);n.drawElements(a,g,y,v*x)}else n.drawArrays(a,v,g);a===i.TRIANGLES&&(this._stats.trianglesRendered+=g/3),this._stats.drawCallsHighlight++,f=!0}}return n.bindVAO(null),o.release(n,t),f},e.prototype._drawArraysFaceRange=function(e,t,r){for(var n=this._rctx,i=0,o=e;i<o.length;i++){var a=o[i];n.drawArrays(r,a[0]+t,a[1]-a[0]+1)}this._stats.drawCallsFragmented+=e.length-1},e.prototype._drawElementsFaceRange=function(e,t,r,n){for(var i=this._rctx,o=O.getBytesPerElement(n),a=0,s=e;a<s.length;a++){var l=s[a],u=l[1]-l[0]+1,c=l[0]+t;i.drawElements(r,u,n,c*o)}this._stats.drawCallsFragmented+=e.length-1},e.prototype._renderInternalMerged=function(e,t,r,n){var i=this,o=this._rctx,a=o.gl,s=!1,l=!1;return e.origin2data.forEach(function(e){if(r.origin=e.origin,n===g.STENCIL_MATERIAL&&(i._stencilRenderingHelper.enabled=!0,i._stencilRenderingHelper.prepareStencilWritePass()),!e.displayedIndexRange||0!==e.displayedIndexRange.length){l||(t.bind(o,r),l=!0);var u=t.getProgram();o.bindVAO(e.vao),O.assertCompatibleVertexAttributeLocations(e.vao,u),t.bindView(o,r),i._stats.drawCallsMerged++;var c=t.getDrawMode(o);c===a.TRIANGLES&&(i._stats.trianglesRendered+=e.vao.vertexBuffers.geometry.size/3),e.displayedIndexRange?i._drawArraysFaceRange(e.displayedIndexRange,0,c):o.drawArrays(c,0,O.vertexCount(e.vao,"geometry")),s=!0}}),l&&t.release(o,r),s},e.prototype._renderInternalPreinterleaved=function(e,t,r,n){var i=this,o=this._rctx,a=o.gl,s=!1,l=!1,u=t.getDrawMode(o);return e.origin2data.forEach(function(e){r.origin=e.origin;var c=!1;for(var d in n===g.STENCIL_MATERIAL&&(i._stencilRenderingHelper.enabled=!0,i._stencilRenderingHelper.prepareStencilWritePass()),e.instances){var p=e.instances[d],f=p.instance,h=p.vao,m=f.displayedIndexRange;if(!m||0!==m.length){l||(t.bind(o,r),l=!0);var v=t.getProgram();O.assertCompatibleVertexAttributeLocations(h,v),o.bindVAO(h),c||(t.bindView(o,r),c=!0),t.bindInstance(o,f),i._stats.drawCallsPreinterleaved++,u===a.TRIANGLES&&(i._stats.trianglesRendered+=(f.to-f.from)/3);var y=h.indexBuffer&&h.indexBuffer.indexType;if(m)y?i._drawElementsFaceRange(m,f.from,u,y):i._drawArraysFaceRange(m,f.from,u);else if(y){var b=O.getBytesPerElement(y);o.drawElements(u,f.to-f.from,y,f.from*b)}else o.drawArrays(u,f.from,f.to-f.from);s=!0}}}),o.bindVAO(null),l&&t.release(o,r),s},e.prototype._updateGlobalUniforms=function(e){for(var t=this._programRep.getProgramsUsingUniform("proj"),r=0;r<t.length;r++)t[r].setUniformMatrix4fv("proj",e);if(this._lighting){t=this._programRep.getProgramsUsingUniform("lightingMainDirection");for(r=0;r<t.length;r++)this._lighting.setUniforms(t[r]);t=this._programRep.getProgramsUsingUniform("lightDirection");for(r=0;r<t.length;r++)this._lighting.setUniforms(t[r])}},e.prototype.print=function(){var e=Object.keys(this._mat2DataMerged).length,t=Object.keys(this._mat2DataInstanced).length,r=Object.keys(this._mat2DataPreinterleaved).length;console.log("number of materials (merged/instanced/preinterleaved): "+e+"/"+t+"/"+r);var n=0;R(this._mat2DataMerged,function(){},function(e,t){n+=Object.keys(t.instances).length});var i=0;R(this._mat2DataInstanced,function(){},function(e,t){i+=Object.keys(t.instances).length});var o=0;R(this._mat2DataPreinterleaved,function(){},function(e,t){o+=Object.keys(t.instances).length}),console.log("number of instances (merged/instanced/preinterleaved): "+n+"/"+i+"/"+o)},e.prototype.isEmpty=function(){for(var e in this._mat2DataInstanced){var t=this._mat2DataInstanced[e];if(!r.everyMap(t.origin2data,function(e){return _.objectEmpty(e.instances)}))return!1}for(var e in this._mat2DataMerged){t=this._mat2DataMerged[e];if(!r.everyMap(t.origin2data,function(e){return _.objectEmpty(e.instances)}))return!1}for(var e in this._mat2DataPreinterleaved){t=this._mat2DataPreinterleaved[e];if(!r.everyMap(t.origin2data,function(e){return _.objectEmpty(e.instances)}))return!1}return!0},e.prototype.modify=function(e,t,r,n){this._isRendering&&console.warn("Renderer.modify called while rendering");var i=[],o=[],a=[];this._classifyRenderGeometry(e,i,o,a);var s=[],l=[],u=[];this._classifyRenderGeometry(t,s,l,u);var c={};r&&this._performUpdates(r,c);var d=[];this._modifyMerged(i,s,d,c),this._modifyInstanced(o,l,d),this._modifyPreinterleaved(a,u,d),this._updateMergedFaceranges(c),this._releaseMaterials(d);var p=this._highlights.length;t&&t.length>0&&p>0&&(this._highlights=this._highlights.filter(function(e){return!t.some(function(t){return t.uniqueName===e.uniqueName})}),p!==this._highlights.length&&this.onHasHighlightsChanged&&this.onHasHighlightsChanged(this.hasHighlights)),this._updateHighlightVAOs(),n&&this._modifyMaterials(n),this._needsRender=!0},e.prototype._classifyRenderGeometry=function(e,t,r,n){for(var i=0,o=e;i<o.length;i++){var a=o[i];if(M(a))switch(this._getType(a)){case F.Merged:t.push(a);break;case F.Instanced:r.push(a);break;case F.Preinterleaved:n.push(a)}}},e.prototype._performUpdates=function(e,t){for(var r=0,n=e;r<n.length;r++){var i=n[r],o=i.updateType,a=i.renderGeometry,s=this._getType(a)===F.Merged;if(M(a)){if(2&o&&this._updateFaceranges(a,t),32&o){var l=this._getInstance(a);l&&this._updateHighlightFaceranges(a,l.instance)}4&o||s&&16&o?this._updateVertexAttributes(a,!s):!s&&16&o&&this._updateInstanceTransformation(a)}}},e.prototype._updateFaceranges=function(e,t){var r,n,i=e.material.id,o=e.origin.id,a=this._getType(e);a===F.Preinterleaved?r=(n=this._getOriginData(a,i,o)).instances[e.uniqueName].instance:(r=(n=this._getOriginData(a,i,o)).instances[e.uniqueName])&&a===F.Merged&&(t[this._modifiedMergedFacerangesKey(i,o)]=n);r&&(r.displayedIndexRange=A(e),this._updateHighlightFaceranges(e,r))},e.prototype._updateHighlightFaceranges=function(e,t){if(t){var r=t.highlightedIndexRange,n=function(e){if(e.instanceParameters.hidden)return null;var t=e.instanceParameters.componentVisibilities,r=e.instanceParameters.componentHighlights,n=e.componentOffsets;return o.generateHighlightedIndexRanges(t,r,n)}(e);t.highlightedIndexRange=n,n&&!r?this._addHighlight(e):!n&&r&&this._removeHighlight(e)}},e.prototype._updateMergedFaceranges=function(e){for(var t in e){var r=e[t];r.displayedIndexRange=[];var n=r.instances,i=!0;for(var o in n){var a=n[o];a.displayedIndexRange?(r.displayedIndexRange.push.apply(r.displayedIndexRange,d.offsetIntervals(a.displayedIndexRange,a.from)),i=!1):r.displayedIndexRange.push([a.from,a.to-1])}r.displayedIndexRange=i?null:d.mergeIntervals(r.displayedIndexRange)}},e.prototype._updateVertexAttributes=function(e,t){var r=e.material,n=r.bufferWriter,i=r.id,o=e.origin.id,a=n.vertexBufferLayout.stride/4,s=this._getType(e);if(s!==F.Preinterleaved){var l,u,c=this._getOriginData(s,i,o),d=c.instances[e.uniqueName],p=c.buffer.getArray(),f=c.vao;t||(I(e,G,H),l=G,u=H),n.write({transformation:l,invTranspTransformation:u},e.data,e.instanceParameters,n.vertexBufferLayout.createView(p.buffer),d.from),_.assert(d.from+n.elementCount(e.data)===d.to,"material VBO layout has changed"),f.vertexBuffers.geometry.setSubData(p,d.from*a*4,d.from*a*4,d.to*a*4)}else console.error("Updating Preinterleaved geometry not supported")},e.prototype._updateInstanceTransformation=function(e){var t=this._getType(e),r=e.material.id,n=e.origin.id;if(t===F.Preinterleaved){I(e,(o=(i=this._getOriginData(t,r,n)).instances[e.uniqueName].instance).transformation,o.transformationNormal)}else{var i,o=(i=this._getOriginData(t,r,n)).instances[e.uniqueName],a=i.perGeometryDataInfo[e.data.id],s=a.instanceBufferData;if(I(e,o.transformation,o.transformationNormal),s){var l=s.getSlot(e.idx);s.fill(l,0,o.transformation),s.fill(l,16,o.transformationNormal);var u=4*s.getOffset(l),c=O.getStride(a.vao.layout.instance);a.vao.vertexBuffers.instance.setSubData(s.getArray(),u,u,u+c)}}},e.prototype._modifyMerged=function(e,t,r,n){var i=this._compMatToDelta(e,t,F.Merged),o=this._mat2DataMerged;for(var a in i){var s=i[a];for(var l in s){var u=s[l],c=u.optimalCount,d=u.sparseCount,p=u.material,f=p.bufferWriter.vertexBufferLayout,h=f.stride/4,m=o[a];null==m&&(_.assert(c>0),m=this._initializeMatData(p),o[a]=m,this._orderedRendering&&this._insertIntoRenderOrder(m,p.renderPriority,"merged"));var v=m.origin2data.get(l);if(null==v&&(_.assert(c>0),v=this._createMergedData(f,c,u.origin),m.origin2data.set(l,v)),0===c)v.vao.dispose(!0),v.vao=null,m.origin2data.delete(l),0===m.origin2data.size&&(r.push(a),delete o[a],this._orderedRendering&&this._removeFromRenderOrder(m,"merged"));else{var g=c<u.sparseCount/2,y=g?c:d,b=B,x=v.buffer.getSize(),w=v.buffer.getArray(),S=v.buffer.resize(y);g||S?this._rebuildMerged(v,u.toRemove,h,w,b):u.toRemove.length>0?(this._removeMergedByErasing(v,u.toRemove,h,b),u.toAdd.length>0&&(b.end=x)):(b.begin=x,b.end=x);var T=k;_.setMatrixTranslation3(T,-u.origin[0],-u.origin[1],-u.origin[2]),this._appendMerged(v,p,u.toAdd,h,T,b);var E=v.vao.vertexBuffers.geometry;if(E.byteSize!==v.buffer.getArray().buffer.byteLength)E.setData(v.buffer.getArray());else{var C=b.begin,O=b.end;if(C<O){var P=v.buffer.getArray(),A=4*C,I=4*O;E.setSubData(P,A,A,I)}}(b.updatedDisplayedIndexRange||v.displayedIndexRange)&&(n[this._modifiedMergedFacerangesKey(a,l)]=v)}}}},e.prototype._createMergedData=function(e,t,r){return{type:F.Merged,instances:{},vao:new P(this._rctx,a.Default3D,{geometry:i.glLayout(e)},{geometry:T.createVertex(this._rctx,35044)}),buffer:new s(t),optimalCount:0,origin:r}},e.prototype._rebuildMerged=function(e,t,r,n,i){for(var o=0;o<t.length;++o){var a=e.instances[t[o].uniqueName];e.optimalCount-=(a.to-a.from)*r,delete e.instances[t[o].uniqueName]}var s=0,l=e.buffer.getArray();i.begin=0,i.end=0;var u=-1,c=-1,d=0;for(var p in e.instances){var f=(a=e.instances[p]).from*r,h=a.to*r,m=h-f;u!==c&&c!==f?(l.set(n.subarray(u,c),d),d+=c-u,u=f):-1===u&&(u=f),c=h,a.from=s/r,s+=m,a.to=s/r}u!==c&&l.set(n.subarray(u,c),d),i.end=s},e.prototype._removeMergedByErasing=function(e,t,r,n){if(0!==t.length){n.begin=1/0,n.end=-1/0;for(var i=-1,o=-1,a=0,s=t;a<s.length;a++){var l=s[a].uniqueName,u=e.instances[l].from*r,c=e.instances[l].to*r;i!==o&&o!==u?(e.buffer.erase(i,o),i=u):-1===i&&(i=u),o=c,delete e.instances[l],e.optimalCount-=c-u,u<n.begin&&(n.begin=u),c>n.end&&(n.end=c)}i!==o&&e.buffer.erase(i,o)}},e.prototype._appendMerged=function(e,t,r,i,o,a){a.updatedDisplayedIndexRange=!1;for(var s=t.bufferWriter,l=0,u=r;l<u.length;l++){var c=u[l],d=c.data;n.mat4d.multiply(o,c.transformation,G),n.mat4d.inverse(G,H),n.mat4d.transpose(H);var p=a.end;s.write({transformation:G,invTranspTransformation:H},d,c.instanceParameters,s.vertexBufferLayout.createView(e.buffer.getArray().buffer),a.end/i);var f=s.elementCount(d)*i,h=p+f;_.assert(null==e.instances[c.uniqueName]);var m=A(c),v=new U(c.name,p/i,h/i,m,void 0,void 0,c.idx);e.instances[c.uniqueName]=v,this._updateHighlightFaceranges(c,v),m&&(a.updatedDisplayedIndexRange=!0),e.optimalCount+=f,a.end+=f}},e.prototype._modifyInstanced=function(e,t,r){var o=this._rctx,l=F.Instanced,u=this._compMatToDelta(e,t,l),d=this._mat2DataInstanced;for(var p in u){var f=u[p];for(var h in f){var v=f[h];if(0!==v.optimalCount){var g=v.material,y=g.bufferWriter,b=d[p];if(null==b){var x=g.renderPriority;b=this._initializeMatData(g),d[p]=b,this._orderedRendering&&this._insertIntoRenderOrder(b,x,"instanced")}var w=y.vertexBufferLayout,S=b[m.MATERIAL].instanced?y.instanceBufferLayout:void 0,E=S&&S.fields.get("instanceColor"),C=S&&S.fields.get("instanceFeatureAttribute"),O=w.stride/4,I=b.origin2data.get(h);null==I&&(I={type:l,instances:{},vao:new P(o,a.Default3D,{geometry:i.glLayout(w)},{geometry:T.createVertex(o,35044)}),buffer:new s(v.optimalCount),optimalCount:0,perGeometryDataInfo:{},origin:v.origin},b.origin2data.set(h,I));var R=I.buffer.getSize(),M=I.buffer.getArray(),D=v.optimalCount<v.sparseCount/2,L=I.buffer.resize(D?v.optimalCount:v.sparseCount);for(var N in v.perGeometryDelta){if(($=I.perGeometryDataInfo[N])&&$.instanceBufferData){var j=v.perGeometryDelta[N].removeCount;j>0&&$.instanceBufferData.prepareFree(j)}}var V=v.toRemove;if(D||L){for(var B=0;B<V.length;++B){var z=V[B];delete I.instances[z.uniqueName];N=z.data.id;0==--(W=$=I.perGeometryDataInfo[N]).refCount&&null==v.dataId2refCount[N]?(I.optimalCount-=(W.to-W.from)*O,delete I.perGeometryDataInfo[N]):$.instanceBufferData&&$.instanceBufferData.free(z.idx)}R=0;var G=I.buffer.getArray(),H={};for(var q in I.perGeometryDataInfo){var W=I.perGeometryDataInfo[q];_.assert(null==H[W.from]),H[W.from]=W}for(var X in H){var Q=(W=H[X]).from*O,Y=W.to*O;G.set(M.subarray(Q,Y),R),W.from=R/O,R+=Y-Q,W.to=R/O}for(var J in I.instances){(oe=I.instances[J]).from=I.perGeometryDataInfo[oe.dataId].from,oe.to=I.perGeometryDataInfo[oe.dataId].to}}else for(B=0;B<V.length;++B){z=V[B];delete I.instances[z.uniqueName];N=z.data.id;if(0==--($=I.perGeometryDataInfo[N]).refCount&&null==v.dataId2refCount[N]){Q=$.from*O,Y=$.to*O;I.buffer.erase(Q,Y),I.optimalCount-=Y-Q,delete I.perGeometryDataInfo[N]}else $.instanceBufferData&&$.instanceBufferData.free(z.idx)}for(var N in _.setMatrixTranslation3(k,-v.origin[0],-v.origin[1],-v.origin[2]),v.perGeometryDelta){if(($=I.perGeometryDataInfo[N])&&$.instanceBufferData){var Z=v.perGeometryDelta[N].addCount;Z>0&&$.instanceBufferData.prepareAllocate(Z)}}var K=v.toAdd;for(B=0;B<K.length;++B){var $,ee=(z=K[B]).data;N=ee.id;if(null==($=I.perGeometryDataInfo[N])){y.write({},ee,void 0,y.vertexBufferLayout.createView(I.buffer.getArray().buffer),R/O);var te=y.elementCount(ee)*O;Q=R/O,Y=(R+=te)/O;if(I.optimalCount+=te,$={refCount:1,from:Q,to:Y,vao:null,instanceBufferData:null},S){var re=S.stride/4;$.vao=new P(o,a.Default3D,{geometry:i.glLayout(w),instance:i.glLayout(S,{divisor:1})},{geometry:I.vao.vertexBuffers.geometry,instance:T.createVertex(o,35044)}),$.instanceBufferData=new c(re,v.perGeometryDelta[N].addCount)}I.perGeometryDataInfo[N]=$}else++$.refCount;_.assert($.from*O<=I.buffer.getSize()&&$.to*O<=I.buffer.getSize());var ne=n.mat4d.create();n.mat4d.multiply(k,z.transformation,ne);var ie=A(z),oe=new U(z.name,$.from,$.to,ie,ne,z.instanceParameters,z.idx,N);I.instances[z.uniqueName]=oe,this._updateHighlightFaceranges(z,oe);var ae=$.instanceBufferData;if(ae){var se=ae.allocate(z.idx);ae.fill(se,0,oe.transformation),ae.fill(se,16,oe.transformationNormal),E&&ae.fill(se,E.offset/4,z.instanceParameters.color),C&&ae.fill(se,C.offset/4,z.instanceParameters.featureAttribute)}}_.assert(I.optimalCount===v.optimalCount);var le=new Float32Array(I.buffer.getArray().buffer,0,I.buffer.getSize());for(var N in I.vao.vertexBuffers.geometry.setData(le),I.perGeometryDataInfo){var ue=I.perGeometryDataInfo[N];if(ue.vao){var ce=ue.vao.vertexBuffers.instance;if(ce){var de=v.perGeometryDelta[N];if(de.addCount+de.removeCount>0){var pe=ue.instanceBufferData.compact();ce.setData(pe)}}}}}else{var fe=d[p];fe.origin2data.get(h).vao.dispose(!0),fe.origin2data.delete(h),0===fe.origin2data.size&&(r.push(p),delete d[p],this._orderedRendering&&this._removeFromRenderOrder(fe,"instanced"))}}}},e.prototype._modifyPreinterleaved=function(e,t,r){for(var o=this._rctx,s=F.Preinterleaved,l=this._mat2DataPreinterleaved,u=0,c=e;u<c.length;u++){var d=(M=(R=c[u]).material).bufferWriter,p=M.id,f=R.origin.id,h=R.origin.vec3;null==(D=l[p])&&(D=this._initializeMatData(M),l[p]=D);var m=D.origin2data.get(f);null==m&&(m={type:s,origin:h,count:0,instances:{}},D.origin2data.set(f,m)),_.setMatrixTranslation3(k,-h[0],-h[1],-h[2]);var v=n.mat4d.create();n.mat4d.multiply(k,R.transformation,v);var g=A(R),y=R.data;if(y.preinterleaved)if(null!=y.vertexData){var b=y.indexCount,x=y.id,w=new U(R.name,0,b,g,v,R.instanceParameters,R.idx,x),S=y.indexData?T.createIndex(o,35044,y.indexData):null,E=d.vertexBufferLayout,C=new P(o,a.Default3D,{geometry:i.glLayout(E)},{geometry:T.createVertex(o,35044)},S);C.vertexBuffers.geometry.setData(y.vertexData),y.indexData=null,y.vertexData=null,m.count+=1,m.instances[R.uniqueName]={instance:w,vao:C},this._updateHighlightFaceranges(R,w)}else _.assert(!1,"Trying to re-add preinterleaved geometry data which is no longer available.");else _.assert(!1,"Non-interleaved render geometry processed as pre-interleaved")}for(var O=0,I=t;O<I.length;O++){h=(R=I[O]).origin,p=(M=R.material).id,f=h.id;var R,M,D,L=R.uniqueName,N=(D=l[p]).origin2data.get(f);N.instances[L].vao.dispose(),delete N.instances[L],N.count-=1,0===N.count&&D.origin2data.delete(f),0===D.origin2data.size&&(r.push(p),delete l[p])}},e.prototype._compMatToDelta=function(e,t,r){var n={};return this._updateMatToDelta(e,!0,r,n),this._updateMatToDelta(t,!1,r,n),n},e.prototype._updateMatToDelta=function(e,t,r,n){for(var i=r===F.Instanced,o=0,a=e;o<a.length;o++){var s=a[o],l=s.origin,u=s.material,c=u.bufferWriter,d=u.id,p=i?this._mat2DataInstanced[d]:this._mat2DataMerged[d],f=p&&p.origin2data.get(l.id),h=n[d];null==h&&(h={},n[d]=h);var m=h[l.id];if(null==m){if(m={optimalCount:null==f?0:f.optimalCount,sparseCount:null==f?0:f.buffer.getSize(),material:u,toAdd:[],toRemove:[],perGeometryDelta:null,origin:l.vec3},i){var v={};if(void 0!==f)for(var g in f.perGeometryDataInfo)v[g]=f.perGeometryDataInfo[g].refCount;m.dataId2refCount=v,m.perGeometryDelta={}}h[l.id]=m}var y=c.vertexBufferLayout.stride/4,b=c.elementCount(s.data)*y;if(i){var _=s.data.id,x=m.perGeometryDelta[_];x||(x={addCount:0,removeCount:0},m.perGeometryDelta[_]=x),t?(x.addCount++,null==m.dataId2refCount[_]&&(m.dataId2refCount[_]=0),1==++m.dataId2refCount[_]&&(m.optimalCount+=b,m.sparseCount+=b),m.toAdd.push(s)):(x.removeCount++,0==--m.dataId2refCount[_]&&(delete m.dataId2refCount[_],m.optimalCount-=b),m.toRemove.push(s))}else t?(m.optimalCount+=b,m.sparseCount+=b,m.toAdd.push(s)):(m.optimalCount-=b,m.toRemove.push(s))}},e.prototype._getType=function(e){if(e.data.preinterleaved)return F.Preinterleaved;var t=!1,r=D(e.data);return t=(t=(t=t||!1===e.material.canBeMerged)||e.material.instanced)||!0===e.material.renderOccluded,e.singleUse||(t=t||r>this._threshold),t?F.Instanced:F.Merged},e.prototype._getTargetMat2Data=function(e){switch(e){case F.Merged:return this._mat2DataMerged;case F.Instanced:return this._mat2DataInstanced;case F.Preinterleaved:return this._mat2DataPreinterleaved}},e.prototype._getOriginData=function(e,t,r){return this._getTargetMat2Data(e)[t].origin2data.get(r)},e.prototype._modifiedMergedFacerangesKey=function(e,t){return e+"_"+t},e.prototype._insertIntoRenderOrder=function(e,t,r){for(var n=e[m.MATERIAL].materialId,i=this._renderOrder.length,o=0;o<i&&this._renderOrder[o][0]>=t;){var a=this._renderOrder[o][1];if(a.id===n)return _.assert(!a[r],"matData for type already exists"),void(a[r]=e);o++}var s={id:n,instanced:null,merged:null};s[r]=e,this._renderOrder.splice(o,0,[t,s])},e.prototype._removeFromRenderOrder=function(e,t){for(var r=e[m.MATERIAL].materialId,n=0;this._renderOrder[n][1].id!==r;)n++;var i=this._renderOrder[n][1];i[t]=null,i.instanced||i.merged||this._renderOrder.splice(n,1)},e.prototype._sortHighlightsByRenderOrder=function(){this._highlights.sort(function(e,t){var r=e.matData[m.MATERIAL].renderPriority,n=t.matData[m.MATERIAL].renderPriority;return r>n?-1:n>r?1:0})},e.prototype._updateRenderOrder=function(e,t){for(var r=t.length,n=0;n<r&&t[n][1].id!==e;)n++;if(n<r){var i=t[n][1],o=(i.merged||i.instanced)[m.MATERIAL].renderPriority,a=t[n][0];if(o!==t[n][0]){t[n][0]=o;var s=o>a?-1:1;for(n+=s;n>-1&&n<r&&s*t[n][0]>s*o;){var l=t[n];t[n]=t[n-s],t[n-s]=l,n+=s}}}},e.prototype._modifyMaterials=function(e){var t=this;e.forEach(function(e){t._materialRep.updateMaterialParameters(e)})},e.prototype.modifyRenderOrder=function(e){var t=this;this._orderedRendering&&(e.forEach(function(e){t._updateRenderOrder(e,t._renderOrder)}),this._sortHighlightsByRenderOrder(),this._needsRender=!0)},e.prototype._initializeMatData=function(e){var t={origin2data:new Map};return t[m.MATERIAL]=this._materialRep.aquire(e),t[m.MATERIAL_DEPTH_SHADOWMAP]=this._materialRep.aquireDepthShadowMap(e),t[m.MATERIAL_NORMAL]=this._materialRep.aquireNormal(e),t[m.MATERIAL_DEPTH]=this._materialRep.aquireDepth(e),t[m.MATERIAL_HIGHLIGHT]=this._materialRep.aquireHighlight(e),t},e.prototype._releaseMaterials=function(e){if(Array.isArray(e))for(var t=e,r=0;r<t.length;r++)this._materialRep.release(t[r]),this._materialRep.releaseDepthShadowMap(t[r]),this._materialRep.releaseNormal(t[r]),this._materialRep.releaseDepth(t[r]),this._materialRep.releaseHighlight(t[r]);else this._materialRep.release(e),this._materialRep.releaseDepthShadowMap(e),this._materialRep.releaseNormal(e),this._materialRep.releaseDepth(e),this._materialRep.releaseHighlight(e)},e.prototype._getInstance=function(e){var t=e.material,r=e.uniqueName,n=t.id,i=this._getType(e),o=this._getTargetMat2Data(i),a=e.origin.id,s=o[n];if(!s)return null;var l,u=s.origin2data.get(a);return u?(l=u.type===F.Preinterleaved?u.instances[r].instance:u.instances[r])?{type:i,uniqueName:r,instance:l,matData:s,originData:u,instancedVAO:null,instancedVAOBaseInstance:null}:null:null},e.prototype._createBaseInstanceVAO=function(e){var t=this._rctx,r=e.instance,n=e.originData;if(e.type===F.Instanced&&n.perGeometryDataInfo){var i=n.perGeometryDataInfo[r.dataId],o=i.instanceBufferData;if(o){var a=i.vao,s=o.getSlot(r.idx);if(e.instancedVAOBaseInstance!==s){var l=O.setBaseInstanceOffset(a.layout,s);e.instancedVAO=new P(t,a.locations,l,a.vertexBuffers,a.indexBuffer),e.instancedVAOBaseInstance=s}}}},e.prototype._updateHighlightVAOs=function(){for(var e=0;e<this._highlights.length;++e){var t=this._highlights[e];this._createBaseInstanceVAO(t)}},e.prototype._getFallbackDepthTexture=function(){return this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=new C(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array([255,255,255,255]))),this._fallbackDepthStencilTexture},e}(),V=function(){function e(){this.reset()}return e.prototype.reset=function(){this.trianglesRendered=0,this.drawCallsInstanced=0,this.drawCallsAngleInstanced=0,this.drawCallsMerged=0,this.drawCallsPreinterleaved=0,this.drawCallsFragmented=0,this.drawCallsHighlight=0,this.instancesDrawnAngle=0,this.VBOallocatedSize=0,this.VBOoptimalSize=0,this.VBOusedSize=0},e}(),U=function(){return function(e,t,r,i,o,a,s,l){this.name=e,this.from=t,this.to=r,this.displayedIndexRange=i,this.transformation=o,this.instanceParameters=a,this.idx=s,this.dataId=l,null!=o&&(this.transformationNormal=n.mat4d.create(),n.mat4d.set(o,this.transformationNormal),n.mat4d.inverse(this.transformationNormal,this.transformationNormal),n.mat4d.transpose(this.transformationNormal,this.transformationNormal))}}();!function(e){e[e.Merged=0]="Merged",e[e.Instanced=1]="Instanced",e[e.Preinterleaved=2]="Preinterleaved"}(F||(F={}));var B={updatedDisplayedIndexRange:!1,begin:0,end:0},z=n.vec2d.create(),k=n.mat4d.identity(),G=n.mat4d.create(),H=n.mat4d.create();return j}.apply(null,n))||(e.exports=i)},737:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.applyToModelMatrix=function(e,t){var r=t,n=-e[0],i=-e[1],o=-e[2],a=r[3],s=r[7],l=r[11],u=r[15];r[0]+=a*n,r[1]+=a*i,r[2]+=a*o,r[4]+=s*n,r[5]+=s*i,r[6]+=s*o,r[8]+=l*n,r[9]+=l*i,r[10]+=l*o,r[12]+=u*n,r[13]+=u*i,r[14]+=u*o},t.applyToViewMatrix=function(e,t){var r=t,n=e[0],i=e[1],o=e[2];r[12]+=n*r[0]+i*r[4]+o*r[8],r[13]+=n*r[1]+i*r[5]+o*r[9],r[14]+=n*r[2]+i*r[6]+o*r[10],r[14]+=n*r[3]+i*r[7]+o*r[11]}}.apply(null,n))||(e.exports=i)},738:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(347),r(708),r(424)],void 0===(i=function(e,t,r,n,i){return function(e){function t(t,r,n,o,a){void 0===a&&(a=!1);var s=e.call(this,t,r)||this;return s.textureRep=n,s.textureId=o,s.initTransparent=a,s.glTextureRef=i.aquireIfNotUndefined(s.textureId,n,s.initTransparent),s}return r(t,e),t.prototype.dispose=function(){i.releaseIfNotUndefined(this.textureId,this.textureRep)},t.prototype.updateTexture=function(e){e!==this.textureId&&(i.releaseIfNotUndefined(this.textureId,this.textureRep),this.textureId=e,this.glTextureRef=i.aquireIfNotUndefined(this.textureId,this.textureRep,this.initTransparent))},t.prototype.renderTexture=function(e){var t=this.textureRep.getTexture(this.textureId);t&&t.dirty&&t.redraw&&t.redraw()},t.prototype.bindTexture=function(e,t){null!=this.glTextureRef&&(t.setUniform1i("tex",0),e.bindTexture(this.glTextureRef.getGLTexture()))},t.prototype.bindTextureSize=function(e,t){if(null!=this.glTextureRef){var r=this.glTextureRef.getGLTexture();t.setUniform2f("texSize",r.descriptor.width,r.descriptor.height)}},t}(n)}.apply(null,n))||(e.exports=i)},739:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){var r={origin:[0,0,0],basis1:[0,0,0],basis2:[0,0,0]};return function(){function e(){this._worldPlane=r}return Object.defineProperty(e.prototype,"plane",{get:function(){return this._worldPlane},set:function(e){this._worldPlane=e||r},enumerable:!0,configurable:!0}),e}()}.apply(null,n))||(e.exports=i)},746:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(338),r(336),r(340),r(374),r(337),r(804),r(664)],void 0===(i=function(e,t,r,n,i,o,a,s,l){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.slicePlaneEnabled=!1,t.supportsHeightUnitConversion=!1,t}return r(t,e),t.prototype.postscript=function(e){this.inherited(arguments),s.mayHaveHeightModelInfo(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())},t.prototype._validateHeightModelInfo=function(){var e=this;return i.create(function(t,r){o.whenFalseOnce(e.view.defaultsFromMap,"isHeightModelInfoSearching",function(){var n=s.rejectLayerError(e.layer,e.view.heightModelInfo,e.supportsHeightUnitConversion);n?r(n):t()})})},n([a.property()],t.prototype,"view",void 0),n([a.property()],t.prototype,"slicePlaneEnabled",void 0),n([a.subclass("esri.views.3d.layers.LayerView3D")],t)}(a.declared(l))}.apply(null,n))||(e.exports=i)},751:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++){var n=e[r],i=t[r];if(n.length!==i.length)return!1;for(var o=0;o<n.length;o++)if(n[o]!==i[o])return!1}return!0}function n(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!r(e[n],t[n]))return!1;return!0}function i(e,t){return e===t||e&&t&&e.equals(t)}function o(e,t){if(e===t)return!0;if(!e||!t)return!1;if(e.type!==t.type)return!1;switch(e.type){case"point":return function(e,t){return!!i(e.spatialReference,t.spatialReference)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.m===t.m}(e,t);case"extent":return function(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!i(e.spatialReference,t.spatialReference)&&e.xmin===t.xmin&&e.ymin===t.ymin&&e.zmin===t.zmin&&e.xmax===t.xmax&&e.ymax===t.ymax&&e.zmax===t.zmax}(e,t);case"polyline":return function(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!i(e.spatialReference,t.spatialReference)&&n(e.paths,t.paths)}(e,t);case"polygon":return function(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!i(e.spatialReference,t.spatialReference)&&n(e.rings,t.rings)}(e,t);case"multipoint":return function(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!i(e.spatialReference,t.spatialReference)&&r(e.points,t.points)}(e,t);case"mesh":return!1}}Object.defineProperty(t,"__esModule",{value:!0}),t.equals=function(e,t){return e===t||null!=e&&null!=t&&e.objectId===t.objectId&&!!o(e.geometry,t.geometry)&&!!function(e,t){if(e===t)return!0;if(!e||!t)return!1;for(var r in e)if(!(r in t)||e[r]!==t[r])return!1;for(var r in t)if(!(r in e))return!1;return!0}(e.attributes,t.attributes)}}.apply(null,n))||(e.exports=i)},753:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(345)],void 0===(i=function(e,t,r){function n(e){var t=o[e];if(t)return t;throw new Error("BufferType not supported in WebGL")}Object.defineProperty(t,"__esModule",{value:!0});var i={divisor:0,prefixA:!1};t.glLayout=function(e,t){void 0===t&&(t={}),t=r({},i,t);var o=e.stride;return e.fieldNames.filter(function(t){var r=e.fields.get(t).optional;return!(r&&r.glPadding)}).map(function(r){var i=e.fields.get(r),a=i.constructor.ElementCount,s=n(i.constructor.ElementType),l=i.offset,u=!(!i.optional||!i.optional.glNormalized);return{name:t.prefixA?function(e){return"a"+e[0].toUpperCase()+e.substr(1)}(r):r,stride:o,count:a,type:s,offset:l,normalized:u,divisor:t.divisor}})};var o={u8:5121,u16:5123,u32:5125,i8:5120,i16:5122,i32:5124,f32:5126}}.apply(null,n))||(e.exports=i)},754:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.unrolledCopyVec4=function(e,t){for(var r=e.typedBuffer,n=e.typedBufferStride,i=t.typedBuffer,o=t.typedBufferStride,a=t.count,s=0;s<a;s++){var l=s*n,u=s*o;r[l]=i[u],r[l+1]=i[u+1],r[l+2]=i[u+2],r[l+3]=i[u+3]}},t.unrolledCopyVec3=function(e,t){for(var r=e.typedBuffer,n=e.typedBufferStride,i=t.typedBuffer,o=t.typedBufferStride,a=t.count,s=0;s<a;s++){var l=s*n,u=s*o;r[l]=i[u],r[l+1]=i[u+1],r[l+2]=i[u+2]}},t.unrolledCopyVec2=function(e,t){for(var r=e.typedBuffer,n=e.typedBufferStride,i=t.typedBuffer,o=t.typedBufferStride,a=t.count,s=0;s<a;s++){var l=s*n,u=s*o;r[l]=i[u],r[l+1]=i[u+1]}},t.makeDenseSingle=function(e,t){var r=e.count;t||(t=new e.TypedArrayConstructor(r));for(var n=0;n<r;n++)t[n]=e.get(n);return t}}.apply(null,n))||(e.exports=i)},755:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(347),r(367),r(344),r(665),r(430),r(738),r(651),r(595),r(419),r(1009),r(349),r(672),r(424),r(867)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,c,d,p,f,h,m){function v(e,t){return void 0===t&&(t=S),e.textureIsSignedDistanceField?function(e,t,r){r[0]=e[0]*(t[2]-t[0])+t[0],r[1]=e[1]*(t[3]-t[1])+t[1]}(e.anchorPos,e.distanceFieldBoundingBox,t):i.vec2d.set(e.anchorPos,t),t}var g={"bottom-left":[0,0],bottom:[.5,0],"bottom-right":[1,0],left:[0,.5],center:[.5,.5],right:[1,.5],"top-left":[0,1],top:[.5,1],"top-right":[1,1]},y=function(e){function t(t,r){var n=e.call(this,r)||this;return n._textureDirty=!1,n.params=h.copyParameters(t,N),"string"==typeof n.params.anchorPos&&(n.params.anchorPos=g[n.params.anchorPos]),n.bufferWriter=new V(n),n}return r(t,e),t.prototype.dispose=function(){},t.prototype.getParameterValues=function(){return h.copyParameters(this.params)},t.prototype.setParameterValues=function(e){for(var t in e)"textureId"===t&&p.assert(!!this.params.textureId,"Can only change texture of material that already has a texture"),this.params[t]=e[t];this.notifyDirty("matChanged")},t.prototype.getParams=function(){return this.params},t.prototype.intersect=function(e,t,r,n,o,s,l,u){if(n.isSelection&&n.enableHUDSelection&&!a.isAllHidden(t.componentVisibilities,e.data.componentOffsets)){var c=e.data,f=this.params,h=1,m=1;if(i.mat4d.toMat3(r,A),u){var g=u(M);h=g[0],m=g[5],function(e){var t=e[0],r=e[1],n=e[2],i=e[3],o=e[4],a=e[5],s=e[6],l=e[7],u=e[8],c=1/Math.sqrt(t*t+r*r+n*n),d=1/Math.sqrt(i*i+o*o+a*a),p=1/Math.sqrt(s*s+l*l+u*u);e[0]=t*c,e[1]=r*c,e[2]=n*c,e[3]=i*d,e[4]=o*d,e[5]=a*d,e[6]=s*p,e[7]=l*p,e[8]=u*p}(A)}var y=c.getVertexAttr()[p.VertexAttrConstants.POSITION],b=c.getVertexAttr()[p.VertexAttrConstants.SIZE],_=c.getVertexAttr()[p.VertexAttrConstants.NORMAL];p.assert(y.size>=3);for(var x=n.point,S=n.camera,O=v(f),R=0;R<y.data.length/y.size;R++){var L=R*y.size;i.vec3d.set3(y.data[L],y.data[L+1],y.data[L+2],T),i.mat4d.multiplyVec3(r,T,T);var N=R*b.size;F[0]=b.data[N]*h,F[1]=b.data[N+1]*m,i.mat4d.multiplyVec3(S.viewMatrix,T);var j=R*_.size;if(i.vec3d.set3(_.data[j],_.data[j+1],_.data[j+2],E),this.applyVerticalOffsetTransformation(T,E,A,S,w),S.applyProjection(T,C),C[0]>-1){var V=Math.floor(C[0]),U=Math.floor(C[1]);d.applyPrecomputedScaleFactorVec2(F,w.factor,F);var B=V-D-(O[0]>0?F[0]*O[0]:0),z=B+F[0]+2*D,k=U-D-(O[1]>0?F[1]*O[1]:0),G=k+F[1]+2*D;if(f.textureIsSignedDistanceField){var H=f.outlineSize/2,q=f.distanceFieldBoundingBox;B+=F[0]*q[0],k+=F[1]*q[1],z-=F[0]*(1-q[2]),G-=F[1]*(1-q[3]),B-=H,z+=H,k-=H,G+=H}if(x[0]>B&&x[0]<z&&x[1]>k&&x[1]<G){var W=n.p0,X=n.p1;i.mat4d.multiplyVec3(i.mat4d.inverse(S.viewMatrix,I),T,P),C[0]=x[0],C[1]=x[1],S.unprojectPoint(C,T);var Q=i.vec3d.negate(n.getDirection(),i.vec3d.create());l(i.vec3d.dist(W,T)/i.vec3d.dist(W,X),Q,-1,1,!0,P)}}}}},t.prototype.normalAndViewAngle=function(e,t,r,n){return void 0===n&&(n=R),i.mat3d.multiplyVec3(t,e,n.normal),i.mat4d.multiplyVec3(r.viewInverseTransposeMatrix,n.normal),n.cosAngle=i.vec3d.dot(O,L),n},t.prototype.updateScaleInfo=function(e,t,r){var n=this.params;n.screenSizePerspective?e.factor=d.precomputeScaleFactor(R.cosAngle,r,n.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minPixelSize=0,e.factor.paddingPixels=0),n.screenSizePerspectiveAlignment?(e.scaleAlignment=d.precomputeScale(R.cosAngle,r,n.screenSizePerspectiveAlignment),e.minPixelSizeAlignment=n.screenSizePerspectiveAlignment.parameters.minPixelSize):(e.scaleAlignment=e.factor.scale,e.minPixelSizeAlignment=e.factor.minPixelSize)},t.prototype.applyVerticalOffsetTransformation=function(e,t,r,n,o,a){var s=this.params;if(16===r.length&&(r=i.mat4d.toMat3(r,A)),!s.verticalOffset||!s.verticalOffset.screenLength){if(o&&(s.screenSizePerspective||s.screenSizePerspectiveAlignment)){var l=this.normalAndViewAngle(t,r,n),u=i.vec3d.length(e);this.updateScaleInfo(o,l.cosAngle,u)}else o&&(o.factor.scale=1,o.scaleAlignment=1);return a?i.vec3d.set(e,a):e}var c=this.normalAndViewAngle(t,r,n),d=i.vec3d.length(e),p=s.screenSizePerspectiveAlignment||s.screenSizePerspective,f=h.verticalOffsetAtDistance(n,d,s.verticalOffset,c.cosAngle,p);return o&&this.updateScaleInfo(o,c.cosAngle,d),i.vec3d.add(e,i.vec3d.scale(c.normal,f),a)},t.prototype.getGLMaterials=function(){return{color:_,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:x}},t.prototype.getAllTextureIds=function(){return[this.params.textureId]},t.prototype.setTextureDirty=function(){this._textureDirty=!0},t.prototype.calculateRelativeScreenBounds=function(e,t,r){return void 0===r&&(r=n.create()),function(e,t,r,n){void 0===n&&(n=S),i.vec2d.set(e.anchorPos,n),n[0]*=-t[0],n[1]*=-t[1],n[0]+=e.screenOffset[0]*r,n[1]+=e.screenOffset[1]*r}(this.params,e,t,r),r[2]=r[0]+e[0],r[3]=r[1]+e[1],r},t.prototype.calculateAnchorPosForRendering=function(e){return v(this.params,e)},t.shouldRenderVisibilityDuringRenderPass=function(e){return e===u.MATERIAL||u.MATERIAL_HIGHLIGHT},t}(l),b=function(e){function t(t,r,n){var i=e.call(this,t,r,n,t.getParams().textureId)||this;return i.params=h.copyParameters(t.getParams()),i.selectProgram(),i.selectSlot(),i}return r(t,e),t.prototype.selectSlot=function(){this.mainSlot=this.params.drawInSecondSlot?c.HUDMATERIAL2:c.HUDMATERIAL1},t.prototype.beginSlot=function(e){return e===this.mainSlot},t.prototype.getProgram=function(){return this.program},t.prototype.updateParameters=function(){this.params=this.material.getParameterValues(),this.updateTexture(this.params.textureId),this.selectProgram(),this.selectSlot()},t.prototype.bindRender=function(e,t){var r=this.params,n=this.getProgram();this.bindTexture(e,n),n.setUniform1i("hudVisibilityTexture",1),e.bindTexture(t.hudVisibilityTexture,1),e.setActiveTexture(0),n.setUniform1f("uRenderTransparentlyOccludedHUD","occluded"===t.renderTransparentlyOccludedHUD?1:"notOccluded"===t.renderTransparentlyOccludedHUD?0:.75);var i=t.pixelRatio||1;n.setUniform4fv("overrideColor",r.color),n.setUniform1f("pixelRatio",i),r.textureIsSignedDistanceField&&(n.setUniform4fv("outlineColor",r.outlineColor),n.setUniform1f("outlineSize",r.outlineSize*i)),r.vvSizeEnabled&&(n.setUniform3fv("vvSizeMinSize",r.vvSizeMinSize),n.setUniform3fv("vvSizeMaxSize",r.vvSizeMaxSize),n.setUniform3fv("vvSizeOffset",r.vvSizeOffset),n.setUniform3fv("vvSizeFactor",r.vvSizeFactor)),r.vvColorEnabled&&(n.setUniform1fv("vvColorValues",r.vvColorValues),n.setUniform4fv("vvColorColors",r.vvColorColors)),n.setUniform2fv("texScale",r.texCoordScale),n.setUniform2f("screenOffset",2*r.screenOffset[0]*i,2*r.screenOffset[1]*i),n.setUniform2fv("anchorPos",v(r)),r.polygonOffset&&(e.setPolygonOffsetFillEnabled(!0),e.setPolygonOffset(0,-4)),e.setBlendingEnabled(!0),e.setBlendFunction(1,771)},t.prototype.bindProjection=function(e,t){this.material._textureDirty&&(this.renderTexture(e),this.material._textureDirty=!1);var r=t.cameraAboveGround?1:-1,n=this.getProgram(),i=this.params;e.bindProgram(n),n.setUniform1f("cameraGroundRelative",r),n.setUniform1f("polygonOffset",i.shaderPolygonOffset),n.setUniform4fv("viewport",t.viewport),h.bindVerticalOffset(i.verticalOffset,t,n),n.setUniformMatrix4fv("viewNormal",t.viewInvTransp),i.screenSizePerspective&&(h.bindScreenSizePerspective(i.screenSizePerspective,t,n,"screenSizePerspective"),h.bindScreenSizePerspective(i.screenSizePerspectiveAlignment||i.screenSizePerspective,t,n,"screenSizePerspectiveAlignment"))},t.prototype.releaseRender=function(e){e.setPolygonOffsetFillEnabled(!1),e.setBlendFunction(770,771),e.setBlendingEnabled(!1)},t.prototype.bindView=function(e,t){var r=t.origin,n=this.getProgram();h.bindView(r,t.view,n),h.bindCamPos(r,t.viewInvTransp,n)},t.prototype.bindInstance=function(e,t){var r=this.getProgram();r.setUniformMatrix4fv("model",t.transformation),r.setUniformMatrix4fv("modelNormal",t.transformationNormal)},t.prototype.getDrawMode=function(e){return 4},t}(s),_=function(e){function t(t,r,n){var i=e.call(this,t,r,n)||this;return i.isOcclusionSlot=!1,i}return r(t,e),t.prototype.selectProgram=function(){var e=this.params;this.programOcclusionTestPixel=this.programRep.getProgram(m.occlusionPass,{verticalOffset:!!e.verticalOffset,screenSizePerspective:!!e.screenSizePerspective,centerOffsetUnitsScreen:"screen"===e.centerOffsetUnits,slice:e.slicePlaneEnabled}),this.program=this.programRep.getProgram(m.colorPass,{occlTest:e.occlusionTest,sdf:e.textureIsSignedDistanceField,vvSize:!!e.vvSizeEnabled,vvColor:!!e.vvColorEnabled,verticalOffset:!!e.verticalOffset,screenSizePerspective:!!e.screenSizePerspective,centerOffsetUnitsScreen:"screen"===e.centerOffsetUnits,debugDrawBorder:!!e.debugDrawBorder})},t.prototype.getDrawMode=function(e){return this.isOcclusionSlot?0:4},t.prototype.release=function(e){e.setDepthFunction(513),this.isOcclusionSlot||this.releaseRender(e)},t.prototype.bind=function(e,t){this.bindProjection(e,t);var r=this.getProgram();if(e.setDepthTestEnabled(!0),e.setDepthFunction(515),this.isOcclusionSlot){r.setUniform4f("color",1,1,1,1);var n=t.pixelRatio||1;r.setUniform1f("pixelRatio",n)}else this.bindRender(e,t),this.bindTexture(e,r)},t.prototype.bindView=function(t,r){e.prototype.bindView.call(this,t,r);var n=this.getProgram(),i=this.params;this.isOcclusionSlot&&i.slicePlaneEnabled&&h.bindSlicePlane(r.origin,r.slicePlane,n)},t.prototype.getProgram=function(){return this.isOcclusionSlot?this.programOcclusionTestPixel:this.program},t.prototype.getPrograms=function(){return[this.programOcclusionTestPixel,this.program]},t.prototype.beginSlot=function(e){return this.params.occlusionTest?(this.isOcclusionSlot=e===c.OCCLUSION_PIXELS,e===c.OCCLUSION_PIXELS||e===this.mainSlot):(this.isOcclusionSlot=!1,e===this.mainSlot)},t}(b),x=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.selectProgram=function(){var e=this.params;this.program=this.programRep.getProgram(m.highlightPass,{occlTest:e.occlusionTest,sdf:e.textureIsSignedDistanceField,vvSize:!!e.vvSizeEnabled,vvColor:!!e.vvColorEnabled,verticalOffset:!!e.verticalOffset,screenSizePerspective:!!e.screenSizePerspective,centerOffsetUnitsScreen:"screen"===e.centerOffsetUnits,binaryHighlightOcclusion:e.binaryHighlightOcclusion})},t.prototype.bind=function(e,t){this.bindProjection(e,t),this.bindRender(e,t)},t.prototype.release=function(e){this.releaseRender(e)},t}(b),w={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},scaleAlignment:0,minPixelSizeAlignment:0},S=[0,0],T=i.vec3d.create(),E=i.vec3d.create(),C=i.vec3d.create(),O=i.vec3d.create(),P=i.vec3d.create(),A=i.mat3d.create(),I=i.mat4d.create(),R={normal:O,cosAngle:0},M=i.mat4d.create();i.mat4d.identity(M);var D=1,F=[0,0],L=[0,0,1],N={texCoordScale:[1,1],occlusionTest:!0,binaryHighlightOcclusion:!0,drawInSecondSlot:!1,color:[1,1,1,1],outlineColor:[1,1,1,1],outlineSize:0,textureIsSignedDistanceField:!1,distanceFieldBoundingBox:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],screenOffset:[0,0],verticalOffset:null,screenSizePerspective:null,screenSizePerspectiveAlignment:null,slicePlaneEnabled:!1,anchorPos:g.center,shaderPolygonOffset:1e-5,polygonOffset:!1,textureId:null,centerOffsetUnits:"world",debugDrawBorder:!1},j=o.newLayout().vec3f(p.VertexAttrConstants.POSITION).vec3f(p.VertexAttrConstants.NORMAL).vec2f(p.VertexAttrConstants.UV0).vec4u8(p.VertexAttrConstants.COLOR).vec2f(p.VertexAttrConstants.SIZE).vec4f(p.VertexAttrConstants.AUXPOS1).vec4f(p.VertexAttrConstants.AUXPOS2),V=function(){function e(e){this.material=e,this.vertexBufferLayout=j}return e.prototype.allocate=function(e){return this.vertexBufferLayout.createBuffer(e)},e.prototype.elementCount=function(e){return 6*e.indices[p.VertexAttrConstants.POSITION].length},e.prototype.write=function(e,t,r,n,i){var o=this.material.getParameterValues();f.writePosition(t.indices[p.VertexAttrConstants.POSITION],t.vertexAttr[p.VertexAttrConstants.POSITION].data,e.transformation,n.position,i,6),f.writeNormal(t.indices[p.VertexAttrConstants.NORMAL],t.vertexAttr[p.VertexAttrConstants.NORMAL].data,e.invTranspTransformation,n.normal,i,6);var a=t.vertexAttr[p.VertexAttrConstants.UV0].data,s=void 0,l=void 0,u=void 0,c=void 0;null==a||a.length<4?(s=0,l=0,u=o.texCoordScale[0],c=o.texCoordScale[1]):(s=a[0],l=a[1],u=a[2],c=a[3]),u=Math.min(1.99999,u+1),c=Math.min(1.99999,c+1);for(var d=t.indices[p.VertexAttrConstants.POSITION].length,h=n.uv0,m=i,v=0;v<d;++v)h.set(m,0,s),h.set(m,1,l),m+=1,h.set(m,0,u),h.set(m,1,l),m+=1,h.set(m,0,u),h.set(m,1,c),m+=1,h.set(m,0,u),h.set(m,1,c),m+=1,h.set(m,0,s),h.set(m,1,c),m+=1,h.set(m,0,s),h.set(m,1,l),m+=1;f.writeColor(t.indices[p.VertexAttrConstants.COLOR],t.vertexAttr[p.VertexAttrConstants.COLOR].data,4,n.color,i,6);var g=t.indices[p.VertexAttrConstants.SIZE],y=t.vertexAttr[p.VertexAttrConstants.SIZE].data,b=g.length,_=n.size;for(m=i,v=0;v<b;++v)for(var x=y[2*g[v]],w=y[2*g[v]+1],S=0;S<6;++S)_.set(m,0,x),_.set(m,1,w),m+=1;t.indices[p.VertexAttrConstants.AUXPOS1]&&t.vertexAttr[p.VertexAttrConstants.AUXPOS1]&&f.writeBufferVec4(t.indices[p.VertexAttrConstants.AUXPOS1],t.vertexAttr[p.VertexAttrConstants.AUXPOS1].data,n.auxpos1,i,6),t.indices[p.VertexAttrConstants.AUXPOS2]&&t.vertexAttr[p.VertexAttrConstants.AUXPOS2]&&f.writeBufferVec4(t.indices[p.VertexAttrConstants.AUXPOS2],t.vertexAttr[p.VertexAttrConstants.AUXPOS2].data,n.auxpos2,i,6)},e}();return y}.apply(null,n))||(e.exports=i)},773:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(e){return e&&"upperLeft"===e.originPosition}function n(e,t){var r=e.scale,n=e.translate;return Math.round((t-n[0])/r[0])}function i(e,t){var r=e.scale,n=e.translate;return Math.round((n[1]-t)/r[1])}function o(e,t,r){for(var o,a,s,l,u=[],c=0;c<r.length;c++){var d=r[c];c>0?(s=n(e,d[0]),l=i(e,d[1]),s===o&&l===a||(u.push(t(d,s-o,l-a)),o=s,a=l)):(o=n(e,d[0]),a=i(e,d[1]),u.push(t(d,o,a)))}return u.length>0?u:null}function a(e,t,r,n){return o(e,r?n?_:b:n?b:y,t)}function s(e,t,r,n){for(var i=[],a=r?n?_:b:n?b:y,s=0;s<t.length;s++){var l=o(e,a,t[s]);l&&l.length>=3&&i.push(l)}return i.length?i:null}function l(e,t,r,n){for(var i=[],a=r?n?_:b:n?b:y,s=0;s<t.length;s++){var l=o(e,a,t[s]);l&&l.length>=2&&i.push(l)}return i.length?i:null}function u(e,t){var r=e.scale,n=e.translate;return t*r[0]+n[0]}function c(e,t){var r=e.scale;return e.translate[1]-t*r[1]}function d(e,t,r){var n=new Array(r.length);if(!r.length)return n;var i=e.scale,o=i[0],a=i[1],s=u(e,r[0][0]),l=c(e,r[0][1]);n[0]=t(r[0],s,l);for(var d=1;d<r.length;d++){var p=r[d];s+=p[0]*o,l-=p[1]*a,n[d]=t(p,s,l)}return n}function p(e,t,r){for(var n=new Array(r.length),i=0;i<r.length;i++)n[i]=d(e,t,r[i]);return n}function f(e,t,r,n){return d(e,r?n?_:b:n?b:y,t)}function h(e,t,r,n){return p(e,r?n?_:b:n?b:y,t)}function m(e,t,r,n){return p(e,r?n?_:b:n?b:y,t)}function v(e,t,r){for(var n=r[0],i=n[0],o=n[1],a=Math.min(i,t[0]),s=Math.min(o,t[1]),l=Math.max(i,t[2]),u=Math.max(o,t[3]),c=1;c<r.length;c++){var d=r[c],p=d[0],f=d[1];i+=p,o+=f,p<0&&(a=Math.min(a,i)),p>0&&(l=Math.max(l,i)),f<0?s=Math.min(s,o):f>0&&(u=Math.max(u,o))}return e[0]=a,e[1]=s,e[2]=l,e[3]=u,e}function g(e,t){if(!t.length)return null;e[0]=e[1]=Number.POSITIVE_INFINITY,e[2]=e[3]=Number.NEGATIVE_INFINITY;for(var r=0;r<t.length;r++)v(e,e,t[r]);return e}Object.defineProperty(t,"__esModule",{value:!0});var y=function(e,t,r){return[t,r]},b=function(e,t,r){return[t,r,e[2]]},_=function(e,t,r){return[t,r,e[2],e[3]]};t.toTransform=function(e){return e?{originPosition:"upperLeft",scale:[e.tolerance,e.tolerance],translate:[e.extent.xmin,e.extent.ymax]}:null},t.equals=function(e,t){return e===t||null==e&&null==t||null!=e&&null!=t&&(r(e)?(n=e.translate[0],i=e.translate[1],o=e.scale[0]):(n=e.extent.xmin,i=e.extent.ymax,o=e.tolerance),r(t)?(a=t.translate[0],s=t.translate[1],l=t.scale[0]):(a=t.extent.xmin,s=t.extent.ymax,l=t.tolerance),n===a&&i===s&&o===l);var n,i,o,a,s,l},t.quantizeX=n,t.quantizeY=i,t.quantizeBounds=function(e,t,r){return t[0]=n(e,r[0]),t[3]=i(e,r[1]),t[2]=n(e,r[2]),t[1]=i(e,r[3]),t},t.quantizePoints=a,t.quantizeRings=s,t.quantizePaths=l,t.hydrateX=u,t.hydrateY=c,t.hydrateCoordsArray=d,t.hydrateCoordsArrayArray=p,t.hydrateBounds=function(e,t,r){return r?(t[0]=u(e,r[0]),t[1]=c(e,r[3]),t[2]=u(e,r[2]),t[3]=c(e,r[1]),t):[u(e,t[0]),c(e,t[3]),u(e,t[2]),c(e,t[1])]},t.hydratePoints=f,t.hydratePaths=h,t.hydrateRings=m,t.getQuantizedBoundsCoordsArray=v,t.getQuantizedBoundsCoordsArrayArray=g,t.getQuantizedBoundsPoints=function(e){var t=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];return v(t,t,e)},t.getQuantizedBoundsPaths=function(e){return g([0,0,0,0],e)},t.getQuantizedBoundsRings=function(e){return g([0,0,0,0],e)},t.quantizeExtent=function(e,t,r,o,a){return t.xmin=n(e,r.xmin),t.ymin=i(e,r.ymin),t.xmax=n(e,r.xmax),t.ymax=i(e,r.ymax),t!==r&&(o&&(t.zmin=r.zmin,t.zmax=r.zmax),a&&(t.mmin=r.mmin,t.mmax=r.mmax)),t},t.quantizeMultipoint=function(e,t,r,n,i){return t.points=a(e,r.points,n,i),t},t.quantizePoint=function(e,t,r,o,a){return t.x=n(e,r.x),t.y=i(e,r.y),t!==r&&(o&&(t.z=r.z),a&&(t.m=r.m)),t},t.quantizePolygon=function(e,t,r,n,i){var o=s(e,r.rings,n,i);return o?(t.rings=o,t):null},t.quantizePolyline=function(e,t,r,n,i){var o=l(e,r.paths,n,i);return o?(t.paths=o,t):null},t.hydrateExtent=function(e,t,r,n,i){return t.xmin=u(e,r.xmin),t.ymin=c(e,r.ymin),t.xmax=u(e,r.xmax),t.ymax=c(e,r.ymax),t!==r&&(n&&(t.zmin=r.zmin,t.zmax=r.zmax),i&&(t.mmin=r.mmin,t.mmax=r.mmax)),t},t.hydrateMultipoint=function(e,t,r,n,i){return t.points=f(e,r.points,n,i),t},t.hydratePoint=function(e,t,r,n,i){return t.x=u(e,r.x),t.y=c(e,r.y),t!==r&&(n&&(t.z=r.z),i&&(t.m=r.m)),t},t.hydratePolygon=function(e,t,r,n,i){return t.rings=m(e,r.rings,n,i),t},t.hydratePolyline=function(e,t,r,n,i){return t.paths=h(e,r.paths,n,i),t}}.apply(null,n))||(e.exports=i)},776:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.updatingPercentageValue={value:100,readOnly:!0},t.updatingPercentage={dependsOn:["updating","updatingPercentageValue"],readOnly:!0,value:0,get:function(){return this.updating?this.updatingPercentageValue:0}}}.apply(null,n))||(e.exports=i)},778:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return window.WebGL2RenderingContext&&e instanceof window.WebGL2RenderingContext}}.apply(null,n))||(e.exports=i)},779:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(389),r(344),r(1053),r(622)],void 0===(i=function(e,t,r,n,i,o){function a(e,t,r){return{center:n.vec3d.createFrom(e[0],e[1],e[2]),halfSize:n.vec3.createFrom(t[0],t[1],t[2]),quaternion:n.quat4.createFrom(r[0],r[1],r[2],r[3])}}function s(e,t){var r=o.plane.distance(t,e.center),n=l(e,t);return r>n?1:r<-n?-1:0}function l(e,t){n.quat4.conjugate(e.quaternion,u),n.quat4d.multiplyVec3(u,t,c);var r=e.halfSize;return Math.abs(c[0]*r[0])+Math.abs(c[1]*r[1])+Math.abs(c[2]*r[2])}Object.defineProperty(t,"__esModule",{value:!0});var u=n.quat4.create(),c=n.vec3.create(),d=n.vec3.create(),p=n.mat3.create(),f=function(){return function(e){var t=56*e;this.buffer=new ArrayBuffer(t),this.obbs=new Array(e);for(var r=0;r<e;r++)this.obbs[r]={center:new Float64Array(this.buffer,56*r+0,3),halfSize:new Float32Array(this.buffer,56*r+24,3),quaternion:new Float32Array(this.buffer,56*r+36,4)}}}();t.ObbArray=f,t.create=a,t.clone=function(e){return a(e.center,e.halfSize,e.quaternion)},t.set=function(e,t){n.vec3d.set(e.center,t.center),n.vec3.set(e.halfSize,t.halfSize),n.quat4.set(e.quaternion,t.quaternion)},t.compute=function(e,t){return t||(t=a([0,0,0],[-1,-1,-1],[0,0,0,1])),i.computeOBB(e,t),t},t.intersectPlane=s,t.toAaBoundingBox=function(e,t){t||(t=r.create());var i=n.quat4.toMat3(e.quaternion,p),o=e.halfSize[0]*Math.abs(i[0])+e.halfSize[1]*Math.abs(i[3])+e.halfSize[2]*Math.abs(i[6]),a=e.halfSize[0]*Math.abs(i[1])+e.halfSize[1]*Math.abs(i[4])+e.halfSize[2]*Math.abs(i[7]),s=e.halfSize[0]*Math.abs(i[2])+e.halfSize[1]*Math.abs(i[5])+e.halfSize[2]*Math.abs(i[8]);return t[0]=e.center[0]-o,t[1]=e.center[1]-a,t[2]=e.center[2]-s,t[3]=e.center[0]+o,t[4]=e.center[1]+a,t[5]=e.center[2]+s,t},t.minimumDistancePlane=function(e,t){return o.plane.distance(t,e.center)-l(e,t)},t.maximumDistancePlane=function(e,t){return o.plane.distance(t,e.center)+l(e,t)},t.isVisible=function(e,t){return s(e,t[0])<=0&&s(e,t[1])<=0&&s(e,t[2])<=0&&s(e,t[3])<=0&&s(e,t[4])<=0&&s(e,t[5])<=0},t.intersectLine=function(e,t,r,i){void 0===i&&(i=0),n.quat4.conjugate(e.quaternion,u),n.vec3d.subtract(t,e.center,c);for(var o=n.quat4d.multiplyVec3(u,c,c),a=n.quat4d.multiplyVec3(u,r,d),s=-1/0,l=1/0,p=0;p<3;p++)if(Math.abs(a[p])>1e-6){var f=(i+e.halfSize[p]-o[p])/a[p],h=(-i-e.halfSize[p]-o[p])/a[p];s=Math.max(s,Math.min(f,h)),l=Math.min(l,Math.max(f,h))}else if(o[p]>e.halfSize[p]+i||o[p]<-e.halfSize[p]-i)return!1;return s<=l}}.apply(null,n))||(e.exports=i)},780:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(351),r(342),r(340),r(350),r(360),r(383),r(649),r(418),r(794),r(388),r(631)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,c,d,p){function f(e){return e&&parseInt(e.substring(e.lastIndexOf("/")+1,e.length),10)}function h(e,t){var r,n=t[0],i=t[1],o=t[2],a=t[3],s=0;n<e[0]&&(s+=(r=e[0]-n)*r);i<e[1]&&(s+=(r=e[1]-i)*r);o<e[2]&&(s+=(r=e[2]-o)*r);n>e[3]&&(s+=(r=n-e[3])*r);i>e[4]&&(s+=(r=i-e[4])*r);o>e[5]&&(s+=(r=o-e[5])*r);if(s>a*a)return 0;if(s>0)return 1;var l=1/0;return n-e[0]<l&&(l=n-e[0]),i-e[1]<l&&(l=i-e[1]),o-e[2]<l&&(l=o-e[2]),e[3]-n<l&&(l=e[3]-n),e[4]-i<l&&(l=e[4]-i),e[5]-o<l&&(l=e[5]-o),l>a?2:1}function m(e,t,r){for(var n=[],i=r&&r.missingFields,o=r&&r.originalFields,a=0,s=e;a<s.length;a++){for(var l=s[a],u=l.toLowerCase(),c=!1,d=0,p=t;d<p.length;d++){var f=p[d];if(u===f.name.toLowerCase()){n.push(f.name),c=!0,o&&o.push(l);break}}!c&&i&&i.push(l)}return n}function v(e,t,r){if(null!=e.maxRecordCount&&t.length>e.maxRecordCount){var o=function(e,t){for(var r=e.length,n=Math.ceil(r/t),i=[],o=0;o<n;o++){var a=Math.floor(r*o/n),s=Math.floor(r*(o+1)/n);i.push(e.slice(a,s))}return i}(t,e.maxRecordCount);return i.all(o.map(function(t){return v(e,t,r)})).then(b)}var a=new u({objectIds:t,outFields:r,orderByFields:[e.objectIdField]});return new l(e.parsedUrl.path).execute(a).then(function(e){return e&&e.features&&e.features.length===t.length?e.features.map(function(e){return e.attributes}):i.reject(new n("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer"))})}function g(e,t,a,s,l){for(var u=[],d=0;d<t.attributeData.length;d++){var p=t.attributeData[d],f=e[d];if(f&&-1!==s.indexOf(f.name)){var h=o.makeAbsolute(p.href,t.baseUrl);u.push({url:h,storageInfo:f})}}return i.eachAlways(u.map(function(e){return r(e.url,{responseType:"array-buffer"}).then(function(t){return c.readBinaryAttribute(e.storageInfo,t.data)})})).then(function(e){var t=[];if(!l.ignoreUnavailableFields&&e.some(function(e){return null==e.value})){for(var r=[],o=0;o<e.length;o++)null==e[o].value&&r.push({name:u[o].storageInfo.name,error:e[o].error});return i.reject(new n("scenelayer:attribute-request-failed","Request for scene layer attributes failed",{failedAttributes:r}))}for(var s=0,c=a;s<c.length;s++){var d=c[s],p={};for(o=0;o<e.length;o++)null!=e[o].value&&(p[u[o].storageInfo.name]=y(e[o].value,d));t.push(p)}return t})}function y(e,t){var r=e[t];return p.isInt16Array(e)?r===C?null:r:p.isInt32Array(e)?r===O?null:r:r!=r?null:r}function b(e){for(var t=[],r=0,n=e;r<n.length;r++){var i=n[r];t=t.concat(i)}return t}function _(e){var t=new a(f(e.store.indexCRS||e.store.geographicCRS));return t.equals(e.spatialReference)?e.spatialReference:t}function x(e){var t=new a(f(e.store.vertexCRS||e.store.projectedCRS));return t.equals(e.spatialReference)?e.spatialReference:t}function w(e,t,r){if(!s.canProject(e,t))throw new n("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if("local"===r&&e.isGeographic)throw new n("layerview:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes",{})}function S(e,t,r){var n=_(e),i=x(e);w(n,t,r),w(i,t,r)}function T(e){return"mesh-3d"===e.type}Object.defineProperty(t,"__esModule",{value:!0}),t.DDS_ENCODING_STRING="image/vnd-ms.dds",t.BROWSER_SUPPORTED_IMAGE_ENCODING_STRINGS=["image/jpeg","image/png"],t.extractWkid=f,t.getAppropriateTextureEncoding=function(e,r){if(Array.isArray(e)){if(r){var n=e.indexOf(t.DDS_ENCODING_STRING);if(n>-1)return n}for(var i=0;i<e.length;i++)if(t.BROWSER_SUPPORTED_IMAGE_ENCODING_STRINGS.indexOf(e[i])>-1)return i;throw new Error("Could not find appropriate texture encoding (among "+e.toString()+")")}return-1},t.findIntersectingNodes=function e(t,r,n,i,o,a){if(null!=n){var s=n.mbs;if(r!==i&&(s=E,d.mbsToMbs(n.mbs,i,s,r)),0!==h(t,s)&&(a(n),n.children))for(var l=0;l<n.children.length;++l)e(t,r,o[n.children[l].id],i,o,a)}},t.buildTopNodeMap=function(e,t,r,n){if(void 0===n&&(n=Number.POSITIVE_INFINITY),t<=0)e.clear();else{var i=new Map,o=Number.POSITIVE_INFINITY;e.forEach(function(a,s){var l=r(a);if(s<t)return o=Math.min(o,l),void i.set(a.id,l);if(!(l<=o||l>=n)){i.set(a.id,l);for(var u=o=i.get(e.front().id),c=0,d=1;d<t;++d){var p=e.data[d],f=i.get(p.id);f<o&&(c=d,u=o,o=f)}e.data[c]=a,o=u}}),e.length=Math.min(e.length,t),e.sort(function(e,t){return i.get(t.id)-i.get(e.id)})}};var E=[0,0,0,0];t.intersectBoundingBoxWithMbs=h,t.findFieldsCaseInsensitive=m,t.whenGraphicAttributes=function(e,t,r,o,a,s){var l=!0===(s&&s.populateObjectId),u=s.ignoreUnavailableFields?void 0:[],c=1===o.length&&"*"===o[0];!c&&l&&(o=function(e,t){return e.filter(function(e){return e.toLowerCase()!==t.toLowerCase()}).concat([t])}(o,r));var d=c?o:m(o,e.fields,{missingFields:u});if(u&&0!==u.length)return i.reject(new n("scenelayer:unknown-fields","This scene layer does not have the requested fields",{unknownFields:u}));if(0===t.length)return i.resolve(t);var p=e.associatedLayer,f=e.attributeStorageInfo,h=c?e.fields.map(function(e){return e.name}):d;if(p)return function(e,t,r,n){t.sort(function(e,t){return e.attributes[r]-t.attributes[r]});var i=t.map(function(e){return e.attributes[r]}),o=[],a=m(n,e.fields,{originalFields:o});return v(e,i,a).then(function(e){for(var r=0;r<t.length;r++){var n=t[r],i=e[r];n.attributes={};for(var s=0;s<o.length;s++)n.attributes[o[s]]=i[a[s]]}return t})}(p,t,r,h);var y=function(e,t){for(var r=[],n=0,i=e;n<i.length;n++){var o=i[n];o in t.attributes||r.push(o)}return r}(h,t[0]);if(0===y.length)return i.resolve(t);if(f){var b=a();return null==b?i.reject(new n("scenelayer:feature-not-loaded","Tried to query attributes for unloaded features")):g(f,b.node,b.indices,y,s).then(function(e){for(var r=0;r<t.length;r++){for(var n=0,i=h;n<i.length;n++){var o=i[n];o in e[r]||(e[r][o]=t[r].attributes[o])}t[r].attributes=e[r]}return t})}return i.reject(new n("scenelayer:no-attribute-source","This scene layer does not have a source for attributes available"))};var C=-Math.pow(2,15),O=-Math.pow(2,31);t.getCachedAttributeValue=y,t.convertFlatRangesToOffsets=function(e,t,r){void 0===r&&(r=2);for(var i=null!=t?t:e.length/r,o=new Uint32Array(i+1),a=0;a<i;a++){var s=e[a*r],l=3*s;o[a]=l;var u=(a-1)*r+1;if(u>=0&&s-1!==e[u])throw new n("Face ranges are not continuous")}var c=3*(e[(i-1)*r+1]+1);return o[o.length-1]=c,o},t.getIndexCrs=_,t.getVertexCrs=x,t.getCacheKeySuffix=function(e,t){return t===d.SphericalECEFSpatialReference?"@ECEF":e.equals(t)?"":null!=t.wkid?"@"+t.wkid:null},t.checkSpatialReference=w,t.checkSpatialReferences=S,t.checkSceneLayerValid=function(e){if(null==e.store||null==e.store.defaultGeometrySchema||!function(e){return!(null!=e.geometryType&&"triangles"!==e.geometryType||null!=e.topology&&"PerAttributeArray"!==e.topology||null==e.vertexAttributes||null==e.vertexAttributes.position)}(e.store.defaultGeometrySchema))throw new n("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{})},t.checkSceneLayerCompatibleWithView=function(e,t){S(e,t.spatialReference,t.viewingMode)},t.checkPointCloudLayerValid=function(e){if(null==e.store||null==e.store.defaultGeometrySchema||!function(e){return!(null==e.geometryType||"points"!==e.geometryType||null!=e.topology&&"PerAttributeArray"!==e.topology||null!=e.encoding&&""!==e.encoding&&"lepcc-xyz"!==e.encoding||null==e.vertexAttributes||null==e.vertexAttributes.position)}(e.store.defaultGeometrySchema))throw new n("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{})},t.checkPointCloudLayerCompatibleWithView=function(e,t){w(e.spatialReference,t.spatialReference,t.viewingMode)},t.rendererNeedsTextures=function(e){if(null==e||!function(e){return"simple"===e.type||"class-breaks"===e.type||"unique-value"===e.type}(e))return!0;if(("unique-value"===e.type||"class-breaks"===e.type)&&null==e.defaultSymbol)return!0;var t=e.getSymbols();if(0===t.length)return!0;for(var r=0,n=t;r<n.length;r++){var i=n[r];if(!T(i)||0===i.symbolLayers.length)return!0;for(var o=0,a=i.symbolLayers.items;o<a.length;o++){var s=a[o];if("fill"!==s.type||null==s.material||"replace"!==s.material.colorMixMode)return!0}}return!1};var P=function(){return function(){this.edges=null,this.material=null}}();t.SymbolInfo=P,t.getSymbolInfo=function(e){for(var t=new P,r=!1,n=!1,i=0,o=e.symbolLayers.items;i<o.length;i++){var a=o[i];if("fill"===a.type&&a.enabled){var s=a.material,l=a.edges;if(s&&!r){var u=s.color;t.material={color:u?[u.r/255,u.g/255,u.b/255]:null,alpha:u?u.a:null,colorMixMode:s.colorMixMode},r=!0}l&&!n&&(t.edges=a.edges,n=!0)}}return t}}.apply(null,n))||(e.exports=i)},788:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(345),r(338),r(336),r(433),r(667),r(351),r(342),r(343),r(340),r(350),r(337),r(445),r(395),r(331),r(399),r(1069),r(432),r(432),r(457),r(660),r(396),r(451),r(429),r(663),r(1481),r(691),r(421),r(633),r(606),r(732),r(418)],void 0===(i=function(e,t,n,i,o,a,s,l,u,c,d,p,f,h,m,v,g,y,b,_,x,w,S,T,E,C,O,P,A,I,R,M,D){function F(e,t,r){return e&&((e=A.read(e,t,r)||void 0)||N.error("Failed to create renderer",{rendererDefinition:e,layer:this,context:r})),e}var L=["3DObject","Point"],N=c.getLogger("esri.layers.SceneLayer"),j=function(e){function t(t,r){var n=e.call(this)||this;return n.featureReduction=null,n.rangeInfos=null,n.operationalLayerType="ArcGISSceneServiceLayer",n.type="scene",n.fields=[],n.definitionExpression=null,n.labelsVisible=!0,n.labelingInfo=null,n.legendEnabled=!0,n.cachedDrawingInfo={color:!1},n.popupEnabled=!0,n.popupTemplate=null,n.objectIdField=null,n.objectIdFilter=null,n._fieldUsageInfo={},n.screenSizePerspectiveEnabled=!0,n}return i(t,e),t.prototype.normalizeCtorArgs=function(e,t){return"string"==typeof e?n({url:e},t):e},t.prototype.getField=function(e){return T.getField(e,this.fields)},Object.defineProperty(t.prototype,"elevationInfo",{set:function(e){this._set("elevationInfo",e),this.loaded&&this._validateElevationInfo()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"geometryType",{get:function(){return U[this.profile]||"mesh"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderer",{set:function(e){T.fixRendererFields(e,this.fields),this._set("renderer",e)},enumerable:!0,configurable:!0}),t.prototype.readCachedDrawingInfo=function(e,t){return null!=e&&"object"==typeof e||(e={}),null==e.color&&(e.color=!1),e},t.prototype.readObjectIdField=function(e,t){return!e&&t.fields&&t.fields.some(function(t){return"esriFieldTypeOID"===t.type&&(e=t.name),!!e}),e||void 0},t.prototype.readProfile=function(e,t){var r=t.store.profile;return null!=r&&V[r]?V[r]:(N.error("Unknown or missing profile",{profile:r,layer:this}),"mesh-pyramids")},t.prototype.readNormalReferenceFrame=function(e,t){return t.store.normalReferenceFrame},t.prototype.load=function(){var e=this,t=this.loadFromPortal({supportedTypes:["Scene Service"]}).always(function(){return e._fetchService()}).then(function(){return a([e._verifyRootNodeAndUpdateExtent(),e._setCompanionFeatureLayer()])}).then(function(){return e._validateElevationInfo()}).then(function(){return e._applyCompanionOverrides()}).then(function(){return e._populateFieldUsageInfo()}).then(function(){return I.loadStyleRenderer(e,{origin:"service"})}).then(function(){return T.fixRendererFields(e.renderer,e.fields)});return this.addResolvingPromise(t),this.when()},t.prototype.createLayerView=function(e){var t=this;return(null==this.profile||"mesh-pyramids"===this.profile?d.create(function(e){return Promise.all([r.e(4),r.e(6),r.e(8),r.e(7),r.e(67)]).then(function(){var t=[r(1296)];e.apply(null,t)}.bind(this)).catch(r.oe)}):d.create(function(e){return Promise.all([r.e(4),r.e(6),r.e(8),r.e(7),r.e(58)]).then(function(){var t=[r(1655)];e.apply(null,t)}.bind(this)).catch(r.oe)})).then(function(r){return new r({view:e,layer:t})})},t.prototype.createQuery=function(){var e=new D;return"mesh"!==this.geometryType&&(e.returnGeometry=!0,e.returnZ=!0),e.where=this.definitionExpression||"1=1",e.sqlFormat="standard",e},t.prototype.queryExtent=function(e){var t=this;return this._getAssociatedLayerForQuery().then(function(r){return r.queryExtent(e||t.createQuery())})},t.prototype.queryFeatureCount=function(e){var t=this;return this._getAssociatedLayerForQuery().then(function(r){return r.queryFeatureCount(e||t.createQuery())})},t.prototype.queryFeatures=function(e){var t=this;return this._getAssociatedLayerForQuery().then(function(r){return r.queryFeatures(e||t.createQuery())}).then(function(e){if(e&&e.features)for(var r=0,n=e.features;r<n.length;r++){var i=n[r];i.layer=t,i.sourceLayer=t}return e})},t.prototype.queryFeaturesJSON=function(e){var t=this;return this._getAssociatedLayerForQuery().then(function(r){return r.queryFeaturesJSON(e||t.createQuery())})},t.prototype.queryObjectIds=function(e){var t=this;return this._getAssociatedLayerForQuery().then(function(r){return r.queryObjectIds(e||t.createQuery())})},t.prototype.getFieldUsageInfo=function(e){var t={supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1};return this.loaded?this._fieldUsageInfo[e]||t:(N.error("#getFieldUsageInfo()","Unavailable until layer is loaded"),t)},t.prototype._getAssociatedLayerForQuery=function(){var e=this;if(!this.loaded)return this.load().then(function(){return e._getAssociatedLayerForQuery()});var t=this.associatedLayer;return null!=t?d.resolve(t):d.reject(new u("scenelayer:query-not-available","SceneLayer queries are not available without associated feature layer"))},t.prototype.hasCachedStatistics=function(e){return null!=this.statisticsInfo&&this.statisticsInfo.some(function(t){return t.name===e})},t.prototype.queryCachedStatistics=function(e){if(!this.hasCachedStatistics(e))return d.reject(new u("scenelayer:no-cached-statistics","Cached statistics for this attribute are not available"));for(var t=0,r=this.statisticsInfo;t<r.length;t++){var n=r[t];if(n.name===e){var i=p.join(this.parsedUrl.path,n.href);return l(i,{query:{f:"json"},responseType:"json"}).then(function(e){return e.data})}}},t.prototype.graphicChanged=function(e){this.emit("graphic-update",e)},t.prototype._validateLayer=function(e){if(e.layerType&&-1===L.indexOf(e.layerType))throw new u("scenelayer:layer-type-not-supported","SceneLayer does not support this layer type",{layerType:e.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new u("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"});if(this.version.major>1)throw new u("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"});!function(e,t){var r=!1,n=!1;if(null==e)r=!0,n=!0;else{var i=t&&t.isGeographic;switch(e){case"east-north-up":case"earth-centered":r=!0,n=i;break;case"vertex-reference-frame":r=!0,n=!i;break;default:r=!1}}if(!r)throw new u("scenelayer:unsupported-normal-reference-frame","Normal reference frame is invalid.");if(!n)throw new u("scenelayer:incompatible-normal-reference-frame","Normal reference frame is incompatible with layer spatial reference.")}(this.normalReferenceFrame,this.spatialReference)},t.prototype._populateFieldUsageInfo=function(){if(this._fieldUsageInfo={},this.fields)for(var e=this,t=0,r=this.fields;t<r.length;t++){!function(t){var r=!(!e.attributeStorageInfo||!e.attributeStorageInfo.some(function(e){return e.name===t.name})),n=!!(e.associatedLayer&&e.associatedLayer.fields&&e.associatedLayer.fields.some(function(e){return e&&t.name===e.name})),i={supportsLabelingInfo:r,supportsRenderer:r,supportsPopupTemplate:r||n,supportsLayerQuery:n};e._fieldUsageInfo[t.name]=i}(r[t])}},t.prototype._applyCompanionOverrides=function(){if(this.associatedLayer){if(this.associatedLayer.fields)for(var e=0,t=this.associatedLayer.fields;e<t.length;e++){var r=t[e];this.getField(r.name)||this.fields.push(r.clone())}for(var n=["popupTemplate","popupEnabled"],i=m.getProperties(this),o=0;o<n.length;o++){var a=n[o];this._buddyIsMoreImportant(a)&&(i.setDefaultOrigin(this.associatedLayer.originOf(a)),i.set(a,this.associatedLayer[a]),i.setDefaultOrigin("user"))}}},t.prototype._setCompanionFeatureLayer=function(){var e=this;return this._fetchCompanionFeatureLayer().then(function(t){e.associatedLayer=t})},t.prototype._fetchCompanionFeatureLayer=function(){var e=this;return-1===["mesh-pyramids","points"].indexOf(this.profile)?d.resolve(null):(this.portalItem&&this.portalItem.isResolved()?this._fetchCompanionFeatureLayerFromRelatedItems(this.portalItem):this._fetchCompanionFeatureLayerFromUrl()).then(function(e){return e.load()}).catch(function(t){return null==e.attributeStorageInfo?N.warn("Companion FeatureLayer could not be loaded and no binary attributes found. Popups will not work for this SceneLayer: "+e.title):N.info("Companion FeatureLayer could not be loaded. Falling back to binary attributes for Popups on this SceneLayer: "+e.title),null})},t.prototype._fetchCompanionFeatureLayerFromRelatedItems=function(e){var t=this;return e.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"}).then(function(e){var r=e.filter(function(e){return"Feature Service"===e.type})[0];return r?t._fetchCompanionFeatureLayerFromPortalItem(new P({id:r.id,portal:r.portal})):d.reject()}).catch(function(){return t._fetchCompanionFeatureLayerFromUrl()})},t.prototype._fetchCompanionFeatureLayerFromPortalItem=function(e){var t=this;return e.load().then(function(e){return t._findMatchingCompanionSublayerUrl(e.url)}).then(function(t){return d.resolve(new v({url:t,portalItem:e}))})},t.prototype._fetchCompanionFeatureLayerFromUrl=function(){return this._findMatchingCompanionSublayerUrl().then(function(e){return d.resolve(new v({url:e}))})},t.prototype._findMatchingCompanionSublayerUrl=function(e){var t=this.parsedUrl.path.match(/^(.*)\/SceneServer\/layers\/([\d]*)\/?$/i);if(!t)return d.reject();null==e&&(e=t[1]+"/FeatureServer");var r=e.replace(/^(.*FeatureServer)(\/[\d]*\/?)?$/i,"$1"),n={query:{f:"json"},responseType:"json"},i=t[1]+"/SceneServer",o=parseInt(t[2],10),s=l(i,n).catch(function(e){return{layers:null}}),u=l(r,n);return a([u,s]).then(function(e){var t=e[0],n=e[1],i=n.data&&n.data.layers,a=t.data&&t.data.layers;if(!Array.isArray(a))throw new Error("expected layers array");if(Array.isArray(i))for(var s=0;s<Math.min(i.length,a.length);s++){if(i[s].id===o)return r+"/"+a[s].id}else if(o<a.length)return r+"/"+a[o].id;throw new Error("could not find matching associated sublayer")})},t.prototype._buddyIsMoreImportant=function(e){if(!this.associatedLayer)return!1;var t=h.nameToId(this.originOf(e)),r=h.nameToId(this.associatedLayer.originOf(e));return null!=r&&r<=h.OriginId.SERVICE?null==t||t<h.OriginId.SERVICE:null!=r&&r<=h.OriginId.PORTAL_ITEM&&(null==t||t<h.OriginId.PORTAL_ITEM)},t.prototype._validateElevationInfo=function(){var e=this.elevationInfo;e&&("mesh-pyramids"===this.profile&&"absolute-height"!==e.mode&&N.warn(".elevationInfo=","Mesh scene layers only support absolute-height elevation mode"),e.featureExpressionInfo&&"0"!==e.featureExpressionInfo.expression&&N.warn(".elevationInfo=","Scene layers do not support featureExpressionInfo"))},o([f.shared("esri.layers.SceneLayer")],t.prototype,"declaredClass",void 0),o([f.property({types:{key:"type",base:x.default,typeMap:{selection:w.default}},json:{origins:{"web-scene":{read:{source:"layerDefinition.featureReduction"},write:{target:"layerDefinition.featureReduction"}}}}})],t.prototype,"featureReduction",void 0),o([f.property({type:[O.default],json:{read:!1,origins:{"web-scene":{read:{source:"layerDefinition.rangeInfos"},write:{target:"layerDefinition.rangeInfos"}}}}})],t.prototype,"rangeInfos",void 0),o([f.property()],t.prototype,"associatedLayer",void 0),o([f.property()],t.prototype,"operationalLayerType",void 0),o([f.property({json:{read:!1},readOnly:!0})],t.prototype,"type",void 0),o([f.property({type:[S]})],t.prototype,"fields",void 0),o([f.property({readOnly:!0})],t.prototype,"attributeStorageInfo",void 0),o([f.property({readOnly:!0})],t.prototype,"statisticsInfo",void 0),o([f.property({type:String,json:{origins:{service:{read:!1,write:!1}},read:{source:"layerDefinition.definitionExpression"},write:{target:"layerDefinition.definitionExpression"}}})],t.prototype,"definitionExpression",void 0),o([f.property({value:null,type:M,json:{origins:{service:{read:{source:"elevationInfo"}}},read:{source:"layerDefinition.elevationInfo"},write:{target:"layerDefinition.elevationInfo"}}})],t.prototype,"elevationInfo",null),o([f.property({type:String,dependsOn:["profile"]})],t.prototype,"geometryType",null),o([f.property(b.labelsVisible)],t.prototype,"labelsVisible",void 0),o([f.property({type:[E],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:C.reader},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:C.reader},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],t.prototype,"labelingInfo",void 0),o([f.property({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}})],t.prototype,"legendEnabled",void 0),o([f.property({types:R.types,json:{origins:{service:{read:{source:"drawingInfo.renderer",reader:F}}},read:{source:"layerDefinition.drawingInfo.renderer",reader:F},write:{target:"layerDefinition.drawingInfo.renderer"}},value:null})],t.prototype,"renderer",null),o([f.property({json:{read:!1}})],t.prototype,"cachedDrawingInfo",void 0),o([f.reader("service","cachedDrawingInfo")],t.prototype,"readCachedDrawingInfo",null),o([f.property(b.popupEnabled)],t.prototype,"popupEnabled",void 0),o([f.property({type:s,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],t.prototype,"popupTemplate",void 0),o([f.property({type:String,json:{read:!1}})],t.prototype,"objectIdField",void 0),o([f.reader("service","objectIdField",["objectIdField","fields"])],t.prototype,"readObjectIdField",null),o([f.property()],t.prototype,"objectIdFilter",void 0),o([f.property({type:String,json:{read:!1}})],t.prototype,"profile",void 0),o([f.reader("service","profile",["store.profile"])],t.prototype,"readProfile",null),o([f.property({readOnly:!0,type:String,json:{read:!1}})],t.prototype,"normalReferenceFrame",void 0),o([f.reader("service","normalReferenceFrame",["store.normalReferenceFrame"])],t.prototype,"readNormalReferenceFrame",null),o([f.property(_.screenSizePerspectiveEnabled)],t.prototype,"screenSizePerspectiveEnabled",void 0),o([f.subclass()],t)}(f.declared(g,y)),V={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",points:"points","features-points":"points",lines:"lines","features-lines":"lines",polygons:"polygons","features-polygons":"polygons"},U={"mesh-pyramids":"mesh",points:"point",lines:"polyline",polygons:"polygon"};return j}.apply(null,n))||(e.exports=i)},792:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(701)],void 0===(i=function(e,t,r){return{now:r}}.apply(null,n))||(e.exports=i)},793:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(344)],void 0===(i=function(e,t,r){function n(e,t,n,i){var o=s;return e?(n&&i&&(o.len=r.vec3d.dist(t,n)),r.vec3d.set(e,o.dir)):i?(o.len=r.vec3d.dist(t,n),r.vec3d.scale(r.vec3d.subtract(n,t,o.dir),1/o.len)):r.vec3d.normalize(r.vec3d.subtract(n,t,o.dir)),o}function i(e,t){return-r.vec3d.dot(t,e)-e[3]}function o(e,t,n){var o=r.vec3d.dot(e,n.dir),a=i(e,t);if(a<0&&o>=0)return!1;if(o>-1e-6&&o<1e-6)return a>0;if((a<0||o<0)&&!(a<0&&o<0))return!0;var s=a/o;return o>0?s<n.clip[1]&&(n.clip[1]=s):s>n.clip[0]&&(n.clip[0]=s),n.clip[0]<=n.clip[1]}function a(e,t,r,n){n.clip[0]=0,n.clip[1]=r?n.len:Number.MAX_VALUE;for(var i=0;i<e.length;i++)if(!o(e[i],t,n))return!1;return!0}Object.defineProperty(t,"__esModule",{value:!0}),t.planeSphere=function(e,t,r){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]<r},t.frustumSphere=function(e,t,r){var n=t[0],i=t[1],o=t[2];return!(e[0][0]*n+e[0][1]*i+e[0][2]*o+e[0][3]>r||e[1][0]*n+e[1][1]*i+e[1][2]*o+e[1][3]>r||e[2][0]*n+e[2][1]*i+e[2][2]*o+e[2][3]>r||e[3][0]*n+e[3][1]*i+e[3][2]*o+e[3][3]>r||e[4][0]*n+e[4][1]*i+e[4][2]*o+e[4][3]>r||e[5][0]*n+e[5][1]*i+e[5][2]*o+e[5][3]>r)},t.frustumRay=function(e,t,r,i){return a(e,t,null,n(i,t,r,!1))},t.frustumPoint=function(e,t){for(var r=0;r<6;r++)if(i(e[r],t)<0)return!1;return!0},t.frustumLineSegment=function(e,t,r,i){return a(e,t,r,n(i,t,r,!0))},t.closestPointOnRay=function(e,t,n,i){var o=r.vec3d.dot(t,r.vec3d.subtract(n,e,i));return r.vec3d.add(e,r.vec3d.scale(t,o,i),i),i};var s={dir:r.vec3d.create(),len:0,clip:r.vec2d.create()}}.apply(null,n))||(e.exports=i)},794:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(342),r(339),r(343),r(1012)],void 0===(i=function(e,t,r,n,i,o){function a(e,t,n){for(var i="",o=0;o<n;){var a=e[t+o];if(a<128)i+=String.fromCharCode(a),o++;else if(a>=192&&a<224){if(o+1>=n)throw new r("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");var s=(31&a)<<6|63&e[t+o+1];i+=String.fromCharCode(s),o+=2}else if(a>=224&&a<240){if(o+2>=n)throw new r("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");s=(15&a)<<12|(63&e[t+o+1])<<6|63&e[t+o+2];i+=String.fromCharCode(s),o+=3}else{if(!(a>=240&&a<248))throw new r("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");if(o+3>=n)throw new r("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");if((s=(7&a)<<18|(63&e[t+o+1])<<12|(63&e[t+o+2])<<6|63&e[t+o+3])>=65536){var l=55296+(s-65536>>10),u=56320+(1023&s);i+=String.fromCharCode(l,u)}else i+=String.fromCharCode(s);o+=4}}return i}function s(e,r){for(var n={byteOffset:0,byteCount:0,fields:Object.create(null)},i=0,o=0;o<r.length;o++){var a=r[o],s=a.valueType||a.type,l=t.valueType2ArrayBufferReader[s];n.fields[a.property]=l(e,i),i+=t.valueType2TypedArrayClassMap[s].BYTES_PER_ELEMENT}return n.byteCount=i,n}function l(e,t,n){var i,o,s=[],l=0;for(o=0;o<e;o+=1){if((i=t[o])>0){if(s.push(a(n,l,i-1)),0!==n[l+i-1])throw new r("string-array-error","Invalid string array: missing null termination.")}else s.push(null);l+=i}return s}function u(e,r){return new(0,t.valueType2TypedArrayClassMap[r.valueType])(e,r.byteOffset,r.count*r.valuesPerElement)}function c(e,t){return new Uint8Array(e,t.byteOffset,t.byteCount)}function d(e,t,i){for(var o=null!=t.header?s(e,t.header):{byteOffset:0,byteCount:0,fields:{count:i}},a={header:o,byteOffset:o.byteCount,byteCount:0,entries:Object.create(null)},l=o.byteCount,u=0;u<t.ordering.length;u++){var c=t.ordering[u],d=n.clone(t[c]);if(d.count=o.fields.count,"String"===d.valueType){if(d.byteOffset=l,d.byteCount=o.fields[c+"ByteCount"],"UTF-8"!==d.encoding)throw new r("unsupported-encoding","Unsupported String encoding.",{encoding:d.encoding})}else{if(!f(d.valueType))throw new r("unsupported-value-type","Unsupported binary valueType",{valueType:d.valueType});var p=h(d.valueType);l+=l%p!=0?p-l%p:0,d.byteOffset=l,d.byteCount=p*d.valuesPerElement*d.count}l+=d.byteCount,a.entries[c]=d}return a.byteCount=l-a.byteOffset,a}function p(e,t,n){if(t!==e&&m.error("Invalid "+n+" buffer size\n expected: "+e+", actual: "+t+")"),t<e)throw new r("buffer-too-small","Binary buffer is too small",{expectedSize:e,actualSize:t})}function f(e){return t.valueType2TypedArrayClassMap.hasOwnProperty(e)}function h(e){return f(e)&&t.valueType2TypedArrayClassMap[e].BYTES_PER_ELEMENT}Object.defineProperty(t,"__esModule",{value:!0});var m=i.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader");t.readHeader=s,t.readStringArray=l,t.createTypedView=u,t.createRawView=c,t.createAttributeDataIndex=d,t.createGeometryDataIndex=function(e,t,r){var i=s(e,t&&t.header),o=i.byteCount,a={header:i,byteOffset:i.byteCount,byteCount:0,vertexAttributes:n.clone(t.vertexAttributes)},l=a.vertexAttributes;r||null==l.region||delete l.region;for(var u=i.fields,c=null!=u.vertexCount?u.vertexCount:u.count,d=0;d<t.ordering.length;d++){var f=t.ordering[d];null!=l[f]&&(l[f].byteOffset=o,l[f].count=c,o+=h(l[f].valueType)*l[f].valuesPerElement*c)}var m=u.faceCount;if(t.faces&&m){a.faces=n.clone(t.faces);var v=a.faces;for(d=0;d<t.ordering.length;d++){var g=t.ordering[d];null!=v[g]&&(v[g].byteOffset=o,v[g].count=m,o+=h(v[g].valueType)*v[g].valuesPerElement*m)}}var y=u.featureCount;if(t.featureAttributes&&t.featureAttributeOrder&&y){a.featureAttributes=n.clone(t.featureAttributes);var b=a.featureAttributes;for(d=0;d<t.featureAttributeOrder.length;d++){var _=t.featureAttributeOrder[d];b[_].byteOffset=o,b[_].count=y;var x=h(b[_].valueType);"UInt64"===b[_].valueType&&(x=8),o+=x*b[_].valuesPerElement*y}}return p(o,e.byteLength,"geometry"),a.byteCount=o-a.byteOffset,a},t.readBinaryAttribute=function(e,t,n){if("lepcc-rgb"===e.encoding)return o.decodeRGB(t);if("lepcc-intensity"===e.encoding)return o.decodeIntensity(t);if(null!=e.encoding&&""!==e.encoding)throw new r("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");e["attributeByteCounts "]&&!e.attributeByteCounts&&(m.warn("Warning: Trailing space in 'attributeByteCounts '."),e.attributeByteCounts=e["attributeByteCounts "]),"ObjectIds"===e.ordering[0]&&e.hasOwnProperty("objectIds")&&(m.warn("Warning: Case error in objectIds"),e.ordering[0]="objectIds");var i=d(t,e,n);p(i.byteOffset+i.byteCount,t.byteLength,"attribute");var a=i.entries.attributeValues||i.entries.objectIds;if(a){if("String"===a.valueType){var s=i.entries.attributeByteCounts,f=u(t,s),h=c(t,a);return l(s.count,f,h)}return u(t,a)}throw new r("bad-attribute-storage-info","Bad attributeStorageInfo specification.")},t.valueType2TypedArrayClassMap={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array},t.valueType2ArrayBufferReader={Float32:function(e,t){return new DataView(e,0).getFloat32(t,!0)},Float64:function(e,t){return new DataView(e,0).getFloat64(t,!0)},UInt8:function(e,t){return new DataView(e,0).getUint8(t)},Int8:function(e,t){return new DataView(e,0).getInt8(t)},UInt16:function(e,t){return new DataView(e,0).getUint16(t,!0)},Int16:function(e,t){return new DataView(e,0).getInt16(t,!0)},UInt32:function(e,t){return new DataView(e,0).getUint32(t,!0)},Int32:function(e,t){return new DataView(e,0).getInt32(t,!0)}},t.isValueType=f,t.getBytesPerValue=h}.apply(null,n))||(e.exports=i)},804:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(342),r(619),r(392)],void 0===(i=function(e,t,r,n,i){function o(e,t,r){if(!a(e)||!a(t))return 4;if(null==e||null==t)return 0;if(!r&&e.heightUnit!==t.heightUnit)return 1;if(e.heightModel!==t.heightModel)return 2;switch(e.heightModel){case"gravity-related-height":return 0;case"ellipsoidal":return e.vertCRS===t.vertCRS?0:3;default:return 4}}function a(e){return null==e||null!=e.heightModel&&null!=e.heightUnit}function s(e){return null!=e.heightModelInfo||null!=e.spatialReference||!u(e)}function l(e){var t=e.url&&i.parse(e.url);return null==(e.spatialReference&&e.spatialReference.vcsWkid)&&t&&"ImageServer"===t.serverType||!e.heightModelInfo?u(e)?n.deriveUnitFromSR(p,e.spatialReference):null:e.heightModelInfo}function u(e){return c(e,"capabilities")?!!(e.capabilities&&e.capabilities.data&&e.capabilities.data.supportsZ):d(e)}function c(e,t){return e.hasOwnProperty(t)}function d(e){switch(e.type){case"elevation":case"integrated-mesh":case"point-cloud":case"scene":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"csv":case"feature":case"geo-rss":case"graphics":case"group":case"imagery":case"kml":case"map-image":case"map-notes":case"open-street-map":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"web-tile":case"wms":case"wmts":return!1;default:e.type}return!1}Object.defineProperty(t,"__esModule",{value:!0}),t.validateWebSceneError=function(e,t){if(!e)return null;if(!a(e))return new r("webscene:unsupported-height-model-info","The vertical coordinate system of the scene is not supported",{heightModelInfo:e});var i=e.heightUnit,o=n.deriveUnitFromSR(e,t).heightUnit;return i!==o?new r("webscene:incompatible-height-unit","The vertical units of the scene ("+i+") must match the horizontal units of the scene ("+o+")",{verticalUnit:i,horizontalUnit:o}):null},t.rejectLayerError=function(e,t,i){var a=l(e),u=t,c=o(a,u,i),d=null;if(a){var p=n.deriveUnitFromSR(a,e.spatialReference).heightUnit;i||p===a.heightUnit||(d=new r("layerview:unmatched-height-unit","The vertical units of the layer must match the horizontal units ("+p+")",{horizontalUnit:p}))}if(!s(e)||4===c||d)return new r("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:a,error:d});switch(d=null,c){case 1:var f=a.heightUnit||"unknown",h=u.heightUnit||"unknown";d=new r("layerview:incompatible-height-unit","The vertical units of the layer ("+f+") must match the vertical units of the scene ("+h+")",{layerUnit:f,sceneUnit:h});break;case 2:var m=a.heightModel||"unknown",v=u.heightModel||"unknown";d=new r("layerview:incompatible-height-model","The height model of the layer ("+m+") must match the height model of the scene ("+v+")",{layerHeightModel:m,sceneHeightModel:v});break;case 3:var g=a.vertCRS||"unknown",y=u.vertCRS||"unknown";d=new r("layerview:incompatible-vertical-datum","The vertical datum of the layer ("+g+") must match the vertical datum of the scene ("+y+")",{layerDatum:g,sceneDatum:y})}return d?new r("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:a,sceneHeightModelInfo:u,error:d}):null},t.deriveHeightModelInfoFromLayer=l,t.mayHaveHeightModelInfo=function(e){return null!=e.layers||d(e)||c(e,"capabilities")||c(e,"heightModelInfo")};var p=new n({heightModel:"gravity-related-height"})}.apply(null,n))||(e.exports=i)},808:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(430),r(902),r(397)],void 0===(i=function(e,t,r,n,i){function o(e){switch(e){case 5120:return Int8Array;case 5126:return Float32Array;case 5124:return Int32Array;case 5122:return Int16Array;case 5121:return Uint8Array;case 5125:return Uint32Array;case 5123:return Uint16Array}throw new Error("Unhandled data type: "+e)}return function(){function e(t,a,s,l,u,c){void 0===s&&(s=null),void 0===l&&(l=e.DefaultOffsets),void 0===u&&(u=e.DefaultIndices),void 0===c&&(c=!1),this._freeDataAfterUse=c,this.preinterleaved=!0,this.primitiveType="triangle",this._positionData=null;var d=i.getStride(a)/4,p=t.length/d;this._hasDefaultIndices=u===e.DefaultIndices,this._hasDefaultIndices&&(u=n.generateDefaultIndexArray(p));for(var f={},h=0,m=a;h<m.length;h++){var v=m[h],g=new(o(v.type))(t.buffer),y=i.getBytesPerElement(v.type),b=v.count,_=v.offset/y,x=v.stride/y;f[v.name]={data:g,size:b,offsetIdx:_,strideIdx:x}}s&&(this._positionData=s,f.position={data:s.data,size:3,offsetIdx:0,strideIdx:3}),this._id=n.getNewId(),this._vertexData=t,this._vertexAttributes=f,this._layout=a,this._indexData=u,this._componentOffsets=r.createOffsets(l),this._gpuMemoryUsage=t.byteLength+(this._hasDefaultIndices?0:u.byteLength)}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layout",{get:function(){return this._layout},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"componentOffsets",{get:function(){return this._componentOffsets},enumerable:!0,configurable:!0}),e.prototype.toRenderData=function(){var e={id:this._id.toString(),preinterleaved:!0,indexData:this._hasDefaultIndices?null:this._indexData,indexCount:this._indexData.length,vertexData:this._vertexData,layout:this._layout};return this._freeDataAfterUse&&(this._vertexData=null,this._indexData=null,this._vertexAttributes={position:this._vertexAttributes.position}),e},e.prototype.getIndices=function(e){return"position"===e&&this._positionData?this._positionData.indices:this._indexData},e.prototype.getAttribute=function(e){return this._vertexAttributes[e]},e.prototype.estimateGpuMemoryUsage=function(){return this._gpuMemoryUsage},Object.defineProperty(e.prototype,"hasPositionData",{get:function(){return!!this._positionData},enumerable:!0,configurable:!0}),e.DefaultOffsets=new Uint32Array(0),e.DefaultIndices=new Uint32Array(0),e}()}.apply(null,n))||(e.exports=i)},809:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(857)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){void 0===t&&(t=1),this.rctx=e,this.fieldCount=t,this.buffers=[]}return e.prototype.garbageCollect=function(){this.buffers=this.buffers.filter(function(e){return 0!==e.activeCount||(e.dispose(),!1)})},e.prototype.getBuffer=function(e){for(var t=0,n=this.buffers;t<n.length;t++){var i=n[t];if(i.availableCount>=e)return i}if(e>r.MAX_INDEX_COUNT)return null;var o=new r.ManagedTextureBackedBuffer(this.rctx,this.fieldCount);return this.buffers.push(o),o},e.prototype.updateTextures=function(){for(var e=0,t=this.buffers;e<t.length;e++)t[e].textureBuffer.updateTexture()},e}();t.BufferManager=n}.apply(null,n))||(e.exports=i)},810:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(792)],void 0===(i=function(e,t,r){return function(){function e(e){this._filterSampleIndex=0,this._lastTime=NaN,this._totalTime=0,this._numMeasurements=0,this._filterSamples=new Array(e),this.reset(),this._filterSize=e}return e.prototype.reset=function(){this._filterSampleIndex=0;for(var e=0;e<this._filterSize;e++)this._filterSamples[e]=NaN},e.prototype.start=function(){this._tsStart=r.now()},e.prototype.stop=function(){var e=r.now();return this._lastTime=e-this._tsStart,this._totalTime+=this._lastTime,this._numMeasurements++,this._filterSize&&(this._filterSamples[this._filterSampleIndex]=this._lastTime,this._filterSampleIndex=(this._filterSampleIndex+1)%this._filterSize),this._lastTime},e.prototype.getLast=function(){return this._lastTime},e.prototype.getLastFiltered=function(){for(var e=0,t=0;t<this._filterSamples.length;t++)e+=this._filterSamples[t];return e/this._filterSamples.length},e.prototype.getAverage=function(){return this._totalTime/this._numMeasurements},e.prototype.getTotal=function(){return this._totalTime},e.prototype.getNumMeasurements=function(){return this._numMeasurements},e}()}.apply(null,n))||(e.exports=i)},814:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(658),i=r(461),o=r(659),a=r(962),s=r(621),l=r(1037);if(s.default("es6-array")&&s.default("es6-array-fill"))t.from=i.default.Array.from,t.of=i.default.Array.of,t.copyWithin=l.wrapNative(i.default.Array.prototype.copyWithin),t.fill=l.wrapNative(i.default.Array.prototype.fill),t.find=l.wrapNative(i.default.Array.prototype.find),t.findIndex=l.wrapNative(i.default.Array.prototype.findIndex);else{var u=function(e){return isNaN(e)?0:(e=Number(e),isFinite(e)&&(e=Math.floor(e)),Math.min(Math.max(e,0),a.MAX_SAFE_INTEGER))},c=function(e){return e=Number(e),isNaN(e)?0:0!==e&&isFinite(e)?(e>0?1:-1)*Math.floor(Math.abs(e)):e},d=function(e,t){return e<0?Math.max(t+e,0):Math.min(e,t)};t.from=function(e,t,r){if(null==e)throw new TypeError("from: requires an array-like object");t&&r&&(t=t.bind(r));var i,a,s=u(e.length),l="function"==typeof this?Object(new this(s)):new Array(s);if(!o.isArrayLike(e)&&!o.isIterable(e))return l;if(o.isArrayLike(e)){if(0===s)return[];for(var c=0;c<e.length;c++)l[c]=t?t(e[c],c):e[c]}else{c=0;try{for(var d=n.__values(e),p=d.next();!p.done;p=d.next()){var f=p.value;l[c]=t?t(f,c):f,c++}}catch(e){i={error:e}}finally{try{p&&!p.done&&(a=d.return)&&a.call(d)}finally{if(i)throw i.error}}}return void 0!==e.length&&(l.length=s),l},t.of=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Array.prototype.slice.call(e)},t.copyWithin=function(e,t,r,n){if(null==e)throw new TypeError("copyWithin: target must be an array-like object");var i=u(e.length);t=d(c(t),i),r=d(c(r),i),n=d(void 0===n?i:c(n),i);var o=Math.min(n-r,i-t),a=1;for(t>r&&t<r+o&&(a=-1,r+=o-1,t+=o-1);o>0;)r in e?e[t]=e[r]:delete e[t],t+=a,r+=a,o--;return e},t.fill=function(e,t,r,n){var i=u(e.length),o=d(c(r),i);for(n=d(void 0===n?i:c(n),i);o<n;)e[o++]=t;return e},t.find=function(e,r,n){var i=t.findIndex(e,r,n);return-1!==i?e[i]:void 0},t.findIndex=function(e,t,r){var n=u(e.length);if(!t)throw new TypeError("find: second argument must be a function");r&&(t=t.bind(r));for(var i=0;i<n;i++)if(t(e[i],i,e))return i;return-1}}if(s.default("es7-array"))t.includes=l.wrapNative(i.default.Array.prototype.includes);else{t.includes=function(e,t,r){void 0===r&&(r=0);for(var n,i=(n=e.length,n=Number(n),isNaN(n)?0:(isFinite(n)&&(n=Math.floor(n)),Math.min(Math.max(n,0),a.MAX_SAFE_INTEGER))),o=r;o<i;++o){var s=e[o];if(t===s||t!=t&&s!=s)return!0}return!1}}},819:function(e,t,r){var n;!function(t){function r(e){this._callbacks=[],this._errbacks=[],this._cancelCallback=e,this._iscancelled=!1,this._isdone=!1,this._iserr=!1}r.prototype.cancel=function(e){this._callbacks=[],this._errbacks=[],this._iscancelled=!0,this._cancelCallback&&this._cancelCallback(e)},r.prototype.then=function(e,t,r){var n;if(!this._iscancelled)return this._isdone?n=e.apply(r,this.result):this._iserr&&t?n=t.apply(r,this.result):(this._callbacks.push(function(){return e.apply(r,arguments)}),t&&this._errbacks.push(function(){return t.apply(r,arguments)})),n},r.prototype.done=function(){this.result=arguments,this._isdone=!0;for(var e=0;e<this._callbacks.length;e++)this._callbacks[e].apply(null,arguments);this._callbacks=[],this._errbacks=[]},r.prototype.resolve=r.prototype.done,r.prototype.reject=function(){if(!this._iscancelled){this.result=arguments,this._iserr=!0;for(var e=0;e<this._errbacks.length;e++)this._errbacks[e].apply(null,arguments);this._callbacks=[],this._errbacks=[]}},r.prototype.isRejected=function(){return this._iserr},r.prototype.isFulfilled=function(){return this._isdone||this._iserr},r.prototype.isResolved=function(){return this._isdone},r.prototype.isCancelled=function(){return this._iscancelled};var i={Promise:r,join:function(e){function t(e,t){return function(){t&&(s=!0),o+=1,a[e]=Array.prototype.slice.call(arguments),o===i&&(s?n.reject():n.done(a))}}for(var n=new r,i=e.length,o=0,a=[],s=!1,l=0;l<i;l++)e[l].then(t(l,!1),t(l,!0));return 0===e.length&&n.done(),n},chain:function e(t,n){var i=new r;return 0===t.length?i.done.apply(i,n):t[0].apply(null,n).then(function(){t.splice(0,1),e(t,arguments).then(function(){i.done.apply(i,arguments)})}),i}};void 0===(n=function(){return i}.apply(null,[]))||(e.exports=n)}()},840:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(382),r(695),r(459),r(349)],void 0===(i=function(e,t,r,n,i,o){return function(){function e(e){this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this._dirtyMaterials=new Set,this._model=e}return Object.defineProperty(e.prototype,"residentLayerCount",{get:function(){return this._residentGeomRecords.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"residentObjectCount",{get:function(){var e=0;return this._residentGeomRecords.forEach(function(t){e+=t.size}),e},enumerable:!0,configurable:!0}),e.prototype.getDirtyMaterials=function(){return this._dirtyMaterials.size>0?this._dirtyMaterials:null},e.prototype.clearDirtyMaterials=function(){this._dirtyMaterials.clear()},e.prototype.hasDirtyGeometryRecords=function(){var e=!1;return n.everyMap(this._dirtyGeomRecords,function(t){if(e)return!1;n.everyMap(t,function(t){if(!e&&t&&t.size>0)return e=!0,!1})}),e},e.prototype.handleUpdate=function(e,t,r){return o.assert(this[t],"ModelDirtySet doesn't know how to process "+t),this[t](e,r)},e.prototype.shaderTransformationChanged=function(e){var t=this,r=this._residentGeomRecords.get(e.id);r&&r.forEach(function(e,r){var n=t._model.content[i.OBJECT][r];n&&n.hasVolativeTransformation()&&e.forEach(function(e){for(var t=0,r=e[1];t<r.length;t++)r[t].shaderTransformationChanged()})})},e.prototype.commit=function(){return this.commitLayers(r.keysOfMap(this._dirtyGeomRecords))},e.prototype.commitLayers=function(e){for(var t=this,r=[],n=[],a=[],s=this,l=0;l<e.length;l++)!function(l){var u=e[l],c=s._dirtyGeomRecords.get(u);if(!c)return"continue";c.forEach(function(e,s){var l=t._ensureGeomRecord(u,s);e.forEach(function(e,u){var c,d=e[0],p=e[1],f=e[2],h=2&p&&1&f;(4&p||h)&&((c=l.get(u))?n.push.apply(n,c[1]):4===p&&o.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove"),c&&l.delete(u));if(1&p||h){var m=[d,[]],v=t._model.get(i.OBJECT,s);t._model.getGeometryRenderGeometries(v,d,m[1]),r.push.apply(r,m[1]),l.set(u,m)}if(2&p&&!h)if(c=l.get(u)){var g=c[1],y=g.length;if(16&f){v=t._model.get(i.OBJECT,s);for(var b=0;b<y;b++){var _=g[b];t._model.updateRenderGeometryTransformation(v,d,_)}}for(b=0;b<y;b++){_=g[b];a.push({renderGeometry:_,updateType:f})}}else o.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}),0===l.size&&t._residentGeomRecords.get(u).delete(s)}),0===s._residentGeomRecords.get(u).size&&s._residentGeomRecords.delete(u),s._dirtyGeomRecords.delete(u)}(l);return[r,n,a]},e.prototype.getResidentRenderGeometries=function(){return this.getResidentRenderGeometriesFilteredByLayers(r.keysOfMap(this._residentGeomRecords))},e.prototype.getResidentRenderGeometriesFilteredByLayers=function(e){for(var t=[],r=0;r<e.length;r++){var n=e[r],i=this._residentGeomRecords.get(n);i&&i.forEach(function(e){e.forEach(function(e){t.push.apply(t,e[1])})})}return t},e.prototype.visibilityChanged=function(e,t,r){if(null!=t)this._componentPropertyChanged(e,t,r,2);else for(var n=0,i=e.getGeometryRecords();n<i.length;n++){var o=i[n];this._componentPropertyChanged(e,o,r,2)}},e.prototype.componentHighlightChanged=function(e,t,r){if(null!=t)this._componentPropertyChanged(e,t,r,32);else for(var n=0,i=e.getGeometryRecords();n<i.length;n++){var o=i[n];this._componentPropertyChanged(e,o,r,32)}},e.prototype.vertexAttrsUpdated=function(e,t,r){this._updateOrCreateDirtyRecord(e,t,r,2,0,0,2,5,4)},e.prototype.matChanged=function(e){this._dirtyMaterials.add(e.id),this.onMaterialChanged&&this.onMaterialChanged(e)},e.prototype.layerAdded=function(e){for(var t=e.getObjects(),r=0;r<t.length;r++)this.layObjectAdded(e,t[r])},e.prototype.layerRemoved=function(e){for(var t=e.getObjects(),r=0;r<t.length;r++)this.layObjectRemoved(e,t[r])},e.prototype.layObjectAdded=function(e,t){for(var r=e.id,n=t.getGeometryRecords(),i=0;i<n.length;i++)this.objGeometryAdded(t,n[i],r)},e.prototype.layObjectRemoved=function(e,t){for(var r=e.id,n=t.getGeometryRecords(),i=0;i<n.length;i++)this.objGeometryRemoved(t,n[i],r)},e.prototype.layObjectReplaced=function(e,t){this.layObjectRemoved(e,t[0]),this.layObjectAdded(e,t[1])},e.prototype.objDirty=function(e,t){var r=this;t=t||this._getParentLayerId(e);var n=e.id;this._ensureGeomRecord(t,n).forEach(function(n){r._updateOrCreateDirtyRecord(e,n[0],t,2,0,2,0,5,1)})},e.prototype.objTransformation=function(e,t){var r=this;t=t||this._getParentLayerId(e);var n=e.id;this._ensureGeomRecord(t,n).forEach(function(n){r._updateOrCreateDirtyRecord(e,n[0],t,2,0,0,2,5,16)})},e.prototype.objGeometryAdded=function(e,t,r){this._updateOrCreateDirtyRecord(e,t,r,1,4,0,0,0)},e.prototype.objGeometryRemoved=function(e,t,r){this._updateOrCreateDirtyRecord(e,t,r,4,1,2,0,0)},e.prototype.objGeometryReplaced=function(e,t){this.objGeometryRemoved(e,t[0]),this.objGeometryAdded(e,t[1])},e.prototype.objGeometryTransformation=function(e,t){this.objGeometryReplaced(e,t)},e.prototype._componentPropertyChanged=function(e,t,r,n){this._updateOrCreateDirtyRecord(e,t,r,2,0,0,2,5,n)},e.prototype._updateOrCreateDirtyRecord=function(e,t,r,n,i,a,s,l,u){r=r||this._getParentLayerId(e);var c=e.id,d=t.id,p=this._ensureDirtyRecord(r,c),f=p.get(d);if(f){var h=f[1];h&i?p.delete(d):h&a?(f[1]=n,f[2]=u):h&s?f[2]|=u:h&l||o.assert(!1,"ModelDirtySet.objGeometryAdded: inconsistent state")}else p.set(d,[t,n,u])},e.prototype._ensureGeomRecord=function(e,t){var r=this._residentGeomRecords.get(e);r||(r=new Map,this._residentGeomRecords.set(e,r));var n=r.get(t);return n||(n=new Map,r.set(t,n)),n},e.prototype._ensureDirtyRecord=function(e,t){var r=this._dirtyGeomRecords.get(e);r||(r=new Map,this._dirtyGeomRecords.set(e,r));var n=r.get(t);return n||(n=new Map,r.set(t,n)),n},e.prototype._getParentLayerId=function(e){return e.parentLayer.id},e.prototype.formatDebugInfo=function(e){if(e)return"";var t=["ADD","UPD",void 0,"REM"],r="";return this._dirtyGeomRecords.forEach(function(e,n){e.forEach(function(e,i){r.length>0&&(r+="\n"),r+=n+"."+i;var o=[];e.forEach(function(e){var t=e[1];o[t]||(o[t]=[]),o[t].push(e[0].geometry.id)});for(var a=0;a<o.length;a++)if(o[a]){r+=" "+t[a-1]+": ";for(var s=0;s<o[a].length;s++)r+=o[a][s]+", "}})}),r},e}()}.apply(null,n))||(e.exports=i)},841:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(345),r(354),r(343),r(340),r(344),r(842),r(870),r(871),r(1021),r(872),r(629),r(735),r(874),r(711),r(796),r(377),r(1010)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,c,d,p,f,h,m,v,g,y){var b=i.getLogger("esri.views.3d.webgl-engine.parts.View"),_=function(){function e(e,t,r,n){var i=this;this._backgroundColor=a.vec4d.createFrom(1,1,1,1),this._lightDirection=a.vec3d.createFrom(0,1,0),this._didRender=!1,this._needsRender=!0,this._idleSuspend=!0,this._shouldRender=!1,this._supersampleScreenshots=!0,this._screenshotQueue=[],this._container=e,this._stage=t,this._initializeContext(n),this._programRepository=new c(this._rctx),this._programRepository.globalOptions.viewingMode=n.viewingMode;this._textureRep=new u(t.getAll(f.ContentType.TEXTURE),this._programRepository,function(){return i._viewport.getCamera().viewport},this._rctx),this._materialRep=new l(this._textureRep,this._programRepository),this._viewport=new h(this._stage,this._programRepository,this._materialRep,this._textureRep,this._rctx),this._initializeViewportCamera(),this._drapedRenderer=new s(this._rctx,this._canvas,this._programRepository,this._materialRep,this._textureRep,r),this._initializeFrameTask()}return Object.defineProperty(e.prototype,"isLoadingResources",{get:function(){return this._viewport.isLoadingResources},enumerable:!0,configurable:!0}),e.prototype._initializeFrameTask=function(){var e=this;this._frameTask={preRender:function(){d.begin(),e._stage.processDirty(),e.needsRender()?(e._shouldRender=!0,e._viewport.getCamera().setGLViewport(e._rctx),e._rctx.setClearColor.apply(e._rctx,e._backgroundColor),e._rctx.clear(16640)):e._shouldRender=!1},render:function(){e._shouldRender&&(e._didRender=!0,x.lightDirection=e._lightDirection,e._viewport.render(x))},postRender:function(){d.end()},update:function(){e.resetNeedsRender(),e._performScreenshots()}}},e.prototype._initializeViewportCamera=function(){var e=this._container.getBoundingClientRect(),t=this._viewport.getCamera();t.viewport[2]=e.width,t.viewport[3]=e.height,this._viewport.setCamera(t)},e.prototype._initializeContext=function(e){this._canvas=e.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");var t={alpha:e.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:null==e.stencil||e.stencil},r=v.createContextOrErrorHTML(this._canvas,t,e.renderContext);this._gl=d.instrumentContext(r);var i={disabledExtensions:e.deactivatedWebGLExtensions||{}};this._rctx=new y(this._gl,i),!e.alpha&&this._rctx.contextAttributes.alpha&&b.error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&n("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas),null!=e.supersampleScreenshots&&(this._supersampleScreenshots=e.supersampleScreenshots)},e.prototype.dispose=function(){this._viewport.dispose(),this._viewport=null,this._drapedRenderer.dispose(),this._drapedRenderer=null,this._programRepository.dispose(),this._programRepository=null,this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._container=null,this._canvas=null,this._gl=null,this._frameTask=null},e.prototype.getCombinedStats=function(){return this._viewport.getCombinedStats()},e.prototype.setNeedsRender=function(){this._didRender=!1,this._needsRender=!0},e.prototype.resetNeedsRender=function(){this._didRender&&(this._needsRender=!1,this._didRender=!1),this._viewport.resetNeedsRender(),this._textureRep.resetNeedsRender()},e.prototype.needsRender=function(){return this._needsRender||!this._idleSuspend||this._viewport.needsRender()||this._textureRep.needsRender()},e.prototype.getFrameTask=function(){return this._frameTask},e.prototype.setLighting=function(e){a.vec3d.set3(0,0,0,this._lightDirection);for(var t=0,r=e.lights;t<r.length;t++){var n=r[t];if(n instanceof p.MainLight){a.vec3d.negate(n.direction,this._lightDirection);break}}this._viewport.setLighting(e),this._needsRender=!0},e.prototype.getEdgeView=function(){return this._viewport.getEdgeView()},e.prototype.getMainLightDirection=function(){return this._lightDirection},e.prototype.getViewParams=function(e){var t={};return e&&!e.backgroundColor||(t.backgroundColor=this._backgroundColor),t},e.prototype.setViewParams=function(e){this._needsRender=!0,e.backgroundColor&&(this._backgroundColor=e.backgroundColor)},e.prototype.setRenderParams=function(e){this._needsRender=!0,void 0!==e.idleSuspend&&(this._idleSuspend=!!e.idleSuspend),this._viewport.setRenderParams(e)},e.prototype.getRenderParams=function(){var e=this._viewport.getRenderParams();return e.anisotropicFiltering=this._textureRep.getMaxAnisotropy(),e.idleSuspend=this._idleSuspend,e},e.prototype.getIdleSuspend=function(){return this._idleSuspend},Object.defineProperty(e.prototype,"renderingContext",{get:function(){return this._rctx},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return"s3tc"===e?!!this._rctx.capabilities.compressedTextureS3TC:"shaderTextureLOD"===e&&!!this._rctx.capabilities.shaderTextureLOD},e.prototype.modify=function(e,t,r,n){this._viewport.modify(e,t,r,n)},e.prototype.setCamera=function(e){this._viewport.setCamera(e)},e.prototype.getCamera=function(){return this._viewport.getCamera()},e.prototype.getCanvas=function(){return this._canvas},e.prototype.getDrapedTextureRenderer=function(){return this._drapedRenderer},e.prototype.takeScreenshot=function(e){var t=this,r=o.createResolver(function(){t._screenshotQueue=t._screenshotQueue.filter(function(e){return e.resolver!==r})});return this._screenshotQueue.push({settings:e,resolver:r}),this._needsRender=!0,r.promise},e.prototype.getFramebufferTexture=function(e){return this._viewport.getFramebufferTexture(e)},Object.defineProperty(e.prototype,"renderPlugins",{get:function(){return this._viewport.renderPlugins},enumerable:!0,configurable:!0}),e.prototype._screenshotSuperSampleSettings=function(e){if(!this._supersampleScreenshots)return e;var t=e.framebufferWidth,n=e.framebufferHeight,i=e.pixelRatio,o=e.region,a=Math.min(T,w/Math.max(t,n));return a<S?e:r({},e,{framebufferWidth:Math.round(t*a),framebufferHeight:Math.round(n*a),pixelRatio:i*a,resample:{region:{x:Math.round(o.x*a),y:Math.round(o.y*a),width:Math.round(o.width*a),height:Math.round(o.height*a)},width:t,height:n}})},e.prototype._readbackScreenshot=function(e){var t=e.framebufferWidth,r=e.framebufferHeight,n=e.region,i=e.resample;if(i){var o=m.createEmptyImageData(t,r,this._ensureScreenshotEncodeCanvas());this._gl.readPixels(0,0,t,r,6408,5121,new Uint8Array(o.data.buffer));var a=m.createEmptyImageData(n.width,n.height,this._ensureScreenshotEncodeCanvas());return m.resampleHermite(o,a,!0,i.region.x,r-(i.region.y+i.region.height),i.region.width,i.region.height)}o=m.createEmptyImageData(n.width,n.height,this._ensureScreenshotEncodeCanvas());return this._gl.readPixels(n.x,r-(n.y+n.height),n.width,n.height,6408,5121,new Uint8Array(o.data.buffer)),o},e.prototype._renderScreenshot=function(e){var t=null,r=this._viewport.getCamera(),n=this._screenshotSuperSampleSettings(e),i=n.framebufferWidth,o=n.framebufferHeight,a=!1;if(i!==r.fullWidth||o!==r.fullHeight){var s=r.copy();s.fullWidth=i,s.fullHeight=o;var l=r.fovX-s.fovX,u=r.fovY-s.fovY;l<0&&l<u?s.fovX=r.fovX:u<0&&u<l&&(s.fovY=r.fovY),this._drapedRenderer.forceUpdate&&this._drapedRenderer.forceUpdate(s),a=!0,t=new g(this._rctx,{width:s.fullWidth,height:s.fullHeight,colorTarget:0,depthStencilTarget:3}),this._rctx.bindFramebuffer(t),s.setGLViewport(this._rctx),this._rctx.setClearColor.apply(this._rctx,this._backgroundColor),this._rctx.clear(16640),this._viewport.render({lightDirection:this._lightDirection,fbo:t,camera:s,pixelRatio:n.pixelRatio})}var c=this._readbackScreenshot(n);return t&&t.dispose(),this._rctx.bindFramebuffer(null),a&&this._drapedRenderer.forceUpdate&&this._drapedRenderer.forceUpdate(r),c},e.prototype._performScreenshots=function(){if(0!==this._screenshotQueue.length){for(var e=0,t=this._screenshotQueue;e<t.length;e++){var r=t[e],n=r.settings;if(this._gl){var i=this._ensureScreenshotEncodeCanvas(),o=this._renderScreenshot(n),a=m.encodeResult(o,n,i,{flipY:!0,premultipliedAlpha:!0});r.resolver(a)}else r.resolver.reject()}this._screenshotQueue=[]}},e.prototype._ensureScreenshotEncodeCanvas=function(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas},e}(),x={lightDirection:a.vec3d.create(),camera:null,fbo:null,pixelRatio:1},w=2048,S=1.5,T=8;return _}.apply(null,n))||(e.exports=i)},842:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(344),r(617),r(634),r(430),r(439),r(422),r(734),r(736),r(595),r(739),r(349),r(629),r(869),r(377),r(371),r(397)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,c,d,p,f,h,m,v,g){var y=function(){function e(e,t,n,i,o,a){var s=this;this._renderTargets={},this._clearColor=r.vec4d.createFrom(0,0,0,0),this._id2origin={},this._uniqueIdx=0,this._rctx=e,this._canvas=t,this._programRep=n,this._modelDirtySet=a,this._modelDirtySet.onMaterialChanged=function(e){return s.materialChanged(e)},this._renderer=new u(n,i,o,this._rctx,!0),this._sliceHelper=new d,this._renderer.onHasHighlightsChanged=function(e){s.onHasHighlightsChanged&&s.onHasHighlightsChanged(e)},this._renderer.setLighting({lights:[new f.AmbientLight(r.vec3d.createFrom(1,1,1))],groundLightingFactor:1,globalFactor:0})}return e.prototype.dispose=function(){for(var e in this._renderTargets)this._renderTargets[e].dispose();this._renderTargets=null,this._renderer.dispose(),this._renderer=null},e.prototype.createRenderTarget=function(e){return this.createRenderTargetInternal(e,!0)},e.prototype.createHighlightRenderTarget=function(e){return this.createRenderTargetInternal(e,!1)},e.prototype.disposeRenderTarget=function(e){var t=this._renderTargets[e];t&&t.dispose(),delete this._renderTargets[e]},e.prototype.getRenderTargetTexture=function(e){var t=this._renderTargets[e];return t?t.colorTexture:null},e.prototype.addRenderGeometries=function(e){var t=this;e.forEach(function(e){null==e.origin&&(e.origin=t.getOrigin(e.center,e.bsRadius)),e.idx=t._uniqueIdx++}),this._renderer.modify(e,[]),this.onContentChanged&&this.onContentChanged()},e.prototype.removeRenderGeometries=function(e){this._renderer.modify([],e),this.onContentChanged&&this.onContentChanged()},e.prototype.updateRenderGeometries=function(e,t){var r=e.map(function(e){return{renderGeometry:e,updateType:t}});this._renderer.modify([],[],r),this.onContentChanged&&this.onContentChanged()},e.prototype.updateRenderOrder=function(e){e.size>0&&(this._renderer.modifyRenderOrder(e),this.onContentChanged&&this.onContentChanged())},e.prototype.setBackgroundColor=function(e){this._clearColor=e,this.onContentChanged&&this.onContentChanged()},e.prototype.addRenderGeometryHighlight=function(e,t){var r=e.instanceParameters,n=l.generateHighlightId();return r.componentHighlights=o.addHighlight(r.componentHighlights,null,t,n),this.updateRenderGeometries([e],32),n},e.prototype.removeRenderGeometryHighlight=function(e,t){var r=e.instanceParameters;r.componentHighlights=o.removeHighlight(r.componentHighlights,t),this.updateRenderGeometries([e],32)},e.prototype.isEmpty=function(){return this._renderer.isEmpty()&&!n.OVERLAY_DRAW_TEST_TEXTURE},e.prototype.processDirtyMaterials=function(){var e=this._modelDirtySet.getDirtyMaterials();e&&this._renderer.modify([],[],[],e),this._modelDirtySet.clearDirtyMaterials()},Object.defineProperty(e.prototype,"hasHighlights",{get:function(){return this._renderer.hasHighlights},enumerable:!0,configurable:!0}),e.prototype.draw=function(e,t){return this.drawPass(c.MATERIAL,e,t)},e.prototype.drawHighlights=function(e,t){return this.drawPass(c.MATERIAL_HIGHLIGHT,e,t)},e.prototype.drawPass=function(e,t,i){if(this.isEmpty()||e===c.MATERIAL_HIGHLIGHT&&!this.hasHighlights)return!1;if(this.processDirtyMaterials(),!i.views.some(function(e){return e.extent[0]!==e.extent[2]&&e.extent[1]!==e.extent[3]}))return!1;var o=this._renderTargets[t];if(!o)return!1;var a=this._rctx,s=a.gl,l=i.width,u=i.height;o.width===l&&o.height===u||(o.resize(l,u),o.colorTexture.setSamplingMode(9729));var d=_.camera;_.fbo=o,_.pixelRatio=i.pixelRatio||1,d.near=1,d.far=1e4,a.bindFramebuffer(o),a.setDepthTestEnabled(!1),a.setBlendFunctionSeparate(770,771,1,771),a.setClearColor.apply(a,this._clearColor),a.clear(s.COLOR_BUFFER_BIT);for(var p=0;p<i.views.length;p++){var f=i.views[p];d.viewport=f.viewport,r.mat4d.ortho(0,f.extent[2]-f.extent[0],0,f.extent[3]-f.extent[1],d.near,d.far,d.projectionMatrix),r.mat4d.identity(d.viewMatrix),r.mat4d.translate(d.viewMatrix,[-f.extent[0],-f.extent[1],0]),d.setGLViewport(this._rctx),n.OVERLAY_DRAW_TEST_TEXTURE&&this._drawTestTexture(l,u,b[i.index%b.length]),this._renderer.renderGeometryPass(e,_,null,null,this._sliceHelper)}return a.setDepthTestEnabled(!0),a.setBlendFunctionSeparate(770,771,1,771),a.bindFramebuffer(null),a.setViewport(0,0,this._canvas.width,this._canvas.height),o.colorTexture.descriptor.hasMipmap&&o.colorTexture.generateMipmap(),!0},e.prototype._drawTestTexture=function(e,t,n){var i=this._rctx,o=i.gl;if(!this._testPatternMat){for(var l=new Uint8Array(e*t*4),u=0,c=0;c<t;c++)for(var d=0;d<e;d++){var p=Math.floor(d/10),f=Math.floor(c/10);p<2||f<2||10*p>e-20||10*f>t-20?(l[u++]=255,l[u++]=255,l[u++]=255,l[u++]=255):(l[u++]=255,l[u++]=255,l[u++]=255,l[u++]=1&p&&1&f?1&d^1&c?0:255:1&p^1&f?0:128)}var m=new v(i,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:e,height:t},l);this._testPatternMat=new h(this._programRep,m,[1,1,1,1],!0,o.ALWAYS),this._testPatternBindParams={proj:r.mat4d.identity(),view:r.mat4d.identity(),nearFar:[-1,1],origin:[0,0,0],viewInvTransp:null,viewport:null,lightingData:null,fovY:0},this._quadVAO=s.createQuadVAO(i,a.Pos3Tex)}this._testPatternMat.setColor([n[0],n[1],n[2],1]),this._testPatternMat.bind(i,this._testPatternBindParams),this._testPatternMat.bindView(i,this._testPatternBindParams),i.bindVAO(this._quadVAO),i.drawArrays(5,0,g.vertexCount(this._quadVAO,"geometry")),this._testPatternMat.release(i)},e.prototype.getOrigin=function(e,t){var n=0,i=10*t/1e4;i>1&&(n=Math.ceil(p.logWithBase(i,2)));var o=1e4*Math.pow(2,n),a=Math.round(e[0]/o),s=Math.round(e[1]/o),l=Math.round(e[2]/o),u=n+"_"+a+"_"+s+"_"+l,c=this._id2origin[u];return null==c&&(c={vec3:r.vec3d.createFrom(a*o,s*o,l*o),id:u},this._id2origin[u]=c),c},e.prototype.materialChanged=function(e){this.onContentChanged&&this.onContentChanged()},e.prototype.createRenderTargetInternal=function(e,t){for(var r=e,n=0;this._renderTargets[r];)r=e+"_"+ ++n;return this._renderTargets[r]=m.createWithAttachments(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9987,hasMipmap:t,maxAnisotropy:8,width:0,height:0},{colorTarget:0,depthStencilTarget:0}),r},e}(),b=[[1,.5,.5],[.5,.5,1],[.5,1,.5]],_={fbo:null,camera:new i,pixelRatio:1};return y}.apply(null,n))||(e.exports=i)},843:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(364)],void 0===(i=function(e,t,r){return function(){function e(e){null==e?e=16:e<65536&&(e=r.nextHighestPowerOfTwo(e)),this.array=new Float32Array(e),this.size=0}return e.prototype.resize=function(e,t){var r,n;if(void 0===t&&(t=!1),this.size=e,this.size>this.array.length){for(r=this.array.length||1;r<this.size;)r*=2;return n=new Float32Array(r),t&&n.set(this.array),this.array=n,!0}if(this.size<=this.array.length/2){r=this.array.length;for(var i=2*this.size;r>=i;)r=Math.floor(r/2);return n=new Float32Array(r),t&&n.set(this.array.subarray(0,r)),this.array=n,!0}return!1},e.prototype.append=function(e){var t=this.size;this.resize(this.size+e.length,!0),this.array.set(e,t)},e.prototype.erase=function(e,t){for(var r=e;r<t;++r)this.array[r]=0},e.prototype.getArray=function(){return this.array},e.prototype.getSize=function(){return this.size},e}()}.apply(null,n))||(e.exports=i)},844:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(385),r(777),r(381)],void 0===(i=function(e,t,r,n,i){var o=function(){function e(e){this.isEnabled=!1,this.vertexAttributeLocations={position:0},this.vertexBufferLayout=[{name:"position",count:2,type:5126,offset:0,stride:8,normalized:!1}],this.rctx=e}return e.prototype.enable=function(){if(!this.isEnabled){var e=this.rctx;this.program=new n(e,a.shader.vertex,a.shader.fragment,this.vertexAttributeLocations);var t=new Float32Array([-1,-1,3,-1,-1,3]);this.vao=new i(e,this.vertexAttributeLocations,{geometry:this.vertexBufferLayout},{geometry:new r(e,34962,35044,t)}),this.isEnabled=!0}},e.prototype.disable=function(){this.isEnabled&&(this.program.dispose(),this.program=null,this.vao.dispose(),this.vao=null,this.isEnabled=!1)},e.prototype.render=function(e,t){this.enable();var r=this.rctx;r.bindVAO(this.vao),r.bindFramebuffer(t);var n={x:0,y:0,width:0,height:0};null!=t?(n.width=t.descriptor.width,n.height=t.descriptor.height):(n.width=r.gl.canvas.width,n.height=r.gl.canvas.height),r.bindProgram(this.program),r.bindTexture(e.colorTexture,0),this.program.setUniform1i("uColorTexture",0),this.program.setUniform2f("uRcpFrameDimension",1/n.width,1/n.height),r.setFaceCullingEnabled(!1),r.drawArrays(4,0,3)},e}(),a={shader:{vertex:"\n      #version 100\n      precision highp float;\n\n      attribute vec2 position;\n\n      varying   vec2 fCoordinate;\n\n      void main() {\n        fCoordinate = (position + 1.0 ) * 0.5;\n        gl_Position = vec4(position, -1, 1);\n      }",fragment:"\n      #version 100\n      #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      #else\n      precision mediump float;\n      #endif\n\n      /**\n       * @license\n       * Copyright (c) 2011 NVIDIA Corporation. All rights reserved.\n       *\n       * TO  THE MAXIMUM  EXTENT PERMITTED  BY APPLICABLE  LAW, THIS SOFTWARE  IS PROVIDED\n       * *AS IS*  AND NVIDIA AND  ITS SUPPLIERS DISCLAIM  ALL WARRANTIES,  EITHER  EXPRESS\n       * OR IMPLIED, INCLUDING, BUT NOT LIMITED  TO, NONINFRINGEMENT,IMPLIED WARRANTIES OF\n       * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO EVENT SHALL  NVIDIA\n       * OR ITS SUPPLIERS BE  LIABLE  FOR  ANY  DIRECT, SPECIAL,  INCIDENTAL,  INDIRECT,  OR\n       * CONSEQUENTIAL DAMAGES WHATSOEVER (INCLUDING, WITHOUT LIMITATION,  DAMAGES FOR LOSS\n       * OF BUSINESS PROFITS, BUSINESS INTERRUPTION, LOSS OF BUSINESS INFORMATION, OR ANY\n       * OTHER PECUNIARY LOSS) ARISING OUT OF THE  USE OF OR INABILITY  TO USE THIS SOFTWARE,\n       * EVEN IF NVIDIA HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.\n       */\n\n      #define FXAA_EDGE_THRESHOLD      (1.0/8.0)\n      #define FXAA_EDGE_THRESHOLD_MIN  (1.0/24.0)\n      #define FXAA_SEARCH_STEPS        16\n      #define FXAA_SEARCH_THRESHOLD    (1.0/4.0)\n      #define FXAA_SUBPIX_CAP          (3.0/4.0)\n      #define FXAA_SUBPIX_TRIM         (1.0/4.0)\n      #define FXAA_SUBPIX_TRIM_SCALE (1.0/(1.0 - FXAA_SUBPIX_TRIM))\n\n      uniform vec2 uRcpFrameDimension;\n      uniform sampler2D uColorTexture;\n      varying vec2 fCoordinate;\n\n      // Return the luma, the estimation of luminance from rgb inputs.\n      // This approximates luma using one FMA instruction,\n      // skipping normalization and tossing out blue.\n      // FxaaLuma() will range 0.0 to 2.963210702.\n      float FxaaLuma(vec3 rgb) {\n        return rgb.y * (0.587 / 0.299) + rgb.x;\n      }\n      vec3 FxaaLerp3(vec3 a, vec3 b, float amountOfA) {\n        return (vec3(-amountOfA) * b) + ((a * vec3(amountOfA)) + b);\n      }\n      vec4 FxaaTexOff(sampler2D tex, vec2 pos, ivec2 off, vec2 rcpFrame) {\n        float x = pos.x + float(off.x) * rcpFrame.x;\n        float y = pos.y + float(off.y) * rcpFrame.y;\n        return texture2D(tex, vec2(x, y));\n      }\n\n      // pos is the output of FxaaVertexShader interpolated across screen.\n      // xy -> actual texture position {0.0 to 1.0}\n      // rcpFrame should be a uniform equal to  {1.0/frameWidth, 1.0/frameHeight}\n      vec3 FxaaPixelShader(vec2 pos, sampler2D tex, vec2 rcpFrame) {\n        vec3 rgbN = FxaaTexOff(tex, pos.xy, ivec2( 0,-1), rcpFrame).xyz;\n        vec3 rgbW = FxaaTexOff(tex, pos.xy, ivec2(-1, 0), rcpFrame).xyz;\n        vec3 rgbM = FxaaTexOff(tex, pos.xy, ivec2( 0, 0), rcpFrame).xyz;\n        vec3 rgbE = FxaaTexOff(tex, pos.xy, ivec2( 1, 0), rcpFrame).xyz;\n        vec3 rgbS = FxaaTexOff(tex, pos.xy, ivec2( 0, 1), rcpFrame).xyz;\n        float lumaN = FxaaLuma(rgbN);\n        float lumaW = FxaaLuma(rgbW);\n        float lumaM = FxaaLuma(rgbM);\n        float lumaE = FxaaLuma(rgbE);\n        float lumaS = FxaaLuma(rgbS);\n        float rangeMin = min(lumaM, min(min(lumaN, lumaW), min(lumaS, lumaE)));\n        float rangeMax = max(lumaM, max(max(lumaN, lumaW), max(lumaS, lumaE)));\n        float range = rangeMax - rangeMin;\n        if (range < max(FXAA_EDGE_THRESHOLD_MIN, rangeMax * FXAA_EDGE_THRESHOLD)) {\n          return rgbM;\n        }\n        vec3 rgbL = rgbN + rgbW + rgbM + rgbE + rgbS;\n        float lumaL = (lumaN + lumaW + lumaE + lumaS) * 0.25;\n        float rangeL = abs(lumaL - lumaM);\n        float blendL = max(0.0, (rangeL / range) - FXAA_SUBPIX_TRIM) * FXAA_SUBPIX_TRIM_SCALE;\n        blendL = min(FXAA_SUBPIX_CAP, blendL);\n        vec3 rgbNW = FxaaTexOff(tex, pos.xy, ivec2(-1,-1), rcpFrame).xyz;\n        vec3 rgbNE = FxaaTexOff(tex, pos.xy, ivec2( 1,-1), rcpFrame).xyz;\n        vec3 rgbSW = FxaaTexOff(tex, pos.xy, ivec2(-1, 1), rcpFrame).xyz;\n        vec3 rgbSE = FxaaTexOff(tex, pos.xy, ivec2( 1, 1), rcpFrame).xyz;\n        rgbL += (rgbNW + rgbNE + rgbSW + rgbSE);\n        rgbL *= vec3(1.0/9.0);\n        float lumaNW = FxaaLuma(rgbNW);\n        float lumaNE = FxaaLuma(rgbNE);\n        float lumaSW = FxaaLuma(rgbSW);\n        float lumaSE = FxaaLuma(rgbSE);\n        float edgeVert =\n          abs((0.25 * lumaNW) + (-0.5 * lumaN) + (0.25 * lumaNE)) +\n          abs((0.50 * lumaW ) + (-1.0 * lumaM) + (0.50 * lumaE )) +\n          abs((0.25 * lumaSW) + (-0.5 * lumaS) + (0.25 * lumaSE));\n        float edgeHorz =\n          abs((0.25 * lumaNW) + (-0.5 * lumaW) + (0.25 * lumaSW)) +\n          abs((0.50 * lumaN ) + (-1.0 * lumaM) + (0.50 * lumaS )) +\n          abs((0.25 * lumaNE) + (-0.5 * lumaE) + (0.25 * lumaSE));\n        bool horzSpan = edgeHorz >= edgeVert;\n        float lengthSign = horzSpan ? -rcpFrame.y : -rcpFrame.x;\n        if(!horzSpan) {\n          lumaN = lumaW;\n          lumaS = lumaE;\n        }\n        float gradientN = abs(lumaN - lumaM);\n        float gradientS = abs(lumaS - lumaM);\n        lumaN = (lumaN + lumaM) * 0.5;\n        lumaS = (lumaS + lumaM) * 0.5;\n        if (gradientN < gradientS)\n        {\n          lumaN = lumaS;\n          lumaN = lumaS;\n          gradientN = gradientS;\n          lengthSign *= -1.0;\n        }\n        vec2 posN;\n        posN.x = pos.x + (horzSpan ? 0.0 : lengthSign * 0.5);\n        posN.y = pos.y + (horzSpan ? lengthSign * 0.5 : 0.0);\n        gradientN *= FXAA_SEARCH_THRESHOLD;\n        vec2 posP = posN;\n        vec2 offNP = horzSpan ? vec2(rcpFrame.x, 0.0) : vec2(0.0, rcpFrame.y);\n        float lumaEndN = lumaN;\n        float lumaEndP = lumaN;\n        bool doneN = false;\n        bool doneP = false;\n        posN += offNP * vec2(-1.0, -1.0);\n        posP += offNP * vec2( 1.0,  1.0);\n        for(int i = 0; i < FXAA_SEARCH_STEPS; i++) {\n          if(!doneN) {\n            lumaEndN = FxaaLuma(texture2D(tex, posN.xy).xyz);\n          }\n          if(!doneP) {\n            lumaEndP = FxaaLuma(texture2D(tex, posP.xy).xyz);\n          }\n          doneN = doneN || (abs(lumaEndN - lumaN) >= gradientN);\n          doneP = doneP || (abs(lumaEndP - lumaN) >= gradientN);\n          if(doneN && doneP) { break; }\n          if(!doneN) {\n            posN -= offNP;\n          }\n          if(!doneP) {\n            posP += offNP;\n          }\n        }\n        float dstN = horzSpan ? pos.x - posN.x : pos.y - posN.y;\n        float dstP = horzSpan ? posP.x - pos.x : posP.y - pos.y;\n        bool directionN = dstN < dstP;\n        lumaEndN = directionN ? lumaEndN : lumaEndP;\n        if(((lumaM - lumaN) < 0.0) == ((lumaEndN - lumaN) < 0.0)) {\n          lengthSign = 0.0;\n        }\n        float spanLength = (dstP + dstN);\n        dstN = directionN ? dstN : dstP;\n        float subPixelOffset = (0.5 + (dstN * (-1.0/spanLength))) * lengthSign;\n        vec3 rgbF = texture2D(tex, vec2(\n          pos.x + (horzSpan ? 0.0 : subPixelOffset),\n          pos.y + (horzSpan ? subPixelOffset : 0.0))).xyz;\n        return FxaaLerp3(rgbL, rgbF, blendL);\n      }\n\n      void main() {\n        vec4 color;\n        vec2 screenCoord = fCoordinate;\n        // if (screenCoord.x < 0.5) {\n          color.rgb = FxaaPixelShader(screenCoord, uColorTexture, uRcpFrameDimension);\n        // } else if (screenCoord.x < 0.501 && screenCoord.x > 0.499) {\n        //   color.rgb = vec3(1,0,0);\n        // } else {\n        //   color = texture2D(uColorTexture, fCoordinate);\n        // }\n        color.a = 1.0;\n        gl_FragColor = color;\n      }"}};return o}.apply(null,n))||(e.exports=i)},845:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(377)],void 0===(i=function(e,t,r){return function(){function e(e){this._rctx=e,this.fbo=null,this.viewportToRestore=null}return e.prototype.dispose=function(){this.fbo&&(this.fbo.dispose(),this.fbo=null)},Object.defineProperty(e.prototype,"framebuffer",{get:function(){return this.fbo},enumerable:!0,configurable:!0}),e.prototype.prepareHighlightPass=function(e){var t=this._rctx,r=t.gl,n=e.fullViewport,i=n[2],o=n[3];this.updateFBO(i,o),this.viewportToRestore=n,this._rctx.setViewport(0,0,i,o),t.bindFramebuffer(this.fbo),t.setClearColor(0,0,0,0),t.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT)},e.prototype.finish=function(e){var t=this._rctx;t.bindFramebuffer(e),t.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3])},e.prototype.updateFBO=function(e,t){this.fbo?this.fbo.resize(e,t):this.fbo=r.createWithAttachments(this._rctx,{target:3553,pixelFormat:6408,dataType:32819,samplingMode:9729,wrapMode:33071,width:e,height:t},{colorTarget:0,depthStencilTarget:1})},e}()}.apply(null,n))||(e.exports=i)},846:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(364)],void 0===(i=function(e,t,r){return function(){function e(e,t){null==t&&(t=4);var n=r.nextHighestPowerOfTwo(t*e);this.array=new Float32Array(n),this.zeroItem=new Float32Array(e),this.endSlot=0,this.perInstanceDataSize=e,this.emptySlots=[],this.emptySlotsIdx=0,this.id2slot={},this.slot2id=new Array(t)}return e.prototype.prepareFree=function(e){this.emptySlots.length+=e},e.prototype.free=function(e){var t=this.id2slot[e];null!=t&&(this.emptySlots[this.emptySlotsIdx++]=t,this.slot2id[t]=void 0)},e.prototype.prepareAllocate=function(e){var t=e-this.emptySlotsIdx;t>0&&this._resizeArray((this.endSlot+t)*this.perInstanceDataSize)},e.prototype.allocate=function(e){var t;return t=this.emptySlotsIdx>0?this.emptySlots[--this.emptySlotsIdx]:this.endSlot++,this.id2slot[e]=t,this.slot2id[t]=e,t},e.prototype.getSlot=function(e){return this.id2slot[e]},e.prototype.getOffset=function(e){return e*this.perInstanceDataSize},e.prototype.getArray=function(){return this.array},e.prototype.fill=function(e,t,r){this.array.set(r,e*this.perInstanceDataSize+t)},e.prototype.compact=function(){if(this.emptySlotsIdx>0){for(this.emptySlots.length=this.emptySlotsIdx,this.emptySlots.sort(function(e,t){return e-t});this.emptySlotsIdx>0&&this.emptySlots[this.emptySlotsIdx-1]===this.endSlot;)this.emptySlotsIdx--,this.endSlot--;for(;this.emptySlotsIdx>0;){this.emptySlotsIdx--;var e=this.endSlot-1,t=this.emptySlots[this.emptySlotsIdx],r=e*this.perInstanceDataSize,n=t*this.perInstanceDataSize;this.array.set(this.array.subarray(r,r+this.perInstanceDataSize),n),this.array.set(this.zeroItem,r);var i=this.slot2id[e];this.slot2id[e]=void 0,this.slot2id[t]=i,this.id2slot[i]=t,this.endSlot--}}return this._resizeArray(this.endSlot*this.perInstanceDataSize),this.emptySlots.length=0,this.array},e.prototype._resizeArray=function(e){var t,r;if(e>this.array.length){for(t=this.array.length||1;t<e;)t*=2;(r=new Float32Array(t)).set(this.array),this.array=r}else if(e<=this.array.length/2){t=this.array.length;for(var n=2*e;t>=n;)t/=2;(r=new Float32Array(t)).set(this.array.subarray(0,t)),this.array=r}},e}()}.apply(null,n))||(e.exports=i)},847:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){return function(){function e(){}return e.copyIntervals=function(e){for(var t=[],r=0;r<e.length;r++){var n=e[r];t.push([n[0],n[1]])}return t},e.convertFaceToIndexRange=function(e,t){for(var r=0;r<e.length;r++){var n=e[r];n[0]=n[0]*t,n[1]=n[1]*t+(t-1)}},e.sortIntervals=function(e){return e.sort(function(e,t){return e[0]===t[0]?e[1]>t[1]?1:e[1]<t[1]?-1:0:e[0]>t[0]?1:e[0]<t[0]?-1:0})},e.intersectIntervals=function(e,t){if(e.length<=0)return[];for(var r=[],n=0;n<e.length;n++){var i=e[n];if(!(i[1]<t[0]||i[0]>t[1])){var o=[i[0],i[1]];o[0]<t[0]&&(o[0]=t[0]),o[1]>t[1]&&(o[1]=t[1]),r.push(o)}}return r},e.mergeIntervals=function(e){if(e.length<=0)return[];var t=[];e=this.sortIntervals(e),t.push(e[0]);for(var r=1;r<e.length;r++){var n=t[t.length-1];n[1]+1<e[r][0]?t.push(e[r]):n[1]<e[r][1]&&(n[1]=e[r][1],t.pop(),t.push(n))}return t},e.invertIntervals=function(e,t){for(var r=[],n=0,i=0;i<e.length;i++){var o=e[i];o[0]>n&&r.push([n,o[0]-1]),n=o[1]+1}return n<=t&&r.push([n,t]),r},e.offsetIntervals=function(e,t){for(var r=[],n=0;n<e.length;n++){var i=e[n];r.push([i[0]+t,i[1]+t])}return r},e}()}.apply(null,n))||(e.exports=i)},848:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(349),r(377)],void 0===(i=function(e,t,r,n){return function(){function e(e){this._rctx=e,this._depthFBO=void 0,this.viewportToRestore=null,this.width=null,this.height=null}return Object.defineProperty(e.prototype,"enabled",{get:function(){return void 0!==this._depthFBO},set:function(e){e!==this.enabled&&(e?this.enable():this.disable())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"framebuffer",{get:function(){return this._depthFBO},enumerable:!0,configurable:!0}),e.prototype.setupFBOs=function(e){r.assert(this.enabled);var t=e.fullViewport;this.viewportToRestore=t,this.width=t[2],this.height=t[3],this._rctx.setViewport(0,0,this.width,this.height)},e.prototype.prepareDepthPass=function(){r.assert(this.enabled);var e=this._rctx,t=e.gl;this._depthFBO.resize(this.width,this.height),e.bindFramebuffer(this._depthFBO),e.setClearStencil(0),e.setClearColor(0,0,0,0),e.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT),e.setBlendingEnabled(!1)},e.prototype.finish=function(e){var t=this._rctx;t.bindFramebuffer(e),t.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3])},e.prototype.enable=function(){r.assert(!this.enabled),this._depthFBO=n.createWithAttachments(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:0,height:0},{colorTarget:0,depthStencilTarget:3})},e.prototype.disable=function(){r.assert(this.enabled),this._depthFBO.dispose(),this._depthFBO=void 0},e}()}.apply(null,n))||(e.exports=i)},849:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(349),r(377)],void 0===(i=function(e,t,r,n){return function(){function e(e){this.rctx=e,this.normalFBO=void 0,this.viewportToRestore=null,this.width=null,this.height=null}return Object.defineProperty(e.prototype,"enabled",{get:function(){return void 0!==this.normalFBO},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"framebuffer",{get:function(){return this.normalFBO},enumerable:!0,configurable:!0}),e.prototype.setupFBOs=function(e){r.assert(this.enabled);var t=e.fullViewport;this.viewportToRestore=t,this.width=t[2],this.height=t[3],this.rctx.setViewport(0,0,this.width,this.height)},e.prototype.prepareNormalPass=function(){r.assert(this.enabled);var e=this.rctx,t=e.gl;this.normalFBO.resize(this.width,this.height),e.bindFramebuffer(this.normalFBO),e.setClearColor(0,0,0,0),e.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)},e.prototype.finish=function(e){var t=this.rctx;t.bindFramebuffer(e),t.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3])},e.prototype.enable=function(){this.enabled||(this.normalFBO=n.createWithAttachments(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:0,height:0},{colorTarget:0,depthStencilTarget:1}))},e.prototype.disable=function(){this.enabled&&(this.normalFBO.dispose(),this.normalFBO=void 0)},e}()}.apply(null,n))||(e.exports=i)},850:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(595),r(419)],void 0===(i=function(e,t,r,n){return function(){function e(){this.camera=null,this.pixelRatio=1,this.depth=null,this.highlight=null,this.lightingData=null,this.normals=null,this.pass=r.MATERIAL,this.shadowMap=null,this.slot=n.BACKGROUND,this.ssaoHelper=null,this.offscreenRenderingHelper=null,this.sliceHelper=null,this.stencilRenderingHelper=null,this.framebufferTex=null,this.rctx=null,this.options=null,this.renderOccludedOnly=!1}return Object.defineProperty(e.prototype,"isHighlightPass",{get:function(){return this.pass===r.MATERIAL_HIGHLIGHT},enumerable:!0,configurable:!0}),e}()}.apply(null,n))||(e.exports=i)},851:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(684),r(419)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.pluginContext=e,this.pluginsChanged=!1,this.renderPlugins=new Array,this.slots=[];for(var t=0;t<n.MAX_SLOTS;++t)this.slots[t]=[]}return e.prototype.add=function(e,t){this.renderPlugins.push(t);for(var r=0;r<e.length;++r){var n=e[r];this.slots[n].push(t)}t.initializeRenderContext(this.pluginContext),this.pluginsChanged=!0},e.prototype.remove=function(e){this.renderPlugins=this.renderPlugins.filter(function(t){return t!==e});for(var t=0;t<this.slots.length;++t)this.slots[t]=this.slots[t].filter(function(t){return t!==e});e.uninitializeRenderContext(this.pluginContext),this.pluginsChanged=!0},e.prototype.prepareRender=function(e){for(var t=0,r=this.renderPlugins;t<r.length;t++){var n=r[t];n.prepareRender&&n.prepareRender(e)}},e.prototype.render=function(e,t){t.slot=e;for(var r=!1,n=0,i=this.slots[e];n<i.length;n++){var o=i[n];o.render(t)&&(o.didRender=!0,r=!0)}return r},e.prototype.queryDepthRange=function(e){var t=o;t.near=1/0,t.far=-1/0;for(var n=0,i=this.renderPlugins;n<i.length;n++){var a=i[n];if(a.queryDepthRange){var s=a.queryDepthRange(e);s&&r.union(t,s,t)}}return t},e.prototype.needsRender=function(){if(this.pluginsChanged)return!0;for(var e=0,t=this.renderPlugins;e<t.length;e++)if(t[e].needsRender)return!0;return!1},e.prototype.needsHighlight=function(){for(var e=0,t=this.renderPlugins;e<t.length;e++)if(t[e].needsHighlight)return!0;return!1},e.prototype.needsLinearDepth=function(){for(var e=0,t=this.renderPlugins;e<t.length;e++)if(t[e].needsLinearDepth)return!0;return!1},e.prototype.resetNeedsRender=function(){this.pluginsChanged=!1;for(var e=0,t=this.renderPlugins;e<t.length;e++){var r=t[e];r.resetNeedsRender?r.resetNeedsRender():r.didRender&&(r.needsRender=!1,r.didRender=!1)}},e}();t.RenderPluginManager=i;var o={near:0,far:0}}.apply(null,n))||(e.exports=i)},852:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(640),r(385),r(377),r(777),r(371),r(381)],void 0===(i=function(e,t,n,i,o,a,s,l){return function(){function e(e){this._isLoadingResources=!1,this.isEnabled=!1,this.vertexAttributeLocations={vPosition:0},this.vertexBufferLayout=[{name:"vPosition",count:2,type:5126,offset:0,stride:8,normalized:!1}],this.rctx=e}return e.prototype.loadResources=function(e){var t=this;return!!this.data||(this._isLoadingResources=!0,r.e(110).then(function(){var n=[r(1084)];(function(r){t.data=r,t._isLoadingResources=!1,e&&e()}).apply(null,n)}).catch(r.oe),!1)},Object.defineProperty(e.prototype,"isLoadingResources",{get:function(){return this._isLoadingResources},enumerable:!0,configurable:!0}),e.prototype.enable=function(){if(this.isEnabled)return!0;if(!this.loadResources())return!1;var e=this.rctx;this.programEdgeDetect=new a(e,this.data.edgeDetectShader.vertex,this.data.edgeDetectShader.fragment,this.vertexAttributeLocations),this.programBlendWeights=new a(e,this.data.blendWeightShader.vertex,this.data.blendWeightShader.fragment,this.vertexAttributeLocations),this.programBlur=new a(e,this.data.blurShader.vertex,this.data.blurShader.fragment,this.vertexAttributeLocations);var t=new Float32Array([-1,-1,3,-1,-1,3]);return this.vao=new l(e,this.vertexAttributeLocations,{geometry:this.vertexBufferLayout},{geometry:new i(e,34962,35044,t)}),this.tmpFramebufferEdges=o.createWithAttachments(this.rctx,{target:3553,pixelFormat:6407,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4},{colorTarget:0,depthStencilTarget:0}),this.tmpFramebufferBlend=o.createWithAttachments(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4},{colorTarget:0,depthStencilTarget:0}),this.textureArea=this.loadTextureFromBase64(this.data.areaTexture,9729,6407),this.textureSearch=this.loadTextureFromBase64(this.data.searchTexure,9728,6409),this.isEnabled=!0,!0},e.prototype.disable=function(){this.isEnabled&&(this.programEdgeDetect.dispose(),this.programEdgeDetect=null,this.programBlendWeights.dispose(),this.programBlendWeights=null,this.programBlur.dispose(),this.programBlur=null,this.vao.dispose(),this.vao=null,this.textureArea.dispose(),this.textureArea=null,this.textureSearch.dispose(),this.textureSearch=null,this.tmpFramebufferBlend.dispose(),this.tmpFramebufferBlend=null,this.tmpFramebufferEdges.dispose(),this.tmpFramebufferEdges=null,this.isEnabled=!1)},e.prototype.render=function(e,t){this.enable();var r=this.rctx,n={x:0,y:0,width:0,height:0};null!=t?(n.width=t.descriptor.width,n.height=t.descriptor.height):(n.width=r.gl.canvas.width,n.height=r.gl.canvas.height),r.bindVAO(this.vao),r.setFaceCullingEnabled(!0),r.setCullFace(1029),r.setFrontFace(2305),r.setBlendingEnabled(!1),r.setDepthTestEnabled(!1),r.setViewport(n.x,n.y,n.width,n.height),this.tmpFramebufferEdges.resize(n.width,n.height),r.bindFramebuffer(this.tmpFramebufferEdges),r.setClearColor(0,0,0,1),r.clear(r.gl.COLOR_BUFFER_BIT),r.bindProgram(this.programEdgeDetect),r.bindTexture(e.colorTexture,0),this.programEdgeDetect.setUniform1i("tColor",0),this.programEdgeDetect.setUniform4f("uResolution",1/n.width,1/n.height,n.width,n.height),r.drawArrays(4,0,3),this.tmpFramebufferBlend.resize(n.width,n.height),r.bindFramebuffer(this.tmpFramebufferBlend),r.setClearColor(0,0,1,1),r.clear(r.gl.COLOR_BUFFER_BIT),r.bindProgram(this.programBlendWeights),this.programBlendWeights.setUniform4f("uResolution",1/n.width,1/n.height,n.width,n.height),r.bindTexture(this.textureSearch,1),this.programBlendWeights.setUniform1i("tSearch",1),r.bindTexture(this.textureArea,2),this.programBlendWeights.setUniform1i("tArea",2),r.bindTexture(this.tmpFramebufferEdges.colorTexture,3),this.programBlendWeights.setUniform1i("tEdges",3),r.drawArrays(4,0,3),r.bindFramebuffer(t),r.setClearColor(0,1,0,1),r.clear(r.gl.COLOR_BUFFER_BIT),r.bindProgram(this.programBlur),this.programBlur.setUniform4f("uResolution",1/n.width,1/n.height,n.width,n.height),r.bindTexture(e.colorTexture,0),this.programBlur.setUniform1i("tColor",0),r.bindTexture(this.tmpFramebufferBlend.colorTexture,1),this.programBlur.setUniform1i("tBlendWeights",1),r.drawArrays(4,0,3),r.setDepthTestEnabled(!0)},e.prototype.loadTextureFromBase64=function(e,t,r){var i=new s(this.rctx,{pixelFormat:r,dataType:5121,wrapMode:33071,samplingMode:t},null);return n.requestImage(e).then(function(e){i.resize(e.width,e.height),i.setData(e)}),i},e}()}.apply(null,n))||(e.exports=i)},853:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(349)],void 0===(i=function(e,t,r){return function(){function e(e){this._enabled=!1,this._rctx=e}return Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0}),e.prototype.prepareStencilWritePass=function(){r.assert(this.enabled);var e=this._rctx;e.setStencilFunction(519,1,255),e.setStencilOp(7680,7680,7681),e.setStencilWriteMask(255)},e.prototype.finish=function(){if(this.enabled){var e=this._rctx;e.setStencilFunction(519,0,0),e.setStencilOp(7680,7680,7680)}},e.prototype.enableStencilRead=function(){this.enabled&&this._rctx.setStencilFunction(517,1,255)},e.prototype.disableStencilRead=function(){this.enabled&&this._rctx.setStencilFunction(519,0,0)},e.prototype.enable=function(){this._enabled=!0,this._rctx.setStencilTestEnabled(!0)},e.prototype.disable=function(){this._enabled=!1,this._rctx.setStencilTestEnabled(!1)},e}()}.apply(null,n))||(e.exports=i)},854:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(345),r(404),r(398),r(382),r(340),r(454),r(443),r(344),r(364),r(618),r(754),r(631),r(737),r(855),r(808),r(856),r(809),r(965),r(1008),r(686),r(860),r(862),r(863),r(385),r(381),r.dj.m(e)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,c,d,p,f,h,m,v,g,y,b,_,x,w,S,T,E,C,O){Object.defineProperty(t,"__esModule",{value:!0});var P=function(){function t(e,t,r){this.rctx=e,this.programRepository=t,this.callbacks=r,this.profilingCallback=null,this.perObjectData=new Map,this.renderers=new Map,this.localOrigins=new m.LocalOriginManager(new g(1e4)),this.numberOfRenderedEdges=0,this.gpuMemoryUsage=0,this.worker=new x,this.workerThread=null,this.destroyed=!1,this.tmpModelPosition=u.vec3d.create(),this.tmpCameraPosition=u.vec3d.create(),this.componentColorManager=new y.BufferManager(this.rctx,2)}return t.prototype.initialize=function(){var t=this;l.open(s.getAbsMid("./EdgeProcessingWorker",e,O),{client:this}).then(function(e){t.destroyed?e.close():t.workerThread=e});for(var r=b.VertexLayout.createBuffer(4),n=0;n<4;n++)r.sideness.set(n,0,0===n||3===n?0:1),r.sideness.set(n,1,0===n||1===n?0:1);this.verticesBufferObject=E.createVertex(this.rctx,35044,r.buffer)},t.prototype.destroy=function(){this.destroyed||(this.workerThread&&(this.workerThread.close(),this.workerThread=null),this.verticesBufferObject&&(this.verticesBufferObject.dispose(),this.verticesBufferObject=null),this.destroyed=!0)},t.prototype.getGpuMemoryUsage=function(){return this.gpuMemoryUsage},Object.defineProperty(t.prototype,"numberOfRenderedPrimitives",{get:function(){return this.numberOfRenderedEdges},enumerable:!0,configurable:!0}),t.prototype.shouldRender=function(){return this.renderers.size>0},t.prototype.addObject=function(e,t,r){return n(this,void 0,void 0,function(){var n,o,s,l,u,c;return i(this,function(i){switch(i.label){case 0:if(this.hasObject(e))return[2];if(n=new Array,s={loaded:a.create(function(e){return o=e}),renderables:[]},this.perObjectData.set(e,s),r&&r.mergeGeometries&&e.geometries.length>1&&this.canMergeGeometries(e))n.push(this.addObjectMergedGeometries(e,s,t));else for(l=0;l<e.geometries.length;l++)u=e.geometries[l],c=e.geometryRecords[l],c.materials[0].supportsEdges&&(u.data instanceof v?n.push(this.addGeometryPreinterleaved(e,s,u,u.data,c,t)):n.push(this.addGeometryNonPreinterleaved(e,s,u,u.data,c,t[0])));return[4,a.all(n)];case 1:return i.sent(),this.callbacks.setNeedsRender(),o(),[2]}})})},t.prototype.hasObject=function(e){return this.perObjectData.has(e)},t.prototype.updateAllComponentOpacities=function(e,t){return n(this,void 0,void 0,function(){var r,n;return i(this,function(i){switch(i.label){case 0:return(r=this.perObjectData.get(e))?[4,r.loaded]:[2];case 1:return i.sent(),n=t instanceof Array?function(e){return t[e]}:function(e){return t},r.renderables.forEach(function(e){for(var t=e.components.meta.length,r=0;r<t;r++){var i=n(r),o=e.components.meta[r],a=o.index;o.material.opacity=i,e.components.buffer.textureBuffer.setDataElement(a,1,3,255*i)}e.allTransparent=T.determineAllTransparent(e.components.meta)}),this.callbacks.setNeedsRender(),[2]}})})},t.prototype.updateAllComponentMaterials=function(e,t){return n(this,void 0,void 0,function(){var r,n=this;return i(this,function(i){switch(i.label){case 0:return(r=this.perObjectData.get(e))?[4,r.loaded]:[2];case 1:return i.sent(),r.renderables.forEach(function(e){var r=t[0],i=T.determineRequiresUberRenderer(t),o=w.EdgeRenderer.getKey(i,r.type,r.slicePlaneEnabled);if(o!==e.rendererKey){var a=n.renderers.get(e.rendererKey),s=n.aquireRenderer(i,r);a.removeRenderable(e),a.refCount.decrement(),e.rendererKey=o,s.addRenderable(e)}for(var l=0;l<t.length;l++)e.components.meta[l].material=t[l];n.updateComponentBuffer(e.components),e.allTransparent=T.determineAllTransparent(e.components.meta)}),this.callbacks.setNeedsRender(),[2]}})})},t.prototype.updateObjectVisibility=function(e,t){return n(this,void 0,void 0,function(){var r;return i(this,function(n){switch(n.label){case 0:return(r=this.perObjectData.get(e))?[4,r.loaded]:[2];case 1:return n.sent(),r.renderables.forEach(function(e){e.visible=t}),this.callbacks.setNeedsRender(),[2]}})})},t.prototype.removeObject=function(e){var t=this,r=this.perObjectData.get(e);r&&(this.perObjectData.delete(e),r.loaded.then(function(){r.renderables.forEach(function(e){t.removeRenderable(e)}),t.callbacks.setNeedsRender()}))},t.prototype.removeAll=function(){var e=this;this.perObjectData.forEach(function(t,r){e.removeObject(r)})},t.prototype.createSolidEdgeMaterial=function(e){return r({},A,e,{type:"solid"})},t.prototype.createSketchEdgeMaterial=function(e){return r({},I,e,{type:"sketch"})},t.prototype.render=function(e){var t=this;this.localOrigins.updateViewMatrices(e.view),this.renderers.forEach(function(e){0===e.refCount.value&&(t.renderers.delete(e.key),e.dispose())}),this.componentColorManager.garbageCollect(),this.componentColorManager.updateTextures();var r=e.view,n=0,i=0;this.renderers.forEach(function(e){e.forEachRenderable(function(e){n+=e.statistics.averageEdgeLength,i++})});var o={distanceFalloffFactor:40*(n/i),minimumEdgeLength:T.estimateLengthAtDistance(e.viewport[3],e.fovY,1,3.5)},a=this.rctx.capabilities.blendMinMax;a?(this.rctx.setDepthWriteEnabled(!1),this.rctx.setBlendingEnabled(!0),this.rctx.setBlendEquationSeparate(32774,a.MAX),this.rctx.setBlendFunctionSeparate(1,0,1,1)):(this.rctx.setDepthWriteEnabled(!0),this.rctx.setBlendingEnabled(!1)),this.rctx.setDepthTestEnabled(!0),this.rctx.setDepthFunction(515),this.updateObjectCameraDistances(e),this.numberOfRenderedEdges=0,this.renderers.forEach(function(r){t.renderRegularEdges(r,e,o),t.renderSilhouetteEdges(r,e,o)}),this.rctx.setDepthWriteEnabled(!0),this.rctx.setDepthFunction(513),this.rctx.setBlendEquationSeparate(32774,32774),this.rctx.setBlendFunctionSeparate(1,0,1,1),e.view=r},t.prototype.computeModelTransformWithLocalOrigin=function(e,t,r){if(e.getCombinedStaticTransformation(t,r),t.origin)this.localOrigins.register(t.origin);else{var n=u.vec3d.set3(r[12],r[13],r[14],this.tmpModelPosition);t.origin=this.localOrigins.aquire(n)}return h.applyToModelMatrix(t.origin.vec3,r),r},t.prototype.updateComponentBuffer=function(e){for(var t=e.meta,r=e.buffer,n=0;n<t.length;n++){var i=t[n].material,o=t[n].index,a=c.clamp(Math.round(i.size*w.LINE_WIDTH_FRACTION_FACTOR),0,255),s=c.clamp(i.extensionLength,-w.EXTENSION_LENGTH_OFFSET,255-w.EXTENSION_LENGTH_OFFSET)+w.EXTENSION_LENGTH_OFFSET,l="solid"===i.type?0:1,u=255*i.opacity,d=i.color,p=255*d[0],f=255*d[1],h=255*d[2],m=255*d[3];r.textureBuffer.setData(o,0,p,f,h,m),r.textureBuffer.setData(o,1,a,s,l,u)}},t.prototype.createComponentBuffers=function(e){for(var t=[],r=this.componentColorManager.getBuffer(e.length),n=0;n<e.length;n++){var i=e[n],o=r.aquireIndex();t.push({index:o,material:i})}var a={meta:t,buffer:r};return this.updateComponentBuffer(a),a},t.prototype.extractEdges=function(e,t,r,n){return this.worker.process({data:t,originalIndices:n,writerSettings:e,skipDeduplicate:r},this.workerThread)},t.prototype.createEdgeResources=function(e){var t={};if(e.regular.lodInfo.lengths.length>0){var r=new C(this.rctx,b.EdgeShaderAttributeLocations,{vertices:b.glVertexLayout,instances:_.RegularEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:E.createVertex(this.rctx,35044,e.regular.instancesData.buffer)});t.regular={vao:r,lod:e.regular.lodInfo}}if(e.silhouette.lodInfo.lengths.length>0){r=new C(this.rctx,b.EdgeShaderAttributeLocations,{vertices:b.glVertexLayout,instances:_.SilhouetteEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:E.createVertex(this.rctx,35044,e.silhouette.instancesData.buffer)});t.silhouette={vao:r,lod:e.silhouette.lodInfo}}return t},t.prototype.disposeEdgeResources=function(e){e.regular&&(e.regular.vao.vertexBuffers.instances.dispose(),e.regular.vao.dispose(!1),e.regular.vao=null),e.silhouette&&(e.silhouette.vao.vertexBuffers.instances.dispose(),e.silhouette.vao.dispose(!1),e.silhouette.vao=null)},t.prototype.addGeometryNonPreinterleaved=function(e,t,r,o,a,s){return n(this,void 0,void 0,function(){var r,n,l,c;return i(this,function(i){switch(i.label){case 0:return r=o.getAttribute("position"),n=this.computeModelTransformWithLocalOrigin(e,a,u.mat4d.create()),l=a.origin,c={position:r,indices:o.getIndices("position"),modelTransform:n,origin:l},[4,this.addNonPreinterleaved(e,t,c,s)];case 1:return i.sent(),[2]}})})},t.prototype.addNonPreinterleaved=function(e,t,r,o){return n(this,void 0,void 0,function(){var e,n,a,s,l,u,c,d,p,f,h,m,v,g,y;return i(this,function(i){switch(i.label){case 0:for(e=this.aquireRenderer(!1,o),n=r.modelTransform,a=r.origin,s=r.indices,l=r.position,u=l.data.length/l.strideIdx,c=b.EdgeInputBufferLayout.createBuffer(u),d=0;d<u;d++)c.position.set(d,0,l.data[l.offsetIdx+d*l.strideIdx+0]),c.position.set(d,1,l.data[l.offsetIdx+d*l.strideIdx+1]),c.position.set(d,2,l.data[l.offsetIdx+d*l.strideIdx+2]);return p=this.createComponentBuffers([o]),T.fillComponenBufferIndices(p.meta,[0,c.componentIndex.count],c.componentIndex),[4,this.extractEdges(e.writerSettings,c,!1,s)];case 1:return f=i.sent(),h=this.createEdgeResources(f),m=h.regular,v=h.silhouette,g=(m?m.vao.size:0)+(v?v.vao.size:0),y={regular:m,silhouette:v,transform:{modelMatrix:n,origin:a},statistics:{gpuMemoryUsage:g,averageEdgeLength:f.averageEdgeLength},components:p,visible:!0,allTransparent:T.determineAllTransparent(p.meta),distanceToCamera:0,rendererKey:e.key},t.renderables.push(y),e.addRenderable(y),this.gpuMemoryUsage+=g,[2]}})})},t.prototype.addGeometryPreinterleaved=function(e,t,r,o,a,s){return n(this,void 0,void 0,function(){var r,n,l,c,h,m,v,g,y,_,x,w,S,E,C,O,P;return i(this,function(i){switch(i.label){case 0:return(r=o.getAttribute("position"))&&f.isFloat32Array(r.data)?(n=s[0],l=T.determineRequiresUberRenderer(s),c=this.aquireRenderer(l,n),h=this.computeModelTransformWithLocalOrigin(e,a,u.mat4d.create()),m=a.origin,v=o.getIndices("position"),g=new d.BufferViewVec3f(r.data.buffer,4*r.offsetIdx,4*r.strideIdx),y=b.EdgeInputBufferLayout.createBuffer(g.count),p.unrolledCopyVec3(y.position,g),_=this.createComponentBuffers(s),T.fillComponenBufferIndices(_.meta,o.componentOffsets,y.componentIndex,v),x=o.hasPositionData,[4,this.extractEdges(c.writerSettings,y,x,v)]):(console.warn("Geometry has no float32 `position` attribute, skipping it."),[2]);case 1:return w=i.sent(),S=this.createEdgeResources(w),E=S.regular,C=S.silhouette,O=(E?E.vao.size:0)+(C?C.vao.size:0),P={regular:E,silhouette:C,transform:{modelMatrix:h,origin:m},statistics:{gpuMemoryUsage:O,averageEdgeLength:w.averageEdgeLength},components:_,visible:!e.isHidden(a),allTransparent:T.determineAllTransparent(_.meta),distanceToCamera:0,rendererKey:c.key},t.renderables.push(P),c.addRenderable(P),this.gpuMemoryUsage+=O,[2]}})})},t.prototype.canMergeGeometries=function(e){for(var t=null,r=null,n=0;n<e.geometries.length;n++){var i=e.geometries[n],a=e.geometryRecords[n];if(a.materials[0].supportsEdges){if(i.data instanceof v)return!1;if(t){if(!o.equals(t,a.transformation))return!1}else t=a.transformation;if(!r&&a.origin)r=a;else if(r&&a.origin&&r.origin.id!==a.origin.id)return!1}}return!0},t.prototype.addObjectMergedGeometries=function(e,t,r){return n(this,void 0,void 0,function(){var n,o,a,s,l,c,d,p,h,m,v,g,y,b,_,x,w,S,T,E;return i(this,function(i){switch(i.label){case 0:for(n=new Map,o=0,a=null,s=null,T=0;T<e.geometries.length;T++)h=e.geometries[T],l=e.geometryRecords[T],l.materials[0].supportsEdges&&(!s&&l.origin&&(s=l),g=h.data.getIndices("position"),o+=g?g.length:0,(g&&null==a||a===Uint16Array)&&(a=f.isUint16Array(g)?Uint16Array:Uint32Array));for(c=o?new a(o):null,d=[],p=0,T=0;T<e.geometries.length;T++)if(h=e.geometries[T],m=e.geometryRecords[T],m.materials[0].supportsEdges){if(v=h.data.getAttribute("position"),g=h.data.getIndices("position"),null==(y=n.get(v.data))){for(y=d.length/3,b=v.offsetIdx;b<v.data.length;b+=v.strideIdx)d.push(v.data[b+0]),d.push(v.data[b+1]),d.push(v.data[b+2]);n.set(v.data,y)}if(g)for(_=0;_<g.length;_++)c[p++]=y+g[_]}for(x=s||e.geometryRecords[0],w=this.computeModelTransformWithLocalOrigin(e,x,u.mat4d.create()),S=x.origin,T=0;T<e.geometryRecords.length;T++)e.geometryRecords[T].origin=S;return E={position:{data:d,offsetIdx:0,strideIdx:3},indices:c,modelTransform:w,origin:S},[4,this.addNonPreinterleaved(e,t,E,r[0])];case 1:return i.sent(),[2]}})})},t.prototype.aquireRenderer=function(e,t){var r=w.EdgeRenderer.getKey(e,t.type,t.slicePlaneEnabled),n=this.renderers.get(r);return this.strokesTexture||(this.strokesTexture=S.generateStrokesTexture(this.rctx)),n||(n=new w.EdgeRenderer(this.rctx,this.programRepository,{type:t.type,slicePlaneEnabled:t.slicePlaneEnabled,strokesTexture:this.strokesTexture,uber:e}),this.renderers.set(r,n)),n.refCount.increment(),n},t.prototype.removeRenderable=function(e){var t=this.renderers.get(e.rendererKey);t.removeRenderable(e),t.refCount.decrement(),this.disposeEdgeResources(e),this.localOrigins.release(e.transform.origin),this.gpuMemoryUsage-=e.statistics.gpuMemoryUsage;for(var r=0,n=e.components.meta;r<n.length;r++){var i=n[r];e.components.buffer.releaseIndex(i.index)}},t.prototype.updateObjectCameraDistances=function(e){var t=this,r=e.viewInvTransp;u.vec3d.set3(r[3],r[7],r[11],this.tmpCameraPosition),this.perObjectData.forEach(function(e,r){var n=u.vec3d.dist(r.getCenter(),t.tmpCameraPosition);e.renderables.forEach(function(e){return e.distanceToCamera=n})})},t.prototype.renderRegularEdges=function(e,t,r){var n=this;e.bindRegularEdges(t,r),e.forEachRenderable(function(i){if(i.visible&&i.regular&&!i.allTransparent){var o=T.computeEdgeCount(i.regular.lod.lengths,i.distanceToCamera,r);t.view=n.localOrigins.getViewMatrix(i.transform.origin),e.renderRegularEdges(i,t,o),n.numberOfRenderedEdges+=o}})},t.prototype.renderSilhouetteEdges=function(e,t,r){var n=this;e.bindSilhouetteEdges(t,r),e.forEachRenderable(function(i){if(i.visible&&i.silhouette&&!i.allTransparent){var o=T.computeEdgeCount(i.silhouette.lod.lengths,i.distanceToCamera,r);t.view=n.localOrigins.getViewMatrix(i.transform.origin),e.renderSilhouetteEdges(i,t,o),n.numberOfRenderedEdges+=o}})},t}();t.EdgeView=P;var A={color:u.vec4d.createFrom(0,0,0,.2),size:1,extensionLength:0,opacity:1,slicePlaneEnabled:!1},I={color:u.vec4d.createFrom(0,0,0,.2),size:1,extensionLength:0,opacity:1,slicePlaneEnabled:!1}}.apply(null,n))||(e.exports=i)},855:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(344),r(737)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.factory=e,this.originData=new Map}return e.prototype.aquire=function(e){return this.register(this.factory.getOrigin(e))},e.prototype.register=function(e){var t=this.originData.get(e.id);return t?(t.refCount++,t.origin):(this.originData.set(e.id,{refCount:1,viewMatrix:r.mat4d.identity(),origin:e}),e)},e.prototype.release=function(e){var t=this.originData.get(e.id);t&&0==--t.refCount&&this.originData.delete(e.id)},e.prototype.updateViewMatrices=function(e){this.originData.forEach(function(t){r.mat4d.set(e,t.viewMatrix),n.applyToViewMatrix(t.origin.vec3,t.viewMatrix)})},e.prototype.getViewMatrix=function(e){return this.originData.get(e.id).viewMatrix},e}();t.LocalOriginManager=i}.apply(null,n))||(e.exports=i)},856:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){return function(){function e(e){this._gridSize=e,this._origins={}}return e.prototype.getOrigin=function(t){var r=this._gridSize,n=Math.round(t[0]/r),i=Math.round(t[1]/r),o=Math.round(t[2]/r),a=""+e.ORIGIN_PREFIX+n+"/"+i+"/"+o,s=this._origins[a];if(!s){var l=this._gridSize,u=e.OFFSET;s={id:a,vec3:[n*l+u,i*l+u,o*l+u]},this._origins[a]=s}return s},e.ORIGIN_PREFIX="rg_",e.OFFSET=1.11,e}()}.apply(null,n))||(e.exports=i)},857:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(858),r(859)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_INDEX_COUNT=65536;var i=function(){function e(e,i){void 0===i&&(i=1),this.textureBuffer=new n.TextureBackedBuffer(e,i),this.indexManager=new r.SimpleIndexManager(t.MAX_INDEX_COUNT)}return e.prototype.dispose=function(){this.textureBuffer.dispose(),this.textureBuffer=void 0},Object.defineProperty(e.prototype,"availableCount",{get:function(){return this.indexManager.availableCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activeCount",{get:function(){return this.indexManager.activeCount},enumerable:!0,configurable:!0}),e.prototype.aquireIndex=function(){var e=this.indexManager.aquire();return this.textureBuffer.resizeToFit(e),e},e.prototype.releaseIndex=function(e){this.indexManager.release(e)},e}();t.ManagedTextureBackedBuffer=i}.apply(null,n))||(e.exports=i)},858:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.maxCount=e,this._nextIndex=0,this.recycledIndices=[]}return Object.defineProperty(e.prototype,"activeCount",{get:function(){return this._nextIndex-this.recycledIndices.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"availableCount",{get:function(){return this.recycledIndices.length+this.maxCount-this._nextIndex},enumerable:!0,configurable:!0}),e.prototype.aquire=function(){return this.recycledIndices.length>0?this.recycledIndices.pop():this.availableCount?this._nextIndex++:void 0},e.prototype.release=function(e){this.recycledIndices.push(e)},e}();t.SimpleIndexManager=r}.apply(null,n))||(e.exports=i)},859:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(618),r(371)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){void 0===t&&(t=1),this.rctx=e,this.fieldCount=t,this.textureWidth=4096,this.dirty=!0,this.texture=new n(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:this.textureWidth,height:1,flipped:!1}),this.data=new r.BufferViewVec4u8(new ArrayBuffer(4*this.textureWidth))}return e.prototype.dispose=function(){this.texture.dispose(),this.texture=void 0,this.data=void 0},e.prototype.setData=function(e,t,r,n,i,o){var a=e*this.fieldCount+t;this.dirty=!0,this.data.set(a,0,r),this.data.set(a,1,n),this.data.set(a,2,i),this.data.set(a,3,o)},e.prototype.setDataElement=function(e,t,r,n){var i=e*this.fieldCount+t;this.dirty=!0,this.data.set(i,r,n)},e.prototype.resizeToFit=function(e){var t=e*this.fieldCount;if(t>=this.data.count){var n=Math.ceil((t+1)/this.textureWidth)*this.textureWidth,i=new r.BufferViewVec4u8(new ArrayBuffer(4*n));i.typedBuffer.set(this.data.typedBuffer),this.data=i}},e.prototype.updateTexture=function(){if(this.dirty){var e=this.texture.descriptor.width,t=this.texture.descriptor.height;this.data.count>e*t&&this.texture.resize(e,this.data.count/e),this.texture.setData(this.data.typedBuffer),this.dirty=!1}},e.prototype.bind=function(e,t){this.rctx.bindTexture(this.texture,t.unit),e.setUniform1i(t.texName,t.unit),e.setUniform2f(t.invDimName,1/this.texture.descriptor.width,1/this.texture.descriptor.height)},e}();t.TextureBackedBuffer=i}.apply(null,n))||(e.exports=i)},860:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(345),r(347),r(344),r(364),r(424),r(861)],void 0===(i=function(e,t,r,n,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0}),t.LINE_WIDTH_FRACTION_FACTOR=8,t.EXTENSION_LENGTH_OFFSET=128;var l={type:"solid",slicePlaneEnabled:!1,uber:!0,strokesTexture:null},u=function(){function e(){this._value=0}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e.prototype.increment=function(){this._value++},e.prototype.decrement=function(){this._value--},e}(),c=function(){function e(t,n,o){this.rctx=t,this.programRepository=n,this.refCount=new u,this.renderables=new Set,this.depthBiasZ=-4e-4,this.depthBiasXY=.5,this.tmpViewToWorldNormalMatrix=i.mat3d.create(),this.settings=r({},l,o),this.key=e.getKey(this.settings.uber,this.settings.type,this.settings.slicePlaneEnabled);var a=this.settings.strokesTexture.variants;this.writerSettings={variants:a},this.createPrograms()}return e.prototype.dispose=function(){for(var e in this.programs){var t=this.programs[e];t&&(this.programRepository.decreaseRefCount(t),this.programs[e]=null)}},e.prototype.addRenderable=function(e){this.renderables.add(e)},e.prototype.removeRenderable=function(e){this.renderables.delete(e)},e.prototype.forEachRenderable=function(e){this.renderables.forEach(e)},e.prototype.bindRegularEdges=function(e,t){this.bind(this.programs.regular,e,t)},e.prototype.bindSilhouetteEdges=function(e,t){this.bind(this.programs.silhouette,e,t)},e.prototype.bind=function(e,t,r){this.rctx.bindProgram(e),e.setUniformMatrix4fv("uProj",t.proj),e.setUniform2f("uDepthBias",this.depthBiasXY,this.depthBiasZ),e.setUniform2f("uPixelToNDC",2/t.viewport[2],2/t.viewport[3]),e.setUniform2f("uNDCToPixel",t.viewport[2]/2,t.viewport[3]/2),e.setUniform1f("uDistanceFalloffFactor",r.distanceFalloffFactor),e.setUniform2f("uViewportDimInv",1/t.viewport[2],1/t.viewport[3]),e.setUniform1f("uPixelRatio",t.pixelRatio||1)},e.prototype.renderRegularEdges=function(e,t,r){this.render(this.programs.regular,e,e.regular.vao,t,r)},e.prototype.renderSilhouetteEdges=function(e,t,r){this.render(this.programs.silhouette,e,e.silhouette.vao,t,r)},e.prototype.render=function(e,t,r,n,i){this.setUniforms(e,t,n);var o=this.rctx;o.bindVAO(r),o.capabilities.instancing.drawArraysInstanced(6,0,4,i)},e.prototype.setUniforms=function(e,r,n){r.components.buffer.textureBuffer.bind(e,t.componentDataBindParameters),e.setUniformMatrix4fv("uView",n.view),e.setUniformMatrix4fv("uModel",r.transform.modelMatrix);var o=n.viewInvTransp,s=i.mat4d.toMat3(o,this.tmpViewToWorldNormalMatrix);e.setUniform3f("uCameraPosition",o[3],o[7],o[11]),e.setUniformMatrix3fv("uViewToWorldNormalMatrix",s),(this.settings.uber||"sketch"===this.settings.type)&&this.setSketchUniforms(e),e.setUniform1f("uWorldLineRadiusPerDistance",Math.tan(n.fovY/2)/(n.viewport[3]/2)),e.setUniform3fv("uLocalOrigin",r.transform.origin.vec3),this.settings.slicePlaneEnabled&&a.bindSlicePlane(r.transform.origin.vec3,n.slicePlane,e)},e.prototype.setSketchUniforms=function(e){var t=this.settings.strokesTexture,r=t.texture;this.rctx.bindTexture(r,0),e.setUniform1i("uStrokesTexture",0),e.setUniform2f("uStrokesTextureScale",1/r.descriptor.width,1/r.descriptor.height),e.setUniform1f("uStrokesLog2Resolution",o.log2(t.resolution)),e.setUniform1f("uStrokesNormalizationScale",t.normalizationScale),e.setUniform1f("uStrokesAmplitude",t.amplitude),e.setUniform1f("uStrokeVariants",t.variants)},e.prototype.getOptions=function(e){return r({},e,{antialiasing:!!this.rctx.capabilities.blendMinMax,mode:this.settings.uber?"uber":this.settings.type,slice:this.settings.slicePlaneEnabled})},e.prototype.createPrograms=function(){var e=this.programRepository.getProgram(s.program,this.getOptions({silhouette:!1})),t=this.programRepository.getProgram(s.program,this.getOptions({silhouette:!0}));this.programRepository.increaseRefCount(e),this.programRepository.increaseRefCount(t),this.programs={regular:e,silhouette:t}},e.getKey=function(e,t,r){return e?"edges-uber":"edges-t:"+t+":"+r},e}();t.EdgeRenderer=c,t.componentDataBindParameters={texName:"uComponentDataTex",invDimName:"uComponentDataTexInvDim",unit:2}}.apply(null,n))||(e.exports=i)},861:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(401),r(417)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){return n.glslifyDefineMap({MODE:{value:e.mode,options:{solid:"MODE_SOLID",sketch:"MODE_SKETCH",uber:"MODE_UBER"}},SILHOUETTE:e.silhouette,ANTIALIASING:e.antialiasing,SLICE:e.slice})};t.program={name:"edges",shaders:function(e){return{vertexShader:i(e)+r.resolveIncludes("edgeRenderer/edgeRenderer.vert"),fragmentShader:i(e)+r.resolveIncludes("edgeRenderer/edgeRenderer.frag")}},attributes:{aPosition0:0,aPosition1:1,aComponentIndex:2,aPackedAttributes:3,aVariantOffset:4,aVariantStroke:5,aVariantExtension:6,aNormal:7,aNormalA:7,aNormalB:8,aSideness:9}}}.apply(null,n))||(e.exports=i)},862:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(345),r(364),r(349),r(371)],void 0===(i=function(e,t,r,n,i,o){function a(e,t){if(!e)return null;for(var r=e.length/2,n=s*r,i=new Array(r),o=0,a=1===t,u=0;u<e.length;u+=2){var c=(e[u]+e[u+1])/2;i[o++]=a?Math.min(n,1-(1-c)*l):Math.min(n,c*l)}return i}Object.defineProperty(t,"__esModule",{value:!0}),t.generateStrokesTexture=function(e){for(var r=t.strokesDefinition.resolution,s=r/2,l=new Uint8Array(4*r*r),u=4*r*s,c=t.strokesDefinition.amplitude,d=2*c,p=4*r,f=n.log2(r)+1,h=t.strokesDefinition.strokes.length,m=(f-1)*h*p,v=0,g=t.strokesDefinition.strokes;v<g.length;v++){for(var y=g[v],b=y.distance,_=y.pressure,x=m,w=0;w<f;w++){0!==w&&(b=a(b,0),_=a(_,1));for(var S=0;S<t.strokesDefinition.resolution;S++){var T=.5+(b?b[S%b.length]/d:0),E=_?_[S%_.length]:1;i.packFloatRGBA(T,l,x),i.packFloatRGBA(E,l,x+u),x+=4}x-=p*(h+1)}m+=p}return{resolution:r,texture:new o(e,{pixelFormat:6408,dataType:5121,hasMipmap:!1,samplingMode:9729,width:r,height:r,wrapMode:10497},l),normalizationScale:d,amplitude:c,variants:h}};var s=.1,l=.5;t.strokesDefinition={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-76e-5,27e-5,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]}}.apply(null,n))||(e.exports=i)},863:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(382),r(631)],void 0===(i=function(e,t,r,n){function i(e,t){var n=r.binaryIndexOf(e,t,!0);return-1===n?t<e[0]?0:e.length:n}Object.defineProperty(t,"__esModule",{value:!0}),t.determineRequiresUberRenderer=function(e){if(0===e.length)return!1;for(var t=e[0].type,r=0;r<e.length;r++)if(t!==e[r].type)return!0;return!1},t.determineAllTransparent=function(e){if(0===e.length)return!0;for(var t=0;t<e.length;t++){var r=e[t].material;if(r.size*r.color[3]*r.opacity>0)return!1}return!0},t.cloneIndices=function(e){if(Uint16Array.from)return n.isUint16Array(e)?Uint16Array.from(e):Uint32Array.from(e);for(var t=n.isUint16Array(e)?new Uint16Array(e.length):new Uint32Array(e.length),r=0;r<e.length;r++)t[r]=e[r];return t},t.estimateLengthAtDistance=function(e,t,r,n){return r*(n/e)*2*Math.tan(.5*t)},t.findLowerBoundIndex=i,t.computeEdgeCount=function(e,t,r){return e.length-i(e,t*r.minimumEdgeLength)},t.fillComponenBufferIndices=function(e,t,r,n){for(var i=0;i<e.length;i++){var o=e[i].index,a=t[i],s=t[i+1];if(n)for(var l=a;l<s;l++){var u=n[l];r.set(u,o)}else for(l=a;l<s;l++)r.set(l,o)}}}.apply(null,n))||(e.exports=i)},864:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(344),r(865)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=r.vec3d.create(),o=function(){function e(){this._renderLighting={main:{intensity:r.vec3d.create(),direction:r.vec3d.createFrom(1,0,0),castShadows:!1},sphericalHarmonics:{sh:{r:[0],g:[0],b:[0]}}},this._shOrder=2,this._oldDirection=r.vec3d.create(),this._oldSpecular=r.vec4d.create(),this._oldDiffuse=r.vec4d.create(),this._oldAmbient=r.vec4d.create()}return e.prototype.setUniforms=function(e,t){if(void 0===t&&(t=!1),t||e.getDefine("GROUND_NORMAL_SHADING")){var r=(1-this._info.groundLightingFactor)*(1-this._info.globalFactor);e.setUniform1f("lightingFixedFactor",r)}else e.setUniform1f("lightingFixedFactor",0);e.setUniform1f("lightingGlobalFactor",this._info.globalFactor),e.setUniform3fv("lightingMainDirection",this._renderLighting.main.direction),e.setUniform3fv("lightingMainIntensity",this._renderLighting.main.intensity),e.setUniform1f("ambientBoostFactor",.4);var n=this._renderLighting.sphericalHarmonics.sh;0===this._shOrder?e.setUniform3f("lightingAmbientSH0",n.r[0],n.g[0],n.b[0]):1===this._shOrder?(e.setUniform4f("lightingAmbientSH_R",n.r[0],n.r[1],n.r[2],n.r[3]),e.setUniform4f("lightingAmbientSH_G",n.g[0],n.g[1],n.g[2],n.g[3]),e.setUniform4f("lightingAmbientSH_B",n.b[0],n.b[1],n.b[2],n.b[3])):2===this._shOrder&&(e.setUniform3f("lightingAmbientSH0",n.r[0],n.g[0],n.b[0]),e.setUniform4f("lightingAmbientSH_R1",n.r[1],n.r[2],n.r[3],n.r[4]),e.setUniform4f("lightingAmbientSH_G1",n.g[1],n.g[2],n.g[3],n.g[4]),e.setUniform4f("lightingAmbientSH_B1",n.b[1],n.b[2],n.b[3],n.b[4]),e.setUniform4f("lightingAmbientSH_R2",n.r[5],n.r[6],n.r[7],n.r[8]),e.setUniform4f("lightingAmbientSH_G2",n.g[5],n.g[6],n.g[7],n.g[8]),e.setUniform4f("lightingAmbientSH_B2",n.b[5],n.b[6],n.b[7],n.b[8])),e.setUniform3fv("lightDirection",this._oldDirection)},e.prototype.set=function(e){this._info=e,n.combineLights(e.lights,this._shOrder,this._renderLighting.main,this._renderLighting.sphericalHarmonics),r.vec3d.negate(this._renderLighting.main.direction,this._oldDirection);var t=1/Math.PI;this._oldAmbient[0]=.282095*this._renderLighting.sphericalHarmonics.sh.r[0]*t,this._oldAmbient[1]=.282095*this._renderLighting.sphericalHarmonics.sh.g[0]*t,this._oldAmbient[2]=.282095*this._renderLighting.sphericalHarmonics.sh.b[0]*t,this._oldAmbient[3]=1,this._oldDiffuse[0]=this._renderLighting.main.intensity[0]*t,this._oldDiffuse[1]=this._renderLighting.main.intensity[1]*t,this._oldDiffuse[2]=this._renderLighting.main.intensity[2]*t,this._oldDiffuse[3]=1;var o=r.vec3d.set(this._oldDiffuse,i);r.vec3d.scale(o,.4*this._info.globalFactor),r.vec3d.add(this._oldAmbient,o)},Object.defineProperty(e.prototype,"globalFactor",{get:function(){return this._info.globalFactor},enumerable:!0,configurable:!0}),e.prototype.getOld=function(){return{ambient:this._oldAmbient,diffuse:this._oldDiffuse,specular:this._oldSpecular,direction:this._oldDirection,helper:this}},e}();t.SceneLighting=o}.apply(null,n))||(e.exports=i)},865:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(344),r(364),r(866),r(629)],void 0===(i=function(e,t,r,n,i,o){function a(e){return(e+1)*(e+1)}function s(e){return n.clamp(Math.floor(Math.sqrt(e)-1),0,2)}function l(e,t,r){var n=e[0],i=e[1],o=e[2],s=r||[];return s.length=a(t),t>=0&&(s[0]=.28209479177),t>=1&&(s[1]=.4886025119*n,s[2]=.4886025119*o,s[3]=.4886025119*i),t>=2&&(s[4]=1.09254843059*n*i,s[5]=1.09254843059*i*o,s[6]=.31539156525*(3*o*o-1),s[7]=1.09254843059*n*o,s[8]=.54627421529*(n*n-i*i)),s}function u(e,t){var r=a(e),n=t||{r:[],g:[],b:[]};n.r.length=n.g.length=n.b.length=r;for(var i=0;i<r;i++)n.r[i]=n.g[i]=n.b[i]=0;return n}function c(e,t){for(var n=s(t.r.length),o=0,a=e;o<a.length;o++){var u=a[o];r.vec3d.negate(u.direction,g),l(g,n,m),i.elementwiseProduct(m,y),i.scalarProduct(m,u.intensity[0],v),i.add(t.r,v),i.scalarProduct(m,u.intensity[1],v),i.add(t.g,v),i.scalarProduct(m,u.intensity[2],v),i.add(t.b,v)}return t}function d(e,t){l(g,0,m);for(var r=0,n=e;r<n.length;r++){var i=n[r];t.r[0]+=m[0]*y[0]*i.intensity[0]*4*Math.PI,t.g[0]+=m[0]*y[0]*i.intensity[1]*4*Math.PI,t.b[0]+=m[0]*y[0]*i.intensity[2]*4*Math.PI}return t}Object.defineProperty(t,"__esModule",{value:!0}),t.numberOfCoefficients=a,t.numberOfCoefficientsInBand=function(e){return 2*e+1},t.orderFromNumberOfCoefficients=s,t.computeCoefficients=l,t.initSHCoefficients=u,t.projectFillLights=c,t.projectAmbientLights=d,t.combineLights=function(e,t,n,a){u(t,a.sh),r.vec3d.set3(0,0,0,n.intensity);var s=!1,l=p,m=f,v=h;l.length=0,m.length=0,v.length=0;for(var g=0,y=e;g<y.length;g++)(x=y[g])instanceof o.MainLight&&!s?(r.vec3d.set(x.direction,n.direction),n.intensity[0]=x.intensity[0],n.intensity[1]=x.intensity[1],n.intensity[2]=x.intensity[2],n.castShadows=x.castShadows,s=!0):x instanceof o.MainLight||x instanceof o.FillLight?l.push(x):x instanceof o.AmbientLight?m.push(x):x instanceof o.SphericalHarmonicsLight&&v.push(x);c(l,a.sh),d(m,a.sh);for(var b=0,_=v;b<_.length;b++){var x=_[b];i.add(a.sh.r,x.sh.r),i.add(a.sh.g,x.sh.g),i.add(a.sh.b,x.sh.b)}};var p=[],f=[],h=[],m=[0],v=[0],g=r.vec3d.create(),y=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398]}.apply(null,n))||(e.exports=i)},866:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.dotProduct=function(e,t){for(var r=0,n=0;n<e.length;n++)r+=e[n]*t[n];return r},t.elementwiseProduct=function(e,t,r){(r=r||e).length=e.length;for(var n=0;n<e.length;n++)r[n]=e[n]*t[n];return r},t.scalarProduct=function(e,t,r){(r=r||e).length=e.length;for(var n=0;n<e.length;n++)r[n]=e[n]*t;return r},t.add=function(e,t,r){(r=r||e).length=e.length;for(var n=0;n<e.length;n++)r[n]=e[n]+t[n];return r}}.apply(null,n))||(e.exports=i)},867:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(372),r(401),r(417)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){return i.glslifyDefineMap({OCCL_TEST:e.occlTest,SIGNED_DISTANCE_FIELD:e.sdf,VV_SIZE:e.vvSize,VV_COLOR:e.vvColor,VERTICAL_OFFSET:e.verticalOffset,SCREEN_SIZE_PERSPECTIVE:e.screenSizePerspective,CENTER_OFFSET_UNITS_SCREEN:e.centerOffsetUnitsScreen,DEBUG_DRAW_BORDER:e.debugDrawBorder,BINARY_HIGHLIGHT_OCCLUSION:e.binaryHighlightOcclusion})};t.colorPass={name:"hud-color",shaders:function(e){return{vertexShader:o(e)+n.resolveIncludes("materials/hud/hud.vert"),fragmentShader:o(e)+n.resolveIncludes("materials/hud/colorPass.frag")}},attributes:r.Default3D},t.highlightPass={name:"hud-highlight",shaders:function(e){return{vertexShader:o(e)+n.resolveIncludes("materials/hud/hud.vert"),fragmentShader:o(e)+n.resolveIncludes("materials/hud/highlightPass.frag")}},attributes:r.Default3D},t.occlusionPass={name:"hud-occlusion",shaders:function(e){return{vertexShader:function(e){return i.glslifyDefineMap({VERTICAL_OFFSET:e.verticalOffset,SCREEN_SIZE_PERSPECTIVE:e.screenSizePerspective,CENTER_OFFSET_UNITS_SCREEN:e.centerOffsetUnitsScreen,SLICE:e.slice})}(e)+n.resolveIncludes("materials/hud/occlusionTest.vert"),fragmentShader:n.resolveIncludes("materials/hud/occlusionTest.frag")}},attributes:r.Default3D}}.apply(null,n))||(e.exports=i)},868:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.startMeasurement=function(e){var t=e.capabilities.disjointTimerQuery;return t?new r(t):null},t.getTimestamp=function(e,t,r){void 0===r&&(r=50);var n=e.capabilities.disjointTimerQuery;if(!n)return null;if(n.timestampBits()<=0)return null;var i=n.createQuery();n.createTimestamp(i);var o=function(){var e=n.resultAvailable(i),a=n.disjoint();if(!e||a)a?t():setTimeout(o,r);else{var s=n.getResult(i);t(s/1e6)}};o()},t.supportsTimestamps=function(e){var t=e.capabilities.disjointTimerQuery;if(!t)return!1;var r=t.timestampBits();return console.log({bits:r}),r>0};var r=function(){function e(e){this.timer=e,this.query=e.createQuery(),this.timer.beginTimeElapsed(this.query)}return e.prototype.stop=function(e,t){void 0===t&&(t=50),this.cb=e,this.checkInterval=t,this.timer.endTimeElapsed(),this.checkQueryResult()},e.prototype.checkQueryResult=function(){var e=this.timer.resultAvailable(this.query),t=this.timer.disjoint();if(!e||t)t?this.cb():setTimeout(this.checkQueryResult.bind(this),this.checkInterval);else{var r=this.timer.getResult(this.query);this.cb(r/1e6)}},e}()}.apply(null,n))||(e.exports=i)},869:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(344),r(419),r(424),r(630)],void 0===(i=function(e,t,r,n,i,o){var a=r.vec4d.createFrom(1,1,1,1);return function(){function e(e,t,r,n,i){this.program=e.getProgram(o.texOnly),this.color=r,this.depthFunc=i,this.blend=n,this.texGLName=t}return e.prototype.beginSlot=function(e){return e===n.INTERNAL_MATERIAL},e.prototype.getProgram=function(){return this.program},e.prototype.setColor=function(e){this.color=e},e.prototype.bind=function(e,t){e.bindProgram(this.program),this.program.setUniformMatrix4fv("model",i.IDENTITY),this.program.setUniformMatrix4fv("proj",t.proj),this.program.setUniform4fv("color",void 0!==this.color?this.color:a),this.program.setUniform1i("tex",0),e.bindTexture(this.texGLName,0),this.blend&&(e.setBlendingEnabled(!0),e.setBlendFunctionSeparate(e.gl.SRC_ALPHA,e.gl.ONE_MINUS_SRC_ALPHA,e.gl.ONE,e.gl.ONE_MINUS_SRC_ALPHA)),e.setDepthTestEnabled(!0),void 0!==this.depthFunc&&e.setDepthFunction(this.depthFunc)},e.prototype.release=function(e){void 0!==this.depthFunc&&e.setDepthFunction(513),this.blend&&e.setBlendingEnabled(!1)},e.prototype.bindView=function(e,t){i.bindView(t.origin,t.view,this.program)},e.prototype.bindInstance=function(e,t){this.program.setUniformMatrix4fv("model",t.transformation)},e.prototype.getDrawMode=function(e){return e.gl.TRIANGLES},e}()}.apply(null,n))||(e.exports=i)},870:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(349)],void 0===(i=function(e,t,r){function n(e,t){return e+"_"+t}var i=function(){function e(e){this.refCnt=0,this.glMaterial=e}return e.prototype.incRefCnt=function(){++this.refCnt},e.prototype.decRefCnt=function(){--this.refCnt,r.assert(this.refCnt>=0)},e.prototype.getRefCnt=function(){return this.refCnt},e.prototype.getGLMaterial=function(){return this.glMaterial},e}();return function(){function e(e,t){this.textureRep=e,this.programRep=t,this.id2glMaterialRef={}}return e.prototype.aquire=function(e){return this.aquireExt(e,"color")},e.prototype.aquireDepthShadowMap=function(e){return this.aquireExt(e,"depthShadowMap")},e.prototype.aquireDepth=function(e){return this.aquireExt(e,"depth")},e.prototype.aquireNormal=function(e){return this.aquireExt(e,"normal")},e.prototype.aquireHighlight=function(e){return this.aquireExt(e,"highlight")},e.prototype.aquireExt=function(e,t){var r,o=n(e.id,t),a=this.id2glMaterialRef[o];if(null==a){var s=e.getGLMaterials()[t];r=s?new s(e,this.programRep,this.textureRep):void 0,a=new i(r),this.id2glMaterialRef[o]=a}else r=a.getGLMaterial();return a.incRefCnt(),r&&this.increaseProgramReferences(r),r},e.prototype.release=function(e){this.releaseExt(e,"color")},e.prototype.releaseDepth=function(e){this.releaseExt(e,"depth")},e.prototype.releaseNormal=function(e){this.releaseExt(e,"normal")},e.prototype.releaseDepthShadowMap=function(e){this.releaseExt(e,"depthShadowMap")},e.prototype.releaseHighlight=function(e){this.releaseExt(e,"highlight")},e.prototype.releaseExt=function(e,t){var r=n(e,t),i=this.id2glMaterialRef[r];if(i.decRefCnt(),0===i.getRefCnt()){var o=i.getGLMaterial();o&&(this.decreaseProgramReferences(o),o.dispose()),delete this.id2glMaterialRef[r]}},e.prototype.updateMaterialParameters=function(e){var t=this.id2glMaterialRef[n(e,"color")];t&&t.getGLMaterial()&&this.updateParamsForMat(t.getGLMaterial());var r=this.id2glMaterialRef[n(e,"depth")];r&&r.getGLMaterial()&&this.updateParamsForMat(r.getGLMaterial());var i=this.id2glMaterialRef[n(e,"depthShadowMap")];i&&i.getGLMaterial()&&this.updateParamsForMat(i.getGLMaterial());var o=this.id2glMaterialRef[n(e,"normal")];o&&o.getGLMaterial()&&this.updateParamsForMat(o.getGLMaterial());var a=this.id2glMaterialRef[n(e,"highlight")];a&&a.getGLMaterial()&&this.updateParamsForMat(a.getGLMaterial())},e.prototype.updateParamsForMat=function(e){e.updateParameters&&(this.decreaseProgramReferences(e),e.updateParameters(),this.increaseProgramReferences(e))},e.prototype.increaseProgramReferences=function(e){for(var t=e.getPrograms(),r=this.programRep,n=0;n<t.length;n++)r.increaseRefCount(t[n])},e.prototype.decreaseProgramReferences=function(e){for(var t=e.getPrograms(),r=this.programRep,n=0;n<t.length;n++)r.decreaseRefCount(t[n])},e}()}.apply(null,n))||(e.exports=i)},871:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(343),r(349),r(371)],void 0===(i=function(e,t,r,n,i){var o=r.getLogger("esri.views.3d.webgl-engine.lib.GLTextureRep"),a=function(){function e(e){this._glTexture=null,this._refCount=0,this._glTexture=e}return e.prototype.incRefCnt=function(){++this._refCount},e.prototype.decRefCnt=function(){--this._refCount,n.assert(this._refCount>=0)},e.prototype.getRefCnt=function(){return this._refCount},e.prototype.setGLTexture=function(e){this._glTexture=e},e.prototype.getGLTexture=function(){return this._glTexture},e}();return function(){function e(e,t,r,n){this.NUM_PARALLEL=8,this.textures=e,this._programRepository=t,this.getViewportToRestore=r,this._rctx=n,this.NUM_PARALLEL=8,this.id2textureRef={},this.loading={},this._queue=[],this.listeners=[],this.afExt=n.capabilities.textureFilterAnisotropic,this.maxMaxAnisotropy=this.afExt?n.parameters.maxMaxAnisotropy:1,this.maxAnisotropy=Math.min(8,this.maxMaxAnisotropy),this._needsRender=!0,this._fallbackTextureData=new Uint8Array(256),this._fallbackTextureTransparentData=new Uint8Array(256);for(var i=0;i<this._fallbackTextureData.length;++i)this._fallbackTextureData[i]=255,this._fallbackTextureTransparentData[i]=(i+1)%4!=0?255:0;this._fallbackTextureDesc={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:8,height:8,maxAnisotropy:8}}return e.prototype.resetNeedsRender=function(){this._needsRender=!1},e.prototype.needsRender=function(){return this._needsRender},e.prototype.aquire=function(e,t,r){var s=this,l=this.id2textureRef[e];if(null==l){var u=this.textures[e];n.assert(void 0!==u),u.setUnloadFunc(this._unload.bind(this));var c=!0===t,d=this._createGLTextureDescription(u);if(l=new a(null),n.assert(null==this.id2textureRef[e]),this.id2textureRef[e]=l,u.initializeThroughRender){var p=u.initializeThroughRender(this._rctx,d);l.setGLTexture(p),r&&r(l)}else if(u.deferredLoading())this.getLoadingCount()<this.NUM_PARALLEL?this._loadImage(e,d,r):this._queue.push([e,d,r]);else try{u.initializeThroughUpload(this._rctx,d,this._programRepository,this.getViewportToRestore(),function(e){l.setGLTexture(e),s._needsRender=!0,r&&r(l)})}catch(e){o.error("#aquire","Error loading texture: "+e.toString())}null==l.getGLTexture()&&l.setGLTexture(new i(this._rctx,this._fallbackTextureDesc,c?this._fallbackTextureTransparentData:this._fallbackTextureData)),this._needsRender=!0}return l.incRefCnt(),l},e.prototype.release=function(e){var t=this.id2textureRef[e];void 0!==t&&(t.decRefCnt(),n.assert(t.getRefCnt()>=0))},e.prototype.getLoadingCount=function(){return Object.keys(this.loading).length},e.prototype.getTexture=function(e){return this.textures[e]},e.prototype.getMaxAnisotropy=function(){return this.maxAnisotropy},e.prototype._unload=function(e){var t=this.id2textureRef[e];if(void 0!==t){var r=t.getGLTexture();r&&r.dispose(),delete this.id2textureRef[e]}this.next(e)},e.prototype._createGLTextureDescription=function(e){var t=e.params&&e.params.wrapClamp;return{target:3553,pixelFormat:6408,dataType:5121,maxAnisotropy:this.afExt&&e.params&&e.params.mipmap&&!e.params.disableAnisotropy?this.maxAnisotropy:void 0,wrapMode:t?33071:void 0}},e.prototype.next=function(e){if(e in this.loading){delete this.loading[e];var t=Object.keys(this.id2textureRef),r=Object.keys(this.loading);this.listeners.forEach(function(n){n(e,t,r)}),this.processQueue()}},e.prototype._loadImage=function(e,t,r){var i=this;n.assert(null==this.loading[e]),this.loading[e]=!0;var o=this.textures[e];n.assert(void 0!==o),setTimeout(function(){var n=i.id2textureRef[e];n&&n.getRefCnt()&&o.initializeThroughUpload(i._rctx,t,i._programRepository,i.getViewportToRestore(),function(t){i.next(e),i._needsRender=!0,n&&n.getRefCnt()&&(n.setGLTexture(t),r&&r(n))})},0)},e.prototype.processQueue=function(){for(var e=[],t=0;t<this._queue.length;++t){var r=this._queue[t][0],n=this.id2textureRef[r];void 0!==n&&(0===n.getRefCnt()?(n.getGLTexture().dispose(),delete this.id2textureRef[r]):e.push(this._queue[t]))}this._queue=e;var i=Math.min(this.NUM_PARALLEL-Object.keys(this.loading).length,this._queue.length);for(t=0;t<i;++t)this._loadImage(this._queue[t][0],this._queue[t][1],this._queue[t][2]);this._queue.splice(0,i)},e}()}.apply(null,n))||(e.exports=i)},872:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(873),r(778)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=null,o=[];t.enabled=!1,t.begin=function(){t.enabled&&(i=[])},t.trace=function(e){t.enabled&&null!=i&&i.push(e)},t.end=function(){if(t.enabled){var e=i;return i=null,e&&(o.forEach(function(t){return t(e)}),o.length=0),e}},t.instrumentContext=function(e){return t.enabled?n.default(e)?(console.warn("WebGL tracer is not supported on a WebGL2 Context"),e):r.makeDebugContext(e,void 0,function(e,n){t.enabled&&i&&i.push("gl."+e+"("+r.glFunctionArgsToString(e,n)+")")}):e},t.request=function(e){o.push(e)}}.apply(null,n))||(e.exports=i)},873:function(e,t,r){var n;void 0===(n=function(){function e(e){if(null==l)for(var t in l={},u={},e)"number"==typeof e[t]&&(l[e[t]]=t,u[t]=e[t])}function t(){if(null==l)throw"WebGLDebugUtils.init(ctx) not called"}function r(e){t();var r=l[e];return void 0!==r?"gl."+r:"/*UNKNOWN WebGL ENUM*/ 0x"+e.toString(16)}function n(e,t,n,i){var o;if(void 0!==(o=s[e])&&(void 0!==(o=o[t])&&o[n])){if("object"==typeof o[n]&&void 0!==o[n].enumBitwiseOr){for(var a=o[n].enumBitwiseOr,l=0,c=[],d=0;d<a.length;++d){var p=u[a[d]];0!=(i&p)&&(l|=p,c.push(r(p)))}return l===i?c.join(" | "):r(i)}return r(i)}return null===i?"null":void 0===i?"undefined":i.toString()}function i(e,t,r){e.__defineGetter__(r,function(){return t[r]}),e.__defineSetter__(r,function(e){t[r]=e})}function o(e){var t=e.getParameter(e.MAX_VERTEX_ATTRIBS),r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r);for(var n=0;n<t;++n)e.disableVertexAttribArray(n),e.vertexAttribPointer(n,4,e.FLOAT,!1,0,0),e.vertexAttrib1f(n,0);e.deleteBuffer(r);var i=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);for(n=0;n<i;++n)e.activeTexture(e.TEXTURE0+n),e.bindTexture(e.TEXTURE_CUBE_MAP,null),e.bindTexture(e.TEXTURE_2D,null);for(e.activeTexture(e.TEXTURE0),e.useProgram(null),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.DITHER),e.disable(e.SCISSOR_TEST),e.blendColor(0,0,0,0),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.clearColor(0,0,0,0),e.clearDepth(1),e.clearStencil(-1),e.colorMask(!0,!0,!0,!0),e.cullFace(e.BACK),e.depthFunc(e.LESS),e.depthMask(!0),e.depthRange(0,1),e.frontFace(e.CCW),e.hint(e.GENERATE_MIPMAP_HINT,e.DONT_CARE),e.lineWidth(1),e.pixelStorei(e.PACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.UNPACK_COLORSPACE_CONVERSION_WEBGL&&e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.BROWSER_DEFAULT_WEBGL),e.polygonOffset(0,0),e.sampleCoverage(1,!1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilMask(4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.viewport(0,0,e.canvas.width,e.canvas.height),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT);e.getError(););}var a=function(e){window.console&&window.console.error?window.console.error(e):function(e){window.console&&window.console.log&&window.console.log(e)}(e)},s={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},l=null,u=null;return{init:e,mightBeEnum:function(e){return t(),void 0!==l[e]},glEnumToString:r,glFunctionArgToString:n,glFunctionArgsToString:function(e,t){for(var r="",i=t.length,o=0;o<i;++o)r+=(0==o?"":", ")+n(e,i,o,t[o]);return r},makeDebugContext:function t(o,s,l,u){function c(e,t){return function(){l&&l(t,arguments);var r=e[t].apply(e,arguments),n=u.getError();return 0!=n&&(d[n]=!0,s(n,t,arguments)),r}}u=u||o,e(o),s=s||function(e,t,i){for(var o="",s=i.length,l=0;l<s;++l)o+=(0==l?"":", ")+n(t,s,l,i[l]);a("WebGL error "+r(e)+" in "+t+"("+o+")")};var d={},p={};for(var f in o)if("function"==typeof o[f])if("getExtension"!=f)p[f]=c(o,f);else{var h=c(o,f);p[f]=function(){return t(h.apply(o,arguments),s,l,u)}}else i(p,o,f);return p.getError=function(){for(var e in d)if(d.hasOwnProperty(e)&&d[e])return d[e]=!1,e;return o.NO_ERROR},p},makeLostContextSimulatingCanvas:function(e){function t(e){return"function"==typeof e?e:function(t){e.handleEvent(t)}}function r(){++m,p||h==m&&e.loseContext()}function n(e,t){var n=e[t];return function(){if(r(),!p)return n.apply(e,arguments)}}function a(e){return{statusMessage:e,preventDefault:function(){v=!0}}}var s,l=[],u=[],c={},d=1,p=!1,f=[],h=0,m=0,v=!1,g=0,y={};e.getContext=function(t){return function(){var o=t.apply(e,arguments);if(o instanceof WebGLRenderingContext){if(o!=s){if(s)throw"got different context";c=function(e){for(var t in e)"function"==typeof e[t]?c[t]=n(e,t):i(c,e,t);c.getError=function(){if(r(),!p)for(;e=s.getError();)y[e]=!0;for(var e in y)if(y[e])return delete y[e],e;return c.NO_ERROR};for(var o=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],a=0;a<o.length;++a)c[h=o[a]]=function(t){return function(){if(r(),p)return null;var n=t.apply(e,arguments);return n.__webglDebugContextLostId__=d,f.push(n),n}}(e[h]);var l=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];for(a=0;a<l.length;++a)c[h=l[a]]=function(t){return function(){return r(),p?null:t.apply(e,arguments)}}(c[h]);var u=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];for(a=0;a<u.length;++a){var h;c[h=u[a]]=function(t){return function(){return r(),!p&&t.apply(e,arguments)}}(c[h])}return c.checkFramebufferStatus=function(t){return function(){return r(),p?c.FRAMEBUFFER_UNSUPPORTED:t.apply(e,arguments)}}(c.checkFramebufferStatus),c.getAttribLocation=function(t){return function(){return r(),p?-1:t.apply(e,arguments)}}(c.getAttribLocation),c.getVertexAttribOffset=function(t){return function(){return r(),p?0:t.apply(e,arguments)}}(c.getVertexAttribOffset),c.isContextLost=function(){return p},c}(s=o)}return c}return o}}(e.getContext);var b=function(e){l.push(t(e))},_=function(e){u.push(t(e))};return function(e){var t=e.addEventListener;e.addEventListener=function(r,n,i){switch(r){case"webglcontextlost":b(n);break;case"webglcontextrestored":_(n);break;default:t.apply(e,arguments)}}}(e),e.loseContext=function(){if(!p){for(p=!0,h=0,++d;s.getError(););(function(){for(var e=Object.keys(y),t=0;t<e.length;++t)delete y[e]})(),y[s.CONTEXT_LOST_WEBGL]=!0;var t=a("context lost"),r=l.slice();setTimeout(function(){for(var n=0;n<r.length;++n)r[n](t);g>=0&&setTimeout(function(){e.restoreContext()},g)},0)}},e.restoreContext=function(){p&&u.length&&setTimeout(function(){if(!v)throw"can not restore. webglcontestlost listener did not call event.preventDefault";(function(){for(var e=0;e<f.length;++e){var t=f[e];t instanceof WebGLBuffer?s.deleteBuffer(t):t instanceof WebGLFramebuffer?s.deleteFramebuffer(t):t instanceof WebGLProgram?s.deleteProgram(t):t instanceof WebGLRenderbuffer?s.deleteRenderbuffer(t):t instanceof WebGLShader?s.deleteShader(t):t instanceof WebGLTexture&&s.deleteTexture(t)}})(),o(s),p=!1,m=0,v=!1;for(var e=u.slice(),t=a("context restored"),r=0;r<e.length;++r)e[r](t)},0)},e.loseContextInNCalls=function(e){if(p)throw"You can not ask a lost contet to be lost";h=m+e},e.getNumCalls=function(){return m},e.setRestoreTimeout=function(e){g=e},e},resetToInitialState:o}}.apply(null,[]))||(e.exports=n)},874:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(354),r(344),r(634),r(810),r(875)],void 0===(i=function(e,t,r,n,i,o,a){var s=r("dojo-debug-messages"),l=function(){function e(e,t,r,l,u){this._content=new Map,this._stats={renderGeometriesTotal:0,renderGeometriesVisible:0,visualizerRenderTimer:null,viewportRenderTimer:null},this._needsRender=!0,this._rctx=u,this._gl=u.gl,this._visualizer=new a(e,t,r,l,this._rctx),this._camera=new i(n.vec3.createFrom(0,100,-100),n.vec3.createFrom(0,0,0)),s&&(this._stats.visualizerRenderTimer=new o(10),this._stats.viewportRenderTimer=new o(10))}return Object.defineProperty(e.prototype,"isLoadingResources",{get:function(){return this._visualizer.isLoadingResources},enumerable:!0,configurable:!0}),e.prototype.getCombinedStats=function(){var e={},t=this._visualizer.getCombinedStats();for(var r in t)e[r]=t[r];if(e.renderGeometriesTotal=this._stats.renderGeometriesTotal,e.renderGeometriesVisible=this._stats.renderGeometriesVisible,s&&(e.visualizerTotalRenderTime=this._stats.visualizerRenderTimer.getTotal(),e.visualizerCurrentRenderTime=this._stats.visualizerRenderTimer.getLastFiltered(),e.viewportTotalRenderTime=this._stats.viewportRenderTimer.getTotal(),e.viewportCurrentRenderTime=this._stats.viewportRenderTimer.getLastFiltered(),e.totalNumFramesRendered=this._stats.viewportRenderTimer.getNumMeasurements()),void 0!==this._gl.getUsedTextureMemory&&(e.textureMemory=this._gl.getUsedTextureMemory()),void 0!==this._gl.getUsedRenderbufferMemory&&(e.renderbufferMemory=this._gl.getUsedRenderbufferMemory()),void 0!==this._gl.getUsedVBOMemory&&(e.VBOMemory=this._gl.getUsedVBOMemory()),void 0!==this._gl.getUsedTextureMemoryStats){var n=this._gl.getUsedTextureMemoryStats();for(var i in n)e["texMem type: "+i]=n[i]}return e},e.prototype.dispose=function(){this._visualizer.dispose(),this._visualizer=null},e.prototype.setLighting=function(e){this._visualizer.setLighting(e)},e.prototype.setRenderParams=function(e){this._visualizer.setRenderParams(e)},e.prototype.getRenderParams=function(){return this._visualizer.getRenderParams()},e.prototype.getEdgeView=function(){return this._visualizer.getEdgeView()},e.prototype.modify=function(e,t,r,n){this._visualizer.modify(e,t,r,n),this._content=this._visualizer.getContent()},e.prototype.getContent=function(){return this._content},e.prototype.setCamera=function(e){this._camera.copyFrom(e),this._needsRender=!0},e.prototype.getCamera=function(){return this._camera},Object.defineProperty(e.prototype,"renderPlugins",{get:function(){return this._visualizer.renderPlugins},enumerable:!0,configurable:!0}),e.prototype.getFramebufferTexture=function(e){return this._visualizer.getFramebufferTexture(e)},e.prototype.render=function(e){s&&this._stats.viewportRenderTimer.start(),s&&this._stats.visualizerRenderTimer.start(),u.camera=e.camera||this._camera,u.fbo=e.fbo,u.lightDirection=e.lightDirection,u.pixelRatio=e.pixelRatio||1,this._visualizer.render(u),s&&(this._stats.visualizerRenderTimer.stop(),this._stats.viewportRenderTimer.stop())},e.prototype.resetNeedsRender=function(){this._needsRender=!1,this._visualizer.resetNeedsRender()},e.prototype.needsRender=function(){return this._needsRender||this._visualizer.needsRender()},e}(),u={fbo:null,lightDirection:null,camera:null,pixelRatio:1};return l}.apply(null,n))||(e.exports=i)},875:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(876),r(344),r(617),r(684),r(877),r(878),r(880),r(736),r(883),r(595),r(885),r(739),r(886),r(349)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,c,d,p,f,h,m){var v=m.assert;return function(){function e(e,t,r,n,i){this._drawShadowMapDebugQuad=!1,this._drawSSAOMapDebugQuad=!1,this._needsRender=!0,this._content=new Map,this._stage=e,this._rctx=i,this._renderer=new u(t,r,n,this._rctx,!1),this._programRep=t,this._helpers={shadowMap:new p(t,this._rctx),ssao:new h(t,this._rctx,this.setNeedsRender.bind(this)),highlight:new s(t,this._rctx),renderOccluded:new c(t,this._rctx),slice:new f,offscreenRendering:new l(t,this._rctx)}}return Object.defineProperty(e.prototype,"isLoadingResources",{get:function(){return this._renderer.isLoadingResources},enumerable:!0,configurable:!0}),e.prototype.getCombinedStats=function(){return this._renderer.getCombinedStats()},e.prototype.dispose=function(){this._renderer.dispose(),this._helpers.shadowMap.enabled=!1,this._helpers.shadowMap.dispose(),this._helpers.ssao.enabled=!1,this._helpers.ssao.dispose(),this._helpers.highlight.enabled=!1,this._helpers.renderOccluded.enabled=!1,this._helpers.offscreenRendering.enabled=!1},e.prototype.setLighting=function(e){this._renderer.setLighting(e)},e.prototype.setRenderParams=function(e){void 0!==e.shadowMapResolution&&!1===this._helpers.shadowMap.enabled&&(this._helpers.shadowMap.textureResolution=e.shadowMapResolution),void 0!==e.shadowMap&&(this._helpers.shadowMap.enabled=e.shadowMap),void 0!==e.shadowMapMaxCascades&&(this._helpers.shadowMap.maxCascades=e.shadowMapMaxCascades),this._helpers.highlight.enabled=!0,void 0!==e.ssao&&(this._helpers.ssao.enabled=e.ssao),void 0!==e.ssaoAttenuation&&(this._helpers.ssao.attenuation=e.ssaoAttenuation),void 0!==e.ssaoRadius&&(this._helpers.ssao.radius=e.ssaoRadius),void 0!==e.ssaoFilterRadius&&console.error("The property ssaoFilterRadius is no longer supported as a render parameter."),void 0!==e.ssaoSamples&&(this._helpers.ssao.samples=e.ssaoSamples),void 0!==e.drawShadowMapDebugQuad&&(this._drawShadowMapDebugQuad=e.drawShadowMapDebugQuad),void 0!==e.drawSSAODebugQuad&&(this._drawSSAOMapDebugQuad=e.drawSSAODebugQuad),this._renderer.ssaoEnabled=this._helpers.ssao.enabled,void 0!==e.offscreenRendering&&(this._helpers.offscreenRendering.enabled=e.offscreenRendering),e.background&&(this._helpers.offscreenRendering.background=e.background),void 0!==e.antialiasingEnabled&&(this._renderer.renderOptions.antialiasing=e.antialiasingEnabled?"smaa":"none"),void 0!==e.earlyOcclusionPixelDraw&&(this._renderer.renderOptions.earlyOcclusionPixelDraw=e.earlyOcclusionPixelDraw),void 0!==e.defaultHighlightOptions&&this._helpers.highlight.setDefaultOptions(e.defaultHighlightOptions),void 0!==e.slicePlane&&(this._helpers.slice.plane=e.slicePlane),this._needsRender=!0},e.prototype.getRenderParams=function(){var e={};return e.shadowMap=this._helpers.shadowMap.enabled,e.shadowMapResolution=this._helpers.shadowMap.textureResolution,e.shadowMapMaxCascades=this._helpers.shadowMap.maxCascades,this._helpers.ssao.isSupported&&(e.ssao=this._helpers.ssao.enabled,e.ssaoAttenuation=this._helpers.ssao.attenuation,e.ssaoRadius=this._helpers.ssao.radius,e.ssaoFilterRadius=this._helpers.ssao.filterRadius,e.ssaoSamples=this._helpers.ssao.samples),e},e.prototype.getFramebufferTexture=function(e){switch(e){case"color":return this._helpers.offscreenRendering.colorTexture;case"hudVisibility":return this._helpers.offscreenRendering.hudVisibilityTexture;case"shadowMap":return this._helpers.shadowMap.getDepthTexture()}return this._renderer.getFramebufferTexture(e)},e.prototype.modify=function(e,t,r,n){this._renderer.modify(e,t,r,n);for(var i=0;i<t.length;++i)this._content.delete(t[i].uniqueName);for(i=0;i<e.length;++i)this._content.set(e[i].uniqueName,e[i]);for(i=0;i<r.length;++i)v(this._content.get(r[i].renderGeometry.uniqueName)===r[i].renderGeometry)},e.prototype.getContent=function(){return this._content},e.prototype.getProjectionMatrix=function(e,t,r,i,o){var a=m.fovx2fovy(t,e[2],e[3]);n.mat4d.perspective(180*a/Math.PI,e[2]/e[3],r,i,o)},Object.defineProperty(e.prototype,"renderPlugins",{get:function(){return this._renderer.renderPlugins},enumerable:!0,configurable:!0}),e.prototype.resetNeedsRender=function(){this._needsRender=!1,this._renderer.resetNeedsRender()},e.prototype.needsRender=function(){return this._needsRender||this._renderer.needsRender()},e.prototype.setNeedsRender=function(){this._needsRender=!0},e.prototype.render=function(e){var t=e.camera,o=e.fbo,a=e.lightDirection,s=t.viewport;if(this._renderer.prepareRender(t),this._helpers.shadowMap.enabled){i.ENABLE_PROFILE_DEPTH_RANGE&&r.begin("depthRange");var l=this.computeDepthRange(t);i.ENABLE_PROFILE_DEPTH_RANGE&&r.end("depthRange"),this._helpers.shadowMap.prepare(t,a,this._content,l);for(var u=this._helpers.shadowMap.getCascades(),c=0;c<u.length;++c){var p=u[c];p.camera.setGLViewport(this._rctx),e.camera=p.camera,this._renderer.renderGeometryPass(d.MATERIAL_DEPTH_SHADOWMAP,e,null,null,this._helpers.slice)}e.camera=t,this._helpers.shadowMap.finish(o),t.setGLViewport(this._rctx)}if(this._helpers.shadowMap.bindAll(this._programRep),this._renderer.renderAuxiliaryBuffers(e,this._helpers),this._renderer.render(e,this._helpers),this._drawShadowMapDebugQuad&&this._helpers.shadowMap.enabled){var f=n.mat4d.ortho(s[0],s[2],s[1],s[3],-1,1);this._helpers.shadowMap.drawDebugQuad(f)}if(this._drawSSAOMapDebugQuad&&this._helpers.ssao.enabled){f=n.mat4d.ortho(s[0],s[2],s[1],s[3],-1,1);this._helpers.ssao.drawQuad(f)}},e.prototype.getEdgeView=function(){return this._renderer.edgeView},e.prototype.computeDepthRange=function(e){var t=a.depthRangeFromScene(e,this._content,this._stage.getLayers());return o.union(t,this.renderPlugins.queryDepthRange(e)),t.near=Math.max(e.near,t.near),t.far=Math.min(e.far,t.far),t},e}()}.apply(null,n))||(e.exports=i)},876:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){var r=function(){function e(e,t){void 0===t&&(t=.9),this._alpha=.9,this._name=e,this._alpha=t,this.reset()}return e.prototype.reset=function(){this._count=0,this._sum=0,this._smooth=0,this._min=1/0,this._max=0},Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"average",{get:function(){return this._count>0?this._sum/this._count:0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"smooth",{get:function(){return this._smooth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"min",{get:function(){return this._min},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"max",{get:function(){return this._max},enumerable:!0,configurable:!0}),e.prototype.begin=function(){this._startTime=performance.now()},e.prototype.end=function(){var e=performance.now()-this._startTime;this._count+=1,this._sum+=e,this._smooth=this._alpha*e+(1-this._alpha)*this._smooth,this._min=Math.min(this._min,e),this._max=Math.max(this._max,e)},e.prototype.toJSON=function(){return{name:this.name,count:this.count,average:this.average,smooth:this.smooth,min:this.min,max:this.max}},e}();return function(e){function t(t){return t in i||(i[t]=new e(t)),i[t]}function r(e){console.log(t(e).toJSON())}var n=1e3,i={},o={};e.get=t,e.begin=function(e){t(e).begin()},e.end=function(e,i){void 0===i&&(i=!0),t(e).end();var a=performance.now();!i||e in o&&!(a>=o[e]+n)||(r(e),o[e]=a)},e.log=r,e.logAll=function(){for(var e in i)r(e)}}(r||(r={})),r}.apply(null,n))||(e.exports=i)},877:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(411),r(344),r(793),r(430),r(684),r(349)],void 0===(i=function(e,t,r,n,i,o,a,s){function l(e,t){var r=a.empty(),n=t.getObjects();return t.getSpatialQueryAccelerator()?function(e,t,r){var n=t.eye,i=t.viewForward,o=t.frustumPlanes,s=function(e){return!e.areAllComponentsHidden()},l=r.objectCount;if(l<h)a.set(S,t.near,Math.min(e.near,t.far)),r.forEachInDepthRange(n,i,"front-to-back",S,function(r,n){u(e,t,r),S.far=e.near,n.setRange(S)},o,s),a.set(S,Math.max(e.far,t.near),t.far),r.forEachInDepthRange(n,i,"back-to-front",S,function(r,n){u(e,t,r),S.near=e.far,n.setRange(S)},o,s);else{var c=Math.max(Math.min(l,m),Math.ceil(l*v)),p=r.findClosest(i,"front-to-back",o,s,c),f=r.findClosest(i,"back-to-front",o,s,c);p&&f&&(d(e,t,p.getCenter(),p.getBSRadius()),d(e,t,f.getCenter(),f.getBSRadius()))}}(r,e,t.getSpatialQueryAccelerator()):function(e,t,r){T.clear(),r.forEach(function(e){e.areAllComponentsHidden()||T.add(e)}),T.empty||(T.sort(t),a.set(S,t.near,Math.min(e.near,t.far)),T.forEachInDepthRange(S,"front-to-back",function(r,n,i){n<e.near&&u(e,t,r)}),a.set(S,Math.max(e.far,t.near),t.far),T.forEachInDepthRange(S,"back-to-front",function(t,r,n){e.far=Math.max(e.far,n)}))}(r,e,n),r}function u(e,t,r){if(!r.areAllComponentsHidden()&&i.frustumSphere(t.frustumPlanes,r.getCenter(),r.getBSRadius())){var o=r.objectTransformation,a=w;r.geometryRecords.forEach(function(r){n.mat4d.multiply(o,r.getShaderTransformation(),a);var i=n.mat4d.maxScale(a);c(e,t,r.geometry.boundingInfo,a,i)})}}function c(e,t,r,o,a){var s=t.eye,l=t.viewForward;n.mat4d.multiplyVec3(o,r.center,x);var u=l[0]*(x[0]-s[0])+l[1]*(x[1]-s[1])+l[2]*(x[2]-s[2]),d=r.bsRadius*a;if(!(u-d>e.near&&u+d<e.far)&&i.frustumSphere(t.frustumPlanes,x,d))if(r.bsRadius>f&&r.getChildren())for(var p=r.getChildren(),h=0;h<8;++h)p[h]&&c(e,t,p[h],o,a);else C.unionDepthRangeWithAABB(e,t.viewProjectionMatrix,o,r.bbMin,r.bbMax)}function d(e,t,r,n){var i=t.eye,o=t.viewForward,a=(r[0]-i[0])*o[0]+(r[1]-i[1])*o[1]+(r[2]-i[2])*o[2];e.near=Math.min(e.near,a-n),e.far=Math.max(e.far,a+n)}Object.defineProperty(t,"__esModule",{value:!0});var p=1e4,f=100,h=500,m=500,v=.1;t.depthRangeFromScene=function(e,t,r){if(t.size<p)return E.compute(e,t);var n=a.empty();for(var i in r){var o=r[i];a.union(n,l(e,o))}return n},t.depthRangeFromLayer=l;var g=function(){function e(){this._items=new r({allocator:function(){return{obj:null,distance:0,near:0,far:0}}})}return Object.defineProperty(e.prototype,"length",{get:function(){return this._items.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"empty",{get:function(){return 0===this._items.length},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this._items.clear()},e.prototype.add=function(e){this._items.pushNew().obj=e},e.prototype.sort=function(e){var t=e.eye,r=e.viewForward;this._items.forEach(function(e){var n=e.obj,i=n.getCenter(),o=n.getBSRadius(),a=(i[0]-t[0])*r[0]+(i[1]-t[1])*r[1]+(i[2]-t[2])*r[2];e.distance=a,e.near=a-o,e.far=a+o}),this._items.sort(function(e,t){return e.distance-t.distance})},e.prototype.forEachInDepthRange=function(e,t,r){if("front-to-back"===t)for(var n=0;n<this._items.length;++n){(i=this._items.data[n]).far<e.near||i.near>e.far||r(i.obj,i.near,i.far)}else for(n=this._items.length-1;n>=0;--n){var i;(i=this._items.data[n]).far<e.near||i.near>e.far||r(i.obj,i.near,i.far)}},e}(),y=function(){function e(){this.view=n.mat4d.create(),this.viewProj=n.mat4d.create(),this.planes=[n.vec4d.create(),n.vec4d.create(),n.vec4d.create(),n.vec4d.create(),n.vec4d.create(),n.vec4d.create()],this.geometries=[],this.near=[],this.far=[],this.nearCandidates=[],this.farCandidates=[],this.range={near:0,far:0},this.looseRange={near:0,far:0}}return e.prototype.compute=function(e,t){var r=this;this.reset(),n.mat4d.set(e.viewMatrix,this.view),n.mat4d.multiply(e.projectionMatrix,this.view,this.viewProj),e.copyFrustumPlanes(this.planes);var i=this.view,a=i[2],s=i[6],l=i[10],u=i[14],c=this.range,d=0;if(t.forEach(function(e){var t=e.instanceParameters.componentVisibilities,n=e.componentOffsets;if(!o.isAllHidden(t,n)&&e.castShadow){var i,c;e.hasShaderTransformation?(i=e.getBoundingSphere(e.getShaderTransformation(),1,x),c=x):(i=e.bsRadius,c=e.center);var p=a*c[0]+s*c[1]+l*c[2]+u,f=p-i,h=p+i;r.geometries[d]=e,r.near[d]=-h,r.far[d]=-f,++d}}),0===this.geometries.length)return c;for(var p=0;p<this.geometries.length;++p)this.near[p]>c.far&&(c.far=this.near[p]),this.near[p]>2&&this.far[p]<c.near&&(c.near=this.far[p]);var f=this.looseRange;f.near=Math.max(.5*c.near,2),f.far=2*c.far;var h=0,m=0;for(p=0;p<this.geometries.length;++p)this.near[p]<c.near&&(this.near[p]>=f.near?c.near=this.near[p]:this.nearCandidates[h++]=p),this.far[p]>c.far&&(this.far[p]<=f.far?c.far=this.far[p]:this.farCandidates[m++]=p);if(0===this.nearCandidates.length&&0===this.farCandidates.length)return c;this.nearCandidates.sort(function(e,t){return r.near[e]<r.near[t]?-1:r.near[e]>r.near[t]?1:0}),this.farCandidates.sort(function(e,t){return r.far[e]<r.far[t]?1:r.far[e]>r.far[t]?-1:0});for(p=0;p<this.nearCandidates.length;++p){var v=this.nearCandidates[p];if(this.near[v]<c.near){var g=(y=this.geometries[v]).boundingInfo;this.includeNearBoundingInfoRec(g,y.getShaderTransformation())}}for(p=0;p<this.farCandidates.length;++p){v=this.farCandidates[p];if(this.far[v]>c.far){var y;g=(y=this.geometries[v]).boundingInfo;this.includeFarBoundingInfoRec(g,y.getShaderTransformation())}}return c},e.prototype.reset=function(){this.geometries.length=0,this.near.length=0,this.far.length=0,this.nearCandidates.length=0,this.farCandidates.length=0,this.range.near=Number.MAX_VALUE,this.range.far=-Number.MAX_VALUE},e.prototype.includeNearBoundingInfoRec=function(e,t){var r=e.getBSRadius(),i=e.getCenter();n.mat4d.multiplyVec3(t,i,x);var o=n.mat4d.maxScale(t),a=x[0],s=x[1],l=x[2];if(r*=o,!(this.planes[0][0]*a+this.planes[0][1]*s+this.planes[0][2]*l+this.planes[0][3]>r||this.planes[1][0]*a+this.planes[1][1]*s+this.planes[1][2]*l+this.planes[1][3]>r||this.planes[2][0]*a+this.planes[2][1]*s+this.planes[2][2]*l+this.planes[2][3]>r||this.planes[3][0]*a+this.planes[3][1]*s+this.planes[3][2]*l+this.planes[3][3]>r)){var u=this.view[2]*a+this.view[6]*s+this.view[10]*l+this.view[14],c=u+r;if(!(-(u-r)<2||-c>=this.range.near)){if(-c>this.looseRange.near)return void(this.range.near=-c);if(r>f){var d=e.getChildren();if(void 0!==d){for(var p=0;p<8;++p)void 0!==d[p]&&this.includeNearBoundingInfoRec(d[p],t);return}}C.unionDepthRangeWithAABB(this.range,this.viewProj,t,e.getBBMin(),e.getBBMax())}}},e.prototype.includeFarBoundingInfoRec=function(e,t){var r=e.getBSRadius(),i=e.getCenter();n.mat4d.multiplyVec3(t,i,x);var o=n.mat4d.maxScale(t),a=x[0],s=x[1],l=x[2];if(r*=o,!(this.planes[0][0]*a+this.planes[0][1]*s+this.planes[0][2]*l+this.planes[0][3]>r||this.planes[1][0]*a+this.planes[1][1]*s+this.planes[1][2]*l+this.planes[1][3]>r||this.planes[2][0]*a+this.planes[2][1]*s+this.planes[2][2]*l+this.planes[2][3]>r||this.planes[3][0]*a+this.planes[3][1]*s+this.planes[3][2]*l+this.planes[3][3]>r)){var u=this.view[2]*a+this.view[6]*s+this.view[10]*l+this.view[14]-r;if(!(-u<=this.range.far)){if(-u<this.looseRange.far)return void(this.range.far=-u);if(r>f){var c=e.getChildren();if(void 0!==c){for(var d=0;d<8;++d)void 0!==c[d]&&this.includeFarBoundingInfoRec(c[d],t);return}}C.unionDepthRangeWithAABB(this.range,this.viewProj,t,e.getBBMin(),e.getBBMax())}}},e}();t.DepthRangeFromRenderGeometries=y;var b=function(){function e(){this.modelViewProj=n.mat4d.create(),this.clipPosition=[n.vec4d.create(),n.vec4d.create(),n.vec4d.create(),n.vec4d.create(),n.vec4d.create(),n.vec4d.create(),n.vec4d.create(),n.vec4d.create()]}return e.prototype.unionDepthRangeWithAABB=function(e,t,r,i,o){var a=this.modelViewProj;n.mat4d.multiply(t,r,a);for(var s=!1,l=0;l<8;++l){var u=this.clipPosition[l],c=0===l||3===l||4===l||7===l?i[0]:o[0],d=0===l||1===l||4===l||5===l?i[1]:o[1],p=l<4?i[2]:o[2];u[0]=a[0]*c+a[4]*d+a[8]*p+a[12],u[1]=a[1]*c+a[5]*d+a[9]*p+a[13],u[2]=a[2]*c+a[6]*d+a[10]*p+a[14],u[3]=a[3]*c+a[7]*d+a[11]*p+a[15]}for(l=0;l<12;++l){for(var f=this.clipPosition[_[l][0]],h=this.clipPosition[_[l][1]],m=this.clipPosition[_[l][2]],v=this.clipTriangle(f,h,m),g=!0,y=0;y<v.length;++y){if((b=v[y][3])>=2){g=!1;break}}if(!g){s=!0;for(y=0;y<v.length;++y){var b;(b=v[y][3])<e.near&&(e.near=b),b>e.far&&(e.far=b)}}}return s},e.prototype.inside=function(e,t){return 0===t?e[0]>=-e[3]:1===t?e[1]>=-e[3]:2===t?e[0]<=e[3]:3===t?e[1]<=e[3]:void s.assert(!1)},e.prototype.intersect=function(e,t,r){var i=0;return 0===r?i=(-e[3]-e[0])/(t[0]-e[0]+t[3]-e[3]):1===r?i=(-e[3]-e[1])/(t[1]-e[1]+t[3]-e[3]):2===r?i=(e[3]-e[0])/(t[0]-e[0]-t[3]+e[3]):3===r&&(i=(e[3]-e[1])/(t[1]-e[1]-t[3]+e[3])),n.vec4d.lerp(e,t,i,n.vec4d.create())},e.prototype.clipTriangle=function(e,t,r){for(var n=[e,t,r],i=0;i<4;++i){var o=n;n=[];for(var a=0;a<o.length;++a){var s=o[a],l=o[(a+1)%o.length];this.inside(l,i)?(this.inside(s,i)||n.push(this.intersect(s,l,i)),n.push(l)):this.inside(s,i)&&n.push(this.intersect(s,l,i))}}return n},e}(),_=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],x=n.vec3d.create(),w=n.mat4d.create(),S=a.empty(),T=new g,E=new y,C=new b}.apply(null,n))||(e.exports=i)},878:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(344),r(617),r(372),r(439),r(422),r(349),r(879),r(385),r(377),r(397),r(381)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,c,d,p){var f=5;return function(){function e(e,t){this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0},this.quadVAO=null,this.blur0Fbo=null,this.blur1Fbo=null,this._rctx=t,this.viewportToRestore=r.vec4d.create(),this.defaultOptions={color:new Float32Array([1,0,1,1]),haloOpacity:1,fillOpacity:.2,haloOpacityOccluded:.25,fillOpacityOccluded:.05},this.blurProgram=e.getProgram(l.blurPass,{gaussianSamples:f}),this.blurGridProgram=e.getProgram(l.blurPass,{gaussianSamples:f,gridOptimization:!0}),this.applyProgram=e.getProgram(l.applyPass),this.applyGridProgram=e.getProgram(l.applyPass,{gridOptimization:!0}),this.applyGridDebugProgram=e.getProgram(l.applyPass,{gridOptimization:!0,gridDebug:!0}),this.downsampleProgram=e.getProgram(l.downsamplePass)}return Object.defineProperty(e.prototype,"enabled",{get:function(){return null!==this.blur0Fbo},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"profilingCallback",{get:function(){return n.HIGHLIGHTS_PROFILE_TO_CONSOLE?function(e){return console.log(e)}:null},enumerable:!0,configurable:!0}),e.prototype.setDefaultOptions=function(e){this.defaultOptions=e},e.prototype.render=function(e,t){var i=!n.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED,o=n.HIGHLIGHTS_VISUALIZE_BLOCKS,a=e.camera,l=e.fbo,u=this._rctx;s.assert(this.enabled),r.vec4d.set(a.fullViewport,this.viewportToRestore);var c=t.width,p=t.height,f=Math.ceil(c/1),h=Math.ceil(p/1);this.blur0Fbo.resize(f,h),this.blur1Fbo.resize(f,h),u.bindVAO(this.quadVAO),u.setDepthWriteEnabled(!1),u.setDepthTestEnabled(!1),u.setBlendingEnabled(!1);var m=null,v=null,g=null,y=null;if(i){var b=this._grid;this._gridUpdateResources(t,32),this._gridComputeMipmap(),g=b.vao,y=4,m=this.blurGridProgram,u.bindProgram(m),u.bindTexture(b.coverageMipmap[b.mipmapLevels].colorTexture,1),m.setUniform1i("coverageTex",1)}else g=this.quadVAO,y=5,m=this.blurProgram,u.bindProgram(m);if(u.bindVAO(g),u.bindFramebuffer(this.blur0Fbo),u.setViewport(0,0,f,h),u.setClearColor(0,0,0,0),u.clear(u.gl.COLOR_BUFFER_BIT),m.setUniform1i("tex",0),u.bindTexture(t.colorTexture,0),m.setUniform2f("blurSize",1/f,0),u.drawArrays(y,0,d.vertexCount(g,"geometry")),u.bindFramebuffer(this.blur1Fbo),u.clear(u.gl.COLOR_BUFFER_BIT),u.bindTexture(this.blur0Fbo.colorTexture,0),m.setUniform2f("blurSize",0,1/h),u.drawArrays(y,0,d.vertexCount(g,"geometry")),u.bindFramebuffer(l),u.setBlendingEnabled(!0),u.setBlendFunctionSeparate(770,771,1,771),u.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3]),i){v=o?this.applyGridDebugProgram:this.applyGridProgram,u.bindProgram(v),v.setUniform1i("coverageTex",2);var _=this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture;u.bindTexture(_,2)}else v=this.applyProgram,u.bindProgram(v);v.setUniform1i("tex",0),u.bindTexture(this.blur1Fbo.colorTexture,0),v.setUniform1i("origin",1),u.bindTexture(t.colorTexture,1);var x=e.pixelRatio||1;v.setUniform4fv("color",this.defaultOptions.color),v.setUniform1f("outlineSize",8.6*x),v.setUniform1f("blurSize",.4*x),v.setUniform4f("opacities",this.defaultOptions.haloOpacity,this.defaultOptions.haloOpacityOccluded,this.defaultOptions.fillOpacity,this.defaultOptions.fillOpacityOccluded),u.drawArrays(y,0,d.vertexCount(g,"geometry")),u.bindVAO(null),u.setDepthWriteEnabled(!0),u.setDepthTestEnabled(!0),u.setBlendingEnabled(!1)},e.prototype.enable=function(){if(!this.enabled){this.quadVAO=a.createQuadVAO(this._rctx);var e={colorTarget:0,depthStencilTarget:0,width:0,height:0},t={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0};this.blur0Fbo=c.createWithAttachments(this._rctx,t,e),this.blur1Fbo=c.createWithAttachments(this._rctx,t,e)}},e.prototype.disable=function(){this.enabled&&(this.quadVAO.dispose(!0),this.blur1Fbo.dispose(),this.blur0Fbo.dispose(),this.quadVAO=null,this.blur0Fbo=null,this.blur1Fbo=null)},e.prototype._gridUpdateResources=function(e,t){var r=this._rctx,n=this._grid,a=!1;if(null===n.coverageMipmap&&(n.coverageMipmap=[e],a=!0),n.viewportWidth===e.width&&n.viewportHeight===e.height||(a=!0,n.viewportWidth=e.width,n.viewportHeight=e.height),n.coverageMipmap[0]=e,n.cellPixelSize!==t&&(n.cellPixelSize=t,a=!0),a){for(var s=1;s<n.coverageMipmap.length;s++)n.coverageMipmap[s].dispose();n.mipmapLevels=Math.ceil(Math.log(n.cellPixelSize)*Math.LOG2E),n.coverageMipmap.length=n.mipmapLevels+1;for(s=0;s<n.mipmapLevels;s++){var l=n.coverageMipmap[s],d={target:3553,pixelFormat:6407,dataType:33635,samplingMode:9729,wrapMode:33071,width:Math.ceil(l.width/2),height:Math.ceil(l.height/2)},f={colorTarget:0,depthStencilTarget:0,width:Math.ceil(l.width/2),height:Math.ceil(l.height/2)},h=c.createWithAttachments(r,d,f);n.coverageMipmap[s+1]=h}}var m=Math.ceil(e.height/n.cellPixelSize),v=Math.ceil(e.width/n.cellPixelSize);if(!n.vao||n.verticalCellCount!==m||n.horizontalCellCount!==v){n.verticalCellCount=m,n.horizontalCellCount=v;for(var g=m+1,y=v+1,b=1/m,_=1/v,x=new Float32Array(24*g*y),w=0,S=0;S<g;S++)for(var T=0;T<y;T++)x[w+0]=(T-.5)*_*2-1,x[w+1]=(S-.5)*b*2-1,x[w+2]=T*_,x[w+3]=S*b,x[w+4]=(T+.5)*_*2-1,x[w+5]=(S-.5)*b*2-1,x[w+6]=T*_,x[w+7]=S*b,x[w+8]=(T-.5)*_*2-1,x[w+9]=(S+.5)*b*2-1,x[w+10]=T*_,x[w+11]=S*b,x[w+12]=(T-.5)*_*2-1,x[w+13]=(S+.5)*b*2-1,x[w+14]=T*_,x[w+15]=S*b,x[w+16]=(T+.5)*_*2-1,x[w+17]=(S-.5)*b*2-1,x[w+18]=T*_,x[w+19]=S*b,x[w+20]=(T+.5)*_*2-1,x[w+21]=(S+.5)*b*2-1,x[w+22]=T*_,x[w+23]=S*b,w+=24;n.vao&&n.vao.dispose(!0),n.vao=new p(r,i.Default3D,{geometry:o.Pos2Tex},{geometry:u.createVertex(r,35044,x)})}},e.prototype._gridComputeMipmap=function(){var e=this._rctx,t=this._grid,r=this.downsampleProgram;e.bindVAO(this.quadVAO);for(var n=0;n<t.mipmapLevels;n++){e.bindFramebuffer(t.coverageMipmap[n+1]),e.bindTexture(t.coverageMipmap[n].colorTexture,0);var i=t.coverageMipmap[n+1].width,o=t.coverageMipmap[n+1].height;e.bindProgram(r),r.setUniform1i("tex",0),r.setUniform2f("invFramebufferDim",1/i,1/o),e.setViewport(0,0,i,o),e.drawArrays(5,0,d.vertexCount(this.quadVAO,"geometry"))}},e}()}.apply(null,n))||(e.exports=i)},879:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(372),r(401),r(417)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){return i.glslifyDefineMap({GRID_OPTIMIZATION:e.gridOptimization,GAUSSIAN_SAMPLES:e.gaussianSamples})},a=function(e){return i.glslifyDefineMap({GRID_OPTIMIZATION:e.gridOptimization,GRID_DEBUG:e.gridDebug})};t.downsamplePass={name:"highlight-downsample",shaders:{vertexShader:n.resolveIncludes("renderer/highlight/downsample.vert"),fragmentShader:n.resolveIncludes("renderer/highlight/downsample.frag")},attributes:r.Default3D},t.blurPass={name:"highlight-blur",shaders:function(e){return{vertexShader:o(e)+n.resolveIncludes("renderer/highlight/blur.vert"),fragmentShader:o(e)+n.resolveIncludes("renderer/highlight/blur.frag")}},attributes:r.Default3D},t.applyPass={name:"highlight-apply",shaders:function(e){return{vertexShader:a(e)+n.resolveIncludes("renderer/highlight/apply.vert"),fragmentShader:a(e)+n.resolveIncludes("renderer/highlight/apply.frag")}},attributes:r.Default3D}}.apply(null,n))||(e.exports=i)},880:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(422),r(881),r(349),r(882),r(397)],void 0===(i=function(e,t,r,n,i,o,a){var s=function(){function e(e,t){this.dimensions={width:4,height:4},this._enabled=!1,this._background={type:"color",color:[0,0,0,1]},this._rctx=t,this.renderTargetHelper=new n.RenderTargetHelper(t);var r=this.renderTargetHelper;this.mainColor=r.registerColorTarget({name:"mainColor"}),this.mainDepth=r.registerDepthTarget({name:"mainDepth"}),this.hudVisibility=r.registerColorTarget({name:"hudVisibility",dataType:32819}),this.tmpColor=r.registerColorTarget({name:"tmpColor"}),this.tmpDepth=r.registerDepthTarget({name:"tmpDepth"}),this._compositeProgram=e.getProgram(o.compositePass),this._compositeTransparentToHUDVisibilityProgram=e.getProgram(o.compositeTransparentToHUDVisibilityPass)}return Object.defineProperty(e.prototype,"width",{get:function(){return this.dimensions.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.dimensions.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"background",{get:function(){return this._background},set:function(e){this._background=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"framebuffer",{get:function(){return this.renderTargetHelper.getFramebuffer(this.dimensions,this.mainColor,this.mainDepth)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"colorTexture",{get:function(){return this.framebuffer.colorTexture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthTexture",{get:function(){return this.renderTargetHelper.getDepthTexture(this.mainDepth,this.dimensions)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hudVisibilityTexture",{get:function(){return this.getColorTexture(this.hudVisibility)},enumerable:!0,configurable:!0}),e.prototype.initializeFrame=function(e,t){i.assert(this.enabled);var r=this._rctx,n=r.gl,o=e.fullViewport;this.dimensions.width=o[2],this.dimensions.height=o[3],this.mainFbo=t,this.bindTarget(this.mainColor,this.mainDepth),r.setClearStencil(0);var a=this._background.color;r.setClearColor(a[0]*a[3],a[1]*a[3],a[2]*a[3],a[3]),r.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT|n.STENCIL_BUFFER_BIT)},e.prototype.renderSeparateAndComposite=function(e,t,r){void 0===t&&(t=l),void 0===r&&(r=u),this.renderToTargets(e,this.tmpColor,this.mainDepth,t),this.composite(this.getColorTexture(this.tmpColor),this.framebuffer,r)},e.prototype.renderHUDVisibility=function(e){this.renderToTargets(e,this.hudVisibility,this.mainDepth,c)},e.prototype.compositeTransparentTerrainOntoHUDVisibility=function(){var e=this,t=this._rctx;this.renderToTargets(function(){var r=e._compositeTransparentToHUDVisibilityProgram;t.bindProgram(r),r.setUniform1i("tex",1),t.bindTexture(e.getColorTexture(e.tmpColor),1),t.setDepthTestEnabled(!1),t.setBlendingEnabled(!1),t.setColorMask(!1,!0,!1,!1),t.bindVAO(e.quadVAO),t.drawArrays(5,0,a.vertexCount(e.quadVAO,"geometry")),t.setColorMask(!0,!0,!0,!0),t.setDepthTestEnabled(!0)},this.hudVisibility,this.mainDepth)},e.prototype.compositeTransparentTerrainOntoMain=function(){this.composite(this.getColorTexture(this.tmpColor),this.framebuffer,"premultiplied-alpha")},e.prototype.bindFramebuffer=function(){this._rctx.bindFramebuffer(this.framebuffer)},e.prototype.renderDepthDetached=function(e){this.bindTarget(this.mainColor),e(),this.bindTarget(this.mainColor,this.mainDepth)},e.prototype.composite=function(e,t,r){void 0===e&&(e=this.framebuffer.colorTexture),void 0===t&&(t=this.mainFbo),void 0===r&&(r=u);var n=this._rctx,i=this._compositeProgram;switch(n.bindFramebuffer(t),n.setDepthTestEnabled(!1),n.bindProgram(i),i.setUniform1i("tex",1),n.bindTexture(e,1),r){case"none":n.setBlendingEnabled(!1);break;case"alpha":n.setBlendFunctionSeparate(770,771,1,771),n.setBlendingEnabled(!0);break;case"premultiplied-alpha":n.setBlendFunction(1,771),n.setBlendingEnabled(!0)}n.bindVAO(this.quadVAO),n.drawArrays(5,0,a.vertexCount(this.quadVAO,"geometry")),n.setDepthTestEnabled(!0),n.setBlendingEnabled(!1)},e.prototype.enable=function(){this.enabled||(this._enabled=!0,this.quadVAO=r.createQuadVAO(this._rctx))},e.prototype.disable=function(){this.enabled&&(this._enabled=!1,this.renderTargetHelper.disposeAllResource(),this.quadVAO.dispose(!0),this.quadVAO=null)},e.prototype.renderToTargets=function(e,t,r,n,i){var o=this._rctx,a=o.gl;this.bindTarget(t,r);var s=0;if(n){var l=Math.max(1e-13,n[3]);o.setClearColor(n[0],n[1],n[2],l),s|=a.COLOR_BUFFER_BIT}i&&(s|=a.DEPTH_BUFFER_BIT),o.clear(s),e(),a.flush(),this.bindTarget(this.mainColor,this.mainDepth)},e.prototype.bindTarget=function(e,t){var r=this.renderTargetHelper.getFramebuffer(this.dimensions,e,t);this._rctx.bindFramebuffer(r)},e.prototype.getColorTexture=function(e){return this.renderTargetHelper.getColorTexture(e,this.dimensions)},e}(),l=[0,0,0,0],u="none",c=[0,1,0,1];return s}.apply(null,n))||(e.exports=i)},881:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(345),r(377),r(964),r(371)],void 0===(i=function(e,t,r,n,i,o){Object.defineProperty(t,"__esModule",{value:!0});var a={dataType:5121},s={},l=function(){function e(e){this.rctx=e,this.framebuffers=new Map,this.depthTextures=new Map,this.depthBuffers=new Map,this.colorTextures=new Map,this.nextId=1,this.depthTextureSupported=e.capabilities.depthTexture}return e.prototype.disposeAllResource=function(){this.depthBuffers.forEach(function(e){return e.dispose()}),this.depthBuffers.clear(),this.depthTextures.forEach(function(e){return e.dispose()}),this.depthTextures.clear(),this.colorTextures.forEach(function(e){return e.dispose()}),this.colorTextures.clear()},e.prototype.getDepthTexture=function(e,t){if(this.depthTextureSupported){var r=this.depthTextures.get(e.id);return r&&(r.descriptor.width===t.width&&r.descriptor.height===t.height||(r.dispose(),r=void 0)),r||(r=new o(this.rctx,{target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:t.width,height:t.height}),this.depthTextures.set(e.id,r)),r}},e.prototype.getDepthBuffer=function(e,t){if(!this.depthTextureSupported){var n=this.depthBuffers.get(e.id);return n?n.descriptor.width===t.width&&n.descriptor.height===t.height||n.resize(t.width,t.height):(n=new i(this.rctx,r({internalFormat:34041},t)),this.depthBuffers.set(e.id,n)),n}},e.prototype.getColorTexture=function(e,t){var r=this.colorTextures.get(e.id);return r&&(r.descriptor.width===t.width&&r.descriptor.height===t.height||(r.dispose(),r=void 0)),r||(r=new o(this.rctx,{target:3553,pixelFormat:6408,dataType:e.dataType,samplingMode:9729,wrapMode:33071,width:t.width,height:t.height}),this.colorTextures.set(e.id,r)),r},e.prototype.registerDepthTarget=function(e){void 0===e&&(e={});var t=this.nextId++;return r({id:t},s,e)},e.prototype.registerColorTarget=function(e){void 0===e&&(e={});var t=this.nextId++;return r({id:t},a,e)},e.prototype.getFramebuffer=function(e,t,r){var i=this.getKey(t,r),o=this.framebuffers.get(i),a=this.getColorTexture(t,e);if(this.depthTextureSupported){var s=r?this.getDepthTexture(r,e):void 0;return o?((o.width!==e.width||o.height!==e.height||o.colorTexture!==a||o.depthStencilTexture!==s)&&(o.detachColorTexture(),o.detachDepthStencilTexture(),o.resize(e.width,e.height),o.attachColorTexture(a),o.attachDepthStencilTexture(s)),o):(o=r?n.createWithAttachments(this.rctx,a,{colorTarget:0,depthStencilTarget:4},s):n.createWithAttachments(this.rctx,a,{colorTarget:0,depthStencilTarget:0}),this.framebuffers.set(i,o),o)}var l=r?this.getDepthBuffer(r,e):void 0;return o?((o.width!==e.width||o.height!==e.height||o.colorTexture!==a)&&(o.detachColorTexture(),o.detachDepthStencilBuffer(),o.resize(e.width,e.height),o.attachColorTexture(a),o.attachDepthStencilBuffer(l)),o):(o=n.createWithAttachments(this.rctx,a,{colorTarget:0,depthStencilTarget:r?3:0},l),this.framebuffers.set(i,o),o)},e.prototype.getKey=function(e,t){return e.id+"_"+(t?t.id:"X")+"_"+e.name+(t?"_"+t.name:"")},e}();t.RenderTargetHelper=l}.apply(null,n))||(e.exports=i)},882:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(372),r(401)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0}),t.compositePass={name:"offscreen-composite",shaders:{vertexShader:n.resolveIncludes("renderer/offscreen/offscreen.vert"),fragmentShader:n.resolveIncludes("renderer/offscreen/offscreen.frag")},attributes:r.Default3D},t.compositeTransparentToHUDVisibilityPass={name:"offscreen-composite-transparent-to-hud-visibility",shaders:{vertexShader:n.resolveIncludes("renderer/offscreen/offscreen.vert"),fragmentShader:n.resolveIncludes("renderer/offscreen/transparentToHUDVisibility.frag")},attributes:r.Default3D}}.apply(null,n))||(e.exports=i)},883:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(344),r(422),r(349),r(884),r(377),r(397)],void 0===(i=function(e,t,r,n,i,o,a,s){return function(){function e(e,t){this._quadVAO=null,this._rctx=t,this._colorFBO=void 0,this._viewportToRestore=r.vec4d.create(),this._combineProgram=e.getProgram(o.combinePass)}return Object.defineProperty(e.prototype,"enabled",{get:function(){return void 0!==this._colorFBO},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0}),e.prototype.setupFBOs=function(e){i.assert(this.enabled);var t=e.fullViewport;this._viewportToRestore=t,this._width=t[2],this._height=t[3],this._rctx.setViewport(0,0,this._width,this._height)},e.prototype.prepareColorPass=function(){i.assert(this.enabled);var e=this._rctx,t=e.gl;this._colorFBO.resize(this._width,this._height),e.bindFramebuffer(this._colorFBO),e.setClearColor(0,0,0,0),e.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)},e.prototype.finish=function(e){var t=this._rctx;t.bindFramebuffer(e),t.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3])},e.prototype.apply=function(){var e=this._rctx,t=this._combineProgram;e.bindProgram(t),e.bindVAO(this._quadVAO),e.bindTexture(this._colorFBO.colorTexture,0),t.setUniform1i("occludedColorMap",0),e.setDepthWriteEnabled(!1),e.setDepthTestEnabled(!1),e.setBlendingEnabled(!0),e.setBlendFunction(770,771),e.drawArrays(5,0,s.vertexCount(this._quadVAO,"geometry")),e.bindVAO(null),e.setDepthWriteEnabled(!0),e.setDepthTestEnabled(!0),e.setBlendingEnabled(!1)},e.prototype.enable=function(){this.enabled||(this._quadVAO=n.createQuadVAO(this._rctx),this._colorFBO=a.createWithAttachments(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:0,height:0},{colorTarget:0,depthStencilTarget:1}))},e.prototype.disable=function(){this.enabled&&(this._quadVAO.dispose(!0),this._quadVAO=void 0,this._colorFBO.dispose(),this._colorFBO=void 0)},e}()}.apply(null,n))||(e.exports=i)},884:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(372),r(401)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0}),t.combinePass={name:"occluded-combine",shaders:{vertexShader:n.resolveIncludes("util/quad.vert"),fragmentShader:n.resolveIncludes("renderer/occluded/combine.frag")},attributes:r.Default3D}}.apply(null,n))||(e.exports=i)},885:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(344),r(364),r(634),r(372),r(439),r(422),r(349),r(630),r(385),r(377),r(371),r(397),r(381)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,c,d,p,f,h){function m(e,t,n,i,o,a,s,u){r.vec2d.set2(0,0,U);for(var c=0;c<4;++c)r.vec2d.add(U,e[c],U);r.vec2d.scale(U,.25),r.vec2d.set2(0,0,B);for(c=4;c<8;++c)r.vec2d.add(B,e[c],B);r.vec2d.scale(B,.25),r.vec2d.lerp(e[4],e[5],.5,z[0]),r.vec2d.lerp(e[5],e[6],.5,z[1]),r.vec2d.lerp(e[6],e[7],.5,z[2]),r.vec2d.lerp(e[7],e[4],.5,z[3]);var d=0,p=r.vec2d.dist2(z[0],U);for(c=1;c<4;++c){var f=r.vec2d.dist2(z[c],U);f<p&&(p=f,d=c)}r.vec2d.subtract(z[d],e[d+4],k);var h,m,v=k[0];k[0]=-k[1],k[1]=v,r.vec2d.subtract(B,U,G),r.vec2d.lerp(k,G,n),r.vec2d.normalize(k),h=m=r.vec2d.dot(r.vec2d.subtract(e[0],U,H),k);for(c=1;c<8;++c){var g=r.vec2d.dot(r.vec2d.subtract(e[c],U,H),k);g<h?h=g:g>m&&(m=g)}r.vec2d.set(U,i),r.vec2d.scale(k,h-t,H),r.vec2d.add(i,H,i);var y=-1,b=1,_=0,x=0;for(c=0;c<8;++c){r.vec2d.subtract(e[c],i,q),r.vec2d.normalize(q);var w=k[0]*q[1]-k[1]*q[0];w>0?w>y&&(y=w,_=c):w<b&&(b=w,x=c)}l.verify(y>0,"leftArea"),l.verify(b<0,"rightArea"),r.vec2d.scale(k,h,W),r.vec2d.add(W,U,W),r.vec2d.scale(k,m,X),r.vec2d.add(X,U,X),Q[0]=-k[1],Q[1]=k[0];var S=l.rayRay2D(i,e[x],X,r.vec2d.add(X,Q,H),1,o),T=l.rayRay2D(i,e[_],X,H,1,a),E=l.rayRay2D(i,e[_],W,r.vec2d.add(W,Q,H),1,s),C=l.rayRay2D(i,e[x],W,H,1,u);l.verify(S,"rayRay"),l.verify(T,"rayRay"),l.verify(E,"rayRay"),l.verify(C,"rayRay")}function v(e,t){return 3*t+e}function g(e,t){return r.vec3d.set3(e[t],e[t+3],e[t+6],Y),Y}function y(e,t,n,i,o){r.vec2d.scale(r.vec2d.subtract(n,i,J),.5),Z[0]=J[0],Z[1]=J[1],Z[2]=0,Z[3]=J[1],Z[4]=-J[0],Z[5]=0,Z[6]=J[0]*J[0]+J[1]*J[1],Z[7]=J[0]*J[1]-J[1]*J[0],Z[8]=1,Z[v(0,2)]=-r.vec2d.dot(g(Z,0),e),Z[v(1,2)]=-r.vec2d.dot(g(Z,1),e);var a=r.vec2d.dot(g(Z,0),n)+Z[v(0,2)],s=r.vec2d.dot(g(Z,1),n)+Z[v(1,2)],l=r.vec2d.dot(g(Z,0),i)+Z[v(0,2)],u=r.vec2d.dot(g(Z,1),i)+Z[v(1,2)];a=-(a+l)/(s+u),Z[v(0,0)]+=Z[v(1,0)]*a,Z[v(0,1)]+=Z[v(1,1)]*a,Z[v(0,2)]+=Z[v(1,2)]*a,a=1/(r.vec2d.dot(g(Z,0),n)+Z[v(0,2)]),s=1/(r.vec2d.dot(g(Z,1),n)+Z[v(1,2)]),Z[v(0,0)]*=a,Z[v(0,1)]*=a,Z[v(0,2)]*=a,Z[v(1,0)]*=s,Z[v(1,1)]*=s,Z[v(1,2)]*=s,Z[v(2,0)]=Z[v(1,0)],Z[v(2,1)]=Z[v(1,1)],Z[v(2,2)]=Z[v(1,2)],Z[v(1,2)]+=1,a=-.5*((a=r.vec2d.dot(g(Z,1),t)+Z[v(1,2)])/(s=r.vec2d.dot(g(Z,2),t)+Z[v(2,2)])+(l=r.vec2d.dot(g(Z,1),n)+Z[v(1,2)])/(u=r.vec2d.dot(g(Z,2),n)+Z[v(2,2)])),Z[v(1,0)]+=Z[v(2,0)]*a,Z[v(1,1)]+=Z[v(2,1)]*a,Z[v(1,2)]+=Z[v(2,2)]*a,a=r.vec2d.dot(g(Z,1),t)+Z[v(1,2)],l=-(s=r.vec2d.dot(g(Z,2),t)+Z[v(2,2)])/a,Z[v(1,0)]*=l,Z[v(1,1)]*=l,Z[v(1,2)]*=l,o[0]=Z[0],o[1]=Z[1],o[2]=0,o[3]=Z[2],o[4]=Z[3],o[5]=Z[4],o[6]=0,o[7]=Z[5],o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=Z[6],o[13]=Z[7],o[14]=0,o[15]=Z[8]}for(var b=function(){return function(){this.camera=new i,this.lightMat=r.mat4d.create()}}(),_=function(){function e(e,t){this.doShadowMapMipmapsWork=!1,this.textureRes=4096,this.numCascades=1,this.maxNumCascades=2,this.cascadeDistances=[0,0,0,0,0],this.cascades=[],this.programRep=e,this.rctx=t,this.emptyTexture=s.createEmptyTexture(t);for(var r=0;r<4;++r)this.cascades.push(new b)}return e.prototype.dispose=function(){this.emptyTexture.dispose(),this.emptyTexture=null},Object.defineProperty(e.prototype,"textureResolution",{get:function(){return this.textureRes},set:function(e){this.textureRes=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxCascades",{get:function(){return this.maxNumCascades},set:function(e){this.maxNumCascades=n.clamp(Math.floor(e),1,4)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:function(){return!!this.depthTexture},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0}),e.prototype.getDepthTexture=function(){return this.depthTexture},e.prototype.getCascades=function(){for(var e=0;e<this.numCascades;++e)N[e]=this.cascades[e];return N.length=this.numCascades,N},e.prototype.prepare=function(e,t,n,i){l.assert(this.enabled),r.mat4d.multiply(e.projectionMatrix,e.viewMatrix,w);var o=i.near,a=i.far;o<2&&(o=2),a<2&&(a=2),o>=a&&(o=2,a=4),this.numCascades=Math.min(1+Math.floor(l.logWithBase(a/o,4)),this.maxNumCascades);for(var s=Math.pow(a/o,1/this.numCascades),u=0;u<this.numCascades+1;++u)this.cascadeDistances[u]=o*Math.pow(s,u);r.mat4d.inverse(w,S),r.mat4d.lookAt([0,0,0],[-t[0],-t[1],-t[2]],[0,1,0],F);var c=e.viewMatrix,d=e.projectionMatrix;for(u=0;u<this.numCascades;++u){var p=this.cascades[u],f=-this.cascadeDistances[u],h=-this.cascadeDistances[u+1],v=(d[10]*f+d[14])/Math.abs(d[11]*f+d[15]),g=(d[10]*h+d[14])/Math.abs(d[11]*h+d[15]);l.assert(v<g);for(var b=0;b<8;++b){var _=b%4==0||b%4==3?-1:1,C=b%4==0||b%4==1?-1:1,N=b<4?v:g;r.vec4d.set4(_,C,N,1,T),r.mat4d.multiplyVec4(S,T,E[b]);for(var j=0;j<3;++j)E[b][j]/=E[b][3]}r.vec3d.negate(E[0],L),r.mat4d.translate(F,L,x),p.camera.viewMatrix=x;for(b=0;b<8;++b)r.mat4d.multiplyVec3(p.camera.viewMatrix,E[b]);r.vec3d.set(E[0],O),r.vec3d.set(E[0],P);for(b=1;b<8;++b)for(j=0;j<3;++j)O[j]=Math.min(O[j],E[b][j]),P[j]=Math.max(P[j],E[b][j]);O[2]-=200,P[2]+=200,p.camera.near=-P[2],p.camera.far=-O[2],o=1/E[0][3],a=1/E[4][3],l.assert(o<a);var V=o+Math.sqrt(o*a),U=Math.sin(Math.acos(c[2]*t[0]+c[6]*t[1]+c[10]*t[2]));m(E,V/=U,U,A,I,R,M,D),y(A,I,M,D,p.camera.projectionMatrix),p.camera.projectionMatrix[10]=2/(O[2]-P[2]),p.camera.projectionMatrix[14]=-(O[2]+P[2])/(O[2]-P[2]),r.mat4d.multiply(p.camera.projectionMatrix,p.camera.viewMatrix,p.lightMat);var B=this.textureRes/2;p.camera.viewport[0]=u%2==0?0:B,p.camera.viewport[1]=0===Math.floor(u/2)?0:B,p.camera.viewport[2]=B,p.camera.viewport[3]=B}this.lastOrigin=null,this.cascadeDistances[this.numCascades]=100*a;var z=this.rctx,k=z.gl;z.bindFramebuffer(this.fbo),z.bindTexture(null,7),z.setClearColor(1,1,1,1),z.clear(k.COLOR_BUFFER_BIT|k.DEPTH_BUFFER_BIT),z.setBlendingEnabled(!1)},e.prototype.finish=function(e){l.assert(this.enabled),this.rctx.bindFramebuffer(e),this.doShadowMapMipmapsWork&&this.depthTexture.generateMipmap()},e.prototype.bind=function(e){var t=this.rctx,r=this.enabled;t.bindTexture(r?this.depthTexture:this.emptyTexture,7),t.bindProgram(e),e.setUniform1i("depthTex",7),e.setUniform1f("depthHalfPixelSz",r?.5/this.textureRes:-1),e.setUniform1i("shadowMapNum",this.numCascades),e.setUniform4f("shadowMapDistance",this.cascadeDistances[0],this.cascadeDistances[1],this.cascadeDistances[2],this.cascadeDistances[3])},e.prototype.bindAll=function(e){for(var t=e.getProgramsUsingUniform("shadowMapDistance"),r=0;r<t.length;r++)this.bind(t[r])},e.prototype.bindView=function(e,t){if(this.enabled){var n=this.lastOrigin;if(!n||n[0]!==t[0]||n[1]!==t[1]||n[2]!==t[2]){this.lastOrigin=this.lastOrigin||r.vec3d.create(),r.vec3d.set(t,this.lastOrigin);for(var i=0;i<this.numCascades;++i){r.mat4d.translate(this.cascades[i].lightMat,t,j);for(var o=0;o<16;++o)V[16*i+o]=j[o]}}e.setUniformMatrix4fv("shadowMapMatrix",V)}},e.prototype.drawDebugQuad=function(e){l.assert(this.enabled);var t=this.rctx,r=t.gl;if(!this.debugQuadVAO){var n=new Float32Array([0,0,0,0,256,0,1,0,0,256,0,1,256,256,1,1]);this.debugQuadVAO=new h(t,o.Default3D,{geometry:a.Pos2Tex},{geometry:c.createVertex(t,r.STATIC_DRAW,n)})}var i=this.programRep.getProgram(u.showDepth),s=this.debugQuadVAO;t.setDepthTestEnabled(!1),t.bindProgram(i),i.setUniformMatrix4fv("proj",e),i.setUniform1i("depthTex",0),t.bindTexture(this.depthTexture,0),t.bindVAO(s),f.assertCompatibleVertexAttributeLocations(s,i),t.drawArrays(r.TRIANGLE_STRIP,0,f.vertexCount(s,"geometry")),t.setDepthTestEnabled(!0)},e.prototype.enable=function(){if(!this.enabled){var e=this.rctx.gl,t={target:e.TEXTURE_2D,pixelFormat:e.RGBA,dataType:e.UNSIGNED_BYTE,wrapMode:e.CLAMP_TO_EDGE,samplingMode:e.NEAREST,flipped:!0,width:this.textureRes,height:this.textureRes};this.depthTexture=new p(this.rctx,t),this.fbo=d.createWithAttachments(this.rctx,this.depthTexture,{colorTarget:0,depthStencilTarget:1,width:this.textureRes,height:this.textureRes})}},e.prototype.disable=function(){this.enabled&&this.fbo&&(this.fbo.dispose(),this.fbo=null,this.depthTexture=null)},e}(),x=r.mat4d.create(),w=r.mat4d.create(),S=r.mat4d.create(),T=r.vec4d.create(),E=[],C=0;C<8;++C)E.push(r.vec4d.create());var O=r.vec3d.create(),P=r.vec3d.create(),A=r.vec2d.create(),I=r.vec2d.create(),R=r.vec2d.create(),M=r.vec2d.create(),D=r.vec2d.create(),F=r.mat4d.create(),L=r.vec3d.create(),N=[],j=r.mat4d.create(),V=new Float32Array(64),U=r.vec2d.create(),B=r.vec2d.create(),z=[r.vec2d.create(),r.vec2d.create(),r.vec2d.create(),r.vec2d.create()],k=r.vec2d.create(),G=r.vec2d.create(),H=r.vec2d.create(),q=r.vec2d.create(),W=r.vec2d.create(),X=r.vec2d.create(),Q=r.vec2d.create(),Y=r.vec3d.create(),J=r.vec2d.create(),Z=r.mat3d.create();return _}.apply(null,n))||(e.exports=i)},886:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(343),r(344),r(640),r(372),r(439),r(422),r(349),r(630),r(887),r(385),r(377),r(371),r(397),r(381)],void 0===(i=function(e,t,n,i,o,a,s,l,u,c,d,p,f,h,m,v){var g=n.getLogger("esri.views.3d.webgl-engine.lib.SSAOHelper"),y=function(){function e(e,t,r){this._enabled=!1,this._BLUR_F=2,this._attenuation=.5,this._radius=3,this._samples=16,this._viewportToRestore=i.vec4d.create(),this._rctx=t,this._programRep=e,this._requestRender=r,this._emptyTexture=l.createEmptyTexture(t)}return e.prototype.dispose=function(){this._emptyTexture.dispose(),this._emptyTexture=null},Object.defineProperty(e.prototype,"isSupported",{get:function(){var e=this._rctx,t=-1!==e.parameters.versionString.indexOf("WebGL 0.93"),r=-1!==e.parameters.versionString.indexOf("WebGL 0.94");return!(t||r)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"attenuation",{get:function(){return this._attenuation},set:function(e){this._attenuation=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"radius",{get:function(){return this._radius},set:function(e){this._radius=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"filterRadius",{get:function(){return 4},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"samples",{get:function(){return this._samples},set:function(e){this._samples=e,this._enabled&&this.selectPrograms()},enumerable:!0,configurable:!0}),e.prototype.computeSSAO=function(e,t,r,n){if(this._noiseTexture){u.assert(this.enabled);var o=this._rctx,a=r.width,s=r.height,c=a/this._BLUR_F,d=s/this._BLUR_F;this._ssaoFBO.resize(a,s),this._blur0FBO.resize(c,d),this._blur1FBO.resize(c,d);var p=1*a,f=1*s;o.bindFramebuffer(this._ssaoFBO),i.vec4d.set(e.fullViewport,this._viewportToRestore),o.setViewport(0,0,a,s);var h=this._ssaoProgram,v=this._blurProgram;h.setUniform2f("rnmScale",a/this._noiseTexture.descriptor.width,s/this._noiseTexture.descriptor.height),h.setUniform3fv("pSphere",this._samples<=8?this._data.random8:this._samples<=16?this._data.random16:this._samples<=32?this._data.random32:this._data.random64),o.bindProgram(h);var g=this._data.minDiscrepancy,y=this._samples<g.length?g[this._samples]:5779;h.setUniform1f("numSpiralTurns",y);var x=_,w=b;u.inverseProjectionInfo(e.projectionMatrix,e.fullWidth,e.fullHeight,x,w),h.setUniform4fv("projInfo",x),h.setUniform2fv("zScale",w),h.setUniform2f("nearFar",e.near,e.far);var S=1/e.computePixelSizeAtDist(1);h.setUniform1f("projScale",1*S),h.setUniform2f("screenDimensions",p,f);var T=2*this._radius,E=i.vec3d.dist(e.eye,e.center);T=20*e.computePixelSizeAtDist(E),T=Math.max(.1,T),h.setUniform1f("radius",T),h.setUniform1f("intensity",4*this._attenuation/Math.pow(T,6)),h.setUniform1i("rnm",0),h.setUniform1i("normalMap",1),h.setUniform1i("depthMap",2),o.bindTexture(this._noiseTexture,0),o.bindTexture(n.colorTexture,1),o.bindTexture(r.colorTexture,2);var C=l.createQuadVAO(this._rctx);o.bindVAO(C),o.drawArrays(5,0,m.vertexCount(C,"geometry")),o.bindTexture(this._ssaoFBO.colorTexture,0),o.setViewport(0,0,p/this._BLUR_F,f/this._BLUR_F),o.bindFramebuffer(this._blur0FBO),v.setUniform2f("screenDimensions",p,f),v.setUniform1i("tex",0),v.setUniform1i("normalMap",1),v.setUniform1i("depthMap",2),v.setUniform2f("blurSize",0,1*this._BLUR_F/f),v.setUniform1i("radius",4),v.setUniform1f("g_BlurFalloff",.08),v.setUniform2f("nearFar",e.near,e.far),E>5e4&&(S=Math.max(0,S-(E-5e4))),v.setUniform1f("projScale",S),v.setUniform2f("zScale",1,0),o.drawArrays(5,0,m.vertexCount(C,"geometry")),v.setUniform2f("blurSize",1*this._BLUR_F/p,0),o.bindFramebuffer(this._blur1FBO),o.bindTexture(this._blur0FBO.colorTexture,0),o.drawArrays(5,0,m.vertexCount(C,"geometry")),o.bindFramebuffer(t),o.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3])}},e.prototype.setUniforms=function(e){var t=this.enabled&&this._noiseTexture,r=this._rctx;r.bindTexture(t?this._blur1FBO.colorTexture:this._emptyTexture,6),r.setActiveTexture(0),e.setUniform1i("ssaoTex",6),t?e.setUniform4f("viewportPixelSz",this._viewportToRestore[0],this._viewportToRestore[1],1/this._ssaoFBO.width,1/this._ssaoFBO.height):e.setUniform4f("viewportPixelSz",-1,-1,-1,-1)},e.prototype.bindAll=function(e){for(var t=e.getProgramsUsingUniform("viewportPixelSz"),r=0;r<t.length;r++)this.setUniforms(t[r])},e.prototype.drawQuad=function(e){u.assert(this.enabled);var t=this._showDepthProgram;this._debugQuadVAO||(this._debugQuadVAO=new v(this._rctx,a.Default3D,{geometry:s.Pos2Tex},{geometry:p.createVertex(this._rctx,35044,x)}));var r=this._rctx;r.setDepthTestEnabled(!1),t.setUniformMatrix4fv("proj",new Float32Array(e)),t.setUniform1i("depthTex",0),r.bindTexture(this._ssaoFBO.colorTexture,0),r.bindVAO(this._debugQuadVAO),r.drawArrays(5,0,m.vertexCount(this._debugQuadVAO,"geometry")),r.setDepthTestEnabled(!0)},e.prototype.selectPrograms=function(){var e=this._samples<=8?8:this._samples<=16?16:this._samples<=32?32:64;this._ssaoProgram=this._programRep.getProgram(d.ssaoPass,{samples:e}),this._blurProgram=this._programRep.getProgram(d.blurPass,{radius:4}),this._showDepthProgram=this._programRep.getProgram(c.showDepth)},e.prototype.enable=function(){var e=this;if(!this.enabled){if(!this.isSupported)return void g.warn("SSAO is not supported for this browser or hardware");this._enabled=!0,this.loadResources(function(){e._enabled&&e.initialize()})}},e.prototype.loadResources=function(e){var t=this;this._data?e():r.e(109).then(function(){var n=[r(1085)];(function(r){t._data=r,e()}).apply(null,n)}).catch(r.oe)},e.prototype.initialize=function(){var e=this,t={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0},r={colorTarget:0,depthStencilTarget:0};this._ssaoFBO=f.createWithAttachments(this._rctx,t,r),this._blur0FBO=f.createWithAttachments(this._rctx,t,r),this._blur1FBO=f.createWithAttachments(this._rctx,t,r),o.requestImage(this._data.noiseTexture).then(function(t){e._enabled&&(e._noiseTexture=new h(e._rctx,{target:3553,pixelFormat:6408,dataType:5121,hasMipmap:!0,width:t.width,height:t.height},t),e._requestRender())}),this.selectPrograms()},e.prototype.disable=function(){this.enabled&&(this._enabled=!1,this._quadVAO&&(this._quadVAO.dispose(!0),this._quadVAO=null),this._noiseTexture&&(this._noiseTexture.dispose(),this._noiseTexture=null),this._blur1FBO&&(this._blur1FBO.dispose(),this._blur1FBO=null),this._blur0FBO&&(this._blur0FBO.dispose(),this._blur0FBO=null),this._ssaoFBO&&(this._ssaoFBO.dispose(),this._ssaoFBO=null))},e}(),b=i.vec2d.create(),_=i.vec4d.create(),x=new Float32Array([0,0,0,0,512,0,1,0,0,512,0,1,512,512,1,1]);return y}.apply(null,n))||(e.exports=i)},887:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(372),r(401)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});t.ssaoPass={name:"ssao",shaders:function(e){return{vertexShader:n.resolveIncludes("util/quad.vert"),fragmentShader:function(e){return"#define SAMPLES "+e.samples+"\n"}(e)+n.resolveIncludes("renderer/ssao/ssao.frag")}},attributes:r.Default3D},t.blurPass={name:"ssao-blur",shaders:function(e){return{vertexShader:n.resolveIncludes("util/quad.vert"),fragmentShader:function(e){return"#define RADIUS "+e.radius+"\n"}(e)+n.resolveIncludes("renderer/ssao/blur.frag")}},attributes:r.Default3D}}.apply(null,n))||(e.exports=i)},888:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(372),r(401),r(417)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){return i.glslifyDefineMap({VIEWING_MODE_GLOBAL:"global"===e.viewingMode,VIEWING_MODE_LOCAL:"local"===e.viewingMode,TEXTURING:"none"!==e.textureMode,TEXTURE_ATLAS:"AtlasTextured"===e.textureMode,VERTEXCOLORS:e.vertexColors,SYMBOLVERTEXCOLORS:e.symbolColors,FLIPV:e.flipV,DOUBLESIDED:e.doubleSided,WINDINGORDERDOUBLESIDED:e.windowOrderDoubleSided,INSTANCED:e.instanced,INSTANCED_DOUBLE_PRECISION:e.instancedDoublePrecision,INSTANCEDCOLOR:e.instancedColor,RECEIVE_SHADOWS:e.receiveShadows,RECEIVE_SSAO:e.receiveSSAO,VV_SIZE:e.vvSize,VV_COLOR:e.vvColor,VERTICAL_OFFSET:e.verticalOffset,SCREEN_SIZE_PERSPECTIVE:e.screenSizePerspective,SLICE:e.slice,GROUND_NORMAL_SHADING:e.groundNormalShading,COMPRESSED_NORMALS:e.compressedNormals,COMPONENTCOLORS:e.componentColor,TRANSPARENCY_DISCARD:e.transparencyDiscard,ALPHA_COVERAGE_CORRECTION:e.alphaCoverageCorrection,BIAS_SHADOWMAP:e.shadowMap})};t.colorPass={name:"default-color",shaders:function(e){return{vertexShader:o(e)+n.resolveIncludes("materials/defaultMaterial/colorPass.vert"),fragmentShader:o(e)+n.resolveIncludes("materials/defaultMaterial/colorPass.frag")}},attributes:r.Default3D},t.depthPass={name:"default-depth",shaders:function(e){return{vertexShader:o(e)+n.resolveIncludes("materials/defaultMaterial/depthPass.vert"),fragmentShader:o(e)+n.resolveIncludes("materials/defaultMaterial/depthPass.frag")}},attributes:r.Default3D},t.normalPass={name:"default-normal",shaders:function(e){return{vertexShader:o(e)+n.resolveIncludes("materials/defaultMaterial/normalPass.vert"),fragmentShader:o(e)+n.resolveIncludes("materials/defaultMaterial/normalPass.frag")}},attributes:r.Default3D},t.highlightPass={name:"default-highlight",shaders:function(e){return{vertexShader:o(e)+n.resolveIncludes("materials/defaultMaterial/highlightPass.vert"),fragmentShader:o(e)+n.resolveIncludes("materials/defaultMaterial/highlightPass.frag")}},attributes:r.Default3D}}.apply(null,n))||(e.exports=i)},889:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(371)],void 0===(i=function(e,t,r){function n(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}Object.defineProperty(t,"__esModule",{value:!0});var i=542327876,o=131072,a=4,s=33776,l=33778,u=33779,c=n("DXT1"),d=n("DXT3"),p=n("DXT5"),f=31,h=0,m=1,v=2,g=3,y=4,b=7,_=20,x=21;t.createDDSTexture=function(e,t,n,w){var S=new Int32Array(n,0,f);if(S[h]!==i)return console.error("Invalid magic number in DDS header"),null;if(!(S[_]&a))return console.error("Unsupported format, must contain a FourCC code"),null;var T,E,C=S[x];switch(C){case c:T=8,E=s;break;case d:T=16,E=l;break;case p:T=16,E=u;break;default:return console.error("Unsupported FourCC code:",function(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}(C)),null}var O=1;S[v]&o&&!1!==w&&(O=Math.max(1,S[b]));for(var P,A,I=S[y],R=S[g],M=S[m]+4,D=[],F=0;F<O;++F)A=Math.floor((I+3)/4)*Math.floor((R+3)/4)*T,P=new Uint8Array(n,M,A),D.push(P),M+=A,I=Math.max(1,I>>1),R=Math.max(1,R>>1);t.samplingMode=O>1?9987:9729,t.hasMipmap=O>1,t.width=S[y],t.height=S[g],t.internalFormat=E;var L=new r(e,t,{type:"compressed",levels:D});return e.bindTexture(L),L}}.apply(null,n))||(e.exports=i)},902:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=1,n=null;t.generateDefaultIndexArray=function(e){if(e>r||null==n){for(;e>r;)r*=2;n=new Uint32Array(r);for(var t=0;t<r;t++)n[t]=t}return new Uint32Array(n.buffer,0,e)};var i=0;t.getNewId=function(){return i++}}.apply(null,n))||(e.exports=i)},960:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(461),i=r(621),o=r(669);if(i.default("es6-object")){var a=n.default.Object;t.assign=a.assign,t.getOwnPropertyDescriptor=a.getOwnPropertyDescriptor,t.getOwnPropertyNames=a.getOwnPropertyNames,t.getOwnPropertySymbols=a.getOwnPropertySymbols,t.is=a.is,t.keys=a.keys}else t.keys=function(e){return Object.keys(e).filter(function(e){return!Boolean(e.match(/^@@.+/))})},t.assign=function(e){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];if(null==e)throw new TypeError("Cannot convert undefined or null to object");var i=Object(e);return r.forEach(function(e){e&&t.keys(e).forEach(function(t){i[t]=e[t]})}),i},t.getOwnPropertyDescriptor=function(e,t){return o.isSymbol(t),Object.getOwnPropertyDescriptor(e,t)},t.getOwnPropertyNames=function(e){return Object.getOwnPropertyNames(e).filter(function(e){return!Boolean(e.match(/^@@.+/))})},t.getOwnPropertySymbols=function(e){return Object.getOwnPropertyNames(e).filter(function(e){return Boolean(e.match(/^@@.+/))}).map(function(e){return Symbol.for(e.substring(2))})},t.is=function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t};if(i.default("es2017-object")){a=n.default.Object;t.getOwnPropertyDescriptors=a.getOwnPropertyDescriptors,t.entries=a.entries,t.values=a.values}else t.getOwnPropertyDescriptors=function(e){return t.getOwnPropertyNames(e).reduce(function(r,n){return r[n]=t.getOwnPropertyDescriptor(e,n),r},{})},t.entries=function(e){return t.keys(e).map(function(t){return[t,e[t]]})},t.values=function(e){return t.keys(e).map(function(t){return e[t]})}},962:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(461);function i(e){return"number"==typeof e&&n.default.isFinite(e)}function o(e){return i(e)&&Math.floor(e)===e}t.EPSILON=1,t.MAX_SAFE_INTEGER=Math.pow(2,53)-1,t.MIN_SAFE_INTEGER=-t.MAX_SAFE_INTEGER,t.isNaN=function(e){return"number"==typeof e&&n.default.isNaN(e)},t.isFinite=i,t.isInteger=o,t.isSafeInteger=function(e){return o(e)&&Math.abs(e)<=t.MAX_SAFE_INTEGER}},963:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1035),r(706)],void 0===(i=function(e,t,r,n){return function(){function e(e){e?this.set(e):this.setDefaults()}return Object.defineProperty(e.prototype,"meterUnitOffset",{get:function(){return this._meterUnitOffset},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"unit",{get:function(){return this._unit},enumerable:!0,configurable:!0}),e.prototype.setUnit=function(e){this._unit=e,this._metersPerElevationInfoUnit=r.getMetersPerUnit(e)},e.prototype.setDefaults=function(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this.featureExpressionInfoContext=null,this.hasOffsetAdjustment=!1,this.setUnit("meters")},e.prototype.set=function(e){this.mode=e.mode,this._meterUnitOffset=e._meterUnitOffset||0,this._renderUnitOffset=e._renderUnitOffset||0,this.featureExpressionInfoContext=e.featureExpressionInfoContext,this.hasOffsetAdjustment=e.hasOffsetAdjustment,this.setUnit(e.unit)},e.prototype.setOffsetMeters=function(e){this._meterUnitOffset=e,this._renderUnitOffset=0},e.prototype.setOffsetElevationInfoUnits=function(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0},e.prototype.setOffsetRenderUnits=function(e){this._meterUnitOffset=0,this._renderUnitOffset=e},e.prototype.addOffsetRenderUnits=function(e){this._renderUnitOffset+=e},e.prototype.mixinApi=function(e){null!=e.mode&&(this.mode=e.mode),null!=e.unit&&this.setUnit(e.unit),null!=e.offset&&this.setOffsetElevationInfoUnits(e.offset)},e.prototype.calculateOffsetRenderUnits=function(e){var t=this._meterUnitOffset,r=this.featureExpressionInfoContext;return null!=r&&(t+=n.execute(r)*this._metersPerElevationInfoUnit),t/e.unitInMeters+this._renderUnitOffset},e}()}.apply(null,n))||(e.exports=i)},964:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(354)],void 0===(i=function(e,t,r){return function(){function e(t,n){this._context=t,this._desc=n,this._glName=null,this._id=-1;var i=this._context.gl;r("esri-webgl-debug")&&this._context.instanceCounter.incrementCount(5),this._id=++e._nextId,this._glName=i.createRenderbuffer(),this._context.bindRenderbuffer(this),i.renderbufferStorage(i.RENDERBUFFER,n.internalFormat,n.width,n.height)}return Object.defineProperty(e.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0}),e.prototype.resize=function(e,t){var r=this._context.gl,n=this._desc;n.width===e&&n.height===t||(n.width=e,n.height=t,this._context.bindRenderbuffer(this),r.renderbufferStorage(r.RENDERBUFFER,n.internalFormat,n.width,n.height))},e.prototype.dispose=function(){this._glName&&(this._context.gl.deleteRenderbuffer(this._glName),this._glName=null),r("esri-webgl-debug")&&this._context.instanceCounter.decrementCount(5),this._context=null},e._nextId=0,e}()}.apply(null,n))||(e.exports=i)},965:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(753),r(665)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0}),t.EdgeInputBufferLayout=n.newLayout().vec3f("position").u16("componentIndex").u16("_padding"),t.VertexLayout=n.newLayout().vec2u8("sideness"),t.glVertexLayout=r.glLayout(t.VertexLayout,{prefixA:!0}),t.CommonInstancesLayout=n.newLayout().vec3f("position0").vec3f("position1").u16("componentIndex").vec2u8("packedAttributes").u8("variantOffset",{glNormalized:!0}).u8("variantStroke").u8("variantExtension",{glNormalized:!0}).u8("_padding",{glPadding:!0}),t.RegularEdgeInstancesLayout=t.CommonInstancesLayout.clone().vec3f("normal"),t.SilhouetteEdgeInstancesLayout=t.CommonInstancesLayout.clone().vec3f("normalA").vec3f("normalB"),t.EdgeShaderAttributeLocations={aPosition0:0,aPosition1:1,aComponentIndex:2,aPackedAttributes:3,aVariantOffset:4,aVariantStroke:5,aVariantExtension:6,aNormal:7,aNormalA:7,aNormalB:8,aSideness:9}}.apply(null,n))||(e.exports=i)},967:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this._listeners={}}return e.prototype.hasEventListener=function(e){return null!=this._listeners[e]&&this._listeners[e].size>0},e.prototype.on=function(e,t){var r=this;null==this._listeners[e]&&(this._listeners[e]=new Map);var n={};return this._listeners[e].set(n,t),{remove:function(){return r._listeners[e].delete(n)}}},e.prototype.emit=function(e,t){null!=this._listeners[e]&&this._listeners[e].forEach(function(e){return e(t)})},e}();t.Evented=r}.apply(null,n))||(e.exports=i)},984:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(362),r(357)],void 0===(i=function(e,t,r,n){function i(e,t,i){if(!t)return null;var o=r.toUnitRGBA(t.color),a=i.opacity,s=i.slicePlaneEnabled;switch(t.type){case"solid":return e.createSolidEdgeMaterial({color:o,size:n.pt2px(t.size),extensionLength:n.pt2px(t.extensionLength),opacity:a,slicePlaneEnabled:s});case"sketch":return e.createSketchEdgeMaterial({color:o,size:n.pt2px(t.size),extensionLength:n.pt2px(t.extensionLength),opacity:a,slicePlaneEnabled:s})}}Object.defineProperty(t,"__esModule",{value:!0}),t.createMaterial=function(e,t,r){return i(e,function(e){return e&&e.enabled&&e.edges||null}(t),r)},t.createMaterialFromEdges=i}.apply(null,n))||(e.exports=i)},985:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(411),r(344),r(349)],void 0===(i=function(e,t,r,n,i){function o(e,t,r){e[0]=Math.min(e[0],t[0]-r),e[1]=Math.min(e[1],t[1]-r),e[2]=Math.min(e[2],t[2]-r)}function a(e,t,r){e[0]=Math.max(e[0],t[0]+r),e[1]=Math.max(e[1],t[1]+r),e[2]=Math.max(e[2],t[2]+r)}function s(e,t,r){return(r=r||e)[0]=e[0]+t,r[1]=e[1]+t,r[2]=e[2]+t,r}function l(e,t,r){var n=e[0],i=e[1],o=e[2];return r[0][0]*n+r[0][1]*i+r[0][2]*o+r[0][3]>t||r[1][0]*n+r[1][1]*i+r[1][2]*o+r[1][3]>t||r[2][0]*n+r[2][1]*i+r[2][2]*o+r[2][3]>t||r[3][0]*n+r[3][1]*i+r[3][2]*o+r[3][3]>t||r[4][0]*n+r[4][1]*i+r[4][2]*o+r[4][3]>t||r[5][0]*n+r[5][1]*i+r[5][2]*o+r[5][3]>t}function u(e,t){for(var r=1/0,n=null,i=0;i<8;++i){var o=c(e,t,m[i]);o<r&&(r=o,n=m[i])}return n}function c(e,t,r){return t*(e[0]*r[0]+e[1]*r[1]+e[2]*r[2])}var d,p=function(){function e(e,t,r,i){this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._objectCount=0,this._objectToBoundingSphere=r,i&&(void 0!==i.maximumObjectsPerNode&&(this._maximumObjectsPerNode=i.maximumObjectsPerNode),void 0!==i.maximumDepth&&(this._maximumDepth=i.maximumDepth)),isNaN(e[0])||isNaN(e[1])||isNaN(e[2])||isNaN(t)?this._root=new f(null,n.vec3d.createFrom(0,0,0),.5):this._root=new f(null,e,t/2)}return Object.defineProperty(e.prototype,"center",{get:function(){return this._root.center},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return 2*this._root.halfSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this._root.node},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maximumObjectsPerNode",{get:function(){return this._maximumObjectsPerNode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maximumDepth",{get:function(){return this._maximumDepth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"objectCount",{get:function(){return this._objectCount},enumerable:!0,configurable:!0}),e.prototype.add=function(e,t){var r=this._objectOrObjectsArray(e);t=null==t?r.length:t,this._objectCount+=t,this._grow(r);for(var n=f.acquire(),i=0;i<t;i++){var o=r[i];n.init(this._root),this._isDegenerate(o)?this._degenerateObjects.add(o):this._add(o,n)}f.release(n)},e.prototype.remove=function(e,t){var r=this._objectOrObjectsArray(e);this._objectCount-=r.length;for(var n=f.acquire(),i=0;i<r.length;i++){var o=r[i],a=t||this._boundingSphereFromObject(o,S);this._isValidRadius(a.radius)?(n.init(this._root),this._remove(o,a,n)):this._degenerateObjects.delete(o)}f.release(n),this._shrink()},e.prototype.update=function(e,t){!this._isValidRadius(t.radius)&&this._isDegenerate(e)||(this.remove(e,t),this.add(e))},e.prototype.forEachAlongRay=function(e,t,r){var n=this;this._forEachNode(this._root,function(i){if(!n._intersectsNode(e,t,i))return!1;var o=i.node;return o.terminals.forEach(function(i){n._intersectsObject(e,t,i)&&r(i)}),null!==o.residents&&o.residents.forEach(function(i){n._intersectsObject(e,t,i)&&r(i)}),!0})},e.prototype.forEachDegenerateObject=function(e){this._degenerateObjects.forEach(e)},e.prototype.findClosest=function(e,t,r,n,i){return this._findClosest(e,"front-to-back"===t?d.FRONT_TO_BACK:d.BACK_TO_FRONT,r,n,i)},e.prototype.forEachInDepthRange=function(e,t,r,n,i,o,a,s){this._forEachInDepthRange(e,t,"front-to-back"===r?d.FRONT_TO_BACK:d.BACK_TO_FRONT,n,i,o,a,s)},e.prototype.forEachNode=function(e){this._forEachNode(this._root,function(t){return e(t.node,t.center,2*t.halfSize)})},e.prototype._intersectsNode=function(e,t,r){return s(r.center,2*-r.halfSize,_),s(r.center,2*r.halfSize,x),i.rayBoxTest(e,t,_,x)},e.prototype._intersectsObject=function(e,t,r){var n=this._objectToBoundingSphere.getRadius(r);return!(n>0)||i.raySphere(e,t,this._objectToBoundingSphere.getCenter(r),n)},e.prototype._forEachNode=function(e,t){for(var r=f.acquire().init(e),n=[r];0!==n.length;){if(t(r=n.pop())&&!r.isLeaf())for(var i=0;i<r.node.children.length;i++){r.node.children[i]&&n.push(f.acquire().init(r).advance(i))}f.release(r)}},e.prototype._forEachNodeDepthOrdered=function(e,t,r,n){void 0===n&&(n=d.FRONT_TO_BACK);for(var i=f.acquire().init(e),o=[i],a=function(e,t,r){if(!P.length)for(var n=0;n<8;++n)P[n]={index:0,distance:0};for(n=0;n<8;++n){var i=h[n];P[n].index=n,P[n].distance=c(e,t,i)}for(P.sort(function(e,t){return e.distance-t.distance}),n=0;n<8;++n)r[n]=P[n].index;return r}(r,n,A);0!==o.length;){if(t(i=o.pop())&&!i.isLeaf())for(var s=7;s>=0;--s){var l=a[s];if(!(l>=i.node.children.length))i.node.children[l]&&o.push(f.acquire().init(i).advance(l))}f.release(i)}},e.prototype._findClosest=function(e,t,r,i,o){var a=this,s=1/0,d=1/0,p=null,f=u(e,t),h=0,m=function(n){if(++h,!i||i(n)){var o=a._objectToBoundingSphere.getCenter(n),u=a._objectToBoundingSphere.getRadius(n);if(!r||!l(o,u,r)){var f=c(e,t,o),m=f-u;m<s&&(s=m,d=f+u,p=n)}}};return this._forEachNodeDepthOrdered(this._root,function(i){if(null!=o&&h>=o)return!1;if(r&&l(i.center,i.halfSize*v,r))return!1;if(n.vec3d.scale(f,i.halfSize,b),n.vec3d.add(b,i.center),c(e,t,b)>d)return!1;var a=i.node;return a.terminals.forEach(function(e){m(e)}),null!==a.residents&&a.residents.forEach(function(e){m(e)}),!0},e,t),p},e.prototype._forEachInDepthRange=function(e,t,r,i,o,a,s,p){var f=this,h=-1/0,m=1/0,g={setRange:function(e){r===d.FRONT_TO_BACK?(h=Math.max(h,e.near),m=Math.min(m,e.far)):(h=Math.max(h,-e.far),m=Math.min(m,-e.near))}};g.setRange(i);var y=c(t,r,e),_=u(t,r),x=u(t,-1*r),w=0,S=function(e){if(++w,!s||s(e)){var n=f._objectToBoundingSphere.getCenter(e),i=f._objectToBoundingSphere.getRadius(e),u=c(t,r,n)-y;u-i>m||u+i<h||a&&l(n,i,a)||o(e,g)}};this._forEachNodeDepthOrdered(this._root,function(e){if(null!=p&&w>=p)return!1;if(a&&l(e.center,e.halfSize*v,a))return!1;if(n.vec3d.scale(_,e.halfSize,b),n.vec3d.add(b,e.center),c(t,r,b)-y>m)return!1;if(n.vec3d.scale(x,e.halfSize,b),n.vec3d.add(b,e.center),c(t,r,b)-y<h)return!1;var i=e.node;return i.terminals.forEach(function(e){S(e)}),null!==i.residents&&i.residents.forEach(function(e){S(e)}),!0},t,r)},e.prototype._objectOrObjectsArray=function(e){return Array.isArray(e)?e:(g[0]=e,g)},e.prototype._remove=function(e,t,r){w.length=0;var n=r.advanceTo(t,function(e,t){w.push(e.node,t)})?r.node.terminals:r.node.residents;if(n.removeUnordered(e),0===n.length)for(var i=w.length-2;i>=0;i-=2){var o=w[i],a=w[i+1];if(!this._purge(o,a))break}},e.prototype._nodeIsEmpty=function(e){if(0!==e.terminals.length)return!1;if(null!==e.residents)return 0===e.residents.length;for(var t=0;t<e.children.length;t++)if(e.children[t])return!1;return!0},e.prototype._purge=function(e,t){return t>=0&&(e.children[t]=null),!!this._nodeIsEmpty(e)&&(null===e.residents&&(e.residents=new r({shrink:!0})),!0)},e.prototype._add=function(e,t){t.advanceTo(this._boundingSphereFromObject(e,S))?t.node.terminals.push(e):(t.node.residents.push(e),t.node.residents.length>this._maximumObjectsPerNode&&t.depth<this._maximumDepth&&this._split(t))},e.prototype._split=function(e){var t=e.node.residents;e.node.residents=null;for(var r=0;r<t.length;r++){var n=f.acquire().init(e);this._add(t.data[r],n),f.release(n)}},e.prototype._grow=function(e){var t=this;if(0!==e.length){var r=this._boundingSphereFromObjects(e,function(e,r){return t._boundingSphereFromObject(e,r)},T);if(this._isValidRadius(r.radius)&&!this._fitsInsideTree(r))if(this._nodeIsEmpty(this._root.node))n.vec3d.set(r.center,this._root.center),this._root.halfSize=1.25*r.radius;else{var i=f.acquire();this._rootBoundsForRootAsSubNode(r,i),this._placingRootViolatesMaxDepth(i)?this._rebuildTree(r,i):this._growRootAsSubNode(i),f.release(i)}}},e.prototype._rebuildTree=function(e,t){var r=this;n.vec3d.set(t.center,E.center),E.radius=t.halfSize;var i=this._boundingSphereFromObjects([e,E],function(e){return e},C),o=f.acquire().init(this._root);this._root.initFrom(null,i.center,1.25*i.radius),this._forEachNode(o,function(e){return r.add(e.node.terminals.data,e.node.terminals.length),null!==e.node.residents&&r.add(e.node.residents.data,e.node.residents.length),!0}),f.release(o)},e.prototype._placingRootViolatesMaxDepth=function(e){var t=0;return this._forEachNode(this._root,function(e){return t=Math.max(t,e.depth),!0}),t+Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E>this._maximumDepth},e.prototype._rootBoundsForRootAsSubNode=function(e,t){for(var r=e.radius,n=e.center,i=-1/0,o=this._root.center,a=this._root.halfSize,s=0;s<3;s++){var l=o[s]-a-(n[s]-r),u=n[s]+r-(o[s]+a),c=Math.max(0,Math.ceil(l/(2*a))),d=Math.max(0,Math.ceil(u/(2*a)))+1,p=Math.pow(2,Math.ceil(Math.log(c+d)*Math.LOG2E));i=Math.max(i,p),O[s].min=c,O[s].max=d}for(s=0;s<3;s++){var f=(i-((c=O[s].min)+(d=O[s].max)))/2;c+=Math.ceil(f),d+=Math.floor(f);var h=o[s]-a-c*a*2;y[s]=h+(d+c)*a}return t.initFrom(null,y,i*a,0)},e.prototype._growRootAsSubNode=function(e){var t=this._root.node;n.vec3d.set(this._root.center,T.center),T.radius=this._root.halfSize,this._root.init(e),e.advanceTo(T,null,!0),e.node.children=t.children,e.node.residents=t.residents,e.node.terminals=t.terminals},e.prototype._shrink=function(){for(;;){var e=this._findShrinkIndex();if(-1===e)break;this._root.advance(e),this._root.depth=0}},e.prototype._findShrinkIndex=function(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;for(var e=null,t=this._root.node.children,r=0,n=0;n<t.length&&null==e;)e=t[r=n++];for(;n<t.length;)if(t[n++])return-1;return r},e.prototype._isDegenerate=function(e){var t=this._objectToBoundingSphere.getRadius(e);return!this._isValidRadius(t)},e.prototype._isValidRadius=function(e){return!isNaN(e)&&e!==-1/0&&e!==1/0&&e>0},e.prototype._fitsInsideTree=function(e){var t=this._root.center,r=this._root.halfSize,n=e.center;return e.radius<=r&&n[0]>=t[0]-r&&n[0]<=t[0]+r&&n[1]>=t[1]-r&&n[1]<=t[1]+r&&n[2]>=t[2]-r&&n[2]<=t[2]+r},e.prototype._boundingSphereFromObject=function(e,t){return n.vec3d.set(this._objectToBoundingSphere.getCenter(e),t.center),t.radius=this._objectToBoundingSphere.getRadius(e),t},e.prototype._boundingSphereFromObjects=function(e,t,r){if(1===e.length){var i=t(e[0],T);n.vec3d.set(i.center,r.center),r.radius=i.radius}else{_[0]=1/0,_[1]=1/0,_[2]=1/0,x[0]=-1/0,x[1]=-1/0,x[2]=-1/0;for(var s=0;s<e.length;s++){i=t(e[s],T);this._isValidRadius(i.radius)&&(o(_,i.center,i.radius),a(x,i.center,i.radius))}n.vec3d.scale(n.vec3d.add(_,x,r.center),.5),r.radius=Math.max(x[0]-_[0],x[1]-_[1],x[2]-_[2])/2}return r},e}(),f=function(){function e(e,t,r,i){void 0===r&&(r=0),void 0===i&&(i=0),this.center=n.vec3d.create(),this.initFrom(e,t,r,0)}return e.prototype.init=function(e){return this.initFrom(e.node,e.center,e.halfSize,e.depth)},e.prototype.initFrom=function(t,r,i,o){return void 0===t&&(t=null),void 0===i&&(i=this.halfSize),void 0===o&&(o=this.depth),this.node=t||e.createEmptyNode(),r&&n.vec3d.set(r,this.center),this.halfSize=i,this.depth=o,this},e.prototype.advance=function(t){var r=this.node.children[t];r||(r=e.createEmptyNode(),this.node.children[t]=r),this.node=r,this.halfSize/=2,this.depth++;var n=h[t];return this.center[0]+=n[0]*this.halfSize,this.center[1]+=n[1]*this.halfSize,this.center[2]+=n[2]*this.halfSize,this},e.prototype.advanceTo=function(e,t,r){for(void 0===r&&(r=!1);;){if(this.isTerminalFor(e))return t&&t(this,-1),!0;if(this.isLeaf()&&!r)return t&&t(this,-1),!1;this.isLeaf()&&(this.node.residents=null);var n=this._childIndex(e);t&&t(this,n),this.advance(n)}},e.prototype.isLeaf=function(){return null!=this.node.residents},e.prototype.isTerminalFor=function(e){return e.radius>this.halfSize/2},e.prototype._childIndex=function(e){for(var t=e.center,r=this.center,n=0,i=0;i<3;i++)r[i]<t[i]&&(n|=1<<i);return n},e.createEmptyNode=function(){return{children:[null,null,null,null,null,null,null,null],terminals:new r({shrink:!0}),residents:new r({shrink:!0})}},e.acquire=function(){if(0===this._pool.length)return new e;var t=this._pool[this._pool.length-1];return this._pool.length--,t},e.release=function(e){this._pool.push(e)},e._pool=[],e}();!function(e){e[e.FRONT_TO_BACK=1]="FRONT_TO_BACK",e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(d||(d={}));var h=[[-1,-1,-1],[1,-1,-1],[-1,1,-1],[1,1,-1],[-1,-1,1],[1,-1,1],[-1,1,1],[1,1,1]],m=[[-1,-1,-1],[-1,-1,1],[-1,1,-1],[-1,1,1],[1,-1,-1],[1,-1,1],[1,1,-1],[1,1,1]],v=Math.sqrt(3),g=[null],y=n.vec3d.create(),b=n.vec3d.create(),_=n.vec3d.create(),x=n.vec3d.create(),w=[],S={center:n.vec3d.create(),radius:0},T={center:n.vec3d.create(),radius:0},E={center:n.vec3d.create(),radius:0},C={center:n.vec3d.create(),radius:0},O=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],P=[],A=[];return p}.apply(null,n))||(e.exports=i)}}]);